(()=>{var hr=(e=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof require<"u"?require:t)[r]}):e)(function(e){if(typeof require<"u")return require.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')});var _u=Object.defineProperty,vu=Object.getOwnPropertyNames,Vi=(e=>typeof hr<"u"?hr:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof hr<"u"?hr:t)[r]}):e)(function(e){if(typeof hr<"u")return hr.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),Ps=(e,t)=>function(){return e&&(t=(0,e[vu(e)[0]])(e=0)),t},wu=(e,t)=>{for(var r in t)_u(e,r,{get:t[r],enumerable:!0})},Dl,Pl,Bo,Su,ku,Ji,_s,Rl,Ml,Ul,si,As,xu,Ns,Co,jo,zl,Eu,$l,ql,Vl,Jl,Hl,Ou,ra=Ps({"src/ble/node_modules/@capacitor/core/dist/index.js"(){Dl=e=>{let t=new Map;t.set("web",{name:"web"});let r=e.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:t},i=(a,p)=>{r.platforms.set(a,p)},n=a=>{r.platforms.has(a)&&(r.currentPlatform=r.platforms.get(a))};return r.addPlatform=i,r.setPlatform=n,r},Pl=e=>e.CapacitorPlatforms=Dl(e),Bo=Pl(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),Su=Bo.addPlatform,ku=Bo.setPlatform,function(e){e.Unimplemented="UNIMPLEMENTED",e.Unavailable="UNAVAILABLE"}(Ji||(Ji={})),_s=class extends Error{constructor(e,t,r){super(e),this.message=e,this.code=t,this.data=r}},Rl=e=>{var t,r;return e?.androidBridge?"android":!((r=(t=e?.webkit)===null||t===void 0?void 0:t.messageHandlers)===null||r===void 0)&&r.bridge?"ios":"web"},Ml=e=>{var t,r,i,n,a;let p=e.CapacitorCustomPlatform||null,d=e.Capacitor||{},y=d.Plugins=d.Plugins||{},b=e.CapacitorPlatforms,v=()=>p!==null?p.name:Rl(e),h=((t=b?.currentPlatform)===null||t===void 0?void 0:t.getPlatform)||v,w=()=>h()!=="web",_=((r=b?.currentPlatform)===null||r===void 0?void 0:r.isNativePlatform)||w,T=re=>{let me=Q.get(re);return!!(me?.platforms.has(h())||P(re))},C=((i=b?.currentPlatform)===null||i===void 0?void 0:i.isPluginAvailable)||T,I=re=>{var me;return(me=d.PluginHeaders)===null||me===void 0?void 0:me.find(Fe=>Fe.name===re)},P=((n=b?.currentPlatform)===null||n===void 0?void 0:n.getPluginHeader)||I,U=re=>e.console.error(re),H=(re,me,Fe)=>Promise.reject(`${Fe} does not have an implementation of "${me}".`),Q=new Map,W=(re,me={})=>{let Fe=Q.get(re);if(Fe)return console.warn(`Capacitor plugin "${re}" already registered. Cannot register plugins twice.`),Fe.proxy;let ee=h(),ye=P(re),fe,Ce=async()=>(!fe&&ee in me?fe=typeof me[ee]=="function"?fe=await me[ee]():fe=me[ee]:p!==null&&!fe&&"web"in me&&(fe=typeof me.web=="function"?fe=await me.web():fe=me.web),fe),Re=(K,ne)=>{var Te,He;if(ye){let qe=ye?.methods.find(Me=>ne===Me.name);if(qe)return qe.rtype==="promise"?Me=>d.nativePromise(re,ne.toString(),Me):(Me,Ge)=>d.nativeCallback(re,ne.toString(),Me,Ge);if(K)return(Te=K[ne])===null||Te===void 0?void 0:Te.bind(K)}else{if(K)return(He=K[ne])===null||He===void 0?void 0:He.bind(K);throw new _s(`"${re}" plugin is not implemented on ${ee}`,Ji.Unimplemented)}},ot=K=>{let ne,Te=(...He)=>{let qe=Ce().then(Me=>{let Ge=Re(Me,K);if(Ge){let gt=Ge(...He);return ne=gt?.remove,gt}else throw new _s(`"${re}.${K}()" is not implemented on ${ee}`,Ji.Unimplemented)});return K==="addListener"&&(qe.remove=async()=>ne()),qe};return Te.toString=()=>`${K.toString()}() { [capacitor code] }`,Object.defineProperty(Te,"name",{value:K,writable:!1,configurable:!1}),Te},Z=ot("addListener"),ze=ot("removeListener"),ht=(K,ne)=>{let Te=Z({eventName:K},ne),He=async()=>{let Me=await Te;ze({eventName:K,callbackId:Me},ne)},qe=new Promise(Me=>Te.then(()=>Me({remove:He})));return qe.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await He()},qe},te=new Proxy({},{get(K,ne){switch(ne){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return ye?ht:Z;case"removeListener":return ze;default:return ot(ne)}}});return y[re]=te,Q.set(re,{name:re,proxy:te,platforms:new Set([...Object.keys(me),...ye?[ee]:[]])}),te},Be=((a=b?.currentPlatform)===null||a===void 0?void 0:a.registerPlugin)||W;return d.convertFileSrc||(d.convertFileSrc=re=>re),d.getPlatform=h,d.handleError=U,d.isNativePlatform=_,d.isPluginAvailable=C,d.pluginMethodNoop=H,d.registerPlugin=Be,d.Exception=_s,d.DEBUG=!!d.DEBUG,d.isLoggingEnabled=!!d.isLoggingEnabled,d.platform=d.getPlatform(),d.isNative=d.isNativePlatform(),d},Ul=e=>e.Capacitor=Ml(e),si=Ul(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{}),As=si.registerPlugin,xu=si.Plugins,Ns=class{constructor(e){this.listeners={},this.windowListeners={},e&&(console.warn(`Capacitor WebPlugin "${e.name}" config object was deprecated in v3 and will be removed in v4.`),this.config=e)}addListener(e,t){this.listeners[e]||(this.listeners[e]=[]),this.listeners[e].push(t);let i=this.windowListeners[e];i&&!i.registered&&this.addWindowListener(i);let n=async()=>this.removeListener(e,t),a=Promise.resolve({remove:n});return Object.defineProperty(a,"remove",{value:async()=>{console.warn("Using addListener() without 'await' is deprecated."),await n()}}),a}async removeAllListeners(){this.listeners={};for(let e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t){let r=this.listeners[e];r&&r.forEach(i=>i(t))}hasListeners(e){return!!this.listeners[e].length}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:r=>{this.notifyListeners(t,r)}}}unimplemented(e="not implemented"){return new si.Exception(e,Ji.Unimplemented)}unavailable(e="not available"){return new si.Exception(e,Ji.Unavailable)}async removeListener(e,t){let r=this.listeners[e];if(!r)return;let i=r.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}},Co=e=>encodeURIComponent(e).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),jo=e=>e.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent),zl=class extends Ns{async getCookies(){let e=document.cookie,t={};return e.split(";").forEach(r=>{if(r.length<=0)return;let[i,n]=r.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=jo(i).trim(),n=jo(n).trim(),t[i]=n}),t}async setCookie(e){try{let t=Co(e.key),r=Co(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,n=(e.path||"/").replace("path=",""),a=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${r||""}${i}; path=${n}; ${a};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{let e=document.cookie.split(";")||[];for(let t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}},Eu=As("CapacitorCookies",{web:()=>new zl}),$l=async e=>new Promise((t,r)=>{let i=new FileReader;i.onload=()=>{let n=i.result;t(n.indexOf(",")>=0?n.split(",")[1]:n)},i.onerror=n=>r(n),i.readAsDataURL(e)}),ql=(e={})=>{let t=Object.keys(e);return Object.keys(e).map(n=>n.toLocaleLowerCase()).reduce((n,a,p)=>(n[a]=e[t[p]],n),{})},Vl=(e,t=!0)=>e?Object.entries(e).reduce((i,n)=>{let[a,p]=n,d,y;return Array.isArray(p)?(y="",p.forEach(b=>{d=t?encodeURIComponent(b):b,y+=`${a}=${d}&`}),y.slice(0,-1)):(d=t?encodeURIComponent(p):p,y=`${a}=${d}`),`${i}&${y}`},"").substr(1):null,Jl=(e,t={})=>{let r=Object.assign({method:e.method||"GET",headers:e.headers},t),n=ql(e.headers)["content-type"]||"";if(typeof e.data=="string")r.body=e.data;else if(n.includes("application/x-www-form-urlencoded")){let a=new URLSearchParams;for(let[p,d]of Object.entries(e.data||{}))a.set(p,d);r.body=a.toString()}else if(n.includes("multipart/form-data")){let a=new FormData;if(e.data instanceof FormData)e.data.forEach((d,y)=>{a.append(y,d)});else for(let d of Object.keys(e.data))a.append(d,e.data[d]);r.body=a;let p=new Headers(r.headers);p.delete("content-type"),r.headers=p}else(n.includes("application/json")||typeof e.data=="object")&&(r.body=JSON.stringify(e.data));return r},Hl=class extends Ns{async request(e){let t=Jl(e,e.webFetchExtra),r=Vl(e.params,e.shouldEncodeUrlParams),i=r?`${e.url}?${r}`:e.url,n=await fetch(i,t),a=n.headers.get("content-type")||"",{responseType:p="text"}=n.ok?e:{};a.includes("application/json")&&(p="json");let d,y;switch(p){case"arraybuffer":case"blob":y=await n.blob(),d=await $l(y);break;case"json":d=await n.json();break;case"document":case"text":default:d=await n.text()}let b={};return n.headers.forEach((v,h)=>{b[h]=v}),{data:d,headers:b,status:n.status,url:n.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}},Ou=As("CapacitorHttp",{web:()=>new Hl})}});function Au(e){return new DataView(Uint8Array.from(e).buffer)}function Nu(e){return Array.from(new Uint8Array(e.buffer))}function Tu(e){return`0000${e.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function Ts(e){let t=e.trim().split(" ").filter(r=>r!=="").map(r=>parseInt(r,16));return Au(t)}function Lo(e){return Nu(e).map(t=>{let r=t.toString(16);return r.length==1&&(r="0"+r),r}).join(" ")}function Iu(e){if(typeof e=="string")return e;if(typeof e=="number")return Tu(e);throw new Error("Invalid UUID")}function Wl(e){let t={};if(e)return e.forEach((r,i)=>{t[i.toString()]=r}),t}var ia=Ps({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js"(){}});async function Fu(e,t,r){let i;return Promise.race([e,new Promise((n,a)=>{i=setTimeout(()=>a(r),t)})]).finally(()=>clearTimeout(i))}var Bu=Ps({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/timeout.js"(){}}),ac={};wu(ac,{BluetoothLeWeb:()=>lc});var lc,Cu=Ps({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/web.js"(){ra(),ia(),Bu(),lc=class extends Ns{constructor(){super(...arguments),this.deviceMap=new Map,this.discoveredDevices=new Map,this.scan=null,this.DEFAULT_CONNECTION_TIMEOUT=1e4,this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this),this.onDisconnectedCallback=this.onDisconnected.bind(this),this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if(typeof navigator>"u"||!navigator.bluetooth)throw this.unavailable("Web Bluetooth API not available in this browser.");if(!await navigator.bluetooth.getAvailability())throw this.unavailable("No Bluetooth radio available.")}async isEnabled(){return{value:!0}}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(e){let t=this.getFilters(e),r=await navigator.bluetooth.requestDevice({filters:t.length?t:void 0,optionalServices:e?.optionalServices,acceptAllDevices:t.length===0});return this.deviceMap.set(r.id,r),this.getBleDevice(r)}async requestLEScan(e){this.requestBleDeviceOptions=e;let t=this.getFilters(e);await this.stopLEScan(),this.discoveredDevices=new Map,navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback),this.scan=await navigator.bluetooth.requestLEScan({filters:t.length?t:void 0,acceptAllAdvertisements:t.length===0,keepRepeatedDevices:e?.allowDuplicates})}onAdvertisementReceived(e){var t,r;let i=e.device.id;if(this.deviceMap.set(i,e.device),!this.discoveredDevices.has(i)||!((t=this.requestBleDeviceOptions)===null||t===void 0)&&t.allowDuplicates){this.discoveredDevices.set(i,!0);let a=this.getBleDevice(e.device),p={device:a,localName:a.name,rssi:e.rssi,txPower:e.txPower,manufacturerData:Wl(e.manufacturerData),serviceData:Wl(e.serviceData),uuids:(r=e.uuids)===null||r===void 0?void 0:r.map(Iu)};this.notifyListeners("onScanResult",p)}}async stopLEScan(){var e;!((e=this.scan)===null||e===void 0)&&e.active&&this.scan.stop(),this.scan=null}async getDevices(e){return{devices:(await navigator.bluetooth.getDevices()).filter(i=>e.deviceIds.includes(i.id)).map(i=>(this.deviceMap.set(i.id,i),this.getBleDevice(i)))}}async getConnectedDevices(e){return{devices:(await navigator.bluetooth.getDevices()).filter(i=>{var n;return(n=i.gatt)===null||n===void 0?void 0:n.connected}).map(i=>(this.deviceMap.set(i.id,i),this.getBleDevice(i)))}}async connect(e){var t,r;let i=this.getDeviceFromMap(e.deviceId);i.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback),i.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);let n=Symbol();if(i.gatt===void 0)throw new Error("No gatt server available.");try{let a=(t=e.timeout)!==null&&t!==void 0?t:this.DEFAULT_CONNECTION_TIMEOUT;await Fu(i.gatt.connect(),a,n)}catch(a){throw await((r=i.gatt)===null||r===void 0?void 0:r.disconnect()),a===n?new Error("Connection timeout"):a}}onDisconnected(e){let r=`disconnected|${e.target.id}`;this.notifyListeners(r,null)}async createBond(e){throw this.unavailable("createBond is not available on web.")}async isBonded(e){throw this.unavailable("isBonded is not available on web.")}async disconnect(e){var t;(t=this.getDeviceFromMap(e.deviceId).gatt)===null||t===void 0||t.disconnect()}async getServices(e){var t,r;let i=(r=await((t=this.getDeviceFromMap(e.deviceId).gatt)===null||t===void 0?void 0:t.getPrimaryServices()))!==null&&r!==void 0?r:[],n=[];for(let a of i){let p=await a.getCharacteristics(),d=[];for(let y of p)d.push({uuid:y.uuid,properties:this.getProperties(y),descriptors:await this.getDescriptors(y)});n.push({uuid:a.uuid,characteristics:d})}return{services:n}}async getDescriptors(e){try{return(await e.getDescriptors()).map(r=>({uuid:r.uuid}))}catch{return[]}}getProperties(e){return{broadcast:e.properties.broadcast,read:e.properties.read,writeWithoutResponse:e.properties.writeWithoutResponse,write:e.properties.write,notify:e.properties.notify,indicate:e.properties.indicate,authenticatedSignedWrites:e.properties.authenticatedSignedWrites,reliableWrite:e.properties.reliableWrite,writableAuxiliaries:e.properties.writableAuxiliaries}}async getCharacteristic(e){var t;let r=await((t=this.getDeviceFromMap(e.deviceId).gatt)===null||t===void 0?void 0:t.getPrimaryService(e?.service));return r?.getCharacteristic(e?.characteristic)}async getDescriptor(e){let t=await this.getCharacteristic(e);return t?.getDescriptor(e?.descriptor)}async discoverServices(e){throw this.unavailable("discoverServices is not available on web.")}async getMtu(e){throw this.unavailable("getMtu is not available on web.")}async requestConnectionPriority(e){throw this.unavailable("requestConnectionPriority is not available on web.")}async readRssi(e){throw this.unavailable("readRssi is not available on web.")}async read(e){let t=await this.getCharacteristic(e);return{value:await t?.readValue()}}async write(e){let t=await this.getCharacteristic(e),r;typeof e.value=="string"?r=Ts(e.value):r=e.value,await t?.writeValueWithResponse(r)}async writeWithoutResponse(e){let t=await this.getCharacteristic(e),r;typeof e.value=="string"?r=Ts(e.value):r=e.value,await t?.writeValueWithoutResponse(r)}async readDescriptor(e){let t=await this.getDescriptor(e);return{value:await t?.readValue()}}async writeDescriptor(e){let t=await this.getDescriptor(e),r;typeof e.value=="string"?r=Ts(e.value):r=e.value,await t?.writeValue(r)}async startNotifications(e){let t=await this.getCharacteristic(e);t?.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),t?.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback),await t?.startNotifications()}onCharacteristicValueChanged(e){var t,r;let i=e.target,n=`notification|${(t=i.service)===null||t===void 0?void 0:t.device.id}|${(r=i.service)===null||r===void 0?void 0:r.uuid}|${i.uuid}`;this.notifyListeners(n,{value:i.value})}async stopNotifications(e){let t=await this.getCharacteristic(e);await t?.stopNotifications()}getFilters(e){var t;let r=[];for(let i of(t=e?.services)!==null&&t!==void 0?t:[])r.push({services:[i],name:e?.name,namePrefix:e?.namePrefix});return(e?.name||e?.namePrefix)&&r.length===0&&r.push({name:e.name,namePrefix:e.namePrefix}),r}getDeviceFromMap(e){let t=this.deviceMap.get(e);if(t===void 0)throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.');return t}getBleDevice(e){var t;return{deviceId:e.id,name:(t=e.name)!==null&&t!==void 0?t:void 0}}}}}),ju=Object.create,cc=Object.defineProperty,Lu=Object.getOwnPropertyDescriptor,fc=Object.getOwnPropertyNames,Du=Object.getPrototypeOf,Pu=Object.prototype.hasOwnProperty,Ru=(e=>typeof Vi<"u"?Vi:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof Vi<"u"?Vi:t)[r]}):e)(function(e){if(typeof Vi<"u")return Vi.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),Mu=(e,t)=>function(){return t||(0,e[fc(e)[0]])((t={exports:{}}).exports,t),t.exports},Uu=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of fc(t))!Pu.call(e,n)&&n!==r&&cc(e,n,{get:()=>t[n],enumerable:!(i=Lu(t,n))||i.enumerable});return e},zu=(e,t,r)=>(r=e!=null?ju(Du(e)):{},Uu(t||!e||!e.__esModule?cc(r,"default",{value:e,enumerable:!0}):r,e)),$u=Mu({"node_modules/web-worker/cjs/browser.js"(e,t){t.exports=Worker}}),qu=class{constructor(e){this.pushToState={},this.data={},this.triggers={},this.ctr=0,this.setState=t=>{Object.assign(this.data,t);let r=Object.getOwnPropertyNames(t);for(let i of r)this.triggerEvent(i,this.data[i]);if(this.triggers[vs]){let i=n=>{n(t)};this.triggers[vs].forEach(n=>{i(n.onchange)})}return this.data},this.setValue=(t,r)=>{this.data[t]=r,this.triggerEvent(t,r)},this.triggerEvent=(t,r)=>{if(this.triggers[t]){let i=n=>n.onchange(r,this.triggers[t]);this.triggers[t].forEach(i)}},this.subscribeState=t=>this.subscribeEvent(vs,t),this.unsubscribeState=t=>this.unsubscribeEvent(vs,t),this.subscribeEvent=(t,r,i,n)=>{if(t){i&&n&&!this.triggers[t]&&Object.defineProperty(this.data,t,{get:()=>i[n],set:p=>{i[n]=p},enumerable:!0,configurable:!0}),this.triggers[t]||(this.triggers[t]=[]);let a=this.ctr;return this.ctr++,this.triggers[t].push({sub:a,onchange:r}),a}else return},this.unsubscribeEvent=(t,r)=>{let i=this.triggers[t];if(i)if(r===void 0)delete this.triggers[t],delete this.data[t];else{let n,a=i.find((p,d)=>{if(p.sub===r)return n=d,!0});return a&&i.splice(n,1),Object.keys(i).length===0&&(delete this.triggers[t],delete this.data[t]),this.onRemoved&&this.onRemoved(a),!0}},this.subscribeEventOnce=(t,r)=>{let i,n=a=>{r(a),this.unsubscribeEvent(t,i)};return i=this.subscribeEvent(t,n),i},this.getEvent=(t,r)=>{for(let i in this.triggers[t])if(this.triggers[t][i].sub===r)return this.triggers[t][i]},this.getSnapshot=()=>{let t={};for(let r in this.data)t[r]=this.data[r]},typeof e=="object"&&(this.data=e)}},vs="*s",uc=new qu,It=class{constructor(e,t,r){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:uc},this.__setProperties=(i,n,a)=>{if((()=>{let d=i;typeof i=="function"?Wo(i)?i=new i:i={__operator:i,__node:{forward:!0,tag:i.name}}:typeof i=="string"&&a?.get(i)&&(i=a.get(i)),"__node"in i||(i.__node={}),i.__node.initial||(i.__node.initial=d)})(),typeof i=="object"){let d=()=>{i.__node?.state?this.__node.state=i.__node.state:a&&(i.__node.state=a.__node.state)},y=()=>{i.__props&&(typeof i.__props=="function"&&(i.__props=new i.__props),typeof i.__props=="object"&&this.__proxyObject(i.__props))},b=()=>{i.__node.tag||(i.__operator?.name?i.__node.tag=i.__operator.name:i.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},v=()=>{typeof i.__node=="string"?a?.get(i.__node.tag)?i=a.get(i.__node.tag):i.__node={}:i.__node||(i.__node={}),a&&(i.__node.graph=a),i instanceof wi&&(i.__node.source=i)},h=()=>{if(!i.__parent&&n&&(i.__parent=n),n?.__node&&!(n instanceof wi||i instanceof wi)&&(i.__node.tag=n.__node.tag+"."+i.__node.tag),n instanceof wi&&i instanceof wi&&(i.__node.loaders&&Object.assign(n.__node.loaders?n.__node.loaders:{},i.__node.loaders),n.__node.mapGraphs)){i.__node.nodes.forEach(I=>{n.set(i.__node.tag+"."+I.__node.tag,I)});let C=()=>{i.__node.nodes.forEach(I=>{n.__node.nodes.delete(i.__node.tag+"."+I.__node.tag)})};this.__addOndisconnected(C)}},w=()=>{if(typeof i.default=="function"&&!i.__operator&&(i.__operator=i.default),i.__operator){if(typeof i.__operator=="string"&&a){let C=a.get(i.__operator);C&&(i.__operator=C.__operator),!i.__node.tag&&i.__operator.name&&(i.__node.tag=i.__operator.name)}typeof i.__operator=="function"&&(i.__operator=this.__setOperator(i.__operator)),i.default&&(i.default=i.__operator)}},_=()=>{i.__node=Object.assign(this.__node,i.__node);let C=Object.getOwnPropertyNames(i);for(let I of C)I in i&&(this[I]=i[I])},T=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(C=>C.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(C=>C.bind(this))))};d(),b(),y(),v(),h(),_(),T(),w()}},this.__subscribe=(i,n,a,p,d,y)=>{let b=(h,w=(T,C)=>C||T,_=i)=>{y&&(_=Go(_,y,this.__node.graph));let T=this.__node.state.subscribeEvent(h,_,this,n),C=this.__node.state.getEvent(h,T);return this.__listeners||(this.__listeners={}),this.__listeners[h]=this.__node.state.triggers[h],C&&(C.source=this.__node.tag,n&&(C.key=n),C.target=w(i,p),a&&(C.subInput=a),y&&(C.__args=y),d&&(C.tkey=d)),T},v=h=>{let w=this.__node.graph.get(h);if(!w&&h.includes(".")){p=h.substring(0,h.lastIndexOf("."));let _=this.__node.graph.get(h.substring(0,p));d=h.lastIndexOf(".")+1,_&&typeof _[n]=="function"&&(h=(...T)=>_[d](...T))}else w.__operator&&(h=w.__operator,d="__operator")};if(n){if((!this.__node.localState||!this.__node.localState[n])&&this.__addLocalState(this,n),typeof i=="string"){if(d=i,p){if(this.__node.graph?.get(p)){let _=this.__node.graph?.get(p);if(typeof _[i]=="function"){let T=_[i];i=(...C)=>{T(...C)}}else{let T=i;i=I=>{_[T]=I}}}}else if(typeof this[i]=="function"){let _=this[i];i=(...T)=>{_(...T)}}else this.__node.graph?.get(i)&&v(i);if(typeof i!="function")return}let h,w=a?this.__node.unique+"."+n+"input":this.__node.unique+"."+n;return typeof i=="function"?h=b(w,(_,T)=>T||_,i):i?.__node&&(h=b(w,(_,T)=>T||_.__node.unique,(..._)=>{i.__operator&&i.__operator(..._)})),h}else{if(typeof i=="string"&&(this.__node.graph.get(i)&&(i=this.__node.graph.get(i)),d="__operator",typeof i!="object"))return;let h,w=a?this.__node.unique+"input":this.__node.unique;return typeof i=="function"?h=b(w,(_,T)=>T||_,i):i?.__node&&(h=b(w,(_,T)=>T||_.__node.unique,(..._)=>{i.__operator&&i.__operator(..._)})),h}},this.__unsubscribe=(i,n,a)=>n?this.__node.state.unsubscribeEvent(a?this.__node.unique+"."+n+"input":this.__node.unique+"."+n,i):this.__node.state.unsubscribeEvent(a?this.__node.unique+"input":this.__node.unique,i),this.__setOperator=i=>{i=i.bind(this),this.__args&&this.__node.graph&&(i=Go(i,this.__args,this.__node.graph));let n=`${this.__node.unique}input`;if(this.__operator=(...a)=>{this.__node.state.triggers[n]&&this.__node.state.setValue(n,a);let p=i(...a);return this.__node.state.triggers[this.__node.unique]&&(typeof p?.then=="function"?p.then(d=>{d!==void 0&&this.__node.state.setValue(this.__node.unique,d)}).catch(console.error):p!==void 0&&this.__node.state.setValue(this.__node.unique,p)),p},this.__parent instanceof It&&!this.__subscribedToParent&&this.__parent.__operator){let a=this.__parent.__subscribe(this),p=()=>{this.__parent?.__unsubscribe(a),delete this.__subscribedToParent};this.__addOndisconnected(p),this.__subscribedToParent=!0}return this.__operator},this.__addLocalState=(i,n)=>{if(!i)return;this.__node.localState||(this.__node.localState={});let a=this.__node.localState,p=(d,y)=>{let b=this.__node.unique+"."+y,v=`${b}input`;if(typeof d[y]=="function"&&y!=="__operator"){let h=d[y].bind(this);d[y]=(...w)=>{this.__node.state.triggers[v]&&this.__node.state.setValue(v,w);let _=h(...w);return this.__node.state.triggers[b]&&(typeof _?.then=="function"?_.then(T=>{this.__node.state.triggerEvent(b,T)}).catch(console.error):this.__node.state.triggerEvent(b,_)),_}}else{let h,w;this.__props?.[y]?(h=()=>this.__props[y],w=T=>{this.__props[y]=T,this.__node.state.triggers[b]&&this.__node.state.triggerEvent(b,T)}):(a[y]=d[y],h=()=>a[y],w=T=>{a[y]=T,this.__node.state.triggers[b]&&this.__node.state.triggerEvent(b,T)});let _={get:h,set:w,enumerable:!0,configurable:!0};if(Object.defineProperty(d,y,_),typeof this.__node.initial=="object"){let T=Object.getOwnPropertyDescriptor(this.__node.initial,y);(T===void 0||T?.configurable)&&Object.defineProperty(this.__node.initial,y,_)}}};if(n)p(i,n);else for(let d in i)p(i,d)},this.__proxyObject=i=>{let n=Vu(i);for(let a of n)if(typeof i[a]=="function")this[a]=(...p)=>i[a](...p);else{let p={get:()=>i[a],set:d=>{i[a]=d},enumerable:!0,configurable:!0};if(Object.defineProperty(this,a,p),typeof this.__node.initial=="object"){let d=Object.getOwnPropertyDescriptor(this.__node.initial,a);(d===void 0||d?.configurable)&&Object.defineProperty(this.__node.initial,a,p)}}},this.__setProperties(e,t,r)}__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=r=>{r(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=r=>{r(this)};this.__ondisconnected.forEach(t)}}},wi=class{constructor(e){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:uc,roots:{}},this.init=t=>{if(t){let r=Object.assign({},t);delete r.roots,Ho(this.__node,r),t.roots&&this.load(t.roots)}},this.load=t=>{function r(a,p,d=!0,y=!0){if(y&&(a?Object.assign(a,p):a=Object.assign({},p),r(a,p,!0,!1)),p.__children&&!d)p.__children?.constructor.name==="Object"?a.__children?.constructor.name==="Object"?r(a.__children,p.__children,!0,!1):a.__children=r({},p.__children,!0,!1):a.__children=p.__children;else if(d)for(let b in p)a[b]=Object.assign({},p[b]),p[b].__children&&r({},p[b].__children,!1,!1);return a}this.__node.roots=r(this.__node.roots?this.__node.roots:{},t);let i=Object.assign({},t);i.__node&&delete i.__node;let n=this.recursiveSet(i,this,void 0,t);if(t.__node){if(!t.__node.tag)t.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(t.__node.tag)){let a=new It(t,this,this);this.set(a.__node.tag,a),this.runLoaders(a,this,t,t.__node.tag),a.__listeners&&(n[a.__node.tag]=a.__listeners)}}else t.__listeners&&this.setListeners(t.__listeners);return this.setListeners(n),i},this.setLoaders=(t,r)=>(r?this.__node.loaders=t:Object.assign(this.__node.loaders,t),this.__node.loaders),this.runLoaders=(t,r,i,n)=>{for(let a in this.__node.loaders)typeof this.__node.loaders[a]=="object"?(this.__node.loaders[a].init&&this.__node.loaders[a](t,r,this,this.__node.roots,i,n),this.__node.loaders[a].connected&&t.__addOnconnected(this.__node.loaders[a].connect),this.__node.loaders[a].disconnected&&t.__addOndisconnected(this.__node.loaders[a].disconnect)):typeof this.__node.loaders[a]=="function"&&this.__node.loaders[a](t,r,this,this.__node.roots,i,n)},this.add=(t,r)=>{let i={};typeof r=="string"&&(r=this.get(r));let n;if(typeof t=="function"?Wo(t)?t.prototype instanceof It?(t=t.prototype.constructor(t,r,this),n=!0):t=new t:t={__operator:t}:typeof t=="string"&&(t=this.__node.roots[t]),!!t){if(!n){let a=Object.getOwnPropertyNames(t),p=Object.getOwnPropertyNames(Object.getPrototypeOf(t));p.splice(p.indexOf("constructor"),1),a.push(...p);let d={};for(let y of a)d[y]=t[y];t=d}if(t.__node||(t.__node={}),t.__node.initial=t,typeof t=="object"&&!this.get(t.__node.tag)){let a;if(n?a=t:a=new It(t,r,this),this.set(a.__node.tag,a),this.runLoaders(a,r,t,a.__node.tag),this.__node.roots[a.__node.tag]=t,a.__children&&(a.__children=Object.assign({},a.__children),this.recursiveSet(a.__children,a,i,a.__children)),a.__listeners){i[a.__node.tag]=Object.assign({},a.__listeners);for(let p in a.__listeners){let d=a.__listeners[p];a[p]&&(delete i[a.__node.tag][p],i[a.__node.tag][a.__node.tag+"."+p]=d),typeof d=="string"&&(a.__children?.[d]?i[a.__node.tag][p]=a.__node.tag+"."+d:r instanceof It&&(r.__node.tag===d||r.__node.tag.includes(".")&&r.__node.tag.split(".").pop()===d)&&(i[a.__node.tag][p]=r.__node.tag))}}return this.setListeners(i),a.__callConnected(),a}}},this.recursiveSet=(t,r,i={},n)=>{let a=Object.getOwnPropertyNames(n),p=Object.getOwnPropertyNames(Object.getPrototypeOf(n));p.splice(p.indexOf("constructor"),1),a.push(...p);for(let d of a){if(d.includes("__"))continue;let y=n[d];if(Array.isArray(y))continue;let b;if(typeof y=="function"?Wo(y)?(y=new y,y instanceof It&&(y=y.prototype.constructor(y,r,this),b=!0)):y={__operator:y}:typeof y=="string"?this.__node.nodes.get(y)?y=this.__node.nodes.get(y):y=this.__node.roots[y]:typeof y=="boolean"&&(this.__node.nodes.get(d)?y=this.__node.nodes.get(d):y=this.__node.roots[d]),typeof y=="object"){if(!b&&!(y instanceof It)){let w=Object.getOwnPropertyNames(y),_=Object.getOwnPropertyNames(Object.getPrototypeOf(y));_.splice(_.indexOf("constructor"),1),w.push(..._);let T={};for(let C of w)T[C]=y[C];y=T}if(y.__node||(y.__node={}),y.__node.tag||(y.__node.tag=d),y.__node.initial||(y.__node.initial=t[d]),this.get(y.__node.tag)&&!(!(r instanceof wi)&&r?.__node)||r?.__node&&this.get(r.__node.tag+"."+y.__node.tag))continue;let v,h=!1;if(b||y instanceof It?v=y:(v=new It(y,r,this),h=!0),!h&&y instanceof It&&!b&&r instanceof It){let w=this.subscribe(r.__node.tag,v.__node.tag),_=T=>{this.unsubscribe(r.__node.tag,w)};v.__addOndisconnected(_)}else if(v){if(this.set(v.__node.tag,v),this.runLoaders(v,r,t[d],d),t[d]=v,this.__node.roots[v.__node.tag]=y,v.__children&&(v.__children=Object.assign({},v.__children),this.recursiveSet(v.__children,v,i,v.__children)),v.__listeners){i[v.__node.tag]=Object.assign({},v.__listeners);for(let w in v.__listeners){let _=v.__listeners[w],T=w;v[w]&&(delete i[v.__node.tag][w],T=v.__node.tag+"."+w,i[v.__node.tag][T]=_),typeof _=="string"&&(v.__children?.[_]?i[v.__node.tag][T]=v.__node.tag+"."+_:r instanceof It&&(r.__node.tag===_||r.__node.tag.includes(".")&&r.__node.tag.split(".").pop()===_)&&(i[v.__node.tag][T]=r.__node.tag))}}v.__callConnected()}}}return i},this.remove=(t,r=!0)=>{if(this.unsubscribe(t),typeof t=="string"&&(t=this.get(t)),t instanceof It){this.delete(t.__node.tag),delete this.__node.roots[t.__node.tag],r&&this.clearListeners(t),t.__callDisconnected();let i=n=>{for(let a in n)this.unsubscribe(n[a]),this.delete(n[a].__node.tag),delete this.__node.roots[n[a].__node.tag],this.delete(a),delete this.__node.roots[a],n[a].__node.tag=n[a].__node.tag.substring(n[a].__node.tag.lastIndexOf(".")+1),r&&this.clearListeners(n[a]),n[a].__callDisconnected(),n[a].__children&&i(n[a].__children)};t.__children&&i(t.__children)}return t?.__node.tag&&t?.__parent&&(delete t?.__parent,t.__node.tag=t.__node.tag.substring(t.__node.tag.indexOf(".")+1)),t?.__node.graph&&(t.__node.graph=void 0),t},this.run=(t,...r)=>{if(typeof t=="string"){let i=this.get(t);if(!i&&t.includes(".")){if(i=this.get(t.substring(0,t.lastIndexOf("."))),typeof i?.[t.substring(t.lastIndexOf(".")+1)]=="function")return i[t.substring(t.lastIndexOf(".")+1)](...r)}else if(i?.__operator)return i.__operator(...r)}if(t?.__operator)return t?.__operator(...r)},this.setListeners=t=>{for(let r in t){let i=this.get(r);if(i&&typeof t[r]=="object")for(let n in t[r]){let a=this.get(n),p;if(typeof t[r][n]!="object")t[r][n]={__callback:t[r][n]};else if(!t[r][n].__callback)for(let d in t[r][n]){typeof t[r][n][d]!="object"&&(t[r][n][d]={__callback:t[r][n][d]},i.__operator&&(t[r][n][d].__callback===!0||typeof t[r][n][d].__callback>"u")&&(t[r][n][d].__callback=i.__operator));let y=this.get(d);if(y)p=this.subscribe(y,t[r][n][d].__callback,t[r][n].__args,void 0,t[r][n].inputState,r,n);else{let b=n.substring(0,n.lastIndexOf("."));if(y=this.get(b),y){let v=n.substring(n.lastIndexOf(".")+1);p=this.subscribe(y,t[r][n][d].__callback,t[r][n][d].__args,v,t[r][n][d].inputState,r,n)}}}if("__callback"in t[r][n])if((t[r][n].__callback===!0||typeof t[r][n].__callback>"u")&&(t[r][n].__callback=i.__operator),typeof t[r][n].__callback=="function"&&(t[r][n].__callback=t[r][n].__callback.bind(i)),a)p=this.subscribe(a,t[r][n].__callback,t[r][n].__args,void 0,t[r][n].inputState,r,n);else{let d=n.substring(0,n.lastIndexOf("."));a=this.get(d),a&&(p=this.subscribe(a,t[r][n].__callback,t[r][n].__args,n.substring(n.lastIndexOf(".")+1),t[r][n].inputState,r,n))}}}},this.clearListeners=(t,r)=>{if(typeof t=="string"&&(t=this.get(t)),t?.__listeners)for(let i in t.__listeners){if(r&&i!==r||typeof t.__listeners[i]?.sub!="number")continue;let n=this.get(i);if(n)if(typeof!t.__listeners[i]?.__callback=="number")for(let a in t.__listeners[i])t.__listeners[i][a]?.sub&&(this.unsubscribe(n,t.__listeners[i][a].sub,void 0,t.__listeners[i][a].inputState),t.__listeners[i][a].sub=void 0);else typeof t.__listeners[i]?.sub=="number"&&(this.unsubscribe(n,t.__listeners[i].sub,void 0,t.__listeners[i].inputState),t.__listeners[i].sub=void 0);else if(n=this.get(i.substring(0,i.lastIndexOf("."))),n)if(typeof t.__listeners[i]=="object"&&!t.__listeners[i]?.__callback)for(let a in t.__listeners[i])typeof t.__listeners[i][a]?.sub=="number"&&(this.unsubscribe(n,t.__listeners[i][a].sub,i.substring(i.lastIndexOf(".")+1),t.__listeners[i][a].inputState),t.__listeners[i][a].sub=void 0);else typeof t.__listeners[i]?.sub=="number"&&(this.unsubscribe(n,t.__listeners[i].sub,i.substring(i.lastIndexOf(".")+1),t.__listeners[i].inputState),t.__listeners[i].sub=void 0)}},this.get=t=>this.__node.nodes.get(t),this.set=(t,r)=>this.__node.nodes.set(t,r),this.delete=t=>this.__node.nodes.delete(t),this.getProps=(t,r)=>{if(typeof t=="string"&&(t=this.get(t)),t instanceof It){let i;if(r)i=Object.assign({},this.__node.roots[t.__node.tag]);else{i=Object.assign({},t);for(let n in i)n.includes("__")&&delete i[n]}}},this.subscribe=(t,r,i,n,a,p,d,y)=>{let b=t;if(typeof t=="string"&&(b=this.get(t),!b&&t.includes(".")&&(b=this.get(t.substring(0,t.lastIndexOf("."))),n=t.substring(t.lastIndexOf(".")+1))),p instanceof It&&(p=p.__node.tag),typeof r=="string"){let h=w=>{if(this.get(w)?.__operator){let _=this.get(w);p=w,w=function(...T){return _.__operator(...T)}}else if(w.includes(".")){p=w.substring(0,w.lastIndexOf("."));let _=this.get(p),T=w.substring(w.lastIndexOf(".")+1);y=T,typeof _[T]=="function"?_[T]instanceof It?w=_[T]:w=function(...C){return _[T](...C)}:w=function(C){return _[T]=C,_[T]}}return w};if(p){let w=this.get(p);typeof w?.[r]=="function"?(y=r,r=function(..._){return w[n](..._)}):w[n]?(y=n,w[n]instanceof It?r=w[n]:r=function(_){return w[n]=_,w[n]}):r=h(r)}else r=h(r)}let v;if(b instanceof It){let h=()=>{v=b.__subscribe(r,n,a,p,y,i);let w=()=>{v!==void 0&&b.__unsubscribe(v,n,a),v=void 0};b.__addOndisconnected(()=>{w(),b.__addOnconnected(()=>{v===void 0&&b.__node.graph.__node.tag===this.__node.tag&&h()})}),typeof r=="string"&&this.get(r)&&(r=this.get(r)),r instanceof It&&r.__addOndisconnected(()=>{w()})};h()}else if(typeof t=="string"){let h=this.get(t);if(h){if(r instanceof It&&r.__operator){let w=()=>{v=h.__subscribe(r.__operator,n,a,p,y,i);let _=()=>{v!==void 0&&h.__unsubscribe(v,n,a)};h.__addOndisconnected(()=>{_(),h.__addOnconnected(()=>{v===void 0&&h.__node.graph.__node.tag===this.__node.tag&&w()})}),r.__addOndisconnected(_)};w()}else if(typeof r=="function"||typeof r=="string"){let w=()=>{v=h.__subscribe(r,n,a,p,y,i);let _=()=>{v!==void 0&&h.__unsubscribe(v,n,a),v=void 0};h.__addOndisconnected(()=>{_(),h.__addOnconnected(()=>{v===void 0&&h.__node.graph.__node.tag===this.__node.tag&&w()})}),typeof r=="string"&&this.get(r)&&this.get(r).__addOndisconnected(_)};w()}}else typeof r=="string"&&(r=this.__node.nodes.get(r).__operator),typeof r=="function"&&(v=this.__node.state.subscribeEvent(t,r))}return v},this.unsubscribe=(t,r,i,n)=>t instanceof It?t.__unsubscribe(r,i,n):this.get(t)?.__unsubscribe(r,i,n),this.setState=t=>{this.__node.state.setState(t)},this.init(e)}};function Ho(e,t){for(let r in t)t[r]?.constructor.name==="Object"?e[r]?.constructor.name==="Object"?Ho(e[r],t[r]):e[r]=Ho({},t[r]):e[r]=t[r];return e}function Vu(e){var t=[],r=e;do{var i=Object.getOwnPropertyNames(r);let n=function(a){t.indexOf(a)===-1&&t.push(a)};i.forEach(n)}while(r=Object.getPrototypeOf(r));return t}function Wo(e){return Ju(e)==="class"}function Ju(e){return typeof e=="function"?e.prototype?Object.getOwnPropertyDescriptor(e,"prototype")?.writable?"function":"class":e.constructor.name==="AsyncFunction"?"async":"arrow":""}var Go=(e,t,r)=>{let i=[],n=d=>{if(r.get(d)?.__operator){let y=r.get(d);return(...b)=>{y.__operator(...b)}}else if(d.includes(".")){let y=d.split("."),b=y.pop(),v=y.join("."),h=r.get(v);return typeof r.get(v)?.[b]=="function"?(...w)=>h[b](...w):()=>h[b]}else if(r.get(d)){let y=r.get(d);return()=>y}else{let y=d;return()=>y}},a=(d,y)=>{if(d==="__output"||d==="__input")i[y]=b=>b;else if(typeof d=="string")i[y]=n(d);else if(typeof d=="function"){let b=d;i[y]=(...v)=>b(...v)}else if(typeof d=="object"&&d.__input){let b=function(v){let h=v.__input;if(typeof v.__input=="string"&&(h=n(v.__input)),v.__args&&(h=Go(h,v.__args,r)),v.__output){let w=v.__output;if(typeof v.__output=="string"?w=n(w):typeof d.__output=="object"&&(w=b(w)),typeof w=="function"){let _=h;h=(...T)=>w(_(...T))}}return h};i[y]=b(d)}else{let b=d;i[y]=()=>b}};t.forEach(a),typeof e=="string"&&(e=n(e));let p=e;return e=function(...d){let y=b=>b(...d);return p(...i.map(y))},e},Hu=(e,t,r)=>{e.__node.backward&&t instanceof It&&r.setListeners({[t.__node.tag]:{[e.__node.tag]:t}})},Wu=(e,t,r)=>{if(e.__operator&&!e.__node.looperSet){if(typeof e.__node.delay=="number"){let i=e.__operator;e.__setOperator((...n)=>new Promise((a,p)=>{setTimeout(async()=>{a(await i(...n))},e.__node.delay)}))}else if(e.__node.frame===!0){let i=e.__operator;e.__setOperator((...n)=>new Promise((a,p)=>{requestAnimationFrame(async()=>{a(await i(...n))})}))}if(typeof e.__node.repeat=="number"||typeof e.__node.recursive=="number"){let i=e.__operator;e.__setOperator(async(...n)=>{let a=e.__node.repeat?e.__node.repeat:e.__node.recursive,p,d=async(y,...b)=>{for(;y>0;){if(e.__node.delay||e.__node.frame){i(...b).then(async v=>{e.__node.recursive?await d(y,v):await d(y,...b)});break}else p=await i(...n);y--}};return await d(a,...n),p})}if(e.__node.loop&&typeof e.__node.loop=="number"){e.__node.looperSet=!0;let i=e.__operator,n=e.__node.loop;e.__setOperator((...p)=>{if("looping"in e.__node||(e.__node.looping=!0),e.__node.looping){let d=performance.now();i(...p),setTimeout(()=>{let b=performance.now()-d-e.__node.loop;b>0?n=e.__node.loop-b:n=e.__node.loop,n<=0&&(n=e.__node.loop),e.__operator(...p)},n)}}),e.__node.looping&&e.__operator();let a=p=>{p.__node.looping&&(p.__node.looping=!1)};e.__addOndisconnected(a)}}},Gu=(e,t,r)=>{if(e.__node.animate===!0||e.__animation){let i=e.__operator;e.__setOperator((...a)=>{"animating"in e.__node||(e.__node.animating=!0),e.__node.animating&&(typeof e.__animation=="function"?e.__animation(...a):i(...a),requestAnimationFrame(()=>{e.__operator(...a)}))}),(e.__node.animating||(!("animating"in e.__node)||e.__node.animating)&&e.__animation)&&setTimeout(()=>{requestAnimationFrame(e.__operator)},10);let n=a=>{a.__node.animating&&(a.__node.animating=!1)};e.__addOndisconnected(n)}},Yu=(e,t,r)=>{if(typeof e.__branch=="object"&&e.__operator&&!e.__branchApplied){let i=e.__operator;e.__branchApplied=!0,e.__operator=(...n)=>{let a=i(...n);for(let p in e.__branch){let d=()=>{typeof e.__branch[p].then=="function"?e.__branch[p].then(a):e.__branch[p].then instanceof It&&e.__branch[p].then.__operator?e.__branch[p].then.__operator(a):a=e.__branch[p].then};typeof e.__branch[p].if=="function"?e.__branch[p].if(a)==!0&&d():e.__branch[p].if===a&&d()}return a}}if(e.__listeners){for(let i in e.__listeners)if(typeof e.__listeners[i]=="object"&&e.__listeners[i].branch&&!e.__listeners[i].branchApplied){let n=e.__listeners[i].callback;e.__listeners[i].branchApplied=!0,e.__listeners.callback=a=>{let p=()=>{typeof e.__listeners[i].branch.then=="function"?a=e.__listeners[i].branch.then(a):e.__listeners[i].branch.then instanceof It&&e.__listeners[i].branch.then.__operator?a=e.__listeners[i].branch.then.__operator(a):a=e.__listeners[i].branch.then};return typeof e.__listeners[i].branch.if=="function"?e.__listeners[i].branch.if(a)&&p():e.__listeners[i].branch.if===a&&p(),n(a)}}}},Xu=(e,t,r)=>{if(e.__listeners)for(let i in e.__listeners)typeof e.__listeners[i]=="object"&&e.__listeners[i].oncreate&&e.__listeners[i].callback(e.__listeners[i].oncreate)},Ku=(e,t,r)=>{if(e.__listeners)for(let i in e.__listeners)typeof e.__listeners[i]=="object"&&typeof e.__listeners[i].binding=="object"&&(e.__listeners.callback=e.__listeners.callback.bind(e.__listeners[i].binding))},Zu=(e,t,r)=>{if(e.__listeners){for(let i in e.__listeners)if(typeof e.__listeners[i]=="object"&&typeof e.__listeners[i].transform=="function"&&!e.__listeners[i].transformApplied){let n=e.__listeners[i].callback;e.__listeners[i].transformApplied=!0,e.__listeners.callback=a=>(a=e.__listeners[i].transform(a),n(a))}}},Qu=(e,t,r)=>{e.post&&!e.__operator?e.__setOperator(e.post):!e.__operator&&typeof e.get=="function"&&e.__setOperator(e.get),!e.get&&e.__operator&&(e.get=e.__operator),e.aliases&&e.aliases.forEach(i=>{r.set(i,e);let n=a=>{r.__node.nodes.delete(i)};e.__addOndisconnected(n)}),typeof r.__node.roots?.[e.__node.tag]=="object"&&e.get&&(r.__node.roots[e.__node.tag].get=e.get)},Gl={backprop:Hu,loop:Wu,animate:Gu,branching:Yu,triggerListenerOncreate:Xu,bindListener:Ku,transformListenerResult:Zu,substitute__operator:Qu},Yo=e=>{let t={};for(let r in e)typeof e[r]=="object"?t[r]=Yo(e[r]):typeof e[r]=="function"?t[r]=e[r].toString():t[r]=e[r];return t};function Wi(e=""){let t=p=>p.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),i=(p=>{let d=p.indexOf("=>")+1;return d<=0&&(d=p.indexOf("){")),d<=0&&(d=p.indexOf(") {")),p.slice(0,p.indexOf("{",d)+1)})(e),n=t(e),a;if(i.includes("function")){let p=i.split("(")[1].split(")")[0];a=new Function(p,n)}else if(i.substring(0,6)===n.substring(0,6)){let p=i.split("(")[1].split(")")[0];a=new Function(p,n.substring(n.indexOf("{")+1,n.length-1))}else try{a=(0,eval)(e)}catch{}return a}var ed=function(){let e=new Map,t=[],r=["this"];function i(){e.clear(),t.length=0,r.length=1}function n(p,d){var y=t.length-1,b=t[y];if(typeof b=="object")if(b[p]===d||y===0)r.push(p),t.push(d.pushed);else for(;y-->=0;){if(b=t[y],typeof b=="object"&&b[p]===d){y+=2,t.length=y,r.length=y,--y,t[y]=d,r[y]=p;break}y--}}function a(p,d){if(d!=null&&typeof d=="object"){p&&n(p,d);let y=e.get(d);if(y)return"[Circular Reference]"+y;e.set(d,r.join("."))}return d}return function(d,y){try{return t.push(d),JSON.stringify(d,a,y)}finally{i()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=ed);var td=function(){let e=new Map,t=[],r=["this"];function i(){e.clear(),t.length=0,r.length=1}function n(p,d){var y=t.length-1;if(t[y]){var b=t[y];if(typeof b=="object")if(b[p]===d||y===0)r.push(p),t.push(d.pushed);else for(;y-->=0;){if(b=t[y],typeof b=="object"&&b[p]===d){y+=2,t.length=y,r.length=y,--y,t[y]=d,r[y]=p;break}y++}}}function a(p,d){let y;if(d!=null)if(typeof d=="object"){let b=d.constructor.name;p&&b==="Object"&&n(p,d);let v=e.get(d);if(v)return"[Circular Reference]"+v;if(e.set(d,r.join(".")),b==="Array")d.length>20?y=d.slice(d.length-20):y=d;else if(b.includes("Set"))y=Array.from(d);else if(b!=="Object"&&b!=="Number"&&b!=="String"&&b!=="Boolean")y="instanceof_"+b;else if(b==="Object"){let h={};for(let w in d)if(d[w]==null)h[w]=d[w];else if(Array.isArray(d[w]))d[w].length>20?h[w]=d[w].slice(d[w].length-20):h[w]=d[w];else if(d[w].constructor.name==="Object"){h[w]={};for(let _ in d[w])if(Array.isArray(d[w][_]))d[w][_].length>20?h[w][_]=d[w][_].slice(d[w][_].length-20):h[w][_]=d[w][_];else if(d[w][_]!=null){let T=d[w][_].constructor.name;T.includes("Set")?h[w][_]=Array.from(d[w][_]):T!=="Number"&&T!=="String"&&T!=="Boolean"?h[w][_]="instanceof_"+T:h[w][_]=d[w][_]}else h[w][_]=d[w][_]}else{let _=d[w].constructor.name;_.includes("Set")?h[w]=Array.from(d[w]):_!=="Number"&&_!=="String"&&_!=="Boolean"?h[w]="instanceof_"+_:h[w]=d[w]}y=h}else y=d}else y=d;return y}return function(d,y){t.push(d);let b=JSON.stringify(d,a,y);return i(),b}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=td);function Yl(e){if(typeof e.__methods=="object")for(let t in e.__methods){let r=e.__methods[t],i=typeof r=="function"?r:Wi(r);t==="__operator"?e.__setOperator(i):e[t]=i.bind(e)}}var dc=class extends wi{constructor(e){super({...e,loaders:e?.loaders?Object.assign({...Gl},e.loaders):{...Gl}}),this.name=`service${Math.floor(Math.random()*1e15)}`,this.addServices=t=>{for(let r in t)if(typeof t[r]=="function"&&(t[r]=new t[r]),t[r]?.__node?.loaders&&Object.assign(this.__node.loaders,t[r].__node.loaders),t[r]?.__node?.nodes){t[r].__node.nodes.forEach((a,p)=>{this.get(p)?this.set(r+"."+p,a):this.set(p,a)}),this.__node.nodes.forEach((a,p)=>{t[r].__node.nodes.get(p)||t[r].__node.nodes.set(p,a)});let i=this.set;this.set=(a,p)=>(t[r].set(a,p),i(a,p));let n=this.delete;this.delete=a=>(t[r].delete(a),n(a))}else typeof t[r]=="object"&&this.load(t[r])},this.handleMethod=(t,r,i)=>{let n=r.toLowerCase(),a=this.__node.nodes.get(t);if(a||(a=this.__node.roots[t]),a?.[n])if(typeof a[n]!="function"){if(i){Array.isArray(i)&&i.length===1?a[n]=i[0]:a[n]=i;return}return a[n]}else return Array.isArray(i)?a[n](...i):a[n](i);else return this.handleServiceMessage({route:t,args:i,method:r})},this.transmit=(...t)=>typeof t[0]=="object"?t[0].method?this.handleMethod(t[0].route,t[0].method,t[0].args):t[0].route?this.handleServiceMessage(t[0]):t[0].node?this.handleGraphNodeCall(t[0].node,t[0].args):(this.__node.keepState&&(t[0].route&&this.setState({[t[0].route]:t[0].args}),t[0].node&&this.setState({[t[0].node]:t[0].args})),t):t,this.receive=(...t)=>{if(t[0]&&typeof t[0]=="string"){let r=t[0].substring(0,8);(r.includes("{")||r.includes("["))&&(r.includes("\\")&&(t[0]=t[0].replace(/\\/g,"")),t[0][0]==='"'&&(t[0]=t[0].substring(1,t[0].length-1)),t[0]=JSON.parse(t[0]))}return typeof t[0]=="object"?t[0].method?this.handleMethod(t[0].route,t[0].method,t[0].args):t[0].route?this.handleServiceMessage(t[0]):t[0].node?this.handleGraphNodeCall(t[0].node,t[0].args):(this.__node.keepState&&(t[0].route&&this.setState({[t[0].route]:t[0].args}),t[0].node&&this.setState({[t[0].node]:t[0].args})),t):t},this.pipe=(t,r,i,n,a)=>{if(t instanceof It)return a?this.subscribe(t,p=>{let d=a(p);d!==void 0?this.transmit({route:r,args:d,method:n}):this.transmit({route:r,args:p,method:n},i)}):this.subscribe(t,p=>{this.transmit({route:r,args:p,method:n},i)});if(typeof t=="string")return this.subscribe(t,p=>{this.transmit({route:r,args:p,method:n},i)})},this.pipeOnce=(t,r,i,n,a)=>{if(t instanceof It)return a?t.__node.state.subscribeEventOnce(t.__node.unique,p=>{let d=a(p);d!==void 0?this.transmit({route:r,args:d,method:n}):this.transmit({route:r,args:p,method:n},i)}):this.__node.state.subscribeEventOnce(t.__node.unique,p=>{this.transmit({route:r,args:p,method:n},i)});if(typeof t=="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(t).__node.unique,p=>{this.transmit({route:r,args:p,method:n},i)})},this.terminate=(...t)=>{},this.isTypedArray=rd,this.recursivelyAssign=js,this.spliceTypedArray=id,this.ping=()=>(console.log("pinged!"),"pong"),this.echo=(...t)=>(this.transmit(...t),t),this.log=(...t)=>(console.log(...t),!0),this.error=(...t)=>(console.error(...t),!0),e?.services&&this.addServices(e.services),this.load(this)}handleServiceMessage(e){let t;return typeof e=="object"&&(e.route?t=e.route:e.node&&(t=e.node)),t?Array.isArray(e.args)?this.run(t,...e.args):this.run(t,e.args):e}handleGraphNodeCall(e,t){if(!e)return t;if(t?.args)this.handleServiceMessage(t);else return Array.isArray(t)?this.run(e,...t):this.run(e,t)}};function rd(e){return ArrayBuffer.isView(e)&&Object.prototype.toString.call(e)!=="[object DataView]"}var js=(e,t)=>{for(let r in t)t[r]?.constructor.name==="Object"&&!Array.isArray(t[r])?e[r]?.constructor.name==="Object"&&!Array.isArray(e[r])?js(e[r],t[r]):e[r]=js({},t[r]):e[r]=t[r];return e};function id(e,t,r){let i=e.subarray(0,t),n;r&&(n=e.subarray(r+1));let a;return(i.length>0||n?.length>0)&&(a=new e.constructor(i.length+n.length)),a&&(i.length>0&&a.set(i),n&&n.length>0&&a.set(n,i.length)),a}var ws={},nd={transferNode:(e,t,r)=>{let i;if(typeof e=="object"){e.__node||(e.__node={}),r&&(e.__node.tag=r);for(let n in e)typeof e[n]=="function"&&(e.__methods||(e.__methods={}),e.__methods[n]=e[n].toString());i=Yo(e)}else typeof e=="function"?i=e.toString():typeof e=="string"&&(i=e);if(i){if(t.run)return t.run("setNode",[i]);if(t.postMessage)return t.postMessage({route:"setNode",args:i},void 0),new Promise(n=>n(r));if(t.send)return t.send(JSON.stringify({route:"setNode",args:i})),new Promise(n=>n(r))}},setNode:function(e,t){if(typeof e=="object"&&e.__methods&&(this.__node.graph.__node.loaders.methodstrings||(this.__node.graph.__node.loaders.methodstrings=Yl)),typeof e=="string"){let r=Wi(e);typeof r=="function"?e={__operator:r,__node:{tag:t||r.name}}:(r=JSON.parse(e),typeof r=="object"&&(e=r))}if(typeof e=="object"||typeof e=="function"){let r={};typeof e=="object"?Object.assign(r,e):r.__operator=e;let i=this.__node.graph.add(r);return i?(ws[i.__node.tag]=r,i.__node?.tag):!1}else return!1},proxyRemoteNode:function(e,t){return new Promise((r,i)=>{t.run("getNodeProperties",e).then(n=>{let a={};if(typeof n=="object")for(let p in n)n[p]==="function"?a[p]=(...d)=>new Promise(y=>{t.run(e,d,p).then(y)}):Object.defineProperty(a,p,{get:()=>new Promise(d=>{t.run(e,void 0,p).then(d)}),set:d=>{t.post(e,d,p)},configurable:!0,enumerable:!0});r(a)})})},makeNodeTransferrable:function(e,t){e.__node||(e.__node={}),t&&(e.__node.tag=t);for(let i in e)typeof e[i]=="function"&&(e.__methods||(e.__methods={}),e.__methods[i]=e[i].toString());return Yo(e)},setTemplate:function(e,t){if(typeof e=="object"&&e.__methods&&(this.__node.graph.__node.loaders.methodstrings||(this.__node.graph.__node.loaders.methodstrings=Yl)),typeof e=="string"){let r=Wi(e);typeof r=="function"?(t||(t=r.name),e={__operator:r,__node:{tag:t}}):(r=JSON.parse(e),typeof r=="object"&&(e=r,!t&&r.__node?.tag&&(t=r.__node.tag)))}return t||(t=`node${Math.floor(Math.random()*1e15)}`),typeof e=="object"||typeof e=="function"?(ws[t]=e,t):!1},loadFromTemplate:function(e,t,r){if(ws[e]){let i=js({},ws[e]);return t&&(i.__node||(i.__node={}),i.__node.tag=t),r&&Object.assign(i,r),this.__node.graph.add(i).__node.tag}},setMethod:function(e,t,r){if(typeof t=="string"){let i=Wi(t);typeof i=="function"&&(t=i)}return!r&&typeof t=="function"&&(r=t.name),this.__node.graph.get(e)?this.__node.graph.get(e)[r]=t:this.__node.graph.add({__node:{tag:r,[r]:t}}),!0},assignNode:function(e,t){this.__node.graph.get(e)&&typeof t=="object"&&Object.assign(this.__node.graph.get(e),t)},getNodeProperties:function(e){let t=this.__node.graph.get(e);if(t){let r=Object.getOwnPropertyNames(t),i={};for(let n in r)i[n]=typeof t[n];return i}},transferClass:(e,t,r)=>{if(typeof e=="object"){let i=e.toString(),n={route:"receiveClass",args:[i,r]};return t.run?t.run("receiveClass",[i,r]):t.postMessage?(t.postMessage({route:"receiveClass",args:[i,r]},void 0),new Promise(a=>a(name))):t.send?(t.send(JSON.stringify({route:"receiveClass",args:[i,r]})),new Promise(a=>a(name))):n}return!1},receiveClass:function(e,t){if(typeof e=="string"&&e.indexOf("class")===0){let r=(0,eval)("("+e+")"),i=t;return i||(i=r.name),this.__node.graph[i]=r,!0}return!1},transferFunction:(e,t,r)=>{r||(r=e.name);let i=e.toString(),n={route:"setNode",args:[i,r]};return t.run?t.run("setNode",[i,r]):t.postMessage?(t.postMessage({route:"setNode",args:[i,r]},void 0),new Promise(a=>a(name))):t.send?(t.send(JSON.stringify({route:"setNode",args:[i,r]})),new Promise(a=>a(name))):n},setGlobal:(e,t)=>(globalThis[e]=t,!0),assignGlobalObject:(e,t)=>globalThis[e]?(typeof t=="object"&&Object.assign(globalThis[e],t),!0):!1,setValue:function(e,t){return this.__node.graph[e]=t,!0},assignObject:function(e,t){return this.__node.graph[e]?(typeof t=="object"&&Object.assign(this.__node.graph[e],t),!0):!1},setGlobalFunction:(e,t)=>(typeof e=="string"&&(e=Wi(e)),typeof e=="function"?(t||(t=e.name),globalThis[t]=e,!0):!1),setGraphFunction:function(e,t){return typeof e=="string"&&(e=Wi(e)),typeof e=="function"?(t||(t=e.name),this.__node.graph[t]=e,!0):!1}};function sd(e,...t){return function(i=document.createElement("div")){let n=document.createElement("template");e.map(function(d,y){if(n.innerHTML+=d,t[y]instanceof HTMLElement){let b='<span id="dummyNode12345"></span>';b.id="dummyNode12345",n.innerHTML+=b}else n.innerHTML+=t[y]});let a=n.content.querySelectorAll("#dummyNode12345"),p=0;return t.forEach((d,y)=>{d instanceof HTMLElement&&(console.log(d,a[p]),n.content.replaceChild(d,a[p]),p++)}),i.appendChild(n.content),i}}var Nh=sd``,q={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(e){this.toString=function(){return"CORRUPT: "+this.message},this.message=e},invalid:function(e){this.toString=function(){return"INVALID: "+this.message},this.message=e},bug:function(e){this.toString=function(){return"BUG: "+this.message},this.message=e},notReady:function(e){this.toString=function(){return"NOT READY: "+this.message},this.message=e}}};q.cipher.aes=function(e){this.s[0][0][0]||this.O();var t,r,i,n,a=this.s[0][4],p=this.s[1];t=e.length;var d=1;if(t!==4&&t!==6&&t!==8)throw new q.exception.invalid("invalid aes key size");for(this.b=[i=e.slice(0),n=[]],e=t;e<4*t+28;e++)r=i[e-1],(e%t===0||t===8&&e%t===4)&&(r=a[r>>>24]<<24^a[r>>16&255]<<16^a[r>>8&255]<<8^a[r&255],e%t===0&&(r=r<<8^r>>>24^d<<24,d=d<<1^283*(d>>7))),i[e]=i[e-t]^r;for(t=0;e;t++,e--)r=i[t&3?e:e-4],n[t]=4>=e||4>t?r:p[0][a[r>>>24]]^p[1][a[r>>16&255]]^p[2][a[r>>8&255]]^p[3][a[r&255]]};q.cipher.aes.prototype={encrypt:function(e){return Xl(this,e,0)},decrypt:function(e){return Xl(this,e,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var e=this.s[0],t=this.s[1],r=e[4],i=t[4],n,a,p,d=[],y=[],b,v,h,w;for(n=0;256>n;n++)y[(d[n]=n<<1^283*(n>>7))^n]=n;for(a=p=0;!r[a];a^=b||1,p=y[p]||1)for(h=p^p<<1^p<<2^p<<3^p<<4,h=h>>8^h&255^99,r[a]=h,i[h]=a,v=d[n=d[b=d[a]]],w=16843009*v^65537*n^257*b^16843008*a,v=257*d[h]^16843008*h,n=0;4>n;n++)e[n][a]=v=v<<24^v>>>8,t[n][h]=w=w<<24^w>>>8;for(n=0;5>n;n++)e[n]=e[n].slice(0),t[n]=t[n].slice(0)}};function Xl(e,t,r){if(t.length!==4)throw new q.exception.invalid("invalid aes block size");var i=e.b[r],n=t[0]^i[0],a=t[r?3:1]^i[1],p=t[2]^i[2];t=t[r?1:3]^i[3];var d,y,b,v=i.length/4-2,h,w=4,_=[0,0,0,0];d=e.s[r],e=d[0];var T=d[1],C=d[2],I=d[3],P=d[4];for(h=0;h<v;h++)d=e[n>>>24]^T[a>>16&255]^C[p>>8&255]^I[t&255]^i[w],y=e[a>>>24]^T[p>>16&255]^C[t>>8&255]^I[n&255]^i[w+1],b=e[p>>>24]^T[t>>16&255]^C[n>>8&255]^I[a&255]^i[w+2],t=e[t>>>24]^T[n>>16&255]^C[a>>8&255]^I[p&255]^i[w+3],w+=4,n=d,a=y,p=b;for(h=0;4>h;h++)_[r?3&-h:h]=P[n>>>24]<<24^P[a>>16&255]<<16^P[p>>8&255]<<8^P[t&255]^i[w++],d=n,n=a,a=p,p=t,t=d;return _}q.bitArray={bitSlice:function(e,t,r){return e=q.bitArray.$(e.slice(t/32),32-(t&31)).slice(1),r===void 0?e:q.bitArray.clamp(e,r-t)},extract:function(e,t,r){var i=Math.floor(-t-r&31);return((t+r-1^t)&-32?e[t/32|0]<<32-i^e[t/32+1|0]>>>i:e[t/32|0]>>>i)&(1<<r)-1},concat:function(e,t){if(e.length===0||t.length===0)return e.concat(t);var r=e[e.length-1],i=q.bitArray.getPartial(r);return i===32?e.concat(t):q.bitArray.$(t,i,r|0,e.slice(0,e.length-1))},bitLength:function(e){var t=e.length;return t===0?0:32*(t-1)+q.bitArray.getPartial(e[t-1])},clamp:function(e,t){if(32*e.length<t)return e;e=e.slice(0,Math.ceil(t/32));var r=e.length;return t=t&31,0<r&&t&&(e[r-1]=q.bitArray.partial(t,e[r-1]&2147483648>>t-1,1)),e},partial:function(e,t,r){return e===32?t:(r?t|0:t<<32-e)+1099511627776*e},getPartial:function(e){return Math.round(e/1099511627776)||32},equal:function(e,t){if(q.bitArray.bitLength(e)!==q.bitArray.bitLength(t))return!1;var r=0,i;for(i=0;i<e.length;i++)r|=e[i]^t[i];return r===0},$:function(e,t,r,i){var n;for(n=0,i===void 0&&(i=[]);32<=t;t-=32)i.push(r),r=0;if(t===0)return i.concat(e);for(n=0;n<e.length;n++)i.push(r|e[n]>>>t),r=e[n]<<32-t;return n=e.length?e[e.length-1]:0,e=q.bitArray.getPartial(n),i.push(q.bitArray.partial(t+e&31,32<t+e?r:i.pop(),1)),i},i:function(e,t){return[e[0]^t[0],e[1]^t[1],e[2]^t[2],e[3]^t[3]]},byteswapM:function(e){var t,r;for(t=0;t<e.length;++t)r=e[t],e[t]=r>>>24|r>>>8&65280|(r&65280)<<8|r<<24;return e}};q.codec.utf8String={fromBits:function(e){var t="",r=q.bitArray.bitLength(e),i,n;for(i=0;i<r/8;i++)!(i&3)&&(n=e[i/4]),t+=String.fromCharCode(n>>>8>>>8>>>8),n<<=8;return decodeURIComponent(escape(t))},toBits:function(e){e=unescape(encodeURIComponent(e));var t=[],r,i=0;for(r=0;r<e.length;r++)i=i<<8|e.charCodeAt(r),(r&3)===3&&(t.push(i),i=0);return r&3&&t.push(q.bitArray.partial(8*(r&3),i)),t}};q.codec.hex={fromBits:function(e){var t="",r;for(r=0;r<e.length;r++)t+=((e[r]|0)+0xf00000000000).toString(16).substr(4);return t.substr(0,q.bitArray.bitLength(e)/4)},toBits:function(e){var t,r=[],i;for(e=e.replace(/\s|0x/g,""),i=e.length,e=e+"00000000",t=0;t<e.length;t+=8)r.push(parseInt(e.substr(t,8),16)^0);return q.bitArray.clamp(r,4*i)}};q.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(e,t,r){var i=q.codec.base32.BASE,n=q.codec.base32.REMAINING,a="",p=0,d=q.codec.base32.B,y=0,b=q.bitArray.bitLength(e);for(r&&(d=q.codec.base32.X),r=0;a.length*i<b;)a+=d.charAt((y^e[r]>>>p)>>>n),p<i?(y=e[r]<<i-p,p+=n,r++):(y<<=i,p-=i);for(;a.length&7&&!t;)a+="=";return a},toBits:function(e,t){e=e.replace(/\s|=/g,"").toUpperCase();var r=q.codec.base32.BITS,i=q.codec.base32.BASE,n=q.codec.base32.REMAINING,a=[],p,d=0,y=q.codec.base32.B,b=0,v,h="base32";for(t&&(y=q.codec.base32.X,h="base32hex"),p=0;p<e.length;p++){if(v=y.indexOf(e.charAt(p)),0>v){if(!t)try{return q.codec.base32hex.toBits(e)}catch{}throw new q.exception.invalid("this isn't "+h+"!")}d>n?(d-=n,a.push(b^v>>>d),b=v<<r-d):(d+=i,b^=v<<r-d)}return d&56&&a.push(q.bitArray.partial(d&56,b,1)),a}};q.codec.base32hex={fromBits:function(e,t){return q.codec.base32.fromBits(e,t,1)},toBits:function(e){return q.codec.base32.toBits(e,1)}};q.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(e,t,r){var i="",n=0,a=q.codec.base64.B,p=0,d=q.bitArray.bitLength(e);for(r&&(a=a.substr(0,62)+"-_"),r=0;6*i.length<d;)i+=a.charAt((p^e[r]>>>n)>>>26),6>n?(p=e[r]<<6-n,n+=26,r++):(p<<=6,n-=6);for(;i.length&3&&!t;)i+="=";return i},toBits:function(e,t){e=e.replace(/\s|=/g,"");var r=[],i,n=0,a=q.codec.base64.B,p=0,d;for(t&&(a=a.substr(0,62)+"-_"),i=0;i<e.length;i++){if(d=a.indexOf(e.charAt(i)),0>d)throw new q.exception.invalid("this isn't base64!");26<n?(n-=26,r.push(p^d>>>n),p=d<<32-n):(n+=6,p^=d<<32-n)}return n&56&&r.push(q.bitArray.partial(n&56,p,1)),r}};q.codec.base64url={fromBits:function(e){return q.codec.base64.fromBits(e,1,1)},toBits:function(e){return q.codec.base64.toBits(e,1)}};q.hash.sha256=function(e){this.b[0]||this.O(),e?(this.F=e.F.slice(0),this.A=e.A.slice(0),this.l=e.l):this.reset()};q.hash.sha256.hash=function(e){return new q.hash.sha256().update(e).finalize()};q.hash.sha256.prototype={blockSize:512,reset:function(){return this.F=this.Y.slice(0),this.A=[],this.l=0,this},update:function(e){typeof e=="string"&&(e=q.codec.utf8String.toBits(e));var t,r=this.A=q.bitArray.concat(this.A,e);if(t=this.l,e=this.l=t+q.bitArray.bitLength(e),9007199254740991<e)throw new q.exception.invalid("Cannot hash more than 2^53 - 1 bits");if(typeof Uint32Array<"u"){var i=new Uint32Array(r),n=0;for(t=512+t-(512+t&511);t<=e;t+=512)Do(this,i.subarray(16*n,16*(n+1))),n+=1;r.splice(0,16*n)}else for(t=512+t-(512+t&511);t<=e;t+=512)Do(this,r.splice(0,16));return this},finalize:function(){var e,r=this.A,t=this.F,r=q.bitArray.concat(r,[q.bitArray.partial(1,1)]);for(e=r.length+2;e&15;e++)r.push(0);for(r.push(Math.floor(this.l/4294967296)),r.push(this.l|0);r.length;)Do(this,r.splice(0,16));return this.reset(),t},Y:[],b:[],O:function(){function e(a){return 4294967296*(a-Math.floor(a))|0}for(var t=0,r=2,i,n;64>t;r++){for(n=!0,i=2;i*i<=r;i++)if(r%i===0){n=!1;break}n&&(8>t&&(this.Y[t]=e(Math.pow(r,.5))),this.b[t]=e(Math.pow(r,1/3)),t++)}}};function Do(e,t){var r,i,n,a=e.F,p=e.b,d=a[0],y=a[1],b=a[2],v=a[3],h=a[4],w=a[5],_=a[6],T=a[7];for(r=0;64>r;r++)16>r?i=t[r]:(i=t[r+1&15],n=t[r+14&15],i=t[r&15]=(i>>>7^i>>>18^i>>>3^i<<25^i<<14)+(n>>>17^n>>>19^n>>>10^n<<15^n<<13)+t[r&15]+t[r+9&15]|0),i=i+T+(h>>>6^h>>>11^h>>>25^h<<26^h<<21^h<<7)+(_^h&(w^_))+p[r],T=_,_=w,w=h,h=v+i|0,v=b,b=y,y=d,d=i+(y&b^v&(y^b))+(y>>>2^y>>>13^y>>>22^y<<30^y<<19^y<<10)|0;a[0]=a[0]+d|0,a[1]=a[1]+y|0,a[2]=a[2]+b|0,a[3]=a[3]+v|0,a[4]=a[4]+h|0,a[5]=a[5]+w|0,a[6]=a[6]+_|0,a[7]=a[7]+T|0}q.mode.ccm={name:"ccm",G:[],listenProgress:function(e){q.mode.ccm.G.push(e)},unListenProgress:function(e){e=q.mode.ccm.G.indexOf(e),-1<e&&q.mode.ccm.G.splice(e,1)},fa:function(e){var t=q.mode.ccm.G.slice(),r;for(r=0;r<t.length;r+=1)t[r](e)},encrypt:function(e,t,r,i,n){var a,p=t.slice(0),d=q.bitArray,y=d.bitLength(r)/8,b=d.bitLength(p)/8;if(n=n||64,i=i||[],7>y)throw new q.exception.invalid("ccm: iv must be at least 7 bytes");for(a=2;4>a&&b>>>8*a;a++);return a<15-y&&(a=15-y),r=d.clamp(r,8*(15-a)),t=q.mode.ccm.V(e,t,r,i,n,a),p=q.mode.ccm.C(e,p,r,t,n,a),d.concat(p.data,p.tag)},decrypt:function(e,t,r,i,n){n=n||64,i=i||[];var a=q.bitArray,p=a.bitLength(r)/8,b=a.bitLength(t),d=a.clamp(t,b-n),y=a.bitSlice(t,b-n),b=(b-n)/8;if(7>p)throw new q.exception.invalid("ccm: iv must be at least 7 bytes");for(t=2;4>t&&b>>>8*t;t++);if(t<15-p&&(t=15-p),r=a.clamp(r,8*(15-t)),d=q.mode.ccm.C(e,d,r,y,n,t),e=q.mode.ccm.V(e,d.data,r,i,n,t),!a.equal(d.tag,e))throw new q.exception.corrupt("ccm: tag doesn't match");return d.data},na:function(e,t,r,i,n,a){var p=[],d=q.bitArray,y=d.i;if(i=[d.partial(8,(t.length?64:0)|i-2<<2|a-1)],i=d.concat(i,r),i[3]|=n,i=e.encrypt(i),t.length)for(r=d.bitLength(t)/8,65279>=r?p=[d.partial(16,r)]:4294967295>=r&&(p=d.concat([d.partial(16,65534)],[r])),p=d.concat(p,t),t=0;t<p.length;t+=4)i=e.encrypt(y(i,p.slice(t,t+4).concat([0,0,0])));return i},V:function(e,t,r,i,n,a){var p=q.bitArray,d=p.i;if(n/=8,n%2||4>n||16<n)throw new q.exception.invalid("ccm: invalid tag length");if(4294967295<i.length||4294967295<t.length)throw new q.exception.bug("ccm: can't deal with 4GiB or more data");for(r=q.mode.ccm.na(e,i,r,n,p.bitLength(t)/8,a),i=0;i<t.length;i+=4)r=e.encrypt(d(r,t.slice(i,i+4).concat([0,0,0])));return p.clamp(r,8*n)},C:function(e,t,r,i,n,a){var p,d=q.bitArray;p=d.i;var y=t.length,b=d.bitLength(t),v=y/50,h=v;if(r=d.concat([d.partial(8,a-1)],r).concat([0,0,0]).slice(0,4),i=d.bitSlice(p(i,e.encrypt(r)),0,n),!y)return{tag:i,data:[]};for(p=0;p<y;p+=4)p>v&&(q.mode.ccm.fa(p/y),v+=h),r[3]++,n=e.encrypt(r),t[p]^=n[0],t[p+1]^=n[1],t[p+2]^=n[2],t[p+3]^=n[3];return{tag:i,data:d.clamp(t,b)}}};q.mode.ocb2={name:"ocb2",encrypt:function(e,t,r,i,n,a){if(q.bitArray.bitLength(r)!==128)throw new q.exception.invalid("ocb iv must be 128 bits");var p,d=q.mode.ocb2.S,y=q.bitArray,b=y.i,v=[0,0,0,0];r=d(e.encrypt(r));var h,w=[];for(i=i||[],n=n||64,p=0;p+4<t.length;p+=4)h=t.slice(p,p+4),v=b(v,h),w=w.concat(b(r,e.encrypt(b(r,h)))),r=d(r);return h=t.slice(p),t=y.bitLength(h),p=e.encrypt(b(r,[0,0,0,t])),h=y.clamp(b(h.concat([0,0,0]),p),t),v=b(v,b(h.concat([0,0,0]),p)),v=e.encrypt(b(v,b(r,d(r)))),i.length&&(v=b(v,a?i:q.mode.ocb2.pmac(e,i))),w.concat(y.concat(h,y.clamp(v,n)))},decrypt:function(e,t,r,i,n,a){if(q.bitArray.bitLength(r)!==128)throw new q.exception.invalid("ocb iv must be 128 bits");n=n||64;var p=q.mode.ocb2.S,d=q.bitArray,y=d.i,b=[0,0,0,0],v=p(e.encrypt(r)),h,w,_=q.bitArray.bitLength(t)-n,T=[];for(i=i||[],r=0;r+4<_/32;r+=4)h=y(v,e.decrypt(y(v,t.slice(r,r+4)))),b=y(b,h),T=T.concat(h),v=p(v);if(w=_-32*r,h=e.encrypt(y(v,[0,0,0,w])),h=y(h,d.clamp(t.slice(r),w).concat([0,0,0])),b=y(b,h),b=e.encrypt(y(b,y(v,p(v)))),i.length&&(b=y(b,a?i:q.mode.ocb2.pmac(e,i))),!d.equal(d.clamp(b,n),d.bitSlice(t,_)))throw new q.exception.corrupt("ocb: tag doesn't match");return T.concat(d.clamp(h,w))},pmac:function(e,t){var r,i=q.mode.ocb2.S,n=q.bitArray,a=n.i,p=[0,0,0,0],d=e.encrypt([0,0,0,0]),d=a(d,i(i(d)));for(r=0;r+4<t.length;r+=4)d=i(d),p=a(p,e.encrypt(a(d,t.slice(r,r+4))));return r=t.slice(r),128>n.bitLength(r)&&(d=a(d,i(d)),r=n.concat(r,[-2147483648,0,0,0])),p=a(p,r),e.encrypt(a(i(a(d,i(d))),p))},S:function(e){return[e[0]<<1^e[1]>>>31,e[1]<<1^e[2]>>>31,e[2]<<1^e[3]>>>31,e[3]<<1^135*(e[0]>>>31)]}};q.mode.gcm={name:"gcm",encrypt:function(e,t,r,i,n){var a=t.slice(0);return t=q.bitArray,i=i||[],e=q.mode.gcm.C(!0,e,a,i,r,n||128),t.concat(e.data,e.tag)},decrypt:function(e,t,r,i,n){var a=t.slice(0),p=q.bitArray,d=p.bitLength(a);if(n=n||128,i=i||[],n<=d?(t=p.bitSlice(a,d-n),a=p.bitSlice(a,0,d-n)):(t=a,a=[]),e=q.mode.gcm.C(!1,e,a,i,r,n),!p.equal(e.tag,t))throw new q.exception.corrupt("gcm: tag doesn't match");return e.data},ka:function(e,t){var r,i,n,a,p,d=q.bitArray.i;for(n=[0,0,0,0],a=t.slice(0),r=0;128>r;r++){for((i=(e[Math.floor(r/32)]&1<<31-r%32)!==0)&&(n=d(n,a)),p=(a[3]&1)!==0,i=3;0<i;i--)a[i]=a[i]>>>1|(a[i-1]&1)<<31;a[0]>>>=1,p&&(a[0]^=-520093696)}return n},j:function(e,t,r){var i,n=r.length;for(t=t.slice(0),i=0;i<n;i+=4)t[0]^=4294967295&r[i],t[1]^=4294967295&r[i+1],t[2]^=4294967295&r[i+2],t[3]^=4294967295&r[i+3],t=q.mode.gcm.ka(t,e);return t},C:function(e,t,r,i,n,a){var p,d,y,b,v,h,w,_,T=q.bitArray;for(h=r.length,w=T.bitLength(r),_=T.bitLength(i),d=T.bitLength(n),p=t.encrypt([0,0,0,0]),d===96?(n=n.slice(0),n=T.concat(n,[1])):(n=q.mode.gcm.j(p,[0,0,0,0],n),n=q.mode.gcm.j(p,n,[0,0,Math.floor(d/4294967296),d&4294967295])),d=q.mode.gcm.j(p,[0,0,0,0],i),v=n.slice(0),i=d.slice(0),e||(i=q.mode.gcm.j(p,d,r)),b=0;b<h;b+=4)v[3]++,y=t.encrypt(v),r[b]^=y[0],r[b+1]^=y[1],r[b+2]^=y[2],r[b+3]^=y[3];return r=T.clamp(r,w),e&&(i=q.mode.gcm.j(p,d,r)),e=[Math.floor(_/4294967296),_&4294967295,Math.floor(w/4294967296),w&4294967295],i=q.mode.gcm.j(p,i,e),y=t.encrypt(n),i[0]^=y[0],i[1]^=y[1],i[2]^=y[2],i[3]^=y[3],{tag:T.bitSlice(i,0,a),data:r}}};q.misc.hmac=function(e,t){this.W=t=t||q.hash.sha256;var r=[[],[]],i,n=t.prototype.blockSize/32;for(this.w=[new t,new t],e.length>n&&(e=t.hash(e)),i=0;i<n;i++)r[0][i]=e[i]^909522486,r[1][i]=e[i]^1549556828;this.w[0].update(r[0]),this.w[1].update(r[1]),this.R=new t(this.w[0])};q.misc.hmac.prototype.encrypt=q.misc.hmac.prototype.mac=function(e){if(this.aa)throw new q.exception.invalid("encrypt on already updated hmac called!");return this.update(e),this.digest(e)};q.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]),this.aa=!1};q.misc.hmac.prototype.update=function(e){this.aa=!0,this.R.update(e)};q.misc.hmac.prototype.digest=function(){var e=this.R.finalize(),e=new this.W(this.w[1]).update(e).finalize();return this.reset(),e};q.misc.pbkdf2=function(e,t,r,i,n){if(r=r||1e4,0>i||0>r)throw new q.exception.invalid("invalid params to pbkdf2");typeof e=="string"&&(e=q.codec.utf8String.toBits(e)),typeof t=="string"&&(t=q.codec.utf8String.toBits(t)),n=n||q.misc.hmac,e=new n(e);var a,p,d,y,b=[],v=q.bitArray;for(y=1;32*b.length<(i||1);y++){for(n=a=e.encrypt(v.concat(t,[y])),p=1;p<r;p++)for(a=e.encrypt(a),d=0;d<a.length;d++)n[d]^=a[d];b=b.concat(n)}return i&&(b=v.clamp(b,i)),b};q.prng=function(e){this.c=[new q.hash.sha256],this.m=[0],this.P=0,this.H={},this.N=0,this.U={},this.Z=this.f=this.o=this.ha=0,this.b=[0,0,0,0,0,0,0,0],this.h=[0,0,0,0],this.L=void 0,this.M=e,this.D=!1,this.K={progress:{},seeded:{}},this.u=this.ga=0,this.I=1,this.J=2,this.ca=65536,this.T=[0,48,64,96,128,192,256,384,512,768,1024],this.da=3e4,this.ba=80};q.prng.prototype={randomWords:function(e,t){var r=[],i;i=this.isReady(t);var n;if(i===this.u)throw new q.exception.notReady("generator isn't seeded");if(i&this.J){i=!(i&this.I),n=[];var a=0,p;for(this.Z=n[0]=new Date().valueOf()+this.da,p=0;16>p;p++)n.push(4294967296*Math.random()|0);for(p=0;p<this.c.length&&(n=n.concat(this.c[p].finalize()),a+=this.m[p],this.m[p]=0,i||!(this.P&1<<p));p++);for(this.P>=1<<this.c.length&&(this.c.push(new q.hash.sha256),this.m.push(0)),this.f-=a,a>this.o&&(this.o=a),this.P++,this.b=q.hash.sha256.hash(this.b.concat(n)),this.L=new q.cipher.aes(this.b),i=0;4>i&&(this.h[i]=this.h[i]+1|0,!this.h[i]);i++);}for(i=0;i<e;i+=4)(i+1)%this.ca===0&&Zl(this),n=Xo(this),r.push(n[0],n[1],n[2],n[3]);return Zl(this),r.slice(0,e)},setDefaultParanoia:function(e,t){if(e===0&&t!=="Setting paranoia=0 will ruin your security; use it only for testing")throw new q.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=e},addEntropy:function(e,t,r){r=r||"user";var i,n,a=new Date().valueOf(),p=this.H[r],d=this.isReady(),y=0;switch(i=this.U[r],i===void 0&&(i=this.U[r]=this.ha++),p===void 0&&(p=this.H[r]=0),this.H[r]=(this.H[r]+1)%this.c.length,typeof e){case"number":t===void 0&&(t=1),this.c[p].update([i,this.N++,1,t,a,1,e|0]);break;case"object":if(r=Object.prototype.toString.call(e),r==="[object Uint32Array]"){for(n=[],r=0;r<e.length;r++)n.push(e[r]);e=n}else for(r!=="[object Array]"&&(y=1),r=0;r<e.length&&!y;r++)typeof e[r]!="number"&&(y=1);if(!y){if(t===void 0)for(r=t=0;r<e.length;r++)for(n=e[r];0<n;)t++,n=n>>>1;this.c[p].update([i,this.N++,2,t,a,e.length].concat(e))}break;case"string":t===void 0&&(t=e.length),this.c[p].update([i,this.N++,3,t,a,e.length]),this.c[p].update(e);break;default:y=1}if(y)throw new q.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[p]+=t,this.f+=t,d===this.u&&(this.isReady()!==this.u&&Kl("seeded",Math.max(this.o,this.f)),Kl("progress",this.getProgress()))},isReady:function(e){return e=this.T[e!==void 0?e:this.M],this.o&&this.o>=e?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=e?this.J|this.u:this.u},getProgress:function(e){return e=this.T[e||this.M],this.o>=e||this.f>e?1:this.f/e},startCollectors:function(){if(!this.D){if(this.a={loadTimeCollector:Cn(this,this.ma),mouseCollector:Cn(this,this.oa),keyboardCollector:Cn(this,this.la),accelerometerCollector:Cn(this,this.ea),touchCollector:Cn(this,this.qa)},window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,!1),window.addEventListener("mousemove",this.a.mouseCollector,!1),window.addEventListener("keypress",this.a.keyboardCollector,!1),window.addEventListener("devicemotion",this.a.accelerometerCollector,!1),window.addEventListener("touchmove",this.a.touchCollector,!1);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new q.exception.bug("can't attach event");this.D=!0}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,!1),window.removeEventListener("mousemove",this.a.mouseCollector,!1),window.removeEventListener("keypress",this.a.keyboardCollector,!1),window.removeEventListener("devicemotion",this.a.accelerometerCollector,!1),window.removeEventListener("touchmove",this.a.touchCollector,!1)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=!1)},addEventListener:function(e,t){this.K[e][this.ga++]=t},removeEventListener:function(e,t){var r,i,n=this.K[e],a=[];for(i in n)n.hasOwnProperty(i)&&n[i]===t&&a.push(i);for(r=0;r<a.length;r++)i=a[r],delete n[i]},la:function(){Bn(this,1)},oa:function(e){var t,r;try{t=e.x||e.clientX||e.offsetX||0,r=e.y||e.clientY||e.offsetY||0}catch{r=t=0}t!=0&&r!=0&&this.addEntropy([t,r],2,"mouse"),Bn(this,0)},qa:function(e){e=e.touches[0]||e.changedTouches[0],this.addEntropy([e.pageX||e.clientX,e.pageY||e.clientY],1,"touch"),Bn(this,0)},ma:function(){Bn(this,2)},ea:function(e){if(e=e.accelerationIncludingGravity.x||e.accelerationIncludingGravity.y||e.accelerationIncludingGravity.z,window.orientation){var t=window.orientation;typeof t=="number"&&this.addEntropy(t,1,"accelerometer")}e&&this.addEntropy(e,2,"accelerometer"),Bn(this,0)}};function Kl(e,t){var r,i=q.random.K[e],n=[];for(r in i)i.hasOwnProperty(r)&&n.push(i[r]);for(r=0;r<n.length;r++)n[r](t)}function Bn(e,t){typeof window<"u"&&window.performance&&typeof window.performance.now=="function"?e.addEntropy(window.performance.now(),t,"loadtime"):e.addEntropy(new Date().valueOf(),t,"loadtime")}function Zl(e){e.b=Xo(e).concat(Xo(e)),e.L=new q.cipher.aes(e.b)}function Xo(e){for(var t=0;4>t&&(e.h[t]=e.h[t]+1|0,!e.h[t]);t++);return e.L.encrypt(e.h)}function Cn(e,t){return function(){t.apply(e,arguments)}}q.random=new q.prng(6);e:try{if(Ro=typeof module<"u"&&module.exports){try{Mo=Ru("crypto")}catch{Mo=null}Ro=Po=Mo}if(Ro&&Po.randomBytes)Ss=Po.randomBytes(128),Ss=new Uint32Array(new Uint8Array(Ss).buffer),q.random.addEntropy(Ss,1024,"crypto['randomBytes']");else if(typeof window<"u"&&typeof Uint32Array<"u"){if(ks=new Uint32Array(32),window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(ks);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(ks);else break e;q.random.addEntropy(ks,1024,"crypto['getRandomValues']")}}catch(e){typeof window<"u"&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(e))}var Ss,Po,ks,Ro,Mo;q.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(e,t,r,i){r=r||{},i=i||{};var n=q.json,a=n.g({iv:q.random.randomWords(4,0)},n.defaults),p;if(n.g(a,r),r=a.adata,typeof a.salt=="string"&&(a.salt=q.codec.base64.toBits(a.salt)),typeof a.iv=="string"&&(a.iv=q.codec.base64.toBits(a.iv)),!q.mode[a.mode]||!q.cipher[a.cipher]||typeof e=="string"&&100>=a.iter||a.ts!==64&&a.ts!==96&&a.ts!==128||a.ks!==128&&a.ks!==192&&a.ks!==256||2>a.iv.length||4<a.iv.length)throw new q.exception.invalid("json encrypt: invalid parameters");return typeof e=="string"?(p=q.misc.cachedPbkdf2(e,a),e=p.key.slice(0,a.ks/32),a.salt=p.salt):q.ecc&&e instanceof q.ecc.elGamal.publicKey&&(p=e.kem(),a.kemtag=p.tag,e=p.key.slice(0,a.ks/32)),typeof t=="string"&&(t=q.codec.utf8String.toBits(t)),typeof r=="string"&&(a.adata=r=q.codec.utf8String.toBits(r)),p=new q.cipher[a.cipher](e),n.g(i,a),i.key=e,a.ct=a.mode==="ccm"&&q.arrayBuffer&&q.arrayBuffer.ccm&&t instanceof ArrayBuffer?q.arrayBuffer.ccm.encrypt(p,t,a.iv,r,a.ts):q.mode[a.mode].encrypt(p,t,a.iv,r,a.ts),a},encrypt:function(e,t,r,i){var n=q.json,a=n.ja.apply(n,arguments);return n.encode(a)},ia:function(e,t,r,i){r=r||{},i=i||{};var n=q.json;t=n.g(n.g(n.g({},n.defaults),t),r,!0);var a,p;if(a=t.adata,typeof t.salt=="string"&&(t.salt=q.codec.base64.toBits(t.salt)),typeof t.iv=="string"&&(t.iv=q.codec.base64.toBits(t.iv)),!q.mode[t.mode]||!q.cipher[t.cipher]||typeof e=="string"&&100>=t.iter||t.ts!==64&&t.ts!==96&&t.ts!==128||t.ks!==128&&t.ks!==192&&t.ks!==256||!t.iv||2>t.iv.length||4<t.iv.length)throw new q.exception.invalid("json decrypt: invalid parameters");return typeof e=="string"?(p=q.misc.cachedPbkdf2(e,t),e=p.key.slice(0,t.ks/32),t.salt=p.salt):q.ecc&&e instanceof q.ecc.elGamal.secretKey&&(e=e.unkem(q.codec.base64.toBits(t.kemtag)).slice(0,t.ks/32)),typeof a=="string"&&(a=q.codec.utf8String.toBits(a)),p=new q.cipher[t.cipher](e),a=t.mode==="ccm"&&q.arrayBuffer&&q.arrayBuffer.ccm&&t.ct instanceof ArrayBuffer?q.arrayBuffer.ccm.decrypt(p,t.ct,t.iv,t.tag,a,t.ts):q.mode[t.mode].decrypt(p,t.ct,t.iv,a,t.ts),n.g(i,t),i.key=e,r.raw===1?a:q.codec.utf8String.fromBits(a)},decrypt:function(e,t,r,i){var n=q.json;return n.ia(e,n.decode(t),r,i)},encode:function(e){var t,r="{",i="";for(t in e)if(e.hasOwnProperty(t)){if(!t.match(/^[a-z0-9]+$/i))throw new q.exception.invalid("json encode: invalid property name");switch(r+=i+'"'+t+'":',i=",",typeof e[t]){case"number":case"boolean":r+=e[t];break;case"string":r+='"'+escape(e[t])+'"';break;case"object":r+='"'+q.codec.base64.fromBits(e[t],0)+'"';break;default:throw new q.exception.bug("json encode: unsupported type")}}return r+"}"},decode:function(e){if(e=e.replace(/\s/g,""),!e.match(/^\{.*\}$/))throw new q.exception.invalid("json decode: this isn't json!");e=e.replace(/^\{|\}$/g,"").split(/,/);var t={},r,i;for(r=0;r<e.length;r++){if(!(i=e[r].match(/^\s*(?:(["']?)([a-z][a-z0-9]*)\1)\s*:\s*(?:(-?\d+)|"([a-z0-9+\/%*_.@=\-]*)"|(true|false))$/i)))throw new q.exception.invalid("json decode: this isn't json!");i[3]!=null?t[i[2]]=parseInt(i[3],10):i[4]!=null?t[i[2]]=i[2].match(/^(ct|adata|salt|iv)$/)?q.codec.base64.toBits(i[4]):unescape(i[4]):i[5]!=null&&(t[i[2]]=i[5]==="true")}return t},g:function(e,t,r){if(e===void 0&&(e={}),t===void 0)return e;for(var i in t)if(t.hasOwnProperty(i)){if(r&&e[i]!==void 0&&e[i]!==t[i])throw new q.exception.invalid("required parameter overridden");e[i]=t[i]}return e},sa:function(e,t){var r={},i;for(i in e)e.hasOwnProperty(i)&&e[i]!==t[i]&&(r[i]=e[i]);return r},ra:function(e,t){var r={},i;for(i=0;i<t.length;i++)e[t[i]]!==void 0&&(r[t[i]]=e[t[i]]);return r}};q.encrypt=q.json.encrypt;q.decrypt=q.json.decrypt;q.misc.pa={};q.misc.cachedPbkdf2=function(e,t){var r=q.misc.pa,i;return t=t||{},i=t.iter||1e3,r=r[e]=r[e]||{},i=r[i]=r[i]||{firstSalt:t.salt&&t.salt.length?t.salt.slice(0):q.random.randomWords(2,0)},r=t.salt===void 0?i.firstSalt:t.salt,i[r]=i[r]||q.misc.pbkdf2(e,r,t.iter),{key:i[r].slice(0),salt:r.slice(0)}};var Is=class extends dc{constructor(e,t,r){super(e),this.name="http",this.fetchProxied=!1,this.listening={},this.GET=(i="http://localhost:8080/ping",n="",a)=>(n==="json"&&(a="application/json"),new Promise((p,d)=>{let y=Is.request({method:"GET",url:i,responseType:n,mimeType:a,onload:b=>{let v;y.responseType===""||y.responseType==="text"?v=y.responseText:v=y.response,i instanceof URL&&(i=i.toString()),this.setState({[i]:v}),p(v)},onabort:b=>{d(b)}})}).catch(console.error)),this.POST=(i,n="http://localhost:8080/echo",a="",p)=>(typeof i=="object"&&(a==="json"||a==="text"||!a)&&(i=JSON.stringify(i)),a==="json"&&(p="application/json"),new Promise((d,y)=>{let b=Is.request({method:"POST",url:n,data:i,responseType:a,mimeType:p,onload:v=>{let h;b.responseType===""||b.responseType==="text"?h=b.responseText:h=b.response,n instanceof URL&&(n=n.toString()),this.setState({[n]:h}),d(h)},onabort:v=>{y(v)}})}).catch(console.error)),this.transmit=(i,n)=>{let a=i;return typeof a=="object"&&(i=JSON.stringify(a)),a?.method?.toLowerCase()=="get"||i?.toLowerCase()==="get"?this.GET(n):this.POST(i,n)},this.transponder=(i,n,a="",p)=>{typeof n=="object"&&(n=JSON.stringify(n));let d="GET";if(n&&(d="POST"),a==="json")p="application/json";else return new Promise((y,b)=>{let v=Is.request({method:d,url:i,data:n,responseType:a,onload:h=>{let w=v.response;if(typeof w=="string"){let _=w.substring(0,8);(_.includes("{")||_.includes("["))&&(_.includes("\\")&&(w=w.replace(/\\/g,"")),w[0]==='"'&&(w=w.substring(1,w.length-1)),w=JSON.parse(w))}return typeof w?.method=="string"?y(this.handleMethod(w.route,w.method,w.args)):typeof w?.route=="string"?y(this.handleServiceMessage(w)):typeof w?.node=="string"||w.node instanceof It?y(this.handleGraphNodeCall(w.node,w.args)):y(w)},onabort:h=>{b(h)}})}).catch(console.error)},this.listen=(i="0",n=async(a,p,d)=>{let y=await a.text(),b=this.receive(y);this.setState({[d.url]:b})})=>{this.listening[i]={};let a=`${i}${Math.floor(Math.random()*1e15)}`;return this.listening[i][a]=n,this.fetchProxied||(globalThis.fetch=new Proxy(globalThis.fetch,{apply(p,d,y){let b=p.apply(d,y);return b.then(v=>{if(v.ok){if(this.listening[0])for(let h in this.listeners){let w=v.clone();this.listening[0][h](w,y,v)}else for(let h in this.listening)if(v.url.includes(h)){for(let w in this.listening[i]){let _=v.clone();this.listening[i][w](_,y,v)}break}}}).catch(v=>{console.error(v)}),b}}),this.fetchProxied=!0),a},this.stopListening=(i,n)=>{if(!i&&i!==0)for(let a in this.listening)delete this.listening[a];else n?delete this.listening[n]:delete this.listening[i]},this.load(this),this.listen(t,r)}},od=Is;od.request=e=>{let t=new XMLHttpRequest;return e.responseType?t.responseType=e.responseType:e.responseType="json",e.mimeType&&t.overrideMimeType(e.mimeType),e.onload&&t.addEventListener("load",e.onload,!1),e.onprogress&&t.addEventListener("progress",e.onprogress,!1),e.onabort&&t.addEventListener("abort",e.onabort,!1),e.onloadend&&t.addEventListener("loadend",e.onloadend,!1),e.onerror&&t.addEventListener("error",e.onerror,!1),t.open(e.method,e.url,!0,e.user,e.pass),e.onerror||(t.onerror=function(){t.abort()}),t.send(e.data),t};var vi=zu($u()),ad=class extends dc{constructor(e){super(),this.name="worker",this.workers={},this.threadRot=0,this.loadWorkerRoute=(t,r)=>{t.workerUrl&&(t.url=t.workerUrl),t.workerId&&(t.__node.tag=t.workerId),t.__node.tag||(t.__node.tag=r),t._id=t.__node.tag;let i;if(this.workers[t._id]?i=this.workers[t._id]:t.worker&&(i=t.worker),i||(i=this.addWorker(t)),t.worker=i,!t.worker.__ondisconnected){let n=a=>{a.worker?.terminate()};t.__addOndisconnected(n)}if(t.transferFunctions)for(let n in t.transferFunctions)this.transferFunction(i,t.transferFunctions[n],n);if(t.transferClasses)for(let n in t.transferClasses)this.transferClass(i,t.transferClasses[n],n);if(i)return t.__operator||(t.__operator=(...n)=>{if(t.callback)if(!this.__node.nodes.get(t.__node.tag)?.__children)i.post(t.callback,n);else return i.run(t.callback,n);else if(!this.__node.nodes.get(t.__node.tag)?.__children)i.send(n);else return i.request(n)}),t.init&&i.run(t.init,t.initArgs,void 0,t.initTransfer),i},this.workerloader={workers:(t,r,i,n)=>{let a=t;if(!t.parentRoute&&r?.callback&&r?.worker&&(t.parentRoute=r?.callback),a?.worker||a?.workerId||a?.workerUrl){let p=this.loadWorkerRoute(a,a.__node.tag);p&&(!a.parentRoute&&a.__parent?.callback&&(a.parentRoute=a.__parent.callback),a.__parent&&!a.portId&&(typeof a.__parent=="string"?a.__node.tag!==a.__parent&&p._id!==a.__parent&&(a.portId=this.establishMessageChannel(p,a.__parent)):a.__node.tag!==a.__parent?.__node?.tag&&p._id!==a.__parent?.tag&&(a.portId=this.establishMessageChannel(p,a.__parent.worker))),a.parentRoute?(a.stopped||(typeof a.__parent=="string"&&a.__parent===p._id?p.run("subscribe",[a.parentRoute,void 0,void 0,a.callback]):a.__node.tag===a.__parent?.__node?.tag||p._id===a.__parent?.__node?.tag?p.run("subscribe",[a.parentRoute,void 0,void 0,a.callback]):p.run("subscribeToWorker",[a.parentRoute,a.portId,void 0,a.callback,void 0,void 0,a.blocking]).then(d=>{p.workerSubs[a.parentRoute+a.portId].sub=d})),!(typeof a.__parent=="string"&&a.__parent===p._id)&&!(a.__node.tag===a.__parent?.__node?.tag||p._id===a.__parent?.__node?.tag)&&(p.workerSubs[a.parentRoute+a.portId]={sub:null,route:a.parentRoute,portId:a.portId,callback:a.callback,blocking:a.blocking})):a.__parent&&(typeof a.__parent=="string"?(a.stopped||(a.__parent===p._id?p.run("subscribe",[a.__parent,void 0,a.callback]):p.run("subscribeToWorker",[a.__parent,a.portId,void 0,a.callback,void 0,void 0,a.blocking]).then(d=>{p.workerSubs[a.__parent+a.portId].sub=d})),typeof a.__parent=="string"&&a.__parent===p._id||(p.workerSubs[a.__parent+a.portId]={sub:null,route:p._id,portId:a.portId,callback:a.callback,blocking:a.blocking})):a.__parent?.__node?.tag&&a.__parent?.worker&&(a.stopped||(a.__node.tag===a.__parent.__node.tag||p._id===a.__parent.__node.tag?p.run("subscribe",[a.__parent.__node.tag,void 0,void 0,a.callback]):p.run("subscribeToWorker",[a.__parent.__node.tag,a.portId,void 0,a.callback,void 0,void 0,a.blocking]).then(d=>{p.workerSubs[a.__parent.__node.tag+a.portId].sub=d})),a.__node.tag===a.__parent?.__node?.tag||p._id===a.__parent?.__node?.tag||(p.workerSubs[a.__parent.__node.tag+a.portId]={sub:null,route:a.__parent.__node.tag,portId:a.portId,callback:a.callback,blocking:a.blocking}))))}else a.__parent&&a.parentRoute&&(typeof a.__parent=="string"&&n[a.__parent]?.worker?n[a.__parent].worker.subscribe(a.parentRoute,a.__operator,void 0,void 0,void 0,a.blocking):a.__parent?.worker&&a.__parent.worker.subscribe(a.parentRoute,a.__operator,void 0,void 0,void 0,a.blocking));return a}},this.addDefaultMessageListener=()=>{globalThis.onmessage=t=>{let r=this.receive(t.data);this.__node.keepState&&this.setState({[this.name]:r})}},this.postMessage=(t,r,i)=>{this.workers[r]?this.workers[r].send(t,i):globalThis.postMessage(t,r,i)},this.addWorker=t=>{let r;if(t._id||(t._id=`worker${Math.floor(Math.random()*1e15)}`),t.url?r=new vi.default(t.url):t.port?r=t.port:this.workers[t._id]&&(this.workers[t._id].port?r=this.workers[t._id].port:r=this.workers[t._id].worker),!r)return;let i=(_,T)=>this.transmit(_,r,T),n=(_,T,C,I)=>{let P={route:_,args:T};return C&&(P.method=C),this.transmit(P,r,I)},a=(_,T,C,I)=>new Promise((P,U)=>{let H=Math.random(),Q={route:"runRequest",args:[{route:_,args:T},t._id,H]};C&&(Q.args[0].method=C);let W=Be=>{typeof Be.data=="object"&&Be.data.callbackId===H&&(r.removeEventListener("message",W),P(Be.data.args))};r.addEventListener("message",W),this.transmit(Q,r,I)}),p=(_,T,C)=>new Promise((I,P)=>{let U=Math.random(),H={route:"runRequest",args:[_,t._id,U]};T&&(H.method=T);let Q=W=>{typeof W.data=="object"&&W.data.callbackId===U&&(r.removeEventListener("message",Q),I(W.data.args))};r.addEventListener("message",Q),this.transmit(H,r,C)}),d={},y=(_,T,C,I,P,U)=>this.subscribeToWorker(_,t._id,T,C,I,P,U),b=(_,T)=>a("unsubscribe",[_,T]),v=async(_,T,C,I)=>{if(_)await a("subscribeToWorker",[_,T,void 0,C,I]).then(P=>{P&&(d[_+T]={sub:P,route:_,portId:T,callback:C,blocking:I})});else for(let P in d)typeof d[P].sub!="number"&&await a("subscribeToWorker",[d[P].route,d[P].portId,void 0,d[P].callback,void 0,d[P].blocking]).then(U=>{d[P].sub=U}),console.log(JSON.stringify(d));return!0},h=async(_,T)=>{if(_&&T&&d[_+T])await a("unsubscribe",[_,d[_+T].sub]),d[_+T].sub=!1;else for(let C in d)typeof d[C].sub=="number"&&await a("unpipeWorkers",[d[C].route,d[C].portId,d[C].sub]).then(console.log),d[C].sub=!1;return!0},w=()=>{for(let _ in d)typeof d[_].sub=="number"&&a("unpipeWorkers",[d[_].route,d[_].portId,d[_].sub]),d[_].sub=!1;return this.terminate(t._id)};return t.onmessage||(t.onmessage=_=>{this.receive(_.data),this.setState({[t._id]:_.data})}),t.onerror||(t.onerror=_=>{console.error(_.data)}),r.onmessage=t.onmessage,r.onerror=t.onerror,this.workers[t._id]={worker:r,send:i,post:n,run:a,request:p,subscribe:y,unsubscribe:b,terminate:w,start:v,stop:h,postMessage:r.postMessage,workerSubs:d,graph:this,...t},this.workers[t._id]},this.open=this.addWorker,this.toObjectURL=t=>{let r=new Blob([t],{type:"text/javascript"});return URL.createObjectURL(r)},this.transmit=(t,r,i)=>{if(i||(i=this.getTransferable(t)),r instanceof vi.default||r instanceof MessagePort)r.postMessage(t,i);else if(typeof r=="string")this.workers[r]&&(this.workers[r].port?this.workers[r].port.postMessage(t,i):this.workers[r].worker&&this.workers[r].worker.postMessage(t,i));else{let n=Object.keys(this.workers);this.workers[n[this.threadRot]].worker.postMessage(t,i),this.threadRot++,this.threadRot===n.length&&(this.threadRot=0)}return t},this.terminate=t=>{let r;if(typeof t=="string"){let i=this.workers[t];i&&(delete this.workers[t],t=i.worker,i.onclose&&(r=i.onclose))}else typeof t=="object"&&t?._id&&(t=t.worker,delete this.workers[t?._id]);return t instanceof vi.default?(t.terminate(),r&&r(t),!0):t instanceof MessagePort?(t.close(),r&&r(t),!0):!1},this.establishMessageChannel=(t,r)=>{let i;if(typeof t=="string"?(i=t,this.workers[t]&&(this.workers[t].port?t=this.workers[t].port:r=this.workers[t].worker)):t?.worker&&(t=t.worker),typeof r=="string"?this.workers[r]&&(this.workers[r].port?r=this.workers[r].port:r=this.workers[r].worker):r?.worker&&(r=r.worker),t instanceof vi.default||t instanceof MessagePort){let n=new MessageChannel,a=`port${Math.floor(Math.random()*1e15)}`;return t.postMessage({route:"addWorker",args:{port:n.port1,_id:a}},[n.port1]),r instanceof vi.default||r instanceof MessagePort?r.postMessage({route:"addWorker",args:{port:n.port2,_id:a}},[n.port2]):i&&this.workers[i]&&(n.port2.onmessage=this.workers[i].onmessage,this.workers[i].port=n.port2),a}return!1},this.request=(t,r,i,n)=>{let a=this.workers[r].worker;return new Promise((p,d)=>{let y=Math.random(),b={route:"runRequest",args:[t,y]};n&&(b.method=n);let v=h=>{typeof h.data=="object"&&h.data.callbackId===y&&(a.removeEventListener("message",v),p(h.data.args))};a.addEventListener("message",v),this.transmit(b,a,i)})},this.runRequest=(t,r,i)=>{let n=this.receive(t);return typeof r=="string"&&this.workers[r]&&(this.workers[r].port?r=this.workers[r].port:r=this.workers[r].worker),n instanceof Promise?n.then(a=>{r instanceof vi.default||r instanceof MessagePort?r.postMessage({args:a,callbackId:i}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:a,callbackId:i})}):r instanceof vi.default||r instanceof MessagePort?r.postMessage({args:n,callbackId:i}):typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&globalThis.postMessage({args:n,callbackId:i}),n},this.subscribeWorker=(t,r,i,n,a,p)=>{let d;if(p){let y=!1;d=b=>{y||(y=!0,b instanceof Promise?b.then(v=>{r?.run&&r.run("triggerSubscription",[t,r._id,v]).then(h=>{y=!1})}):r?.run&&r.run("triggerSubscription",[t,r._id,b]).then(v=>{y=!1}))}}else d=y=>{y instanceof Promise?y.then(b=>{r?.postMessage?r.postMessage({args:b,callbackId:t}):globalThis.postMessage&&globalThis.postMessage({args:b,callbackId:t})}):r?.postMessage?r.postMessage({args:y,callbackId:t}):globalThis.postMessage&&globalThis.postMessage({args:y,callbackId:t})};return!p&&r?.port?r=r.port:!p&&r?.worker?r=r.worker:typeof r=="string"&&this.workers[r]&&(p?r=this.workers[r]:this.workers[r].port?r=this.workers[r].port:r=this.workers[r].worker),this.subscribe(t,d,i,n,a)},this.subscribeToWorker=(t,r,i,n,a,p,d)=>{if(typeof r=="string"&&this.workers[r])return this.__node.state.subscribeEvent(r,y=>{y?.callbackId===t&&(i?typeof i=="string"?this.run(i,y.args):i(y.args):this.setState({[r]:y.args}))}),this.workers[r].run("subscribeWorker",[t,r,n,a,p,d])},this.triggerSubscription=async(t,r,i)=>{if(this.__node.state.triggers[r])for(let n=0;n<this.__node.state.triggers[r].length;n++)await this.__node.state.triggers[r][n].onchange({args:i,callbackId:t});return!0},this.pipeWorkers=(t,r,i,n,a,p,d,y,b)=>(typeof t=="string"&&(t=this.workers[t]),typeof r=="string"&&(r=this.workers[r]),a||(a=this.establishMessageChannel(t.worker,r.worker)),r.run("subscribeToWorker",[i,a,n,p,d,y,b])),this.unpipeWorkers=(t,r,i)=>{if(typeof r=="string"&&(r=this.workers[r]),typeof r=="object")return r.run("unsubscribe",[t,i])},this.connections={workers:this.workers},e?.services&&this.addServices(e.services),this.load(this),this.setLoaders(this.workerloader),e&&this.init(e),typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope&&this.addDefaultMessageListener()}getTransferable(e){let t;if(typeof e=="object")if(e.args)if(e.args?.constructor?.name==="Object")for(let r in e.args)ArrayBuffer.isView(e.args[r])?t?t.push(e.args[r].buffer):t=[e.args[r].buffer]:e.args[r]?.constructor?.name==="ArrayBuffer"&&(t?t.push(e.args[r]):t=[e.args[r]]);else Array.isArray(e.args)&&e.args.length<11?e.args.forEach(r=>{ArrayBuffer.isView(r)?t=[r.buffer]:r?.constructor?.name==="ArrayBuffer"&&(t=[r])}):ArrayBuffer.isView(e.args)?t=[e.args.buffer]:e.args?.constructor?.name==="ArrayBuffer"&&(t=[e]);else if(e?.constructor?.name==="Object")for(let r in e)ArrayBuffer.isView(e[r])?t?t.push(e[r].buffer):t=[e[r].buffer]:e[r]?.constructor?.name==="ArrayBuffer"&&(t?t.push(e[r]):t=[e[r]]);else Array.isArray(e)&&e.length<11?e.forEach(r=>{ArrayBuffer.isView(r)?t=[r.buffer]:r.constructor?.name==="ArrayBuffer"&&(t=[r])}):ArrayBuffer.isView(e)?t=[e.buffer]:e.constructor?.name==="ArrayBuffer"&&(t=[e]);return t}},qr=na(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]),ld=na(["deltaX","deltaY"]),cd=na(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function Ql(e,t){let r={type:e.type};r.isTrusted=e.isTrusted,r.bubbles=e.bubbles,r.cancelBubble=e.cancelBubble,r.cancelable=e.cancelable,r.composed=e.composed,r.defaultPrevent=e.defaultPrevented,r.eventPhase=e.eventPhase,r.returnValue=e.returnValue,r.currentTarget=e.currentTarget.id?e.currentTarget.id:e.currentTarget.constructor.name,r.target=r.currentTarget,r.srcElement=r.currentTarget,t(r)}function fd(e,t,r){r&&e.preventDefault&&e.preventDefault(),ld(e,t)}function ud(e,t,r){r&&e.preventDefault&&e.preventDefault()}function dd(e,t,r){for(let i of t)r[i]=e[i]}function na(e){return function(r,i){let n={type:r.type};dd(r,e,n),i(n)}}function Uo(e,t,r){r&&e.preventDefault&&e.preventDefault();let i=[],n={type:e.type,touches:i};for(let a=0;a<e.touches.length;++a){let p=e.touches[a];i.push({pageX:p.pageX,pageY:p.pageY})}t(n)}var zo=1,pc={};for(;zo<222;)pc[zo]=!0,zo++;function ec(e,t,r){let{keyCode:i}=e;pc[i]&&(r&&e.preventDefault&&(i<110||i>123)&&e.preventDefault(),cd(e,t))}var jn={contextmenu:ud,mousedown:qr,mousemove:qr,mouseup:qr,pointerdown:qr,pointermove:qr,pointerup:qr,pointerlockchange:qr,webkitpointerlockchange:qr,focus:Ql,blur:Ql,pointerout:qr,touchstart:Uo,touchmove:Uo,touchend:Uo,wheel:fd,keydown:ec,keyup:ec};function sa(e,t,r,i){r||(r="proxy"+Math.floor(Math.random()*1e15));let n=d=>{t?t.postMessage({route:"handleProxyEvent",args:[d,r]}):hc(d,r)},a=Object.entries(jn);for(let[d,y]of a)e.addEventListener(d,function(b){y(b,n,i)});jn.keydown&&globalThis.addEventListener("keydown",function(d){jn.keydown(d,n,i)}),jn.keyup&&globalThis.addEventListener("keyup",function(d){jn.keyup(d,n,i)});let p=()=>{let d=e.getBoundingClientRect();n({type:"resize",left:d.left,top:d.top,width:e.clientWidth,height:e.clientHeight})};return p(),globalThis.addEventListener("resize",p),r}var pd=class{addEventListener(e,t){this.__listeners===void 0&&(this.__listeners={});let r=this.__listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)}hasEventListener(e,t){if(this.__listeners===void 0)return!1;let r=this.__listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1}removeEventListener(e,t){if(this.__listeners===void 0)return;let i=this.__listeners[e];if(i!==void 0){let n=i.indexOf(t);n!==-1&&i.splice(n,1)}}dispatchEvent(e,t){if(this.__listeners===void 0)return;let i=this.__listeners[e.type];if(i!==void 0){t?e.target=t:e.target=this;let n=i.slice(0);for(let a=0,p=n.length;a<p;a++)n[a].call(this,e)}}};function tc(){}var hd=class extends pd{constructor(){super(),this.__listeners={},this.style={},this.setPointerCapture=()=>{},this.releasePointerCapture=()=>{},this.getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}),this.handleEvent=e=>{e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),e.preventDefault=tc,e.stopPropagation=tc,this.dispatchEvent(e,this.proxied)},this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}},Ls=class{constructor(){this.targets={},this.makeProxy=(e,t=void 0)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let r;this.targets[e]?r=this.targets[e]:(r=new hd,this.targets[e]=r),typeof t=="object"&&(t.proxy=r,r.proxied=t,typeof WorkerGlobalScope<"u"&&(t.style=r.style),r.width&&(t.style.width=r.width+"px",t.clientWidth=r.width),r.height&&(t.style.height=r.height+"px",t.clientHeight=r.height),t.setPointerCapture=r.setPointerCapture.bind(r),t.releasePointerCapture=r.releasePointerCapture.bind(r),t.getBoundingClientRect=r.getBoundingClientRect.bind(r),t.addEventListener=r.addEventListener.bind(r),t.removeEventListener=r.removeEventListener.bind(r),t.handleEvent=r.handleEvent.bind(r),t.dispatchEvent=r.dispatchEvent.bind(r),t.focus=r.focus.bind(r),t.blur=r.blur.bind(r))},this.getProxy=e=>this.targets[e],this.handleEvent=(e,t)=>{if(this.targets[t]||this.makeProxy(t),this.targets[t])return this.targets[t].handleEvent(e),!0},globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}};function gd(e,t){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new Ls),this.__node.graph.ProxyManager.makeProxy(e,t)):(globalThis.ProxyManager||(globalThis.ProxyManager=new Ls),globalThis.ProxyManager.makeProxy(e,t)),e}function hc(e,t){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new Ls),this.__node.graph.ProxyManager.handleEvent(e,t))return e}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new Ls),globalThis.ProxyManager.handleEvent(e,t))return e}var oa={initProxyElement:sa,makeProxy:gd,handleProxyEvent:hc};function yd(e){if(e.worker){let t=e.worker,r=e.route;return(t instanceof Blob||typeof t=="string")&&(t=new Worker(t)),delete e.worker,delete e.route,gc(t,e,r)}else return sa(e.canvas,void 0,e._id,e.preventDefault),yc(e)}function gc(e,t,r){if(console.log(t),!t)return;t._id||(t._id=`canvas${Math.floor(Math.random()*1e15)}`);let i=t.canvas.transferControlToOffscreen();t.width||(t.width=t.canvas.clientWidth),t.height||(t.height=t.canvas.clientHeight);let n={route:r||"setupCanvas",args:{...t,canvas:i}};this?.__node?.graph?this.__node.graph.run("initProxyElement",t.canvas,e,t._id,t.preventDefault):sa(t.canvas,e,t._id,t.preventDefault),t.draw&&(typeof t.draw=="function"?n.args.draw=t.draw.toString():n.args.draw=t.draw),t.update&&(typeof t.update=="function"?n.args.update=t.update.toString():n.args.update=t.update),t.init&&(typeof t.init=="function"?n.args.init=t.init.toString():n.args.init=t.init),t.clear&&(typeof t.clear=="function"?n.args.clear=t.clear.toString():n.args.clear=t.clear);let a=[i];return t.transfer&&(a.push(...t.transfer),delete t.transfer),e.postMessage(n,a),{_id:t._id,width:t.width,height:t.height,worker:e,draw:(d,y)=>{e.postMessage({route:"drawFrame",args:[d,t._id]},y)},update:(d,y)=>{e.postMessage({route:"updateCanvas",args:[d,t._id]},y)},clear:()=>{e.postMessage({route:"clearCanvas",args:t._id})},init:()=>{e.postMessage({route:"initCanvas",args:t._id})},stop:()=>{e.postMessage({route:"stopAnim",args:t._id})},start:()=>{e.postMessage({route:"startAnim",args:t._id})},set:(d,y)=>{e.postMessage({route:"setDraw",args:[d,t._id]},y)},terminate:()=>{e.terminate()}}}function Fs(e,t){let r;if(this?.__node?.graph?t?r=this.__node.graph.CANVASES?.[e._id]:e._id?r=this.__node.graph.CANVASES?.[e._id]:r=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:t||e._id?r=globalThis.CANVASES?.[e._id]:r=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],r)return e.canvas&&(r.canvas=e.canvas,this?.__node?.graph?this.__node.graph.run("makeProxy",r._id,r.canvas):oa.makeProxy(r._id,r.canvas)),typeof e.context=="string"?r.context=r.canvas.getContext(e.context):e.context&&(r.context=e.context),e.width&&(r.canvas.width=e.width),e.height&&(r.canvas.height=e.height),typeof e.draw=="string"&&(e.draw=Vr(e.draw)),typeof e.draw=="function"&&(r.draw=e.draw.bind(e)),typeof e.update=="string"&&(e.update=Vr(e.update)),typeof e.update=="function"&&(r.update=e.update.bind(e)),typeof e.init=="string"&&(e.init=Vr(e.init)),typeof e.init=="function"&&(r.init=e.init.bind(e)),typeof e.clear=="string"&&(e.clear=Vr(e.clear)),typeof e.clear=="function"&&(r.clear=e.clear.bind(e)),e._id}function yc(e){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let t=e;if(e._id?t._id=e._id:t._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof e.context=="string"?t.context=e.canvas.getContext(e.context):t.context=e.context,"animating"in e?t.animating=e.animating:t.animating=!0,this?.__node?.graph?.CANVASES[t._id])this.__node.graph.run("setDraw",t);else if(globalThis.CANVASES?.[t._id])Fs(t);else if(this?.__node?.graph&&(t.graph=this.__node.graph,t.__node||(t.__node={}),t.__node.tag||(t.__node.tag=t._id),t=this.__node.graph.add(t),t.__addOndisconnected=()=>{t.stop(),delete this.__node.graph.CANVASES[t._id]}),this?.__node?.graph?this.__node.graph.CANVASES[t._id]=t:globalThis.CANVASES[t._id]=t,this?.__node?.graph?this.__node.graph.run("makeProxy",t._id,t.canvas):oa.makeProxy(t._id,t.canvas),e.width&&(t.canvas.width=e.width),e.height&&(t.canvas.height=e.height),typeof t.draw=="string"?t.draw=Vr(t.draw):typeof t.draw=="function"&&(t.draw=t.draw.bind(t)),typeof t.update=="string"?t.update=Vr(t.update):typeof t.update=="function"&&(t.update=t.update.bind(t)),typeof t.init=="string"?t.init=Vr(t.init):typeof t.init=="function"&&(t.init=t.init.bind(t)),typeof t.clear=="string"?t.clear=Vr(t.clear):typeof t.clear=="function"&&(t.clear=t.clear.bind(t)),typeof t.init=="function"&&t.init(t,t.canvas,t.context),t.stop=()=>{Bs(t._id)},t.start=r=>{Ko(t._id,r)},t.set=r=>{Fs(r,t._id)},typeof t.draw=="function"&&t.animating){let r=(i,n,a)=>{i.animating&&(i.draw(i,n,a),requestAnimationFrame(()=>{r(i,n,a)}))};r(t,t.canvas,t.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?t._id:{_id:e._id,width:e.width,height:e.height,draw:i=>{bc(i,e._id)},update:i=>{vc(i,e._id)},clear:()=>{mc(e._id)},init:()=>{_c(e._id)},stop:()=>{Bs(e._id)},start:()=>{Ko(e._id)},set:i=>{Fs(i,e._id)},terminate:()=>{this.__node?.graph?this.__node.graph.remove(e._id):(Bs(e._id),this?.__node?.graph?delete this.__node.graph.CANVASES[t._id]:delete globalThis.CANVASES[t._id])}}}function bc(e,t){let r=oi.call(this,t);if(r&&(e&&Object.assign(r,e),r.draw))return r.draw(r,r.canvas,r.context),t}function mc(e){let t=oi.call(this,e);if(t?.clear)return t.clear(t,t.canvas,t.context),e}function _c(e){let t=oi.call(this,e);if(t?.init)return t.init(t,t.canvas,t.context),e}function vc(e,t){let r=oi.call(this,t);if(r?.update)return r.update(r,r.canvas,r.context,e),t}function bd(e,t){let r=oi.call(this,t);if(r)return Object.assign(r,e),e.width&&(r.canvas.width=e.width),e.height&&(r.canvas.height=e.height),t}function Ko(e,t){let r=oi.call(this,e);if(r.animating=!0,r&&t)return typeof t=="string"&&(t=Vr(t)),typeof t=="function"&&(r.draw=t),e;if(typeof r?.draw=="function"){let i=(n,a,p)=>{n.animating&&(n.draw(n,a,p),requestAnimationFrame(()=>{i(n,a,p)}))};return typeof r.clear=="function"&&r.clear(r,r.canvas,r.context),typeof r.init=="function"&&r.init(r,r.canvas,r.context),i(r,r.canvas,r.context),e}}function Bs(e){let t=oi.call(this,e);if(t)return t.animating=!1,typeof t.clear=="function"&&requestAnimationFrame(t.clear(t,t.canvas,t.context)),e}function oi(e){let t;return this?.__node?.graph?e?t=this.__node.graph.CANVASES?.[e]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t}var md={...oa,Renderer:yd,transferCanvas:gc,setupCanvas:yc,setDraw:Fs,drawFrame:bc,clearCanvas:mc,initCanvas:_c,updateCanvas:vc,setProps:bd,startAnim:Ko,stopAnim:Bs,getCanvas:oi};function Vr(e=""){let t=p=>p.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),i=(p=>{let d=p.indexOf("=>")+1;return d<=0&&(d=p.indexOf("){")),d<=0&&(d=p.indexOf(") {")),p.slice(0,p.indexOf("{",d)+1)})(e),n=t(e),a;if(i.includes("function")){let p=i.split("(")[1].split(")")[0];a=new Function(p,n)}else if(i.substring(0,6)===n.substring(0,6)){let p=i.split("(")[1].split(")")[0];a=new Function(p,n.substring(n.indexOf("{")+1,n.length-1))}else try{a=(0,eval)(i+n+"}")}catch{}return a}var _d='(()=>{var __require=(x=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof require!=="undefined"?require:a)[b]}):x)(function(x){if(typeof require!=="undefined")return require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x+\'" is not supported\')});var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __require2=(x=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x)(function(x){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x+\'" is not supported\')});var __commonJS=(cb,mod)=>function __require22(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_browser=__commonJS({"node_modules/web-worker/cjs/browser.js"(exports,module2){module2.exports=Worker}});var EventHandler=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.ctr=0;this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}if(this.triggers[statesubKey]){let run=fn=>{fn(updateObj)};this.triggers[statesubKey].forEach(v=>{run(v.onchange)})}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value,this.triggers[key]);this.triggers[key].forEach(fn)}};this.subscribeState=onchange=>{return this.subscribeEvent(statesubKey,onchange)};this.unsubscribeState=sub=>{return this.unsubscribeEvent(statesubKey,sub)};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.ctr;this.ctr++;this.triggers[key].push({sub:l,onchange});return l}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(sub===void 0){delete this.triggers[key];delete this.data[key]}else{let idx=void 0;let obj=triggers.find((o,i2)=>{if(o.sub===sub){idx=i2;return true}});if(obj)triggers.splice(idx,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed);return sub};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var statesubKey="*s";var state=new EventHandler;var GraphNode=class{constructor(properties,parent,graph){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state};this.__setProperties=(properties2,parent2,graph2)=>{let enforceProperties=()=>{let orig=properties2;if(typeof properties2==="function"){if(isNativeClass(properties2)){properties2=new properties2}else properties2={__operator:properties2,__node:{forward:true,tag:properties2.name}}}else if(typeof properties2==="string"){if(graph2?.get(properties2)){properties2=graph2.get(properties2)}}if(!("__node"in properties2))properties2.__node={};if(!properties2.__node.initial)properties2.__node.initial=orig};enforceProperties();if(typeof properties2==="object"){let assignState=()=>{if(properties2.__node?.state)this.__node.state=properties2.__node.state;else if(graph2){properties2.__node.state=graph2.__node.state}};let setProps2=()=>{if(properties2.__props){if(typeof properties2.__props==="function")properties2.__props=new properties2.__props;if(typeof properties2.__props==="object"){this.__proxyObject(properties2.__props)}}};let setTag=()=>{if(!properties2.__node.tag){if(properties2.__operator?.name)properties2.__node.tag=properties2.__operator.name;else properties2.__node.tag=`node${Math.floor(Math.random()*1e15)}`}};let setNode=()=>{if(typeof properties2.__node==="string"){if(graph2?.get(properties2.__node.tag)){properties2=graph2.get(properties2.__node.tag)}else properties2.__node={}}else if(!properties2.__node)properties2.__node={};if(graph2){properties2.__node.graph=graph2}if(properties2 instanceof Graph)properties2.__node.source=properties2};let setParent=()=>{if(!properties2.__parent&&parent2)properties2.__parent=parent2;if(parent2?.__node&&!(parent2 instanceof Graph||properties2 instanceof Graph))properties2.__node.tag=parent2.__node.tag+"."+properties2.__node.tag;if(parent2 instanceof Graph&&properties2 instanceof Graph){if(properties2.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties2.__node.loaders);if(parent2.__node.mapGraphs){properties2.__node.nodes.forEach(n=>{parent2.set(properties2.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties2.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties2.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}};let setOp=()=>{if(typeof properties2.default==="function"&&!properties2.__operator){properties2.__operator=properties2.default}if(properties2.__operator){if(typeof properties2.__operator==="string"){if(graph2){let n=graph2.get(properties2.__operator);if(n)properties2.__operator=n.__operator;if(!properties2.__node.tag&&properties2.__operator.name)properties2.__node.tag=properties2.__operator.name}}if(typeof properties2.__operator==="function")properties2.__operator=this.__setOperator(properties2.__operator);if(properties2.default)properties2.default=properties2.__operator}};let assignProps=()=>{properties2.__node=Object.assign(this.__node,properties2.__node);let keys2=Object.getOwnPropertyNames(properties2);for(const key of keys2){if(key in properties2)this[key]=properties2[key]}};let bindCallbacks=()=>{if(this.__onconnected){if(typeof this.__onconnected==="function"){this.__onconnected=this.__onconnected.bind(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected=this.__onconnected.map(f=>{return f.bind(this)})}if(typeof this.__ondisconnected==="function"){this.__ondisconnected=this.__ondisconnected.bind(this)}else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected=this.__ondisconnected.map(f=>{return f.bind(this)})}}};assignState();setTag();setProps2();setNode();setParent();assignProps();bindCallbacks();setOp()}};this.__subscribe=(callback,key,subInput,target,tkey,args)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>target2?target2:callback2,triggerCallback=callback)=>{if(args){triggerCallback=wrapArgs(triggerCallback,args,this.__node.graph)}let sub=this.__node.state.subscribeEvent(k,triggerCallback,this,key);let trigger=this.__node.state.getEvent(k,sub);if(!this.__listeners)this.__listeners={};this.__listeners[k]=this.__node.state.triggers[k];if(!trigger)return sub;trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback,target);if(subInput)trigger.subInput=subInput;if(args)trigger.__args=args;if(tkey)trigger.tkey=tkey;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){target=callback2.substring(0,callback2.lastIndexOf("."));let n=this.__node.graph.get(callback2.substring(0,target));tkey=callback2.lastIndexOf(".")+1;if(n&&typeof n[key]==="function")callback2=(...args2)=>{return n[tkey](...args2)}}else if(fn.__operator){callback2=fn.__operator;tkey="__operator"}};if(key){if(!this.__node.localState||!this.__node.localState[key]){this.__addLocalState(this,key)}if(typeof callback==="string"){tkey=callback;if(target){if(this.__node.graph?.get(target)){let n=this.__node.graph?.get(target);if(typeof n[callback]==="function"){let fn=n[callback];callback=(...inp)=>{fn(...inp)}}else{let k2=callback;let setter=inp=>{n[k2]=inp};callback=setter}}}else if(typeof this[callback]==="function"){let fn=this[callback];callback=(...inp)=>{fn(...inp)}}else if(this.__node.graph?.get(callback))subscribeToGraph(callback);if(typeof callback!=="function")return void 0}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}else{if(typeof callback==="string"){if(this.__node.graph.get(callback))callback=this.__node.graph.get(callback);tkey="__operator";if(typeof callback!=="object")return void 0}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node){sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)})}return sub}};this.__unsubscribe=(sub,key,unsubInput)=>{if(key){return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub)}else return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);if(this.__args&&this.__node.graph){fn=wrapArgs(fn,this.__args,this.__node.graph)}let inpstr=`${this.__node.unique}input`;this.__operator=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(this.__parent instanceof GraphNode&&!this.__subscribedToParent){if(this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__addLocalState=(props,key)=>{if(!props)return;if(!this.__node.localState){this.__node.localState={}}const localState=this.__node.localState;const initState=(props2,k)=>{let str2=this.__node.unique+"."+k;let inpstr=`${str2}input`;if(typeof props2[k]==="function"&&k!=="__operator"){let fn=props2[k].bind(this);props2[k]=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[str2]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.triggerEvent(str2,res)}).catch(console.error)}else this.__node.state.triggerEvent(str2,result)}return result}}else{let get,set;if(this.__props?.[k]){get=()=>{return this.__props[k]};set=v=>{this.__props[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}else{localState[k]=props2[k];get=()=>{return localState[k]};set=v=>{localState[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}const descriptor={get,set,enumerable:true,configurable:true};Object.defineProperty(props2,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}};if(key)initState(props,key);else{for(let k in props){initState(props,k)}}};this.__proxyObject=obj=>{const allProps=getAllProperties(obj);for(const k of allProps){if(typeof obj[k]==="function"){this[k]=(...args)=>{return obj[k](...args)}}else{const descriptor={get:()=>{return obj[k]},set:value=>{obj[k]=value},enumerable:true,configurable:true};Object.defineProperty(this,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}}};this.__setProperties(properties,parent,graph)}__addOnconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__onconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){let fn=o=>{o(this)};this.__onconnected.forEach(fn)}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let fn=o=>{o(this)};this.__ondisconnected.forEach(fn)}}};var Graph=class{constructor(options){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state,roots:{}};this.init=options2=>{if(options2){let cpy=Object.assign({},options2);delete cpy.roots;recursivelyAssign(this.__node,cpy);if(options2.roots)this.load(options2.roots)}};this.load=roots=>{function recursivelyAssignChildren(target,obj,inChildren=true,top=true){if(top){if(target)Object.assign(target,obj);else target=Object.assign({},obj);recursivelyAssignChildren(target,obj,true,false)}if(obj.__children&&!inChildren){if(obj.__children?.constructor.name==="Object"){if(target.__children?.constructor.name==="Object")recursivelyAssignChildren(target.__children,obj.__children,true,false);else target.__children=recursivelyAssignChildren({},obj.__children,true,false)}else{target.__children=obj.__children}}else if(inChildren){for(const key in obj){target[key]=Object.assign({},obj[key]);if(obj[key].__children){recursivelyAssignChildren({},obj[key].__children,false,false)}}}return target}this.__node.roots=recursivelyAssignChildren(this.__node.roots?this.__node.roots:{},roots);let cpy=Object.assign({},roots);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,roots);if(roots.__node){if(!roots.__node.tag)roots.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(roots.__node.tag)){let node=new GraphNode(roots,this,this);this.set(node.__node.tag,node);this.runLoaders(node,this,roots,roots.__node.tag);if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(roots.__listeners){this.setListeners(roots.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders2,replace)=>{if(replace)this.__node.loaders=loaders2;else Object.assign(this.__node.loaders,loaders2);return this.__node.loaders};this.runLoaders=(node,parent,properties,key)=>{for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders[l]==="function")this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key)}};this.add=(properties,parent)=>{let listeners={};if(typeof parent==="string")parent=this.get(parent);let instanced;if(typeof properties==="function"){if(isNativeClass(properties)){if(properties.prototype instanceof GraphNode){properties=properties.prototype.constructor(properties,parent,this);instanced=true}else properties=new properties}else properties={__operator:properties}}else if(typeof properties==="string"){properties=this.__node.roots[properties]}if(!properties)return;if(!instanced){let keys2=Object.getOwnPropertyNames(properties);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(properties));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys2.push(...nonArrowFunctions);let cpy={};for(const key of keys2){cpy[key]=properties[key]}properties=cpy}if(!properties.__node)properties.__node={};properties.__node.initial=properties;if(typeof properties==="object"&&!this.get(properties.__node.tag)){let node;if(instanced)node=properties;else node=new GraphNode(properties,parent,this);this.set(node.__node.tag,node);this.runLoaders(node,parent,properties,node.__node.tag);this.__node.roots[node.__node.tag]=properties;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key in node.__listeners){let listener=node.__listeners[key];if(node[key]){delete listeners[node.__node.tag][key];listeners[node.__node.tag][node.__node.tag+"."+key]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][key]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][key]=parent.__node.tag}}}}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t2,parent,listeners={},origin)=>{let keys2=Object.getOwnPropertyNames(origin);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(origin));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys2.push(...nonArrowFunctions);for(const key of keys2){if(key.includes("__"))continue;let p=origin[key];if(Array.isArray(p))continue;let instanced;if(typeof p==="function"){if(isNativeClass(p)){p=new p;if(p instanceof GraphNode){p=p.prototype.constructor(p,parent,this);instanced=true}}else p={__operator:p}}else if(typeof p==="string"){if(this.__node.nodes.get(p))p=this.__node.nodes.get(p);else p=this.__node.roots[p]}else if(typeof p==="boolean"){if(this.__node.nodes.get(key))p=this.__node.nodes.get(key);else p=this.__node.roots[key]}if(typeof p==="object"){if(!instanced&&!(p instanceof GraphNode)){let ks=Object.getOwnPropertyNames(p);let nonArrowFunctions2=Object.getOwnPropertyNames(Object.getPrototypeOf(p));nonArrowFunctions2.splice(nonArrowFunctions2.indexOf("constructor"),1);ks.push(...nonArrowFunctions2);let cpy={};for(const key2 of ks){cpy[key2]=p[key2]}p=cpy}if(!p.__node)p.__node={};if(!p.__node.tag)p.__node.tag=key;if(!p.__node.initial)p.__node.initial=t2[key];if(this.get(p.__node.tag)&&!(!(parent instanceof Graph)&&parent?.__node)||parent?.__node&&this.get(parent.__node.tag+"."+p.__node.tag))continue;let node;let newnode=false;if(instanced||p instanceof GraphNode){node=p}else{node=new GraphNode(p,parent,this);newnode=true}if(!newnode&&p instanceof GraphNode&&!instanced&&parent instanceof GraphNode){let sub=this.subscribe(parent.__node.tag,node.__node.tag);let ondelete=node2=>{this.unsubscribe(parent.__node.tag,sub)};node.__addOndisconnected(ondelete)}else if(node){this.set(node.__node.tag,node);this.runLoaders(node,parent,t2[key],key);t2[key]=node;this.__node.roots[node.__node.tag]=p;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key2 in node.__listeners){let listener=node.__listeners[key2];let k=key2;if(node[key2]){delete listeners[node.__node.tag][key2];k=node.__node.tag+"."+key2;listeners[node.__node.tag][k]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][k]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][k]=parent.__node.tag}}}}node.__callConnected()}}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){this.delete(node.__node.tag);delete this.__node.roots[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t2=>{for(const key in t2){this.unsubscribe(t2[key]);this.delete(t2[key].__node.tag);delete this.__node.roots[t2[key].__node.tag];this.delete(key);delete this.__node.roots[key];t2[key].__node.tag=t2[key].__node.tag.substring(t2[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t2[key])}t2[key].__callDisconnected();if(t2[key].__children){recursiveRemove(t2[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}if(node?.__node.graph)node.__node.graph=void 0;return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(!node)continue;if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(node.__operator&&(listeners[key][k][kk].__callback===true||typeof listeners[key][k][kk].__callback==="undefined"))listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(nn){let prop=k.substring(k.lastIndexOf(".")+1);sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k][kk].__args,prop,listeners[key][k][kk].inputState,key,k)}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}if("__callback"in listeners[key][k]){if(listeners[key][k].__callback===true||typeof listeners[key][k].__callback==="undefined")listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k)}}else{sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key]?.sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(typeof node.__listeners[key]==="object"&&!node.__listeners[key]?.__callback){for(const k in node.__listeners[key]){if(typeof node.__listeners[key][k]?.sub==="number"){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}else{if(typeof!node.__listeners[key]?.__callback==="number"){for(const k in node.__listeners[key]){if(node.__listeners[key][k]?.sub){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){let cpy;if(getInitial)cpy=Object.assign({},this.__node.roots[node.__node.tag]);else{cpy=Object.assign({},node);for(const key in cpy){if(key.includes("__"))delete cpy[key]}}}};this.subscribe=(nodeEvent,onEvent,args,key,subInput,target,bound,tkey)=>{let nd=nodeEvent;if(typeof nodeEvent==="string"){nd=this.get(nodeEvent);if(!nd&&nodeEvent.includes(".")){nd=this.get(nodeEvent.substring(0,nodeEvent.lastIndexOf(".")));key=nodeEvent.substring(nodeEvent.lastIndexOf(".")+1)}}if(target instanceof GraphNode)target=target.__node.tag;if(typeof onEvent==="string"){let setOnEventFromString=onEvent2=>{if(this.get(onEvent2)?.__operator){let node=this.get(onEvent2);target=onEvent2;onEvent2=function(...inp){return node.__operator(...inp)}}else if(onEvent2.includes(".")){target=onEvent2.substring(0,onEvent2.lastIndexOf("."));let n=this.get(target);let k=onEvent2.substring(onEvent2.lastIndexOf(".")+1);tkey=k;if(typeof n[k]==="function"){if(n[k]instanceof GraphNode)onEvent2=n[k];else onEvent2=function(...inp){return n[k](...inp)}}else{onEvent2=function(inp){n[k]=inp;return n[k]}}}return onEvent2};if(target){let node=this.get(target);if(typeof node?.[onEvent]==="function"){tkey=onEvent;onEvent=function(...inp){return node[key](...inp)}}else if(node[key]){tkey=key;if(node[key]instanceof GraphNode)onEvent=node[key];else onEvent=function(inp){node[key]=inp;return node[key]}}else{onEvent=setOnEventFromString(onEvent)}}else{onEvent=setOnEventFromString(onEvent)}}let sub;if(nd instanceof GraphNode){const doSub=()=>{sub=nd.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)nd.__unsubscribe(sub,key,subInput);sub=void 0};nd.__addOndisconnected(()=>{ondelete();nd.__addOnconnected(()=>{if(sub===void 0&&nd.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))onEvent=this.get(onEvent);if(onEvent instanceof GraphNode){onEvent.__addOndisconnected(()=>{ondelete()})}};doSub()}else if(typeof nodeEvent==="string"){let node=this.get(nodeEvent);if(node){if(onEvent instanceof GraphNode&&onEvent.__operator){const doSub=()=>{sub=node.__subscribe(onEvent.__operator,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput)};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});onEvent.__addOndisconnected(ondelete)};doSub()}else if(typeof onEvent==="function"||typeof onEvent==="string"){const doSub=()=>{sub=node.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput);sub=void 0};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))this.get(onEvent).__addOndisconnected(ondelete)};doSub()}}else{if(typeof onEvent==="string")onEvent=this.__node.nodes.get(onEvent).__operator;if(typeof onEvent==="function")sub=this.__node.state.subscribeEvent(nodeEvent,onEvent)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"){if(target[key]?.constructor.name==="Object")recursivelyAssign(target[key],obj[key]);else target[key]=recursivelyAssign({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);let fn=function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)};props.forEach(fn)}while(curr=Object.getPrototypeOf(curr));return allProps}function isNativeClass(thing){return isFunction(thing)==="class"}function isFunction(x){const res=typeof x==="function"?x.prototype?Object.getOwnPropertyDescriptor(x,"prototype")?.writable?"function":"class":x.constructor.name==="AsyncFunction"?"async":"arrow":"";return res}var wrapArgs=(callback,argOrder,graph)=>{let args=[];let getCallbackFromString=a=>{if(graph.get(a)?.__operator){let node=graph.get(a);return(...inp)=>{node.__operator(...inp)}}else if(a.includes(".")){let split=a.split(".");let popped=split.pop();let joined=split.join(".");let node=graph.get(joined);if(typeof graph.get(joined)?.[popped]==="function"){return(...inp)=>{return node[popped](...inp)}}else return()=>{return node[popped]}}else if(graph.get(a)){let node=graph.get(a);return()=>{return node}}else{let arg=a;return()=>{return arg}}};let forArg=(a,i2)=>{if(a==="__output"||a==="__input"){args[i2]=inp=>{return inp}}else if(typeof a==="string"){args[i2]=getCallbackFromString(a)}else if(typeof a==="function"){let fn2=a;args[i2]=(...inp)=>{return fn2(...inp)}}else if(typeof a==="object"&&a.__input){let recursivelyCreateCallback=function(c){let input=c.__input;if(typeof c.__input==="string"){input=getCallbackFromString(c.__input)}if(c.__args){input=wrapArgs(input,c.__args,graph)}if(c.__output){let output=c.__output;if(typeof c.__output==="string"){output=getCallbackFromString(output)}else if(typeof a.__output==="object"){output=recursivelyCreateCallback(output)}if(typeof output==="function"){let fn2=input;input=(...inp)=>{return output(fn2(...inp))}}}return input};args[i2]=recursivelyCreateCallback(a)}else{let arg=a;args[i2]=()=>{return arg}}};argOrder.forEach(forArg);if(typeof callback==="string")callback=getCallbackFromString(callback);let fn=callback;callback=function(...inp){let mapArg=arg=>{return arg(...inp)};return fn(...args.map(mapArg))};return callback};var backprop=(node,parent,graph)=>{if(node.__node.backward&&parent instanceof GraphNode){graph.setListeners({[parent.__node.tag]:{[node.__node.tag]:parent}})}};var loop=(node,parent,graph)=>{if(node.__operator&&!node.__node.looperSet){if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})})}else if(node.__node.frame===true){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})})}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__setOperator(async(...args)=>{let i2=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i2,...args);return result})}if(node.__node.loop&&typeof node.__node.loop==="number"){node.__node.looperSet=true;let fn=node.__operator;let time=node.__node.loop;node.__setOperator((...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){let last=performance.now();fn(...args);setTimeout(()=>{let now=performance.now();let overshoot=now-last-node.__node.loop;if(overshoot>0)time=node.__node.loop-overshoot;else time=node.__node.loop;if(time<=0)time=node.__node.loop;node.__operator(...args)},time)}});if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate=(node,parent,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__setOperator((...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}});if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator)},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching=(node,parent,graph)=>{if(typeof node.__branch==="object"&&node.__operator&&!node.__branchApplied){let fn=node.__operator;node.__branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__branch){let triggered=()=>{if(typeof node.__branch[key].then==="function"){node.__branch[key].then(result)}else if(node.__branch[key].then instanceof GraphNode&&node.__branch[key].then.__operator){node.__branch[key].then.__operator(result)}else result=node.__branch[key].then};if(typeof node.__branch[key].if==="function"){if(node.__branch[key].if(result)==true){triggered()}}else if(node.__branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator=(node,parent,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.roots?.[node.__node.tag]==="object"&&node.get)graph.__node.roots[node.__node.tag].get=node.get};var loaders={backprop,loop,animate,branching,triggerListenerOncreate,bindListener,transformListenerResult,substitute__operator};var recursivelyStringifyFunctions=obj=>{let cpy={};for(const key in obj){if(typeof obj[key]==="object"){cpy[key]=recursivelyStringifyFunctions(obj[key])}else if(typeof obj[key]==="function"){cpy[key]=obj[key].toString()}else cpy[key]=obj[key]}return cpy};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function methodstrings(node){if(typeof node.__methods==="object"){for(const key in node.__methods){let fstr=node.__methods[key];let fn=typeof fstr==="function"?fstr:parseFunctionFromText(fstr);if(key==="__operator"){node.__setOperator(fn)}else{node[key]=fn.bind(node)}}}}var Service=class extends Graph{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders},options.loaders):{...loaders}});this.name=`service${Math.floor(Math.random()*1e15)}`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.load(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.roots[route]}if(src?.[m]){if(typeof src[m]!=="function"){if(args){if(Array.isArray(args)&&args.length===1)src[m]=args[0];else src[m]=args;return}return src[m]}else{if(Array.isArray(args))return src[m](...args);else return src[m](args)}}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))args[0]=args[0].replace(/\\\\/g,"");if(args[0][0]===\'"\'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return source.__node.state.subscribeEventOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeEventOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray;this.recursivelyAssign=recursivelyAssign2;this.spliceTypedArray=spliceTypedArray;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};this.log=(...args)=>{console.log(...args);return true};this.error=(...args)=>{console.error(...args);return true};if(options?.services)this.addServices(options.services);this.load(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}var recursivelyAssign2=(target,obj)=>{for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign2(target[key],obj[key]);else target[key]=recursivelyAssign2({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str2;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str2=recursivelyStringifyFunctions(properties)}else if(typeof properties==="function")str2=properties.toString();else if(typeof properties==="string")str2=properties;if(str2){if(connection.run)return connection.run("setNode",[str2]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str2},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str2}));return new Promise(r=>r(name2))}}},setNode:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function")properties={__operator:f,__node:{tag:name2?name2:f.name}};else{f=JSON.parse(properties);if(typeof f==="object")properties=f}}if(typeof properties==="object"||typeof properties==="function"){let template={};if(typeof properties==="object")Object.assign(template,properties);else template.__operator=properties;let node=this.__node.graph.add(template);if(node){nodeTemplates[node.__node.tag]=template;return node.__node?.tag}else return false}else return false},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]==="function"){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str2=recursivelyStringifyFunctions(properties);return str2},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function"){if(!name2)name2=f.name;properties={__operator:f,__node:{tag:name2}}}else{f=JSON.parse(properties);if(typeof f==="object"){properties=f;if(!name2&&f.__node?.tag)name2=f.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=recursivelyAssign2({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(nodeTag,fn,methodKey){if(typeof fn==="string"){let f=parseFunctionFromText(fn);if(typeof f==="function")fn=f}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(nodeTag)){this.__node.graph.get(nodeTag)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key in properties){result[key]=typeof node[key]}return result}return void 0},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str2=classObj.toString();let message={route:"receiveClass",args:[str2,className]};if(connection.run)return connection.run("receiveClass",[str2,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str2,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str2,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str2=fn.toString();let message={route:"setNode",args:[str2,fnName]};if(connection.run)return connection.run("setNode",[str2,fnName]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:[str2,fnName]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:[str2,fnName]}));return new Promise(r=>r(name))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};function html(strings,...args){return function append(elm=document.createElement("div")){let template=document.createElement("template");strings.map(function(s,i2){template.innerHTML+=s;if(args[i2]instanceof HTMLElement){let dummy2=`<span id="dummyNode12345"></span>`;dummy2.id="dummyNode12345";template.innerHTML+=dummy2}else template.innerHTML+=args[i2]});let query=template.content.querySelectorAll("#dummyNode12345");let ctr=0;args.forEach((arg,i2)=>{if(arg instanceof HTMLElement){console.log(arg,query[ctr]);template.content.replaceChild(arg,query[ctr]);ctr++}});elm.appendChild(template.content);return elm}}var dummy=html``;var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,n,m,p;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d[m]=f,n=h[e=h[l=h[f]]],p=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t(a,b,c){if(4!==b.length)throw new sjcl.exception.invalid("invalid aes block size");var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,k,l,n=d.length/4-2,m,p=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v=h[2],w=h[3],x=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v[g>>8&255]^w[b&255]^d[p],k=a[f>>>24]^q[g>>16&255]^v[b>>8&255]^w[e&255]^d[p+1],l=a[g>>>24]^q[b>>16&255]^v[e>>8&255]^w[f&255]^d[p+2],b=a[b>>>24]^q[e>>16&255]^v[f>>8&255]^w[g&255]^d[p+3],p+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x[e>>>24]<<24^x[f>>16&255]<<16^x[g>>8&255]<<8^x[b&255]^d[p++],h=e,e=f,f=g,g=b,b=h;return r}sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.$(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},$:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\\s|0x/g,"");d=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32.B,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.X);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}throw new sjcl.exception.invalid("this isn\'t "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d,l^=n<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.B,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\\s|=/g,"");var c=[],d,e=0,f=sjcl.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));if(0>h)throw new sjcl.exception.invalid("this isn\'t base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl.hash.sha256.hash=function(a){return new sjcl.hash.sha256().update(a).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.A=sjcl.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u(this,d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d,e;64>b;c++){e=true;for(d=2;d*d<=c;d++)if(0===c%d){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u(a,b){var c,d,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d=b[c]:(d=b[c+1&15],e=b[c+14&15],d=b[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d=d+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p^r))+g[c],q=r,r=p,p=m,m=n+d|0,n=l,l=k,k=h,h=d+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.G.indexOf(a);-1<a&&sjcl.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.V(a,b,c,d,e,f);g=sjcl.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm.C(a,k,c,l,e,b);a=sjcl.mode.ccm.V(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn\'t match");return k.data},na:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,k=h.i;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));return d},V:function(a,b,c,d,e,f){var g=sjcl.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<d.length||4294967295<b.length)throw new sjcl.exception.bug("ccm: can\'t deal with 4GiB or more data");c=sjcl.mode.ccm.na(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.S,k=sjcl.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p=p.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d.length&&(n=l(n,f?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.S,h=sjcl.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p,r=sjcl.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p=r-32*c;m=a.encrypt(k(n,[0,0,0,p]));m=k(m,h.clamp(b.slice(c),p).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d.length&&(l=k(l,f?d:sjcl.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn\'t match");return q.concat(h.clamp(m,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.S,e=sjcl.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d(f(h,d(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm.C(true,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm.C(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn\'t match");return a.data},ka:function(a,b){var c,d,e,f,g,h=sjcl.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=sjcl.mode.gcm.ka(b,a);return b},C:function(a,b,c,d,e,f){var g,h,k,l,n,m,p,r,q=sjcl.bitArray;m=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm.j(g,[0,0,0,0],e),e=sjcl.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl.mode.gcm.j(g,[0,0,0,0],d);n=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p/4294967296),p&4294967295];d=sjcl.mode.gcm.j(g,d,a);k=b.encrypt(e);d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.W=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1e4;if(0>d||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=n.clamp(l,d));return l};sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this.u)throw new sjcl.exception.notReady("generator isn\'t seeded");if(d&this.J){d=!(d&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.L=new sjcl.cipher.aes(this.b);for(d=0;4>d&&(this.h[d]=this.h[d]+1|0,!this.h[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d=this.U[c];void 0===d&&(d=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl.exception.bug("can\'t attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d,e=this.K[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};function A(a,b){var c,d=sjcl.random.K[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);a:try{if(G="undefined"!==typeof module&&module.exports){try{H=__require2("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl.random.addEntropy(D,1024,"crypto[\'randomBytes\']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);else break a;sjcl.random.addEntropy(F,1024,"crypto[\'getRandomValues\']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D;var E;var F;var G;var H;sjcl.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.g({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e.g(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d,b);d.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl.json;return e.ia(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+\'"\'+b+\'":\';d=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+=\'"\'+escape(a[b])+\'"\';break;case"object":c+=\'"\'+sjcl.codec.base64.fromBits(a[b],0)+\'"\';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\s/g,"");if(!a.match(/^\\{.*\\}$/))throw new sjcl.exception.invalid("json decode: this isn\'t json!");a=a.replace(/^\\{|\\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\\s*(?:(["\']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn\'t json!");null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},sa:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ra:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.pa={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.pa,d;b=b||{};d=b.iter||1e3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};var _HTTPfrontend=class extends Service{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"GET",url,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"POST",url,data:message,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url);return this.POST(message,url)};this.transponder=(url,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method,url,data:message,responseType:type,onload:ev=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))body=body.replace(/\\\\/g,"");if(body[0]===\'"\'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=`${path2}${Math.floor(Math.random()*1e15)}`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch,that,args){const result=fetch.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.load(this);this.listen(path,fetched)}};var HTTPfrontend=_HTTPfrontend;HTTPfrontend.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker=__toESM(require_browser());var WorkerService=class extends Service{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt)}rt.worker=worker;if(!rt.worker.__ondisconnected){let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,void 0,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=`worker${Math.floor(Math.random()*1e15)}`;if(options2.url)worker=new import_web_worker.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev=>{this.receive(ev.data);this.setState({[options2._id]:ev.data})};if(!options2.onerror){options2.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.open=this.addWorker;this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys2=Object.keys(this.workers);this.workers[keys2[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys2.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof import_web_worker.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,args,key,subInput,blocking)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};this.subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i2=0;i2<this.__node.state.triggers[workerId].length;i2++){await this.__node.state.triggers[workerId][i2].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}};var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault()}function copyProperties(src,properties,dst){for(const name2 of properties){dst[name2]=src[name2]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();const touches=[];const data={type:event.type,touches};for(let i2=0;i2<event.touches.length;++i2){const touch=event.touches[i2];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i=1;var keys={};while(i<222){keys[i]=true;i++}function filteredKeydownEventHandler(event,sendFn,preventDefault){let{keyCode}=event;if(keys[keyCode]){if(preventDefault&&event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,pointerlockchange:mouseEventHandler,webkitpointerlockchange:mouseEventHandler,focus:focusEventHandler,blur:focusEventHandler,pointerout:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler,keyup:filteredKeydownEventHandler};function initProxyElement(element,worker,id,preventDefault){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent,preventDefault)})}if(eventHandlers.keydown){globalThis.addEventListener("keydown",function(ev){eventHandlers.keydown(ev,sendEvent,preventDefault)})}if(eventHandlers.keyup){globalThis.addEventListener("keyup",function(ev){eventHandlers.keyup(ev,sendEvent,preventDefault)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i2=0,l=array.length;i2<l;i2++){array[i2].call(this,event)}}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id,options.preventDefault);return setupCanvas(options)}}function transferCanvas(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id,options.preventDefault);else initProxyElement(options.canvas,worker,options._id,options.preventDefault);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText3(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText3(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText3(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText3(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText3(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText3(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText3(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText3(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts=getCanvas.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText3(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim,getCanvas};function parseFunctionFromText3(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var _ArrayManip=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return y2*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return 2*((y2-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps9){let now=Date.now();let toInterp=[now-ct*1e3/sps9,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i2=incr;i2<array.length;i2+=incr){let rounded=Math.round(i2);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i2=1;i2<fitCount-1;i2++){var tmp=i2*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i2]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d={};data.forEach((arr,i2)=>{d[i2]=arr});data=d;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i2)=>lastValue+slopeIncr*(i2+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip=_ArrayManip;ArrayManip.bufferValues=(objects,property,keys2,buffer)=>{if(!Array.isArray(keys2)&&typeof keys2==="object")keys2=Object.keys(keys2);if(!buffer){let object_keys=Object.keys(objects);if(keys2)buffer=new Float32Array(object_keys.length*keys2.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys2=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys2.length)}else buffer=new Float32Array(object_keys.length)}}let i2=0;for(const key in objects){if(objects[key][property]){if(keys2){for(let j=0;j<keys2.length;j++){buffer[i2]=objects[key][property][keys2[j]];i2++}}else{buffer[i2]=objects[key][property];i2++}}}return buffer};var rechk=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str=(v,o,c)=>String.fromCharCode(...new Uint8Array(v.buffer,v.byteOffset+o,c));var rts=(v,o,c,s)=>new Uint8Array(v.buffer,v.byteOffset+o,c).set(s.split("").map(str2=>str2.charCodeAt(0)));var pst=(v,o,c)=>str(v,o+1,Math.min(v.getUint8(o),c-1));var tsp=(v,o,c,s)=>{v.setUint8(o,s.length);rts(v,o+1,c-1,s)};var lut=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v=>str(v,o,1),p:(v,c2)=>rts(v,o,1,c2)})],"?":c=>[c,1,o=>({u:v=>Boolean(v.getUint8(o)),p:(v,B2)=>v.setUint8(o,B2)})],b:c=>[c,1,o=>({u:v=>v.getInt8(o),p:(v,b)=>v.setInt8(o,b)})],B:c=>[c,1,o=>({u:v=>v.getUint8(o),p:(v,B2)=>v.setUint8(o,B2)})],h:c=>[c,2,o=>({u:v=>v.getInt16(o,le),p:(v,h)=>v.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v=>v.getUint16(o,le),p:(v,H2)=>v.setUint16(o,H2,le)})],i:c=>[c,4,o=>({u:v=>v.getInt32(o,le),p:(v,i2)=>v.setInt32(o,i2,le)})],I:c=>[c,4,o=>({u:v=>v.getUint32(o,le),p:(v,I)=>v.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v=>v.getFloat32(o,le),p:(v,f)=>v.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v=>v.getFloat64(o,le),p:(v,d)=>v.setFloat64(o,d,le)})],s:c=>[1,c,o=>({u:v=>str(v,o,c),p:(v,s)=>rts(v,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v=>pst(v,o,c),p:(v,s)=>tsp(v,o,c,s.slice(0,c-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var _ByteParser=class extends ArrayManip{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){indices.push(i2);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y2){return[y2&255,y2>>8&255]}static bytesToInt24(x0,x1,x2){let int24=(255&x0)<<16|(255&x1)<<8|255&x2;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x2){return x0*65536+x1*256+x2}static Uint24ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255]}static bytesToInt32(x0,x1,x2,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x2)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x2,x3){return x0*16777216+x1*65536+x2*256+x3}static Uint32ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255,y2>>24&255]}static get2sCompliment(val,nbits3){if(val>4294967296)return null;return val<<32-nbits3>>32-nbits3}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i2=0;i2<input.length;i2++){var c=input.charCodeAt(i2);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i2]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser.asUint8Array(patternBuffer);var M=pattern.length;if(M===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R=256;var rightmost_positions=new Int32Array(R);for(var c=0;c<R;c++){rightmost_positions[c]=-1}for(var j=0;j<M;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i2=start;i2<=lastIndex;i2+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i2+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i2}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk.exec(format);if(!m){throw new RangeError("Invalid format string")}const t2=lut("<"===m[1]),lu=(n,c)=>t2[c](n?parseInt(n,10):1);while(m=refmt.exec(format)){((r,s,f)=>{for(let i2=0;i2<r;++i2,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v=new DataView(arrb,offs|0);return fns.map(f=>f.u(v))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i2)=>f.p(v,values[i2]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser=_ByteParser;ByteParser.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var WebSerial=class extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message){const writer=port.writable.getWriter();await writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i2;else{nextIndex=i2;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}writeStream(stream,message){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i2=0;i2<ports.length;i2++){if(ports[i2].getInfo().usbVendorId===info.usbVendorId&&ports[i2].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i2],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i2]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t2=>{let opt=transforms[t2];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str2=stream;transform.forEach(transform2=>{str2=str2.pipeThrough(transform2)});return str2}};function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i2=0;i2<9;i2++){let j=i2*25;output[0][i2]=ByteParser.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}if(arr.length>225){output.leds=arr.slice(225)}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var sps=250;var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var gain=32;var nbits=24;var vref=1.2;var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b)=>a+b;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;if(arr[0]%2===0)output[i2+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<128;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i2=0;i2<128;i2++){freeeeg128ChartSettings.lines[i2]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i2]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<32;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i2=0;i2<32;i2++){freeeeg32ChartSettings.lines[i2]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i2]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps5=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\n",codec:hegduinocodec,sps:sps5};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps5,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps5}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i2=0;while(i2<pktCt){let idx=i2*6;if(i2%2===0){output["ir"][i2]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i2+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i2-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i2]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i2++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i2=0;i2<20;i2++){let idx=i2*12;output.ax[i2]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i2]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i2]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i2]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i2]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i2]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i2=0;i2<7;i2++){let j=i2*26+1;if(!arr[j+23])break;output[0][i2]=ByteParser.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps6=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps6}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps6};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps6;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting4={nSec:10,sps:sps6,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting4)),"1":JSON.parse(JSON.stringify(defaultChartSetting4)),"2":JSON.parse(JSON.stringify(defaultChartSetting4)),"3":JSON.parse(JSON.stringify(defaultChartSetting4)),"4":JSON.parse(JSON.stringify(defaultChartSetting4)),"5":JSON.parse(JSON.stringify(defaultChartSetting4)),"6":JSON.parse(JSON.stringify(defaultChartSetting4)),"7":JSON.parse(JSON.stringify(defaultChartSetting4))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i2=0;while(i2<data.length){if(PeanutCodes[data[i2]]&&i2+1+PeanutCodes[data[i2]].byteLength<=data.length){let slice=data.slice(i2+1,i2+1+PeanutCodes[data[i2]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i2]].format).unpack(slice);let code=PeanutCodes[data[i2]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i2]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type]=unpacked;else result[PeanutCodes[data[i2]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type].push(...unpacked);else result[PeanutCodes[data[i2]].type].push(unpacked)}i2+=PeanutCodes[data[i2]].byteLength+1}else i2++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j=0;j<3;j++){let i2=j*16+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}else{output.humidity=[];for(let j=0;j<3;j++){let i2=j*24+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToInt32(arr[19+i2],arr[18+i2],arr[17+i2],arr[16+i2]);let hfrac=ByteParser.bytesToInt32(arr[23+i2],arr[22+i2],arr[21+i2],arr[20+i2]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec(arr.subarray(2));Object.keys(result).forEach((key,i2)=>{output[i2+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,ads131m08codec(arr))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting5={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))},generateNewLines:true,cleanGeneration:false};var gain2=32;var nbits2=24;var vref2=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps7=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps7}}},sps:sps7};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps8},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps8}}},sps:sps8};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop2=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v,i2)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i2+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop2()},loopTime)}};loop2();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.buffer)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps9=this.sps;this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps9=this.sps){this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps9=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f,i2)=>{out=f.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps9,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \'lowpass\',\'highpass\',\'bandpass\',\'notch\',\'peak\',\'lowshelf\',\'highshelf\'");return}this.type=type;this.freq=freq;this.sps=sps9;this.Q=Q;this.dbGain=dbGain;let A2=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps9;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A2+A2);this[type](A2,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A2,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A2,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A2,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A2,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A2,sn,cs,alpha,beta){this.b0=1+alpha*A2;this.b1=-2*cs;this.b2=1-alpha*A2;this.a0=1+alpha/A2;this.a1=-2*cs;this.a2=1-alpha/A2}lowshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1-(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1-(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1+(A2+1)*cs+beta*sn;this.a1=2*(A2-1+(A2+1)*cs);this.a2=A2+1+(A2-1)*cs-beta*sn}highshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1+(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1+(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1-(A2+1)*cs-beta*sn;this.a1=2*(A2-1-(A2+1)*cs);this.a2=A2+1-(A2-1)*cs-beta*sn}applyFilter(signal_step){let y2=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y2;return y2}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y2=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y2;return y2}};var makeNotchFilter=(frequency,sps9,bandwidth)=>{return new Biquad("notch",frequency,sps9,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps9,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps9,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};function parseFunctionFromText2(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs3(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs2}var stringifyFast2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast3(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast2}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.filtering=true;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText2(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder2,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder2+")")},"receiveCodec":function receiveDeviceCodec(decoder2,deviceType,device,service,characteristic){let codec=parseFunctionFromText2(decoder2);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters)globalThis.filters={};for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){globalThis.Devices=Devices;const worker=new WorkerService({roots:{...workerCanvasRoutes,...remoteGraphRoutes,...streamWorkerRoutes}})}var stream_worker_default=self;})();\n',vd=URL.createObjectURL(new globalThis.Blob([_d],{type:"text/javascript"})),wd=vd,Dn=class{constructor(){this.recursivelyAssign=(e,t)=>{for(let r in t)typeof t[r]=="object"?typeof e[r]=="object"?this.recursivelyAssign(e[r],t[r]):e[r]=this.recursivelyAssign({},t[r]):e[r]=t[r];return e}}static autoscale(e,t=0,r=1,i=!1,n,a,p){if(e?.length===0)return e;let d=a||Math.max(...e),y=n||Math.min(...e),b=1/r,v=1;if(i){let h=Math.max(Math.abs(y),Math.abs(d));return h!==0&&(v=b/h),e.map(w=>(p&&(w<y&&(w=y),w>d&&(w=d)),w*v+(b*(t+1)*2-1-b)))}else return d===y?d!==0?v=b/d:y!==0&&(v=b/Math.abs(y)):v=b/(d-y),e.map(h=>(p&&(h<y&&(h=y),h>d&&(h=d)),2*((h-y)*v-1/(2*r))+(b*(t+1)*2-1-b)))}static genTimestamps(e,t){let r=Date.now(),i=[r-e*1e3/t,r];return Dn.upsample(i,e)}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,r=1){if(e.length>t){let i=new Array(t),n=e.length/t,a=e.length-1,p=0,d=0;for(let y=n;y<e.length;y+=n){let b=Math.round(y);b>a&&(b=a);for(let v=p;v<b;v++)i[d]+=e[v];i[d]/=(b-p)*r,d++,p=b}return i}else return e}static upsample(e,t,r=1){var i=function(h,w,_){return(h+(w-h)*_)*r},n=new Array(t),a=(e.length-1)/(t-1);n[0]=e[0];for(var p=1;p<t-1;p++){var d=p*a,y=Math.floor(d),b=Math.ceil(d),v=d-y;n[p]=i(e[y],e[b],v)}return n[t-1]=e[e.length-1],n}static interpolate(e,t,r=1){return e.length>t?Dn.downsample(e,t,r):e.length<t?Dn.upsample(e,t,r):e}static HSLToRGB(e,t,r,i=255){t/=100,r/=100;let n=(1-Math.abs(2*r-1))*t,a=n*(1-Math.abs(e/60%2-1)),p=r-n/2,d=0,y=0,b=0;return 0<=e&&e<60?(d=n,y=a,b=0):60<=e&&e<120?(d=a,y=n,b=0):120<=e&&e<180?(d=0,y=n,b=a):180<=e&&e<240?(d=0,y=a,b=n):240<=e&&e<300?(d=a,y=0,b=n):300<=e&&e<360&&(d=n,y=0,b=a),d=(d+p)*i,y=(y+p)*i,b=(b+p)*i,[d,y,b]}static circularBuffer(e,t){if(t.length<e.length){let r=e.slice(t.length),i=e.length;e.splice(0,i,...r,...t)}else if(t.length>e.length){let r=e.length;e.splice(0,r,t.slice(r-t.length))}else e.splice(0,e.length,...t);return e}static reformatData(e,t){if(Array.isArray(e)){if(Array.isArray(e[0])){let r={};if(e.forEach((i,n)=>{r[n]=i}),e=r,isNaN(e[0][0]))return}else if(t){if(e={[t]:e},isNaN(e[t][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let r in e)if(typeof e[r]=="number"?e[r]=[e[r]]:e[r]?.values&&typeof e[r].values=="number"&&(e[r].values=[e[r].values]),isNaN(e[r][0]))return}else if(typeof e=="string"){let r;if(e.includes(`\r
`)){let i=e.split(`\r
`);e={},i.forEach((n,a)=>{n.includes("	")?r=n.split("	"):n.includes(",")?r=n.split(","):n.includes("|")&&(r=n.split("|")),Array.isArray(r)&&r.forEach((p,d)=>{if(p.includes(":")){let[y,b]=p.split(":"),v=parseFloat(b);if(v)e[y]=[v];else return}else{let y=parseFloat(p);if(y)e[d]=[y];else return}})})}else e.includes("	")?r=e.split("	"):e.includes(",")?r=e.split(","):e.includes("|")&&(r=e.split("|"));e={},Array.isArray(r)&&r.forEach((i,n)=>{if(i.includes(":")){let[a,p]=i.split(":"),d=parseFloat(p);if(d)e[a]=[d];else return}else{let a=parseFloat(i);if(a)e[n]=[a];else return}})}else typeof e=="number"&&(t?e={[t]:[e]}:e={0:[e]});return e}static padTime(e,t,r,i){let n=(e[0]-t)/r/i;return[...new Array(i-e.length).map((p,d)=>t+n*(d+1)),...e]}static interpolateForTime(e,t,r){return Dn.interpolate(e,Math.ceil(r*t))}isTypedArray(e){return ArrayBuffer.isView(e)&&Object.prototype.toString.call(e)!=="[object DataView]"}spliceTypedArray(e,t,r){let i=e.subarray(0,t),n;r&&(n=e.subarray(r+1));let a;return(i.length>0||n?.length>0)&&(a=new e.constructor(i.length+n.length)),i.length>0&&a.set(i),n&&n.length>0&&a.set(n,i.length),a}},wc=Dn;wc.bufferValues=(e,t,r,i)=>{if(!Array.isArray(r)&&typeof r=="object"&&(r=Object.keys(r)),!i){let a=Object.keys(e);r?i=new Float32Array(a.length*r.length):typeof e[a[0]][t]=="object"?(r=Object.keys(e[a[0]][t]),i=new Float32Array(a.length*r.length)):i=new Float32Array(a.length)}let n=0;for(let a in e)if(e[a][t])if(r)for(let p=0;p<r.length;p++)i[n]=e[a][t][r[p]],n++;else i[n]=e[a][t],n++;return i};var Sd=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/,kd=/([1-9]\d*)?([xcbB?hHiIfdsp])/g,Zo=(e,t,r)=>String.fromCharCode(...new Uint8Array(e.buffer,e.byteOffset+t,r)),Qo=(e,t,r,i)=>new Uint8Array(e.buffer,e.byteOffset+t,r).set(i.split("").map(n=>n.charCodeAt(0))),xd=(e,t,r)=>Zo(e,t+1,Math.min(e.getUint8(t),r-1)),Ed=(e,t,r,i)=>{e.setUint8(t,i.length),Qo(e,t+1,r-1,i)},Od=e=>({x:t=>[1,t,0],c:t=>[t,1,r=>({u:i=>Zo(i,r,1),p:(i,n)=>Qo(i,r,1,n)})],"?":t=>[t,1,r=>({u:i=>!!i.getUint8(r),p:(i,n)=>i.setUint8(r,n)})],b:t=>[t,1,r=>({u:i=>i.getInt8(r),p:(i,n)=>i.setInt8(r,n)})],B:t=>[t,1,r=>({u:i=>i.getUint8(r),p:(i,n)=>i.setUint8(r,n)})],h:t=>[t,2,r=>({u:i=>i.getInt16(r,e),p:(i,n)=>i.setInt16(r,n,e)})],H:t=>[t,2,r=>({u:i=>i.getUint16(r,e),p:(i,n)=>i.setUint16(r,n,e)})],i:t=>[t,4,r=>({u:i=>i.getInt32(r,e),p:(i,n)=>i.setInt32(r,n,e)})],I:t=>[t,4,r=>({u:i=>i.getUint32(r,e),p:(i,n)=>i.setUint32(r,n,e)})],f:t=>[t,4,r=>({u:i=>i.getFloat32(r,e),p:(i,n)=>i.setFloat32(r,n,e)})],d:t=>[t,8,r=>({u:i=>i.getFloat64(r,e),p:(i,n)=>i.setFloat64(r,n,e)})],s:t=>[1,t,r=>({u:i=>Zo(i,r,t),p:(i,n)=>Qo(i,r,t,n.slice(0,t))})],p:t=>[1,t,r=>({u:i=>xd(i,r,t),p:(i,n)=>Ed(i,r,t,n.slice(0,t-1))})]}),rc=new RangeError("Structure larger than remaining buffer"),Ad=new RangeError("Not enough values for structure"),Gi=class extends wc{static toDataView(e){if(!(e instanceof DataView))if(typeof e=="string"&&parseInt(e)&&(e=parseInt(e)),typeof e=="string"){let t=new TextEncoder,r={};for(let n in Gi.codes)for(;e.indexOf(n)>-1;){let a=e.indexOf(n);e=e.replace(n,""),r[a]=n}let i=Array.from(t.encode(e));for(let n in r)i.splice(parseInt(n),0,Gi.codes[r[n]]);e=new DataView(new Uint8Array(i).buffer)}else if(typeof e=="number"){let t=e;e<256?(e=new DataView(new ArrayBuffer(1)),e.setUint8(0,t)):e<65536?(e=new DataView(new ArrayBuffer(2)),e.setInt16(0,t)):(e=new DataView(new ArrayBuffer(4)),e.setUint32(0,t))}else e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer?e=new DataView(e):Array.isArray(e)?e=new DataView(Uint8Array.from(e).buffer):typeof e=="object"&&(e=new TextEncoder().encode(JSON.stringify(e)));return e}static searchBuffer(e,t,r){for(var i=t,n=e,a=Gi.boyerMoore(i),p=a.byteLength,d=[],y=a(n);y!==-1&&(d.push(y),!(r&&d.length>=r));y=a(n,y+p));return d}static bytesToInt16(e,t){let r=(255&e)<<8|255&t;return(r&32768)>0?r|=4294901760:r&=65535,r}static bytesToUInt16(e,t){return e*256+t}static Uint16ToBytes(e){return[e&255,e>>8&255]}static bytesToInt24(e,t,r){let i=(255&e)<<16|(255&t)<<8|255&r;return(i&8388608)>0?i|=4278190080:i&=16777215,i}static bytesToUInt24(e,t,r){return e*65536+t*256+r}static Uint24ToBytes(e){return[e&255,e>>8&255,e>>16&255]}static bytesToInt32(e,t,r,i){let n=(255&e)<<24|(255&t)<<16|(255&r)<<8|255&i;return(n&2147483648)>0?n|=0:n&=4294967295,n}static bytesToUInt32(e,t,r,i){return e*16777216+t*65536+r*256+i}static Uint32ToBytes(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]}static get2sCompliment(e,t){return e>4294967296?null:e<<32-t>>32-t}static getSignedInt(...e){let t=0;function r(i){for(var n=0,a=!0;i--;)if(a){let p=e[t++];n+=p&127,p&128&&(n-=128),a=!1}else n*=256,n+=e[t++];return n}return r(e.length)}static asUint8Array(e){if(e instanceof Uint8Array)return e;if(typeof e=="string"){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>127)throw new TypeError("Only ASCII patterns are supported");t[r]=i}return t}else return new Uint8Array(e)}static boyerMoore(e){var t=Gi.asUint8Array(e),r=t.length;if(r===0)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=256,n=new Int32Array(i),a=0;a<i;a++)n[a]=-1;for(var p=0;p<r;p++)n[t[p]]=p;var d=(y,b,v)=>{var h=Gi.asUint8Array(y);b===void 0&&(b=0),v===void 0&&(v=h.length);for(var w=t,_=n,T=v-w.length,C=w.length-1,I,P=b;P<=T;P+=I){I=0;for(var U=C;U>=0;U--){var H=h[P+U];if(w[U]!==H){I=Math.max(1,U-_[H]);break}}if(I===0)return P}return-1};return d.byteLength=t.byteLength,d}static struct(e){let t=[],r=0,i=Sd.exec(e);if(!i)throw new RangeError("Invalid format string");let n=Od(i[1]==="<"),a=(h,w)=>n[w](h?parseInt(h,10):1);for(;i=kd.exec(e);)((h,w,_)=>{for(let T=0;T<h;++T,r+=w)_&&t.push(_(r))})(...a(...i.slice(1)));let p=(h,w)=>{if(h.byteLength<(w|0)+r)throw rc;let _=new DataView(h,w|0);return t.map(T=>T.u(_))},d=(h,w,..._)=>{if(_.length<t.length)throw Ad;if(h.byteLength<w+r)throw rc;let T=new DataView(h,w);new Uint8Array(h,w,r).fill(0),t.forEach((C,I)=>C.p(T,_[I]))},y=(...h)=>{let w=new ArrayBuffer(r);return d(w,0,...h),w},b=h=>p(h,0);function*v(h){for(let w=0;w+r<=h.byteLength;w+=r)yield p(h,w)}return Object.freeze({unpack:b,pack:y,unpack_from:p,pack_into:d,iter_unpack:v,format:e,size:r})}},Je=Gi;Je.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92};var ic;(function(e){e[e.SCAN_MODE_LOW_POWER=0]="SCAN_MODE_LOW_POWER",e[e.SCAN_MODE_BALANCED=1]="SCAN_MODE_BALANCED",e[e.SCAN_MODE_LOW_LATENCY=2]="SCAN_MODE_LOW_LATENCY"})(ic||(ic={}));var nc;(function(e){e[e.CONNECTION_PRIORITY_BALANCED=0]="CONNECTION_PRIORITY_BALANCED",e[e.CONNECTION_PRIORITY_HIGH=1]="CONNECTION_PRIORITY_HIGH",e[e.CONNECTION_PRIORITY_LOW_POWER=2]="CONNECTION_PRIORITY_LOW_POWER"})(nc||(nc={}));ra();ia();ra();var dt=As("BluetoothLe",{web:()=>Promise.resolve().then(()=>(Cu(),ac)).then(e=>new e.BluetoothLeWeb)}),Nd=()=>{let e=Promise.resolve();return t=>new Promise((r,i)=>{e=e.then(()=>t()).then(r).catch(i)})};function $o(e){return e?Nd():t=>t()}function Gt(e){if(typeof e!="string")throw new Error(`Invalid UUID type ${typeof e}. Expected string.`);if(e=e.toLowerCase(),!(e.search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0))throw new Error(`Invalid UUID format ${e}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`);return e}var Td=class{constructor(){this.scanListener=null,this.eventListeners=new Map,this.queue=$o(!0)}enableQueue(){this.queue=$o(!0)}disableQueue(){this.queue=$o(!1)}async initialize(e){await this.queue(async()=>{await dt.initialize(e)})}async getEnabled(){return this.isEnabled()}async isEnabled(){return await this.queue(async()=>(await dt.isEnabled()).value)}async enable(){await this.queue(async()=>{await dt.enable()})}async disable(){await this.queue(async()=>{await dt.disable()})}async startEnabledNotifications(e){await this.queue(async()=>{var t;let r="onEnabledChanged";await((t=this.eventListeners.get(r))===null||t===void 0?void 0:t.remove());let i=await dt.addListener(r,n=>{e(n.value)});this.eventListeners.set(r,i),await dt.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var e;let t="onEnabledChanged";await((e=this.eventListeners.get(t))===null||e===void 0?void 0:e.remove()),this.eventListeners.delete(t),await dt.stopEnabledNotifications()})}async isLocationEnabled(){return await this.queue(async()=>(await dt.isLocationEnabled()).value)}async openLocationSettings(){await this.queue(async()=>{await dt.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await dt.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await dt.openAppSettings()})}async setDisplayStrings(e){await this.queue(async()=>{await dt.setDisplayStrings(e)})}async requestDevice(e){return e=e?this.validateRequestBleDeviceOptions(e):void 0,await this.queue(async()=>await dt.requestDevice(e))}async requestLEScan(e,t){e=this.validateRequestBleDeviceOptions(e),await this.queue(async()=>{var r;await((r=this.scanListener)===null||r===void 0?void 0:r.remove()),this.scanListener=await dt.addListener("onScanResult",i=>{let n=Object.assign(Object.assign({},i),{manufacturerData:this.convertObject(i.manufacturerData),serviceData:this.convertObject(i.serviceData),rawAdvertisement:i.rawAdvertisement?this.convertValue(i.rawAdvertisement):void 0});t(n)}),await dt.requestLEScan(e)})}async stopLEScan(){await this.queue(async()=>{var e;await((e=this.scanListener)===null||e===void 0?void 0:e.remove()),this.scanListener=null,await dt.stopLEScan()})}async getDevices(e){return this.queue(async()=>(await dt.getDevices({deviceIds:e})).devices)}async getConnectedDevices(e){if(!Array.isArray(e))throw new Error("services must be an array");return e=e.map(Gt),this.queue(async()=>(await dt.getConnectedDevices({services:e})).devices)}async connect(e,t,r){await this.queue(async()=>{var i;if(t){let n=`disconnected|${e}`;await((i=this.eventListeners.get(n))===null||i===void 0?void 0:i.remove());let a=await dt.addListener(n,()=>{t(e)});this.eventListeners.set(n,a)}await dt.connect(Object.assign({deviceId:e},r))})}async createBond(e){await this.queue(async()=>{await dt.createBond({deviceId:e})})}async isBonded(e){return await this.queue(async()=>(await dt.isBonded({deviceId:e})).value)}async disconnect(e){await this.queue(async()=>{await dt.disconnect({deviceId:e})})}async getServices(e){return await this.queue(async()=>(await dt.getServices({deviceId:e})).services)}async discoverServices(e){await this.queue(async()=>{await dt.discoverServices({deviceId:e})})}async getMtu(e){return await this.queue(async()=>(await dt.getMtu({deviceId:e})).value)}async requestConnectionPriority(e,t){await this.queue(async()=>{await dt.requestConnectionPriority({deviceId:e,connectionPriority:t})})}async readRssi(e){return await this.queue(async()=>{let r=await dt.readRssi({deviceId:e});return parseFloat(r.value)})}async read(e,t,r,i){return t=Gt(t),r=Gt(r),await this.queue(async()=>{let a=await dt.read(Object.assign({deviceId:e,service:t,characteristic:r},i));return this.convertValue(a.value)})}async write(e,t,r,i,n){return t=Gt(t),r=Gt(r),this.queue(async()=>{if(!i?.buffer)throw new Error("Invalid data.");let a=i;si.getPlatform()!=="web"&&(a=Lo(i)),await dt.write(Object.assign({deviceId:e,service:t,characteristic:r,value:a},n))})}async writeWithoutResponse(e,t,r,i,n){t=Gt(t),r=Gt(r),await this.queue(async()=>{if(!i?.buffer)throw new Error("Invalid data.");let a=i;si.getPlatform()!=="web"&&(a=Lo(i)),await dt.writeWithoutResponse(Object.assign({deviceId:e,service:t,characteristic:r,value:a},n))})}async readDescriptor(e,t,r,i,n){return t=Gt(t),r=Gt(r),i=Gt(i),await this.queue(async()=>{let p=await dt.readDescriptor(Object.assign({deviceId:e,service:t,characteristic:r,descriptor:i},n));return this.convertValue(p.value)})}async writeDescriptor(e,t,r,i,n,a){return t=Gt(t),r=Gt(r),i=Gt(i),this.queue(async()=>{if(!n?.buffer)throw new Error("Invalid data.");let p=n;si.getPlatform()!=="web"&&(p=Lo(n)),await dt.writeDescriptor(Object.assign({deviceId:e,service:t,characteristic:r,descriptor:i,value:p},a))})}async startNotifications(e,t,r,i){t=Gt(t),r=Gt(r),await this.queue(async()=>{var n;let a=`notification|${e}|${t}|${r}`;await((n=this.eventListeners.get(a))===null||n===void 0?void 0:n.remove());let p=await dt.addListener(a,d=>{i(this.convertValue(d?.value))});this.eventListeners.set(a,p),await dt.startNotifications({deviceId:e,service:t,characteristic:r})})}async stopNotifications(e,t,r){t=Gt(t),r=Gt(r),await this.queue(async()=>{var i;let n=`notification|${e}|${t}|${r}`;await((i=this.eventListeners.get(n))===null||i===void 0?void 0:i.remove()),this.eventListeners.delete(n),await dt.stopNotifications({deviceId:e,service:t,characteristic:r})})}validateRequestBleDeviceOptions(e){return e.services&&(e.services=e.services.map(Gt)),e.optionalServices&&(e.optionalServices=e.optionalServices.map(Gt)),e}convertValue(e){return typeof e=="string"?Ts(e):e===void 0?new DataView(new ArrayBuffer(0)):e}convertObject(e){if(e===void 0)return;let t={};for(let r of Object.keys(e))t[r]=this.convertValue(e[r]);return t}},Id=new Td;ia();var Cs=class extends Je{constructor(e,t){super(),this.client=Id,this.devices={},this.location=!1,this.initialized=!1,this.setupDevice=(r,i)=>new Promise(async(n,a)=>{this.devices[r.deviceId]={device:r,deviceId:r.deviceId,...i},this.client.connect(r.deviceId,p=>{this.devices[r.deviceId]?.ondisconnect&&this.devices[r.deviceId].ondisconnect(p)},i?.connectOptions).then(async()=>{let p=await this.getServices(r.deviceId);for(let d in i?.services){let y=p.find(b=>{if(b.uuid===d)return!0});if(y)for(let b in i.services[d]){if(!y.characteristics.find(h=>{if(h.uuid===b)return!0}))continue;let v=i.services[d][b];v.write&&await this.write(r,d,b,v.write,v.writeCallback,v.writeOptions),v.read&&await this.read(r,d,b,v.readCallback,v.readOptions),v.notify&&v.notifyCallback&&(await this.subscribe(r,d,b,v.notifyCallback),v.notifying=!0)}}}).catch(a),n(this.devices[r.deviceId])}),this.triangulate=(r,i=1500,n=60)=>new Promise((a,p)=>{if("Accelerometer"in globalThis){if(typeof globalThis.Accelerometer=="function"){let d=new globalThis.Accelerometer({frequency:n}),y=performance.now(),b=y,v={samples:[],vector:{}},h=()=>{if(b-y<i)this.readRssi(r).then(w=>{let _=d.x,T=d.y,C=d.z;b=performance.now(),v.samples.push({x:_,y:T,z:C,rssi:w,timestamp:b})});else{let w={x:0,y:0,z:0,rssiAvg:0};v.samples.forEach(_=>{}),d.removeEventListener("reading",h)}};d.addEventListener("reading",h)}}else p(new Error("No Accelerometer API detected"))}),t&&(this.location=t),e&&this.setup(e)}setup(e,t=this.location){let r=[];if(e)for(let n in e.services)r.push(n);let i={};return t||(i.androidNeverForLocation=!1),new Promise(async(n,a)=>{if(this.initialized||(await this.client.initialize(i),this.initialized=!0),e?.deviceId)n(await this.reconnect(e.deviceId));else if(e){let p=Array.from(Object.keys(e.services)),d={};this.isMobile()||(d.optionalServices=p),e.name&&(d.name=e.name),e.namePrefix&&(d.namePrefix=e.namePrefix),this.client.requestDevice(d).then(y=>{n(this.setupDevice(y,e))}).catch(a)}else this.client.requestDevice().then(p=>{n(this.setupDevice(p,e))}).catch(a)})}initialize(e){return new Promise((t,r)=>{this.client.initialize(e).then(()=>{t(!0)}).catch(r)})}requestDevice(e,t){return new Promise((r,i)=>{this.client.requestDevice(e).then(n=>{this.devices[n.deviceId]={device:n,deviceId:n.deviceId,...t},r(n)}).catch(i)})}getServices(e){return this.client.getServices(e)}connect(e,t){return new Promise((r,i)=>{this.client.connect(e.deviceId,n=>{t?.ondisconnect&&t.ondisconnect(n)},t?.connectOptions).then(n=>{r(e)}).catch(i)})}reconnect(e,t){return new Promise((r,i)=>{let n=t;this.devices[e]&&(n=Object.assign(Object.assign({},this.devices[e]),n)),n?.deviceId&&delete n.deviceId,this.client.getDevices([e]).then(a=>{this.setupDevice(a[0],n).then(p=>{r(p)})}).catch(i)})}disconnect(e){if(typeof e=="object"&&e?.deviceId&&(e=e.deviceId),typeof e=="string"){let t=this.devices[e];return t.beforedisconnect&&t.beforedisconnect(this,t),delete this.devices[e],this.client.disconnect(e)}}write(e,t,r,i,n,a){return typeof e=="object"&&(e=e.deviceId),n?this.client.write(e,t,r,Cs.toDataView(i)).then(n):this.client.writeWithoutResponse(e,t,r,Cs.toDataView(i),a)}read(e,t,r,i,n){return typeof e=="object"&&(e=e.deviceId),i?this.client.read(e,t,r,n).then(i):this.client.read(e,t,r,n)}subscribe(e,t,r,i){return typeof e=="object"&&(e=e.deviceId),this.client.startNotifications(e,t,r,i)}unsubscribe(e,t,r){return typeof e=="object"&&(e=e.deviceId),this.client.stopNotifications(e,t,r)}scan(e,t){return this.client.requestLEScan(e,t)}stopScanning(){return this.client.stopLEScan()}readDescriptor(e,t,r,i,n){return this.client.readDescriptor(e.deviceId,t,r,i,n)}writeDescriptor(e,t,r,i,n,a){return this.client.writeDescriptor(e.deviceId,t,r,i,Cs.toDataView(n),a)}readRssi(e){return this.client.readRssi(e.deviceId)}isMobile(){let e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}isAndroid(){return navigator.userAgent.toLowerCase().indexOf("android")>-1}async distance(e,t,r,i,n){let a=await this.readRssi(e);if(a==0)return;let p=a/t;return p<1?Math.pow(p,10):r*Math.pow(p,i)+n}async distanceFromPhone(e,t,r){let i,n,a;return r&&(r==="nexus5"?(i=.42093,n=6.9476,a=.54992):r==="motoX"?(i=.9401940951,n=6.170094565,a=0):r==="iphone5"&&(i=.89976,n=7.7095,a=.111)),await this.distance(e,t,i,n,a)}},Pn=class extends Je{constructor(){super(...arguments),this.streams={},this.createStream=e=>{let t={_id:e._id?e._id:`stream${Math.floor(Math.random()*1e15)}`,info:e.port.getInfo(),running:!1,...e};return e.port?.readable&&(e.transforms?t.reader=Pn.setStreamTransforms(e.port.readable,e.transforms).getReader():t.reader=e.port.readable.getReader()),this.streams[t._id]=t,t}}getPorts(){return navigator.serial.getPorts()}requestPort(e,t){let r={};return e&&(r.usbVendorId=e),t&&(r.usbProductId=t),r.usbVendorId?navigator.serial.requestPort({filters:[r]}):navigator.serial.requestPort()}openPort(e,t){return t&&(t=Object.assign({},t)),t?.ondisconnect&&(e.ondisconnect=t.ondisconnect,delete t.ondisconnect),e.open(t).then(()=>{t?.onconnect&&t.onconnect(e)})}async readWithTimeout(e,t){let r=e.readable.getReader(),i=setTimeout(()=>{r.releaseLock()},t),n=await r.read();return clearTimeout(i),r.releaseLock(),n}async writePort(e,t){let r=e.writable.getWriter();return await r.write(Pn.toDataView(t)),r.releaseLock(),!0}getSignals(e){return e.getSignals()}setSignals(e,t){return e.setSignals(t)}readStream(e){if(e.reader&&!e.running){let t=e.reader;e.buffering&&(typeof e.buffering!="object"&&(e.buffering={}),e.buffering.buffer||(e.buffering.buffer=[]),e.buffering.searchBytes||(e.buffering.searchBytes=new Uint8Array([13,10])));let r=()=>{if(e.port.readable&&e.running)t.read().then(i=>{if(i.done)t.releaseLock();else{if(e.buffering){e.buffering.buffer.push(...i.value);let a=e.buffering.searchBytes,p=e.buffering.buffer,d=Pn.boyerMoore(a),y=d.byteLength,b=-1,v=e.buffering.lockIdx??0;for(var n=d(p);n!==-1;n=d(p,n+y))if(!e.buffering.locked&&!("lockIdx"in e.buffering))v=e.buffering.lockIdx=n;else if(b=n,b>=0){let h=b-v;if(e.buffering.locked){if(h>0){let w=e.buffering.buffer.splice(e.buffering.lockIdx,h),_=new Uint8Array(w.slice(e.buffering.searchBytes.length));e.ondata(new Uint8Array(_))}}else{let w=e.buffering.buffer.splice(e.buffering.lockIdx,h),_=new Uint8Array(w.slice(e.buffering.searchBytes.length));e.ondata(_),e.buffering.locked=!0}v=b}}else e.ondata(i.value);setTimeout(()=>{r()},e.frequency)}}).catch(i=>{console.error(e._id," Read error:",i),(i.message.includes("overrun")||i.message.includes("framing"))&&(delete e.reader,this.reconnect(e))});else if(!e.running&&e.port.readable)try{t.releaseLock()}catch(i){console.error(i)}};return e.running=!0,r(),e}}writeStream(e,t){if(typeof e=="string"&&(e=this.streams[e]),e.port.writable){let r=e.port.writable.getWriter();return r.write(Pn.toDataView(t)),r.releaseLock(),!0}}closeStream(e,t){return typeof e=="string"&&(e=this.streams[e]),e.running=!1,new Promise((r,i)=>{e.settings.beforedisconnect&&e.settings.beforedisconnect(this,e.port),setTimeout(async()=>{if(e.port.readable&&e.reader){try{e.reader.releaseLock()}catch(n){console.error(n)}if(e.transforms)try{await e.reader.cancel()}catch(n){console.error(n)}}try{await e.port.close().then(()=>{t&&t(this.streams[e._id])}),delete this.streams[e._id],r(!0)}catch(n){i(n)}},300)})}reconnect(e,t){return typeof e=="string"&&(e=this.streams[e]),new Promise((r,i)=>{if(typeof e!="object"){i(void 0);return}let n=e.port.getInfo();this.closeStream(e._id).then(a=>{setTimeout(()=>{this.getPorts().then(p=>{for(let d=0;d<p.length;d++)p[d].getInfo().usbVendorId===n.usbVendorId&&p[d].getInfo().usbProductId===n.usbProductId&&(t?t._id=e._id:t=e,delete t.port,this.openPort(p[d],t.settings).then(()=>{let y=this.createStream({...t,port:p[d]});this.readStream(y),r(y)}).catch(i))}).catch(i)},100)})})}static setStreamTransforms(e,t){let r=[];Object.keys(t).forEach(n=>{let a=t[n];if(a instanceof TransformStream)r.push(a);else{a.start||(a.start=function(){}),a.flush||(a.flush=function(){});let p=new TransformStream({start:a.start,transform:a.transform,flush:a.flush},a.writableStrategy,a.readableStrategy);r.push(p)}});let i=e;return r.forEach(n=>{i=i.pipeThrough(n)}),i}};function Rn(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i=0;i<9;i++){let n=i*25;r[0][i]=Je.bytesToInt24(t[n],t[n+1],t[n+2]),r[1][i]=Je.bytesToInt24(t[n+3],t[n+4],t[n+5]),r[2][i]=Je.bytesToInt24(t[n+6],t[n+7],t[n+8]),r[3][i]=Je.bytesToInt24(t[n+9],t[n+10],t[n+11]),r[4][i]=Je.bytesToInt24(t[n+12],t[n+13],t[n+14]),r[5][i]=Je.bytesToInt24(t[n+15],t[n+16],t[n+17]),r[6][i]=Je.bytesToInt24(t[n+18],t[n+19],t[n+20]),r[7][i]=Je.bytesToInt24(t[n+21],t[n+22],t[n+23])}return t.length>225&&(r.leds=t.slice(225)),r}var Th=new TextDecoder;var Sc=250,Qr={nSec:10,sps:Sc,units:"mV"},Ih={lines:{0:JSON.parse(JSON.stringify(Qr)),1:JSON.parse(JSON.stringify(Qr)),2:JSON.parse(JSON.stringify(Qr)),3:JSON.parse(JSON.stringify(Qr)),4:JSON.parse(JSON.stringify(Qr)),5:JSON.parse(JSON.stringify(Qr)),6:JSON.parse(JSON.stringify(Qr)),7:JSON.parse(JSON.stringify(Qr))}},Fd=32,Bd=24,Cd=1.2,ei={sps:Sc,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*Cd/(Fd*(Math.pow(2,Bd)-1))},Fh={0:JSON.parse(JSON.stringify(ei)),1:JSON.parse(JSON.stringify(ei)),2:JSON.parse(JSON.stringify(ei)),3:JSON.parse(JSON.stringify(ei)),4:JSON.parse(JSON.stringify(ei)),5:JSON.parse(JSON.stringify(ei)),6:JSON.parse(JSON.stringify(ei)),7:JSON.parse(JSON.stringify(ei))},qo=.002/Math.pow(2,4),kc=(e,t,r=8)=>{let i=r*3+1,n=(p,d)=>p+d;e.slice(i).reduce(n,0)!==0&&(t.ax=qo*Je.bytesToInt16(e[i],e[i+1]),t.ay=qo*Je.bytesToInt16(e[i+2],e[i+3]),t.az=qo*Je.bytesToInt16(e[i+4],e[i+5]))};function jd(e){let t;e.buffer?t=e:t=new Uint8Array(e);let r={};for(let i=0;i<8;i++){let n=1+3*i;r[i]=Je.bytesToInt24(t[n],t[n+1],t[n+2])}return kc(t,r),r.timestamp=Date.now(),r}function Ld(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={};for(let i=0;i<8;i++){let n=1+3*i;t[0]%2===0?r[i+7]=Je.bytesToInt24(t[n],t[n+1],t[n+2]):r[i]=Je.bytesToInt24(t[n],t[n+1],t[n+2])}return kc(t,r),r}var Un=250,ea={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:jd,write:"b",beforedisconnect:(e,t)=>{e.writePort(t,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Un},Dd={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:Ld,write:"b",beforedisconnect:(e,t)=>{e.writePort(t,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:Un},ti={nSec:10,sps:Un,units:"mV"},Vo={nSec:10,sps:Un},Bh={lines:{0:JSON.parse(JSON.stringify(ti)),1:JSON.parse(JSON.stringify(ti)),2:JSON.parse(JSON.stringify(ti)),3:JSON.parse(JSON.stringify(ti)),4:JSON.parse(JSON.stringify(ti)),5:JSON.parse(JSON.stringify(ti)),6:JSON.parse(JSON.stringify(ti)),7:JSON.parse(JSON.stringify(ti)),ax:JSON.parse(JSON.stringify(Vo)),ay:JSON.parse(JSON.stringify(Vo)),az:JSON.parse(JSON.stringify(Vo))},generateNewLines:!0},rr={sps:Un,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))},Ch={0:JSON.parse(JSON.stringify(rr)),1:JSON.parse(JSON.stringify(rr)),2:JSON.parse(JSON.stringify(rr)),3:JSON.parse(JSON.stringify(rr)),4:JSON.parse(JSON.stringify(rr)),5:JSON.parse(JSON.stringify(rr)),6:JSON.parse(JSON.stringify(rr)),7:JSON.parse(JSON.stringify(rr)),8:JSON.parse(JSON.stringify(rr)),9:JSON.parse(JSON.stringify(rr)),10:JSON.parse(JSON.stringify(rr)),11:JSON.parse(JSON.stringify(rr)),12:JSON.parse(JSON.stringify(rr)),13:JSON.parse(JSON.stringify(rr)),14:JSON.parse(JSON.stringify(rr)),15:JSON.parse(JSON.stringify(rr))};function Pd(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={};for(let n=0;n<128;n++){let a=n*3+1;r[n]=Je.bytesToInt24(t[a],t[a+1],t[a+2])}let i=385;return r.ax=Je.bytesToInt16(t[i],t[i+1]),r.ay=Je.bytesToInt16(t[i+2],t[i+3]),r.az=Je.bytesToInt16(t[i+4],t[i+5]),r.gx=Je.bytesToInt16(t[i+6],t[i+7]),r.gy=Je.bytesToInt16(t[i+8],t[i+9]),r.gz=Je.bytesToInt16(t[i+10],t[i+11]),r.timestamp=Date.now(),r}var ni=250,Rd={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:Pd,sps:ni,buffering:{searchBytes:new Uint8Array([192,160])}},Md={lines:{ax:{nSec:10,sps:ni},ay:{nSec:10,sps:ni},az:{nSec:10,sps:ni},gx:{nSec:10,sps:ni},gy:{nSec:10,sps:ni},gz:{nSec:10,sps:ni}}},Ud={};for(let e=0;e<128;e++)Md.lines[e]={sps:ni,nSec:10,units:"mV"},Ud[e]={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))};function xc(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={};for(let n=0;n<32;n++){let a=n*3+1;r[n]=Je.bytesToInt24(t[a],t[a+1],t[a+2])}let i=97;return r.ax=Je.bytesToInt16(t[i],t[i+1]),r.ay=Je.bytesToInt16(t[i+2],t[i+3]),r.az=Je.bytesToInt16(t[i+4],t[i+5]),r.gx=Je.bytesToInt16(t[i+6],t[i+7]),r.gy=Je.bytesToInt16(t[i+8],t[i+9]),r.gz=Je.bytesToInt16(t[i+10],t[i+11]),r.timestamp=Date.now(),r}var Mn=512,zd={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:xc,sps:Mn,buffering:{searchBytes:new Uint8Array([192,160])}},$d={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:xc,sps:Mn,buffering:{searchBytes:new Uint8Array([192,160])}},Hi={nSec:10,sps:Mn},qd={lines:{ax:JSON.parse(JSON.stringify(Hi)),ay:JSON.parse(JSON.stringify(Hi)),az:JSON.parse(JSON.stringify(Hi)),gx:JSON.parse(JSON.stringify(Hi)),gy:JSON.parse(JSON.stringify(Hi)),gz:JSON.parse(JSON.stringify(Hi))}},Vd={};for(let e=0;e<32;e++)qd.lines[e]={sps:Mn,nSec:10,units:"mV"},Vd[e]={sps:Mn,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))};var Jd=new TextDecoder;function Ec(e){let t={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0},r=Jd.decode(e),i=r.split("|");if(i.length===3)t.timestamp=Date.now(),t.red=parseInt(i[0]),t.infrared=parseInt(i[1]),t.heg=parseFloat(i[2]);else return i.length>=2?(t.timestamp=Date.now(),t.red=parseInt(i[1]),t.infrared=parseInt(i[2]),t.heg=parseFloat(i[3]),i[4]&&(t.ambient=parseFloat(i[4])),i[5]&&(t.temperature=parseFloat(i[5])),t):r}var ta=40,aa={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:`t
`,codec:Ec,sps:ta},Oc=Object.assign({},aa);Oc.sps=19;var Hd={deviceType:"BLE",deviceName:"hegduino",sps:ta,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:Ec,sps:ta}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"},Ac=Object.assign({},aa);Ac.sps=19;function Nc(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r=32,i={red:new Array(r),ir:new Array(r),max_dietemp:Je.get2sCompliment(t[193],8)+.0625*t[194],timestamp:Date.now()},n=0;for(;n<r;){let a=n*6;n%2===0?(i.ir[n]=(t[a+1]<<16|t[a+2]<<8|t[a+3])&524287,i.ir[n+1]=(t[a+4]<<16|t[a+5]<<8|t[a+6])&524287):(i.red[n-1]=(t[a+1]<<16|t[a+2]<<8|t[a+3])&524287,i.red[n]=(t[a+4]<<16|t[a+5]<<8|t[a+6])&524287),n++}return i}function Tc(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={ax:new Array(20),ay:new Array(20),az:new Array(20),gx:new Array(20),gy:new Array(20),gz:new Array(20),mpu_dietemp:(Je.bytesToInt16(t[241],t[242])+521)/340+35,timestamp:Date.now()};for(let i=0;i<20;i++){let n=i*12;r.ax[i]=Je.bytesToInt16(t[n+1],t[n+2]),r.ay[i]=Je.bytesToInt16(t[n+3],t[n+4]),r.az[i]=Je.bytesToInt16(t[n+5],t[n+6]),r.gx[i]=Je.bytesToInt16(t[n+7],t[n+8]),r.gy[i]=Je.bytesToInt16(t[n+9],t[n+10]),r.gz[i]=Je.bytesToInt16(t[n+11],t[n+12])}return r}function Wd(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i=0;i<7;i++){let n=i*26+1;if(!t[n+23])break;r[0][i]=Je.bytesToUInt24(t[n],t[n+1],t[n+2]),r[1][i]=Je.bytesToUInt24(t[n+3],t[n+4],t[n+5]),r[2][i]=Je.bytesToUInt24(t[n+6],t[n+7],t[n+8]),r[3][i]=Je.bytesToUInt24(t[n+9],t[n+10],t[n+11]),r[4][i]=Je.bytesToUInt24(t[n+12],t[n+13],t[n+14]),r[5][i]=Je.bytesToUInt24(t[n+15],t[n+16],t[n+17]),r[6][i]=Je.bytesToUInt24(t[n+18],t[n+19],t[n+20]),r[7][i]=Je.bytesToUInt24(t[n+21],t[n+22],t[n+23])}return r}var Ds=250,Gd={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:!0,notifyCallback:void 0,codec:Wd,sps:Ds}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:!0}}},sps:Ds},Ic=Object.assign({},ea);Ic.sps=Ds;Ic.deviceName="cognixionONE";var ri={nSec:10,sps:Ds,units:"mV"},jh={lines:{0:JSON.parse(JSON.stringify(ri)),1:JSON.parse(JSON.stringify(ri)),2:JSON.parse(JSON.stringify(ri)),3:JSON.parse(JSON.stringify(ri)),4:JSON.parse(JSON.stringify(ri)),5:JSON.parse(JSON.stringify(ri)),6:JSON.parse(JSON.stringify(ri)),7:JSON.parse(JSON.stringify(ri))}};var Er={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function Yd(e){let t={},r=0;for(;r<e.length;)if(Er[e[r]]&&r+1+Er[e[r]].byteLength<=e.length){let i=e.slice(r+1,r+1+Er[e[r]].byteLength).buffer,n=Je.struct(Er[e[r]].format).unpack(i),a=Er[e[r]].type;a==="unfilteredHEG"||a==="heg"?n=n[0]/256:(a==="POOR_SIGNAL"||a==="sampleNumber"||a==="debug0"||a==="debug1"||a==="debug2"||a==="debug3")&&(n=n[0]),t[Er[e[r]].type]?Array.isArray(n)?t[Er[e[r]].type].push(...n):t[Er[e[r]].type].push(n):Array.isArray(n)?t[Er[e[r]].type]=n:t[Er[e[r]].type]=[n],r+=Er[e[r]].byteLength+1}else r++;return t.timestamp=Date.now(),t}var Xd={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:`protocol 3
`,buffering:{searchBytes:new Uint8Array([170,170])},codec:Yd,sps:10.101};var Kd=1013.25,Fc=e=>{let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={timestamp:Date.now(),temp:[],pressure:[],altitude:[]},i=0;if(t[0].length===74&&(i=1),i){r.humidity=[];for(let n=0;n<3;n++){let a=n*24+2,p=Je.bytesToInt32(t[3+a],t[2+a],t[1+a],t[0+a]),d=Je.bytesToInt32(t[7+a],t[6+a],t[5+a],t[4+a]);r.temp.push(p+d/Math.pow(10,Math.ceil(Math.log10(d))));let y=10*Je.bytesToInt32(t[11+a],t[10+a],t[9+a],t[8+a]),b=Je.bytesToInt32(t[15+a],t[14+a],t[13+a],t[12+a]);r.pressure.push(y+b/Math.pow(10,Math.ceil(Math.log10(b))));let v=Je.bytesToInt32(t[19+a],t[18+a],t[17+a],t[16+a]),h=Je.bytesToInt32(t[23+a],t[22+a],t[21+a],t[20+a]);r.humidity.push(v+h/Math.pow(10,Math.ceil(Math.log10(h)))),r.altitude.push(sc(r.pressure[n],r.temp[n]))}}else for(let n=0;n<3;n++){let a=n*16+2,p=Je.bytesToInt32(t[3+a],t[2+a],t[1+a],t[0+a]),d=Je.bytesToInt32(t[7+a],t[6+a],t[5+a],t[4+a]);r.temp.push(p+d/Math.pow(10,Math.ceil(Math.log10(d))));let y=10*Je.bytesToInt32(t[11+a],t[10+a],t[9+a],t[8+a]),b=Je.bytesToInt32(t[15+a],t[14+a],t[13+a],t[12+a]);r.pressure.push(y+b/Math.pow(10,Math.ceil(Math.log10(b)))),r.altitude.push(sc(r.pressure[n],r.temp[n]))}return r};function sc(e,t){return 44330*(1-Math.pow(e/Kd,.1903))}function Zd(e){let t;e.getInt8?t=new Uint8Array(e.buffer):e.buffer?t=e:t=new Uint8Array(e);let r={};if(t[0]===2)Object.assign(r,Rn(t.subarray(2)));else if(t[0]===3){let i=Rn(t.subarray(2));Object.keys(i).forEach((n,a)=>{r[a+8]=i[n]})}else t[0]===4?Object.assign(r,Tc(t.subarray(2))):t[0]===5?Object.assign(r,Nc(t.subarray(2))):t[0]===6?Object.assign(r,Fc(t.subarray(2))):Object.assign(r,Rn(t));return r}var Qd={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:Zd,sps:250},ep={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Rn,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Nc,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Tc,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Rn,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:!0,notifyCallback:void 0,codec:Fc,sps:3.33}}}},ii={nSec:10,sps:250,units:"mV"},Lh={lines:{0:JSON.parse(JSON.stringify(ii)),1:JSON.parse(JSON.stringify(ii)),2:JSON.parse(JSON.stringify(ii)),3:JSON.parse(JSON.stringify(ii)),4:JSON.parse(JSON.stringify(ii)),5:JSON.parse(JSON.stringify(ii)),6:JSON.parse(JSON.stringify(ii)),7:JSON.parse(JSON.stringify(ii))},generateNewLines:!0,cleanGeneration:!1},tp=32,rp=24,ip=1.2,ir={sps:250,useDCBlock:!1,useBandpass:!1,bandpassLower:3,bandpassUpper:45,useScaling:!0,scalar:.96*1e3*ip/(tp*(Math.pow(2,rp)-1))},Dh={0:JSON.parse(JSON.stringify(ir)),1:JSON.parse(JSON.stringify(ir)),2:JSON.parse(JSON.stringify(ir)),3:JSON.parse(JSON.stringify(ir)),4:JSON.parse(JSON.stringify(ir)),5:JSON.parse(JSON.stringify(ir)),6:JSON.parse(JSON.stringify(ir)),7:JSON.parse(JSON.stringify(ir)),8:JSON.parse(JSON.stringify(ir)),9:JSON.parse(JSON.stringify(ir)),10:JSON.parse(JSON.stringify(ir)),11:JSON.parse(JSON.stringify(ir)),12:JSON.parse(JSON.stringify(ir)),13:JSON.parse(JSON.stringify(ir)),14:JSON.parse(JSON.stringify(ir)),15:JSON.parse(JSON.stringify(ir))},np=new TextDecoder;function Bc(e){let t={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0},r=np.decode(e),i=r.split("|");return i.length>=5?(t.timestamp=Date.now(),t.left_red=parseInt(i[1]),t.left_infrared=parseInt(i[2]),t.left_heg=parseFloat(i[3]),t.center_red=parseInt(i[4]),t.center_infrared=parseInt(i[5]),t.center_heg=parseFloat(i[6]),t.right_red=parseInt(i[7]),t.right_infrared=parseInt(i[8]),t.right_heg=parseFloat(i[9]),t):r}var sp={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:Bc,sps:20},op={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:!0,notifyCallback:void 0,codec:Bc}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:!0,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:!0}}},androidWebBLE:"o"};function ap(e){let t={red:e.getInt32(2),ir:e.getInt32(6),ir2:e.getInt32(10),timestamp:Date.now()};return t.heg=t.red/(.5*(t.ir+t.ir2)),t}var oc=40,lp={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:!0,notifyCallback:void 0,codec:ap,sps:oc}}},sps:oc};function cp(e){let t={sred:e.getInt32(2),sir:e.getInt32(6),sir2:e.getInt32(10),timestamp:Date.now()};return t.sheg=t.sred/(.5*(t.sir+t.sir2)),t}function fp(e){let t={red:e.getInt32(2),ir:e.getInt32(6),ir2:e.getInt32(10),timestamp:Date.now()};return t.heg=t.sred/(.5*(t.ir+t.ir2)),t}var Jo=40,up={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:!0,notifyCallback:void 0,codec:fp,sps:Jo},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:!0,notifyCallback:void 0,codec:cp,sps:Jo}}},sps:Jo};var xs={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45},Ph={0:JSON.parse(JSON.stringify(xs)),1:JSON.parse(JSON.stringify(xs)),2:JSON.parse(JSON.stringify(xs)),3:JSON.parse(JSON.stringify(xs))},Es={nSec:10,sps:250,units:"mV"},Rh={lines:{0:JSON.parse(JSON.stringify(Es)),1:JSON.parse(JSON.stringify(Es)),2:JSON.parse(JSON.stringify(Es)),3:JSON.parse(JSON.stringify(Es)),ax:{nSec:10,sps:250,units:"mg"},ay:{nSec:10,sps:250,units:"mg"},az:{nSec:10,sps:250,units:"mg"}},generateNewLines:!0},Ln={sps:250,useDCBlock:!0,useBandpass:!0,bandpassLower:3,bandpassUpper:45},Mh={0:JSON.parse(JSON.stringify(Ln)),1:JSON.parse(JSON.stringify(Ln)),2:JSON.parse(JSON.stringify(Ln)),3:JSON.parse(JSON.stringify(Ln)),4:JSON.parse(JSON.stringify(Ln))};function dp(e){return{hr:e.getInt8(1),timestamp:Date.now()}}var pp={deviceType:"BLE",deviceName:"heartrate",services:{heart_rate:{heart_rate_measurement:{notify:!0,notifyCallback:void 0,codec:dp}}}},Cc={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{0:{sps:250,freq:1,amplitude:1,offset:0},1:{sps:250,freq:10,amplitude:1,offset:0},2:{sps:250,freq:100,amplitude:.5,offset:.5},3:{sps:250,freq:25,amplitude:1,offset:0}},connect:(e={})=>new Promise(async(t,r)=>{let n={_id:`simulated${Math.floor(Math.random()*1e15)}`,settings:Object.assign(Object.assign({},Cc),e)};n.settings.looping=!0;let a=50,p=Date.now(),d=()=>{if(n.settings.looping){let y={},b=Date.now(),v=b-p;for(let h in n.settings.simulate){let w=Math.floor(n.settings.simulate[h].sps*v/1e3);y[h]=new Array(w).fill(0),y[h]=y[h].map((_,T)=>Math.sin(2*Math.PI*n.settings.simulate[h].freq*.001*(p+v*(T+1)/w))*n.settings.simulate[h].amplitude+n.settings.simulate[h].offset)}p=b,y.timestamp=p,n.settings.ondata(y),setTimeout(()=>{d()},a)}};d(),n.settings.onconnect&&n.settings.onconnect(n),t(n)}),codec:e=>e,disconnect:e=>{console.log(e),e.settings.looping=!1,e.settings.ondisconnect(e)},onconnect:e=>{console.log("simulator connected!",e)},ondisconnect:e=>{console.log("simulator disconnected!",e)},ondata:e=>{}},la={BLE:{nrf5x:ep,hegduino:Hd,hegduinoV1:Ac,cognixionONE:Gd,statechanger:op,blueberry:lp,blueberry2:up,heart_rate:pp},USB:{nrf5x:Qd,freeEEG32:zd,freeEEG32_optical:$d,freeEEG128:Rd,hegduino:aa,hegduinoV1:Oc,cyton:ea,cyton_daisy:Dd,peanut:Xd,statechanger:sp,cognixionONE:ea},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{simulator:Cc}};var Uh=new TextDecoder;var Os=new Cs,ca=new ad({roots:{...md,...nd}});function jc(e,t){if(!e)return;t||(t={ondecoded:a=>{console.log(a)}});let r=e.deviceType,i=e.deviceName;t.workerUrl||(t.workerUrl=wd),t.service||(t.service=ca);let n=t.service.addWorker({url:t.workerUrl});if(t.devices||(t.devices=la),!t.devices[r][i]){let a=Object.assign({},e);for(let p in a)typeof a[p]=="function"&&(a[p]=a[p].toString());n.send({route:"receiveDevice",args:a})}if(t.roots){for(let a in t.roots){let p={callback:"decodeAndParseDevice",worker:n};t.roots[a].__parent=t.roots[a].__parent?Object.assign(t.roots[a].__parent,p):p}t.service.load(t.roots)}if(r.includes("CUSTOM"))return new Promise(async(a,p)=>{e.ondata=b=>{n.run("decodeAndParseDevice",[b,r,i]).then(v=>{typeof t.ondecoded=="function"&&t.ondecoded(v)})},e.ondisconnect=()=>{if(t.service.terminate(n._id),t.roots)for(let b in t.roots)t.service.remove(b)};let d=await e.connect(e),y={workers:{streamworker:n},disconnect:()=>{if(t.beforedisconnect&&t.beforedisconnect(y),e.disconnect(d),t.ondisconnect&&t.ondisconnect(y),t.roots)for(let b in t.roots)t.service.remove(b)},device:d,options:t,read:b=>{if(e.read)return new Promise((v,h)=>{v(e.read(e,b))})},write:b=>{if(e.write)return new Promise((v,h)=>{v(e.write(e,b))})},roots:t.roots};t.onconnect&&t.onconnect(y),a(y)}).catch(a=>{if(console.error(a),t.service.terminate(n._id),t.roots)for(let p in t.roots)t.service.remove(p)});if(r==="BLE"){for(let a in e.services)for(let p in e.services[a])if(typeof t.ondecoded=="function"){if(e.services?.[a]?.[p]?.notify){e.services[a][p].notifyCallback||(e.services[a][p].notifyCallback=d=>{n.run("decodeAndParseDevice",[d,r,i,a,p],void 0,[d.buffer]).then(t.ondecoded)});break}}else typeof t.ondecoded=="object"&&t.ondecoded[p]&&(e.services?.[a]?.[p]?.notify&&(e.services[a][p].notifyCallback||(e.services[a][p].notifyCallback=d=>{n.run("decodeAndParseDevice",[d,r,i,a,p],void 0,[d.buffer]).then(t.ondecoded[p])})),e.services?.[a]?.[p]?.read&&(e.services[a][p].readCallback||(e.services[p].readCallback=d=>{n.run("decodeAndParseDevice",[d,r,i,a,p],void 0,[d.buffer]).then(t.ondecoded[p])})));return new Promise((a,p)=>{Os.setup(e).then(d=>{let y={workers:{streamworker:n},options:t,device:d,disconnect:async()=>{if(await Os.disconnect(d.deviceId),t.ondisconnect&&t.ondisconnect(y),n.terminate(),t.roots)for(let b in t.roots)t.service.remove(b)},read:b=>Os.read(d.device,b.service,b.characteristic,b.ondata,b.timeout),write:b=>Os.write(d.device,b.service,b.characteristic,b.data,b.callback,b.timeout),roots:t.roots};t.onconnect&&t.onconnect(y),a(y)}).catch(d=>{if(console.error(d),n.terminate(),t.roots)for(let y in t.roots)t.service.remove(y);p(d)})})}else if(r==="USB"){let a=t.service.addWorker({url:t.workerUrl});a.worker.addEventListener("message",y=>{if(typeof y.data=="string"&&y.data.includes("disconnected")&&(t.service.terminate(a._id),t.service.terminate(n._id),t.roots))for(let b in t.roots)t.service.remove(b)}),a.post("setupSerial");let p=t.service.establishMessageChannel(n.worker,a.worker),d=new Pn;return new Promise((y,b)=>{let v=w=>{if(console.error(w),t.service.terminate(a._id),t.service.terminate(n._id),t.roots)for(let _ in t.roots)t.service.remove(_);b(w)},h=w=>{let _;w?_=w.getInfo():_={usbVendorId:e.usbVendorId,usbProductId:e.usbProductId},a.run("openPort",{baudRate:e.baudRate,usbVendorId:_.usbVendorId,usbProductId:_.usbProductId,bufferSize:e.bufferSize,buffering:e.buffering?e.buffering:void 0,frequency:e.frequency?e.frequency:void 0,pipeTo:{route:"decodeAndParseDevice",_id:p,extraArgs:[r,i]}}).then(T=>{e.write&&a.post("writeStream",[T._id,e.write]),typeof t.ondecoded=="function"&&n.subscribe("decodeAndParseDevice",t.ondecoded);let C={workers:{streamworker:n,serialworker:a},device:T,options:t,disconnect:()=>{a.post("closeStream",T._id),t.ondisconnect&&t.ondisconnect(C)},read:()=>new Promise((I,P)=>{let U;U=n.subscribe("decodeAndParseDevice",H=>{a.unsubscribe("decodeAndParseDevice",U),I(H)})}),write:I=>a.run("writeStream",[T._id,I]),roots:t.roots};t.onconnect&&t.onconnect(C),y(C)}).catch(v)};t.reconnect?h():d.requestPort(e.usbVendorId,e.usbProductId).then(w=>{h(w)}).catch(v)})}else return}var hp='(()=>{var __require=(x3=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b)=>(typeof require!=="undefined"?require:a)[b]}):x3)(function(x3){if(typeof require!=="undefined")return require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __require2=(x3=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x3)(function(x3){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var __commonJS=(cb,mod)=>function __require23(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_browser=__commonJS({"node_modules/web-worker/cjs/browser.js"(exports,module2){module2.exports=Worker}});var EventHandler=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.ctr=0;this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}if(this.triggers[statesubKey]){let run=fn=>{fn(updateObj)};this.triggers[statesubKey].forEach(v2=>{run(v2.onchange)})}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value,this.triggers[key]);this.triggers[key].forEach(fn)}};this.subscribeState=onchange=>{return this.subscribeEvent(statesubKey,onchange)};this.unsubscribeState=sub=>{return this.unsubscribeEvent(statesubKey,sub)};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.ctr;this.ctr++;this.triggers[key].push({sub:l,onchange});return l}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(sub===void 0){delete this.triggers[key];delete this.data[key]}else{let idx=void 0;let obj=triggers.find((o,i22)=>{if(o.sub===sub){idx=i22;return true}});if(obj)triggers.splice(idx,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed);return sub};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var statesubKey="*s";var state=new EventHandler;var GraphNode=class{constructor(properties,parent,graph){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state};this.__setProperties=(properties2,parent2,graph2)=>{let enforceProperties=()=>{let orig=properties2;if(typeof properties2==="function"){if(isNativeClass(properties2)){properties2=new properties2}else properties2={__operator:properties2,__node:{forward:true,tag:properties2.name}}}else if(typeof properties2==="string"){if(graph2?.get(properties2)){properties2=graph2.get(properties2)}}if(!("__node"in properties2))properties2.__node={};if(!properties2.__node.initial)properties2.__node.initial=orig};enforceProperties();if(typeof properties2==="object"){let assignState=()=>{if(properties2.__node?.state)this.__node.state=properties2.__node.state;else if(graph2){properties2.__node.state=graph2.__node.state}};let setProps22=()=>{if(properties2.__props){if(typeof properties2.__props==="function")properties2.__props=new properties2.__props;if(typeof properties2.__props==="object"){this.__proxyObject(properties2.__props)}}};let setTag=()=>{if(!properties2.__node.tag){if(properties2.__operator?.name)properties2.__node.tag=properties2.__operator.name;else properties2.__node.tag=`node${Math.floor(Math.random()*1e15)}`}};let setNode=()=>{if(typeof properties2.__node==="string"){if(graph2?.get(properties2.__node.tag)){properties2=graph2.get(properties2.__node.tag)}else properties2.__node={}}else if(!properties2.__node)properties2.__node={};if(graph2){properties2.__node.graph=graph2}if(properties2 instanceof Graph)properties2.__node.source=properties2};let setParent=()=>{if(!properties2.__parent&&parent2)properties2.__parent=parent2;if(parent2?.__node&&!(parent2 instanceof Graph||properties2 instanceof Graph))properties2.__node.tag=parent2.__node.tag+"."+properties2.__node.tag;if(parent2 instanceof Graph&&properties2 instanceof Graph){if(properties2.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties2.__node.loaders);if(parent2.__node.mapGraphs){properties2.__node.nodes.forEach(n=>{parent2.set(properties2.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties2.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties2.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}};let setOp=()=>{if(typeof properties2.default==="function"&&!properties2.__operator){properties2.__operator=properties2.default}if(properties2.__operator){if(typeof properties2.__operator==="string"){if(graph2){let n=graph2.get(properties2.__operator);if(n)properties2.__operator=n.__operator;if(!properties2.__node.tag&&properties2.__operator.name)properties2.__node.tag=properties2.__operator.name}}if(typeof properties2.__operator==="function")properties2.__operator=this.__setOperator(properties2.__operator);if(properties2.default)properties2.default=properties2.__operator}};let assignProps=()=>{properties2.__node=Object.assign(this.__node,properties2.__node);let keys22=Object.getOwnPropertyNames(properties2);for(const key of keys22){if(key in properties2)this[key]=properties2[key]}};let bindCallbacks=()=>{if(this.__onconnected){if(typeof this.__onconnected==="function"){this.__onconnected=this.__onconnected.bind(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected=this.__onconnected.map(f=>{return f.bind(this)})}if(typeof this.__ondisconnected==="function"){this.__ondisconnected=this.__ondisconnected.bind(this)}else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected=this.__ondisconnected.map(f=>{return f.bind(this)})}}};assignState();setTag();setProps22();setNode();setParent();assignProps();bindCallbacks();setOp()}};this.__subscribe=(callback,key,subInput,target,tkey,args)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>target2?target2:callback2,triggerCallback=callback)=>{if(args){triggerCallback=wrapArgs(triggerCallback,args,this.__node.graph)}let sub=this.__node.state.subscribeEvent(k,triggerCallback,this,key);let trigger=this.__node.state.getEvent(k,sub);if(!this.__listeners)this.__listeners={};this.__listeners[k]=this.__node.state.triggers[k];if(!trigger)return sub;trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback,target);if(subInput)trigger.subInput=subInput;if(args)trigger.__args=args;if(tkey)trigger.tkey=tkey;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){target=callback2.substring(0,callback2.lastIndexOf("."));let n=this.__node.graph.get(callback2.substring(0,target));tkey=callback2.lastIndexOf(".")+1;if(n&&typeof n[key]==="function")callback2=(...args2)=>{return n[tkey](...args2)}}else if(fn.__operator){callback2=fn.__operator;tkey="__operator"}};if(key){if(!this.__node.localState||!this.__node.localState[key]){this.__addLocalState(this,key)}if(typeof callback==="string"){tkey=callback;if(target){if(this.__node.graph?.get(target)){let n=this.__node.graph?.get(target);if(typeof n[callback]==="function"){let fn=n[callback];callback=(...inp)=>{fn(...inp)}}else{let k2=callback;let setter=inp=>{n[k2]=inp};callback=setter}}}else if(typeof this[callback]==="function"){let fn=this[callback];callback=(...inp)=>{fn(...inp)}}else if(this.__node.graph?.get(callback))subscribeToGraph(callback);if(typeof callback!=="function")return void 0}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}else{if(typeof callback==="string"){if(this.__node.graph.get(callback))callback=this.__node.graph.get(callback);tkey="__operator";if(typeof callback!=="object")return void 0}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node){sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)})}return sub}};this.__unsubscribe=(sub,key,unsubInput)=>{if(key){return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub)}else return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);if(this.__args&&this.__node.graph){fn=wrapArgs(fn,this.__args,this.__node.graph)}let inpstr=`${this.__node.unique}input`;this.__operator=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(this.__parent instanceof GraphNode&&!this.__subscribedToParent){if(this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__addLocalState=(props,key)=>{if(!props)return;if(!this.__node.localState){this.__node.localState={}}const localState=this.__node.localState;const initState=(props2,k)=>{let str4=this.__node.unique+"."+k;let inpstr=`${str4}input`;if(typeof props2[k]==="function"&&k!=="__operator"){let fn=props2[k].bind(this);props2[k]=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[str4]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.triggerEvent(str4,res)}).catch(console.error)}else this.__node.state.triggerEvent(str4,result)}return result}}else{let get,set;if(this.__props?.[k]){get=()=>{return this.__props[k]};set=v2=>{this.__props[k]=v2;if(this.__node.state.triggers[str4])this.__node.state.triggerEvent(str4,v2)}}else{localState[k]=props2[k];get=()=>{return localState[k]};set=v2=>{localState[k]=v2;if(this.__node.state.triggers[str4])this.__node.state.triggerEvent(str4,v2)}}const descriptor={get,set,enumerable:true,configurable:true};Object.defineProperty(props2,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}};if(key)initState(props,key);else{for(let k in props){initState(props,k)}}};this.__proxyObject=obj=>{const allProps=getAllProperties(obj);for(const k of allProps){if(typeof obj[k]==="function"){this[k]=(...args)=>{return obj[k](...args)}}else{const descriptor={get:()=>{return obj[k]},set:value=>{obj[k]=value},enumerable:true,configurable:true};Object.defineProperty(this,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}}};this.__setProperties(properties,parent,graph)}__addOnconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__onconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){let fn=o=>{o(this)};this.__onconnected.forEach(fn)}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let fn=o=>{o(this)};this.__ondisconnected.forEach(fn)}}};var Graph=class{constructor(options){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state,roots:{}};this.init=options2=>{if(options2){let cpy=Object.assign({},options2);delete cpy.roots;recursivelyAssign(this.__node,cpy);if(options2.roots)this.load(options2.roots)}};this.load=roots=>{function recursivelyAssignChildren(target,obj,inChildren=true,top=true){if(top){if(target)Object.assign(target,obj);else target=Object.assign({},obj);recursivelyAssignChildren(target,obj,true,false)}if(obj.__children&&!inChildren){if(obj.__children?.constructor.name==="Object"){if(target.__children?.constructor.name==="Object")recursivelyAssignChildren(target.__children,obj.__children,true,false);else target.__children=recursivelyAssignChildren({},obj.__children,true,false)}else{target.__children=obj.__children}}else if(inChildren){for(const key in obj){target[key]=Object.assign({},obj[key]);if(obj[key].__children){recursivelyAssignChildren({},obj[key].__children,false,false)}}}return target}this.__node.roots=recursivelyAssignChildren(this.__node.roots?this.__node.roots:{},roots);let cpy=Object.assign({},roots);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,roots);if(roots.__node){if(!roots.__node.tag)roots.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(roots.__node.tag)){let node=new GraphNode(roots,this,this);this.set(node.__node.tag,node);this.runLoaders(node,this,roots,roots.__node.tag);if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(roots.__listeners){this.setListeners(roots.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders22,replace)=>{if(replace)this.__node.loaders=loaders22;else Object.assign(this.__node.loaders,loaders22);return this.__node.loaders};this.runLoaders=(node,parent,properties,key)=>{for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders[l]==="function")this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key)}};this.add=(properties,parent)=>{let listeners={};if(typeof parent==="string")parent=this.get(parent);let instanced;if(typeof properties==="function"){if(isNativeClass(properties)){if(properties.prototype instanceof GraphNode){properties=properties.prototype.constructor(properties,parent,this);instanced=true}else properties=new properties}else properties={__operator:properties}}else if(typeof properties==="string"){properties=this.__node.roots[properties]}if(!properties)return;if(!instanced){let keys22=Object.getOwnPropertyNames(properties);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(properties));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys22.push(...nonArrowFunctions);let cpy={};for(const key of keys22){cpy[key]=properties[key]}properties=cpy}if(!properties.__node)properties.__node={};properties.__node.initial=properties;if(typeof properties==="object"&&!this.get(properties.__node.tag)){let node;if(instanced)node=properties;else node=new GraphNode(properties,parent,this);this.set(node.__node.tag,node);this.runLoaders(node,parent,properties,node.__node.tag);this.__node.roots[node.__node.tag]=properties;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key in node.__listeners){let listener=node.__listeners[key];if(node[key]){delete listeners[node.__node.tag][key];listeners[node.__node.tag][node.__node.tag+"."+key]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][key]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][key]=parent.__node.tag}}}}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t22,parent,listeners={},origin)=>{let keys22=Object.getOwnPropertyNames(origin);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(origin));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys22.push(...nonArrowFunctions);for(const key of keys22){if(key.includes("__"))continue;let p2=origin[key];if(Array.isArray(p2))continue;let instanced;if(typeof p2==="function"){if(isNativeClass(p2)){p2=new p2;if(p2 instanceof GraphNode){p2=p2.prototype.constructor(p2,parent,this);instanced=true}}else p2={__operator:p2}}else if(typeof p2==="string"){if(this.__node.nodes.get(p2))p2=this.__node.nodes.get(p2);else p2=this.__node.roots[p2]}else if(typeof p2==="boolean"){if(this.__node.nodes.get(key))p2=this.__node.nodes.get(key);else p2=this.__node.roots[key]}if(typeof p2==="object"){if(!instanced&&!(p2 instanceof GraphNode)){let ks=Object.getOwnPropertyNames(p2);let nonArrowFunctions2=Object.getOwnPropertyNames(Object.getPrototypeOf(p2));nonArrowFunctions2.splice(nonArrowFunctions2.indexOf("constructor"),1);ks.push(...nonArrowFunctions2);let cpy={};for(const key2 of ks){cpy[key2]=p2[key2]}p2=cpy}if(!p2.__node)p2.__node={};if(!p2.__node.tag)p2.__node.tag=key;if(!p2.__node.initial)p2.__node.initial=t22[key];if(this.get(p2.__node.tag)&&!(!(parent instanceof Graph)&&parent?.__node)||parent?.__node&&this.get(parent.__node.tag+"."+p2.__node.tag))continue;let node;let newnode=false;if(instanced||p2 instanceof GraphNode){node=p2}else{node=new GraphNode(p2,parent,this);newnode=true}if(!newnode&&p2 instanceof GraphNode&&!instanced&&parent instanceof GraphNode){let sub=this.subscribe(parent.__node.tag,node.__node.tag);let ondelete=node2=>{this.unsubscribe(parent.__node.tag,sub)};node.__addOndisconnected(ondelete)}else if(node){this.set(node.__node.tag,node);this.runLoaders(node,parent,t22[key],key);t22[key]=node;this.__node.roots[node.__node.tag]=p2;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key2 in node.__listeners){let listener=node.__listeners[key2];let k=key2;if(node[key2]){delete listeners[node.__node.tag][key2];k=node.__node.tag+"."+key2;listeners[node.__node.tag][k]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][k]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][k]=parent.__node.tag}}}}node.__callConnected()}}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){this.delete(node.__node.tag);delete this.__node.roots[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t22=>{for(const key in t22){this.unsubscribe(t22[key]);this.delete(t22[key].__node.tag);delete this.__node.roots[t22[key].__node.tag];this.delete(key);delete this.__node.roots[key];t22[key].__node.tag=t22[key].__node.tag.substring(t22[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t22[key])}t22[key].__callDisconnected();if(t22[key].__children){recursiveRemove(t22[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}if(node?.__node.graph)node.__node.graph=void 0;return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(!node)continue;if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(node.__operator&&(listeners[key][k][kk].__callback===true||typeof listeners[key][k][kk].__callback==="undefined"))listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(nn){let prop=k.substring(k.lastIndexOf(".")+1);sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k][kk].__args,prop,listeners[key][k][kk].inputState,key,k)}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}if("__callback"in listeners[key][k]){if(listeners[key][k].__callback===true||typeof listeners[key][k].__callback==="undefined")listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k)}}else{sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key]?.sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(typeof node.__listeners[key]==="object"&&!node.__listeners[key]?.__callback){for(const k in node.__listeners[key]){if(typeof node.__listeners[key][k]?.sub==="number"){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}else{if(typeof!node.__listeners[key]?.__callback==="number"){for(const k in node.__listeners[key]){if(node.__listeners[key][k]?.sub){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){let cpy;if(getInitial)cpy=Object.assign({},this.__node.roots[node.__node.tag]);else{cpy=Object.assign({},node);for(const key in cpy){if(key.includes("__"))delete cpy[key]}}}};this.subscribe=(nodeEvent,onEvent,args,key,subInput,target,bound,tkey)=>{let nd=nodeEvent;if(typeof nodeEvent==="string"){nd=this.get(nodeEvent);if(!nd&&nodeEvent.includes(".")){nd=this.get(nodeEvent.substring(0,nodeEvent.lastIndexOf(".")));key=nodeEvent.substring(nodeEvent.lastIndexOf(".")+1)}}if(target instanceof GraphNode)target=target.__node.tag;if(typeof onEvent==="string"){let setOnEventFromString=onEvent2=>{if(this.get(onEvent2)?.__operator){let node=this.get(onEvent2);target=onEvent2;onEvent2=function(...inp){return node.__operator(...inp)}}else if(onEvent2.includes(".")){target=onEvent2.substring(0,onEvent2.lastIndexOf("."));let n=this.get(target);let k=onEvent2.substring(onEvent2.lastIndexOf(".")+1);tkey=k;if(typeof n[k]==="function"){if(n[k]instanceof GraphNode)onEvent2=n[k];else onEvent2=function(...inp){return n[k](...inp)}}else{onEvent2=function(inp){n[k]=inp;return n[k]}}}return onEvent2};if(target){let node=this.get(target);if(typeof node?.[onEvent]==="function"){tkey=onEvent;onEvent=function(...inp){return node[key](...inp)}}else if(node[key]){tkey=key;if(node[key]instanceof GraphNode)onEvent=node[key];else onEvent=function(inp){node[key]=inp;return node[key]}}else{onEvent=setOnEventFromString(onEvent)}}else{onEvent=setOnEventFromString(onEvent)}}let sub;if(nd instanceof GraphNode){const doSub=()=>{sub=nd.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)nd.__unsubscribe(sub,key,subInput);sub=void 0};nd.__addOndisconnected(()=>{ondelete();nd.__addOnconnected(()=>{if(sub===void 0&&nd.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))onEvent=this.get(onEvent);if(onEvent instanceof GraphNode){onEvent.__addOndisconnected(()=>{ondelete()})}};doSub()}else if(typeof nodeEvent==="string"){let node=this.get(nodeEvent);if(node){if(onEvent instanceof GraphNode&&onEvent.__operator){const doSub=()=>{sub=node.__subscribe(onEvent.__operator,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput)};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});onEvent.__addOndisconnected(ondelete)};doSub()}else if(typeof onEvent==="function"||typeof onEvent==="string"){const doSub=()=>{sub=node.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput);sub=void 0};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))this.get(onEvent).__addOndisconnected(ondelete)};doSub()}}else{if(typeof onEvent==="string")onEvent=this.__node.nodes.get(onEvent).__operator;if(typeof onEvent==="function")sub=this.__node.state.subscribeEvent(nodeEvent,onEvent)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"){if(target[key]?.constructor.name==="Object")recursivelyAssign(target[key],obj[key]);else target[key]=recursivelyAssign({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);let fn=function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)};props.forEach(fn)}while(curr=Object.getPrototypeOf(curr));return allProps}function isNativeClass(thing){return isFunction(thing)==="class"}function isFunction(x3){const res=typeof x3==="function"?x3.prototype?Object.getOwnPropertyDescriptor(x3,"prototype")?.writable?"function":"class":x3.constructor.name==="AsyncFunction"?"async":"arrow":"";return res}var wrapArgs=(callback,argOrder,graph)=>{let args=[];let getCallbackFromString=a=>{if(graph.get(a)?.__operator){let node=graph.get(a);return(...inp)=>{node.__operator(...inp)}}else if(a.includes(".")){let split=a.split(".");let popped=split.pop();let joined=split.join(".");let node=graph.get(joined);if(typeof graph.get(joined)?.[popped]==="function"){return(...inp)=>{return node[popped](...inp)}}else return()=>{return node[popped]}}else if(graph.get(a)){let node=graph.get(a);return()=>{return node}}else{let arg=a;return()=>{return arg}}};let forArg=(a,i22)=>{if(a==="__output"||a==="__input"){args[i22]=inp=>{return inp}}else if(typeof a==="string"){args[i22]=getCallbackFromString(a)}else if(typeof a==="function"){let fn2=a;args[i22]=(...inp)=>{return fn2(...inp)}}else if(typeof a==="object"&&a.__input){let recursivelyCreateCallback=function(c){let input=c.__input;if(typeof c.__input==="string"){input=getCallbackFromString(c.__input)}if(c.__args){input=wrapArgs(input,c.__args,graph)}if(c.__output){let output=c.__output;if(typeof c.__output==="string"){output=getCallbackFromString(output)}else if(typeof a.__output==="object"){output=recursivelyCreateCallback(output)}if(typeof output==="function"){let fn2=input;input=(...inp)=>{return output(fn2(...inp))}}}return input};args[i22]=recursivelyCreateCallback(a)}else{let arg=a;args[i22]=()=>{return arg}}};argOrder.forEach(forArg);if(typeof callback==="string")callback=getCallbackFromString(callback);let fn=callback;callback=function(...inp){let mapArg=arg=>{return arg(...inp)};return fn(...args.map(mapArg))};return callback};var backprop=(node,parent,graph)=>{if(node.__node.backward&&parent instanceof GraphNode){graph.setListeners({[parent.__node.tag]:{[node.__node.tag]:parent}})}};var loop=(node,parent,graph)=>{if(node.__operator&&!node.__node.looperSet){if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})})}else if(node.__node.frame===true){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})})}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__setOperator(async(...args)=>{let i22=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i22,...args);return result})}if(node.__node.loop&&typeof node.__node.loop==="number"){node.__node.looperSet=true;let fn=node.__operator;let time=node.__node.loop;node.__setOperator((...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){let last=performance.now();fn(...args);setTimeout(()=>{let now=performance.now();let overshoot=now-last-node.__node.loop;if(overshoot>0)time=node.__node.loop-overshoot;else time=node.__node.loop;if(time<=0)time=node.__node.loop;node.__operator(...args)},time)}});if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate=(node,parent,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__setOperator((...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}});if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator)},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching=(node,parent,graph)=>{if(typeof node.__branch==="object"&&node.__operator&&!node.__branchApplied){let fn=node.__operator;node.__branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__branch){let triggered=()=>{if(typeof node.__branch[key].then==="function"){node.__branch[key].then(result)}else if(node.__branch[key].then instanceof GraphNode&&node.__branch[key].then.__operator){node.__branch[key].then.__operator(result)}else result=node.__branch[key].then};if(typeof node.__branch[key].if==="function"){if(node.__branch[key].if(result)==true){triggered()}}else if(node.__branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator=(node,parent,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.roots?.[node.__node.tag]==="object"&&node.get)graph.__node.roots[node.__node.tag].get=node.get};var loaders={backprop,loop,animate,branching,triggerListenerOncreate,bindListener,transformListenerResult,substitute__operator};var recursivelyStringifyFunctions=obj=>{let cpy={};for(const key in obj){if(typeof obj[key]==="object"){cpy[key]=recursivelyStringifyFunctions(obj[key])}else if(typeof obj[key]==="function"){cpy[key]=obj[key].toString()}else cpy[key]=obj[key]}return cpy};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p2 in value[prop]){if(Array.isArray(value[prop][p2])){if(value[prop][p2].length>20)obj[prop][p2]=value[prop][p2].slice(value[prop][p2].length-20);else obj[prop][p2]=value[prop][p2]}else{if(value[prop][p2]!=null){let con=value[prop][p2].constructor.name;if(con.includes("Set")){obj[prop][p2]=Array.from(value[prop][p2])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p2]="instanceof_"+con}else{obj[prop][p2]=value[prop][p2]}}else{obj[prop][p2]=value[prop][p2]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function methodstrings(node){if(typeof node.__methods==="object"){for(const key in node.__methods){let fstr=node.__methods[key];let fn=typeof fstr==="function"?fstr:parseFunctionFromText(fstr);if(key==="__operator"){node.__setOperator(fn)}else{node[key]=fn.bind(node)}}}}var Service=class extends Graph{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders},options.loaders):{...loaders}});this.name=`service${Math.floor(Math.random()*1e15)}`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.load(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.roots[route]}if(src?.[m]){if(typeof src[m]!=="function"){if(args){if(Array.isArray(args)&&args.length===1)src[m]=args[0];else src[m]=args;return}return src[m]}else{if(Array.isArray(args))return src[m](...args);else return src[m](args)}}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))args[0]=args[0].replace(/\\\\/g,"");if(args[0][0]===\'"\'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return source.__node.state.subscribeEventOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeEventOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray;this.recursivelyAssign=recursivelyAssign2;this.spliceTypedArray=spliceTypedArray;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};this.log=(...args)=>{console.log(...args);return true};this.error=(...args)=>{console.error(...args);return true};if(options?.services)this.addServices(options.services);this.load(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}var recursivelyAssign2=(target,obj)=>{for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign2(target[key],obj[key]);else target[key]=recursivelyAssign2({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str4;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str4=recursivelyStringifyFunctions(properties)}else if(typeof properties==="function")str4=properties.toString();else if(typeof properties==="string")str4=properties;if(str4){if(connection.run)return connection.run("setNode",[str4]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str4},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str4}));return new Promise(r=>r(name2))}}},setNode:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function")properties={__operator:f,__node:{tag:name2?name2:f.name}};else{f=JSON.parse(properties);if(typeof f==="object")properties=f}}if(typeof properties==="object"||typeof properties==="function"){let template={};if(typeof properties==="object")Object.assign(template,properties);else template.__operator=properties;let node=this.__node.graph.add(template);if(node){nodeTemplates[node.__node.tag]=template;return node.__node?.tag}else return false}else return false},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]==="function"){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str4=recursivelyStringifyFunctions(properties);return str4},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function"){if(!name2)name2=f.name;properties={__operator:f,__node:{tag:name2}}}else{f=JSON.parse(properties);if(typeof f==="object"){properties=f;if(!name2&&f.__node?.tag)name2=f.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=recursivelyAssign2({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(nodeTag,fn,methodKey){if(typeof fn==="string"){let f=parseFunctionFromText(fn);if(typeof f==="function")fn=f}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(nodeTag)){this.__node.graph.get(nodeTag)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key in properties){result[key]=typeof node[key]}return result}return void 0},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str4=classObj.toString();let message={route:"receiveClass",args:[str4,className]};if(connection.run)return connection.run("receiveClass",[str4,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str4,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str4,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str4=fn.toString();let message={route:"setNode",args:[str4,fnName]};if(connection.run)return connection.run("setNode",[str4,fnName]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:[str4,fnName]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:[str4,fnName]}));return new Promise(r=>r(name))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};function html(strings,...args){return function append(elm=document.createElement("div")){let template=document.createElement("template");strings.map(function(s,i22){template.innerHTML+=s;if(args[i22]instanceof HTMLElement){let dummy22=`<span id="dummyNode12345"></span>`;dummy22.id="dummyNode12345";template.innerHTML+=dummy22}else template.innerHTML+=args[i22]});let query=template.content.querySelectorAll("#dummyNode12345");let ctr=0;args.forEach((arg,i22)=>{if(arg instanceof HTMLElement){console.log(arg,query[ctr]);template.content.replaceChild(arg,query[ctr]);ctr++}});elm.appendChild(template.content);return elm}}var dummy=html``;var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d2,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this.b=[d2=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d2[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d2[a]=d2[a-b]^c}for(b=0;a;b++,a--)c=d2[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d2=b[4],e,f,g,h=[],k=[],l,n,m,p2;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d2[m]=f,n=h[e=h[l=h[f]]],p2=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p2=p2<<24^p2>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t(a,b,c){if(4!==b.length)throw new sjcl.exception.invalid("invalid aes block size");var d2=a.b[c],e=b[0]^d2[0],f=b[c?3:1]^d2[1],g=b[2]^d2[2];b=b[c?1:3]^d2[3];var h,k,l,n=d2.length/4-2,m,p2=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v2=h[2],w=h[3],x3=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v2[g>>8&255]^w[b&255]^d2[p2],k=a[f>>>24]^q[g>>16&255]^v2[b>>8&255]^w[e&255]^d2[p2+1],l=a[g>>>24]^q[b>>16&255]^v2[e>>8&255]^w[f&255]^d2[p2+2],b=a[b>>>24]^q[e>>16&255]^v2[f>>8&255]^w[g&255]^d2[p2+3],p2+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x3[e>>>24]<<24^x3[f>>16&255]<<16^x3[g>>8&255]<<8^x3[b&255]^d2[p2++],h=e,e=f,f=g,g=b,b=h;return r}sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d2=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d2^a[b/32+1|0]>>>d2:a[b/32|0]>>>d2)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d2=sjcl.bitArray.getPartial(c);return 32===d2?a.concat(b):sjcl.bitArray.$(b,d2,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d2;for(d2=0;d2<a.length;d2++)c|=a[d2]^b[d2];return 0===c},$:function(a,b,c,d2){var e;e=0;for(void 0===d2&&(d2=[]);32<=b;b-=32)d2.push(c),c=0;if(0===b)return d2.concat(a);for(e=0;e<a.length;e++)d2.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d2.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d2.pop(),1));return d2},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d2,e;for(d2=0;d2<c/8;d2++)0===(d2&3)&&(e=a[d2/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d2=0;for(c=0;c<a.length;c++)d2=d2<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d2),d2=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d2));return b}};sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d2;a=a.replace(/\\s|0x/g,"");d2=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d2)}};sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d2=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32.B,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.X);for(c=0;f.length*d2<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d2?(k=a[c]<<d2-g,g+=e,c++):(k<<=d2,g-=d2);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,d2=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p2){}throw new sjcl.exception.invalid("this isn\'t "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d2,l^=n<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d2="",e=0,f=sjcl.codec.base64.B,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d2.length<h;)d2+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d2.length&3&&!b;)d2+="=";return d2},toBits:function(a,b){a=a.replace(/\\s|=/g,"");var c=[],d2,e=0,f=sjcl.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d2=0;d2<a.length;d2++){h=f.indexOf(a.charAt(d2));if(0>h)throw new sjcl.exception.invalid("this isn\'t base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl.hash.sha256.hash=function(a){return new sjcl.hash.sha256().update(a).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.A=sjcl.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d2=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u(this,d2.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d2,e;64>b;c++){e=true;for(d2=2;d2*d2<=c;d2++)if(0===c%d2){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u(a,b){var c,d2,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p2=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d2=b[c]:(d2=b[c+1&15],e=b[c+14&15],d2=b[c&15]=(d2>>>7^d2>>>18^d2>>>3^d2<<25^d2<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d2=d2+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p2^r))+g[c],q=r,r=p2,p2=m,m=n+d2|0,n=l,l=k,k=h,h=d2+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p2|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.G.indexOf(a);-1<a&&sjcl.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d2,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d2=d2||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.V(a,b,c,d2,e,f);g=sjcl.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d2,e){e=e||64;d2=d2||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm.C(a,k,c,l,e,b);a=sjcl.mode.ccm.V(a,k.data,c,d2,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn\'t match");return k.data},na:function(a,b,c,d2,e,f){var g=[],h=sjcl.bitArray,k=h.i;d2=[h.partial(8,(b.length?64:0)|d2-2<<2|f-1)];d2=h.concat(d2,c);d2[3]|=e;d2=a.encrypt(d2);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d2=a.encrypt(k(d2,g.slice(b,b+4).concat([0,0,0])));return d2},V:function(a,b,c,d2,e,f){var g=sjcl.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<d2.length||4294967295<b.length)throw new sjcl.exception.bug("ccm: can\'t deal with 4GiB or more data");c=sjcl.mode.ccm.na(a,d2,c,e,g.bitLength(b)/8,f);for(d2=0;d2<b.length;d2+=4)c=a.encrypt(h(c,b.slice(d2,d2+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d2,e,f){var g,h=sjcl.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d2=h.bitSlice(g(d2,a.encrypt(c)),0,e);if(!k)return{tag:d2,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d2,data:h.clamp(b,l)}}};sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d2,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.S,k=sjcl.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p2=[];d2=d2||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p2=p2.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d2.length&&(n=l(n,f?d2:sjcl.mode.ocb2.pmac(a,d2)));return p2.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d2,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.S,h=sjcl.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p2,r=sjcl.bitArray.bitLength(b)-e,q=[];d2=d2||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p2=r-32*c;m=a.encrypt(k(n,[0,0,0,p2]));m=k(m,h.clamp(b.slice(c),p2).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d2.length&&(l=k(l,f?d2:sjcl.mode.ocb2.pmac(a,d2)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn\'t match");return q.concat(h.clamp(m,p2))},pmac:function(a,b){var c,d2=sjcl.mode.ocb2.S,e=sjcl.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d2(d2(h)));for(c=0;c+4<b.length;c+=4)h=d2(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d2(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d2(f(h,d2(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d2,e){var f=b.slice(0);b=sjcl.bitArray;d2=d2||[];a=sjcl.mode.gcm.C(true,a,f,d2,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d2,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d2=d2||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm.C(false,a,f,d2,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn\'t match");return a.data},ka:function(a,b){var c,d2,e,f,g,h=sjcl.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d2=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d2=3;0<d2;d2--)f[d2]=f[d2]>>>1|(f[d2-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d2,e=c.length;b=b.slice(0);for(d2=0;d2<e;d2+=4)b[0]^=4294967295&c[d2],b[1]^=4294967295&c[d2+1],b[2]^=4294967295&c[d2+2],b[3]^=4294967295&c[d2+3],b=sjcl.mode.gcm.ka(b,a);return b},C:function(a,b,c,d2,e,f){var g,h,k,l,n,m,p2,r,q=sjcl.bitArray;m=c.length;p2=q.bitLength(c);r=q.bitLength(d2);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm.j(g,[0,0,0,0],e),e=sjcl.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl.mode.gcm.j(g,[0,0,0,0],d2);n=e.slice(0);d2=h.slice(0);a||(d2=sjcl.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p2);a&&(d2=sjcl.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p2/4294967296),p2&4294967295];d2=sjcl.mode.gcm.j(g,d2,a);k=b.encrypt(e);d2[0]^=k[0];d2[1]^=k[1];d2[2]^=k[2];d2[3]^=k[3];return{tag:q.bitSlice(d2,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.W=b=b||sjcl.hash.sha256;var c=[[],[]],d2,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d2=0;d2<e;d2++)c[0][d2]=a[d2]^909522486,c[1][d2]=a[d2]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl.misc.pbkdf2=function(a,b,c,d2,e){c=c||1e4;if(0>d2||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl.bitArray;for(k=1;32*l.length<(d2||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d2&&(l=n.clamp(l,d2));return l};sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl.prng.prototype={randomWords:function(a,b){var c=[],d2;d2=this.isReady(b);var e;if(d2===this.u)throw new sjcl.exception.notReady("generator isn\'t seeded");if(d2&this.J){d2=!(d2&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d2||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.L=new sjcl.cipher.aes(this.b);for(d2=0;4>d2&&(this.h[d2]=this.h[d2]+1|0,!this.h[d2]);d2++);}for(d2=0;d2<a;d2+=4)0===(d2+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d2,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d2=this.U[c];void 0===d2&&(d2=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d2,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d2,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d2,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl.exception.bug("can\'t attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d2,e=this.K[a],f=[];for(d2 in e)e.hasOwnProperty(d2)&&e[d2]===b&&f.push(d2);for(c=0;c<f.length;c++)d2=f[c],delete e[d2]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d2){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};function A(a,b){var c,d2=sjcl.random.K[a],e=[];for(c in d2)d2.hasOwnProperty(c)&&e.push(d2[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);a:try{if(G="undefined"!==typeof module&&module.exports){try{H=__require2("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl.random.addEntropy(D,1024,"crypto[\'randomBytes\']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);else break a;sjcl.random.addEntropy(F,1024,"crypto[\'getRandomValues\']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D;var E;var F;var G;var H;sjcl.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d2){c=c||{};d2=d2||{};var e=sjcl.json,f=e.g({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e.g(d2,f);d2.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d2){var e=sjcl.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d2){c=c||{};d2=d2||{};var e=sjcl.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d2,b);d2.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d2){var e=sjcl.json;return e.ia(a,e.decode(b),c,d2)},encode:function(a){var b,c="{",d2="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d2+\'"\'+b+\'":\';d2=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+=\'"\'+escape(a[b])+\'"\';break;case"object":c+=\'"\'+sjcl.codec.base64.fromBits(a[b],0)+\'"\';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\s/g,"");if(!a.match(/^\\{.*\\}$/))throw new sjcl.exception.invalid("json decode: this isn\'t json!");a=a.replace(/^\\{|\\}$/g,"").split(/,/);var b={},c,d2;for(c=0;c<a.length;c++){if(!(d2=a[c].match(/^\\s*(?:(["\']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn\'t json!");null!=d2[3]?b[d2[2]]=parseInt(d2[3],10):null!=d2[4]?b[d2[2]]=d2[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d2[4]):unescape(d2[4]):null!=d2[5]&&(b[d2[2]]="true"===d2[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d2 in b)if(b.hasOwnProperty(d2)){if(c&&void 0!==a[d2]&&a[d2]!==b[d2])throw new sjcl.exception.invalid("required parameter overridden");a[d2]=b[d2]}return a},sa:function(a,b){var c={},d2;for(d2 in a)a.hasOwnProperty(d2)&&a[d2]!==b[d2]&&(c[d2]=a[d2]);return c},ra:function(a,b){var c={},d2;for(d2=0;d2<b.length;d2++)void 0!==a[b[d2]]&&(c[b[d2]]=a[b[d2]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.pa={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.pa,d2;b=b||{};d2=b.iter||1e3;c=c[a]=c[a]||{};d2=c[d2]=c[d2]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d2.firstSalt:b.salt;d2[c]=d2[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d2[c].slice(0),salt:c.slice(0)}};var _HTTPfrontend=class extends Service{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url2="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"GET",url:url2,responseType:type,mimeType,onload:ev2=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url2 instanceof URL)url2=url2.toString();this.setState({[url2]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url2="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"POST",url:url2,data:message,responseType:type,mimeType,onload:ev2=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url2 instanceof URL)url2=url2.toString();this.setState({[url2]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url2)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url2);return this.POST(message,url2)};this.transponder=(url2,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method,url:url2,data:message,responseType:type,onload:ev2=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))body=body.replace(/\\\\/g,"");if(body[0]===\'"\'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=`${path2}${Math.floor(Math.random()*1e15)}`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch2,that,args){const result=fetch2.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.load(this);this.listen(path,fetched)}};var HTTPfrontend=_HTTPfrontend;HTTPfrontend.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker=__toESM(require_browser());var WorkerService=class extends Service{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt)}rt.worker=worker;if(!rt.worker.__ondisconnected){let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,void 0,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev2=>{let result=this.receive(ev2.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=`worker${Math.floor(Math.random()*1e15)}`;if(options2.url)worker=new import_web_worker.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev2=>{if(typeof ev2.data==="object"){if(ev2.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev2.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev2=>{if(typeof ev2.data==="object"){if(ev2.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev2.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev2=>{this.receive(ev2.data);this.setState({[options2._id]:ev2.data})};if(!options2.onerror){options2.onerror=ev2=>{console.error(ev2.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.open=this.addWorker;this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys22=Object.keys(this.workers);this.workers[keys22[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys22.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof import_web_worker.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev2=>{if(typeof ev2.data==="object"){if(ev2.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev2.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,args,key,subInput,blocking)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};this.subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i22=0;i22<this.__node.state.triggers[workerId].length;i22++){await this.__node.state.triggers[workerId][i22].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}};var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault()}function copyProperties(src,properties,dst){for(const name2 of properties){dst[name2]=src[name2]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();const touches=[];const data={type:event.type,touches};for(let i22=0;i22<event.touches.length;++i22){const touch=event.touches[i22];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i=1;var keys={};while(i<222){keys[i]=true;i++}function filteredKeydownEventHandler(event,sendFn,preventDefault){let{keyCode}=event;if(keys[keyCode]){if(preventDefault&&event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,pointerlockchange:mouseEventHandler,webkitpointerlockchange:mouseEventHandler,focus:focusEventHandler,blur:focusEventHandler,pointerout:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler,keyup:filteredKeydownEventHandler};function initProxyElement(element,worker,id,preventDefault){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent,preventDefault)})}if(eventHandlers.keydown){globalThis.addEventListener("keydown",function(ev2){eventHandlers.keydown(ev2,sendEvent,preventDefault)})}if(eventHandlers.keyup){globalThis.addEventListener("keyup",function(ev2){eventHandlers.keyup(ev2,sendEvent,preventDefault)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i22=0,l=array.length;i22<l;i22++){array[i22].call(this,event)}}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id,options.preventDefault);return setupCanvas(options)}}function transferCanvas(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id,options.preventDefault);else initProxyElement(options.canvas,worker,options._id,options.preventDefault);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText3(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText3(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText3(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText3(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText3(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText3(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText3(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText3(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts=getCanvas.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText3(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim,getCanvas};function parseFunctionFromText3(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var __create2=Object.create;var __defProp2=Object.defineProperty;var __getOwnPropDesc2=Object.getOwnPropertyDescriptor;var __getOwnPropNames2=Object.getOwnPropertyNames;var __getProtoOf2=Object.getPrototypeOf;var __hasOwnProp2=Object.prototype.hasOwnProperty;var __require3=(x3=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x3)(function(x3){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var __commonJS2=(cb,mod)=>function __require23(){return mod||(0,cb[__getOwnPropNames2(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __export=(target,all)=>{for(var name2 in all)__defProp2(target,name2,{get:all[name2],enumerable:true})};var __copyProps2=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames2(from))if(!__hasOwnProp2.call(to,key)&&key!==except)__defProp2(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc2(from,key))||desc.enumerable})}return to};var __toESM2=(mod,isNodeMode,target)=>(target=mod!=null?__create2(__getProtoOf2(mod)):{},__copyProps2(isNodeMode||!mod||!mod.__esModule?__defProp2(target,"default",{value:mod,enumerable:true}):target,mod));var require_bson=__commonJS2({"struct/datastructures/bson.cjs"(exports){"use strict";var BSON_MAJOR_VERSION=5;var BSON_INT32_MAX=2147483647;var BSON_INT32_MIN=-2147483648;var BSON_INT64_MAX=Math.pow(2,63)-1;var BSON_INT64_MIN=-Math.pow(2,63);var JS_INT_MAX=Math.pow(2,53);var JS_INT_MIN=-Math.pow(2,53);var BSON_DATA_NUMBER=1;var BSON_DATA_STRING=2;var BSON_DATA_OBJECT=3;var BSON_DATA_ARRAY=4;var BSON_DATA_BINARY=5;var BSON_DATA_UNDEFINED=6;var BSON_DATA_OID=7;var BSON_DATA_BOOLEAN=8;var BSON_DATA_DATE=9;var BSON_DATA_NULL=10;var BSON_DATA_REGEXP=11;var BSON_DATA_DBPOINTER=12;var BSON_DATA_CODE=13;var BSON_DATA_SYMBOL=14;var BSON_DATA_CODE_W_SCOPE=15;var BSON_DATA_INT=16;var BSON_DATA_TIMESTAMP=17;var BSON_DATA_LONG=18;var BSON_DATA_DECIMAL128=19;var BSON_DATA_MIN_KEY=255;var BSON_DATA_MAX_KEY=127;var BSON_BINARY_SUBTYPE_DEFAULT=0;var BSON_BINARY_SUBTYPE_UUID_NEW=4;var BSONType=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127});var BSONError=class extends Error{get bsonError(){return true}get name(){return"BSONError"}constructor(message){super(message)}static isBSONError(value){return value!=null&&typeof value==="object"&&"bsonError"in value&&value.bsonError===true&&"name"in value&&"message"in value&&"stack"in value}};var BSONVersionError=class extends BSONError{get name(){return"BSONVersionError"}constructor(){super(`Unsupported BSON version, bson types must be from bson ${BSON_MAJOR_VERSION}.0 or later`)}};var BSONRuntimeError=class extends BSONError{get name(){return"BSONRuntimeError"}constructor(message){super(message)}};function nodejsMathRandomBytes(byteLength){return nodeJsByteUtils.fromNumberArray(Array.from({length:byteLength},()=>Math.floor(Math.random()*256)))}var nodejsRandomBytes=(()=>{try{return __require3("crypto").randomBytes}catch{return nodejsMathRandomBytes}})();var nodeJsByteUtils={toLocalBufferType(potentialBuffer){if(Buffer.isBuffer(potentialBuffer)){return potentialBuffer}if(ArrayBuffer.isView(potentialBuffer)){return Buffer.from(potentialBuffer.buffer,potentialBuffer.byteOffset,potentialBuffer.byteLength)}const stringTag=potentialBuffer?.[Symbol.toStringTag]??Object.prototype.toString.call(potentialBuffer);if(stringTag==="ArrayBuffer"||stringTag==="SharedArrayBuffer"||stringTag==="[object ArrayBuffer]"||stringTag==="[object SharedArrayBuffer]"){return Buffer.from(potentialBuffer)}throw new BSONError(`Cannot create Buffer from ${String(potentialBuffer)}`)},allocate(size){return Buffer.alloc(size)},equals(a,b){return nodeJsByteUtils.toLocalBufferType(a).equals(b)},fromNumberArray(array){return Buffer.from(array)},fromBase64(base64){return Buffer.from(base64,"base64")},toBase64(buffer2){return nodeJsByteUtils.toLocalBufferType(buffer2).toString("base64")},fromISO88591(codePoints){return Buffer.from(codePoints,"binary")},toISO88591(buffer2){return nodeJsByteUtils.toLocalBufferType(buffer2).toString("binary")},fromHex(hex){return Buffer.from(hex,"hex")},toHex(buffer2){return nodeJsByteUtils.toLocalBufferType(buffer2).toString("hex")},fromUTF8(text){return Buffer.from(text,"utf8")},toUTF8(buffer2){return nodeJsByteUtils.toLocalBufferType(buffer2).toString("utf8")},utf8ByteLength(input){return Buffer.byteLength(input,"utf8")},encodeUTF8Into(buffer2,source,byteOffset){return nodeJsByteUtils.toLocalBufferType(buffer2).write(source,byteOffset,void 0,"utf8")},randomBytes:nodejsRandomBytes};function isReactNative(){const{navigator:navigator2}=globalThis;return typeof navigator2==="object"&&navigator2.product==="ReactNative"}function webMathRandomBytes(byteLength){if(byteLength<0){throw new RangeError(`The argument \'byteLength\' is invalid. Received ${byteLength}`)}return webByteUtils.fromNumberArray(Array.from({length:byteLength},()=>Math.floor(Math.random()*256)))}var webRandomBytes=(()=>{const{crypto}=globalThis;if(crypto!=null&&typeof crypto.getRandomValues==="function"){return byteLength=>{return crypto.getRandomValues(webByteUtils.allocate(byteLength))}}else{if(isReactNative()){const{console:console2}=globalThis;console2?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return webMathRandomBytes}})();var HEX_DIGIT=/(\\d|[a-f])/i;var webByteUtils={toLocalBufferType(potentialUint8array){const stringTag=potentialUint8array?.[Symbol.toStringTag]??Object.prototype.toString.call(potentialUint8array);if(stringTag==="Uint8Array"){return potentialUint8array}if(ArrayBuffer.isView(potentialUint8array)){return new Uint8Array(potentialUint8array.buffer.slice(potentialUint8array.byteOffset,potentialUint8array.byteOffset+potentialUint8array.byteLength))}if(stringTag==="ArrayBuffer"||stringTag==="SharedArrayBuffer"||stringTag==="[object ArrayBuffer]"||stringTag==="[object SharedArrayBuffer]"){return new Uint8Array(potentialUint8array)}throw new BSONError(`Cannot make a Uint8Array from ${String(potentialUint8array)}`)},allocate(size){if(typeof size!=="number"){throw new TypeError(`The "size" argument must be of type number. Received ${String(size)}`)}return new Uint8Array(size)},equals(a,b){if(a.byteLength!==b.byteLength){return false}for(let i3=0;i3<a.byteLength;i3++){if(a[i3]!==b[i3]){return false}}return true},fromNumberArray(array){return Uint8Array.from(array)},fromBase64(base64){return Uint8Array.from(atob(base64),c=>c.charCodeAt(0))},toBase64(uint8array){return btoa(webByteUtils.toISO88591(uint8array))},fromISO88591(codePoints){return Uint8Array.from(codePoints,c=>c.charCodeAt(0)&255)},toISO88591(uint8array){return Array.from(Uint16Array.from(uint8array),b=>String.fromCharCode(b)).join("")},fromHex(hex){const evenLengthHex=hex.length%2===0?hex:hex.slice(0,hex.length-1);const buffer2=[];for(let i3=0;i3<evenLengthHex.length;i3+=2){const firstDigit=evenLengthHex[i3];const secondDigit=evenLengthHex[i3+1];if(!HEX_DIGIT.test(firstDigit)){break}if(!HEX_DIGIT.test(secondDigit)){break}const hexDigit=Number.parseInt(`${firstDigit}${secondDigit}`,16);buffer2.push(hexDigit)}return Uint8Array.from(buffer2)},toHex(uint8array){return Array.from(uint8array,byte=>byte.toString(16).padStart(2,"0")).join("")},fromUTF8(text){return new TextEncoder().encode(text)},toUTF8(uint8array){return new TextDecoder("utf8",{fatal:false}).decode(uint8array)},utf8ByteLength(input){return webByteUtils.fromUTF8(input).byteLength},encodeUTF8Into(buffer2,source,byteOffset){const bytes=webByteUtils.fromUTF8(source);buffer2.set(bytes,byteOffset);return bytes.byteLength},randomBytes:webRandomBytes};var hasGlobalBuffer=typeof Buffer==="function"&&Buffer.prototype?._isBuffer!==true;var ByteUtils=hasGlobalBuffer?nodeJsByteUtils:webByteUtils;var BSONDataView=class extends DataView{static fromUint8Array(input){return new DataView(input.buffer,input.byteOffset,input.byteLength)}};var VALIDATION_REGEX=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i;var uuidValidateString=str23=>typeof str23==="string"&&VALIDATION_REGEX.test(str23);var uuidHexStringToBuffer=hexString=>{if(!uuidValidateString(hexString)){throw new BSONError(\'UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".\')}const sanitizedHexString=hexString.replace(/-/g,"");return ByteUtils.fromHex(sanitizedHexString)};function bufferToUuidHexString(buffer2,includeDashes=true){if(includeDashes){return[ByteUtils.toHex(buffer2.subarray(0,4)),ByteUtils.toHex(buffer2.subarray(4,6)),ByteUtils.toHex(buffer2.subarray(6,8)),ByteUtils.toHex(buffer2.subarray(8,10)),ByteUtils.toHex(buffer2.subarray(10,16))].join("-")}return ByteUtils.toHex(buffer2)}function isAnyArrayBuffer(value){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(value))}function isUint8Array(value){return Object.prototype.toString.call(value)==="[object Uint8Array]"}function isRegExp(d2){return Object.prototype.toString.call(d2)==="[object RegExp]"}function isMap(d2){return Object.prototype.toString.call(d2)==="[object Map]"}function isDate(d2){return Object.prototype.toString.call(d2)==="[object Date]"}var BSONValue=class{get[Symbol.for("@@mdb.bson.version")](){return BSON_MAJOR_VERSION}};var Binary=class extends BSONValue{get _bsontype(){return"Binary"}constructor(buffer2,subType){super();if(!(buffer2==null)&&!(typeof buffer2==="string")&&!ArrayBuffer.isView(buffer2)&&!(buffer2 instanceof ArrayBuffer)&&!Array.isArray(buffer2)){throw new BSONError("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>")}this.sub_type=subType??Binary.BSON_BINARY_SUBTYPE_DEFAULT;if(buffer2==null){this.buffer=ByteUtils.allocate(Binary.BUFFER_SIZE);this.position=0}else{if(typeof buffer2==="string"){this.buffer=ByteUtils.fromISO88591(buffer2)}else if(Array.isArray(buffer2)){this.buffer=ByteUtils.fromNumberArray(buffer2)}else{this.buffer=ByteUtils.toLocalBufferType(buffer2)}this.position=this.buffer.byteLength}}put(byteValue){if(typeof byteValue==="string"&&byteValue.length!==1){throw new BSONError("only accepts single character String")}else if(typeof byteValue!=="number"&&byteValue.length!==1)throw new BSONError("only accepts single character Uint8Array or Array");let decodedByte;if(typeof byteValue==="string"){decodedByte=byteValue.charCodeAt(0)}else if(typeof byteValue==="number"){decodedByte=byteValue}else{decodedByte=byteValue[0]}if(decodedByte<0||decodedByte>255){throw new BSONError("only accepts number in a valid unsigned byte range 0-255")}if(this.buffer.byteLength>this.position){this.buffer[this.position++]=decodedByte}else{const newSpace=ByteUtils.allocate(Binary.BUFFER_SIZE+this.buffer.length);newSpace.set(this.buffer,0);this.buffer=newSpace;this.buffer[this.position++]=decodedByte}}write(sequence,offset){offset=typeof offset==="number"?offset:this.position;if(this.buffer.byteLength<offset+sequence.length){const newSpace=ByteUtils.allocate(this.buffer.byteLength+sequence.length);newSpace.set(this.buffer,0);this.buffer=newSpace}if(ArrayBuffer.isView(sequence)){this.buffer.set(ByteUtils.toLocalBufferType(sequence),offset);this.position=offset+sequence.byteLength>this.position?offset+sequence.length:this.position}else if(typeof sequence==="string"){const bytes=ByteUtils.fromISO88591(sequence);this.buffer.set(bytes,offset);this.position=offset+sequence.length>this.position?offset+sequence.length:this.position}}read(position,length){length=length&&length>0?length:this.position;return this.buffer.slice(position,position+length)}value(asRaw){asRaw=!!asRaw;if(asRaw&&this.buffer.length===this.position){return this.buffer}if(asRaw){return this.buffer.slice(0,this.position)}return ByteUtils.toISO88591(this.buffer.subarray(0,this.position))}length(){return this.position}toJSON(){return ByteUtils.toBase64(this.buffer)}toString(encoding){if(encoding==="hex")return ByteUtils.toHex(this.buffer);if(encoding==="base64")return ByteUtils.toBase64(this.buffer);if(encoding==="utf8"||encoding==="utf-8")return ByteUtils.toUTF8(this.buffer);return ByteUtils.toUTF8(this.buffer)}toExtendedJSON(options){options=options||{};const base64String=ByteUtils.toBase64(this.buffer);const subType=Number(this.sub_type).toString(16);if(options.legacy){return{$binary:base64String,$type:subType.length===1?"0"+subType:subType}}return{$binary:{base64:base64String,subType:subType.length===1?"0"+subType:subType}}}toUUID(){if(this.sub_type===Binary.SUBTYPE_UUID){return new UUID(this.buffer.slice(0,this.position))}throw new BSONError(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${Binary.SUBTYPE_UUID}" is currently supported.`)}static fromExtendedJSON(doc,options){options=options||{};let data;let type;if("$binary"in doc){if(options.legacy&&typeof doc.$binary==="string"&&"$type"in doc){type=doc.$type?parseInt(doc.$type,16):0;data=ByteUtils.fromBase64(doc.$binary)}else{if(typeof doc.$binary!=="string"){type=doc.$binary.subType?parseInt(doc.$binary.subType,16):0;data=ByteUtils.fromBase64(doc.$binary.base64)}}}else if("$uuid"in doc){type=4;data=uuidHexStringToBuffer(doc.$uuid)}if(!data){throw new BSONError(`Unexpected Binary Extended JSON format ${JSON.stringify(doc)}`)}return type===BSON_BINARY_SUBTYPE_UUID_NEW?new UUID(data):new Binary(data,type)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Binary(Buffer.from("${ByteUtils.toHex(this.buffer)}", "hex"), ${this.sub_type})`}};Binary.BSON_BINARY_SUBTYPE_DEFAULT=0;Binary.BUFFER_SIZE=256;Binary.SUBTYPE_DEFAULT=0;Binary.SUBTYPE_FUNCTION=1;Binary.SUBTYPE_BYTE_ARRAY=2;Binary.SUBTYPE_UUID_OLD=3;Binary.SUBTYPE_UUID=4;Binary.SUBTYPE_MD5=5;Binary.SUBTYPE_ENCRYPTED=6;Binary.SUBTYPE_COLUMN=7;Binary.SUBTYPE_USER_DEFINED=128;var UUID_BYTE_LENGTH=16;var UUID=class extends Binary{constructor(input){let bytes;let hexStr;if(input==null){bytes=UUID.generate()}else if(input instanceof UUID){bytes=ByteUtils.toLocalBufferType(new Uint8Array(input.buffer));hexStr=input.__id}else if(ArrayBuffer.isView(input)&&input.byteLength===UUID_BYTE_LENGTH){bytes=ByteUtils.toLocalBufferType(input)}else if(typeof input==="string"){bytes=uuidHexStringToBuffer(input)}else{throw new BSONError("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).")}super(bytes,BSON_BINARY_SUBTYPE_UUID_NEW);this.__id=hexStr}get id(){return this.buffer}set id(value){this.buffer=value;if(UUID.cacheHexString){this.__id=bufferToUuidHexString(value)}}toHexString(includeDashes=true){if(UUID.cacheHexString&&this.__id){return this.__id}const uuidHexString=bufferToUuidHexString(this.id,includeDashes);if(UUID.cacheHexString){this.__id=uuidHexString}return uuidHexString}toString(encoding){if(encoding==="hex")return ByteUtils.toHex(this.id);if(encoding==="base64")return ByteUtils.toBase64(this.id);return this.toHexString()}toJSON(){return this.toHexString()}equals(otherId){if(!otherId){return false}if(otherId instanceof UUID){return ByteUtils.equals(otherId.id,this.id)}try{return ByteUtils.equals(new UUID(otherId).id,this.id)}catch{return false}}toBinary(){return new Binary(this.id,Binary.SUBTYPE_UUID)}static generate(){const bytes=ByteUtils.randomBytes(UUID_BYTE_LENGTH);bytes[6]=bytes[6]&15|64;bytes[8]=bytes[8]&63|128;return bytes}static isValid(input){if(!input){return false}if(input instanceof UUID){return true}if(typeof input==="string"){return uuidValidateString(input)}if(isUint8Array(input)){if(input.byteLength!==UUID_BYTE_LENGTH){return false}return(input[6]&240)===64&&(input[8]&128)===128}return false}static createFromHexString(hexString){const buffer2=uuidHexStringToBuffer(hexString);return new UUID(buffer2)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new UUID("${this.toHexString()}")`}};var Code=class extends BSONValue{get _bsontype(){return"Code"}constructor(code,scope){super();this.code=code.toString();this.scope=scope??null}toJSON(){if(this.scope!=null){return{code:this.code,scope:this.scope}}return{code:this.code}}toExtendedJSON(){if(this.scope){return{$code:this.code,$scope:this.scope}}return{$code:this.code}}static fromExtendedJSON(doc){return new Code(doc.$code,doc.$scope)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){const codeJson=this.toJSON();return`new Code("${String(codeJson.code)}"${codeJson.scope!=null?`, ${JSON.stringify(codeJson.scope)}`:""})`}};function isDBRefLike(value){return value!=null&&typeof value==="object"&&"$id"in value&&value.$id!=null&&"$ref"in value&&typeof value.$ref==="string"&&(!("$db"in value)||"$db"in value&&typeof value.$db==="string")}var DBRef=class extends BSONValue{get _bsontype(){return"DBRef"}constructor(collection,oid,db,fields){super();const parts=collection.split(".");if(parts.length===2){db=parts.shift();collection=parts.shift()}this.collection=collection;this.oid=oid;this.db=db;this.fields=fields||{}}get namespace(){return this.collection}set namespace(value){this.collection=value}toJSON(){const o=Object.assign({$ref:this.collection,$id:this.oid},this.fields);if(this.db!=null)o.$db=this.db;return o}toExtendedJSON(options){options=options||{};let o={$ref:this.collection,$id:this.oid};if(options.legacy){return o}if(this.db)o.$db=this.db;o=Object.assign(o,this.fields);return o}static fromExtendedJSON(doc){const copy=Object.assign({},doc);delete copy.$ref;delete copy.$id;delete copy.$db;return new DBRef(doc.$ref,doc.$id,doc.$db,copy)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){const oid=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return`new DBRef("${this.namespace}", new ObjectId("${String(oid)}")${this.db?`, "${this.db}"`:""})`}};var wasm=void 0;try{wasm=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var TWO_PWR_16_DBL=1<<16;var TWO_PWR_24_DBL=1<<24;var TWO_PWR_32_DBL=TWO_PWR_16_DBL*TWO_PWR_16_DBL;var TWO_PWR_64_DBL=TWO_PWR_32_DBL*TWO_PWR_32_DBL;var TWO_PWR_63_DBL=TWO_PWR_64_DBL/2;var INT_CACHE={};var UINT_CACHE={};var MAX_INT64_STRING_LENGTH=20;var DECIMAL_REG_EX=/^(\\+?0|(\\+|-)?[1-9][0-9]*)$/;var Long=class extends BSONValue{get _bsontype(){return"Long"}get __isLong__(){return true}constructor(low=0,high,unsigned){super();if(typeof low==="bigint"){Object.assign(this,Long.fromBigInt(low,!!high))}else if(typeof low==="string"){Object.assign(this,Long.fromString(low,!!high))}else{this.low=low|0;this.high=high|0;this.unsigned=!!unsigned}}static fromBits(lowBits,highBits,unsigned){return new Long(lowBits,highBits,unsigned)}static fromInt(value,unsigned){let obj,cachedObj,cache;if(unsigned){value>>>=0;if(cache=0<=value&&value<256){cachedObj=UINT_CACHE[value];if(cachedObj)return cachedObj}obj=Long.fromBits(value,(value|0)<0?-1:0,true);if(cache)UINT_CACHE[value]=obj;return obj}else{value|=0;if(cache=-128<=value&&value<128){cachedObj=INT_CACHE[value];if(cachedObj)return cachedObj}obj=Long.fromBits(value,value<0?-1:0,false);if(cache)INT_CACHE[value]=obj;return obj}}static fromNumber(value,unsigned){if(isNaN(value))return unsigned?Long.UZERO:Long.ZERO;if(unsigned){if(value<0)return Long.UZERO;if(value>=TWO_PWR_64_DBL)return Long.MAX_UNSIGNED_VALUE}else{if(value<=-TWO_PWR_63_DBL)return Long.MIN_VALUE;if(value+1>=TWO_PWR_63_DBL)return Long.MAX_VALUE}if(value<0)return Long.fromNumber(-value,unsigned).neg();return Long.fromBits(value%TWO_PWR_32_DBL|0,value/TWO_PWR_32_DBL|0,unsigned)}static fromBigInt(value,unsigned){return Long.fromString(value.toString(),unsigned)}static fromString(str23,unsigned,radix){if(str23.length===0)throw new BSONError("empty string");if(str23==="NaN"||str23==="Infinity"||str23==="+Infinity"||str23==="-Infinity")return Long.ZERO;if(typeof unsigned==="number"){radix=unsigned,unsigned=false}else{unsigned=!!unsigned}radix=radix||10;if(radix<2||36<radix)throw new BSONError("radix");let p2;if((p2=str23.indexOf("-"))>0)throw new BSONError("interior hyphen");else if(p2===0){return Long.fromString(str23.substring(1),unsigned,radix).neg()}const radixToPower=Long.fromNumber(Math.pow(radix,8));let result=Long.ZERO;for(let i3=0;i3<str23.length;i3+=8){const size=Math.min(8,str23.length-i3),value=parseInt(str23.substring(i3,i3+size),radix);if(size<8){const power=Long.fromNumber(Math.pow(radix,size));result=result.mul(power).add(Long.fromNumber(value))}else{result=result.mul(radixToPower);result=result.add(Long.fromNumber(value))}}result.unsigned=unsigned;return result}static fromBytes(bytes,unsigned,le){return le?Long.fromBytesLE(bytes,unsigned):Long.fromBytesBE(bytes,unsigned)}static fromBytesLE(bytes,unsigned){return new Long(bytes[0]|bytes[1]<<8|bytes[2]<<16|bytes[3]<<24,bytes[4]|bytes[5]<<8|bytes[6]<<16|bytes[7]<<24,unsigned)}static fromBytesBE(bytes,unsigned){return new Long(bytes[4]<<24|bytes[5]<<16|bytes[6]<<8|bytes[7],bytes[0]<<24|bytes[1]<<16|bytes[2]<<8|bytes[3],unsigned)}static isLong(value){return value!=null&&typeof value==="object"&&"__isLong__"in value&&value.__isLong__===true}static fromValue(val,unsigned){if(typeof val==="number")return Long.fromNumber(val,unsigned);if(typeof val==="string")return Long.fromString(val,unsigned);return Long.fromBits(val.low,val.high,typeof unsigned==="boolean"?unsigned:val.unsigned)}add(addend){if(!Long.isLong(addend))addend=Long.fromValue(addend);const a48=this.high>>>16;const a32=this.high&65535;const a16=this.low>>>16;const a00=this.low&65535;const b48=addend.high>>>16;const b32=addend.high&65535;const b16=addend.low>>>16;const b00=addend.low&65535;let c48=0,c32=0,c16=0,c00=0;c00+=a00+b00;c16+=c00>>>16;c00&=65535;c16+=a16+b16;c32+=c16>>>16;c16&=65535;c32+=a32+b32;c48+=c32>>>16;c32&=65535;c48+=a48+b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)}and(other){if(!Long.isLong(other))other=Long.fromValue(other);return Long.fromBits(this.low&other.low,this.high&other.high,this.unsigned)}compare(other){if(!Long.isLong(other))other=Long.fromValue(other);if(this.eq(other))return 0;const thisNeg=this.isNegative(),otherNeg=other.isNegative();if(thisNeg&&!otherNeg)return-1;if(!thisNeg&&otherNeg)return 1;if(!this.unsigned)return this.sub(other).isNegative()?-1:1;return other.high>>>0>this.high>>>0||other.high===this.high&&other.low>>>0>this.low>>>0?-1:1}comp(other){return this.compare(other)}divide(divisor){if(!Long.isLong(divisor))divisor=Long.fromValue(divisor);if(divisor.isZero())throw new BSONError("division by zero");if(wasm){if(!this.unsigned&&this.high===-2147483648&&divisor.low===-1&&divisor.high===-1){return this}const low=(this.unsigned?wasm.div_u:wasm.div_s)(this.low,this.high,divisor.low,divisor.high);return Long.fromBits(low,wasm.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?Long.UZERO:Long.ZERO;let approx,rem,res;if(!this.unsigned){if(this.eq(Long.MIN_VALUE)){if(divisor.eq(Long.ONE)||divisor.eq(Long.NEG_ONE))return Long.MIN_VALUE;else if(divisor.eq(Long.MIN_VALUE))return Long.ONE;else{const halfThis=this.shr(1);approx=halfThis.div(divisor).shl(1);if(approx.eq(Long.ZERO)){return divisor.isNegative()?Long.ONE:Long.NEG_ONE}else{rem=this.sub(divisor.mul(approx));res=approx.add(rem.div(divisor));return res}}}else if(divisor.eq(Long.MIN_VALUE))return this.unsigned?Long.UZERO:Long.ZERO;if(this.isNegative()){if(divisor.isNegative())return this.neg().div(divisor.neg());return this.neg().div(divisor).neg()}else if(divisor.isNegative())return this.div(divisor.neg()).neg();res=Long.ZERO}else{if(!divisor.unsigned)divisor=divisor.toUnsigned();if(divisor.gt(this))return Long.UZERO;if(divisor.gt(this.shru(1)))return Long.UONE;res=Long.UZERO}rem=this;while(rem.gte(divisor)){approx=Math.max(1,Math.floor(rem.toNumber()/divisor.toNumber()));const log2=Math.ceil(Math.log(approx)/Math.LN2);const delta=log2<=48?1:Math.pow(2,log2-48);let approxRes=Long.fromNumber(approx);let approxRem=approxRes.mul(divisor);while(approxRem.isNegative()||approxRem.gt(rem)){approx-=delta;approxRes=Long.fromNumber(approx,this.unsigned);approxRem=approxRes.mul(divisor)}if(approxRes.isZero())approxRes=Long.ONE;res=res.add(approxRes);rem=rem.sub(approxRem)}return res}div(divisor){return this.divide(divisor)}equals(other){if(!Long.isLong(other))other=Long.fromValue(other);if(this.unsigned!==other.unsigned&&this.high>>>31===1&&other.high>>>31===1)return false;return this.high===other.high&&this.low===other.low}eq(other){return this.equals(other)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative()){return this.eq(Long.MIN_VALUE)?64:this.neg().getNumBitsAbs()}const val=this.high!==0?this.high:this.low;let bit;for(bit=31;bit>0;bit--)if((val&1<<bit)!==0)break;return this.high!==0?bit+33:bit+1}greaterThan(other){return this.comp(other)>0}gt(other){return this.greaterThan(other)}greaterThanOrEqual(other){return this.comp(other)>=0}gte(other){return this.greaterThanOrEqual(other)}ge(other){return this.greaterThanOrEqual(other)}isEven(){return(this.low&1)===0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(this.low&1)===1}isPositive(){return this.unsigned||this.high>=0}isZero(){return this.high===0&&this.low===0}lessThan(other){return this.comp(other)<0}lt(other){return this.lessThan(other)}lessThanOrEqual(other){return this.comp(other)<=0}lte(other){return this.lessThanOrEqual(other)}modulo(divisor){if(!Long.isLong(divisor))divisor=Long.fromValue(divisor);if(wasm){const low=(this.unsigned?wasm.rem_u:wasm.rem_s)(this.low,this.high,divisor.low,divisor.high);return Long.fromBits(low,wasm.get_high(),this.unsigned)}return this.sub(this.div(divisor).mul(divisor))}mod(divisor){return this.modulo(divisor)}rem(divisor){return this.modulo(divisor)}multiply(multiplier){if(this.isZero())return Long.ZERO;if(!Long.isLong(multiplier))multiplier=Long.fromValue(multiplier);if(wasm){const low=wasm.mul(this.low,this.high,multiplier.low,multiplier.high);return Long.fromBits(low,wasm.get_high(),this.unsigned)}if(multiplier.isZero())return Long.ZERO;if(this.eq(Long.MIN_VALUE))return multiplier.isOdd()?Long.MIN_VALUE:Long.ZERO;if(multiplier.eq(Long.MIN_VALUE))return this.isOdd()?Long.MIN_VALUE:Long.ZERO;if(this.isNegative()){if(multiplier.isNegative())return this.neg().mul(multiplier.neg());else return this.neg().mul(multiplier).neg()}else if(multiplier.isNegative())return this.mul(multiplier.neg()).neg();if(this.lt(Long.TWO_PWR_24)&&multiplier.lt(Long.TWO_PWR_24))return Long.fromNumber(this.toNumber()*multiplier.toNumber(),this.unsigned);const a48=this.high>>>16;const a32=this.high&65535;const a16=this.low>>>16;const a00=this.low&65535;const b48=multiplier.high>>>16;const b32=multiplier.high&65535;const b16=multiplier.low>>>16;const b00=multiplier.low&65535;let c48=0,c32=0,c16=0,c00=0;c00+=a00*b00;c16+=c00>>>16;c00&=65535;c16+=a16*b00;c32+=c16>>>16;c16&=65535;c16+=a00*b16;c32+=c16>>>16;c16&=65535;c32+=a32*b00;c48+=c32>>>16;c32&=65535;c32+=a16*b16;c48+=c32>>>16;c32&=65535;c32+=a00*b32;c48+=c32>>>16;c32&=65535;c48+=a48*b00+a32*b16+a16*b32+a00*b48;c48&=65535;return Long.fromBits(c16<<16|c00,c48<<16|c32,this.unsigned)}mul(multiplier){return this.multiply(multiplier)}negate(){if(!this.unsigned&&this.eq(Long.MIN_VALUE))return Long.MIN_VALUE;return this.not().add(Long.ONE)}neg(){return this.negate()}not(){return Long.fromBits(~this.low,~this.high,this.unsigned)}notEquals(other){return!this.equals(other)}neq(other){return this.notEquals(other)}ne(other){return this.notEquals(other)}or(other){if(!Long.isLong(other))other=Long.fromValue(other);return Long.fromBits(this.low|other.low,this.high|other.high,this.unsigned)}shiftLeft(numBits){if(Long.isLong(numBits))numBits=numBits.toInt();if((numBits&=63)===0)return this;else if(numBits<32)return Long.fromBits(this.low<<numBits,this.high<<numBits|this.low>>>32-numBits,this.unsigned);else return Long.fromBits(0,this.low<<numBits-32,this.unsigned)}shl(numBits){return this.shiftLeft(numBits)}shiftRight(numBits){if(Long.isLong(numBits))numBits=numBits.toInt();if((numBits&=63)===0)return this;else if(numBits<32)return Long.fromBits(this.low>>>numBits|this.high<<32-numBits,this.high>>numBits,this.unsigned);else return Long.fromBits(this.high>>numBits-32,this.high>=0?0:-1,this.unsigned)}shr(numBits){return this.shiftRight(numBits)}shiftRightUnsigned(numBits){if(Long.isLong(numBits))numBits=numBits.toInt();numBits&=63;if(numBits===0)return this;else{const high=this.high;if(numBits<32){const low=this.low;return Long.fromBits(low>>>numBits|high<<32-numBits,high>>>numBits,this.unsigned)}else if(numBits===32)return Long.fromBits(high,0,this.unsigned);else return Long.fromBits(high>>>numBits-32,0,this.unsigned)}}shr_u(numBits){return this.shiftRightUnsigned(numBits)}shru(numBits){return this.shiftRightUnsigned(numBits)}subtract(subtrahend){if(!Long.isLong(subtrahend))subtrahend=Long.fromValue(subtrahend);return this.add(subtrahend.neg())}sub(subtrahend){return this.subtract(subtrahend)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){if(this.unsigned)return(this.high>>>0)*TWO_PWR_32_DBL+(this.low>>>0);return this.high*TWO_PWR_32_DBL+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(le){return le?this.toBytesLE():this.toBytesBE()}toBytesLE(){const hi=this.high,lo=this.low;return[lo&255,lo>>>8&255,lo>>>16&255,lo>>>24,hi&255,hi>>>8&255,hi>>>16&255,hi>>>24]}toBytesBE(){const hi=this.high,lo=this.low;return[hi>>>24,hi>>>16&255,hi>>>8&255,hi&255,lo>>>24,lo>>>16&255,lo>>>8&255,lo&255]}toSigned(){if(!this.unsigned)return this;return Long.fromBits(this.low,this.high,false)}toString(radix){radix=radix||10;if(radix<2||36<radix)throw new BSONError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(Long.MIN_VALUE)){const radixLong=Long.fromNumber(radix),div=this.div(radixLong),rem1=div.mul(radixLong).sub(this);return div.toString(radix)+rem1.toInt().toString(radix)}else return"-"+this.neg().toString(radix)}const radixToPower=Long.fromNumber(Math.pow(radix,6),this.unsigned);let rem=this;let result="";while(true){const remDiv=rem.div(radixToPower);const intval=rem.sub(remDiv.mul(radixToPower)).toInt()>>>0;let digits=intval.toString(radix);rem=remDiv;if(rem.isZero()){return digits+result}else{while(digits.length<6)digits="0"+digits;result=""+digits+result}}}toUnsigned(){if(this.unsigned)return this;return Long.fromBits(this.low,this.high,true)}xor(other){if(!Long.isLong(other))other=Long.fromValue(other);return Long.fromBits(this.low^other.low,this.high^other.high,this.unsigned)}eqz(){return this.isZero()}le(other){return this.lessThanOrEqual(other)}toExtendedJSON(options){if(options&&options.relaxed)return this.toNumber();return{$numberLong:this.toString()}}static fromExtendedJSON(doc,options){const{useBigInt64=false,relaxed=true}={...options};if(doc.$numberLong.length>MAX_INT64_STRING_LENGTH){throw new BSONError("$numberLong string is too long")}if(!DECIMAL_REG_EX.test(doc.$numberLong)){throw new BSONError(`$numberLong string "${doc.$numberLong}" is in an invalid format`)}if(useBigInt64){const bigIntResult=BigInt(doc.$numberLong);return BigInt.asIntN(64,bigIntResult)}const longResult=Long.fromString(doc.$numberLong);if(relaxed){return longResult.toNumber()}return longResult}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Long("${this.toString()}"${this.unsigned?", true":""})`}};Long.TWO_PWR_24=Long.fromInt(TWO_PWR_24_DBL);Long.MAX_UNSIGNED_VALUE=Long.fromBits(4294967295|0,4294967295|0,true);Long.ZERO=Long.fromInt(0);Long.UZERO=Long.fromInt(0,true);Long.ONE=Long.fromInt(1);Long.UONE=Long.fromInt(1,true);Long.NEG_ONE=Long.fromInt(-1);Long.MAX_VALUE=Long.fromBits(4294967295|0,2147483647|0,false);Long.MIN_VALUE=Long.fromBits(0,2147483648|0,false);var PARSE_STRING_REGEXP=/^(\\+|-)?(\\d+|(\\d*\\.\\d*))?(E|e)?([-+])?(\\d+)?$/;var PARSE_INF_REGEXP=/^(\\+|-)?(Infinity|inf)$/i;var PARSE_NAN_REGEXP=/^(\\+|-)?NaN$/i;var EXPONENT_MAX=6111;var EXPONENT_MIN=-6176;var EXPONENT_BIAS=6176;var MAX_DIGITS=34;var NAN_BUFFER=ByteUtils.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse());var INF_NEGATIVE_BUFFER=ByteUtils.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse());var INF_POSITIVE_BUFFER=ByteUtils.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse());var EXPONENT_REGEX=/^([-+])?(\\d+)?$/;var COMBINATION_MASK=31;var EXPONENT_MASK=16383;var COMBINATION_INFINITY=30;var COMBINATION_NAN=31;function isDigit(value){return!isNaN(parseInt(value,10))}function divideu128(value){const DIVISOR=Long.fromNumber(1e3*1e3*1e3);let _rem=Long.fromNumber(0);if(!value.parts[0]&&!value.parts[1]&&!value.parts[2]&&!value.parts[3]){return{quotient:value,rem:_rem}}for(let i3=0;i3<=3;i3++){_rem=_rem.shiftLeft(32);_rem=_rem.add(new Long(value.parts[i3],0));value.parts[i3]=_rem.div(DIVISOR).low;_rem=_rem.modulo(DIVISOR)}return{quotient:value,rem:_rem}}function multiply64x2(left,right){if(!left&&!right){return{high:Long.fromNumber(0),low:Long.fromNumber(0)}}const leftHigh=left.shiftRightUnsigned(32);const leftLow=new Long(left.getLowBits(),0);const rightHigh=right.shiftRightUnsigned(32);const rightLow=new Long(right.getLowBits(),0);let productHigh=leftHigh.multiply(rightHigh);let productMid=leftHigh.multiply(rightLow);const productMid2=leftLow.multiply(rightHigh);let productLow=leftLow.multiply(rightLow);productHigh=productHigh.add(productMid.shiftRightUnsigned(32));productMid=new Long(productMid.getLowBits(),0).add(productMid2).add(productLow.shiftRightUnsigned(32));productHigh=productHigh.add(productMid.shiftRightUnsigned(32));productLow=productMid.shiftLeft(32).add(new Long(productLow.getLowBits(),0));return{high:productHigh,low:productLow}}function lessThan(left,right){const uhleft=left.high>>>0;const uhright=right.high>>>0;if(uhleft<uhright){return true}else if(uhleft===uhright){const ulleft=left.low>>>0;const ulright=right.low>>>0;if(ulleft<ulright)return true}return false}function invalidErr(string,message){throw new BSONError(`"${string}" is not a valid Decimal128 string - ${message}`)}var Decimal128=class extends BSONValue{get _bsontype(){return"Decimal128"}constructor(bytes){super();if(typeof bytes==="string"){this.bytes=Decimal128.fromString(bytes).bytes}else if(isUint8Array(bytes)){if(bytes.byteLength!==16){throw new BSONError("Decimal128 must take a Buffer of 16 bytes")}this.bytes=bytes}else{throw new BSONError("Decimal128 must take a Buffer or string")}}static fromString(representation){let isNegative=false;let sawRadix=false;let foundNonZero=false;let significantDigits=0;let nDigitsRead=0;let nDigits=0;let radixPosition=0;let firstNonZero=0;const digits=[0];let nDigitsStored=0;let digitsInsert=0;let firstDigit=0;let lastDigit=0;let exponent=0;let i3=0;let significandHigh=new Long(0,0);let significandLow=new Long(0,0);let biasedExponent=0;let index=0;if(representation.length>=7e3){throw new BSONError(""+representation+" not a valid Decimal128 string")}const stringMatch=representation.match(PARSE_STRING_REGEXP);const infMatch=representation.match(PARSE_INF_REGEXP);const nanMatch=representation.match(PARSE_NAN_REGEXP);if(!stringMatch&&!infMatch&&!nanMatch||representation.length===0){throw new BSONError(""+representation+" not a valid Decimal128 string")}if(stringMatch){const unsignedNumber=stringMatch[2];const e=stringMatch[4];const expSign=stringMatch[5];const expNumber=stringMatch[6];if(e&&expNumber===void 0)invalidErr(representation,"missing exponent power");if(e&&unsignedNumber===void 0)invalidErr(representation,"missing exponent base");if(e===void 0&&(expSign||expNumber)){invalidErr(representation,"missing e before exponent")}}if(representation[index]==="+"||representation[index]==="-"){isNegative=representation[index++]==="-"}if(!isDigit(representation[index])&&representation[index]!=="."){if(representation[index]==="i"||representation[index]==="I"){return new Decimal128(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER)}else if(representation[index]==="N"){return new Decimal128(NAN_BUFFER)}}while(isDigit(representation[index])||representation[index]==="."){if(representation[index]==="."){if(sawRadix)invalidErr(representation,"contains multiple periods");sawRadix=true;index=index+1;continue}if(nDigitsStored<34){if(representation[index]!=="0"||foundNonZero){if(!foundNonZero){firstNonZero=nDigitsRead}foundNonZero=true;digits[digitsInsert++]=parseInt(representation[index],10);nDigitsStored=nDigitsStored+1}}if(foundNonZero)nDigits=nDigits+1;if(sawRadix)radixPosition=radixPosition+1;nDigitsRead=nDigitsRead+1;index=index+1}if(sawRadix&&!nDigitsRead)throw new BSONError(""+representation+" not a valid Decimal128 string");if(representation[index]==="e"||representation[index]==="E"){const match=representation.substr(++index).match(EXPONENT_REGEX);if(!match||!match[2])return new Decimal128(NAN_BUFFER);exponent=parseInt(match[0],10);index=index+match[0].length}if(representation[index])return new Decimal128(NAN_BUFFER);firstDigit=0;if(!nDigitsStored){firstDigit=0;lastDigit=0;digits[0]=0;nDigits=1;nDigitsStored=1;significantDigits=0}else{lastDigit=nDigitsStored-1;significantDigits=nDigits;if(significantDigits!==1){while(digits[firstNonZero+significantDigits-1]===0){significantDigits=significantDigits-1}}}if(exponent<=radixPosition&&radixPosition-exponent>1<<14){exponent=EXPONENT_MIN}else{exponent=exponent-radixPosition}while(exponent>EXPONENT_MAX){lastDigit=lastDigit+1;if(lastDigit-firstDigit>MAX_DIGITS){const digitsString=digits.join("");if(digitsString.match(/^0+$/)){exponent=EXPONENT_MAX;break}invalidErr(representation,"overflow")}exponent=exponent-1}while(exponent<EXPONENT_MIN||nDigitsStored<nDigits){if(lastDigit===0&&significantDigits<nDigitsStored){exponent=EXPONENT_MIN;significantDigits=0;break}if(nDigitsStored<nDigits){nDigits=nDigits-1}else{lastDigit=lastDigit-1}if(exponent<EXPONENT_MAX){exponent=exponent+1}else{const digitsString=digits.join("");if(digitsString.match(/^0+$/)){exponent=EXPONENT_MAX;break}invalidErr(representation,"overflow")}}if(lastDigit-firstDigit+1<significantDigits){let endOfString=nDigitsRead;if(sawRadix){firstNonZero=firstNonZero+1;endOfString=endOfString+1}if(isNegative){firstNonZero=firstNonZero+1;endOfString=endOfString+1}const roundDigit=parseInt(representation[firstNonZero+lastDigit+1],10);let roundBit=0;if(roundDigit>=5){roundBit=1;if(roundDigit===5){roundBit=digits[lastDigit]%2===1?1:0;for(i3=firstNonZero+lastDigit+2;i3<endOfString;i3++){if(parseInt(representation[i3],10)){roundBit=1;break}}}}if(roundBit){let dIdx=lastDigit;for(;dIdx>=0;dIdx--){if(++digits[dIdx]>9){digits[dIdx]=0;if(dIdx===0){if(exponent<EXPONENT_MAX){exponent=exponent+1;digits[dIdx]=1}else{return new Decimal128(isNegative?INF_NEGATIVE_BUFFER:INF_POSITIVE_BUFFER)}}}}}}significandHigh=Long.fromNumber(0);significandLow=Long.fromNumber(0);if(significantDigits===0){significandHigh=Long.fromNumber(0);significandLow=Long.fromNumber(0)}else if(lastDigit-firstDigit<17){let dIdx=firstDigit;significandLow=Long.fromNumber(digits[dIdx++]);significandHigh=new Long(0,0);for(;dIdx<=lastDigit;dIdx++){significandLow=significandLow.multiply(Long.fromNumber(10));significandLow=significandLow.add(Long.fromNumber(digits[dIdx]))}}else{let dIdx=firstDigit;significandHigh=Long.fromNumber(digits[dIdx++]);for(;dIdx<=lastDigit-17;dIdx++){significandHigh=significandHigh.multiply(Long.fromNumber(10));significandHigh=significandHigh.add(Long.fromNumber(digits[dIdx]))}significandLow=Long.fromNumber(digits[dIdx++]);for(;dIdx<=lastDigit;dIdx++){significandLow=significandLow.multiply(Long.fromNumber(10));significandLow=significandLow.add(Long.fromNumber(digits[dIdx]))}}const significand=multiply64x2(significandHigh,Long.fromString("100000000000000000"));significand.low=significand.low.add(significandLow);if(lessThan(significand.low,significandLow)){significand.high=significand.high.add(Long.fromNumber(1))}biasedExponent=exponent+EXPONENT_BIAS;const dec={low:Long.fromNumber(0),high:Long.fromNumber(0)};if(significand.high.shiftRightUnsigned(49).and(Long.fromNumber(1)).equals(Long.fromNumber(1))){dec.high=dec.high.or(Long.fromNumber(3).shiftLeft(61));dec.high=dec.high.or(Long.fromNumber(biasedExponent).and(Long.fromNumber(16383).shiftLeft(47)));dec.high=dec.high.or(significand.high.and(Long.fromNumber(0x7fffffffffff)))}else{dec.high=dec.high.or(Long.fromNumber(biasedExponent&16383).shiftLeft(49));dec.high=dec.high.or(significand.high.and(Long.fromNumber(562949953421311)))}dec.low=significand.low;if(isNegative){dec.high=dec.high.or(Long.fromString("9223372036854775808"))}const buffer2=ByteUtils.allocate(16);index=0;buffer2[index++]=dec.low.low&255;buffer2[index++]=dec.low.low>>8&255;buffer2[index++]=dec.low.low>>16&255;buffer2[index++]=dec.low.low>>24&255;buffer2[index++]=dec.low.high&255;buffer2[index++]=dec.low.high>>8&255;buffer2[index++]=dec.low.high>>16&255;buffer2[index++]=dec.low.high>>24&255;buffer2[index++]=dec.high.low&255;buffer2[index++]=dec.high.low>>8&255;buffer2[index++]=dec.high.low>>16&255;buffer2[index++]=dec.high.low>>24&255;buffer2[index++]=dec.high.high&255;buffer2[index++]=dec.high.high>>8&255;buffer2[index++]=dec.high.high>>16&255;buffer2[index++]=dec.high.high>>24&255;return new Decimal128(buffer2)}toString(){let biased_exponent;let significand_digits=0;const significand=new Array(36);for(let i3=0;i3<significand.length;i3++)significand[i3]=0;let index=0;let is_zero=false;let significand_msb;let significand128={parts:[0,0,0,0]};let j,k;const string=[];index=0;const buffer2=this.bytes;const low=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const midl=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const midh=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const high=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;index=0;const dec={low:new Long(low,midl),high:new Long(midh,high)};if(dec.high.lessThan(Long.ZERO)){string.push("-")}const combination=high>>26&COMBINATION_MASK;if(combination>>3===3){if(combination===COMBINATION_INFINITY){return string.join("")+"Infinity"}else if(combination===COMBINATION_NAN){return"NaN"}else{biased_exponent=high>>15&EXPONENT_MASK;significand_msb=8+(high>>14&1)}}else{significand_msb=high>>14&7;biased_exponent=high>>17&EXPONENT_MASK}const exponent=biased_exponent-EXPONENT_BIAS;significand128.parts[0]=(high&16383)+((significand_msb&15)<<14);significand128.parts[1]=midh;significand128.parts[2]=midl;significand128.parts[3]=low;if(significand128.parts[0]===0&&significand128.parts[1]===0&&significand128.parts[2]===0&&significand128.parts[3]===0){is_zero=true}else{for(k=3;k>=0;k--){let least_digits=0;const result=divideu128(significand128);significand128=result.quotient;least_digits=result.rem.low;if(!least_digits)continue;for(j=8;j>=0;j--){significand[k*9+j]=least_digits%10;least_digits=Math.floor(least_digits/10)}}}if(is_zero){significand_digits=1;significand[index]=0}else{significand_digits=36;while(!significand[index]){significand_digits=significand_digits-1;index=index+1}}const scientific_exponent=significand_digits-1+exponent;if(scientific_exponent>=34||scientific_exponent<=-7||exponent>0){if(significand_digits>34){string.push(`${0}`);if(exponent>0)string.push(`E+${exponent}`);else if(exponent<0)string.push(`E${exponent}`);return string.join("")}string.push(`${significand[index++]}`);significand_digits=significand_digits-1;if(significand_digits){string.push(".")}for(let i3=0;i3<significand_digits;i3++){string.push(`${significand[index++]}`)}string.push("E");if(scientific_exponent>0){string.push(`+${scientific_exponent}`)}else{string.push(`${scientific_exponent}`)}}else{if(exponent>=0){for(let i3=0;i3<significand_digits;i3++){string.push(`${significand[index++]}`)}}else{let radix_position=significand_digits+exponent;if(radix_position>0){for(let i3=0;i3<radix_position;i3++){string.push(`${significand[index++]}`)}}else{string.push("0")}string.push(".");while(radix_position++<0){string.push("0")}for(let i3=0;i3<significand_digits-Math.max(radix_position-1,0);i3++){string.push(`${significand[index++]}`)}}}return string.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(doc){return Decimal128.fromString(doc.$numberDecimal)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Decimal128("${this.toString()}")`}};var Double=class extends BSONValue{get _bsontype(){return"Double"}constructor(value){super();if(value instanceof Number){value=value.valueOf()}this.value=+value}valueOf(){return this.value}toJSON(){return this.value}toString(radix){return this.value.toString(radix)}toExtendedJSON(options){if(options&&(options.legacy||options.relaxed&&isFinite(this.value))){return this.value}if(Object.is(Math.sign(this.value),-0)){return{$numberDouble:"-0.0"}}return{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(doc,options){const doubleValue=parseFloat(doc.$numberDouble);return options&&options.relaxed?doubleValue:new Double(doubleValue)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){const eJSON=this.toExtendedJSON();return`new Double(${eJSON.$numberDouble})`}};var Int32=class extends BSONValue{get _bsontype(){return"Int32"}constructor(value){super();if(value instanceof Number){value=value.valueOf()}this.value=+value|0}valueOf(){return this.value}toString(radix){return this.value.toString(radix)}toJSON(){return this.value}toExtendedJSON(options){if(options&&(options.relaxed||options.legacy))return this.value;return{$numberInt:this.value.toString()}}static fromExtendedJSON(doc,options){return options&&options.relaxed?parseInt(doc.$numberInt,10):new Int32(doc.$numberInt)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Int32(${this.valueOf()})`}};var MaxKey=class extends BSONValue{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new MaxKey}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MaxKey()"}};var MinKey=class extends BSONValue{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new MinKey}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MinKey()"}};var checkForHexRegExp=new RegExp("^[0-9a-fA-F]{24}$");var PROCESS_UNIQUE=null;var kId=Symbol("id");var ObjectId2=class extends BSONValue{get _bsontype(){return"ObjectId"}constructor(inputId){super();let workingId;if(typeof inputId==="object"&&inputId&&"id"in inputId){if(typeof inputId.id!=="string"&&!ArrayBuffer.isView(inputId.id)){throw new BSONError("Argument passed in must have an id that is of type string or Buffer")}if("toHexString"in inputId&&typeof inputId.toHexString==="function"){workingId=ByteUtils.fromHex(inputId.toHexString())}else{workingId=inputId.id}}else{workingId=inputId}if(workingId==null||typeof workingId==="number"){this[kId]=ObjectId2.generate(typeof workingId==="number"?workingId:void 0)}else if(ArrayBuffer.isView(workingId)&&workingId.byteLength===12){this[kId]=ByteUtils.toLocalBufferType(workingId)}else if(typeof workingId==="string"){if(workingId.length===12){const bytes=ByteUtils.fromUTF8(workingId);if(bytes.byteLength===12){this[kId]=bytes}else{throw new BSONError("Argument passed in must be a string of 12 bytes")}}else if(workingId.length===24&&checkForHexRegExp.test(workingId)){this[kId]=ByteUtils.fromHex(workingId)}else{throw new BSONError("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer")}}else{throw new BSONError("Argument passed in does not match the accepted types")}if(ObjectId2.cacheHexString){this.__id=ByteUtils.toHex(this.id)}}get id(){return this[kId]}set id(value){this[kId]=value;if(ObjectId2.cacheHexString){this.__id=ByteUtils.toHex(value)}}toHexString(){if(ObjectId2.cacheHexString&&this.__id){return this.__id}const hexString=ByteUtils.toHex(this.id);if(ObjectId2.cacheHexString&&!this.__id){this.__id=hexString}return hexString}static getInc(){return ObjectId2.index=(ObjectId2.index+1)%16777215}static generate(time){if("number"!==typeof time){time=Math.floor(Date.now()/1e3)}const inc=ObjectId2.getInc();const buffer2=ByteUtils.allocate(12);BSONDataView.fromUint8Array(buffer2).setUint32(0,time,false);if(PROCESS_UNIQUE===null){PROCESS_UNIQUE=ByteUtils.randomBytes(5)}buffer2[4]=PROCESS_UNIQUE[0];buffer2[5]=PROCESS_UNIQUE[1];buffer2[6]=PROCESS_UNIQUE[2];buffer2[7]=PROCESS_UNIQUE[3];buffer2[8]=PROCESS_UNIQUE[4];buffer2[11]=inc&255;buffer2[10]=inc>>8&255;buffer2[9]=inc>>16&255;return buffer2}toString(encoding){if(encoding==="base64")return ByteUtils.toBase64(this.id);if(encoding==="hex")return this.toHexString();return this.toHexString()}toJSON(){return this.toHexString()}equals(otherId){if(otherId===void 0||otherId===null){return false}if(otherId instanceof ObjectId2){return this[kId][11]===otherId[kId][11]&&ByteUtils.equals(this[kId],otherId[kId])}if(typeof otherId==="string"&&ObjectId2.isValid(otherId)&&otherId.length===12&&isUint8Array(this.id)){return ByteUtils.equals(this.id,ByteUtils.fromISO88591(otherId))}if(typeof otherId==="string"&&ObjectId2.isValid(otherId)&&otherId.length===24){return otherId.toLowerCase()===this.toHexString()}if(typeof otherId==="string"&&ObjectId2.isValid(otherId)&&otherId.length===12){return ByteUtils.equals(ByteUtils.fromUTF8(otherId),this.id)}if(typeof otherId==="object"&&"toHexString"in otherId&&typeof otherId.toHexString==="function"){const otherIdString=otherId.toHexString();const thisIdString=this.toHexString().toLowerCase();return typeof otherIdString==="string"&&otherIdString.toLowerCase()===thisIdString}return false}getTimestamp(){const timestamp=new Date;const time=BSONDataView.fromUint8Array(this.id).getUint32(0,false);timestamp.setTime(Math.floor(time)*1e3);return timestamp}static createPk(){return new ObjectId2}static createFromTime(time){const buffer2=ByteUtils.fromNumberArray([0,0,0,0,0,0,0,0,0,0,0,0]);BSONDataView.fromUint8Array(buffer2).setUint32(0,time,false);return new ObjectId2(buffer2)}static createFromHexString(hexString){if(typeof hexString==="undefined"||hexString!=null&&hexString.length!==24){throw new BSONError("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters")}return new ObjectId2(ByteUtils.fromHex(hexString))}static isValid(id){if(id==null)return false;try{new ObjectId2(id);return true}catch{return false}}toExtendedJSON(){if(this.toHexString)return{$oid:this.toHexString()};return{$oid:this.toString("hex")}}static fromExtendedJSON(doc){return new ObjectId2(doc.$oid)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new ObjectId("${this.toHexString()}")`}};ObjectId2.index=Math.floor(Math.random()*16777215);function internalCalculateObjectSize(object,serializeFunctions,ignoreUndefined){let totalLength=4+1;if(Array.isArray(object)){for(let i3=0;i3<object.length;i3++){totalLength+=calculateElement(i3.toString(),object[i3],serializeFunctions,true,ignoreUndefined)}}else{if(typeof object?.toBSON==="function"){object=object.toBSON()}for(const key of Object.keys(object)){totalLength+=calculateElement(key,object[key],serializeFunctions,false,ignoreUndefined)}}return totalLength}function calculateElement(name2,value,serializeFunctions=false,isArray=false,ignoreUndefined=false){if(typeof value?.toBSON==="function"){value=value.toBSON()}switch(typeof value){case"string":return 1+ByteUtils.utf8ByteLength(name2)+1+4+ByteUtils.utf8ByteLength(value)+1;case"number":if(Math.floor(value)===value&&value>=JS_INT_MIN&&value<=JS_INT_MAX){if(value>=BSON_INT32_MIN&&value<=BSON_INT32_MAX){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(4+1)}else{return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(8+1)}}else{return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(8+1)}case"undefined":if(isArray||!ignoreUndefined)return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1;return 0;case"boolean":return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(1+1);case"object":if(value!=null&&typeof value._bsontype==="string"&&value[Symbol.for("@@mdb.bson.version")]!==BSON_MAJOR_VERSION){throw new BSONVersionError}else if(value==null||value._bsontype==="MinKey"||value._bsontype==="MaxKey"){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1}else if(value._bsontype==="ObjectId"){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(12+1)}else if(value instanceof Date||isDate(value)){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(8+1)}else if(ArrayBuffer.isView(value)||value instanceof ArrayBuffer||isAnyArrayBuffer(value)){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(1+4+1)+value.byteLength}else if(value._bsontype==="Long"||value._bsontype==="Double"||value._bsontype==="Timestamp"){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(8+1)}else if(value._bsontype==="Decimal128"){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(16+1)}else if(value._bsontype==="Code"){if(value.scope!=null&&Object.keys(value.scope).length>0){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1+4+4+ByteUtils.utf8ByteLength(value.code.toString())+1+internalCalculateObjectSize(value.scope,serializeFunctions,ignoreUndefined)}else{return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1+4+ByteUtils.utf8ByteLength(value.code.toString())+1}}else if(value._bsontype==="Binary"){const binary=value;if(binary.sub_type===Binary.SUBTYPE_BYTE_ARRAY){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(binary.position+1+4+1+4)}else{return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+(binary.position+1+4+1)}}else if(value._bsontype==="Symbol"){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+ByteUtils.utf8ByteLength(value.value)+4+1+1}else if(value._bsontype==="DBRef"){const ordered_values=Object.assign({$ref:value.collection,$id:value.oid},value.fields);if(value.db!=null){ordered_values["$db"]=value.db}return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1+internalCalculateObjectSize(ordered_values,serializeFunctions,ignoreUndefined)}else if(value instanceof RegExp||isRegExp(value)){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1+ByteUtils.utf8ByteLength(value.source)+1+(value.global?1:0)+(value.ignoreCase?1:0)+(value.multiline?1:0)+1}else if(value._bsontype==="BSONRegExp"){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1+ByteUtils.utf8ByteLength(value.pattern)+1+ByteUtils.utf8ByteLength(value.options)+1}else{return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+internalCalculateObjectSize(value,serializeFunctions,ignoreUndefined)+1}case"function":if(serializeFunctions){return(name2!=null?ByteUtils.utf8ByteLength(name2)+1:0)+1+4+ByteUtils.utf8ByteLength(value.toString())+1}}return 0}function alphabetize(str23){return str23.split("").sort().join("")}var BSONRegExp=class extends BSONValue{get _bsontype(){return"BSONRegExp"}constructor(pattern,options){super();this.pattern=pattern;this.options=alphabetize(options??"");if(this.pattern.indexOf("\\0")!==-1){throw new BSONError(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`)}if(this.options.indexOf("\\0")!==-1){throw new BSONError(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`)}for(let i3=0;i3<this.options.length;i3++){if(!(this.options[i3]==="i"||this.options[i3]==="m"||this.options[i3]==="x"||this.options[i3]==="l"||this.options[i3]==="s"||this.options[i3]==="u")){throw new BSONError(`The regular expression option [${this.options[i3]}] is not supported`)}}}static parseOptions(options){return options?options.split("").sort().join(""):""}toExtendedJSON(options){options=options||{};if(options.legacy){return{$regex:this.pattern,$options:this.options}}return{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(doc){if("$regex"in doc){if(typeof doc.$regex!=="string"){if(doc.$regex._bsontype==="BSONRegExp"){return doc}}else{return new BSONRegExp(doc.$regex,BSONRegExp.parseOptions(doc.$options))}}if("$regularExpression"in doc){return new BSONRegExp(doc.$regularExpression.pattern,BSONRegExp.parseOptions(doc.$regularExpression.options))}throw new BSONError(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(doc)}`)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new BSONRegExp(${JSON.stringify(this.pattern)}, ${JSON.stringify(this.options)})`}};var BSONSymbol=class extends BSONValue{get _bsontype(){return"BSONSymbol"}constructor(value){super();this.value=value}valueOf(){return this.value}toString(){return this.value}inspect(){return`new BSONSymbol("${this.value}")`}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(doc){return new BSONSymbol(doc.$symbol)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}};var LongWithoutOverridesClass=Long;var Timestamp=class extends LongWithoutOverridesClass{get _bsontype(){return"Timestamp"}constructor(low){if(low==null){super(0,0,true)}else if(typeof low==="bigint"){super(low,true)}else if(Long.isLong(low)){super(low.low,low.high,true)}else if(typeof low==="object"&&"t"in low&&"i"in low){if(typeof low.t!=="number"&&(typeof low.t!=="object"||low.t._bsontype!=="Int32")){throw new BSONError("Timestamp constructed from { t, i } must provide t as a number")}if(typeof low.i!=="number"&&(typeof low.i!=="object"||low.i._bsontype!=="Int32")){throw new BSONError("Timestamp constructed from { t, i } must provide i as a number")}if(low.t<0){throw new BSONError("Timestamp constructed from { t, i } must provide a positive t")}if(low.i<0){throw new BSONError("Timestamp constructed from { t, i } must provide a positive i")}if(low.t>4294967295){throw new BSONError("Timestamp constructed from { t, i } must provide t equal or less than uint32 max")}if(low.i>4294967295){throw new BSONError("Timestamp constructed from { t, i } must provide i equal or less than uint32 max")}super(low.i.valueOf(),low.t.valueOf(),true)}else{throw new BSONError("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}}toJSON(){return{$timestamp:this.toString()}}static fromInt(value){return new Timestamp(Long.fromInt(value,true))}static fromNumber(value){return new Timestamp(Long.fromNumber(value,true))}static fromBits(lowBits,highBits){return new Timestamp({i:lowBits,t:highBits})}static fromString(str23,optRadix){return new Timestamp(Long.fromString(str23,true,optRadix))}toExtendedJSON(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}static fromExtendedJSON(doc){const i3=Long.isLong(doc.$timestamp.i)?doc.$timestamp.i.getLowBitsUnsigned():doc.$timestamp.i;const t3=Long.isLong(doc.$timestamp.t)?doc.$timestamp.t.getLowBitsUnsigned():doc.$timestamp.t;return new Timestamp({t:t3,i:i3})}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Timestamp({ t: ${this.getHighBits()}, i: ${this.getLowBits()} })`}};Timestamp.MAX_VALUE=Long.MAX_UNSIGNED_VALUE;var FIRST_BIT=128;var FIRST_TWO_BITS=192;var FIRST_THREE_BITS=224;var FIRST_FOUR_BITS=240;var FIRST_FIVE_BITS=248;var TWO_BIT_CHAR=192;var THREE_BIT_CHAR=224;var FOUR_BIT_CHAR=240;var CONTINUING_CHAR=128;function validateUtf8(bytes,start,end){let continuation=0;for(let i3=start;i3<end;i3+=1){const byte=bytes[i3];if(continuation){if((byte&FIRST_TWO_BITS)!==CONTINUING_CHAR){return false}continuation-=1}else if(byte&FIRST_BIT){if((byte&FIRST_THREE_BITS)===TWO_BIT_CHAR){continuation=1}else if((byte&FIRST_FOUR_BITS)===THREE_BIT_CHAR){continuation=2}else if((byte&FIRST_FIVE_BITS)===FOUR_BIT_CHAR){continuation=3}else{return false}}}return!continuation}var JS_INT_MAX_LONG=Long.fromNumber(JS_INT_MAX);var JS_INT_MIN_LONG=Long.fromNumber(JS_INT_MIN);function internalDeserialize(buffer2,options,isArray){options=options==null?{}:options;const index=options&&options.index?options.index:0;const size=buffer2[index]|buffer2[index+1]<<8|buffer2[index+2]<<16|buffer2[index+3]<<24;if(size<5){throw new BSONError(`bson size must be >= 5, is ${size}`)}if(options.allowObjectSmallerThanBufferSize&&buffer2.length<size){throw new BSONError(`buffer length ${buffer2.length} must be >= bson size ${size}`)}if(!options.allowObjectSmallerThanBufferSize&&buffer2.length!==size){throw new BSONError(`buffer length ${buffer2.length} must === bson size ${size}`)}if(size+index>buffer2.byteLength){throw new BSONError(`(bson size ${size} + options.index ${index} must be <= buffer length ${buffer2.byteLength})`)}if(buffer2[index+size-1]!==0){throw new BSONError("One object, sized correctly, with a spot for an EOO, but the EOO isn\'t 0x00")}return deserializeObject(buffer2,index,options,isArray)}var allowedDBRefKeys=/^\\$ref$|^\\$id$|^\\$db$/;function deserializeObject(buffer2,index,options,isArray=false){const fieldsAsRaw=options["fieldsAsRaw"]==null?null:options["fieldsAsRaw"];const raw=options["raw"]==null?false:options["raw"];const bsonRegExp=typeof options["bsonRegExp"]==="boolean"?options["bsonRegExp"]:false;const promoteBuffers=options.promoteBuffers??false;const promoteLongs=options.promoteLongs??true;const promoteValues=options.promoteValues??true;const useBigInt64=options.useBigInt64??false;if(useBigInt64&&!promoteValues){throw new BSONError("Must either request bigint or Long for int64 deserialization")}if(useBigInt64&&!promoteLongs){throw new BSONError("Must either request bigint or Long for int64 deserialization")}const validation=options.validation==null?{utf8:true}:options.validation;let globalUTFValidation=true;let validationSetting;const utf8KeysSet=new Set;const utf8ValidatedKeys=validation.utf8;if(typeof utf8ValidatedKeys==="boolean"){validationSetting=utf8ValidatedKeys}else{globalUTFValidation=false;const utf8ValidationValues=Object.keys(utf8ValidatedKeys).map(function(key){return utf8ValidatedKeys[key]});if(utf8ValidationValues.length===0){throw new BSONError("UTF-8 validation setting cannot be empty")}if(typeof utf8ValidationValues[0]!=="boolean"){throw new BSONError("Invalid UTF-8 validation option, must specify boolean values")}validationSetting=utf8ValidationValues[0];if(!utf8ValidationValues.every(item=>item===validationSetting)){throw new BSONError("Invalid UTF-8 validation option - keys must be all true or all false")}}if(!globalUTFValidation){for(const key of Object.keys(utf8ValidatedKeys)){utf8KeysSet.add(key)}}const startIndex=index;if(buffer2.length<5)throw new BSONError("corrupt bson message < 5 bytes long");const size=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(size<5||size>buffer2.length)throw new BSONError("corrupt bson message");const object=isArray?[]:{};let arrayIndex=0;const done=false;let isPossibleDBRef=isArray?false:null;const dataview=new DataView(buffer2.buffer,buffer2.byteOffset,buffer2.byteLength);while(!done){const elementType=buffer2[index++];if(elementType===0)break;let i3=index;while(buffer2[i3]!==0&&i3<buffer2.length){i3++}if(i3>=buffer2.byteLength)throw new BSONError("Bad BSON Document: illegal CString");const name2=isArray?arrayIndex++:ByteUtils.toUTF8(buffer2.subarray(index,i3));let shouldValidateKey=true;if(globalUTFValidation||utf8KeysSet.has(name2)){shouldValidateKey=validationSetting}else{shouldValidateKey=!validationSetting}if(isPossibleDBRef!==false&&name2[0]==="$"){isPossibleDBRef=allowedDBRefKeys.test(name2)}let value;index=i3+1;if(elementType===BSON_DATA_STRING){const stringSize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(stringSize<=0||stringSize>buffer2.length-index||buffer2[index+stringSize-1]!==0){throw new BSONError("bad string length in bson")}value=getValidatedString(buffer2,index,index+stringSize-1,shouldValidateKey);index=index+stringSize}else if(elementType===BSON_DATA_OID){const oid=ByteUtils.allocate(12);oid.set(buffer2.subarray(index,index+12));value=new ObjectId2(oid);index=index+12}else if(elementType===BSON_DATA_INT&&promoteValues===false){value=new Int32(buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24)}else if(elementType===BSON_DATA_INT){value=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24}else if(elementType===BSON_DATA_NUMBER&&promoteValues===false){value=new Double(dataview.getFloat64(index,true));index=index+8}else if(elementType===BSON_DATA_NUMBER){value=dataview.getFloat64(index,true);index=index+8}else if(elementType===BSON_DATA_DATE){const lowBits=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const highBits=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;value=new Date(new Long(lowBits,highBits).toNumber())}else if(elementType===BSON_DATA_BOOLEAN){if(buffer2[index]!==0&&buffer2[index]!==1)throw new BSONError("illegal boolean type value");value=buffer2[index++]===1}else if(elementType===BSON_DATA_OBJECT){const _index=index;const objectSize=buffer2[index]|buffer2[index+1]<<8|buffer2[index+2]<<16|buffer2[index+3]<<24;if(objectSize<=0||objectSize>buffer2.length-index)throw new BSONError("bad embedded document length in bson");if(raw){value=buffer2.slice(index,index+objectSize)}else{let objectOptions=options;if(!globalUTFValidation){objectOptions={...options,validation:{utf8:shouldValidateKey}}}value=deserializeObject(buffer2,_index,objectOptions,false)}index=index+objectSize}else if(elementType===BSON_DATA_ARRAY){const _index=index;const objectSize=buffer2[index]|buffer2[index+1]<<8|buffer2[index+2]<<16|buffer2[index+3]<<24;let arrayOptions=options;const stopIndex=index+objectSize;if(fieldsAsRaw&&fieldsAsRaw[name2]){arrayOptions={...options,raw:true}}if(!globalUTFValidation){arrayOptions={...arrayOptions,validation:{utf8:shouldValidateKey}}}value=deserializeObject(buffer2,_index,arrayOptions,true);index=index+objectSize;if(buffer2[index-1]!==0)throw new BSONError("invalid array terminator byte");if(index!==stopIndex)throw new BSONError("corrupted array bson")}else if(elementType===BSON_DATA_UNDEFINED){value=void 0}else if(elementType===BSON_DATA_NULL){value=null}else if(elementType===BSON_DATA_LONG){const dataview2=BSONDataView.fromUint8Array(buffer2.subarray(index,index+8));const lowBits=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const highBits=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const long=new Long(lowBits,highBits);if(useBigInt64){value=dataview2.getBigInt64(0,true)}else if(promoteLongs&&promoteValues===true){value=long.lessThanOrEqual(JS_INT_MAX_LONG)&&long.greaterThanOrEqual(JS_INT_MIN_LONG)?long.toNumber():long}else{value=long}}else if(elementType===BSON_DATA_DECIMAL128){const bytes=ByteUtils.allocate(16);bytes.set(buffer2.subarray(index,index+16),0);index=index+16;value=new Decimal128(bytes)}else if(elementType===BSON_DATA_BINARY){let binarySize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;const totalBinarySize=binarySize;const subType=buffer2[index++];if(binarySize<0)throw new BSONError("Negative binary type element size found");if(binarySize>buffer2.byteLength)throw new BSONError("Binary type size larger than document size");if(buffer2["slice"]!=null){if(subType===Binary.SUBTYPE_BYTE_ARRAY){binarySize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(binarySize<0)throw new BSONError("Negative binary type element size found for subtype 0x02");if(binarySize>totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too long binary size");if(binarySize<totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too short binary size")}if(promoteBuffers&&promoteValues){value=ByteUtils.toLocalBufferType(buffer2.slice(index,index+binarySize))}else{value=new Binary(buffer2.slice(index,index+binarySize),subType);if(subType===BSON_BINARY_SUBTYPE_UUID_NEW){value=value.toUUID()}}}else{const _buffer=ByteUtils.allocate(binarySize);if(subType===Binary.SUBTYPE_BYTE_ARRAY){binarySize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(binarySize<0)throw new BSONError("Negative binary type element size found for subtype 0x02");if(binarySize>totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too long binary size");if(binarySize<totalBinarySize-4)throw new BSONError("Binary type with subtype 0x02 contains too short binary size")}for(i3=0;i3<binarySize;i3++){_buffer[i3]=buffer2[index+i3]}if(promoteBuffers&&promoteValues){value=_buffer}else if(subType===BSON_BINARY_SUBTYPE_UUID_NEW){value=new Binary(buffer2.slice(index,index+binarySize),subType).toUUID()}else{value=new Binary(buffer2.slice(index,index+binarySize),subType)}}index=index+binarySize}else if(elementType===BSON_DATA_REGEXP&&bsonRegExp===false){i3=index;while(buffer2[i3]!==0&&i3<buffer2.length){i3++}if(i3>=buffer2.length)throw new BSONError("Bad BSON Document: illegal CString");const source=ByteUtils.toUTF8(buffer2.subarray(index,i3));index=i3+1;i3=index;while(buffer2[i3]!==0&&i3<buffer2.length){i3++}if(i3>=buffer2.length)throw new BSONError("Bad BSON Document: illegal CString");const regExpOptions=ByteUtils.toUTF8(buffer2.subarray(index,i3));index=i3+1;const optionsArray=new Array(regExpOptions.length);for(i3=0;i3<regExpOptions.length;i3++){switch(regExpOptions[i3]){case"m":optionsArray[i3]="m";break;case"s":optionsArray[i3]="g";break;case"i":optionsArray[i3]="i";break}}value=new RegExp(source,optionsArray.join(""))}else if(elementType===BSON_DATA_REGEXP&&bsonRegExp===true){i3=index;while(buffer2[i3]!==0&&i3<buffer2.length){i3++}if(i3>=buffer2.length)throw new BSONError("Bad BSON Document: illegal CString");const source=ByteUtils.toUTF8(buffer2.subarray(index,i3));index=i3+1;i3=index;while(buffer2[i3]!==0&&i3<buffer2.length){i3++}if(i3>=buffer2.length)throw new BSONError("Bad BSON Document: illegal CString");const regExpOptions=ByteUtils.toUTF8(buffer2.subarray(index,i3));index=i3+1;value=new BSONRegExp(source,regExpOptions)}else if(elementType===BSON_DATA_SYMBOL){const stringSize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(stringSize<=0||stringSize>buffer2.length-index||buffer2[index+stringSize-1]!==0){throw new BSONError("bad string length in bson")}const symbol=getValidatedString(buffer2,index,index+stringSize-1,shouldValidateKey);value=promoteValues?symbol:new BSONSymbol(symbol);index=index+stringSize}else if(elementType===BSON_DATA_TIMESTAMP){const i22=buffer2[index++]+buffer2[index++]*(1<<8)+buffer2[index++]*(1<<16)+buffer2[index++]*(1<<24);const t3=buffer2[index++]+buffer2[index++]*(1<<8)+buffer2[index++]*(1<<16)+buffer2[index++]*(1<<24);value=new Timestamp({i:i22,t:t3})}else if(elementType===BSON_DATA_MIN_KEY){value=new MinKey}else if(elementType===BSON_DATA_MAX_KEY){value=new MaxKey}else if(elementType===BSON_DATA_CODE){const stringSize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(stringSize<=0||stringSize>buffer2.length-index||buffer2[index+stringSize-1]!==0){throw new BSONError("bad string length in bson")}const functionString=getValidatedString(buffer2,index,index+stringSize-1,shouldValidateKey);value=new Code(functionString);index=index+stringSize}else if(elementType===BSON_DATA_CODE_W_SCOPE){const totalSize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(totalSize<4+4+4+1){throw new BSONError("code_w_scope total size shorter minimum expected length")}const stringSize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(stringSize<=0||stringSize>buffer2.length-index||buffer2[index+stringSize-1]!==0){throw new BSONError("bad string length in bson")}const functionString=getValidatedString(buffer2,index,index+stringSize-1,shouldValidateKey);index=index+stringSize;const _index=index;const objectSize=buffer2[index]|buffer2[index+1]<<8|buffer2[index+2]<<16|buffer2[index+3]<<24;const scopeObject=deserializeObject(buffer2,_index,options,false);index=index+objectSize;if(totalSize<4+4+objectSize+stringSize){throw new BSONError("code_w_scope total size is too short, truncating scope")}if(totalSize>4+4+objectSize+stringSize){throw new BSONError("code_w_scope total size is too long, clips outer document")}value=new Code(functionString,scopeObject)}else if(elementType===BSON_DATA_DBPOINTER){const stringSize=buffer2[index++]|buffer2[index++]<<8|buffer2[index++]<<16|buffer2[index++]<<24;if(stringSize<=0||stringSize>buffer2.length-index||buffer2[index+stringSize-1]!==0)throw new BSONError("bad string length in bson");if(validation!=null&&validation.utf8){if(!validateUtf8(buffer2,index,index+stringSize-1)){throw new BSONError("Invalid UTF-8 string in BSON document")}}const namespace=ByteUtils.toUTF8(buffer2.subarray(index,index+stringSize-1));index=index+stringSize;const oidBuffer=ByteUtils.allocate(12);oidBuffer.set(buffer2.subarray(index,index+12),0);const oid=new ObjectId2(oidBuffer);index=index+12;value=new DBRef(namespace,oid)}else{throw new BSONError(`Detected unknown BSON type ${elementType.toString(16)} for fieldname "${name2}"`)}if(name2==="__proto__"){Object.defineProperty(object,name2,{value,writable:true,enumerable:true,configurable:true})}else{object[name2]=value}}if(size!==index-startIndex){if(isArray)throw new BSONError("corrupt array bson");throw new BSONError("corrupt object bson")}if(!isPossibleDBRef)return object;if(isDBRefLike(object)){const copy=Object.assign({},object);delete copy.$ref;delete copy.$id;delete copy.$db;return new DBRef(object.$ref,object.$id,object.$db,copy)}return object}function getValidatedString(buffer2,start,end,shouldValidateUtf8){const value=ByteUtils.toUTF8(buffer2.subarray(start,end));if(shouldValidateUtf8){for(let i3=0;i3<value.length;i3++){if(value.charCodeAt(i3)===65533){if(!validateUtf8(buffer2,start,end)){throw new BSONError("Invalid UTF-8 string in BSON document")}break}}}return value}var regexp=/\\x00/;var ignoreKeys=new Set(["$db","$ref","$id","$clusterTime"]);function serializeString(buffer2,key,value,index){buffer2[index++]=BSON_DATA_STRING;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes+1;buffer2[index-1]=0;const size=ByteUtils.encodeUTF8Into(buffer2,value,index+4);buffer2[index+3]=size+1>>24&255;buffer2[index+2]=size+1>>16&255;buffer2[index+1]=size+1>>8&255;buffer2[index]=size+1&255;index=index+4+size;buffer2[index++]=0;return index}var NUMBER_SPACE=new DataView(new ArrayBuffer(8),0,8);var FOUR_BYTE_VIEW_ON_NUMBER=new Uint8Array(NUMBER_SPACE.buffer,0,4);var EIGHT_BYTE_VIEW_ON_NUMBER=new Uint8Array(NUMBER_SPACE.buffer,0,8);function serializeNumber(buffer2,key,value,index){const isNegativeZero=Object.is(value,-0);const type=!isNegativeZero&&Number.isSafeInteger(value)&&value<=BSON_INT32_MAX&&value>=BSON_INT32_MIN?BSON_DATA_INT:BSON_DATA_NUMBER;if(type===BSON_DATA_INT){NUMBER_SPACE.setInt32(0,value,true)}else{NUMBER_SPACE.setFloat64(0,value,true)}const bytes=type===BSON_DATA_INT?FOUR_BYTE_VIEW_ON_NUMBER:EIGHT_BYTE_VIEW_ON_NUMBER;buffer2[index++]=type;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;buffer2.set(bytes,index);index+=bytes.byteLength;return index}function serializeBigInt(buffer2,key,value,index){buffer2[index++]=BSON_DATA_LONG;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index+=numberOfWrittenBytes;buffer2[index++]=0;NUMBER_SPACE.setBigInt64(0,value,true);buffer2.set(EIGHT_BYTE_VIEW_ON_NUMBER,index);index+=EIGHT_BYTE_VIEW_ON_NUMBER.byteLength;return index}function serializeNull(buffer2,key,_,index){buffer2[index++]=BSON_DATA_NULL;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;return index}function serializeBoolean(buffer2,key,value,index){buffer2[index++]=BSON_DATA_BOOLEAN;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;buffer2[index++]=value?1:0;return index}function serializeDate(buffer2,key,value,index){buffer2[index++]=BSON_DATA_DATE;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const dateInMilis=Long.fromNumber(value.getTime());const lowBits=dateInMilis.getLowBits();const highBits=dateInMilis.getHighBits();buffer2[index++]=lowBits&255;buffer2[index++]=lowBits>>8&255;buffer2[index++]=lowBits>>16&255;buffer2[index++]=lowBits>>24&255;buffer2[index++]=highBits&255;buffer2[index++]=highBits>>8&255;buffer2[index++]=highBits>>16&255;buffer2[index++]=highBits>>24&255;return index}function serializeRegExp(buffer2,key,value,index){buffer2[index++]=BSON_DATA_REGEXP;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;if(value.source&&value.source.match(regexp)!=null){throw new BSONError("value "+value.source+" must not contain null bytes")}index=index+ByteUtils.encodeUTF8Into(buffer2,value.source,index);buffer2[index++]=0;if(value.ignoreCase)buffer2[index++]=105;if(value.global)buffer2[index++]=115;if(value.multiline)buffer2[index++]=109;buffer2[index++]=0;return index}function serializeBSONRegExp(buffer2,key,value,index){buffer2[index++]=BSON_DATA_REGEXP;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;if(value.pattern.match(regexp)!=null){throw new BSONError("pattern "+value.pattern+" must not contain null bytes")}index=index+ByteUtils.encodeUTF8Into(buffer2,value.pattern,index);buffer2[index++]=0;const sortedOptions=value.options.split("").sort().join("");index=index+ByteUtils.encodeUTF8Into(buffer2,sortedOptions,index);buffer2[index++]=0;return index}function serializeMinMax(buffer2,key,value,index){if(value===null){buffer2[index++]=BSON_DATA_NULL}else if(value._bsontype==="MinKey"){buffer2[index++]=BSON_DATA_MIN_KEY}else{buffer2[index++]=BSON_DATA_MAX_KEY}const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;return index}function serializeObjectId(buffer2,key,value,index){buffer2[index++]=BSON_DATA_OID;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;if(isUint8Array(value.id)){buffer2.set(value.id.subarray(0,12),index)}else{throw new BSONError("object ["+JSON.stringify(value)+"] is not a valid ObjectId")}return index+12}function serializeBuffer(buffer2,key,value,index){buffer2[index++]=BSON_DATA_BINARY;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const size=value.length;buffer2[index++]=size&255;buffer2[index++]=size>>8&255;buffer2[index++]=size>>16&255;buffer2[index++]=size>>24&255;buffer2[index++]=BSON_BINARY_SUBTYPE_DEFAULT;buffer2.set(value,index);index=index+size;return index}function serializeObject(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path){if(path.has(value)){throw new BSONError("Cannot convert circular structure to BSON")}path.add(value);buffer2[index++]=Array.isArray(value)?BSON_DATA_ARRAY:BSON_DATA_OBJECT;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const endIndex=serializeInto(buffer2,value,checkKeys,index,depth+1,serializeFunctions,ignoreUndefined,path);path.delete(value);return endIndex}function serializeDecimal128(buffer2,key,value,index){buffer2[index++]=BSON_DATA_DECIMAL128;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;buffer2.set(value.bytes.subarray(0,16),index);return index+16}function serializeLong(buffer2,key,value,index){buffer2[index++]=value._bsontype==="Long"?BSON_DATA_LONG:BSON_DATA_TIMESTAMP;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const lowBits=value.getLowBits();const highBits=value.getHighBits();buffer2[index++]=lowBits&255;buffer2[index++]=lowBits>>8&255;buffer2[index++]=lowBits>>16&255;buffer2[index++]=lowBits>>24&255;buffer2[index++]=highBits&255;buffer2[index++]=highBits>>8&255;buffer2[index++]=highBits>>16&255;buffer2[index++]=highBits>>24&255;return index}function serializeInt32(buffer2,key,value,index){value=value.valueOf();buffer2[index++]=BSON_DATA_INT;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;buffer2[index++]=value&255;buffer2[index++]=value>>8&255;buffer2[index++]=value>>16&255;buffer2[index++]=value>>24&255;return index}function serializeDouble(buffer2,key,value,index){buffer2[index++]=BSON_DATA_NUMBER;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;NUMBER_SPACE.setFloat64(0,value.value,true);buffer2.set(EIGHT_BYTE_VIEW_ON_NUMBER,index);index=index+8;return index}function serializeFunction(buffer2,key,value,index){buffer2[index++]=BSON_DATA_CODE;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const functionString=value.toString();const size=ByteUtils.encodeUTF8Into(buffer2,functionString,index+4)+1;buffer2[index]=size&255;buffer2[index+1]=size>>8&255;buffer2[index+2]=size>>16&255;buffer2[index+3]=size>>24&255;index=index+4+size-1;buffer2[index++]=0;return index}function serializeCode(buffer2,key,value,index,checkKeys=false,depth=0,serializeFunctions=false,ignoreUndefined=true,path){if(value.scope&&typeof value.scope==="object"){buffer2[index++]=BSON_DATA_CODE_W_SCOPE;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;let startIndex=index;const functionString=value.code;index=index+4;const codeSize=ByteUtils.encodeUTF8Into(buffer2,functionString,index+4)+1;buffer2[index]=codeSize&255;buffer2[index+1]=codeSize>>8&255;buffer2[index+2]=codeSize>>16&255;buffer2[index+3]=codeSize>>24&255;buffer2[index+4+codeSize-1]=0;index=index+codeSize+4;const endIndex=serializeInto(buffer2,value.scope,checkKeys,index,depth+1,serializeFunctions,ignoreUndefined,path);index=endIndex-1;const totalSize=endIndex-startIndex;buffer2[startIndex++]=totalSize&255;buffer2[startIndex++]=totalSize>>8&255;buffer2[startIndex++]=totalSize>>16&255;buffer2[startIndex++]=totalSize>>24&255;buffer2[index++]=0}else{buffer2[index++]=BSON_DATA_CODE;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const functionString=value.code.toString();const size=ByteUtils.encodeUTF8Into(buffer2,functionString,index+4)+1;buffer2[index]=size&255;buffer2[index+1]=size>>8&255;buffer2[index+2]=size>>16&255;buffer2[index+3]=size>>24&255;index=index+4+size-1;buffer2[index++]=0}return index}function serializeBinary(buffer2,key,value,index){buffer2[index++]=BSON_DATA_BINARY;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const data=value.buffer;let size=value.position;if(value.sub_type===Binary.SUBTYPE_BYTE_ARRAY)size=size+4;buffer2[index++]=size&255;buffer2[index++]=size>>8&255;buffer2[index++]=size>>16&255;buffer2[index++]=size>>24&255;buffer2[index++]=value.sub_type;if(value.sub_type===Binary.SUBTYPE_BYTE_ARRAY){size=size-4;buffer2[index++]=size&255;buffer2[index++]=size>>8&255;buffer2[index++]=size>>16&255;buffer2[index++]=size>>24&255}buffer2.set(data,index);index=index+value.position;return index}function serializeSymbol(buffer2,key,value,index){buffer2[index++]=BSON_DATA_SYMBOL;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;const size=ByteUtils.encodeUTF8Into(buffer2,value.value,index+4)+1;buffer2[index]=size&255;buffer2[index+1]=size>>8&255;buffer2[index+2]=size>>16&255;buffer2[index+3]=size>>24&255;index=index+4+size-1;buffer2[index++]=0;return index}function serializeDBRef(buffer2,key,value,index,depth,serializeFunctions,path){buffer2[index++]=BSON_DATA_OBJECT;const numberOfWrittenBytes=ByteUtils.encodeUTF8Into(buffer2,key,index);index=index+numberOfWrittenBytes;buffer2[index++]=0;let startIndex=index;let output={$ref:value.collection||value.namespace,$id:value.oid};if(value.db!=null){output.$db=value.db}output=Object.assign(output,value.fields);const endIndex=serializeInto(buffer2,output,false,index,depth+1,serializeFunctions,true,path);const size=endIndex-startIndex;buffer2[startIndex++]=size&255;buffer2[startIndex++]=size>>8&255;buffer2[startIndex++]=size>>16&255;buffer2[startIndex++]=size>>24&255;return endIndex}function serializeInto(buffer2,object,checkKeys,startingIndex,depth,serializeFunctions,ignoreUndefined,path){if(path==null){if(object==null){buffer2[0]=5;buffer2[1]=0;buffer2[2]=0;buffer2[3]=0;buffer2[4]=0;return 5}if(Array.isArray(object)){throw new BSONError("serialize does not support an array as the root input")}if(typeof object!=="object"){throw new BSONError("serialize does not support non-object as the root input")}else if("_bsontype"in object&&typeof object._bsontype==="string"){throw new BSONError(`BSON types cannot be serialized as a document`)}else if(isDate(object)||isRegExp(object)||isUint8Array(object)||isAnyArrayBuffer(object)){throw new BSONError(`date, regexp, typedarray, and arraybuffer cannot be BSON documents`)}path=new Set}path.add(object);let index=startingIndex+4;if(Array.isArray(object)){for(let i3=0;i3<object.length;i3++){const key=`${i3}`;let value=object[i3];if(typeof value?.toBSON==="function"){value=value.toBSON()}if(typeof value==="string"){index=serializeString(buffer2,key,value,index)}else if(typeof value==="number"){index=serializeNumber(buffer2,key,value,index)}else if(typeof value==="bigint"){index=serializeBigInt(buffer2,key,value,index)}else if(typeof value==="boolean"){index=serializeBoolean(buffer2,key,value,index)}else if(value instanceof Date||isDate(value)){index=serializeDate(buffer2,key,value,index)}else if(value===void 0){index=serializeNull(buffer2,key,value,index)}else if(value===null){index=serializeNull(buffer2,key,value,index)}else if(isUint8Array(value)){index=serializeBuffer(buffer2,key,value,index)}else if(value instanceof RegExp||isRegExp(value)){index=serializeRegExp(buffer2,key,value,index)}else if(typeof value==="object"&&value._bsontype==null){index=serializeObject(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path)}else if(typeof value==="object"&&value[Symbol.for("@@mdb.bson.version")]!==BSON_MAJOR_VERSION){throw new BSONVersionError}else if(value._bsontype==="ObjectId"){index=serializeObjectId(buffer2,key,value,index)}else if(value._bsontype==="Decimal128"){index=serializeDecimal128(buffer2,key,value,index)}else if(value._bsontype==="Long"||value._bsontype==="Timestamp"){index=serializeLong(buffer2,key,value,index)}else if(value._bsontype==="Double"){index=serializeDouble(buffer2,key,value,index)}else if(typeof value==="function"&&serializeFunctions){index=serializeFunction(buffer2,key,value,index)}else if(value._bsontype==="Code"){index=serializeCode(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path)}else if(value._bsontype==="Binary"){index=serializeBinary(buffer2,key,value,index)}else if(value._bsontype==="BSONSymbol"){index=serializeSymbol(buffer2,key,value,index)}else if(value._bsontype==="DBRef"){index=serializeDBRef(buffer2,key,value,index,depth,serializeFunctions,path)}else if(value._bsontype==="BSONRegExp"){index=serializeBSONRegExp(buffer2,key,value,index)}else if(value._bsontype==="Int32"){index=serializeInt32(buffer2,key,value,index)}else if(value._bsontype==="MinKey"||value._bsontype==="MaxKey"){index=serializeMinMax(buffer2,key,value,index)}else if(typeof value._bsontype!=="undefined"){throw new BSONError(`Unrecognized or invalid _bsontype: ${String(value._bsontype)}`)}}}else if(object instanceof Map||isMap(object)){const iterator=object.entries();let done=false;while(!done){const entry=iterator.next();done=!!entry.done;if(done)continue;const key=entry.value[0];let value=entry.value[1];if(typeof value?.toBSON==="function"){value=value.toBSON()}const type=typeof value;if(typeof key==="string"&&!ignoreKeys.has(key)){if(key.match(regexp)!=null){throw new BSONError("key "+key+" must not contain null bytes")}if(checkKeys){if("$"===key[0]){throw new BSONError("key "+key+" must not start with \'$\'")}else if(~key.indexOf(".")){throw new BSONError("key "+key+" must not contain \'.\'")}}}if(type==="string"){index=serializeString(buffer2,key,value,index)}else if(type==="number"){index=serializeNumber(buffer2,key,value,index)}else if(type==="bigint"){index=serializeBigInt(buffer2,key,value,index)}else if(type==="boolean"){index=serializeBoolean(buffer2,key,value,index)}else if(value instanceof Date||isDate(value)){index=serializeDate(buffer2,key,value,index)}else if(value===null||value===void 0&&ignoreUndefined===false){index=serializeNull(buffer2,key,value,index)}else if(isUint8Array(value)){index=serializeBuffer(buffer2,key,value,index)}else if(value instanceof RegExp||isRegExp(value)){index=serializeRegExp(buffer2,key,value,index)}else if(type==="object"&&value._bsontype==null){index=serializeObject(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path)}else if(typeof value==="object"&&value[Symbol.for("@@mdb.bson.version")]!==BSON_MAJOR_VERSION){throw new BSONVersionError}else if(value._bsontype==="ObjectId"){index=serializeObjectId(buffer2,key,value,index)}else if(type==="object"&&value._bsontype==="Decimal128"){index=serializeDecimal128(buffer2,key,value,index)}else if(value._bsontype==="Long"||value._bsontype==="Timestamp"){index=serializeLong(buffer2,key,value,index)}else if(value._bsontype==="Double"){index=serializeDouble(buffer2,key,value,index)}else if(value._bsontype==="Code"){index=serializeCode(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path)}else if(typeof value==="function"&&serializeFunctions){index=serializeFunction(buffer2,key,value,index)}else if(value._bsontype==="Binary"){index=serializeBinary(buffer2,key,value,index)}else if(value._bsontype==="BSONSymbol"){index=serializeSymbol(buffer2,key,value,index)}else if(value._bsontype==="DBRef"){index=serializeDBRef(buffer2,key,value,index,depth,serializeFunctions,path)}else if(value._bsontype==="BSONRegExp"){index=serializeBSONRegExp(buffer2,key,value,index)}else if(value._bsontype==="Int32"){index=serializeInt32(buffer2,key,value,index)}else if(value._bsontype==="MinKey"||value._bsontype==="MaxKey"){index=serializeMinMax(buffer2,key,value,index)}else if(typeof value._bsontype!=="undefined"){throw new BSONError(`Unrecognized or invalid _bsontype: ${String(value._bsontype)}`)}}}else{if(typeof object?.toBSON==="function"){object=object.toBSON();if(object!=null&&typeof object!=="object"){throw new BSONError("toBSON function did not return an object")}}for(const key of Object.keys(object)){let value=object[key];if(typeof value?.toBSON==="function"){value=value.toBSON()}const type=typeof value;if(typeof key==="string"&&!ignoreKeys.has(key)){if(key.match(regexp)!=null){throw new BSONError("key "+key+" must not contain null bytes")}if(checkKeys){if("$"===key[0]){throw new BSONError("key "+key+" must not start with \'$\'")}else if(~key.indexOf(".")){throw new BSONError("key "+key+" must not contain \'.\'")}}}if(type==="string"){index=serializeString(buffer2,key,value,index)}else if(type==="number"){index=serializeNumber(buffer2,key,value,index)}else if(type==="bigint"){index=serializeBigInt(buffer2,key,value,index)}else if(type==="boolean"){index=serializeBoolean(buffer2,key,value,index)}else if(value instanceof Date||isDate(value)){index=serializeDate(buffer2,key,value,index)}else if(value===void 0){if(ignoreUndefined===false)index=serializeNull(buffer2,key,value,index)}else if(value===null){index=serializeNull(buffer2,key,value,index)}else if(isUint8Array(value)){index=serializeBuffer(buffer2,key,value,index)}else if(value instanceof RegExp||isRegExp(value)){index=serializeRegExp(buffer2,key,value,index)}else if(type==="object"&&value._bsontype==null){index=serializeObject(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path)}else if(typeof value==="object"&&value[Symbol.for("@@mdb.bson.version")]!==BSON_MAJOR_VERSION){throw new BSONVersionError}else if(value._bsontype==="ObjectId"){index=serializeObjectId(buffer2,key,value,index)}else if(type==="object"&&value._bsontype==="Decimal128"){index=serializeDecimal128(buffer2,key,value,index)}else if(value._bsontype==="Long"||value._bsontype==="Timestamp"){index=serializeLong(buffer2,key,value,index)}else if(value._bsontype==="Double"){index=serializeDouble(buffer2,key,value,index)}else if(value._bsontype==="Code"){index=serializeCode(buffer2,key,value,index,checkKeys,depth,serializeFunctions,ignoreUndefined,path)}else if(typeof value==="function"&&serializeFunctions){index=serializeFunction(buffer2,key,value,index)}else if(value._bsontype==="Binary"){index=serializeBinary(buffer2,key,value,index)}else if(value._bsontype==="BSONSymbol"){index=serializeSymbol(buffer2,key,value,index)}else if(value._bsontype==="DBRef"){index=serializeDBRef(buffer2,key,value,index,depth,serializeFunctions,path)}else if(value._bsontype==="BSONRegExp"){index=serializeBSONRegExp(buffer2,key,value,index)}else if(value._bsontype==="Int32"){index=serializeInt32(buffer2,key,value,index)}else if(value._bsontype==="MinKey"||value._bsontype==="MaxKey"){index=serializeMinMax(buffer2,key,value,index)}else if(typeof value._bsontype!=="undefined"){throw new BSONError(`Unrecognized or invalid _bsontype: ${String(value._bsontype)}`)}}}path.delete(object);buffer2[index++]=0;const size=index-startingIndex;buffer2[startingIndex++]=size&255;buffer2[startingIndex++]=size>>8&255;buffer2[startingIndex++]=size>>16&255;buffer2[startingIndex++]=size>>24&255;return index}function isBSONType(value){return value!=null&&typeof value==="object"&&"_bsontype"in value&&typeof value._bsontype==="string"}var keysToCodecs={$oid:ObjectId2,$binary:Binary,$uuid:Binary,$symbol:BSONSymbol,$numberInt:Int32,$numberDecimal:Decimal128,$numberDouble:Double,$numberLong:Long,$minKey:MinKey,$maxKey:MaxKey,$regex:BSONRegExp,$regularExpression:BSONRegExp,$timestamp:Timestamp};function deserializeValue(value,options={}){if(typeof value==="number"){const in32BitRange=value<=BSON_INT32_MAX&&value>=BSON_INT32_MIN;const in64BitRange=value<=BSON_INT64_MAX&&value>=BSON_INT64_MIN;if(options.relaxed||options.legacy){return value}if(Number.isInteger(value)&&!Object.is(value,-0)){if(in32BitRange){return new Int32(value)}if(in64BitRange){if(options.useBigInt64){return BigInt(value)}return Long.fromNumber(value)}}return new Double(value)}if(value==null||typeof value!=="object")return value;if(value.$undefined)return null;const keys3=Object.keys(value).filter(k=>k.startsWith("$")&&value[k]!=null);for(let i3=0;i3<keys3.length;i3++){const c=keysToCodecs[keys3[i3]];if(c)return c.fromExtendedJSON(value,options)}if(value.$date!=null){const d2=value.$date;const date=new Date;if(options.legacy){if(typeof d2==="number")date.setTime(d2);else if(typeof d2==="string")date.setTime(Date.parse(d2));else if(typeof d2==="bigint")date.setTime(Number(d2));else throw new BSONRuntimeError(`Unrecognized type for EJSON date: ${typeof d2}`)}else{if(typeof d2==="string")date.setTime(Date.parse(d2));else if(Long.isLong(d2))date.setTime(d2.toNumber());else if(typeof d2==="number"&&options.relaxed)date.setTime(d2);else if(typeof d2==="bigint")date.setTime(Number(d2));else throw new BSONRuntimeError(`Unrecognized type for EJSON date: ${typeof d2}`)}return date}if(value.$code!=null){const copy=Object.assign({},value);if(value.$scope){copy.$scope=deserializeValue(value.$scope)}return Code.fromExtendedJSON(value)}if(isDBRefLike(value)||value.$dbPointer){const v2=value.$ref?value:value.$dbPointer;if(v2 instanceof DBRef)return v2;const dollarKeys=Object.keys(v2).filter(k=>k.startsWith("$"));let valid=true;dollarKeys.forEach(k=>{if(["$ref","$id","$db"].indexOf(k)===-1)valid=false});if(valid)return DBRef.fromExtendedJSON(v2)}return value}function serializeArray(array,options){return array.map((v2,index)=>{options.seenObjects.push({propertyName:`index ${index}`,obj:null});try{return serializeValue(v2,options)}finally{options.seenObjects.pop()}})}function getISOString(date){const isoStr=date.toISOString();return date.getUTCMilliseconds()!==0?isoStr:isoStr.slice(0,-5)+"Z"}function serializeValue(value,options){if(value instanceof Map||isMap(value)){const obj=Object.create(null);for(const[k,v2]of value){if(typeof k!=="string"){throw new BSONError("Can only serialize maps with string keys")}obj[k]=v2}return serializeValue(obj,options)}if((typeof value==="object"||typeof value==="function")&&value!==null){const index=options.seenObjects.findIndex(entry=>entry.obj===value);if(index!==-1){const props=options.seenObjects.map(entry=>entry.propertyName);const leadingPart=props.slice(0,index).map(prop=>`${prop} -> `).join("");const alreadySeen=props[index];const circularPart=" -> "+props.slice(index+1,props.length-1).map(prop=>`${prop} -> `).join("");const current=props[props.length-1];const leadingSpace=" ".repeat(leadingPart.length+alreadySeen.length/2);const dashes="-".repeat(circularPart.length+(alreadySeen.length+current.length)/2-1);throw new BSONError(`Converting circular structure to EJSON:\n    ${leadingPart}${alreadySeen}${circularPart}${current}\n    ${leadingSpace}\\\\${dashes}/`)}options.seenObjects[options.seenObjects.length-1].obj=value}if(Array.isArray(value))return serializeArray(value,options);if(value===void 0)return null;if(value instanceof Date||isDate(value)){const dateNum=value.getTime(),inRange=dateNum>-1&&dateNum<2534023188e5;if(options.legacy){return options.relaxed&&inRange?{$date:value.getTime()}:{$date:getISOString(value)}}return options.relaxed&&inRange?{$date:getISOString(value)}:{$date:{$numberLong:value.getTime().toString()}}}if(typeof value==="number"&&(!options.relaxed||!isFinite(value))){if(Number.isInteger(value)&&!Object.is(value,-0)){if(value>=BSON_INT32_MIN&&value<=BSON_INT32_MAX){return{$numberInt:value.toString()}}if(value>=BSON_INT64_MIN&&value<=BSON_INT64_MAX){return{$numberLong:value.toString()}}}return{$numberDouble:Object.is(value,-0)?"-0.0":value.toString()}}if(typeof value==="bigint"){if(!options.relaxed){return{$numberLong:BigInt.asIntN(64,value).toString()}}return Number(BigInt.asIntN(64,value))}if(value instanceof RegExp||isRegExp(value)){let flags=value.flags;if(flags===void 0){const match=value.toString().match(/[gimuy]*$/);if(match){flags=match[0]}}const rx=new BSONRegExp(value.source,flags);return rx.toExtendedJSON(options)}if(value!=null&&typeof value==="object")return serializeDocument(value,options);return value}var BSON_TYPE_MAPPINGS={Binary:o=>new Binary(o.value(),o.sub_type),Code:o=>new Code(o.code,o.scope),DBRef:o=>new DBRef(o.collection||o.namespace,o.oid,o.db,o.fields),Decimal128:o=>new Decimal128(o.bytes),Double:o=>new Double(o.value),Int32:o=>new Int32(o.value),Long:o=>Long.fromBits(o.low!=null?o.low:o.low_,o.low!=null?o.high:o.high_,o.low!=null?o.unsigned:o.unsigned_),MaxKey:()=>new MaxKey,MinKey:()=>new MinKey,ObjectId:o=>new ObjectId2(o),BSONRegExp:o=>new BSONRegExp(o.pattern,o.options),BSONSymbol:o=>new BSONSymbol(o.value),Timestamp:o=>Timestamp.fromBits(o.low,o.high)};function serializeDocument(doc,options){if(doc==null||typeof doc!=="object")throw new BSONError("not an object instance");const bsontype=doc._bsontype;if(typeof bsontype==="undefined"){const _doc={};for(const name2 of Object.keys(doc)){options.seenObjects.push({propertyName:name2,obj:null});try{const value=serializeValue(doc[name2],options);if(name2==="__proto__"){Object.defineProperty(_doc,name2,{value,writable:true,enumerable:true,configurable:true})}else{_doc[name2]=value}}finally{options.seenObjects.pop()}}return _doc}else if(doc!=null&&typeof doc==="object"&&typeof doc._bsontype==="string"&&doc[Symbol.for("@@mdb.bson.version")]!==BSON_MAJOR_VERSION){throw new BSONVersionError}else if(isBSONType(doc)){let outDoc=doc;if(typeof outDoc.toExtendedJSON!=="function"){const mapper=BSON_TYPE_MAPPINGS[doc._bsontype];if(!mapper){throw new BSONError("Unrecognized or invalid _bsontype: "+doc._bsontype)}outDoc=mapper(outDoc)}if(bsontype==="Code"&&outDoc.scope){outDoc=new Code(outDoc.code,serializeValue(outDoc.scope,options))}else if(bsontype==="DBRef"&&outDoc.oid){outDoc=new DBRef(serializeValue(outDoc.collection,options),serializeValue(outDoc.oid,options),serializeValue(outDoc.db,options),serializeValue(outDoc.fields,options))}return outDoc.toExtendedJSON(options)}else{throw new BSONError("_bsontype must be a string, but was: "+typeof bsontype)}}function parse(text,options){const ejsonOptions={useBigInt64:options?.useBigInt64??false,relaxed:options?.relaxed??true,legacy:options?.legacy??false};return JSON.parse(text,(key,value)=>{if(key.indexOf("\\0")!==-1){throw new BSONError(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(key)}`)}return deserializeValue(value,ejsonOptions)})}function stringify(value,replacer,space,options){if(space!=null&&typeof space==="object"){options=space;space=0}if(replacer!=null&&typeof replacer==="object"&&!Array.isArray(replacer)){options=replacer;replacer=void 0;space=0}const serializeOptions=Object.assign({relaxed:true,legacy:false},options,{seenObjects:[{propertyName:"(root)",obj:null}]});const doc=serializeValue(value,serializeOptions);return JSON.stringify(doc,replacer,space)}function EJSONserialize(value,options){options=options||{};return JSON.parse(stringify(value,options))}function EJSONdeserialize(ejson,options){options=options||{};return parse(JSON.stringify(ejson),options)}var EJSON=Object.create(null);EJSON.parse=parse;EJSON.stringify=stringify;EJSON.serialize=EJSONserialize;EJSON.deserialize=EJSONdeserialize;Object.freeze(EJSON);var MAXSIZE=1024*1024*17;var buffer=ByteUtils.allocate(MAXSIZE);function setInternalBufferSize(size){if(buffer.length<size){buffer=ByteUtils.allocate(size)}}function serialize(object,options={}){const checkKeys=typeof options.checkKeys==="boolean"?options.checkKeys:false;const serializeFunctions=typeof options.serializeFunctions==="boolean"?options.serializeFunctions:false;const ignoreUndefined=typeof options.ignoreUndefined==="boolean"?options.ignoreUndefined:true;const minInternalBufferSize=typeof options.minInternalBufferSize==="number"?options.minInternalBufferSize:MAXSIZE;if(buffer.length<minInternalBufferSize){buffer=ByteUtils.allocate(minInternalBufferSize)}const serializationIndex=serializeInto(buffer,object,checkKeys,0,0,serializeFunctions,ignoreUndefined,null);const finishedBuffer=ByteUtils.allocate(serializationIndex);finishedBuffer.set(buffer.subarray(0,serializationIndex),0);return finishedBuffer}function serializeWithBufferAndIndex(object,finalBuffer,options={}){const checkKeys=typeof options.checkKeys==="boolean"?options.checkKeys:false;const serializeFunctions=typeof options.serializeFunctions==="boolean"?options.serializeFunctions:false;const ignoreUndefined=typeof options.ignoreUndefined==="boolean"?options.ignoreUndefined:true;const startIndex=typeof options.index==="number"?options.index:0;const serializationIndex=serializeInto(buffer,object,checkKeys,0,0,serializeFunctions,ignoreUndefined,null);finalBuffer.set(buffer.subarray(0,serializationIndex),startIndex);return startIndex+serializationIndex-1}function deserialize(buffer2,options={}){return internalDeserialize(ByteUtils.toLocalBufferType(buffer2),options)}function calculateObjectSize(object,options={}){options=options||{};const serializeFunctions=typeof options.serializeFunctions==="boolean"?options.serializeFunctions:false;const ignoreUndefined=typeof options.ignoreUndefined==="boolean"?options.ignoreUndefined:true;return internalCalculateObjectSize(object,serializeFunctions,ignoreUndefined)}function deserializeStream(data,startIndex,numberOfDocuments,documents,docStartIndex,options){const internalOptions=Object.assign({allowObjectSmallerThanBufferSize:true,index:0},options);const bufferData=ByteUtils.toLocalBufferType(data);let index=startIndex;for(let i3=0;i3<numberOfDocuments;i3++){const size=bufferData[index]|bufferData[index+1]<<8|bufferData[index+2]<<16|bufferData[index+3]<<24;internalOptions.index=index;documents[docStartIndex+i3]=internalDeserialize(bufferData,internalOptions);index=index+size}return index}var bson=Object.freeze({__proto__:null,Code,BSONSymbol,DBRef,Binary,ObjectId:ObjectId2,UUID,Long,Timestamp,Double,Int32,MinKey,MaxKey,BSONRegExp,Decimal128,setInternalBufferSize,serialize,serializeWithBufferAndIndex,deserialize,calculateObjectSize,deserializeStream,BSONValue,BSONError,BSONVersionError,BSONRuntimeError,BSONType,EJSON});exports.BSON=bson;exports.BSONError=BSONError;exports.BSONRegExp=BSONRegExp;exports.BSONRuntimeError=BSONRuntimeError;exports.BSONSymbol=BSONSymbol;exports.BSONType=BSONType;exports.BSONValue=BSONValue;exports.BSONVersionError=BSONVersionError;exports.Binary=Binary;exports.Code=Code;exports.DBRef=DBRef;exports.Decimal128=Decimal128;exports.Double=Double;exports.EJSON=EJSON;exports.Int32=Int32;exports.Long=Long;exports.MaxKey=MaxKey;exports.MinKey=MinKey;exports.ObjectId=ObjectId2;exports.Timestamp=Timestamp;exports.UUID=UUID;exports.calculateObjectSize=calculateObjectSize;exports.deserialize=deserialize;exports.deserializeStream=deserializeStream;exports.serialize=serialize;exports.serializeWithBufferAndIndex=serializeWithBufferAndIndex;exports.setInternalBufferSize=setInternalBufferSize}});var DataStructures_exports={};__export(DataStructures_exports,{AuthorizationStruct:()=>AuthorizationStruct,ChatroomStruct:()=>ChatroomStruct,CoherenceMap:()=>CoherenceMap,CoherenceStruct:()=>CoherenceStruct,CommentStruct:()=>CommentStruct,Data:()=>Data,DataStruct:()=>DataStruct,DateStruct:()=>DateStruct,ECGStruct:()=>ECGStruct,EDAStruct:()=>EDAStruct,EEGCoordinates:()=>EEGCoordinates,EEGStruct:()=>EEGStruct,EMGStruct:()=>EMGStruct,EventStruct:()=>EventStruct,EyeTrackerStruct:()=>EyeTrackerStruct,FNIRSStruct:()=>FNIRSStruct,FrequencyBandsStruct:()=>FrequencyBandsStruct,GroupStruct:()=>GroupStruct,HRVStruct:()=>HRVStruct,IMUStruct:()=>IMUStruct,NotificationStruct:()=>NotificationStruct,PPGStruct:()=>PPGStruct,ProfileStruct:()=>ProfileStruct,ScheduleStruct:()=>ScheduleStruct,Struct:()=>Struct,eegCoordinates:()=>eegCoordinates,setCoordinate:()=>setCoordinate,structRegistry:()=>structRegistry});function Struct(structType="struct",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){function randomId3(tag=""){return`${tag+Math.floor(Math.random()+Math.random()*Math.random()*1e16)}`}let struct={_id:randomId3(structType+"defaultId"),structType,ownerId:parentUser?._id,timestamp:Date.now(),parent:{structType:parentStruct?.structType,_id:parentStruct?._id}};if(!struct.ownerId)delete struct.ownerId;if(!struct?.parent?._id)delete struct.parent;if(Object.keys(assignProps).length>0)Object.assign(struct,assignProps);return struct}var eegCoordinates={FP1:[-21.2,66.9,12.1],FPZ:[1.4,65.1,11.3],FP2:[24.3,66.3,12.5],AF7:[-41.7,52.8,11.3],AF3:[-32.7,48.4,32.8],AFZ:[1.8,54.8,37.9],AF4:[35.1,50.1,31.1],AF8:[43.9,52.7,9.3],F5:[-51.4,26.7,24.7],F3:[-39.7,25.3,44.7],F1:[-22.1,26.8,54.9],FZ:[0,26.8,60.6],F2:[23.6,28.2,55.6],F4:[41.9,27.5,43.9],F6:[52.9,28.7,25.2],F7:[-52.1,28.6,3.8],F8:[53.2,28.4,3.1],FC5:[-59.1,3,26.1],FC3:[-45.5,2.4,51.3],FC1:[-24.7,.3,66.4],FCZ:[1,1,72.8],FC2:[26.1,3.2,66],FC4:[47.5,4.6,49.7],FC6:[60.5,4.9,25.5],FT9:[-53.8,-2.1,-29.1],FT7:[-59.2,3.4,-2.1],FT8:[60.2,4.7,-2.8],FT10:[55,-3.6,-31],T7:[-65.8,-17.8,-2.9],T5:[-61.5,-65.3,1.1],T3:[-70.2,-21.3,-10.7],T4:[71.9,-25.2,-8.2],T6:[59.3,-67.6,3.8],T8:[67.4,-18.5,-3.4],C5:[-63.6,-18.9,25.8],C3:[-49.1,-20.7,53.2],C1:[-25.1,-22.5,70.1],CZ:[.8,-21.9,77.4],C2:[26.7,-20.9,69.5],C4:[50.3,-18.8,53],C6:[65.2,-18,26.4],CP5:[-61.8,-46.2,22.5],CP3:[-46.9,-47.7,49.7],CP1:[-24,-49.1,66.1],CPZ:[.7,-47.9,72.6],CP2:[25.8,-47.1,66],CP4:[49.5,-45.5,50.7],CP6:[62.9,-44.6,24.4],TP9:[-73.6,-46.7,-4],TP7:[-63.6,-44.7,-4],TP8:[64.6,-45.4,-3.7],TP10:[74.6,-47.4,-3.7],P9:[-50.8,-51.3,-37.7],P7:[-55.9,-64.8,0],P5:[-52.7,-67.1,19.9],P3:[-41.4,-67.8,42.4],P1:[-21.6,-71.3,52.6],PZ:[.7,-69.3,56.9],P2:[24.4,-69.9,53.5],P4:[44.2,-65.8,42.7],P6:[54.4,-65.3,20.2],P8:[56.4,-64.4,.1],P10:[51,-53.9,-36.5],PO7:[-44,-81.7,1.6],PO3:[-33.3,-84.3,26.5],POZ:[0,-87.9,33.5],PO4:[35.2,-82.6,26.1],PO8:[43.3,-82,.7],O1:[-25.8,-93.3,7.7],OZ:[.3,-97.1,8.7],O2:[25,-95.2,6.2]};function setCoordinate(channelDict,assignTo={}){if(!eegCoordinates[channelDict.tag]&&channelDict.position){eegCoordinates[channelDict.tag]=[channelDict.position.x,channelDict.position.y,channelDict.position.z]}if(eegCoordinates[channelDict.tag]){let props={channel:"",position:{x:eegCoordinates[channelDict.tag][0],y:eegCoordinates[channelDict.tag][1],z:eegCoordinates[channelDict.tag][2]}};return Object.assign(assignTo,props)}else return Object.assign(assignTo,channelDict)}function EEGCoordinates(channelDicts=[],genCoherenceMap=true){let structs=[];for(let channelDict of channelDicts){let struct=EEGStruct(channelDict);structs.push(struct)}if(genCoherenceMap){structs.push(...CoherenceMap({channelDicts}))}return structs}function FrequencyBandsStruct(additionalBands=[],assignTo={}){let bands={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]};additionalBands.forEach(band=>bands[band]=[]);return Object.assign(assignTo,bands)}function EEGStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let bands=FrequencyBandsStruct();let props={tag,position:{x:0,y:0,z:0},count:0,times:[],raw:[],filtered:[],fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(bands)),means:JSON.parse(JSON.stringify(bands)),startTime:Date.now()};let struct=Struct("eeg",props,parentUser,parentStruct);if(tag)setCoordinate(props,struct);return Object.assign(struct,assignProps)}function CoherenceStruct(coords={0:EEGStruct("FP1"),1:EEGStruct("FP2")},assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let bands=FrequencyBandsStruct();let props={tag:coords[0]?.tag+"::"+coords[1]?.tag,x0:coords[0]?.position?.x,y0:coords[0]?.position?.y,z0:coords[0]?.position?.z,x1:coords[1]?.position?.x,y1:coords[1]?.position?.y,z1:coords[1]?.position?.z,fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(bands)),means:JSON.parse(JSON.stringify(bands)),startTime:Date.now()};let struct=Struct("coherence",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function CoherenceMap(opts={channelDicts:[{ch:0,tag:"FP1",analyze:false},{ch:1,tag:"FP2",analyze:false}],taggedOnly:true},_={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){var cmap=[];var l=1,k=0;for(var i3=0;i3<opts.channelDicts.length*(opts.channelDicts.length+1)/2-opts.channelDicts.length;i3++){if(opts.taggedOnly===false||opts.taggedOnly===true&&(opts.channelDicts[k].tag!==null&&opts.channelDicts[k+l].tag!==null&&(opts.channelDicts[k].tag!=="other"&&opts.channelDicts[k+l].tag!=="other")&&(opts.channelDicts[k].analyze===true&&opts.channelDicts[k+l].analyze===true))){var coord0=EEGStruct(opts.channelDicts[k].tag);var coord1=EEGStruct(opts.channelDicts[k+l].tag);cmap.push(CoherenceStruct({0:coord0,1:coord1},{},parentUser,parentStruct))}l++;if(l+k===opts.channelDicts.length){k++;l=1}}return cmap}function FNIRSStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,position:{x:0,y:0,z:0},count:0,times:[],red:[],ir:[],ir2:[],ambient:[],ratio:[],temp:[],beat_detect:{beats:[],breaths:[],rir:[],rir2:[],drir_dt:[],localmins:[],localmaxs:[],val_dists:[],peak_dists:[],localmins2:[],localmaxs2:[],val_dists2:[],peak_dists2:[]},startTime:Date.now()};let struct=Struct("fnirs",props,parentUser,parentStruct);if(tag)setCoordinate(props,struct);return Object.assign(struct,assignProps)}function IMUStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[],startTime:Date.now()};let struct=Struct("imu",props,parentUser,parentStruct);if(tag)setCoordinate(props,struct);return Object.assign(struct,assignProps)}function EyeTrackerStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,count:0,times:[],x:[],y:[],smax:[],smay:[],startTime:Date.now()};let struct=Struct("eyetracker",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function ECGStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,count:0,times:[],raw:[],filtered:[],bpm:[],hrv:[],startTime:Date.now()};let struct=Struct("ecg",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function EDAStruct(_="",__={},___={_id:""},____={structType:"struct",_id:""}){}function PPGStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let struct=FNIRSStruct(tag,parentUser,parentStruct,assignProps);struct.structType="ppg";return struct}function HRVStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let struct=ECGStruct(tag,parentUser,parentStruct,assignProps);struct.structType="hrv";return struct}function EMGStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let struct=EEGStruct(tag,parentUser,parentStruct,assignProps);struct.structType="emg";return struct}function ProfileStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,name:"",username:"",firstName:"",lastName:"",email:"",phone:"",sex:"",birthday:"",type:"",pictureUrl:"",userRoles:{},socials:{},data:{},hidden:false,accessToken:"",refreshToken:""};let struct=Struct("profile",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function AuthorizationStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,authorizedId:"",authorizedName:"",authorizerId:"",authorizerName:"",authorizations:{},structs:{},excluded:{},groups:{},status:"PENDING",expires:false,associatedAuthId:""};let struct=Struct("authorization",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function GroupStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,name:"",details:"",admins:{},peers:{},clients:{},users:{}};let struct=Struct("group",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function Data(type,data){return{type,data,timestamp:Date.now()}}function DataStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,title:"",author:"",expires:false,type:"",data:new Array};let struct=Struct("data",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function EventStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,event:"",author:"",startTime:"",endTime:"",grade:0,notes:"",attachments:new Array,users:{}};let struct=Struct("event",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function ChatroomStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,message:"",topic:"",author:"",attachments:new Array,comments:new Array,replies:new Array,users:{},audioChatActive:false,videoChatActive:false};let struct=Struct("chatroom",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function CommentStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,author:"",replyTo:"",message:"",rating:0,replies:new Array,users:{},attachments:new Array};let struct=Struct("comment",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function NotificationStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,note:"",parentUserId:""};let struct=Struct("notification",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function ScheduleStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,title:"",author:"",attachments:new Array,dates:new Array};let struct=Struct("schedule",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}function DateStruct(tag="",assignProps={},parentUser={_id:""},parentStruct={structType:"struct",_id:""}){let props={tag,timeSet:"",notes:"",recurs:"NEVER",attachments:new Array};let struct=Struct("date",props,parentUser,parentStruct);return Object.assign(struct,assignProps)}var structRegistry={Struct,EEGStruct,FNIRSStruct,CoherenceStruct,CoherenceMap,FrequencyBandsStruct,IMUStruct,EyeTrackerStruct,ECGStruct,EDAStruct,PPGStruct,HRVStruct,EMGStruct,ProfileStruct,AuthorizationStruct,GroupStruct,DataStruct,EventStruct,ChatroomStruct,CommentStruct,NotificationStruct,ScheduleStruct,DateStruct};var EventHandler2=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.ctr=0;this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}if(this.triggers[statesubKey2]){let run=fn=>{fn(updateObj)};this.triggers[statesubKey2].forEach(v2=>{run(v2.onchange)})}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value,this.triggers[key]);this.triggers[key].forEach(fn)}};this.subscribeState=onchange=>{return this.subscribeEvent(statesubKey2,onchange)};this.unsubscribeState=sub=>{return this.unsubscribeEvent(statesubKey2,sub)};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.ctr;this.ctr++;this.triggers[key].push({sub:l,onchange});return l}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(sub===void 0){delete this.triggers[key];delete this.data[key]}else{let idx=void 0;let obj=triggers.find((o,i3)=>{if(o.sub===sub){idx=i3;return true}});if(obj)triggers.splice(idx,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed);return sub};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var statesubKey2="*s";var state2=new EventHandler2;var import_bson=__toESM2(require_bson());var shallowqueryDummy=DataStructures_exports.ProfileStruct();for(const key in shallowqueryDummy){if(key==="username"||key==="lastName"||key==="firstName"||key==="name"||key==="_id"||key==="pictureUrl")shallowqueryDummy[key]=1;else delete shallowqueryDummy[key]}var Systems={collision:{setupEntities:function(entities){for(const key in entities){const entity=entities[key];if(entity.components){if(!entity.components[this.__node.tag])continue}this.setupEntity(entity)}return entities},setupEntity:function(entity){if(!("collisionEnabled"in entity))entity.collisionEnabled=true;if(!entity.collisionType)entity.collisionType="sphere";if(!entity.collisionRadius)entity.collisionRadius=1;if(!entity.collisionBoundsScale)entity.collisionBoundsScale={x:1,y:1,z:1};if(!entity.colliding)entity.colliding={};if(!entity.position)entity.position={x:0,y:0,z:0};return entity},__node:{tag:"collision"},__operator:function(entities){let keys3=this.entityKeys;for(let i3=0;i3<keys3.length;i3++){const entity1=entities[keys3[i3]];if(entity1.components){if(!entity1.components[this.__node.tag]||!entity1.collisionEnabled)continue}if(!entity1.collisionEnabled)continue;for(let j=0;j<keys3.length;j++){if(i3===j)continue;const entity2=entities[keys3[j]];if(entity2.components){if(!entity2.components[this.__node.tag])continue}if(!entity2.collisionEnabled)continue;let colliding=Systems.collision.collisionCheck(entity1,entity2);if(colliding!==false){if(!entity1.colliding)entity1.colliding={};if(!entity2.colliding)entity2.colliding={};entity1.colliding[entity2.__node.tag]=colliding;entity2.colliding[entity1.__node.tag]=colliding}}}return entities},collisionCheck:(body1,body2)=>{if(body1.collisionEnabled===false||body2.collisionEnabled===false)return false;const dist=Systems.collision.distance(body1.position,body2.position);if(dist<Math.max(...Object.values(body1.collisionBoundsScale))*body1.collisionRadius+Math.max(...Object.values(body2.collisionBoundsScale))*body2.collisionRadius){let isColliding=false;if(body1.collisionType==="sphere"){if(body2.collisionType==="sphere"){isColliding=Systems.collision.sphereCollisionCheck(body1,body2,dist)}else if(body2.collisionType==="box"){isColliding=Systems.collision.sphereBoxCollisionCheck(body1,body2,dist)}else if(body2.collisionType==="point"){isColliding=Systems.collision.isPointInsideSphere(body2.position,body1,dist)}}else if(body1.collisionType==="box"){if(body2.collisionType==="sphere"){isColliding=Systems.collision.sphereBoxCollisionCheck(body2,body1,dist)}else if(body2.collisionType==="box"){isColliding=Systems.collision.boxCollisionCheck(body1,body2)}else if(body2.collisionType==="point"){isColliding=Systems.collision.isPointInsideBox(body1.position,body1)}}else if(body1.collisionType==="point"){if(body2.collisionType==="sphere"){isColliding=Systems.collision.isPointInsideSphere(body1.position,body2,dist)}else if(body2.collisionType==="box"){isColliding=Systems.collision.isPointInsideBox(body1.position,body2)}}if(isColliding)return dist}return false},sphereCollisionCheck:(body1,body2,dist)=>{if(dist===void 0)dist=Systems.collision.distance(body1.position,body2.position);return dist<body1.collisionRadius+body2.collisionRadius},boxCollisionCheck:(body1,body2)=>{let body1minX=(body1.position.x-body1.collisionRadius)*body1.collisionBoundsScale.x;let body1maxX=(body1.position.x+body1.collisionRadius)*body1.collisionBoundsScale.x;let body1minY=(body1.position.y-body1.collisionRadius)*body1.collisionBoundsScale.y;let body1maxY=(body1.position.y+body1.collisionRadius)*body1.collisionBoundsScale.y;let body1minZ=(body1.position.z-body1.collisionRadius)*body1.collisionBoundsScale.z;let body1maxZ=(body1.position.z+body1.collisionRadius)*body1.collisionBoundsScale.z;let body2minX=(body2.position.x-body2.collisionRadius)*body1.collisionBoundsScale.x;let body2maxX=(body2.position.x+body2.collisionRadius)*body1.collisionBoundsScale.x;let body2minY=(body2.position.y-body2.collisionRadius)*body1.collisionBoundsScale.y;let body2maxY=(body2.position.y+body2.collisionRadius)*body1.collisionBoundsScale.y;let body2minZ=(body2.position.z-body2.collisionRadius)*body1.collisionBoundsScale.z;let body2maxZ=(body2.position.z+body2.collisionRadius)*body1.collisionBoundsScale.z;return(body1maxX<=body2maxX&&body1maxX>=body2minX||body1minX<=body2maxX&&body1minX>=body2minX)&&(body1maxY<=body2maxY&&body1maxY>=body2minY||body1minY<=body2maxY&&body1minY>=body2minY)&&(body1maxZ<=body2maxZ&&body1maxZ>=body2minZ||body1minZ<=body2maxZ&&body1minZ>=body2minZ)},sphereBoxCollisionCheck:(sphere,box,dist)=>{let boxMinX=(box.position.x-box.collisionRadius)*box.collisionBoundsScale.x;let boxMaxX=(box.position.x+box.collisionRadius)*box.collisionBoundsScale.x;let boxMinY=(box.position.y-box.collisionRadius)*box.collisionBoundsScale.y;let boxMaxY=(box.position.y+box.collisionRadius)*box.collisionBoundsScale.y;let boxMinZ=(box.position.z-box.collisionRadius)*box.collisionBoundsScale.z;let boxMaxZ=(box.position.z+box.collisionRadius)*box.collisionBoundsScale.z;let clamp={x:Math.max(boxMinX,Math.min(sphere.position.x,boxMaxX)),y:Math.max(boxMinY,Math.min(sphere.position.y,boxMaxY)),z:Math.max(boxMinZ,Math.min(sphere.position.z,boxMaxZ))};if(dist===void 0)dist=Systems.collision.distance(sphere.position,clamp);return dist>sphere.collisionRadius},isPointInsideSphere:(point,sphere,dist)=>{if(dist===void 0)dist=Systems.collision.distance(point,sphere.position);return dist<sphere.collisionRadius},isPointInsideBox:(point,box)=>{let boxminX=(box.position.x-box.collisionRadius)*box.collisionBoundsScale.x;let boxmaxX=(box.position.x+box.collisionRadius)*box.collisionBoundsScale.x;let boxminY=(box.position.y-box.collisionRadius)*box.collisionBoundsScale.x;let boxmaxY=(box.position.y+box.collisionRadius)*box.collisionBoundsScale.x;let boxminZ=(box.position.z-box.collisionRadius)*box.collisionBoundsScale.x;let boxmaxZ=(box.position.z+box.collisionRadius)*box.collisionBoundsScale.x;return point.x>=boxminX&&point.x<=boxmaxX&&(point.y>=boxminY&&point.y<=boxmaxY)&&(point.z>=boxminZ&&point.z<=boxmaxZ)},closestPointOnLine:(point,lineStart,lineEnd)=>{let a={x:lineEnd.x-lineStart.x,y:lineEnd.y-lineStart.y,z:lineEnd.z-lineStart.z};let b={x:lineStart.x-point.x,y:lineStart.y-point.y,z:lineStart.z-point.z};let c={x:lineEnd.x-point.x,y:lineEnd.y-point.y,z:lineEnd.z-point.z};let bdota=Systems.collision.dot(b,a);if(bdota<=0)return lineStart;let cdota=Systems.collision.dot(c,a);if(cdota<=0)return lineEnd;let _bdotapluscdota=1/(bdota+cdota);return{x:lineStart.x+(lineEnd.x-lineStart.x)*bdota*_bdotapluscdota,y:lineStart.y+(lineEnd.y-lineStart.y)*bdota*_bdotapluscdota,z:lineStart.z+(lineEnd.z-lineStart.z)*bdota*_bdotapluscdota}},closestPointOnPolygon:(point,t0,t1,t22)=>{let n=Systems.collision.calcNormal(t0,t1,t22);let dist=Systems.collision.dot(point,n)-Systems.collision.dot(t0,n);let projection=Systems.collision.vecadd(point,Systems.collision.vecscale(n,-dist));let v0x=t22[0]-t0[0];let v0y=t22[1]-t0[1];let v0z=t22[2]-t0[2];let v1x=t1[0]-t0[0];let v1y=t1[1]-t0[1];let v1z=t1[2]-t0[2];let v2x=projection[0]-t0[0];let v2y=projection[1]-t0[1];let v2z=projection[2]-t0[2];let dot00=v0x*v0x+v0y*v0y+v0z*v0z;let dot01=v0x*v1x+v0y*v1y+v0z*v1z;let dot02=v0x*v2x+v0y*v2y+v0z*v2z;let dot11=v1x*v1x+v1y*v1y+v1z*v1z;let dot12=v1x*v2x+v1y*v2y+v1z*v2z;let denom=dot00*dot11-dot01*dot01;if(Math.abs(denom)<1e-30){return void 0}let _denom=1/denom;let u3=(dot11*dot02-dot01*dot12)*_denom;let v2=(dot00*dot12-dot01*dot02)*_denom;if(u3>=0&&v2>=0&&u3+v2<1){return projection}else return void 0},calcNormal:(t0,t1,t22,positive=true)=>{var QR=Systems.collision.makeVec(t0,t1);var QS=Systems.collision.makeVec(t0,t22);if(positive===true){return Systems.collision.normalize(Systems.collision.cross3D(QR,QS))}else{return Systems.collision.normalize(Systems.collision.cross3D(QS,QR))}},dot:(v1,v2)=>{let dot=0;for(const key in v1){dot+=v1[key]*v2[key]}return dot},makeVec(p1,p2){return{x:p2.x-p1.x,y:p2.y-p1.y,z:p2.z-p1.z}},vecadd:(v1,v2)=>{let result=Object.assign({},v1);for(const key in result){result[key]+=v2[key]}return result},vecsub:(v1,v2)=>{let result=Object.assign({},v1);for(const key in result){result[key]-=v2[key]}return result},vecmul:(v1,v2)=>{let result=Object.assign({},v1);for(const key in result){result[key]*=v2[key]}return result},vecdiv:(v1,v2)=>{let result=Object.assign({},v1);for(const key in result){result[key]/=v2[key]}return result},vecscale:(v1,scalar)=>{let result=Object.assign({},v1);for(const key in result){result[key]*=scalar}return result},distance:(v1,v2)=>{let distance=0;for(const key in v1){distance+=Math.pow(v1[key]-v2[key],2)}return Math.sqrt(distance)},magnitude:v2=>{let magnitude=0;for(const key in v2){magnitude+=v2[key]*v2[key]}return Math.sqrt(magnitude)},normalize:v2=>{let magnitude=Systems.collision.magnitude(v2);let _mag=magnitude?1/magnitude:0;let vn={};for(const key in v2){vn[key]=v2[key]*_mag}return vn},distance3D(v1,v2){return Math.sqrt((v1.x-v2.x)*(v1.x-v2.x)+(v1.y-v2.y)*(v1.y-v2.y)+(v1.z-v2.z)*(v1.z-v2.z))},cross3D(v1,v2){return{x:v1.y*v2.z-v1.z*v2.y,y:v1.z*v2.x-v1.x*v2.z,z:v1.x*v2.y-v1.y*v2.x}},nearestNeighborSearch(entities,isWithinRadius=1e15){var tree={};;for(const key in entities){let newnode={tag:key,position:void 0,neighbors:[]};newnode.position=entities[key].position;tree[key]=newnode}for(const i3 in tree){for(const j in tree){var dist=Systems.collision.distance3D(tree[i3].position,tree[j].position);if(dist<isWithinRadius){var newNeighbori={tag:j,position:entities[j].position,dist};tree[i3].neighbors.push(newNeighbori);var newNeighborj={tag:j,position:entities[i3].position,dist};tree[j].neighbors.push(newNeighborj)}}tree[i3].neighbors.sort(function(a,b){return a.dist-b.dist})}return tree},generateBoundingVolumeTree(entities,mode="octree",withinRadius=1e15,minEntities=3){let dynamicBoundingVolumeTree={proto:{parent:void 0,children:{},entities:{},collisionType:"box",collisionRadius:1,collisionBoundsScale:{x:1,y:1,z:1},position:{x:0,y:0,z:0}},tree:{}};let maxX,maxY,maxZ;let minX=0,minY=0,minZ=0;let positions={};let minRadius=withinRadius;for(const key in entities){const body=entities[key];let xx=body.position.x+body.collisionRadius*body.collisionBoundsScale.x;let yy=body.position.y+body.collisionRadius*body.collisionBoundsScale.y;let zz=body.position.z+body.collisionRadius*body.collisionBoundsScale.z;if(maxX<xx)maxX=xx;if(minX>xx)minX=xx;if(maxY<yy)maxY=yy;if(minY>yy)minY=yy;if(maxZ<zz)maxZ=zz;if(minZ>zz)minZ=zz;if(minRadius>body.collisionRadius)minRadius=body.collisionRadius;positions[key]=body.position};let head=JSON.parse(JSON.stringify(dynamicBoundingVolumeTree.proto));let boxpos={x:(maxX+minX)*.5,y:(maxY+minY)*.5,z:(maxZ+minZ)*.5};let boxbounds={x:maxX-boxpos.x,y:maxY-boxpos.y,z:maxZ-boxpos.z};head.position=boxpos;head.collisionBoundsScale=boxbounds;head.entities=entities;dynamicBoundingVolumeTree.tree=head;minRadius*=2;if(mode==="octree"){let genOct=function(parentPos,halfbounds){let oct1={x:parentPos.x+halfbounds.x,y:parentPos.y+halfbounds.y,z:parentPos.z+halfbounds.z};let oct2={x:parentPos.x-halfbounds.x,y:parentPos.y+halfbounds.y,z:parentPos.z+halfbounds.z};let oct3={x:parentPos.x+halfbounds.x,y:parentPos.y-halfbounds.y,z:parentPos.z+halfbounds.z};let oct4={x:parentPos.x+halfbounds.x,y:parentPos.y+halfbounds.y,z:parentPos.z-halfbounds.z};let oct5={x:parentPos.x-halfbounds.x,y:parentPos.y-halfbounds.y,z:parentPos.z+halfbounds.z};let oct6={x:parentPos.x-halfbounds.x,y:parentPos.y+halfbounds.y,z:parentPos.z-halfbounds.z};let oct7={x:parentPos.x+halfbounds.x,y:parentPos.y-halfbounds.y,z:parentPos.z-halfbounds.z};let oct8={x:parentPos.x-halfbounds.x,y:parentPos.y-halfbounds.y,z:parentPos.z-halfbounds.z};return[oct1,oct2,oct3,oct4,oct5,oct6,oct7,oct8]},genOctTree=function(head2){let halfbounds={x:head2.collisionBoundsScale.x*.5,y:head2.collisionBoundsScale.y*.5,z:head2.collisionBoundsScale.z*.5};let octPos=genOct(head2.position,halfbounds);let check=Object.assign({},head2.bodies);for(let i3=0;i3<8;i3++){let octquadrant=Object.assign(JSON.parse(JSON.stringify(dynamicBoundingVolumeTree.proto)),{position:octPos[i3],collisionBoundsScale:halfbounds});octquadrant.parent=head2;for(const j in check){let collided=Systems.collision.collisionCheck(check[j],octquadrant);if(collided){octquadrant.entities[j]=check[j];delete check[j]}}if(Object.keys(octquadrant.entities).length>minEntities-1){head2.children[i3]=octquadrant;octquadrant.parent=head2;if(Object.keys(octquadrant.entities).length>minEntities&&octquadrant.collisionRadius*.5>minRadius){genOctTree(octquadrant)}}}};genOctTree(head);return head}else{let tree=Systems.collision.nearestNeighborSearch(positions,withinRadius);let keys3=Object.keys(tree);let tag=keys3[Math.floor(Math.random()*keys3.length)];let searching=true;let count=0;let genBoundingBoxLevel=(tree2,volumes)=>{let newVolumes={};let foundidxs={};let treekeys=Object.keys(tree2);while(searching&&count<treekeys.length){let node=tree2[tag];let i3=0;let j=0;let ux=positions[node.tag].x-volumes[node.tag].collisionBoundsScale.x,uy=positions[node.tag].y-volumes[node.tag].collisionBoundsScale.y,uz=positions[node.tag].z-volumes[node.tag].collisionBoundsScale.z,mx=positions[node.tag].x+volumes[node.tag].collisionBoundsScale.x,my=positions[node.tag].y+volumes[node.tag].collisionBoundsScale.y,mz=positions[node.tag].z+volumes[node.tag].collisionBoundsScale.z;let newvolume=JSON.parse(JSON.stringify(dynamicBoundingVolumeTree.proto));newvolume.tag=`bound${Math.floor(Math.random()*1e15)}`;newvolume.children[node.tag]=volumes[node.tag];newvolume.bodies[node.tag]=entities[node.tag];volumes[node.tag].parent=newvolume;foundidxs[node.tag]=true;i3++;j++;let nkeys=Object.keys(node.neighbors);while(i3<nkeys.length&&j<3){if(foundidxs[node.neighbors[i3].tag]){i3++;continue}let uxn=positions[node.neighbors[i3].tag].x-volumes[node.neighbors[i3].tag].collisionBoundsScale.x,uyn=positions[node.neighbors[i3].tag].y-volumes[node.neighbors[i3].tag].collisionBoundsScale.y,uzn=positions[node.neighbors[i3].tag].z-volumes[node.neighbors[i3].tag].collisionBoundsScale.z,mxn=positions[node.neighbors[i3].tag].x+volumes[node.neighbors[i3].tag].collisionBoundsScale.x,myn=positions[node.neighbors[i3].tag].y+volumes[node.neighbors[i3].tag].collisionBoundsScale.y,mzn=positions[node.neighbors[i3].tag].z+volumes[node.neighbors[i3].tag].collisionBoundsScale.z;if(ux>uxn)ux=uxn;if(mx<mxn)mx=mxn;if(uy>uyn)uy=uyn;if(my<myn)my=myn;if(uz>uzn)uz=uzn;if(mz<mzn)mz=mzn;newvolume.children[node.neighbors[i3].tag]=volumes[node.neighbors[i3].tag];newvolume.entities[node.neighbors[i3].tag]=entities[node.neighbors[i3].tag];volumes[node.neighbors[i3].tag].parent=newvolume;foundidxs[node.neighbors[i3].tag]=true;i3++;j++}let pos={x:(mx+ux)*.5,y:(my+uy)*.5,z:(mz+uz)*.5};let bounds={x:mx-pos.x,y:my-pos.y,z:mz-pos.z};newvolume.position=pos;newvolume.collisionBoundsScale=bounds;if(newvolume.bodies.length===1)newvolume=node;newVolumes[newvolume.tag]=newvolume;while(i3<node.neighbors.length){if(!foundidxs[node.neighbors[i3].tag])break;i3++}if(i3<node.neighbors.length){tag=node.neighbors[i3].tag}else if(Object.keys(foundidxs).length<Object.keys(tree2).length){tag=keys3[0]}else searching=false;count++}return newVolumes};let result=genBoundingBoxLevel(tree,entities);while(Object.keys(result).length>2){let nextTree=Systems.collision.nearestNeighborSearch(result,withinRadius);result=genBoundingBoxLevel(nextTree,result)}head.children=result;head.children.forEach(n=>{n.parent=head});return head}}},collider:{lastTime:performance.now(),setupEntities:function(entities){for(const key in entities){const entity=entities[key];if(entity.components){if(!entity.components[this.__node.tag])continue}this.setupEntity(entity)}return entities},setupEntity:function(entity){if(!("collisionEnabled"in entity))Systems.collision.setupEntity(entity);if(!("boundingBox"in entity))entity.boundingBox={bot:0,top:100,left:0,right:100,front:0,back:100};if(!("position"in entity)){Systems.movement.setupEntity(entity)}if(!("restitution"in entity))entity.restitution=1;if(!("useBoundingBox"in entity))entity.useBoundingBox=true;if(!entity.position.x&&!entity.position.y&&!entity.position.z){entity.position.x=Math.random()*entity.boundingBox.right;entity.position.y=Math.random()*entity.boundingBox.back;entity.position.z=Math.random()*entity.boundingBox.top}return entity},__operator:function(entities){let keys3=this.entityKeys;for(let i3=0;i3<keys3.length;i3++){const entity1=entities[keys3[i3]];if(entity1.components){if(!entity1.components[this.__node.tag]||!entity1.collisionEnabled)continue}if(entity1.useBoundingBox)this.checkBoundingBox(entity1);if(!entity1.collisionEnabled)continue;if(entity1.colliding){for(const key2 in entity1.colliding){const entity2=entities[key2];if(entity1.colliding[key2]===false){delete entity1.colliding[key2];delete entity2.colliding[entity1.__node.tag];continue}if(!entity2.collisionEnabled)continue;if(entity2.collisionType==="box"){this.resolveBoxCollision(entity1,entity2,entity1.colliding[key2])}else{if(entity1.collisionType==="box"){entity1.fixed=true;this.resolveSphereCollisions(entity1,entity2,entity1.colliding[key2]);entity1.fixed=false}else{this.resolveSphereCollisions(entity1,entity2,entity1.colliding[key2]);delete entity2.colliding[entity1.__node.tag]}}delete entity1.colliding[entity2.__node.tag]}delete entity1.colliding}}return entities},__node:{tag:"collider"},checkBoundingBox:entity=>{const xsize=entity.collisionRadius*entity.collisionBoundsScale.x;const ysize=entity.collisionRadius*entity.collisionBoundsScale.y;const zsize=entity.collisionRadius*entity.collisionBoundsScale.z;if(entity.position.y-ysize<=entity.boundingBox.front){entity.velocity.y*=-entity.restitution;entity.position.y=entity.boundingBox.front+ysize}if(entity.position.y+ysize>=entity.boundingBox.back){entity.velocity.y*=-entity.restitution;entity.position.y=entity.boundingBox.back-ysize}if(entity.position.x-xsize<=entity.boundingBox.left){entity.velocity.x*=-entity.restitution;entity.position.x=entity.boundingBox.left+xsize}if(entity.position.x+xsize>=entity.boundingBox.right){entity.velocity.x*=-entity.restitution;entity.position.x=entity.boundingBox.right-xsize}if(entity.position.z-zsize<=entity.boundingBox.bot){entity.velocity.z*=-entity.restitution;entity.position.z=entity.boundingBox.bot+zsize}if(entity.position.z+zsize>=entity.boundingBox.top){entity.velocity.z*=-entity.restitution;entity.position.z=entity.boundingBox.top-zsize}},resolveBoxCollision:(body1,box,negate)=>{let positionVec=Systems.collision.makeVec(body1.position,box.position);var directionVec=Object.values(positionVec);let closestSide;let closestDist=Infinity;let mul=-1;if(directionVec[idx]<0)mul=1;if(negate)mul=-mul;for(const key in body1.position){let dist=Math.abs(box.position[key]-body1.position[key]);if(dist<closestDist&&Math.abs(box.position[key]-body1.position[key]+body1.velocity[key]*1e-17)<dist){closestSide=key;closestDist=dist}}var idx=directionVec.indexOf(closestSide);if(idx===0)idx="x";if(idx===1)idx="y";if(idx===2)idx="z";if(idx===3)idx="w";let boxEdgeAxisPosition=box.position[idx]+box.collisionRadius*box.collisionBoundsScale[idx]*mul;if(negate){let body1Offset=boxEdgeAxisPosition-body1.collisionRadius*body1.collisionBoundsScale[idx]*mul;body1.position[idx]=body1Offset}else{let body1Offset=boxEdgeAxisPosition+body1.collisionRadius*body1.collisionBoundsScale[idx]*mul;body1.position[idx]=body1Offset}body1.velocity[idx]=-body1.velocity[idx]*body1.restitution;if(negate)body1.force[idx]=-body1.velocity[idx];var body2AccelMag=Systems.collision.magnitude(box.acceleration);var body2AccelNormal=Systems.collision.normalize(box.acceleration);body1.force[idx]=-body2AccelNormal[idx]*body2AccelMag*box.mass;if(negate)body1.force[idx]=-body1.force[idx]},resolveSphereCollisions:(entity1,entity2,dist)=>{if(dist===void 0)dist=Systems.collision.distance(entity1.position,entity2.position);let vecn=Systems.collision.normalize(Systems.collision.makeVec(entity1.position,entity2.position));let sumMass=entity1.mass+entity2.mass;let ratio=entity1.mass/sumMass;let rmin=1-ratio;if(entity1.fixed===false){entity1.position.x+=vecn.x*rmin*1.01;entity1.position.y+=vecn.y*rmin*1.01;entity1.position.z+=vecn.z*rmin*1.001}else{entity2.position.x-=vecn.x*1.01;entity2.position.y-=vecn.y*1.01;entity2.position.z-=vecn.z*1.01}if(entity2.fixed===false){entity2.position.x+=vecn.x*ratio*1.01;entity2.position.y+=vecn.y*ratio*1.01;entity2.position.z+=vecn.z*ratio*1.01}else{entity1.position.x+=vecn.x*1.01;entity1.position.y+=vecn.y*1.01;entity1.position.z+=vecn.z*1.01}dist=Systems.collision.distance(entity1.position,entity2.position);let vrel={x:entity1.velocity.x-entity2.velocity.x,y:entity1.velocity.y-entity2.velocity.y,z:entity1.velocity.z-entity2.velocity.z};let speed=vrel.x*vecn.x+vrel.y*vecn.y+vrel.z*vecn.z;if(speed>0){let impulse=2*speed/sumMass;if(entity1.fixed===false){entity1.velocity.x-=impulse*vecn.x*entity2.mass*entity1.restitution;entity1.velocity.y-=impulse*vecn.y*entity2.mass*entity1.restitution;entity1.velocity.z-=impulse*vecn.z*entity2.mass*entity1.restitution}if(entity2.fixed===false){entity2.velocity.x+=impulse*vecn.x*entity2.mass*entity2.restitution/entity2.mass;entity2.velocity.y+=impulse*vecn.y*entity2.mass*entity2.restitution/entity2.mass;entity2.velocity.z+=impulse*vecn.z*entity2.mass*entity2.restitution/entity2.mass}}}},nbody:{lastTime:performance.now(),G:6674e-14,setupEntities:function(entities){for(const key in entities){const entity=entities[key];if(entity.components){if(!entity.components[this.__node.tag])continue}this.setupEntity(entity)}return entities},setupEntity:function(entity){if(!("collisionEnabled"in entity))Systems.collider.setupEntity(entity);entity.isAttractor=true;if(!("attractorGroup"in entity))entity.attractorGroup=0;if(!("attractorFrameSearchMax"in entity))entity.attractorFrameSearchMax=10;if(!("attractorGroupRules"in entity))entity.attractorGroupRules={0:{G:this.G,maxDist:void 0}};return entity},__operator:function(entities){let keys3=this.entityKeys;for(let i3=0;i3<keys3.length;i3++){const entity=entities[keys3[i3]];if(entity.components){if(!entity.components[this.__node.tag])continue}if(!entity.mass)continue;let nSearched=0;nested:for(let j=0;j<keys3.length;j++){let randKey=keys3[Math.floor(Math.random()*keys3.length)];nSearched++;const entity2=entities[randKey];if(entity2.components){if(!entity2.components[this.__node.tag])continue nested}if(!entity2.mass||!entity2.isAttractor)continue nested;this.attract(entity,entity2,void 0,this.G);if(nSearched>entity.attractorFrameSearchMax)break nested}}return entities},__node:{tag:"nbody"},attract:function(body1,body2,dist,G3=this.G,vecn){if(dist===void 0)dist=Systems.collision.distance3D(body1.position,body2.position);if(vecn===void 0)vecn=Systems.collision.normalize(Systems.collision.makeVec(body1.position,body2.position));let Fg=0;if(dist<.01)dist=.01;if(body1.attractorGroupRules[body2.attractorGroup]){if(typeof body1.attractorGroupRules[body2.attractorGroup]==="object"){if(body1.attractorGroupRules[body2.attractorGroup].maxDist&&body1.attractorGroupRules[body2.attractorGroup].maxDist<dist){}else Fg=body1.attractorGroupRules[body2.attractorGroup].G*body1.mass*body2.mass/(dist*dist)}else Fg=body1.attractorGroupRules[body2.attractorGroup]*body1.mass*body2.mass/(dist*dist)}else Fg=G3*body1.mass*body2.mass/(dist*dist);body1.force.x+=vecn.x*Fg;body1.force.y+=vecn.y*Fg;body1.force.z+=vecn.z*Fg;body2.force.x-=vecn.x*Fg;body2.force.y-=vecn.y*Fg;body2.force.z-=vecn.z*Fg}},boid:{lastTime:performance.now(),defaultAnchor:{x:Math.random(),y:Math.random(),z:Math.random(),mul:.006},setupEntities:function(entities){for(const key in entities){const entity=entities[key];this.setupEntity(entity)}return entities},setupEntity:function(entity){if(!entity.position){Systems.collider.setupEntity(entity)}let adjustedAnchor=Object.assign({},this.defaultAnchor);adjustedAnchor.x*=entity.boundingBox.right;adjustedAnchor.y*=entity.boundingBox.back;adjustedAnchor.z*=entity.boundingBox.top;let boidDefaults={cohesion:1e-5,separation:1e-4,alignment:.006,swirl:adjustedAnchor,attractor:Object.assign(adjustedAnchor,{mul:.002}),useCohesion:true,useSeparation:true,useAlignment:true,useSwirl:true,useAttractor:true,useAttraction:false,groupRadius:200,groupSize:5,searchLimit:5};if(!entity.boid){entity.boid=boidDefaults}else entity.boid=Object.assign(boidDefaults,entity.boid);if(this.entityKeys.length>1e3){entity.boid.groupSize=1;entity.boid.searchLimit=1}return entity},__operator:function(entities){let now=performance.now();let timeStep=now-this.lastTime;this.lastTime=now;let keys3=this.entityKeys;let length=keys3.length;let _timeStep=1/timeStep;let w=-1;outer:for(let i3=0;i3<keys3.length;i3++){w++;let p0=entities[keys3[i3]];const inRange=[];const distances=[];const boidVelocities=[p0.position.x,p0.position.y,p0.position.z,0,0,0,p0.velocity.x,p0.velocity.y,p0.velocity.z,0,0,0,0,0,0,0,0,0];let groupCount=1;let k=-1;nested:for(let j=0;j<keys3.length;j++){k++;if(distances.length>p0.boid.groupSize||k>p0.boid.searchLimit){break nested}let randj=keys3[Math.floor(Math.random()*length)];if(k===w||randj===keys3[i3]||inRange.indexOf(randj)>-1){continue nested}else{let pr=entities[randj];let disttemp=Math.sqrt((p0.position.x-pr.position.x)*(p0.position.x-pr.position.x)+(p0.position.y-pr.position.y)*(p0.position.y-pr.position.y)+(p0.position.z-pr.position.z)*(p0.position.z-pr.position.z));if(disttemp>p0.boid.groupRadius){continue nested}else{distances.push(disttemp);inRange.push(randj);let distInv;if(p0.boid.useSeparation||p0.boid.useAlignment){distInv=p0.boid.groupRadius/(disttemp*disttemp);if(distInv>p0.maxSpeed)distInv=p0.maxSpeed;else if(distInv<-p0.maxSpeed)distInv=-p0.maxSpeed}if(p0.boid.useCohesion){boidVelocities[0]+=(pr.position.x-p0.position.x)*.5*disttemp*_timeStep;boidVelocities[1]+=(pr.position.y-p0.position.y)*.5*disttemp*_timeStep;boidVelocities[2]+=(pr.position.z-p0.position.z)*.5*disttemp*_timeStep}if(isNaN(disttemp)||isNaN(boidVelocities[0])||isNaN(pr.position.x)){console.log(disttemp,i3,randj,p0.position,pr.position,boidVelocities);p0.position.x=NaN;return}if(p0.boid.useSeparation){boidVelocities[3]=boidVelocities[3]+(p0.position.x-pr.position.x)*distInv;boidVelocities[4]=boidVelocities[4]+(p0.position.y-pr.position.y)*distInv;boidVelocities[5]=boidVelocities[5]+(p0.position.z-pr.position.z)*distInv}if(p0.boid.useAttraction&&pr.boid.useAttraction){Systems.nbody.attract(p0,pr,disttemp)}if(p0.boid.useAlignment){boidVelocities[6]=boidVelocities[6]+pr.velocity.x*distInv;boidVelocities[7]=boidVelocities[7]+pr.velocity.y*distInv;boidVelocities[8]=boidVelocities[8]+pr.velocity.z*distInv}groupCount++}}}let _groupCount=1/groupCount;if(p0.boid.useCohesion){boidVelocities[0]=p0.boid.cohesion*(boidVelocities[0]*_groupCount);boidVelocities[1]=p0.boid.cohesion*(boidVelocities[1]*_groupCount);boidVelocities[2]=p0.boid.cohesion*(boidVelocities[2]*_groupCount)}else{boidVelocities[0]=0;boidVelocities[1]=0;boidVelocities[2]=0}if(p0.boid.useSeparation){boidVelocities[3]=p0.boid.separation*boidVelocities[3];boidVelocities[4]=p0.boid.separation*boidVelocities[4];boidVelocities[5]=p0.boid.separation*boidVelocities[5]}else{boidVelocities[3]=0;boidVelocities[4]=0;boidVelocities[5]=0}if(p0.boid.useAlignment){boidVelocities[6]=-(p0.boid.alignment*boidVelocities[6]*_groupCount);boidVelocities[7]=p0.boid.alignment*boidVelocities[7]*_groupCount;boidVelocities[8]=p0.boid.alignment*boidVelocities[8]*_groupCount}else{boidVelocities[6]=0;boidVelocities[7]=0;boidVelocities[8]=0}const swirlVec=[0,0,0];if(p0.boid.useSwirl==true){boidVelocities[9]=-(p0.position.y-p0.boid.swirl.y)*p0.boid.swirl.mul;boidVelocities[10]=(p0.position.z-p0.boid.swirl.z)*p0.boid.swirl.mul;boidVelocities[11]=(p0.position.x-p0.boid.swirl.x)*p0.boid.swirl.mul}const attractorVec=[0,0,0];if(p0.boid.useAttractor==true){boidVelocities[12]=(p0.boid.attractor.x-p0.position.x)*p0.boid.attractor.mul;if(p0.position.x>p0.boundingBox.left||p0.position.x<p0.boundingBox.right){boidVelocities[12]*=3}boidVelocities[13]=(p0.boid.attractor.y-p0.position.y)*p0.boid.attractor.mul;if(p0.position.y>p0.boundingBox.top||p0.position.y<p0.boundingBox.bottom){boidVelocities[13]*=3}boidVelocities[14]=(p0.boid.attractor.z-p0.position.z)*p0.boid.attractor.mul;if(p0.position.z>p0.boundingBox.front||p0.position.z<p0.boundingBox.back){boidVelocities[14]*=3}}p0.velocity.x=p0.velocity.x+boidVelocities[0]+boidVelocities[3]+boidVelocities[6]+boidVelocities[9]+boidVelocities[12]+boidVelocities[15],p0.velocity.y=p0.velocity.y+boidVelocities[1]+boidVelocities[4]+boidVelocities[7]+boidVelocities[10]+boidVelocities[13]+boidVelocities[16],p0.velocity.z=p0.velocity.z+boidVelocities[2]+boidVelocities[5]+boidVelocities[8]+boidVelocities[11]+boidVelocities[14]+boidVelocities[17];if(isNaN(p0.velocity.x))console.error(p0,i3,groupCount,p0.position,p0.velocity,swirlVec,attractorVec)}return entities},__node:{tag:"boid"}},movement:{__node:{tag:"movement"},lastTime:performance.now(),setupEntities:function(entities){for(const key in entities){const entity=entities[key];if(entity.components){if(!entity.components[this.__node.tag])continue}this.setupEntity(entity)}},setupEntity:function(entity){if(!("mass"in entity))entity.mass=1;if(!("fixed"in entity))entity.fixed=false;if(!entity.force)entity.force={x:0,y:0,z:0};if(!("mass"in entity))entity.mass=1;if(!("gravity"in entity))entity.gravity=-9.81;if(!entity.acceleration)entity.acceleration={x:0,y:0,z:0};if(!entity.velocity)entity.velocity={x:0,y:0,z:0};if(!("maxSpeed"in entity))entity.maxSpeed=10;if(!entity.position)entity.position={x:0,y:0,z:0};return entity},__operator:function(entities){let now=performance.now();let timeStep=(now-this.lastTime)*.001;this.lastTime=now;let keys3=this.entityKeys;for(let i3=0;i3<keys3.length;i3++){const entity=entities[keys3[i3]];if(entity.components){if(!entity.components[this.__node.tag])continue}if(entity.fixed)continue;if(entity.mass){if(entity.force.x){entity.acceleration.x+=entity.force.x/entity.mass;entity.force.x=0}if(entity.force.y){entity.acceleration.y+=entity.force.y/entity.mass;entity.force.y=0}if(entity.force.z){entity.acceleration.z+=entity.force.z/entity.mass+entity.gravity;entity.force.z=0}}if(entity.drag){if(entity.acceleration.x)entity.acceleration.x-=entity.acceleration.x*entity.drag*timeStep;if(entity.acceleration.y)entity.acceleration.y-=entity.acceleration.y*entity.drag*timeStep;if(entity.acceleration.z)entity.acceleration.z-=entity.acceleration.z*entity.drag*timeStep}if(entity.acceleration.x)entity.velocity.x+=entity.acceleration.x*timeStep;if(entity.acceleration.y)entity.velocity.y+=entity.acceleration.y*timeStep;if(entity.acceleration.z)entity.velocity.z+=entity.acceleration.z*timeStep;if(entity.maxSpeed>0){let magnitude=Systems.collision.magnitude(entity.velocity);if(magnitude>entity.maxSpeed){let scalar=entity.maxSpeed/magnitude;entity.velocity.x*=scalar;entity.velocity.y*=scalar;entity.velocity.z*=scalar}}if(entity.velocity.x)entity.position.x+=entity.velocity.x*timeStep;if(entity.velocity.y)entity.position.y+=entity.velocity.y*timeStep;if(entity.velocity.z)entity.position.z+=entity.velocity.z*timeStep}return entities}}};var v=class{constructor(e,t3,s,h){this.r=e,this.g=t3,this.b=s,this.a=h}};var A2=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=false,this._vbuffer=0,this._coord=0,this.visible=true,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new v(0,0,0,1),this.webglNumPoints=0}};var d=class extends A2{constructor(e,t3){super(),this.currentIndex=0,this.webglNumPoints=t3,this.numPoints=t3,this.color=e,this.xy=new Float32Array(2*this.webglNumPoints)}setX(e,t3){this.xy[e*2]=t3}setY(e,t3){this.xy[e*2+1]=t3}getX(e){return this.xy[e*2]}getY(e){return this.xy[e*2+1]}lineSpaceX(e,t3){for(let s=0;s<this.numPoints;s++)this.setX(s,e+t3*s)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(e){for(let t3=0;t3<this.numPoints;t3++)this.setY(t3,e)}shiftAdd(e){let t3=e.length;for(let s=0;s<this.numPoints-t3;s++)this.setY(s,this.getY(s+t3));for(let s=0;s<t3;s++)this.setY(s+this.numPoints-t3,e[s])}addArrayY(e){if(this.currentIndex+e.length<=this.numPoints)for(let t3=0;t3<e.length;t3++)this.setY(this.currentIndex,e[t3]),this.currentIndex++}replaceArrayY(e){if(e.length==this.numPoints)for(let t3=0;t3<this.numPoints;t3++)this.setY(t3,e[t3])}};var M=(c,e,t3)=>{let s={x:0,y:0};return s.x=c.x+e.x*t3,s.y=c.y+e.y*t3,s};var P=c=>Y(-c.y,c.x);var x2=(c,e)=>{let t3=T(c,e);return t3=S(t3),t3};var C2=(c,e)=>{let t3={x:0,y:0};return t3.x=c.x+e.x,t3.y=c.y+e.y,t3};var R=(c,e)=>c.x*e.x+c.y*e.y;var S=c=>{let e={x:0,y:0},t3=c.x*c.x+c.y*c.y;return t3>0&&(t3=1/Math.sqrt(t3),e.x=c.x*t3,e.y=c.y*t3),e};var Y=(c,e)=>{let t3={x:0,y:0};return t3.x=c,t3.y=e,t3};var T=(c,e)=>{let t3={x:0,y:0};return t3.x=c.x-e.x,t3.y=c.y-e.y,t3};var F2=c=>{let e,t3={x:0,y:0},s={x:0,y:0},h=[],o=(n,l)=>{h.push({vec2:n,miterLength:l})},a=n=>({x:c[n*2],y:c[n*2+1]});t3=x2(a(1),a(0)),e=P(t3),o(e,1);let r=c.length/2;for(let n=1;n<r-1;n++){let l=a(n-1),i3=a(n),u3=a(n+1);t3=x2(i3,l),e=P(t3),s=x2(u3,i3);let g=N(t3,s),f=X(t3,g,1);o(g,f)}return t3=x2(a(r-1),a(r-2)),e=P(t3),o(e,1),h};var N=(c,e)=>{let t3=C2(c,e);return t3=S(t3),Y(-t3.y,t3.x)};var X=(c,e,t3)=>{let s=Y(-c.y,c.x);return t3/R(e,s)};var p=class extends A2{constructor(e,t3,s){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=t3*2,this.numPoints=t3,this.color=e,this._thicknessRequested=s,this._linePoints=new Float32Array(t3*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let e=this._actualThickness/2,t3=F2(this._linePoints);for(let s=0;s<this.numPoints;s++){let h=this._linePoints[2*s],o=this._linePoints[2*s+1],a={x:h,y:o},r=M(a,t3[s].vec2,t3[s].miterLength*e),n=M(a,t3[s].vec2,-t3[s].miterLength*e);this.xy[s*4]=r.x,this.xy[s*4+1]=r.y,this.xy[s*4+2]=n.x,this.xy[s*4+3]=n.y}}setX(e,t3){this._linePoints[e*2]=t3}setY(e,t3){this._linePoints[e*2+1]=t3}lineSpaceX(e,t3){for(let s=0;s<this.numPoints;s++)this.setX(s,e+t3*s)}setThickness(e){this._thicknessRequested=e}getThickness(){return this._thicknessRequested}setActualThickness(e){this._actualThickness=e}};var L=class{constructor(e,t3){this.debug=false,this.addLine=this.addDataLine,t3==null?this.webgl=e.getContext("webgl",{antialias:true,transparent:false}):(this.webgl=e.getContext("webgl",{antialias:t3.antialias,transparent:t3.transparent,desynchronized:t3.deSync,powerPerformance:t3.powerPerformance,preserveDrawing:t3.preserveDrawing}),this.debug=t3.debug==null?false:t3.debug),this.log("canvas type is: "+e.constructor.name),this.log(`[webgl-plot]:width=${e.width}, height=${e.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=false,this.gLog10Y=false,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,e.width,e.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(e){let t3=this.webgl;e.forEach(s=>{if(s.visible){t3.useProgram(this._progLine);let h=t3.getUniformLocation(this._progLine,"uscale");t3.uniformMatrix2fv(h,false,new Float32Array([s.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,s.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let o=t3.getUniformLocation(this._progLine,"uoffset");t3.uniform2fv(o,new Float32Array([s.offsetX+this.gOffsetX,s.offsetY+this.gOffsetY]));let a=t3.getUniformLocation(this._progLine,"is_log");t3.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let r=t3.getUniformLocation(this._progLine,"uColor");t3.uniform4fv(r,[s.color.r,s.color.g,s.color.b,s.color.a]),t3.bufferData(t3.ARRAY_BUFFER,s.xy,t3.STREAM_DRAW),t3.drawArrays(s.loop?t3.LINE_LOOP:t3.LINE_STRIP,0,s.webglNumPoints)}})}_drawSurfaces(e){let t3=this.webgl;e.forEach(s=>{if(s.visible){t3.useProgram(this._progLine);let h=t3.getUniformLocation(this._progLine,"uscale");t3.uniformMatrix2fv(h,false,new Float32Array([s.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,s.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let o=t3.getUniformLocation(this._progLine,"uoffset");t3.uniform2fv(o,new Float32Array([s.offsetX+this.gOffsetX,s.offsetY+this.gOffsetY]));let a=t3.getUniformLocation(this._progLine,"is_log");t3.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let r=t3.getUniformLocation(this._progLine,"uColor");t3.uniform4fv(r,[s.color.r,s.color.g,s.color.b,s.color.a]),t3.bufferData(t3.ARRAY_BUFFER,s.xy,t3.STREAM_DRAW),t3.drawArrays(t3.TRIANGLE_STRIP,0,s.webglNumPoints)}})}_drawTriangles(e){let t3=this.webgl;t3.bufferData(t3.ARRAY_BUFFER,e.xy,t3.STREAM_DRAW),t3.useProgram(this._progLine);let s=t3.getUniformLocation(this._progLine,"uscale");t3.uniformMatrix2fv(s,false,new Float32Array([e.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,e.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let h=t3.getUniformLocation(this._progLine,"uoffset");t3.uniform2fv(h,new Float32Array([e.offsetX+this.gOffsetX,e.offsetY+this.gOffsetY]));let o=t3.getUniformLocation(this._progLine,"is_log");t3.uniform2iv(o,new Int32Array([0,0]));let a=t3.getUniformLocation(this._progLine,"uColor");t3.uniform4fv(a,[e.color.r,e.color.g,e.color.b,e.color.a]),t3.drawArrays(t3.TRIANGLE_STRIP,0,e.xy.length/2)}_drawThickLines(){this._thickLines.forEach(e=>{if(e.visible){let t3=Math.min(this.gScaleX,this.gScaleY);e.setActualThickness(e.getThickness()/t3),e.convertToTriPoints(),this._drawTriangles(e)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(e){e._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,e._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,e.xy,this.webgl.STREAM_DRAW),e._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(e._coord,2,this.webgl.FLOAT,false,0,0),this.webgl.enableVertexAttribArray(e._coord)}addDataLine(e){this._addLine(e),this.linesData.push(e)}addAuxLine(e){this._addLine(e),this.linesAux.push(e)}addThickLine(e){this._addLine(e),this._thickLines.push(e)}addSurface(e){this._addLine(e),this.surfaces.push(e)}initThinLineProgram(){let e=`\n      attribute vec2 coordinates;\n      uniform mat2 uscale;\n      uniform vec2 uoffset;\n      uniform ivec2 is_log;\n\n      void main(void) {\n         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;\n         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;\n         vec2 line = vec2(x, y);\n         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);\n      }`,t3=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(t3,e),this.webgl.compileShader(t3);let s=`\n         precision mediump float;\n         uniform highp vec4 uColor;\n         void main(void) {\n            gl_FragColor =  uColor;\n         }`,h=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(h,s),this.webgl.compileShader(h),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,t3),this.webgl.attachShader(this._progLine,h),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(e,t3,s,h){this.webgl.viewport(e,t3,s,h)}log(e){this.debug&&console.log("[webgl-plot]:"+e)}};var y2=class{constructor(){this.plots={}}initPlot(e,t3){if(t3||(t3=new L(e.canvas,e.webglOptions)),!e._id)e._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[e._id]){let l=this.plots[e._id].initial;if(e.lines){for(let i3 in e.lines)if(l.lines[i3]&&Array.isArray(e.lines[i3])){let u3=e.lines[i3];e.lines[i3]=l.lines[i3]}}e=Object.assign(l,e)}e.overlay&&(typeof e.overlay!="object"&&(e.overlay=document.createElement("canvas"),e.overlay.style.position="absolute",e.overlay.width=e.canvas.width,e.overlay.height=e.canvas.height,e.canvas.appendChild(e.overlay)),e.overlayCtx||(e.overlayCtx=e.overlay.getContext("2d"))),e.width&&(e.canvas.width=e.width,e.canvas.style&&(e.canvas.style.width=e.width+"px"),typeof e.overlay=="object"&&(e.overlay.width=e.width,e.overlay.style&&(e.overlay.style.width=e.width+"px"))),e.height&&(e.canvas.height=e.height,e.canvas.style&&(e.canvas.style.height=e.height+"px"),typeof e.overlay=="object"&&(e.overlay.height=e.height,e.overlay.style&&(e.overlay.style.height=e.height+"px"))),e.lines?.timestamp&&delete e.lines.timestamp,e.lines||(e.lines={});let s={};for(let l in e.lines)s[l]=Object.assign({},s[l]),"viewing"in e.lines[l]||(e.lines[l].viewing=true),s[l].viewing=e.lines[l].viewing,s[l].sps=e.lines[l].sps,s[l].nSec=e.lines[l].nSec,s[l].nPoints=e.lines[l].nPoints,s[l].ymin=e.lines[l].ymin,s[l].ymax=e.lines[l].ymax,s[l].units=e.lines[l].units;let h={plot:t3,settings:e,initial:Object.assign(Object.assign({},e),{lines:s}),anim:()=>{t3.update()}};this.plots[e._id]=h;let o=0,a=0;Object.keys(e.lines).forEach(l=>{e.lines[l]?.viewing!==false&&a++}),e.nLines=a;let r,n;typeof e.overlay=="object"&&(r=e.overlay,n=e.overlayCtx,n.clearRect(0,0,e.overlay.width,e.overlay.height),n.font=e.overlayFont?e.overlayFont:"1em Courier",n.fillStyle=e.overlayColor?e.overlayColor:"white");for(let l in e.lines){let i3=e.lines[l];if(Array.isArray(i3)&&(i3={values:i3},e.lines[l]=i3),"viewing"in i3||(i3.viewing=true),i3.color)Array.isArray(i3.color)&&(i3.color=new v(...i3.color));else{let m=y2.HSLToRGB(360*(o/a)%360,100,50,1);h.initial.lines[l].color=[...m,1],i3.color=new v(...m,1)}let u3;if(i3.nSec&&i3.sps?u3=Math.ceil(i3.nSec*i3.sps):i3.nPoints?u3=i3.nPoints:i3.points?u3=i3.points:e.linePoints?u3=e.linePoints:i3.values?u3=i3.values.length:u3=1e3,i3.points=u3,e.lines[l].viewing===false)continue;if((i3.width||e.lineWidth)&&i3.width!==0){let m=e.lineWidth;m||(m=i3.width),i3.width?i3.line=new p(i3.color,u3,i3.width):e.lineWidth&&(i3.line=new p(i3.color,u3,e.lineWidth)),i3.line.lineSpaceX(-1,2/i3.line.numPoints)}else i3.line=new d(i3.color,u3),i3.line.arrangeX();i3.values?.length===i3.points?i3.values.length!==u3&&(i3.interpolate?i3.values.length>u3?i3.values=y2.downsample(i3.values,u3):i3.values.length<u3&&(i3.values=y2.upsample(i3.values,u3)):i3.values.length>i3.points?i3.values=i3.values.slice(i3.values.length-i3.points):i3.values=[...new Array(i3.points-i3.values.length).fill(0),...i3.values]):Array.isArray(i3.values)?i3.values.length>u3?i3.values=i3.values.slice(i3.values.length-u3):i3.values.length<u3&&(i3.values=[...new Array(u3-i3.values.length).fill(0),...i3.values]):i3.values=new Array(i3.points).fill(0);let g=i3.ymin,f=i3.ymax,b=i3.values.length<=1e5;if(g===f?(f=b?Math.max(...i3.values):1,g=b?Math.min(...i3.values):0):isNaN(f)&&(f=b?Math.max(...i3.values):1),isNaN(g)&&(g=b?Math.min(...i3.values):0),g>f){let m=g;f=g,g=m}let w=Math.abs(g);if(i3.absmax=w>f?w:f,"autoscale"in i3||(i3.autoscale=true),i3.position||(i3.position=e.nLines-o-1),i3.autoscale?i3.autoscale===2?("clamp"in i3||(i3.clamp=true),i3.scaled=y2.autoscale(i3.values,i3.position,a,i3.centerZero,g,f,i3.clamp)):(i3.scaled=i3.values,i3.line.scaleY=y2.getYScalar(i3.values,a,i3.centerZero,g,f),i3.line.offsetY=y2.getYOffset(i3.position,a,g,i3.line.scaleY)):i3.scaled=i3.values,i3.scaled.forEach((m,_)=>i3.line.setY(_,m)),i3.line instanceof p?t3.addThickLine(i3.line):i3.line instanceof d&&t3.addDataLine(i3.line),"xAxis"in i3||(i3.xAxis=true),i3.xAxis){i3.xColor?Array.isArray(i3.xColor)&&(i3.xColor=new v(...i3.xColor)):i3.xColor=new v(1,1,1,.3);let m=new d(i3.xColor,2),_=i3.autoscale?(o+1)*2/a-1-1/a:0;m.constY(_),m.arrangeX(),m.xy[2]=1,i3.x=m,t3.addAuxLine(m)}if(a>1&&i3.autoscale&&o!==a-1){e.dividerColor?Array.isArray(e.dividerColor)&&(e.dividerColor=new v(...e.dividerColor)):e.dividerColor=new v(1,1,1,1);let m=new d(e.dividerColor,2);m.constY(i3.autoscale?(o+1)*2/a-1:1),m.arrangeX(),m.xy[2]=1,i3.divider=m,t3.addAuxLine(m)}if(typeof e.overlay=="object"&&(i3.useOverlay||!("useOverlay"in i3))){let m=e.nLines-i3.position-1;n.fillText(l,20,r.height*(m+.2)/e.nLines),n.fillText(`${Math.floor(f)===f?f:f?.toFixed(5)} ${i3.units?i3.units:""}`,r.width-100,r.height*(m+.2)/e.nLines),n.fillText(`${Math.floor(g)===g?g:g?.toFixed(5)} ${i3.units?i3.units:""}`,r.width-100,r.height*(m+.9)/e.nLines)}o++}return requestAnimationFrame(h.anim),this.plots[e._id]}deinitPlot(e){return typeof e=="string"&&(e=this.plots[e]),e.plot.clear(),e.plot.removeAllLines(),true}reinitPlot(e,t3){if(typeof e=="string"){let s=e;e=this.plots[e],t3._id||(t3._id=s)}if(e.plot)return e.plot.clear(),e.plot.removeAllLines(),e.settings.overlayCtx&&e.settings.overlayCtx.clearRect(0,0,e.settings.overlay?.width,e.settings.overlay?.height),this.initPlot(t3,e.plot)}getChartSettings(e,t3){let s=this.plots[e];if(s){let h=Object.assign({},s.initial);for(let o in s.initial.lines)typeof s.initial.lines[o]?.ymax!="number"&&(h.lines[o].ymax=s.settings.lines[o]?.ymax),typeof s.initial.lines[o]?.ymin!="number"&&(h.lines[o].ymin=s.settings.lines[o]?.ymin),t3&&(h.lines[o].values=s.settings.lines[o].values);return delete h.canvas,delete h.overlay,delete h.overlayCtx,h}}update(e,t3,s=true){if(typeof e=="string"&&(e=this.plots[e]),!e)return false;if(t3){let h=false,o,a;typeof e.settings.overlay=="object"&&(o=e.settings.overlay,a=e.settings.overlayCtx,a.font=e.settings.overlayFont?e.settings.overlayFont:"1em Courier",a.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white");for(let r in t3)if(e.settings.lines[r]&&e.settings.lines[r].line){if(e.settings.lines[r]?.viewing===false)continue;let n=e.settings.lines[r];if(n.values){if(e.settings.mode&&e.settings.mode==="sweep"){"ct"in n||(n.ct=0);let f=b=>{n.ct>n.values.length&&(n.ct=0),n.values[n.ct]=b,n.ct++};Array.isArray(t3[r])?t3[r].forEach(f):typeof t3[r]=="number"?f(t3[r]):t3[r].values&&t3[r].values.forEach(f)}else Array.isArray(t3[r])&&n.values?.length<1e5?(n.values.length===0&&(n.values.length=n.points?n.points:1e3),t3[r].length===n.values.length?n.values=t3[r]:y2.circularBuffer(n.values,t3[r])):typeof t3[r]=="number"?(n.values.push(t3[r]),n.values.shift()):t3[r]?.values&&(n.values.length===0&&(n.values.length=n.points?n.points:1e3),t3[r].values.length===n.values.length?n.values=t3[r].values:y2.circularBuffer(n.values,t3[r].values));n.values.length!==n.points&&(n.interpolate?n.values.length>n.points?n.values=y2.downsample(n.values,n.points):n.scaled.length<n.points&&(n.values=y2.upsample(n.values,n.points)):n.values.length>n.points?n.values.splice(0,n.values.length-n.points):n.values=new Array(n.points).fill(0).splice(n.points-n.values.length,0,n.values));let l=n.ymin,i3=n.ymax,u3=n.values.length<=1e5;if(l===i3?(i3=u3?Math.max(...n.values):1,l=u3?Math.min(...n.values):0):isNaN(i3)&&(i3=u3?Math.max(...n.values):1),isNaN(l)&&(l=u3?Math.min(...n.values):0),l>i3){let f=l;i3=l,l=f}let g=Math.abs(l);if(n.absmax=g>i3?g:i3,n.autoscale?n.autoscale===2?n.scaled=y2.autoscale(n.values,n.position,e.settings.nLines,n.centerZero,l,i3,n.clamp):(n.scaled=n.values,n.line.scaleY=y2.getYScalar(n.values,e.settings.nLines,n.centerZero,l,i3),n.line.offsetY=y2.getYOffset(n.position,e.settings.nLines,l,n.line.scaleY)):n.scaled=n.values,n.scaled.forEach((f,b)=>{!n.autoscale&&n.absmax>1?n.line.setY(b,f/n.absmax):n.line.setY(b,f)}),typeof e.settings.overlay=="object"&&(n.useOverlay||!("useOverlay"in n))){let f=e.settings.nLines-n.position-1,b=o.height*f/e.settings.nLines,w=o.height/e.settings.nLines;if(a.clearRect(0,b,o.width,w),e.settings.mode&&e.settings.mode==="sweep"){a.fillStyle=e.settings.sweepColor?e.settings.sweepColor:"rgba(0,255,0,0.25)",a.beginPath();let m=o.width*n.ct/n.values.length;a.moveTo(m,b),a.lineTo(m,w),a.stroke()}a.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white",a.fillText(r,20,o.height*(f+.2)/e.settings.nLines),a.fillText(`${Math.floor(i3)===i3?i3:i3?.toFixed(5)} ${n.units?n.units:""}`,o.width-100,o.height*(f+.2)/e.settings.nLines),a.fillText(`${Math.floor(l)===l?l:l?.toFixed(5)} ${n.units?n.units:""}`,o.width-100,o.height*(f+.9)/e.settings.nLines)}}}else e.settings.generateNewLines&&!r.includes("timestamp")&&(Array.isArray(t3[r])&&(t3[r]={values:t3[r]}),!t3[r].nSec&&!t3[r].nPoints&&!e.settings.linePoints&&(t3[r].nPoints=1e3),h=true);if(h)return e.settings.cleanGeneration||Object.keys(e.initial.lines).forEach(r=>{t3[r]?t3[r]=Object.assign(e.initial.lines[r],t3[r]):t3[r]=e.initial.lines[r]}),this.reinitPlot(e,{_id:e.settings._id,lines:t3}),true}return s&&requestAnimationFrame(e.anim),true}updateLine(e,t3,s,h,o,a,r){return e.numPoints!==t3.length&&(s?e.numPoints>t3.length?t3=y2.downsample(t3,e.numPoints):e.numPoints<t3.length&&(t3=y2.upsample(t3,e.numPoints)):t3.length>e.numPoints?t3=t3.slice(t3.length-e.numPoints):t3=[...new Array(t3.length).fill(0),...t3]),h&&(t3=y2.autoscale(t3,o,a,r)),t3.forEach((n,l)=>e.setY(l,n)),true}static autoscale(e,t3=0,s=1,h=false,o,a,r){if(e?.length===0)return e;let n=typeof a=="number"?a:e.length<=1e5?Math.max(...e):1,l=typeof o=="number"?o:e.length<=1e5?Math.min(...e):0,i3=1/s,u3=1;if(h){let g=Math.max(Math.abs(l),Math.abs(n));return g!==0&&(u3=i3/g),e.map(f=>(r&&(f<l&&(f=l),f>n&&(f=n)),f*u3+(i3*(t3+1)*2-1-i3)))}else return n===l?n!==0?u3=i3/n:l!==0&&(u3=i3/Math.abs(l)):u3=i3/(n-l),e.map(g=>(r&&(g<l&&(g=l),g>n&&(g=n)),2*((g-l)*u3-1/(2*s))+(i3*(t3+1)*2-1-i3)))}static getYScalar(e,t3=1,s=false,h,o){if(e?.length===0)return e;let a=typeof o=="number"?o:e.length<=1e5?Math.max(...e):1,r=typeof h=="number"?h:e.length<=1e5?Math.min(...e):0,n=1/t3,l=1;if(s){let i3=Math.max(Math.abs(r),Math.abs(a));return i3!==0&&(l=n/i3),2*l}else return a===r?a!==0?l=n/a:r!==0&&(l=n/Math.abs(r)):l=n/(a-r),2*l}static getYOffset(e=0,t3=1,s=0,h=1){let o=1/t3,a=o*(e+1)*2-1-o;return s!==0?a-=s*h+1/t3:a-=h+1/t3,a}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t3,s=1){if(e.length>t3){let h=new Array(t3),o=e.length/t3,a=e.length-1,r=0,n=0;for(let l=o;l<e.length;l+=o){let i3=Math.round(l);i3>a&&(i3=a);for(let u3=r;u3<i3;u3++)h[n]+=e[u3];h[n]/=(i3-r)*s,n++,r=i3}return h}else return e}static upsample(e,t3,s=1){var h=function(g,f,b){return(g+(f-g)*b)*s},o=new Array(t3),a=(e.length-1)/(t3-1);o[0]=e[0];for(var r=1;r<t3-1;r++){var n=r*a,l=Math.floor(n),i3=Math.ceil(n),u3=n-l;o[r]=h(e[l],e[i3],u3)}return o[t3-1]=e[e.length-1],o}static interpolate(e,t3,s=1){return e.length>t3?y2.downsample(e,t3,s):e.length<t3?y2.upsample(e,t3,s):e}static HSLToRGB(e,t3,s,h=255){t3/=100,s/=100;let o=(1-Math.abs(2*s-1))*t3,a=o*(1-Math.abs(e/60%2-1)),r=s-o/2,n=0,l=0,i3=0;return 0<=e&&e<60?(n=o,l=a,i3=0):60<=e&&e<120?(n=a,l=o,i3=0):120<=e&&e<180?(n=0,l=o,i3=a):180<=e&&e<240?(n=0,l=a,i3=o):240<=e&&e<300?(n=a,l=0,i3=o):300<=e&&e<360&&(n=o,l=0,i3=a),n=(n+r)*h,l=(l+r)*h,i3=(i3+r)*h,[n,l,i3]}static circularBuffer(e,t3){if(t3.length<e.length){let s=e.slice(t3.length),h=e.length;e.splice(0,h,...s,...t3)}else if(t3.length>e.length){let s=e.length;e.splice(0,s,...t3.slice(t3.length-s))}else e.splice(0,e.length,...t3);return e}static formatDataForCharts(e,t3){if(Array.isArray(e)){if(Array.isArray(e[0])){let s={};if(e.forEach((h,o)=>{s[o]=h}),e=s,isNaN(e[0][0]))return}else if(t3){if(e={[t3]:e},isNaN(e[t3][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let s in e)if(typeof e[s]=="number"?e[s]=[e[s]]:e[s]?.values&&typeof e[s].values=="number"&&(e[s].values=[e[s].values]),isNaN(e[s][0]))return}else if(typeof e=="string"){let s;if(e.includes(`\\r\n`)){let h=e.split(`\\r\n`);e={},h.forEach((o,a)=>{o.includes("	")?s=o.split("	"):o.includes(",")?s=o.split(","):o.includes("|")&&(s=o.split("|")),s&&s.forEach((r,n)=>{if(r.includes(":")){let[l,i3]=r.split(":"),u3=parseFloat(i3);isNaN(u3)||(e[l]=[u3])}else{let l=parseFloat(r);isNaN(l)||(e[n]=[l])}})})}else e.includes("	")?s=e.split("	"):e.includes(",")?s=e.split(","):e.includes("|")&&(s=e.split("|"));e={},s&&s.forEach((h,o)=>{if(h.includes(":")){let[a,r]=h.split(":"),n=parseFloat(r);isNaN(n)||(e[a]=[n])}else{let a=parseFloat(h);isNaN(a)||(e[o]=[a])}})}else typeof e=="number"&&(t3?e={[t3]:[e]}:e={0:[e]});return e}static padTime(e,t3,s,h){let o=(e[0]-t3)/s/h;return[...new Array(h-e.length).map((r,n)=>t3+o*(n+1)),...e]}static interpolateForTime(e,t3,s){return y2.interpolate(e,Math.ceil(s*t3))}};var webglPlotRoutes={setupChart:function setupChart(settings){console.log("initializing chart",settings);if(!this?.__node?.graph?.plotter){this.__node.graph.plotter=new y2;return this.__node.graph.plotter.initPlot(settings).settings._id}else{globalThis.plotter=new y2;return globalThis.plotter.initPlot(settings).settings._id}},updateChartData:function updateChartData(plot,lines,draw=true){if(typeof lines==="object"){if(globalThis.plotter)globalThis.plotter.update(plot,lines,draw);else if(this?.__node?.graph?.plotter)this.__node.graph.plotter.update(plot,lines,draw);return true}return false},clearChart:function clearChart(plot){if(globalThis.plotter)globalThis.plotter.deinitPlot(plot);else if(this?.__node?.graph?.plotter)this.__node.graph.plotter.deinitPlot(plot);return true},resetChart:function resetChart(plot,settings){if(globalThis.plotter)globalThis.plotter.reinitPlot(plot,settings);else if(this?.__node?.graph?.plotter)this.__node.graph.plotter.reinitPlot(plot,settings);return settings._id},getChartSettings:function getChartSettings(plotId){let settings;if(globalThis.plotter)settings=globalThis.plotter.getChartSettings(plotId);else if(this?.__node?.graph?.plotter)settings=this.__node.graph.plotter.getChartSettings(plotId);return settings}};var __defProp22=Object.defineProperty;var __defNormalProp=(obj,key,value)=>key in obj?__defProp22(obj,key,{enumerable:true,configurable:true,writable:true,value}):obj[key]=value;var __publicField=(obj,key,value)=>{__defNormalProp(obj,typeof key!=="symbol"?key+"":key,value);return value};var _Math2=class{constructor(){}static genSineWave(freq=20,peakAmp=1,nSec=1,fs3=512,freq2=0,peakAmp2=1){var sineWave=[];var t3=[];var increment=1/fs3;for(var ti=0;ti<nSec;ti+=increment){var amplitude=Math.sin(2*Math.PI*freq*ti)*peakAmp;amplitude+=Math.sin(2*Math.PI*freq2*ti)*peakAmp2;sineWave.push(amplitude);t3.push(ti)}return[t3,sineWave]}static getSineAmplitude(frequency=20,peakAmplitude=1,ti=0,tOffset=0){return Math.sin(this.TWO_PI*frequency*ti+tOffset)*peakAmplitude}static mean(arr){var sum=arr.reduce((prev,curr)=>curr+=prev);return sum/arr.length}static mode(arr){return arr.sort((a,b)=>arr.filter(v2=>v2===a).length-arr.filter(v2=>v2===b).length).pop()}static std(arr,mean=void 0){let avg=mean;if(!mean)avg=this.mean(arr);let summed=0;for(let i3=0;i3<arr.length;i3++){let subbed=arr[i3]-avg;summed+=subbed*subbed}return Math.sqrt(summed/arr.length)}static relError(actual=[],forecast=[],abs=true){if(actual.length!==forecast.length)throw new Error("Input arrays of same length!");let i3=actual.length;let d2=new Array(actual.length);for(let j=0;j<i3;j++){let dd=(actual[j]-forecast[j])/actual[j];if(abs)dd=Math.abs(dd);d2[j]=dd}return d2}static informationEntropy(probabilities=[]){let len=probabilities.length;let entropy=new Array(len);for(let i3=0;i3<len;i3++){let ent=probabilities[i3]*Math.log(probabilities[i3]);if(isNaN(ent))ent=0;entropy[i3]=ent}return entropy}static zscore(arr){let mean=this.mean(arr);let std=this.std(arr,mean);let z3=new Array().length(arr.length);for(let i3=0;i3<arr.length;i3++){z3[i3]=(arr[i3]-mean)/std}return z3}static variance(arr){var mean=this.mean(arr);return arr.reduce((a,b)=>a+(b-mean)**2,0)/arr.length}static dot(vec1,vec2){var dot=0;for(var i3=0;i3<vec1.length;i3++){dot+=vec1[i3]*vec2[i3]}return dot}static cross3D(vec1,vec2){return[vec1[1]*vec2[2]-vec1[2]*vec2[1],vec1[2]*vec2[0]-vec1[0]*vec2[2],vec1[0]*vec2[1]-vec1[1]*vec2[0]]}static magnitude(vec){var sqrd=0;vec.forEach(c=>{sqrd+=c*c});return Math.sqrt(sqrd)}static distance(point1,point2){var dsqrd=0;point1.forEach((c,i3)=>{dsqrd+=(point2[i3]-c)*(point2[i3]-c)});return Math.sqrt(dsqrd)}static midpoint(point1=[1,2,3],point2=[3,4,5]){return point1.map((c,i3)=>{return(c+point2[i3])*.5})}static normalize(vec){var norm=0;norm=this.magnitude(vec);var vecn=new Array(vec.length);vec.forEach((c,i3)=>{vecn[i3]=c*norm});return vecn}static normalizeSeries(arr=[],fromZero=true){let max=Math.max(...arr);let min=Math.min(...arr);if(fromZero==false){max=Math.max(max,Math.abs(min));min=0}if(max-min===0){min=0;if(max===0)max=1e-13}return arr.map(v2=>(v2-min)/(max-min))}static quadraticFormula(a,b,c){let bbmac4=Math.sqrt(b*b-4*a*c);if(!isNaN(bbmac4))return["complex","complex"];let _a2=1/(2*a);if(bbmac4===0)return[b*_a2];let nb=-b;return[(nb+bbmac4)*_a2,(nb-bbmac4)*_a2]}static newtonsMethod(foo=x22=>{return Math.pow(x22,5)+x22*x22-x22-.2},start=0,end=1,precision=.01,attempts=10){let roots=[];for(let i3=0;i3<attempts;i3++){let seedx=Math.random()*(end-start);let guess=foo(seedx);let guess2=foo(seedx+precision);let slope=(guess2-guess)/precision;let xn=seedx+precision;while(Math.abs(slope)>precision){let step=-guess/slope2;let xn12=xn+step;guess=guess2;guess2=foo(xn12);let slope2=(guess2-guess)/(xn12-xn)}let idx;let f=roots.find((root,i22)=>{if(Math.abs(xn1-root)<precision){idx=i22;return true}});if(f)roots[idx]=(xn1+f)*.5;else roots.push(xn1)}return roots}static makeVec(point1,point2){var vec=[];point1.forEach((c,i3)=>{vec.push(point2[i3]-c)});return vec}static getBufferedValueByCoordinates(vb=new Array(300).fill(1),dims=[10,10,2],coordinate=[1,2,1],cardinal=void 0){let getIdx=(foundIdx=0,dimIdx=0)=>{if(dimIdx===dims.length)return foundIdx;if(dimIdx==0)foundIdx+=coordinate[dimIdx];else if(dims[dimIdx]==0)dimsAt0++;else{let reMul=(val=coordinate[dimIdx],di=dimIdx-1)=>{val*=dims[di];di--;if(di==0)return val;else return reMul(val,di)};foundIdx+=reMul(coordinate[dimIdx]+1,dimIdx-1)}dimIdx++;return getIdx(foundIdx,dimIdx)};let found=getIdx();if(cardinal){if(coordinate[coordinate.length-1]===0){let lastnonzero=0;let idx=0;while(idx!==coordinate.length-1){if(coordinate[idx]!==0)lastnonzero=idx;idx++}return vb[found-lastnonzero+cardinal]}return vb[found-dims.length+cardinal]}else{if(coordinate[coordinate.length-1]===0){let lastnonzero=0;let idx=0;while(idx!==coordinate.length-1){if(coordinate[idx]!==0)lastnonzero=idx;idx++}return vb.slice(found-lastnonzero,found+1)}return vb.slice(found-dims.length,found+1)}}static forBufferedMat(vb=new Array(100).fill(1),dims=[10,10],asIndex=(v2,i3,x22,y22)=>{return v2+x22+y22}){let coordinate=[];let idx=0;let recurseFor=(depth=0,nextDepth=depth+1)=>{let result=new Array(vb.length);for(let di=0;di<dims[depth];di++){coordinate[depth]=di;if(dims[nextDepth])recurseFor(nextDepth);else{result[idx]=asIndex(vb[idx],idx,...coordinate);idx++}}return result};let recurseForArrFuncs=(depth,nextDepth=depth+1)=>{let result=new Array(vb.length);for(let di=0;di<dims[depth];di++){coordinate[depth]=di;if(dims[nextDepth])recurseFor(nextDepth);else{for(let dj=0;dj<dims.length;dj++){result[idx]=asIndex[dj](vb[idx],idx,...coordinate);idx++}}}return result};if(typeof asIndex==="function"){return recurseFor()}else if(Array.isArray(asIndex)){return recurseForArrFuncs()}}static mapBufferedMat(buffer=new Array(100).fill(1),dimensions=[10,10],asIndex=(v2,idx,i3,j)=>{console.log(`value:${v2}, idx:${idx}, x:${i3},y:${j}`);return v2+i3+j}){let coordinate=new Array(dimensions.length).fill(0);const iterateCoordinate=(coord,idx=0)=>{if(coord[idx]>=dimensions[idx]){coord[idx]=0;idx++;if(idx===dimensions.length)return;iterateCoordinate(coord,idx)}else coord[idx]++};let result=new Array(buffer.length);let i3=0;if(typeof asIndex==="function"){while(i3<buffer.length){result[i3]=asIndex(buffer[i3],i3,...coordinate);i3+=dimensions.length;iterateCoordinate(coordinate)}}else if(Array.isArray(asIndex)){while(i3<buffer.length){asIndex.forEach(func=>{result[i3]=func(buffer[i3],i3,...coordinate);i3++;iterateCoordinate(coordinate)})}}return result}static combinations(choices=["a","b","c"],vecsize=3){var result=[];if(vecsize<=0){result.push([])}else{_Math2.combinations(choices,vecsize-1).forEach(function(previousComb){choices.forEach(function(element){result.push([element].concat(previousComb))})})}return result}static generateCoordinateSpace(upperBounds=[10,10,10],lowerBounds=[-10,-10,-10],steps=[1,1,1],mutater=void 0){for(let i3=0;i3<upperBounds.length;i3++){if(lowerBounds[i3]>upperBounds[i3]){let temp=upperBounds[i3];upperBounds[i3]=lowerBounds[i3];lowerBounds[i3]=temp}}let result=[];let copy=[...upperBounds];let lastindex=copy.length-1;result.push([...copy]);while(copy[0]>=lowerBounds[0]){let checkNextIndex=decrIdx2=>{if(copy[decrIdx2]<=lowerBounds[decrIdx2]){if(decrIdx2===0)return;copy[decrIdx2]=upperBounds[decrIdx2];decrIdx2--;if(decrIdx2<0)return;if(typeof steps[decrIdx2]=="function")copy[decrIdx2]-=steps[decrIdx2](copy[decrIdx2]);else copy[decrIdx2]-=steps[decrIdx2];checkNextIndex(decrIdx2)}};let decrIdx=lastindex;if(typeof steps[decrIdx]=="function")copy[decrIdx]-=steps[decrIdx](copy[decrIdx]);else copy[decrIdx]-=steps[decrIdx];result.push([...copy]);checkNextIndex(decrIdx);if(mutater)result[result.length-1]=mutater(result[result.length-1])}return result}static calcVectorField(coordinates=[[0,0],[0,1],[1,0],[1,1]],formula=(x22,y22)=>{return[x22*10,y22*10]}){return coordinates.map(vec=>formula(...vec))}static transpose(mat){return mat[0].map((_,colIndex)=>mat.map(row=>row[colIndex]))}static matmul(a,b){var aNumRows=a.length,aNumCols=a[0].length,bNumRows=b.length,bNumCols=b[0].length,m=new Array(aNumRows);for(var r=0;r<aNumRows;++r){m[r]=new Array(bNumCols);for(var c=0;c<bNumCols;++c){m[r][c]=0;for(var i3=0;i3<aNumCols;++i3){m[r][c]+=a[r][i3]*b[i3][c]}}}return m}static matscale(mat,scalar){let m=[];for(var i3=0;i3<mat.length;i3++){m[i3]=[];for(let j=0;j<mat[0].length;j++){m[i3][j]=mat[i3][j]*scalar}}return m}static matadd(a,b){let m=[];for(let i3=0;i3<a.length;i3++){m[i3]=[];for(var j=0;j<a[0].length;j++){m[i3][j]=a[i3][j]+b[i3][j]}}return m}static matsub(a,b){let m=[];for(let i3=0;i3<a.length;i3++){m[i3]=[];for(var j=0;j<a[0].length;j++){m[i3][j]=a[i3][j]-b[i3][j]}}return m}static histogram(arr=[],binSize=1,nBins=void 0){let copy=[...arr];copy.sort(function(a,b){return a-b});let binStart=Math.min(...copy);if(typeof nBins==="number"){let binEnd=Math.max(...copy);binSize=Math.abs((binEnd-binStart)/(nBins-1))}let j=binStart;let binx=[];let biny=[];for(let i3=0;i3<copy.length;i3++){let binidx=binSize*j;if(copy[i3]>binStart+binidx){j++;binidx+=binSize;let binmin=binStart+binidx;let binmid=binmin+binidx*.5;binx.push(binmid);biny.push(0)}biny[biny.length-1]++}return[binx,biny]}static normalDistribution(samples=[],normalize=true,cutoff=1e-4){let m=this.mean(samples);let vari=this.variance(samples);let nSamples=samples.length;let probabilities=[];let denom=1/(this.TWO_PI*vari);let _variance=1/vari;let sum=0;for(let i3=0;i3<nSamples;i3++){let px=Math.exp(-.5*Math.pow((samples[i3]-m)*_variance,2))*denom;if(px<cutoff)px=0;probabilities.push(px);sum+=px}if(normalize){let _sum=1/sum;probabilities=probabilities.map(x22=>x22*_sum)}return probabilities}static expectedValue(samples=[],probabilities=this.normalDistribution(samples)){return samples.reduce((sum,item,idx)=>sum+item*probabilities[idx])}static originMoment(samples=[],probabilities=this.normalDistribution(samples),order=1){return samples.reduce((sum,item,idx)=>sum+Math.pow(item,order)*probabilities[idx])}static centralMoment(samples=[],probabilities=this.normalDistribution(samples),order=1){let m=this.mean(samples);return samples.reduce((sum,item,idx)=>sum+Math.pow(item-m,order)*probabilities[idx]/samples.length)}static linearDiscriminantAnalysis(samples=[],classifier=[]){let mean=this.mean(samples);let meank=this.mean(classifier);let covariance=this.cov1d(samples,classifier);let probs=this.normalDistribution(samples);let dk=[];for(let i3=0;i3<samples.length;i3++){dk.push(x[i3]*covariance*meank-.5*mean*covariance*meank+Math.log10(probs[i3]))}return dk}static conv1D(arr=[],kern=[1/3,1/3,1/3],pad=Math.floor(kern.length*.5)){let result=[];let _n=1/kern.length;if(pad>0){let pads=new Array(pad).fill(0);arr=[...pads,...arr,...pads]}let start=Math.floor(kern.length*.5);let end=arr.length-kern.length+start;for(let i3=start;i3<end;i3++){let acc=0;for(let j=0;j<kern.length;j++){acc+=arr[i3-start]*kern[j]}result.push(acc*_n)}return result}static conv2D(mat=[[],[],[]],kern=[[],[],[]],pad=0){let result=new Array(mat.length-Math.ceil(kern.length*.5)).fill([]);let mat_t;let kern_t=_Math2.transpose(kern_t);if(pad>0){let pads=new Array(pad).fill(0);mat_t=_Math2.transpose(mat);for(let i22=0;i22<mat_t.length;i22++){mat_t[i22]=[...pads,...mat_t[i22],...pads]}mat=_Math2.transpose(mat_t);for(let j=0;j<mat.length;j++){mat[j]=[...pads,...mat[j],...pads]}}let startr=Math.floor(kern[0].length*.5);let startl=Math.floor(kern_t[0].length*.5);let endr=mat[0].length-kern[0].length+startr;let endl=mat_t[0].length-kern_t[0].length+startl;let _n=1/(kern[0].length*kern_t[0].length);let iters=endr*endl;let i3=startr;let x22;let y22=startl;while(i3<iters){let acc=0;x22=i3%mat[0].length;if(x22===0){y22++}for(let j=0;j<kern[0].length;j++){for(let k=0;k<kern_t[0].length;j++){acc+=mat[y22-startl+k][x22-startr+j]*kern[k][j]}result[y22].push(acc*_n)}i3++}return result}static cov2d(mat){var mattransposed=this.transpose(mat);var matproducts=[];var rowmeans=[];var colmeans=[];mat.forEach((row,idx)=>{rowmeans.push(this.mean(row))});mattransposed.forEach((col,idx)=>{colmeans.push(this.mean(col))});mat.forEach((row,idx)=>{matproducts.push([]);for(var col=0;col<row.length;col++){matproducts[idx].push((mat[idx][col]-rowmeans[idx])*(mat[idx][col]-colmeans[col])/(row.length-1))}});var matproductstransposed=this.transpose(matproducts);var aNumRows=matproducts.length,aNumCols=matproducts[0].length,bNumRows=matproductstransposed.length,bNumCols=matproductstransposed[0].length,m=new Array(aNumRows);for(var r=0;r<aNumRows;++r){m[r]=new Array(bNumCols);for(var c=0;c<bNumCols;++c){m[r][c]=0;for(var i3=0;i3<aNumCols;++i3){m[r][c]+=matproducts[r][i3]*matproductstransposed[i3][c]/(mat[0].length-1)}}}return m}static cov1d(arr1=[],arr2=[]){return this.cov2d([arr1,arr2])}static cov3d(x22=[],y22=[],z3=[]){return[[this.cov1d(x22,x22),this.cov1d(x22,y22),this.cov1d(x22,z3)],[this.cov1d(y22,x22),this.cov1d(y22,y22),this.cov1d(y22,z3)],[this.cov1d(z3,x22),this.cov1d(z3,y22),this.cov1d(z3,z3)]]}static covNd(dimensionalData=[]){let covariance=[];dimensionalData.forEach((arr,i3)=>{covariance.push([]);dimensionalData.forEach((arr2,j)=>{covariance[i3].push(this.cov1d(arr,arr2))})})}static eigens2x2(mat=[[1,2],[3,4]]){let det=mat[0][0]*mat[1][1]-mat[0][1]*mat[1][0];let mean=(mat[0][0]+mat[1][1])*.5;let sqrt=Math.sqrt(mean*mean-det);let eig1=mean+sqrt;let eig2=mean-sqrt;return[eig1,eig2]}static eigenvectors2x2(mat=[[1,2],[3,4]],eigens=[1,2]){let v1=[-mat[0][1],mat[0][0]-eigens[0]];if(v1[0]===0&&v1[1]===0){v1[0]=mat[1][1]-eigens[0];v1[1]=-mat[1][0]}let v2=[-mat[0][1],mat[0][0]-eigens[1]];if(v2[0]===0&&v2[1]===0){v2[0]=mat[1][1]-eigens[1];v2[1]=-mat[1][0]}return[v1,v2]}static fastpca2d(xarr,yarr){let cov1d=this.cov1d(xarr,yarr);let eigs=this.eigens2x2(cov1d);if(eigs[1]>eigs[0])eigs.reverse();let evs=this.eigenvectors2x2(cov1d,eigs);console.log(eigs,evs);return[eigs,evs]}static crosscorrelation(arr1,arr2){var arr2buf=[...arr2,...Array(arr2.length).fill(0)];var mean1=this.mean(arr1);var mean2=this.mean(arr2);var arr1Est=arr1.reduce((sum,item)=>sum+=Math.pow(item-mean1,2));arr1Est=Math.sqrt(Math.abs(arr1Est));var arr2Est2=arr2.reduce((sum,item)=>sum+=Math.pow(item-mean1,2));arr2Est2=Math.sqrt(Math.abs(arr2Est2));let denom=arr1Est*arr2Est2;if(denom===0)denom=1e-26;var _arrEstsMul=1/denom;var correlations=new Array(arr1.length).fill(0);for(var delay=0;delay<arr1.length;delay++){var r=arr1.reduce((sum,item,i3)=>sum+=(item-mean1)*(arr2buf[delay+i3]-mean2));correlations[delay]=r*_arrEstsMul}return correlations}static autocorrelation(arr1){var delaybuf=[...arr1,...Array(arr1.length).fill(0)];var mean1=this.mean(arr1);var arr1Est=arr1.reduce((sum,item)=>sum+=Math.pow(item-mean1,2));arr1Est=Math.sqrt(Math.abs(arr1Est));let denom=arr1Est*arr2Est;if(denom===0)denom=1e-26;var _arr1estsqrd=1/denom;var correlations=new Array(arr1.length).fill(0);for(var delay=0;delay<arr1.length;delay++){var r=arr1.reduce((sum,item,i3)=>sum+=(item-mean1)*(delaybuf[delay+i3]-mean1));correlations[delay]=r*_arr1estsqrd}return correlations}static autocorrelation2dNormalized(mat2d2){let result=[];for(let y22=0;y22<mat2d2.length;y22++){result.push([]);for(let x22=0;x22<mat2d2[y22].length;x22++){let G3=0;let _G=0;for(let b=0;b<mat2d2.length;b++){for(let a=0;a<mat2d2[b].length;a++){G3+=mat2d2[y22][x22]*mat2d2[mat2d2.length-1-b][mat2d2[y22].length-1-a];_G+=mat2d2[y22][x22]*mat2d2[mat2d2.length-1][mat2d2[y22].length-1]}}result[y22][x22]=G3/_G-1}}return result}static crosscorrelation2d(mat2d1,mat2d2){let result=[];for(let y22=0;y22<mat2d1.length;y22++){result.push([]);for(let x22=0;x22<mat2d1[y22].length;x22++){let G3=0;for(let b=0;b<mat2d2.length;b++){for(let a=0;a<mat2d2[b].length;a++){G3+=mat2d1[y22][x22]*mat2d2[mat2d2.length-1-b][mat2d2[y22].length-1-a]}}result[y22][x22]=G3}}return result}static crosscorrelation2dNormalized(mat2d1,mat2d2){let result=[];for(let y22=0;y22<mat2d1.length;y22++){result.push([]);for(let x22=0;x22<mat2d1[y22].length;x22++){let G3=0;let _G=0;for(let b=0;b<mat2d2.length;b++){for(let a=0;a<mat2d2[b].length;a++){G3+=mat2d1[y22][x22]*mat2d2[mat2d.length-1-b][mat2d2[y22].length-1-a];_G+=mat2d1[y22][x22]*mat2d2[mat2d2.length-1][mat2d2[y22].length-1]}}result[y22][x22]=G3/_G-1}}return result}static correlograms(dat=[[],[]]){var correlograms=[];dat.forEach((row1,i3)=>{dat.forEach((row2,j)=>{if(j>=i3){correlograms.push(_Math2.crosscorrelation(row1,row2))}})});return correlograms}static dft(sineWave=[]){var TWOPI=2*3.141592653589793;var real=[];var imag=[];var mags=[];for(var k=0;k<sineWave.length;k++){real.push(0);imag.push(0);for(var j=0;j<sineWave.length;j++){var shared=TWOPI*k*j/sineWave.length;real[k]=real[k]+sineWave[j]*Math.cos(shared);imag[k]=imag[k]-sineWave[j]*Math.sin(shared)}mags.push(Math.sqrt(real[k]*real[k]+imag[k]*imag[k]))}function orderMagnitudes(unorderedMags){return[...unorderedMags.slice(Math.ceil(unorderedMags.length*.5),unorderedMags.length),...unorderedMags.slice(0,Math.ceil(unorderedMags.length*.5))]}mags=orderMagnitudes(mags);let halflen=mags.length*.5;let freqs=mags.map((m,i3)=>{return i3-halflen});return{real,imag,freqs,mags}}static sma(arr=[],window2){var smaArr=[];for(var i3=0;i3<arr.length;i3++){if(i3==0){smaArr.push(arr[0])}else if(i3<window2){var arrslice=arr.slice(0,i3+1);smaArr.push(arrslice.reduce((previous,current)=>current+=previous)/(i3+1))}else{var arrslice=arr.slice(i3-window2,i3);smaArr.push(arrslice.reduce((previous,current)=>current+=previous)/window2)}}return smaArr}static sum(arr=[]){if(arr.length>0){var sum=arr.reduce((prev,curr)=>curr+=prev);return sum}else{return 0}}static reduceArrByFactor(arr,factor=2){let x22=arr.filter((element,index)=>{return index%factor===0});return x22}static makeArr(startValue,stopValue,nSteps){var arr=[];var step=(stopValue-startValue)/(nSteps-1);for(var i3=0;i3<nSteps;i3++){arr.push(startValue+step*i3)}return arr}static autoscale(array,stackedLines=1,stackPosition=0,centerZero=false){if(array?.length===0)return array;let max=Math.max(...array);let min=Math.min(...array);let _lines=1/stackedLines;let scalar;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));scalar=_lines/absmax;return array.map(y22=>y22*scalar+(_lines*(stackPosition+1)*2-1-_lines))}else{scalar=_lines/(max-min);return array.map(y22=>2*((y22-min)*scalar-1/(2*stackedLines))+(_lines*(stackPosition+1)*2-1-_lines))}}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i3=incr;i3<array.length;i3+=incr){let rounded=Math.round(i3);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static interpolateArray(data,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array;var springFactor=(data.length-1)/(fitCount-1);newData[0]=data[0];for(var i3=1;i3<fitCount-1;i3++){var tmp=i3*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i3]=linearInterpolate(data[before],data[after],atPoint)}newData[fitCount-1]=data[data.length-1];return newData}static isExtrema(arr,critical="peak"){let ref=[...arr];if(ref.length%2===0)ref.pop();if(arr.length>1){let pass=true;for(let i3=0;i3<ref.length;i3++){let val=ref[i3];if(critical==="peak"){if(i3<Math.floor(ref.length*.5)&&val>=ref[Math.floor(ref.length*.5)]){pass=false;break}else if(i3>Math.floor(ref.length*.5)&&val>=ref[Math.floor(ref.length*.5)]){pass=false;break}}else if(critical==="valley"){if(i3<Math.floor(ref.length*.5)&&val<=ref[Math.floor(ref.length*.5)]){pass=false;break}else if(i3>Math.floor(ref.length*.5)&&val<=ref[Math.floor(ref.length*.5)]){pass=false;break}}else{if(i3<Math.floor(ref.length*.5)&&val<=ref[Math.floor(ref.length*.5)]){pass=false;break}else if(i3>Math.floor(ref.length*.5)&&val<=ref[Math.floor(ref.length*.5)]){pass=false;break}}}if(critical!=="peak"&&critical!=="valley"&&pass===false){pass=true;for(let i3=0;i3<ref.length;i3++){let val=ref[i3];if(i3<Math.floor(ref.length*.5)&&val>=ref[Math.floor(ref.length*.5)]){pass=false;break}else if(i3>Math.floor(ref.length*.5)&&val>=ref[Math.floor(ref.length*.5)]){pass=false;break}}}return pass}else return void 0}static isCriticalPoint(arr,critical="peak"){let ref=[...arr];if(ref.length%2===0)ref.pop();if(arr.length>1){let pass=true;for(let i3=0;i3<ref.length;i3++){let val=ref[i3];if(critical==="peak"){if(i3<ref.length*.5&&val<=0){pass=false;break}else if(i3>ref.length*.5&&val>0){pass=false;break}}else if(critical==="valley"){if(i3<ref.length*.5&&val>=0){pass=false;break}else if(i3>ref.length*.5&&val<0){pass=false;break}}else{if(i3<ref.length*.5&&val>=0){pass=false;break}else if(i3>ref.length*.5&&val<0){pass=false;break}}}if(critical!=="peak"&&critical!=="valley"&&pass===false){pass=true;for(let i3=0;i3<ref.length;i3++){let val=ref[i3];if(i3<ref.length*.5&&val<=0){pass=false;break}else if(i3>ref.length*.5&&val>0){pass=false;break}}}return pass}else return void 0}static getPeakThreshold(arr,peakIndices,thresholdVar){let threshold;let filtered=arr.filter((o,i3)=>{if(peakIndices.indexOf(i3)>-1)return true});if(thresholdVar===0){threshold=this.mean(filtered)}else threshold=(thresholdVar+this.mean(filtered))*.5;return threshold}static column(mat,x22){let col=new Array(mat.length).fill(0).map(()=>new Array(1).fill(0));for(let i3=0;i3<mat.length;i3++){col[i3][0]=mat[i3][x22]}return col}static flatten_vector(v2){let v_new=[];for(let i3=0;i3<v2.length;i3++){v_new[i3]=v2[i3][0]}return v_new}static squared_difference(v1,v2){let sum=0;for(let i3=0;i3<v1.length;i3++){sum=sum+Math.pow(v1[i3]-v2[i3],2)}return sum}static shift_deflate(mat,eigenvalue,eigenvector){let len=Math.sqrt(this.matmul(this.transpose(eigenvector),eigenvector));let U=this.matscale(eigenvector,1/len);let delta=this.matscale(this.matmul(U,this.transpose(U)),eigenvalue);let M_new=this.matsub(mat,delta);return M_new}static eigenvalue_of_vector(mat,eigenvector){ev=this.matmul(this.matmul(this.transpose(eigenvector),mat),eigenvector);return ev}static power_iteration(mat,tolerance=1e-5,max_iterations=1e3){let rank=mat.length;let eigenvector=new Array(rank).fill(0).map(()=>new Array(1).fill(Math.sqrt(rank)));let eigenvalue=this.eigenvalue_of_vector(mat,eigenvector);let epsilon=1;let iter=0;while(epsilon>tolerance&&iter<max_iterations){let old_eigenvalue=JSON.parse(JSON.stringify(eigenvalue));let Mv=this.matmul(mat,eigenvector);eigenvector=this.normalize(Mv);eigenvalue=this.eigenvalue_of_vector(mat,eigenvector);epsilon=Math.abs(eigenvalue-old_eigenvalue);iter++};return[eigenvalue,eigenvector]}static eigens(mat,tolerance=1e-4,max_iterations=1e3){let eigenvalues=[];let eigenvectors=[];for(let i3=0;i3<mat.length;i3++){let result=this.power_iteration(mat,tolerance,max_iterations);let eigenvalue=result[0];let eigenvector=result[1];eigenvalues[i3]=eigenvalue;eigenvectors[i3]=this.flatten_vector(eigenvector);mat=this.shift_deflate(mat,eigenvalue,eigenvector)}return[eigenvalues,eigenvectors]}static pca(mat,tolerance=1e-5){let dims=mat.length;let t3=new Array(dims);let p2=new Array(dims);let mat_t=this.transpose(mat);t3[0]=this.column(mat,0);let epsilon=1;let iter=0;while(espilon>tolerance){iter++;p2[0]=this.matmul(mat_t,t3[0]);let tp=this.matmul(this.transpose(t3[0]),t3[0]);p2[0]=this.matscale(p2[0],1/tp);let p_length=Math.sqrt(this.matmul(this.transpose(p2[0]),p2[0]));p2[0]=this.matscale(p2[0],1/p_length);let t_new=this.matmul(mat,p2[0]);let pp=this.matmul(this.transpose(p2[0]),p2[0]);t_new=this.matscale(t_new,1/pp);epsilon=this.squared_difference(t3[0],t_new);t3[0]=JSON.parse(JSON.stringify(t_new))}let components=this.matmul(this.transpose(t3[0]),t3[0]);return components}static circularBuffer(arr,newEntries){if(Array.isArray(newEntries)){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}}else{arr.push(newEntries);arr.shift()}return arr}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x22=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x22;b=0}else if(60<=h&&h<120){r=x22;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x22}else if(180<=h&&h<240){r=0;g=x22;b=c}else if(240<=h&&h<300){r=x22;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x22}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static p300(event_timestamps=[],raw_signal=[],signal_timestamps=[],sps10=256){let smoothingstep=Math.floor(sps10/10);let smoothed=this.sma(raw_signal,smoothingstep);let peaks=this.peakDetect(smoothed,"peak",smoothingstep);let mean=this.mean(smoothed);let std=this.std(smoothed,mean);let p_idx=0;let candidates=[];if(peaks.length>0){event_timestamps.forEach((t3,j)=>{while(signal_timestamps[peaks[p_idx]]<t3+200){p_idx++;if(!peaks[p_idx])break}let tempi=0;let tempcandidates=[];while(signal_timestamps[peaks[p_idx+tempi]]<t3+600){tempcandidates.push(p_idx+tempi);tempi++;if(!peaks[p_idx+tempi])break}if(tempcandidates.length>1){let peakvals=[];tempcandidates.forEach(tc=>{peakvals.push(smoothed[peaks[tc]])});let max=Math.max(...peakvals);let maxi=tempcandidates[peakvals.indexOf(max)];candidates.push({event_timestamp:t3,event_index:j,peak_timestamp:signal_timestamps[[peaks[maxi]]],signal_index:[peaks[maxi]],signal_amplitude:raw_signal[[peaks[maxi]]],zscore:(smoothed[peaks[maxi]]-mean)/std})}else if(tempcandidates.length===1)candidates.push({event_timestamp:t3,event_index:j,peak_timestamp:signal_timestamps[peaks[tempcandidates[0]]],signal_index:peaks[tempcandidates[0]],signal_amplitude:raw_signal[[peaks[tempcandidates[0]]]],zscore:(smoothed[peaks[tempcandidates[0]]]-mean)/std})})}return candidates}};var Math2=_Math2;__publicField(Math2,"TWO_PI",Math.PI*2);__publicField(Math2,"C",299792458);__publicField(Math2,"G",66743e-15);__publicField(Math2,"h",662607015e-42);__publicField(Math2,"R",8314.32);__publicField(Math2,"Ra",287);__publicField(Math2,"H",69.3);__publicField(Math2,"kbar",1054571817e-43);__publicField(Math2,"kB",1380649e-29);__publicField(Math2,"ke",89875517923e-1);__publicField(Math2,"me",91093837015e-41);__publicField(Math2,"mp",167262192369e-38);__publicField(Math2,"mn",167492749804e-38);__publicField(Math2,"P0",101325);__publicField(Math2,"T0",288.15);__publicField(Math2,"p0",1.225);__publicField(Math2,"Na",60220978e16);__publicField(Math2,"y",1.405);__publicField(Math2,"M0",28.96643);__publicField(Math2,"g0",9.80665);__publicField(Math2,"Re",6378100);__publicField(Math2,"B",1458e-9);__publicField(Math2,"S",110.4);__publicField(Math2,"Sigma",365e-12);__publicField(Math2,"imgkernels",{edgeDetection:[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]],boxBlur:[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]],sobelLeft:[[1,0,-1],[2,0,-2],[1,0,-1]],sobelRight:[[-1,0,1],[-2,0,2],[-1,0,1]],sobelTop:[[1,2,1],[0,0,0],[-1,-2,-1]],sobelBottom:[[-1,2,1],[0,0,0],[1,2,1]],identity:[[0,0,0],[0,1,0],[0,0,0]],gaussian3x3:[[1,2,1],[2,4,2],[1,2,1]],guassian7x7:[[0,0,0,5,0,0,0],[0,5,18,32,18,5,0],[0,18,64,100,64,18,0],[5,32,100,100,100,32,5],[0,18,64,100,64,18,0],[0,5,18,32,18,5,0],[0,0,0,5,0,0,0]],emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],sharpen:[[0,-1,0],[-1,5,-1],[0,-1,0]]});__publicField(Math2,"integral",(func=x22=>{let y22=x22;return y22},range=[],stepx=.01)=>{let area=0;for(let i3=range[0];i3<range[1];i3+=stepx){let y22=func(i3);area+=y22*stepx}return area});__publicField(Math2,"dintegral",(func=(x22,y22)=>{let z3=x22+y22;return z3},range=[[],[]],stepx=.01,stepy=stepx)=>{let volume=0;for(let i3=range[0][0]+stepx;i3<range[0][1];i3+=stepx){for(let j=range[1][0]+stepy;j<range[1][1];j+=stepy){let z3=func(i3,j);volume+=z3*stepx*stepy}}return volume});__publicField(Math2,"tintegral",(func=(x22,y22,z3)=>{let w=x22+y22+z3;return w},range=[[],[],[]],stepx=.01,stepy=stepx,stepz=stepx)=>{let volume=0;for(let i3=range[0][0]+stepx;i3<range[0][1];i3+=stepx){for(let j=range[1][0]+stepy;j<range[1][1];j+=stepy){for(let k=range[2][0]+stepz;k<range[2][1];k+=stepz){let w=func(i3,j,k);volume+=w*stepx*stepy*stepz}}}return volume});__publicField(Math2,"pintegral",(func=x22=>{let y22=x22;return y22},range=[],stepx=.01)=>{let length=0;let y0=void 0;let yi=void 0;for(let i3=range[0];i3<range[1];i3+=stepx){y0=yi;yi=func(i3);if(y0)length+=_Math2.distance([0,y0],[stepx,yi])}return length});__publicField(Math2,"meshgrid",_Math2.generateCoordinateSpace);__publicField(Math2,"autocorrelation2d",mat2d2=>{let result=[];for(let y22=0;y22<mat2d2.length;y22++){result.push([]);for(let x22=0;x22<mat2d2[y22].length;x22++){let G3=0;for(let b=0;b<mat2d2.length;b++){for(let a=0;a<mat2d2[b].length;a++){G3+=mat2d2[y22][x22]*mat2d2[mat2d2.length-1-b][mat2d2[y22].length-1-a]}}result[y22][x22]=G3}}return result});__publicField(Math2,"lerp",_Math2.makeArr);__publicField(Math2,"upsample",_Math2.interpolateArray);__publicField(Math2,"lerp",(v0,v1,fit,floor=true)=>{function lerp2(v02,v12,t3){return(1-t3)*v02+t3*v12}function interpolerp2(v02,v12,fit2,floor2=true){if(fit2<=2)return[v02,v12];let a=1/fit2;let result=new Array(fit2);result[0]=v02;for(let i3=1;i3<=fit2;i3++){result[i3]=lerp2(v02,v12,a*i3);if(floor2)result[i3]=Math.floor(result[i3])}return result}});__publicField(Math2,"peakDetect",(smoothedArray,type="peak",window2=49)=>{let mid=Math.floor(window2*.5);let peaks=[];for(let i3=0;i3<smoothedArray.length-window2;i3++){let isPeak=_Math2.isExtrema(smoothedArray.slice(i3,i3+window2),type);if(isPeak){peaks.push(i3+mid-1)}}return peaks});Object.assign(Math,Math2);var accel_gyro={accelConstant:1/8192,gyroConstant:1/65.5,gyroXAngle:0,gyroYAngle:0,gyroZAngle:0,px:0,py:0,pz:0,sps:100,lastAccelTime:Date.now(),lastGyroTime:Date.now(),__operator:function(data){if(!("ax"in data)&&!("gx"in data))return void 0;if(!data.timestamp){if(data.ax&&Array.isArray(data.ax)||data.gx&&Array.isArray(data.gx)){let len=data.ax?data.ax.length:data.gx.length;let now=Date.now();let toInterp=[now-len*this.sps*1e3,now];data.timestamp=Math2.upsample(toInterp,len)}else{data.timestamp=Date.now()}}let result;if(data.ax){let apass=(timestamp,ax,ay,az)=>{ax=ax*this.accelConstant;ay=ay*this.accelConstant;az=az*this.accelConstant;const accelXAngle=Math.atan(ay/Math.sqrt(ax*ax)+az*az*180/Math.PI)+this.accelXError;const accelYAngle=Math.atan(-ax/Math.sqrt(ay*ay)+az*az*180/Math.PI)+this.accelYError;return{ax,ay,az,roll:accelXAngle,pitch:accelYAngle}};if(Array.isArray(data.timestamp)){result=data.timestamp.map((v2,i3)=>{return apass(v2,data.ax[i3],data.ay[i3],data.az[i3])})}else result=apass(data.timestamp,data.ax,data.ay,data.az)}if(data.gx){let gpass=(timestamp,gx,gy,gz)=>{const elapsed=timestamp-this.lastGyroTime;this.lastGyroTime=timestamp;gx=gx*this.gyroConstant+this.gyroXError;gy=gy*this.gyroConstant+this.gyroYError;gz=gz*this.gyroConstant+this.gyroZError;this.gyroXAngle+=gx*elapsed;this.gyroYAngle+=gy*elapsed;this.gyroZAngle+=gz*elapsed;return{gx,gy,gz,roll:this.gyroXAngle,pitch:this.gyroYAngle,yaw:this.gyroZAngle}};let res;if(Array.isArray(data.timestamp)){res=data.timestamp.map((v2,i3)=>{if(result){let r=gpass(v2,data.gx[i3],data.gy[i3],data.gz[i3]);result.roll=result.roll*.04+r.roll*.96;result.pitch=result.pitch*.04+r.pitch*.96;result.yaw=res.yaw}else return gpass(v2,data.gx[i3],data.gy[i3],data.gz[i3])});if(!result)result=res}else{res=gpass(data.timestamp,data.gx,data.gy,data.gz);if(result){result.roll=result.roll*.04+res.roll*.96;result.pitch=result.pitch*.04+res.pitch*.96;result.yaw=res.yaw}else result=res}}else if(this.gyroXAngle||this.gyroYAngle||this.gyroZAngle){result.roll=result.roll*.04+this.gyroXAngle*.96;result.pitch=result.pitch*.04+this.gyroYAngle*.96;result.yaw=this.gyroXAngle}if(result.ax){const setPositionOffset=(timestamp,result2)=>{const elapsed=timestamp-this.lastAccelTime;this.lastAccelTime=timestamp;this.px+=result2.ax*elapsed*elapsed*Math.cos(this.pitch*Math.PI*.005555555555);this.py+=result2.ay*elapsed*elapsed*Math.cos(this.roll*Math.PI*.005555555555);this.pz+=result2.az*elapsed*elapsed*Math.sin(this.pitch*Math.PI*.005555555555);result2.px=this.px;result2.py=this.py;result2.pz=this.pz;return result2};if(Array.isArray(data.timestamp)){data.timestamp.map((timestamp,i3)=>{setPositionOffset(timestamp,result)})}else{setPositionOffset(data.timestamp,result)}}return result}};var Biquad=class{constructor(type,freq,sps10,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \'lowpass\',\'highpass\',\'bandpass\',\'notch\',\'peak\',\'lowshelf\',\'highshelf\'");return}this.type=type;this.freq=freq;this.sps=sps10;this.Q=Q;this.dbGain=dbGain;let A22=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps10;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A22+A22);this[type](A22,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A22,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A22,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A22,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A22,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A22,sn,cs,alpha,beta){this.b0=1+alpha*A22;this.b1=-2*cs;this.b2=1-alpha*A22;this.a0=1+alpha/A22;this.a1=-2*cs;this.a2=1-alpha/A22}lowshelf(A22,sn,cs,alpha,beta){this.b0=A22*(A22+1-(A22-1)*cs+beta*sn);this.b1=2*A22*(A22-1-(A22+1)*cs);this.b2=A22*(A22+1-(A22-1)*cs-beta*sn);this.a0=A22+1+(A22+1)*cs+beta*sn;this.a1=2*(A22-1+(A22+1)*cs);this.a2=A22+1+(A22-1)*cs-beta*sn}highshelf(A22,sn,cs,alpha,beta){this.b0=A22*(A22+1+(A22-1)*cs+beta*sn);this.b1=2*A22*(A22-1+(A22+1)*cs);this.b2=A22*(A22+1-(A22-1)*cs-beta*sn);this.a0=A22+1-(A22+1)*cs-beta*sn;this.a1=2*(A22-1-(A22+1)*cs);this.a2=A22+1-(A22-1)*cs-beta*sn}applyFilter(signal_step){let y22=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y22;return y22}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var beat_detect={refdata:[],lowpass:void 0,smoothed:[],timestamp:[],peaks:[],valleys:[],peak_distances:[],valley_distances:[],beats:[],lastPeak:0,lastValley:0,sps:100,maxFreq:4,limit:10,__onconnected:function(){if(!this.lowpass){let freq=this.maxFreq;if(!freq)freq=1;if(freq>1)freq*=.5;this.lowpass=new Biquad("lowpass",this.maxFreq,this.sps);this.peakFinderWindow=Math.floor(this.sps/this.maxFreq);if(this.peakFinderWindow%2===0)this.peakFinderWindow+=1;if(this.peakFinderWindow<5)this.peakFinderWindow=5;this.midpoint=Math.round(this.peakFinderWindow*.5)}},__operator:function(data){if(!("red"in data)&&!("heg"in data)&&!("raw"in data))return void 0;let refdata=data.red?data.red:data.heg?data.heg:data.raw;if(!("timestamp"in data)){if(Array.isArray(refdata)){let now=Date.now();let len;if(refdata)len=refdata.length;let toInterp=[now-refdata.length*this.sps*1e3,now];data.timestamp=Math2.upsample(toInterp,refdata.length)}else{data.timestamp=Date.now()}}let pass=(amplitude,timestamp)=>{if(amplitude){this.refdata.push(amplitude)}this.timestamp.push(timestamp);let beat;if(this.refdata.length>this.peakFinderWindow){this.refdata.shift();this.timestamp.shift()}this.smoothed.push(this.lowpass.applyFilter(this.refdata[this.refdata.length-1]));if(this.smoothed.length>this.peakFinderWindow){this.smoothed.shift()}if(this.smoothed.length===this.peakFinderWindow){if(Math2.isExtrema(this.smoothed,"valley")){this.valleys.push({value:this.smoothed[this.smoothed.length-this.midpoint?this.midpoint:1],timestamp:this.timestamp[this.timestamp.length-this.midpoint?this.midpoint:1]})}else if(Math2.isExtrema(this.smoothed,"peak")){this.peaks.push({value:this.smoothed[this.smoothed.length-this.midpoint?this.midpoint:1],timestamp:this.timestamp[this.timestamp.length-this.midpoint?this.midpoint:1]})}if(this.valleys.length>2&&this.peaks.length>2){if(this.valleys[this.valleys.length-1].timestamp<this.peaks[this.peaks.length-2].timestamp)this.peaks.splice(this.peaks.length-1);if(this.peaks[this.peaks.length-1].timestamp<this.valleys[this.valleys.length-2].timestamp)this.valleys.splice(this.valleys.length-1);this.valley_distances.push({distance:this.valleys[this.valleys.length-1].timestamp-this.valleys[this.valleys.length-2].timestamp,timestamp:this.valleys[this.valleys.length-1].timestamp,peak0:this.valleys[this.valleys.length-1].value,peak1:this.valleys[this.valleys.length-2].value});this.peak_distances.push({distance:this.peaks[this.peaks.length-1].timestamp-this.peaks[this.peaks.length-2].timestamp,timestamp:this.peaks[this.peaks.length-1].timestamp,peak0:this.peaks[this.peaks.length-1].value,peak1:this.peaks[this.peaks.length-2].value});if(this.peak_distances.length>1&&this.valley_distances.length>1){if(this.lastPeak<this.peaks[this.peaks.length-1].timestamp&&this.lastValley<this.peaks[this.peaks.length-1].timestamp){if(this.valley_distances[this.valley_distances.length-1].timestamp>this.peak_distances[this.peak_distances.length-1].timestamp){let bpm,change=0;if(this.beats.length<1){bpm=60/(5e-4*(this.peak_distances[this.peak_distances.length-1].distance+this.valley_distances[this.valley_distances.length-1].distance))}else if(this.beats[this.beats.length-1].timestamp!==this.peak_distances[this.peak_distances.length-1].timestamp){bpm=60/(5e-4*(this.peak_distances[this.peak_distances.length-1].dt+this.valley_distances[this.valley_distances.length-1].dt));change=Math.abs(bpm-this.beats[this.beats.length-1].bpm)}beat={timestamp:this.peak_distances[this.peak_distances.length-1].timestamp,change,bpm,height0:this.peak_distances[this.peak_distances.length-1].peak0-this.valley_distances[this.valley_distances.length-1].peak0,height1:this.peak_distances[this.peak_distances.length-1].peak1-this.valley_distances[this.valley_distances.length-1].peak1};this.beats.push(beat);this.lastPeak=this.peaks[this.peaks.length-1].timestamp;this.lastValley=this.peaks[this.peaks.length-1].timestamp}else{let bpm,change=0;if(this.beats.length<2){bpm=60/(5e-4*(this.peak_distances[this.peak_distances.length-2].distance+this.valley_distances[this.valley_distances.length-2].distance))}else if(this.beats[this.beats.length-1].timestamp!==this.peak_distances[this.peak_distances.length-2].timestamp){bpm=60/(5e-4*(this.peak_distances[this.peak_distances.length-2].distance+this.valley_distances[this.valley_distances.length-2].distance));change=Math.abs(bpm-this.beats[this.beats.length-2].bpm)}beat={timestamp:this.peak_distances[this.peak_distances.length-2].timestamp,change,bpm,height0:this.peak_distances[this.peak_distances.length-2].peak0-this.valley_distances[this.valley_distances.length-2].peak0,height1:this.peak_distances[this.peak_distances.length-2].peak1-this.valley_distances[this.valley_distances.length-2].peak1};this.beats.push(beat);this.lastPeak=this.peaks[this.peaks.length-1].timestamp;this.lastValley=this.peaks[this.peaks.length-1].timestamp}}}if(this.peaks.length>this.limit){this.peaks.shift()}if(this.valleys.length>this.limit){this.valleys.shift()}if(this.peak_distances.length>this.limit){this.peak_distances.shift()}if(this.valley_distances.length>this.limit){this.valley_distances.shift()}if(this.beats.length>this.limit){this.beats.shift()}}}return beat};if(data.red){if("ir"in data&&!Array.isArray(data.red))return pass(data.red+data.ir,data.timestamp);let result;if(data.ir)result=data.red.map((v2,i3)=>{return pass(v2+data.ir[i3],data.timestamp[i3])});else result=data.red.map((v2,i3)=>{return pass(v2,data.timestamp[i3])});return result}else if(data.raw){if(!Array.isArray(data.raw))return pass(data.raw,data.timestamp);let result=data.raw.map((v2,i3)=>{return pass(v2,data.timestamp[i3])});return result}else if(Array.isArray(data.heg)){if(!Array.isArray(data.heg))return pass(data.heg,data.timestamp);let result=data.heg.map((v2,i3)=>{return pass(v2,data.timestamp[i3])});return result}}};var blink_detect={sps:250,intervals:{},watch:["0"],tolerance:.2,__onconnected:node=>{node.watch.forEach(ch=>node.intervals[ch]={lowpass:new Biquad("lowpass",20,node.sps),filtered:[],averaged:[]})},__operator:function(data){let checkCt=5;let averageCt=50;let found={};let passed=false;let pass=(key,n)=>{let next=this.intervals[key].lowpass.applyFilter(n);this.intervals[key].filtered.push(next);this.intervals[key].averaged.push(next);if(this.intervals[key].filtered.length>checkCt){if(this.intervals[key].averaged.length>averageCt){this.intervals[key].averaged.splice(0,checkCt);let mean=Math2.mean(this.intervals[key].averaged);if(Math.abs(Math.min(...this.intervals[key].filtered))>Math.abs(mean)+this.tolerance){this.intervals[key].filtered.length=0;passed=true;found[key]=true}}else this.intervals[key].filtered.shift()}};for(const key in this.intervals){if(data[key]){if(Array.isArray(data[key])){data[key].forEach(n=>{pass(key,n)})}else if(typeof data[key]==="number")pass(key,data[key])}}if(passed)return found}};var _ArrayManip=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y22=>{if(clamp){if(y22<min)y22=min;if(y22>max)y22=max}return y22*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y22=>{if(clamp){if(y22<min)y22=min;if(y22>max)y22=max}return 2*((y22-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps10){let now=Date.now();let toInterp=[now-ct*1e3/sps10,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i3=incr;i3<array.length;i3+=incr){let rounded=Math.round(i3);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i3=1;i3<fitCount-1;i3++){var tmp=i3*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i3]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x3=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x3;b=0}else if(60<=h&&h<120){r=x3;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x3}else if(180<=h&&h<240){r=0;g=x3;b=c}else if(240<=h&&h<300){r=x3;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x3}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,...newEntries.slice(newEntries.length-len))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d2={};data.forEach((arr,i3)=>{d2[i3]=arr});data=d2;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i3)=>lastValue+slopeIncr*(i3+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip=_ArrayManip;ArrayManip.bufferValues=(objects,property,keys3,buffer)=>{if(!Array.isArray(keys3)&&typeof keys3==="object")keys3=Object.keys(keys3);if(!buffer){let object_keys=Object.keys(objects);if(keys3)buffer=new Float32Array(object_keys.length*keys3.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys3=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys3.length)}else buffer=new Float32Array(object_keys.length)}}let i3=0;for(const key in objects){if(objects[key][property]){if(keys3){for(let j=0;j<keys3.length;j++){buffer[i3]=objects[key][property][keys3[j]];i3++}}else{buffer[i3]=objects[key][property];i3++}}}return buffer};var rechk=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str=(v2,o,c)=>String.fromCharCode(...new Uint8Array(v2.buffer,v2.byteOffset+o,c));var rts=(v2,o,c,s)=>new Uint8Array(v2.buffer,v2.byteOffset+o,c).set(s.split("").map(str23=>str23.charCodeAt(0)));var pst=(v2,o,c)=>str(v2,o+1,Math.min(v2.getUint8(o),c-1));var tsp=(v2,o,c,s)=>{v2.setUint8(o,s.length);rts(v2,o+1,c-1,s)};var lut=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v2=>str(v2,o,1),p:(v2,c2)=>rts(v2,o,1,c2)})],"?":c=>[c,1,o=>({u:v2=>Boolean(v2.getUint8(o)),p:(v2,B3)=>v2.setUint8(o,B3)})],b:c=>[c,1,o=>({u:v2=>v2.getInt8(o),p:(v2,b)=>v2.setInt8(o,b)})],B:c=>[c,1,o=>({u:v2=>v2.getUint8(o),p:(v2,B3)=>v2.setUint8(o,B3)})],h:c=>[c,2,o=>({u:v2=>v2.getInt16(o,le),p:(v2,h)=>v2.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v2=>v2.getUint16(o,le),p:(v2,H3)=>v2.setUint16(o,H3,le)})],i:c=>[c,4,o=>({u:v2=>v2.getInt32(o,le),p:(v2,i3)=>v2.setInt32(o,i3,le)})],I:c=>[c,4,o=>({u:v2=>v2.getUint32(o,le),p:(v2,I)=>v2.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v2=>v2.getFloat32(o,le),p:(v2,f)=>v2.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v2=>v2.getFloat64(o,le),p:(v2,d2)=>v2.setFloat64(o,d2,le)})],s:c=>[1,c,o=>({u:v2=>str(v2,o,c),p:(v2,s)=>rts(v2,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v2=>pst(v2,o,c),p:(v2,s)=>tsp(v2,o,c,s.slice(0,c-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var _ByteParser=class extends ArrayManip{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){indices.push(i3);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y22){return[y22&255,y22>>8&255]}static bytesToInt24(x0,x1,x22){let int24=(255&x0)<<16|(255&x1)<<8|255&x22;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x22){return x0*65536+x1*256+x22}static Uint24ToBytes(y22){return[y22&255,y22>>8&255,y22>>16&255]}static bytesToInt32(x0,x1,x22,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x22)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x22,x3){return x0*16777216+x1*65536+x22*256+x3}static Uint32ToBytes(y22){return[y22&255,y22>>8&255,y22>>16&255,y22>>24&255]}static get2sCompliment(val,nbits4){if(val>4294967296)return null;return val<<32-nbits4>>32-nbits4}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i3=0;i3<input.length;i3++){var c=input.charCodeAt(i3);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i3]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser.asUint8Array(patternBuffer);var M2=pattern.length;if(M2===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R2=256;var rightmost_positions=new Int32Array(R2);for(var c=0;c<R2;c++){rightmost_positions[c]=-1}for(var j=0;j<M2;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i3=start;i3<=lastIndex;i3+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i3+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i3}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk.exec(format);if(!m){throw new RangeError("Invalid format string")}const t3=lut("<"===m[1]),lu=(n,c)=>t3[c](n?parseInt(n,10):1);while(m=refmt.exec(format)){((r,s,f)=>{for(let i3=0;i3<r;++i3,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v2=new DataView(arrb,offs|0);return fns.map(f=>f.u(v2))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v2=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i3)=>f.p(v2,values[i3]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser=_ByteParser;ByteParser.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var rms={sps:250,nSec:1,watch:["0","1","2","3"],data:{},rms:{},__operator:function(data){this.watch.forEach(key=>{if(data[key]){if(!this.data[key]){if(Array.isArray(data[key])){this.data[key]=new Array(Math.floor(this.sps*this.nSec)).fill(data[key][0])}else this.data[key]=new Array(Math.floor(this.sps*this.nSec)).fill(data[key])}ByteParser.circularBuffer(this.data[key],data[key])}});if(data.timestamp){if(Array.isArray(data.timestamp)){this.rms.timestamp=data.timestamp[data.timestamp.length-1]}else this.rms.timestamp=data.timestamp}else this.rms.timestamp=Date.now();return new Promise(async res=>{await Promise.all(this.watch.map(async key=>{if(this.data[key])this.rms[key]=Math.sqrt(Math.abs(this.data[key].reduce((p2,v2,i3)=>p2+v2*v2)/this.data[key].length));else delete this.rms[key]}));res(this.rms)})}};var circularBuffer2d={bufferSize:250,watch:["0","1","2","3"],data:{},blocking:false,__onconnected:function(node){for(const key in node.watch){node.data[key]=new Array(node.bufferSize).fill(0)}},__operator:function(data){let buffer2d=[];this.watch.forEach(key=>{if(data[key]){ByteParser.circularBuffer(this.data[key],data[key]);buffer2d.push(this.data[key])}});return buffer2d}};var algorithms={beat_detect,accel_gyro,heartrate:beat_detect,breath:Object.assign({},beat_detect),blink_detect,rms,circularBuffer2d};algorithms["breath"].maxFreq=.2;var _ArrayManip2=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y4=>{if(clamp){if(y4<min)y4=min;if(y4>max)y4=max}return y4*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y4=>{if(clamp){if(y4<min)y4=min;if(y4>max)y4=max}return 2*((y4-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps10){let now=Date.now();let toInterp=[now-ct*1e3/sps10,now];return _ArrayManip2.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i3=incr;i3<array.length;i3+=incr){let rounded=Math.round(i3);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i3=1;i3<fitCount-1;i3++){var tmp=i3*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i3]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip2.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip2.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x3=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x3;b=0}else if(60<=h&&h<120){r=x3;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x3}else if(180<=h&&h<240){r=0;g=x3;b=c}else if(240<=h&&h<300){r=x3;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x3}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d2={};data.forEach((arr,i3)=>{d2[i3]=arr});data=d2;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i3)=>lastValue+slopeIncr*(i3+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip2.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip2=_ArrayManip2;ArrayManip2.bufferValues=(objects,property,keys3,buffer)=>{if(!Array.isArray(keys3)&&typeof keys3==="object")keys3=Object.keys(keys3);if(!buffer){let object_keys=Object.keys(objects);if(keys3)buffer=new Float32Array(object_keys.length*keys3.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys3=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys3.length)}else buffer=new Float32Array(object_keys.length)}}let i3=0;for(const key in objects){if(objects[key][property]){if(keys3){for(let j=0;j<keys3.length;j++){buffer[i3]=objects[key][property][keys3[j]];i3++}}else{buffer[i3]=objects[key][property];i3++}}}return buffer};var rechk2=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt2=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str2=(v2,o,c)=>String.fromCharCode(...new Uint8Array(v2.buffer,v2.byteOffset+o,c));var rts2=(v2,o,c,s)=>new Uint8Array(v2.buffer,v2.byteOffset+o,c).set(s.split("").map(str4=>str4.charCodeAt(0)));var pst2=(v2,o,c)=>str2(v2,o+1,Math.min(v2.getUint8(o),c-1));var tsp2=(v2,o,c,s)=>{v2.setUint8(o,s.length);rts2(v2,o+1,c-1,s)};var lut2=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v2=>str2(v2,o,1),p:(v2,c2)=>rts2(v2,o,1,c2)})],"?":c=>[c,1,o=>({u:v2=>Boolean(v2.getUint8(o)),p:(v2,B3)=>v2.setUint8(o,B3)})],b:c=>[c,1,o=>({u:v2=>v2.getInt8(o),p:(v2,b)=>v2.setInt8(o,b)})],B:c=>[c,1,o=>({u:v2=>v2.getUint8(o),p:(v2,B3)=>v2.setUint8(o,B3)})],h:c=>[c,2,o=>({u:v2=>v2.getInt16(o,le),p:(v2,h)=>v2.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v2=>v2.getUint16(o,le),p:(v2,H3)=>v2.setUint16(o,H3,le)})],i:c=>[c,4,o=>({u:v2=>v2.getInt32(o,le),p:(v2,i3)=>v2.setInt32(o,i3,le)})],I:c=>[c,4,o=>({u:v2=>v2.getUint32(o,le),p:(v2,I)=>v2.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v2=>v2.getFloat32(o,le),p:(v2,f)=>v2.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v2=>v2.getFloat64(o,le),p:(v2,d2)=>v2.setFloat64(o,d2,le)})],s:c=>[1,c,o=>({u:v2=>str2(v2,o,c),p:(v2,s)=>rts2(v2,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v2=>pst2(v2,o,c),p:(v2,s)=>tsp2(v2,o,c,s.slice(0,c-1))})]});var errbuf2=new RangeError("Structure larger than remaining buffer");var errval2=new RangeError("Not enough values for structure");var _ByteParser2=class extends ArrayManip2{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser2.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser2.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser2.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){indices.push(i3);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y4){return[y4&255,y4>>8&255]}static bytesToInt24(x0,x1,x22){let int24=(255&x0)<<16|(255&x1)<<8|255&x22;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x22){return x0*65536+x1*256+x22}static Uint24ToBytes(y4){return[y4&255,y4>>8&255,y4>>16&255]}static bytesToInt32(x0,x1,x22,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x22)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x22,x3){return x0*16777216+x1*65536+x22*256+x3}static Uint32ToBytes(y4){return[y4&255,y4>>8&255,y4>>16&255,y4>>24&255]}static get2sCompliment(val,nbits4){if(val>4294967296)return null;return val<<32-nbits4>>32-nbits4}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i3=0;i3<input.length;i3++){var c=input.charCodeAt(i3);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i3]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser2.asUint8Array(patternBuffer);var M2=pattern.length;if(M2===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R2=256;var rightmost_positions=new Int32Array(R2);for(var c=0;c<R2;c++){rightmost_positions[c]=-1}for(var j=0;j<M2;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser2.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i3=start;i3<=lastIndex;i3+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i3+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i3}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk2.exec(format);if(!m){throw new RangeError("Invalid format string")}const t3=lut2("<"===m[1]),lu=(n,c)=>t3[c](n?parseInt(n,10):1);while(m=refmt2.exec(format)){((r,s,f)=>{for(let i3=0;i3<r;++i3,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf2}let v2=new DataView(arrb,offs|0);return fns.map(f=>f.u(v2))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval2}if(arrb.byteLength<offs+size){throw errbuf2}const v2=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i3)=>f.p(v2,values[i3]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser2=_ByteParser2;ByteParser2.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var WebSerial=class extends ByteParser2{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message){const writer=port.writable.getWriter();await writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i3;else{nextIndex=i3;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}writeStream(stream,message){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i3=0;i3<ports.length;i3++){if(ports[i3].getInfo().usbVendorId===info.usbVendorId&&ports[i3].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i3],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i3]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t3=>{let opt=transforms[t3];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str4=stream;transform.forEach(transform2=>{str4=str4.pipeThrough(transform2)});return str4}};function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i3=0;i3<9;i3++){let j=i3*25;output[0][i3]=ByteParser2.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i3]=ByteParser2.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i3]=ByteParser2.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i3]=ByteParser2.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i3]=ByteParser2.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i3]=ByteParser2.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i3]=ByteParser2.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i3]=ByteParser2.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}if(arr.length>225){output.leds=arr.slice(225)}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var sps=250;var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var gain=32;var nbits=24;var vref=1.2;var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b)=>a+b;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser2.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser2.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser2.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<8;i3++){let idx=1+3*i3;output[i3]=ByteParser2.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<8;i3++){let idx=1+3*i3;if(arr[0]%2===0)output[i3+7]=ByteParser2.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i3]=ByteParser2.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<128;i3++){let idx=i3*3+1;output[i3]=ByteParser2.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser2.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser2.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser2.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser2.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser2.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser2.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i3=0;i3<128;i3++){freeeeg128ChartSettings.lines[i3]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i3]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<32;i3++){let idx=i3*3+1;output[i3]=ByteParser2.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser2.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser2.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser2.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser2.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser2.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser2.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i3=0;i3<32;i3++){freeeeg32ChartSettings.lines[i3]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i3]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps5=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\n",codec:hegduinocodec,sps:sps5};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps5,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps5}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser2.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i3=0;while(i3<pktCt){let idx=i3*6;if(i3%2===0){output["ir"][i3]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i3+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i3-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i3]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i3++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser2.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i3=0;i3<20;i3++){let idx=i3*12;output.ax[i3]=ByteParser2.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i3]=ByteParser2.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i3]=ByteParser2.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i3]=ByteParser2.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i3]=ByteParser2.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i3]=ByteParser2.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i3=0;i3<7;i3++){let j=i3*26+1;if(!arr[j+23])break;output[0][i3]=ByteParser2.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i3]=ByteParser2.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i3]=ByteParser2.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i3]=ByteParser2.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i3]=ByteParser2.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i3]=ByteParser2.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i3]=ByteParser2.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i3]=ByteParser2.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps6=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps6}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps6};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps6;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting4={nSec:10,sps:sps6,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting4)),"1":JSON.parse(JSON.stringify(defaultChartSetting4)),"2":JSON.parse(JSON.stringify(defaultChartSetting4)),"3":JSON.parse(JSON.stringify(defaultChartSetting4)),"4":JSON.parse(JSON.stringify(defaultChartSetting4)),"5":JSON.parse(JSON.stringify(defaultChartSetting4)),"6":JSON.parse(JSON.stringify(defaultChartSetting4)),"7":JSON.parse(JSON.stringify(defaultChartSetting4))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i3=0;while(i3<data.length){if(PeanutCodes[data[i3]]&&i3+1+PeanutCodes[data[i3]].byteLength<=data.length){let slice=data.slice(i3+1,i3+1+PeanutCodes[data[i3]].byteLength).buffer;let unpacked=ByteParser2.struct(PeanutCodes[data[i3]].format).unpack(slice);let code=PeanutCodes[data[i3]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i3]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i3]].type]=unpacked;else result[PeanutCodes[data[i3]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i3]].type].push(...unpacked);else result[PeanutCodes[data[i3]].type].push(unpacked)}i3+=PeanutCodes[data[i3]].byteLength+1}else i3++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j=0;j<3;j++){let i3=j*16+2;let tint=ByteParser2.bytesToInt32(arr[3+i3],arr[2+i3],arr[1+i3],arr[0+i3]);let tfrac=ByteParser2.bytesToInt32(arr[7+i3],arr[6+i3],arr[5+i3],arr[4+i3]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser2.bytesToInt32(arr[11+i3],arr[10+i3],arr[9+i3],arr[8+i3]);let pfrac=ByteParser2.bytesToInt32(arr[15+i3],arr[14+i3],arr[13+i3],arr[12+i3]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}else{output.humidity=[];for(let j=0;j<3;j++){let i3=j*24+2;let tint=ByteParser2.bytesToInt32(arr[3+i3],arr[2+i3],arr[1+i3],arr[0+i3]);let tfrac=ByteParser2.bytesToInt32(arr[7+i3],arr[6+i3],arr[5+i3],arr[4+i3]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser2.bytesToInt32(arr[11+i3],arr[10+i3],arr[9+i3],arr[8+i3]);let pfrac=ByteParser2.bytesToInt32(arr[15+i3],arr[14+i3],arr[13+i3],arr[12+i3]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser2.bytesToInt32(arr[19+i3],arr[18+i3],arr[17+i3],arr[16+i3]);let hfrac=ByteParser2.bytesToInt32(arr[23+i3],arr[22+i3],arr[21+i3],arr[20+i3]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec(arr.subarray(2));Object.keys(result).forEach((key,i3)=>{output[i3+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,ads131m08codec(arr))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting5={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))},generateNewLines:true,cleanGeneration:false};var gain2=32;var nbits2=24;var vref2=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps7=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps7}}},sps:sps7};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps8},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps8}}},sps:sps8};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop3=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v2,i3)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i3+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop3()},loopTime)}};loop3();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.buffer)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps10=this.sps;this.notch50=[makeNotchFilter(50,sps10,2),makeNotchFilter(100,sps10,2)];this.notch60=[makeNotchFilter(60,sps10,2),makeNotchFilter(120,sps10,2)];this.lp1=[new Biquad2("lowpass",this.lowpassHz,sps10),new Biquad2("lowpass",this.lowpassHz,sps10),new Biquad2("lowpass",this.lowpassHz,sps10),new Biquad2("lowpass",this.lowpassHz,sps10)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps10=this.sps){this.notch50=[makeNotchFilter(50,sps10,2),makeNotchFilter(100,sps10,2)];this.notch60=[makeNotchFilter(60,sps10,2),makeNotchFilter(120,sps10,2)];this.lp1=[new Biquad2("lowpass",this.lowpassHz,sps10),new Biquad2("lowpass",this.lowpassHz,sps10),new Biquad2("lowpass",this.lowpassHz,sps10),new Biquad2("lowpass",this.lowpassHz,sps10)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps10=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps10),makeBandpassFilter(bandpassLower,bandpassUpper,sps10),makeBandpassFilter(bandpassLower,bandpassUpper,sps10),makeBandpassFilter(bandpassLower,bandpassUpper,sps10)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f,i3)=>{out=f.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f,i3)=>{out=f.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f,i3)=>{out=f.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f,i3)=>{out=f.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad2=class{constructor(type,freq,sps10,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \'lowpass\',\'highpass\',\'bandpass\',\'notch\',\'peak\',\'lowshelf\',\'highshelf\'");return}this.type=type;this.freq=freq;this.sps=sps10;this.Q=Q;this.dbGain=dbGain;let A4=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps10;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A4+A4);this[type](A4,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A4,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A4,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A4,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A4,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A4,sn,cs,alpha,beta){this.b0=1+alpha*A4;this.b1=-2*cs;this.b2=1-alpha*A4;this.a0=1+alpha/A4;this.a1=-2*cs;this.a2=1-alpha/A4}lowshelf(A4,sn,cs,alpha,beta){this.b0=A4*(A4+1-(A4-1)*cs+beta*sn);this.b1=2*A4*(A4-1-(A4+1)*cs);this.b2=A4*(A4+1-(A4-1)*cs-beta*sn);this.a0=A4+1+(A4+1)*cs+beta*sn;this.a1=2*(A4-1+(A4+1)*cs);this.a2=A4+1+(A4-1)*cs-beta*sn}highshelf(A4,sn,cs,alpha,beta){this.b0=A4*(A4+1+(A4-1)*cs+beta*sn);this.b1=2*A4*(A4-1+(A4+1)*cs);this.b2=A4*(A4+1-(A4-1)*cs-beta*sn);this.a0=A4+1-(A4+1)*cs-beta*sn;this.a1=2*(A4-1-(A4+1)*cs);this.a2=A4+1-(A4-1)*cs-beta*sn}applyFilter(signal_step){let y4=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y4;return y4}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y4=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y4;return y4}};var makeNotchFilter=(frequency,sps10,bandwidth)=>{return new Biquad2("notch",frequency,sps10,Biquad2.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps10,resonance=Math.pow(10,Math.floor(Math.log10(Biquad2.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad2("bandpass",Biquad2.calcCenterFrequency(freqStart,freqEnd),sps10,Biquad2.calcBandpassQ(Biquad2.calcCenterFrequency(freqStart,freqEnd),Biquad2.calcBandwidth(freqStart,freqEnd),resonance),0)};function parseFunctionFromText2(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs4(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs2}var stringifyFast2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p2 in value[prop]){if(Array.isArray(value[prop][p2])){if(value[prop][p2].length>20)obj[prop][p2]=value[prop][p2].slice(value[prop][p2].length-20);else obj[prop][p2]=value[prop][p2]}else{if(value[prop][p2]!=null){let con=value[prop][p2].constructor.name;if(con.includes("Set")){obj[prop][p2]=Array.from(value[prop][p2])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p2]="instanceof_"+con}else{obj[prop][p2]=value[prop][p2]}}else{obj[prop][p2]=value[prop][p2]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast4(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast2}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser2;globalThis.filtering=true;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip2}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText2(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder3,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder3+")")},"receiveCodec":function receiveDeviceCodec(decoder3,deviceType,device,service,characteristic){let codec=parseFunctionFromText2(decoder3);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v2=>filter.apply(v2))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v2=>filter.apply(v2))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v2=>filter.apply(v2))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v2=>filter.apply(v2))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters)globalThis.filters={};for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService3=this.__node.graph;if(!globalThis.Serial)WorkerService3.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(typeof stream.settings.pipeTo==="string")WorkerService3.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService3.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService3.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};var __defProp3=Object.defineProperty;var __getOwnPropNames3=Object.getOwnPropertyNames;var __require4=(x3=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x3)(function(x3){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var __esm=(fn,res)=>function __init(){return fn&&(res=(0,fn[__getOwnPropNames3(fn)[0]])(fn=0)),res};var __export2=(target,all)=>{for(var name2 in all)__defProp3(target,name2,{get:all[name2],enumerable:true})};var createCapacitorPlatforms;var initPlatforms;var CapacitorPlatforms;var addPlatform;var setPlatform;var ExceptionCode;var CapacitorException;var getPlatformId;var createCapacitor;var initCapacitorGlobal;var Capacitor;var registerPlugin;var Plugins;var WebPlugin;var encode;var decode2;var CapacitorCookiesPluginWeb;var CapacitorCookies;var readBlobAsBase64;var normalizeHttpHeaders;var buildUrlParams;var buildRequestInit;var CapacitorHttpPluginWeb;var CapacitorHttp;var init_dist=__esm({"src/ble/node_modules/@capacitor/core/dist/index.js"(){createCapacitorPlatforms=win=>{const defaultPlatformMap=new Map;defaultPlatformMap.set("web",{name:"web"});const capPlatforms=win.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:defaultPlatformMap};const addPlatform2=(name2,platform)=>{capPlatforms.platforms.set(name2,platform)};const setPlatform2=name2=>{if(capPlatforms.platforms.has(name2)){capPlatforms.currentPlatform=capPlatforms.platforms.get(name2)}};capPlatforms.addPlatform=addPlatform2;capPlatforms.setPlatform=setPlatform2;return capPlatforms};initPlatforms=win=>win.CapacitorPlatforms=createCapacitorPlatforms(win);CapacitorPlatforms=initPlatforms(typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{});addPlatform=CapacitorPlatforms.addPlatform;setPlatform=CapacitorPlatforms.setPlatform;(function(ExceptionCode2){ExceptionCode2["Unimplemented"]="UNIMPLEMENTED";ExceptionCode2["Unavailable"]="UNAVAILABLE"})(ExceptionCode||(ExceptionCode={}));CapacitorException=class extends Error{constructor(message,code,data){super(message);this.message=message;this.code=code;this.data=data}};getPlatformId=win=>{var _a,_b;if(win===null||win===void 0?void 0:win.androidBridge){return"android"}else if((_b=(_a=win===null||win===void 0?void 0:win.webkit)===null||_a===void 0?void 0:_a.messageHandlers)===null||_b===void 0?void 0:_b.bridge){return"ios"}else{return"web"}};createCapacitor=win=>{var _a,_b,_c,_d,_e;const capCustomPlatform=win.CapacitorCustomPlatform||null;const cap=win.Capacitor||{};const Plugins2=cap.Plugins=cap.Plugins||{};const capPlatforms=win.CapacitorPlatforms;const defaultGetPlatform=()=>{return capCustomPlatform!==null?capCustomPlatform.name:getPlatformId(win)};const getPlatform=((_a=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_a===void 0?void 0:_a.getPlatform)||defaultGetPlatform;const defaultIsNativePlatform=()=>getPlatform()!=="web";const isNativePlatform=((_b=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_b===void 0?void 0:_b.isNativePlatform)||defaultIsNativePlatform;const defaultIsPluginAvailable=pluginName=>{const plugin=registeredPlugins.get(pluginName);if(plugin===null||plugin===void 0?void 0:plugin.platforms.has(getPlatform())){return true}if(getPluginHeader(pluginName)){return true}return false};const isPluginAvailable=((_c=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_c===void 0?void 0:_c.isPluginAvailable)||defaultIsPluginAvailable;const defaultGetPluginHeader=pluginName=>{var _a2;return(_a2=cap.PluginHeaders)===null||_a2===void 0?void 0:_a2.find(h=>h.name===pluginName)};const getPluginHeader=((_d=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_d===void 0?void 0:_d.getPluginHeader)||defaultGetPluginHeader;const handleError=err=>win.console.error(err);const pluginMethodNoop=(_target,prop,pluginName)=>{return Promise.reject(`${pluginName} does not have an implementation of "${prop}".`)};const registeredPlugins=new Map;const defaultRegisterPlugin=(pluginName,jsImplementations={})=>{const registeredPlugin=registeredPlugins.get(pluginName);if(registeredPlugin){console.warn(`Capacitor plugin "${pluginName}" already registered. Cannot register plugins twice.`);return registeredPlugin.proxy}const platform=getPlatform();const pluginHeader=getPluginHeader(pluginName);let jsImplementation;const loadPluginImplementation=async()=>{if(!jsImplementation&&platform in jsImplementations){jsImplementation=typeof jsImplementations[platform]==="function"?jsImplementation=await jsImplementations[platform]():jsImplementation=jsImplementations[platform]}else if(capCustomPlatform!==null&&!jsImplementation&&"web"in jsImplementations){jsImplementation=typeof jsImplementations["web"]==="function"?jsImplementation=await jsImplementations["web"]():jsImplementation=jsImplementations["web"]}return jsImplementation};const createPluginMethod=(impl,prop)=>{var _a2,_b2;if(pluginHeader){const methodHeader=pluginHeader===null||pluginHeader===void 0?void 0:pluginHeader.methods.find(m=>prop===m.name);if(methodHeader){if(methodHeader.rtype==="promise"){return options=>cap.nativePromise(pluginName,prop.toString(),options)}else{return(options,callback)=>cap.nativeCallback(pluginName,prop.toString(),options,callback)}}else if(impl){return(_a2=impl[prop])===null||_a2===void 0?void 0:_a2.bind(impl)}}else if(impl){return(_b2=impl[prop])===null||_b2===void 0?void 0:_b2.bind(impl)}else{throw new CapacitorException(`"${pluginName}" plugin is not implemented on ${platform}`,ExceptionCode.Unimplemented)}};const createPluginMethodWrapper=prop=>{let remove;const wrapper=(...args)=>{const p2=loadPluginImplementation().then(impl=>{const fn=createPluginMethod(impl,prop);if(fn){const p22=fn(...args);remove=p22===null||p22===void 0?void 0:p22.remove;return p22}else{throw new CapacitorException(`"${pluginName}.${prop}()" is not implemented on ${platform}`,ExceptionCode.Unimplemented)}});if(prop==="addListener"){p2.remove=async()=>remove()}return p2};wrapper.toString=()=>`${prop.toString()}() { [capacitor code] }`;Object.defineProperty(wrapper,"name",{value:prop,writable:false,configurable:false});return wrapper};const addListener=createPluginMethodWrapper("addListener");const removeListener=createPluginMethodWrapper("removeListener");const addListenerNative=(eventName,callback)=>{const call=addListener({eventName},callback);const remove=async()=>{const callbackId=await call;removeListener({eventName,callbackId},callback)};const p2=new Promise(resolve=>call.then(()=>resolve({remove})));p2.remove=async()=>{console.warn(`Using addListener() without \'await\' is deprecated.`);await remove()};return p2};const proxy=new Proxy({},{get(_,prop){switch(prop){case"$$typeof":return void 0;case"toJSON":return()=>({});case"addListener":return pluginHeader?addListenerNative:addListener;case"removeListener":return removeListener;default:return createPluginMethodWrapper(prop)}}});Plugins2[pluginName]=proxy;registeredPlugins.set(pluginName,{name:pluginName,proxy,platforms:new Set([...Object.keys(jsImplementations),...pluginHeader?[platform]:[]])});return proxy};const registerPlugin2=((_e=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_e===void 0?void 0:_e.registerPlugin)||defaultRegisterPlugin;if(!cap.convertFileSrc){cap.convertFileSrc=filePath=>filePath}cap.getPlatform=getPlatform;cap.handleError=handleError;cap.isNativePlatform=isNativePlatform;cap.isPluginAvailable=isPluginAvailable;cap.pluginMethodNoop=pluginMethodNoop;cap.registerPlugin=registerPlugin2;cap.Exception=CapacitorException;cap.DEBUG=!!cap.DEBUG;cap.isLoggingEnabled=!!cap.isLoggingEnabled;cap.platform=cap.getPlatform();cap.isNative=cap.isNativePlatform();return cap};initCapacitorGlobal=win=>win.Capacitor=createCapacitor(win);Capacitor=initCapacitorGlobal(typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{});registerPlugin=Capacitor.registerPlugin;Plugins=Capacitor.Plugins;WebPlugin=class{constructor(config){this.listeners={};this.windowListeners={};if(config){console.warn(`Capacitor WebPlugin "${config.name}" config object was deprecated in v3 and will be removed in v4.`);this.config=config}}addListener(eventName,listenerFunc){const listeners=this.listeners[eventName];if(!listeners){this.listeners[eventName]=[]}this.listeners[eventName].push(listenerFunc);const windowListener=this.windowListeners[eventName];if(windowListener&&!windowListener.registered){this.addWindowListener(windowListener)}const remove=async()=>this.removeListener(eventName,listenerFunc);const p2=Promise.resolve({remove});Object.defineProperty(p2,"remove",{value:async()=>{console.warn(`Using addListener() without \'await\' is deprecated.`);await remove()}});return p2}async removeAllListeners(){this.listeners={};for(const listener in this.windowListeners){this.removeWindowListener(this.windowListeners[listener])}this.windowListeners={}}notifyListeners(eventName,data){const listeners=this.listeners[eventName];if(listeners){listeners.forEach(listener=>listener(data))}}hasListeners(eventName){return!!this.listeners[eventName].length}registerWindowListener(windowEventName,pluginEventName){this.windowListeners[pluginEventName]={registered:false,windowEventName,pluginEventName,handler:event=>{this.notifyListeners(pluginEventName,event)}}}unimplemented(msg="not implemented"){return new Capacitor.Exception(msg,ExceptionCode.Unimplemented)}unavailable(msg="not available"){return new Capacitor.Exception(msg,ExceptionCode.Unavailable)}async removeListener(eventName,listenerFunc){const listeners=this.listeners[eventName];if(!listeners){return}const index=listeners.indexOf(listenerFunc);this.listeners[eventName].splice(index,1);if(!this.listeners[eventName].length){this.removeWindowListener(this.windowListeners[eventName])}}addWindowListener(handle){window.addEventListener(handle.windowEventName,handle.handler);handle.registered=true}removeWindowListener(handle){if(!handle){return}window.removeEventListener(handle.windowEventName,handle.handler);handle.registered=false}};encode=str32=>encodeURIComponent(str32).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);decode2=str32=>str32.replace(/(%[\\dA-F]{2})+/gi,decodeURIComponent);CapacitorCookiesPluginWeb=class extends WebPlugin{async getCookies(){const cookies=document.cookie;const cookieMap={};cookies.split(";").forEach(cookie=>{if(cookie.length<=0)return;let[key,value]=cookie.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");key=decode2(key).trim();value=decode2(value).trim();cookieMap[key]=value});return cookieMap}async setCookie(options){try{const encodedKey=encode(options.key);const encodedValue=encode(options.value);const expires=`; expires=${(options.expires||"").replace("expires=","")}`;const path=(options.path||"/").replace("path=","");const domain=options.url!=null&&options.url.length>0?`domain=${options.url}`:"";document.cookie=`${encodedKey}=${encodedValue||""}${expires}; path=${path}; ${domain};`}catch(error){return Promise.reject(error)}}async deleteCookie(options){try{document.cookie=`${options.key}=; Max-Age=0`}catch(error){return Promise.reject(error)}}async clearCookies(){try{const cookies=document.cookie.split(";")||[];for(const cookie of cookies){document.cookie=cookie.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}}catch(error){return Promise.reject(error)}}async clearAllCookies(){try{await this.clearCookies()}catch(error){return Promise.reject(error)}}};CapacitorCookies=registerPlugin("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});readBlobAsBase64=async blob=>new Promise((resolve,reject)=>{const reader=new FileReader;reader.onload=()=>{const base64String=reader.result;resolve(base64String.indexOf(",")>=0?base64String.split(",")[1]:base64String)};reader.onerror=error=>reject(error);reader.readAsDataURL(blob)});normalizeHttpHeaders=(headers={})=>{const originalKeys=Object.keys(headers);const loweredKeys=Object.keys(headers).map(k=>k.toLocaleLowerCase());const normalized=loweredKeys.reduce((acc,key,index)=>{acc[key]=headers[originalKeys[index]];return acc},{});return normalized};buildUrlParams=(params,shouldEncode=true)=>{if(!params)return null;const output=Object.entries(params).reduce((accumulator,entry)=>{const[key,value]=entry;let encodedValue;let item;if(Array.isArray(value)){item="";value.forEach(str32=>{encodedValue=shouldEncode?encodeURIComponent(str32):str32;item+=`${key}=${encodedValue}&`});item.slice(0,-1)}else{encodedValue=shouldEncode?encodeURIComponent(value):value;item=`${key}=${encodedValue}`}return`${accumulator}&${item}`},"");return output.substr(1)};buildRequestInit=(options,extra={})=>{const output=Object.assign({method:options.method||"GET",headers:options.headers},extra);const headers=normalizeHttpHeaders(options.headers);const type=headers["content-type"]||"";if(typeof options.data==="string"){output.body=options.data}else if(type.includes("application/x-www-form-urlencoded")){const params=new URLSearchParams;for(const[key,value]of Object.entries(options.data||{})){params.set(key,value)}output.body=params.toString()}else if(type.includes("multipart/form-data")){const form=new FormData;if(options.data instanceof FormData){options.data.forEach((value,key)=>{form.append(key,value)})}else{for(const key of Object.keys(options.data)){form.append(key,options.data[key])}}output.body=form;const headers2=new Headers(output.headers);headers2.delete("content-type");output.headers=headers2}else if(type.includes("application/json")||typeof options.data==="object"){output.body=JSON.stringify(options.data)}return output};CapacitorHttpPluginWeb=class extends WebPlugin{async request(options){const requestInit=buildRequestInit(options,options.webFetchExtra);const urlParams=buildUrlParams(options.params,options.shouldEncodeUrlParams);const url2=urlParams?`${options.url}?${urlParams}`:options.url;const response=await fetch(url2,requestInit);const contentType=response.headers.get("content-type")||"";let{responseType="text"}=response.ok?options:{};if(contentType.includes("application/json")){responseType="json"}let data;let blob;switch(responseType){case"arraybuffer":case"blob":blob=await response.blob();data=await readBlobAsBase64(blob);break;case"json":data=await response.json();break;case"document":case"text":default:data=await response.text()}const headers={};response.headers.forEach((value,key)=>{headers[key]=value});return{data,headers,status:response.status,url:response.url}}async get(options){return this.request(Object.assign(Object.assign({},options),{method:"GET"}))}async post(options){return this.request(Object.assign(Object.assign({},options),{method:"POST"}))}async put(options){return this.request(Object.assign(Object.assign({},options),{method:"PUT"}))}async patch(options){return this.request(Object.assign(Object.assign({},options),{method:"PATCH"}))}async delete(options){return this.request(Object.assign(Object.assign({},options),{method:"DELETE"}))}};CapacitorHttp=registerPlugin("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb})}});function numbersToDataView(value){return new DataView(Uint8Array.from(value).buffer)}function dataViewToNumbers(value){return Array.from(new Uint8Array(value.buffer))}function numberToUUID(value){return`0000${value.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function hexStringToDataView(value){const numbers=value.trim().split(" ").filter(e=>e!=="").map(s=>parseInt(s,16));return numbersToDataView(numbers)}function dataViewToHexString(value){return dataViewToNumbers(value).map(n=>{let s=n.toString(16);if(s.length==1){s="0"+s}return s}).join(" ")}function webUUIDToString(uuid){if(typeof uuid==="string"){return uuid}else if(typeof uuid==="number"){return numberToUUID(uuid)}else{throw new Error("Invalid UUID")}}function mapToObject(map){const obj={};if(!map){return void 0}map.forEach((value,key)=>{obj[key.toString()]=value});return obj}var init_conversion=__esm({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js"(){}});async function runWithTimeout(promise,time,exception){let timer;return Promise.race([promise,new Promise((_,reject)=>{timer=setTimeout(()=>reject(exception),time)})]).finally(()=>clearTimeout(timer))}var init_timeout=__esm({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/timeout.js"(){}});var web_exports={};__export2(web_exports,{BluetoothLeWeb:()=>BluetoothLeWeb});var BluetoothLeWeb;var init_web=__esm({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/web.js"(){init_dist();init_conversion();init_timeout();BluetoothLeWeb=class extends WebPlugin{constructor(){super(...arguments);this.deviceMap=new Map;this.discoveredDevices=new Map;this.scan=null;this.DEFAULT_CONNECTION_TIMEOUT=1e4;this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this);this.onDisconnectedCallback=this.onDisconnected.bind(this);this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if(typeof navigator==="undefined"||!navigator.bluetooth){throw this.unavailable("Web Bluetooth API not available in this browser.")}const isAvailable=await navigator.bluetooth.getAvailability();if(!isAvailable){throw this.unavailable("No Bluetooth radio available.")}}async isEnabled(){return{value:true}}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(options){const filters=this.getFilters(options);const device=await navigator.bluetooth.requestDevice({filters:filters.length?filters:void 0,optionalServices:options===null||options===void 0?void 0:options.optionalServices,acceptAllDevices:filters.length===0});this.deviceMap.set(device.id,device);const bleDevice=this.getBleDevice(device);return bleDevice}async requestLEScan(options){this.requestBleDeviceOptions=options;const filters=this.getFilters(options);await this.stopLEScan();this.discoveredDevices=new Map;navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback);navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback);this.scan=await navigator.bluetooth.requestLEScan({filters:filters.length?filters:void 0,acceptAllAdvertisements:filters.length===0,keepRepeatedDevices:options===null||options===void 0?void 0:options.allowDuplicates})}onAdvertisementReceived(event){var _a,_b;const deviceId=event.device.id;this.deviceMap.set(deviceId,event.device);const isNew=!this.discoveredDevices.has(deviceId);if(isNew||((_a=this.requestBleDeviceOptions)===null||_a===void 0?void 0:_a.allowDuplicates)){this.discoveredDevices.set(deviceId,true);const device=this.getBleDevice(event.device);const result={device,localName:device.name,rssi:event.rssi,txPower:event.txPower,manufacturerData:mapToObject(event.manufacturerData),serviceData:mapToObject(event.serviceData),uuids:(_b=event.uuids)===null||_b===void 0?void 0:_b.map(webUUIDToString)};this.notifyListeners("onScanResult",result)}}async stopLEScan(){var _a;if((_a=this.scan)===null||_a===void 0?void 0:_a.active){this.scan.stop()}this.scan=null}async getDevices(options){const devices=await navigator.bluetooth.getDevices();const bleDevices=devices.filter(device=>options.deviceIds.includes(device.id)).map(device=>{this.deviceMap.set(device.id,device);const bleDevice=this.getBleDevice(device);return bleDevice});return{devices:bleDevices}}async getConnectedDevices(_options){const devices=await navigator.bluetooth.getDevices();const bleDevices=devices.filter(device=>{var _a;return(_a=device.gatt)===null||_a===void 0?void 0:_a.connected}).map(device=>{this.deviceMap.set(device.id,device);const bleDevice=this.getBleDevice(device);return bleDevice});return{devices:bleDevices}}async connect(options){var _a,_b;const device=this.getDeviceFromMap(options.deviceId);device.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback);device.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);const timeoutError=Symbol();if(device.gatt===void 0){throw new Error("No gatt server available.")}try{const timeout=(_a=options.timeout)!==null&&_a!==void 0?_a:this.DEFAULT_CONNECTION_TIMEOUT;await runWithTimeout(device.gatt.connect(),timeout,timeoutError)}catch(error){await((_b=device.gatt)===null||_b===void 0?void 0:_b.disconnect());if(error===timeoutError){throw new Error("Connection timeout")}else{throw error}}}onDisconnected(event){const deviceId=event.target.id;const key=`disconnected|${deviceId}`;this.notifyListeners(key,null)}async createBond(_options){throw this.unavailable("createBond is not available on web.")}async isBonded(_options){throw this.unavailable("isBonded is not available on web.")}async disconnect(options){var _a;(_a=this.getDeviceFromMap(options.deviceId).gatt)===null||_a===void 0?void 0:_a.disconnect()}async getServices(options){var _a,_b;const services=(_b=await((_a=this.getDeviceFromMap(options.deviceId).gatt)===null||_a===void 0?void 0:_a.getPrimaryServices()))!==null&&_b!==void 0?_b:[];const bleServices=[];for(const service of services){const characteristics=await service.getCharacteristics();const bleCharacteristics=[];for(const characteristic of characteristics){bleCharacteristics.push({uuid:characteristic.uuid,properties:this.getProperties(characteristic),descriptors:await this.getDescriptors(characteristic)})}bleServices.push({uuid:service.uuid,characteristics:bleCharacteristics})}return{services:bleServices}}async getDescriptors(characteristic){try{const descriptors=await characteristic.getDescriptors();return descriptors.map(descriptor=>({uuid:descriptor.uuid}))}catch(_a){return[]}}getProperties(characteristic){return{broadcast:characteristic.properties.broadcast,read:characteristic.properties.read,writeWithoutResponse:characteristic.properties.writeWithoutResponse,write:characteristic.properties.write,notify:characteristic.properties.notify,indicate:characteristic.properties.indicate,authenticatedSignedWrites:characteristic.properties.authenticatedSignedWrites,reliableWrite:characteristic.properties.reliableWrite,writableAuxiliaries:characteristic.properties.writableAuxiliaries}}async getCharacteristic(options){var _a;const service=await((_a=this.getDeviceFromMap(options.deviceId).gatt)===null||_a===void 0?void 0:_a.getPrimaryService(options===null||options===void 0?void 0:options.service));return service===null||service===void 0?void 0:service.getCharacteristic(options===null||options===void 0?void 0:options.characteristic)}async getDescriptor(options){const characteristic=await this.getCharacteristic(options);return characteristic===null||characteristic===void 0?void 0:characteristic.getDescriptor(options===null||options===void 0?void 0:options.descriptor)}async discoverServices(_options){throw this.unavailable("discoverServices is not available on web.")}async getMtu(_options){throw this.unavailable("getMtu is not available on web.")}async requestConnectionPriority(_options){throw this.unavailable("requestConnectionPriority is not available on web.")}async readRssi(_options){throw this.unavailable("readRssi is not available on web.")}async read(options){const characteristic=await this.getCharacteristic(options);const value=await(characteristic===null||characteristic===void 0?void 0:characteristic.readValue());return{value}}async write(options){const characteristic=await this.getCharacteristic(options);let dataView;if(typeof options.value==="string"){dataView=hexStringToDataView(options.value)}else{dataView=options.value}await(characteristic===null||characteristic===void 0?void 0:characteristic.writeValueWithResponse(dataView))}async writeWithoutResponse(options){const characteristic=await this.getCharacteristic(options);let dataView;if(typeof options.value==="string"){dataView=hexStringToDataView(options.value)}else{dataView=options.value}await(characteristic===null||characteristic===void 0?void 0:characteristic.writeValueWithoutResponse(dataView))}async readDescriptor(options){const descriptor=await this.getDescriptor(options);const value=await(descriptor===null||descriptor===void 0?void 0:descriptor.readValue());return{value}}async writeDescriptor(options){const descriptor=await this.getDescriptor(options);let dataView;if(typeof options.value==="string"){dataView=hexStringToDataView(options.value)}else{dataView=options.value}await(descriptor===null||descriptor===void 0?void 0:descriptor.writeValue(dataView))}async startNotifications(options){const characteristic=await this.getCharacteristic(options);characteristic===null||characteristic===void 0?void 0:characteristic.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback);characteristic===null||characteristic===void 0?void 0:characteristic.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback);await(characteristic===null||characteristic===void 0?void 0:characteristic.startNotifications())}onCharacteristicValueChanged(event){var _a,_b;const characteristic=event.target;const key=`notification|${(_a=characteristic.service)===null||_a===void 0?void 0:_a.device.id}|${(_b=characteristic.service)===null||_b===void 0?void 0:_b.uuid}|${characteristic.uuid}`;this.notifyListeners(key,{value:characteristic.value})}async stopNotifications(options){const characteristic=await this.getCharacteristic(options);await(characteristic===null||characteristic===void 0?void 0:characteristic.stopNotifications())}getFilters(options){var _a;const filters=[];for(const service of(_a=options===null||options===void 0?void 0:options.services)!==null&&_a!==void 0?_a:[]){filters.push({services:[service],name:options===null||options===void 0?void 0:options.name,namePrefix:options===null||options===void 0?void 0:options.namePrefix})}if(((options===null||options===void 0?void 0:options.name)||(options===null||options===void 0?void 0:options.namePrefix))&&filters.length===0){filters.push({name:options.name,namePrefix:options.namePrefix})}return filters}getDeviceFromMap(deviceId){const device=this.deviceMap.get(deviceId);if(device===void 0){throw new Error(\'Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.\')}return device}getBleDevice(device){var _a;const bleDevice={deviceId:device.id,name:(_a=device.name)!==null&&_a!==void 0?_a:void 0};return bleDevice}}}});var __create3=Object.create;var __defProp23=Object.defineProperty;var __getOwnPropDesc3=Object.getOwnPropertyDescriptor;var __getOwnPropNames22=Object.getOwnPropertyNames;var __getProtoOf3=Object.getPrototypeOf;var __hasOwnProp3=Object.prototype.hasOwnProperty;var __require22=(x3=>typeof __require4!=="undefined"?__require4:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b)=>(typeof __require4!=="undefined"?__require4:a)[b]}):x3)(function(x3){if(typeof __require4!=="undefined")return __require4.apply(this,arguments);throw new Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var __commonJS3=(cb,mod)=>function __require222(){return mod||(0,cb[__getOwnPropNames22(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps3=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames22(from))if(!__hasOwnProp3.call(to,key)&&key!==except)__defProp23(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc3(from,key))||desc.enumerable})}return to};var __toESM3=(mod,isNodeMode,target)=>(target=mod!=null?__create3(__getProtoOf3(mod)):{},__copyProps3(isNodeMode||!mod||!mod.__esModule?__defProp23(target,"default",{value:mod,enumerable:true}):target,mod));var require_browser2=__commonJS3({"node_modules/web-worker/cjs/browser.js"(exports,module2){module2.exports=Worker}});var EventHandler3=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.ctr=0;this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}if(this.triggers[statesubKey3]){let run=fn=>{fn(updateObj)};this.triggers[statesubKey3].forEach(v2=>{run(v2.onchange)})}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value,this.triggers[key]);this.triggers[key].forEach(fn)}};this.subscribeState=onchange=>{return this.subscribeEvent(statesubKey3,onchange)};this.unsubscribeState=sub=>{return this.unsubscribeEvent(statesubKey3,sub)};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.ctr;this.ctr++;this.triggers[key].push({sub:l,onchange});return l}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(sub===void 0){delete this.triggers[key];delete this.data[key]}else{let idx=void 0;let obj=triggers.find((o,i22)=>{if(o.sub===sub){idx=i22;return true}});if(obj)triggers.splice(idx,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed);return sub};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var statesubKey3="*s";var state3=new EventHandler3;var GraphNode2=class{constructor(properties,parent,graph){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:state3};this.__setProperties=(properties2,parent2,graph2)=>{let enforceProperties=()=>{let orig=properties2;if(typeof properties2==="function"){if(isNativeClass2(properties2)){properties2=new properties2}else properties2={__operator:properties2,__node:{forward:true,tag:properties2.name}}}else if(typeof properties2==="string"){if(graph2?.get(properties2)){properties2=graph2.get(properties2)}}if(!("__node"in properties2))properties2.__node={};if(!properties2.__node.initial)properties2.__node.initial=orig};enforceProperties();if(typeof properties2==="object"){let assignState=()=>{if(properties2.__node?.state)this.__node.state=properties2.__node.state;else if(graph2){properties2.__node.state=graph2.__node.state}};let setProps22=()=>{if(properties2.__props){if(typeof properties2.__props==="function")properties2.__props=new properties2.__props;if(typeof properties2.__props==="object"){this.__proxyObject(properties2.__props)}}};let setTag=()=>{if(!properties2.__node.tag){if(properties2.__operator?.name)properties2.__node.tag=properties2.__operator.name;else properties2.__node.tag=`node${Math.floor(Math.random()*1e15)}`}};let setNode=()=>{if(typeof properties2.__node==="string"){if(graph2?.get(properties2.__node.tag)){properties2=graph2.get(properties2.__node.tag)}else properties2.__node={}}else if(!properties2.__node)properties2.__node={};if(graph2){properties2.__node.graph=graph2}if(properties2 instanceof Graph2)properties2.__node.source=properties2};let setParent=()=>{if(!properties2.__parent&&parent2)properties2.__parent=parent2;if(parent2?.__node&&!(parent2 instanceof Graph2||properties2 instanceof Graph2))properties2.__node.tag=parent2.__node.tag+"."+properties2.__node.tag;if(parent2 instanceof Graph2&&properties2 instanceof Graph2){if(properties2.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties2.__node.loaders);if(parent2.__node.mapGraphs){properties2.__node.nodes.forEach(n=>{parent2.set(properties2.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties2.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties2.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}};let setOp=()=>{if(typeof properties2.default==="function"&&!properties2.__operator){properties2.__operator=properties2.default}if(properties2.__operator){if(typeof properties2.__operator==="string"){if(graph2){let n=graph2.get(properties2.__operator);if(n)properties2.__operator=n.__operator;if(!properties2.__node.tag&&properties2.__operator.name)properties2.__node.tag=properties2.__operator.name}}if(typeof properties2.__operator==="function")properties2.__operator=this.__setOperator(properties2.__operator);if(properties2.default)properties2.default=properties2.__operator}};let assignProps=()=>{properties2.__node=Object.assign(this.__node,properties2.__node);let keys22=Object.getOwnPropertyNames(properties2);for(const key of keys22){if(key in properties2)this[key]=properties2[key]}};let bindCallbacks=()=>{if(this.__onconnected){if(typeof this.__onconnected==="function"){this.__onconnected=this.__onconnected.bind(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected=this.__onconnected.map(f=>{return f.bind(this)})}if(typeof this.__ondisconnected==="function"){this.__ondisconnected=this.__ondisconnected.bind(this)}else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected=this.__ondisconnected.map(f=>{return f.bind(this)})}}};assignState();setTag();setProps22();setNode();setParent();assignProps();bindCallbacks();setOp()}};this.__subscribe=(callback,key,subInput,target,tkey,args)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>target2?target2:callback2,triggerCallback=callback)=>{if(args){triggerCallback=wrapArgs2(triggerCallback,args,this.__node.graph)}let sub=this.__node.state.subscribeEvent(k,triggerCallback,this,key);let trigger=this.__node.state.getEvent(k,sub);if(!this.__listeners)this.__listeners={};this.__listeners[k]=this.__node.state.triggers[k];if(!trigger)return sub;trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback,target);if(subInput)trigger.subInput=subInput;if(args)trigger.__args=args;if(tkey)trigger.tkey=tkey;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){target=callback2.substring(0,callback2.lastIndexOf("."));let n=this.__node.graph.get(callback2.substring(0,target));tkey=callback2.lastIndexOf(".")+1;if(n&&typeof n[key]==="function")callback2=(...args2)=>{return n[tkey](...args2)}}else if(fn.__operator){callback2=fn.__operator;tkey="__operator"}};if(key){if(!this.__node.localState||!this.__node.localState[key]){this.__addLocalState(this,key)}if(typeof callback==="string"){tkey=callback;if(target){if(this.__node.graph?.get(target)){let n=this.__node.graph?.get(target);if(typeof n[callback]==="function"){let fn=n[callback];callback=(...inp)=>{fn(...inp)}}else{let k2=callback;let setter=inp=>{n[k2]=inp};callback=setter}}}else if(typeof this[callback]==="function"){let fn=this[callback];callback=(...inp)=>{fn(...inp)}}else if(this.__node.graph?.get(callback))subscribeToGraph(callback);if(typeof callback!=="function")return void 0}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}else{if(typeof callback==="string"){if(this.__node.graph.get(callback))callback=this.__node.graph.get(callback);tkey="__operator";if(typeof callback!=="object")return void 0}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node){sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)})}return sub}};this.__unsubscribe=(sub,key,unsubInput)=>{if(key){return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub)}else return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);if(this.__args&&this.__node.graph){fn=wrapArgs2(fn,this.__args,this.__node.graph)}let inpstr=`${this.__node.unique}input`;this.__operator=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(this.__parent instanceof GraphNode2&&!this.__subscribedToParent){if(this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__addLocalState=(props,key)=>{if(!props)return;if(!this.__node.localState){this.__node.localState={}}const localState=this.__node.localState;const initState=(props2,k)=>{let str32=this.__node.unique+"."+k;let inpstr=`${str32}input`;if(typeof props2[k]==="function"&&k!=="__operator"){let fn=props2[k].bind(this);props2[k]=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[str32]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.triggerEvent(str32,res)}).catch(console.error)}else this.__node.state.triggerEvent(str32,result)}return result}}else{let get,set;if(this.__props?.[k]){get=()=>{return this.__props[k]};set=v2=>{this.__props[k]=v2;if(this.__node.state.triggers[str32])this.__node.state.triggerEvent(str32,v2)}}else{localState[k]=props2[k];get=()=>{return localState[k]};set=v2=>{localState[k]=v2;if(this.__node.state.triggers[str32])this.__node.state.triggerEvent(str32,v2)}}const descriptor={get,set,enumerable:true,configurable:true};Object.defineProperty(props2,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}};if(key)initState(props,key);else{for(let k in props){initState(props,k)}}};this.__proxyObject=obj=>{const allProps=getAllProperties2(obj);for(const k of allProps){if(typeof obj[k]==="function"){this[k]=(...args)=>{return obj[k](...args)}}else{const descriptor={get:()=>{return obj[k]},set:value=>{obj[k]=value},enumerable:true,configurable:true};Object.defineProperty(this,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}}};this.__setProperties(properties,parent,graph)}__addOnconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__onconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){let fn=o=>{o(this)};this.__onconnected.forEach(fn)}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let fn=o=>{o(this)};this.__ondisconnected.forEach(fn)}}};var Graph2=class{constructor(options){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:state3,roots:{}};this.init=options2=>{if(options2){let cpy=Object.assign({},options2);delete cpy.roots;recursivelyAssign3(this.__node,cpy);if(options2.roots)this.load(options2.roots)}};this.load=roots=>{function recursivelyAssignChildren(target,obj,inChildren=true,top=true){if(top){if(target)Object.assign(target,obj);else target=Object.assign({},obj);recursivelyAssignChildren(target,obj,true,false)}if(obj.__children&&!inChildren){if(obj.__children?.constructor.name==="Object"){if(target.__children?.constructor.name==="Object")recursivelyAssignChildren(target.__children,obj.__children,true,false);else target.__children=recursivelyAssignChildren({},obj.__children,true,false)}else{target.__children=obj.__children}}else if(inChildren){for(const key in obj){target[key]=Object.assign({},obj[key]);if(obj[key].__children){recursivelyAssignChildren({},obj[key].__children,false,false)}}}return target}this.__node.roots=recursivelyAssignChildren(this.__node.roots?this.__node.roots:{},roots);let cpy=Object.assign({},roots);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,roots);if(roots.__node){if(!roots.__node.tag)roots.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(roots.__node.tag)){let node=new GraphNode2(roots,this,this);this.set(node.__node.tag,node);this.runLoaders(node,this,roots,roots.__node.tag);if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(roots.__listeners){this.setListeners(roots.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders22,replace)=>{if(replace)this.__node.loaders=loaders22;else Object.assign(this.__node.loaders,loaders22);return this.__node.loaders};this.runLoaders=(node,parent,properties,key)=>{for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders[l]==="function")this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key)}};this.add=(properties,parent)=>{let listeners={};if(typeof parent==="string")parent=this.get(parent);let instanced;if(typeof properties==="function"){if(isNativeClass2(properties)){if(properties.prototype instanceof GraphNode2){properties=properties.prototype.constructor(properties,parent,this);instanced=true}else properties=new properties}else properties={__operator:properties}}else if(typeof properties==="string"){properties=this.__node.roots[properties]}if(!properties)return;if(!instanced){let keys22=Object.getOwnPropertyNames(properties);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(properties));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys22.push(...nonArrowFunctions);let cpy={};for(const key of keys22){cpy[key]=properties[key]}properties=cpy}if(!properties.__node)properties.__node={};properties.__node.initial=properties;if(typeof properties==="object"&&!this.get(properties.__node.tag)){let node;if(instanced)node=properties;else node=new GraphNode2(properties,parent,this);this.set(node.__node.tag,node);this.runLoaders(node,parent,properties,node.__node.tag);this.__node.roots[node.__node.tag]=properties;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key in node.__listeners){let listener=node.__listeners[key];if(node[key]){delete listeners[node.__node.tag][key];listeners[node.__node.tag][node.__node.tag+"."+key]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][key]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode2&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][key]=parent.__node.tag}}}}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t22,parent,listeners={},origin)=>{let keys22=Object.getOwnPropertyNames(origin);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(origin));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys22.push(...nonArrowFunctions);for(const key of keys22){if(key.includes("__"))continue;let p2=origin[key];if(Array.isArray(p2))continue;let instanced;if(typeof p2==="function"){if(isNativeClass2(p2)){p2=new p2;if(p2 instanceof GraphNode2){p2=p2.prototype.constructor(p2,parent,this);instanced=true}}else p2={__operator:p2}}else if(typeof p2==="string"){if(this.__node.nodes.get(p2))p2=this.__node.nodes.get(p2);else p2=this.__node.roots[p2]}else if(typeof p2==="boolean"){if(this.__node.nodes.get(key))p2=this.__node.nodes.get(key);else p2=this.__node.roots[key]}if(typeof p2==="object"){if(!instanced&&!(p2 instanceof GraphNode2)){let ks=Object.getOwnPropertyNames(p2);let nonArrowFunctions2=Object.getOwnPropertyNames(Object.getPrototypeOf(p2));nonArrowFunctions2.splice(nonArrowFunctions2.indexOf("constructor"),1);ks.push(...nonArrowFunctions2);let cpy={};for(const key2 of ks){cpy[key2]=p2[key2]}p2=cpy}if(!p2.__node)p2.__node={};if(!p2.__node.tag)p2.__node.tag=key;if(!p2.__node.initial)p2.__node.initial=t22[key];if(this.get(p2.__node.tag)&&!(!(parent instanceof Graph2)&&parent?.__node)||parent?.__node&&this.get(parent.__node.tag+"."+p2.__node.tag))continue;let node;let newnode=false;if(instanced||p2 instanceof GraphNode2){node=p2}else{node=new GraphNode2(p2,parent,this);newnode=true}if(!newnode&&p2 instanceof GraphNode2&&!instanced&&parent instanceof GraphNode2){let sub=this.subscribe(parent.__node.tag,node.__node.tag);let ondelete=node2=>{this.unsubscribe(parent.__node.tag,sub)};node.__addOndisconnected(ondelete)}else if(node){this.set(node.__node.tag,node);this.runLoaders(node,parent,t22[key],key);t22[key]=node;this.__node.roots[node.__node.tag]=p2;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key2 in node.__listeners){let listener=node.__listeners[key2];let k=key2;if(node[key2]){delete listeners[node.__node.tag][key2];k=node.__node.tag+"."+key2;listeners[node.__node.tag][k]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][k]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode2&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][k]=parent.__node.tag}}}}node.__callConnected()}}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode2){this.delete(node.__node.tag);delete this.__node.roots[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t22=>{for(const key in t22){this.unsubscribe(t22[key]);this.delete(t22[key].__node.tag);delete this.__node.roots[t22[key].__node.tag];this.delete(key);delete this.__node.roots[key];t22[key].__node.tag=t22[key].__node.tag.substring(t22[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t22[key])}t22[key].__callDisconnected();if(t22[key].__children){recursiveRemove(t22[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}if(node?.__node.graph)node.__node.graph=void 0;return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(!node)continue;if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(node.__operator&&(listeners[key][k][kk].__callback===true||typeof listeners[key][k][kk].__callback==="undefined"))listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(nn){let prop=k.substring(k.lastIndexOf(".")+1);sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k][kk].__args,prop,listeners[key][k][kk].inputState,key,k)}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}if("__callback"in listeners[key][k]){if(listeners[key][k].__callback===true||typeof listeners[key][k].__callback==="undefined")listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k)}}else{sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key]?.sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(typeof node.__listeners[key]==="object"&&!node.__listeners[key]?.__callback){for(const k in node.__listeners[key]){if(typeof node.__listeners[key][k]?.sub==="number"){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}else{if(typeof!node.__listeners[key]?.__callback==="number"){for(const k in node.__listeners[key]){if(node.__listeners[key][k]?.sub){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode2){let cpy;if(getInitial)cpy=Object.assign({},this.__node.roots[node.__node.tag]);else{cpy=Object.assign({},node);for(const key in cpy){if(key.includes("__"))delete cpy[key]}}}};this.subscribe=(nodeEvent,onEvent,args,key,subInput,target,bound,tkey)=>{let nd=nodeEvent;if(typeof nodeEvent==="string"){nd=this.get(nodeEvent);if(!nd&&nodeEvent.includes(".")){nd=this.get(nodeEvent.substring(0,nodeEvent.lastIndexOf(".")));key=nodeEvent.substring(nodeEvent.lastIndexOf(".")+1)}}if(target instanceof GraphNode2)target=target.__node.tag;if(typeof onEvent==="string"){let setOnEventFromString=onEvent2=>{if(this.get(onEvent2)?.__operator){let node=this.get(onEvent2);target=onEvent2;onEvent2=function(...inp){return node.__operator(...inp)}}else if(onEvent2.includes(".")){target=onEvent2.substring(0,onEvent2.lastIndexOf("."));let n=this.get(target);let k=onEvent2.substring(onEvent2.lastIndexOf(".")+1);tkey=k;if(typeof n[k]==="function"){if(n[k]instanceof GraphNode2)onEvent2=n[k];else onEvent2=function(...inp){return n[k](...inp)}}else{onEvent2=function(inp){n[k]=inp;return n[k]}}}return onEvent2};if(target){let node=this.get(target);if(typeof node?.[onEvent]==="function"){tkey=onEvent;onEvent=function(...inp){return node[key](...inp)}}else if(node[key]){tkey=key;if(node[key]instanceof GraphNode2)onEvent=node[key];else onEvent=function(inp){node[key]=inp;return node[key]}}else{onEvent=setOnEventFromString(onEvent)}}else{onEvent=setOnEventFromString(onEvent)}}let sub;if(nd instanceof GraphNode2){const doSub=()=>{sub=nd.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)nd.__unsubscribe(sub,key,subInput);sub=void 0};nd.__addOndisconnected(()=>{ondelete();nd.__addOnconnected(()=>{if(sub===void 0&&nd.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))onEvent=this.get(onEvent);if(onEvent instanceof GraphNode2){onEvent.__addOndisconnected(()=>{ondelete()})}};doSub()}else if(typeof nodeEvent==="string"){let node=this.get(nodeEvent);if(node){if(onEvent instanceof GraphNode2&&onEvent.__operator){const doSub=()=>{sub=node.__subscribe(onEvent.__operator,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput)};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});onEvent.__addOndisconnected(ondelete)};doSub()}else if(typeof onEvent==="function"||typeof onEvent==="string"){const doSub=()=>{sub=node.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput);sub=void 0};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))this.get(onEvent).__addOndisconnected(ondelete)};doSub()}}else{if(typeof onEvent==="string")onEvent=this.__node.nodes.get(onEvent).__operator;if(typeof onEvent==="function")sub=this.__node.state.subscribeEvent(nodeEvent,onEvent)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode2){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign3(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"){if(target[key]?.constructor.name==="Object")recursivelyAssign3(target[key],obj[key]);else target[key]=recursivelyAssign3({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties2(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);let fn=function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)};props.forEach(fn)}while(curr=Object.getPrototypeOf(curr));return allProps}function isNativeClass2(thing){return isFunction2(thing)==="class"}function isFunction2(x3){const res=typeof x3==="function"?x3.prototype?Object.getOwnPropertyDescriptor(x3,"prototype")?.writable?"function":"class":x3.constructor.name==="AsyncFunction"?"async":"arrow":"";return res}var wrapArgs2=(callback,argOrder,graph)=>{let args=[];let getCallbackFromString=a=>{if(graph.get(a)?.__operator){let node=graph.get(a);return(...inp)=>{node.__operator(...inp)}}else if(a.includes(".")){let split=a.split(".");let popped=split.pop();let joined=split.join(".");let node=graph.get(joined);if(typeof graph.get(joined)?.[popped]==="function"){return(...inp)=>{return node[popped](...inp)}}else return()=>{return node[popped]}}else if(graph.get(a)){let node=graph.get(a);return()=>{return node}}else{let arg=a;return()=>{return arg}}};let forArg=(a,i22)=>{if(a==="__output"||a==="__input"){args[i22]=inp=>{return inp}}else if(typeof a==="string"){args[i22]=getCallbackFromString(a)}else if(typeof a==="function"){let fn2=a;args[i22]=(...inp)=>{return fn2(...inp)}}else if(typeof a==="object"&&a.__input){let recursivelyCreateCallback=function(c){let input=c.__input;if(typeof c.__input==="string"){input=getCallbackFromString(c.__input)}if(c.__args){input=wrapArgs2(input,c.__args,graph)}if(c.__output){let output=c.__output;if(typeof c.__output==="string"){output=getCallbackFromString(output)}else if(typeof a.__output==="object"){output=recursivelyCreateCallback(output)}if(typeof output==="function"){let fn2=input;input=(...inp)=>{return output(fn2(...inp))}}}return input};args[i22]=recursivelyCreateCallback(a)}else{let arg=a;args[i22]=()=>{return arg}}};argOrder.forEach(forArg);if(typeof callback==="string")callback=getCallbackFromString(callback);let fn=callback;callback=function(...inp){let mapArg=arg=>{return arg(...inp)};return fn(...args.map(mapArg))};return callback};var backprop2=(node,parent,graph)=>{if(node.__node.backward&&parent instanceof GraphNode2){graph.setListeners({[parent.__node.tag]:{[node.__node.tag]:parent}})}};var loop2=(node,parent,graph)=>{if(node.__operator&&!node.__node.looperSet){if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})})}else if(node.__node.frame===true){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})})}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__setOperator(async(...args)=>{let i22=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i22,...args);return result})}if(node.__node.loop&&typeof node.__node.loop==="number"){node.__node.looperSet=true;let fn=node.__operator;let time=node.__node.loop;node.__setOperator((...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){let last=performance.now();fn(...args);setTimeout(()=>{let now=performance.now();let overshoot=now-last-node.__node.loop;if(overshoot>0)time=node.__node.loop-overshoot;else time=node.__node.loop;if(time<=0)time=node.__node.loop;node.__operator(...args)},time)}});if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate2=(node,parent,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__setOperator((...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}});if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator)},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching2=(node,parent,graph)=>{if(typeof node.__branch==="object"&&node.__operator&&!node.__branchApplied){let fn=node.__operator;node.__branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__branch){let triggered=()=>{if(typeof node.__branch[key].then==="function"){node.__branch[key].then(result)}else if(node.__branch[key].then instanceof GraphNode2&&node.__branch[key].then.__operator){node.__branch[key].then.__operator(result)}else result=node.__branch[key].then};if(typeof node.__branch[key].if==="function"){if(node.__branch[key].if(result)==true){triggered()}}else if(node.__branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode2&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate2=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener2=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult2=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator2=(node,parent,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.roots?.[node.__node.tag]==="object"&&node.get)graph.__node.roots[node.__node.tag].get=node.get};var loaders2={backprop:backprop2,loop:loop2,animate:animate2,branching:branching2,triggerListenerOncreate:triggerListenerOncreate2,bindListener:bindListener2,transformListenerResult:transformListenerResult2,substitute__operator:substitute__operator2};var recursivelyStringifyFunctions2=obj=>{let cpy={};for(const key in obj){if(typeof obj[key]==="object"){cpy[key]=recursivelyStringifyFunctions2(obj[key])}else if(typeof obj[key]==="function"){cpy[key]=obj[key].toString()}else cpy[key]=obj[key]}return cpy};function parseFunctionFromText4(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs3=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs3}var stringifyFast3=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p2 in value[prop]){if(Array.isArray(value[prop][p2])){if(value[prop][p2].length>20)obj[prop][p2]=value[prop][p2].slice(value[prop][p2].length-20);else obj[prop][p2]=value[prop][p2]}else{if(value[prop][p2]!=null){let con=value[prop][p2].constructor.name;if(con.includes("Set")){obj[prop][p2]=Array.from(value[prop][p2])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p2]="instanceof_"+con}else{obj[prop][p2]=value[prop][p2]}}else{obj[prop][p2]=value[prop][p2]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast3}function methodstrings2(node){if(typeof node.__methods==="object"){for(const key in node.__methods){let fstr=node.__methods[key];let fn=typeof fstr==="function"?fstr:parseFunctionFromText4(fstr);if(key==="__operator"){node.__setOperator(fn)}else{node[key]=fn.bind(node)}}}}var Service2=class extends Graph2{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders2},options.loaders):{...loaders2}});this.name=`service${Math.floor(Math.random()*1e15)}`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.load(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.roots[route]}if(src?.[m]){if(typeof src[m]!=="function"){if(args){if(Array.isArray(args)&&args.length===1)src[m]=args[0];else src[m]=args;return}return src[m]}else{if(Array.isArray(args))return src[m](...args);else return src[m](args)}}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))args[0]=args[0].replace(/\\\\/g,"");if(args[0][0]===\'"\'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode2){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode2){if(callback)return source.__node.state.subscribeEventOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeEventOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray2;this.recursivelyAssign=recursivelyAssign22;this.spliceTypedArray=spliceTypedArray2;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};this.log=(...args)=>{console.log(...args);return true};this.error=(...args)=>{console.error(...args);return true};if(options?.services)this.addServices(options.services);this.load(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray2(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}var recursivelyAssign22=(target,obj)=>{for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign22(target[key],obj[key]);else target[key]=recursivelyAssign22({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray2(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}var nodeTemplates2={};var remoteGraphRoutes2={transferNode:(properties,connection,name2)=>{let str32;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str32=recursivelyStringifyFunctions2(properties)}else if(typeof properties==="function")str32=properties.toString();else if(typeof properties==="string")str32=properties;if(str32){if(connection.run)return connection.run("setNode",[str32]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str32},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str32}));return new Promise(r=>r(name2))}}},setNode:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings2}}}if(typeof properties==="string"){let f=parseFunctionFromText4(properties);if(typeof f==="function")properties={__operator:f,__node:{tag:name2?name2:f.name}};else{f=JSON.parse(properties);if(typeof f==="object")properties=f}}if(typeof properties==="object"||typeof properties==="function"){let template={};if(typeof properties==="object")Object.assign(template,properties);else template.__operator=properties;let node=this.__node.graph.add(template);if(node){nodeTemplates2[node.__node.tag]=template;return node.__node?.tag}else return false}else return false},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]==="function"){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str32=recursivelyStringifyFunctions2(properties);return str32},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings2}}}if(typeof properties==="string"){let f=parseFunctionFromText4(properties);if(typeof f==="function"){if(!name2)name2=f.name;properties={__operator:f,__node:{tag:name2}}}else{f=JSON.parse(properties);if(typeof f==="object"){properties=f;if(!name2&&f.__node?.tag)name2=f.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates2[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates2[templateName]){let cpy=recursivelyAssign22({},nodeTemplates2[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(nodeTag,fn,methodKey){if(typeof fn==="string"){let f=parseFunctionFromText4(fn);if(typeof f==="function")fn=f}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(nodeTag)){this.__node.graph.get(nodeTag)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key in properties){result[key]=typeof node[key]}return result}return void 0},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str32=classObj.toString();let message={route:"receiveClass",args:[str32,className]};if(connection.run)return connection.run("receiveClass",[str32,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str32,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str32,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str32=fn.toString();let message={route:"setNode",args:[str32,fnName]};if(connection.run)return connection.run("setNode",[str32,fnName]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:[str32,fnName]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:[str32,fnName]}));return new Promise(r=>r(name))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText4(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText4(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};function html2(strings,...args){return function append(elm=document.createElement("div")){let template=document.createElement("template");strings.map(function(s,i22){template.innerHTML+=s;if(args[i22]instanceof HTMLElement){let dummy22=`<span id="dummyNode12345"></span>`;dummy22.id="dummyNode12345";template.innerHTML+=dummy22}else template.innerHTML+=args[i22]});let query=template.content.querySelectorAll("#dummyNode12345");let ctr=0;args.forEach((arg,i22)=>{if(arg instanceof HTMLElement){console.log(arg,query[ctr]);template.content.replaceChild(arg,query[ctr]);ctr++}});elm.appendChild(template.content);return elm}}var dummy2=html2``;var sjcl2={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl2.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d2,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl2.exception.invalid("invalid aes key size");this.b=[d2=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d2[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d2[a]=d2[a-b]^c}for(b=0;a;b++,a--)c=d2[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl2.cipher.aes.prototype={encrypt:function(a){return t2(this,a,0)},decrypt:function(a){return t2(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d2=b[4],e,f,g,h=[],k=[],l,n,m,p2;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d2[m]=f,n=h[e=h[l=h[f]]],p2=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p2=p2<<24^p2>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t2(a,b,c){if(4!==b.length)throw new sjcl2.exception.invalid("invalid aes block size");var d2=a.b[c],e=b[0]^d2[0],f=b[c?3:1]^d2[1],g=b[2]^d2[2];b=b[c?1:3]^d2[3];var h,k,l,n=d2.length/4-2,m,p2=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v2=h[2],w=h[3],x3=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v2[g>>8&255]^w[b&255]^d2[p2],k=a[f>>>24]^q[g>>16&255]^v2[b>>8&255]^w[e&255]^d2[p2+1],l=a[g>>>24]^q[b>>16&255]^v2[e>>8&255]^w[f&255]^d2[p2+2],b=a[b>>>24]^q[e>>16&255]^v2[f>>8&255]^w[g&255]^d2[p2+3],p2+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x3[e>>>24]<<24^x3[f>>16&255]<<16^x3[g>>8&255]<<8^x3[b&255]^d2[p2++],h=e,e=f,f=g,g=b,b=h;return r}sjcl2.bitArray={bitSlice:function(a,b,c){a=sjcl2.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl2.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d2=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d2^a[b/32+1|0]>>>d2:a[b/32|0]>>>d2)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d2=sjcl2.bitArray.getPartial(c);return 32===d2?a.concat(b):sjcl2.bitArray.$(b,d2,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl2.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl2.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl2.bitArray.bitLength(a)!==sjcl2.bitArray.bitLength(b))return false;var c=0,d2;for(d2=0;d2<a.length;d2++)c|=a[d2]^b[d2];return 0===c},$:function(a,b,c,d2){var e;e=0;for(void 0===d2&&(d2=[]);32<=b;b-=32)d2.push(c),c=0;if(0===b)return d2.concat(a);for(e=0;e<a.length;e++)d2.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl2.bitArray.getPartial(e);d2.push(sjcl2.bitArray.partial(b+a&31,32<b+a?c:d2.pop(),1));return d2},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl2.codec.utf8String={fromBits:function(a){var b="",c=sjcl2.bitArray.bitLength(a),d2,e;for(d2=0;d2<c/8;d2++)0===(d2&3)&&(e=a[d2/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d2=0;for(c=0;c<a.length;c++)d2=d2<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d2),d2=0);c&3&&b.push(sjcl2.bitArray.partial(8*(c&3),d2));return b}};sjcl2.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl2.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d2;a=a.replace(/\\s|0x/g,"");d2=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl2.bitArray.clamp(c,4*d2)}};sjcl2.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d2=sjcl2.codec.base32.BASE,e=sjcl2.codec.base32.REMAINING,f="",g=0,h=sjcl2.codec.base32.B,k=0,l=sjcl2.bitArray.bitLength(a);c&&(h=sjcl2.codec.base32.X);for(c=0;f.length*d2<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d2?(k=a[c]<<d2-g,g+=e,c++):(k<<=d2,g-=d2);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\s|=/g,"").toUpperCase();var c=sjcl2.codec.base32.BITS,d2=sjcl2.codec.base32.BASE,e=sjcl2.codec.base32.REMAINING,f=[],g,h=0,k=sjcl2.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl2.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl2.codec.base32hex.toBits(a)}catch(p2){}throw new sjcl2.exception.invalid("this isn\'t "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d2,l^=n<<c-h)}h&56&&f.push(sjcl2.bitArray.partial(h&56,l,1));return f}};sjcl2.codec.base32hex={fromBits:function(a,b){return sjcl2.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl2.codec.base32.toBits(a,1)}};sjcl2.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d2="",e=0,f=sjcl2.codec.base64.B,g=0,h=sjcl2.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d2.length<h;)d2+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d2.length&3&&!b;)d2+="=";return d2},toBits:function(a,b){a=a.replace(/\\s|=/g,"");var c=[],d2,e=0,f=sjcl2.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d2=0;d2<a.length;d2++){h=f.indexOf(a.charAt(d2));if(0>h)throw new sjcl2.exception.invalid("this isn\'t base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl2.bitArray.partial(e&56,g,1));return c}};sjcl2.codec.base64url={fromBits:function(a){return sjcl2.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl2.codec.base64.toBits(a,1)}};sjcl2.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl2.hash.sha256.hash=function(a){return new sjcl2.hash.sha256().update(a).finalize()};sjcl2.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl2.codec.utf8String.toBits(a));var b,c=this.A=sjcl2.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl2.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl2.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d2=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u2(this,d2.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u2(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl2.bitArray.concat(b,[sjcl2.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u2(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d2,e;64>b;c++){e=true;for(d2=2;d2*d2<=c;d2++)if(0===c%d2){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u2(a,b){var c,d2,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p2=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d2=b[c]:(d2=b[c+1&15],e=b[c+14&15],d2=b[c&15]=(d2>>>7^d2>>>18^d2>>>3^d2<<25^d2<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d2=d2+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p2^r))+g[c],q=r,r=p2,p2=m,m=n+d2|0,n=l,l=k,k=h,h=d2+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p2|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl2.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl2.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl2.mode.ccm.G.indexOf(a);-1<a&&sjcl2.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl2.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d2,e){var f,g=b.slice(0),h=sjcl2.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d2=d2||[];if(7>k)throw new sjcl2.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl2.mode.ccm.V(a,b,c,d2,e,f);g=sjcl2.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d2,e){e=e||64;d2=d2||[];var f=sjcl2.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl2.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl2.mode.ccm.C(a,k,c,l,e,b);a=sjcl2.mode.ccm.V(a,k.data,c,d2,e,b);if(!f.equal(k.tag,a))throw new sjcl2.exception.corrupt("ccm: tag doesn\'t match");return k.data},na:function(a,b,c,d2,e,f){var g=[],h=sjcl2.bitArray,k=h.i;d2=[h.partial(8,(b.length?64:0)|d2-2<<2|f-1)];d2=h.concat(d2,c);d2[3]|=e;d2=a.encrypt(d2);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d2=a.encrypt(k(d2,g.slice(b,b+4).concat([0,0,0])));return d2},V:function(a,b,c,d2,e,f){var g=sjcl2.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl2.exception.invalid("ccm: invalid tag length");if(4294967295<d2.length||4294967295<b.length)throw new sjcl2.exception.bug("ccm: can\'t deal with 4GiB or more data");c=sjcl2.mode.ccm.na(a,d2,c,e,g.bitLength(b)/8,f);for(d2=0;d2<b.length;d2+=4)c=a.encrypt(h(c,b.slice(d2,d2+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d2,e,f){var g,h=sjcl2.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d2=h.bitSlice(g(d2,a.encrypt(c)),0,e);if(!k)return{tag:d2,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl2.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d2,data:h.clamp(b,l)}}};sjcl2.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d2,e,f){if(128!==sjcl2.bitArray.bitLength(c))throw new sjcl2.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl2.mode.ocb2.S,k=sjcl2.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p2=[];d2=d2||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p2=p2.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d2.length&&(n=l(n,f?d2:sjcl2.mode.ocb2.pmac(a,d2)));return p2.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d2,e,f){if(128!==sjcl2.bitArray.bitLength(c))throw new sjcl2.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl2.mode.ocb2.S,h=sjcl2.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p2,r=sjcl2.bitArray.bitLength(b)-e,q=[];d2=d2||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p2=r-32*c;m=a.encrypt(k(n,[0,0,0,p2]));m=k(m,h.clamp(b.slice(c),p2).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d2.length&&(l=k(l,f?d2:sjcl2.mode.ocb2.pmac(a,d2)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl2.exception.corrupt("ocb: tag doesn\'t match");return q.concat(h.clamp(m,p2))},pmac:function(a,b){var c,d2=sjcl2.mode.ocb2.S,e=sjcl2.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d2(d2(h)));for(c=0;c+4<b.length;c+=4)h=d2(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d2(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d2(f(h,d2(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl2.mode.gcm={name:"gcm",encrypt:function(a,b,c,d2,e){var f=b.slice(0);b=sjcl2.bitArray;d2=d2||[];a=sjcl2.mode.gcm.C(true,a,f,d2,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d2,e){var f=b.slice(0),g=sjcl2.bitArray,h=g.bitLength(f);e=e||128;d2=d2||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl2.mode.gcm.C(false,a,f,d2,c,e);if(!g.equal(a.tag,b))throw new sjcl2.exception.corrupt("gcm: tag doesn\'t match");return a.data},ka:function(a,b){var c,d2,e,f,g,h=sjcl2.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d2=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d2=3;0<d2;d2--)f[d2]=f[d2]>>>1|(f[d2-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d2,e=c.length;b=b.slice(0);for(d2=0;d2<e;d2+=4)b[0]^=4294967295&c[d2],b[1]^=4294967295&c[d2+1],b[2]^=4294967295&c[d2+2],b[3]^=4294967295&c[d2+3],b=sjcl2.mode.gcm.ka(b,a);return b},C:function(a,b,c,d2,e,f){var g,h,k,l,n,m,p2,r,q=sjcl2.bitArray;m=c.length;p2=q.bitLength(c);r=q.bitLength(d2);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl2.mode.gcm.j(g,[0,0,0,0],e),e=sjcl2.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl2.mode.gcm.j(g,[0,0,0,0],d2);n=e.slice(0);d2=h.slice(0);a||(d2=sjcl2.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p2);a&&(d2=sjcl2.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p2/4294967296),p2&4294967295];d2=sjcl2.mode.gcm.j(g,d2,a);k=b.encrypt(e);d2[0]^=k[0];d2[1]^=k[1];d2[2]^=k[2];d2[3]^=k[3];return{tag:q.bitSlice(d2,0,f),data:c}}};sjcl2.misc.hmac=function(a,b){this.W=b=b||sjcl2.hash.sha256;var c=[[],[]],d2,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d2=0;d2<e;d2++)c[0][d2]=a[d2]^909522486,c[1][d2]=a[d2]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl2.misc.hmac.prototype.encrypt=sjcl2.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl2.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl2.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl2.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl2.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl2.misc.pbkdf2=function(a,b,c,d2,e){c=c||1e4;if(0>d2||0>c)throw new sjcl2.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl2.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl2.codec.utf8String.toBits(b));e=e||sjcl2.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl2.bitArray;for(k=1;32*l.length<(d2||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d2&&(l=n.clamp(l,d2));return l};sjcl2.prng=function(a){this.c=[new sjcl2.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl2.prng.prototype={randomWords:function(a,b){var c=[],d2;d2=this.isReady(b);var e;if(d2===this.u)throw new sjcl2.exception.notReady("generator isn\'t seeded");if(d2&this.J){d2=!(d2&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d2||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl2.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl2.hash.sha256.hash(this.b.concat(e));this.L=new sjcl2.cipher.aes(this.b);for(d2=0;4>d2&&(this.h[d2]=this.h[d2]+1|0,!this.h[d2]);d2++);}for(d2=0;d2<a;d2+=4)0===(d2+1)%this.ca&&y3(this),e=z2(this),c.push(e[0],e[1],e[2],e[3]);y3(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl2.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d2,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d2=this.U[c];void 0===d2&&(d2=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d2,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d2,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d2,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl2.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A3("seeded",Math.max(this.o,this.f)),A3("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B2(this,this.ma),mouseCollector:B2(this,this.oa),keyboardCollector:B2(this,this.la),accelerometerCollector:B2(this,this.ea),touchCollector:B2(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl2.exception.bug("can\'t attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d2,e=this.K[a],f=[];for(d2 in e)e.hasOwnProperty(d2)&&e[d2]===b&&f.push(d2);for(c=0;c<f.length;c++)d2=f[c],delete e[d2]},la:function(){C3(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d2){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C3(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C3(this,0)},ma:function(){C3(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C3(this,0)}};function A3(a,b){var c,d2=sjcl2.random.K[a],e=[];for(c in d2)d2.hasOwnProperty(c)&&e.push(d2[c]);for(c=0;c<e.length;c++)e[c](b)}function C3(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y3(a){a.b=z2(a).concat(z2(a));a.L=new sjcl2.cipher.aes(a.b)}function z2(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B2(a,b){return function(){b.apply(a,arguments)}}sjcl2.random=new sjcl2.prng(6);a:try{if(G2="undefined"!==typeof module&&module.exports){try{H2=__require22("crypto")}catch(a){H2=null}G2=E2=H2}if(G2&&E2.randomBytes)D2=E2.randomBytes(128),D2=new Uint32Array(new Uint8Array(D2).buffer),sjcl2.random.addEntropy(D2,1024,"crypto[\'randomBytes\']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F3=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F3);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F3);else break a;sjcl2.random.addEntropy(F3,1024,"crypto[\'getRandomValues\']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D2;var E2;var F3;var G2;var H2;sjcl2.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d2){c=c||{};d2=d2||{};var e=sjcl2.json,f=e.g({iv:sjcl2.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl2.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl2.codec.base64.toBits(f.iv));if(!sjcl2.mode[f.mode]||!sjcl2.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl2.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl2.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl2.ecc&&a instanceof sjcl2.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl2.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl2.codec.utf8String.toBits(c));g=new sjcl2.cipher[f.cipher](a);e.g(d2,f);d2.key=a;f.ct="ccm"===f.mode&&sjcl2.arrayBuffer&&sjcl2.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl2.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl2.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d2){var e=sjcl2.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d2){c=c||{};d2=d2||{};var e=sjcl2.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl2.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl2.codec.base64.toBits(b.iv));if(!sjcl2.mode[b.mode]||!sjcl2.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl2.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl2.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl2.ecc&&a instanceof sjcl2.ecc.elGamal.secretKey&&(a=a.unkem(sjcl2.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl2.codec.utf8String.toBits(f));g=new sjcl2.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl2.arrayBuffer&&sjcl2.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl2.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl2.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d2,b);d2.key=a;return 1===c.raw?f:sjcl2.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d2){var e=sjcl2.json;return e.ia(a,e.decode(b),c,d2)},encode:function(a){var b,c="{",d2="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl2.exception.invalid("json encode: invalid property name");c+=d2+\'"\'+b+\'":\';d2=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+=\'"\'+escape(a[b])+\'"\';break;case"object":c+=\'"\'+sjcl2.codec.base64.fromBits(a[b],0)+\'"\';break;default:throw new sjcl2.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\s/g,"");if(!a.match(/^\\{.*\\}$/))throw new sjcl2.exception.invalid("json decode: this isn\'t json!");a=a.replace(/^\\{|\\}$/g,"").split(/,/);var b={},c,d2;for(c=0;c<a.length;c++){if(!(d2=a[c].match(/^\\s*(?:(["\']?)([a-z][a-z0-9]*)\\1)\\s*:\\s*(?:(-?\\d+)|"([a-z0-9+\\/%*_.@=\\-]*)"|(true|false))$/i)))throw new sjcl2.exception.invalid("json decode: this isn\'t json!");null!=d2[3]?b[d2[2]]=parseInt(d2[3],10):null!=d2[4]?b[d2[2]]=d2[2].match(/^(ct|adata|salt|iv)$/)?sjcl2.codec.base64.toBits(d2[4]):unescape(d2[4]):null!=d2[5]&&(b[d2[2]]="true"===d2[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d2 in b)if(b.hasOwnProperty(d2)){if(c&&void 0!==a[d2]&&a[d2]!==b[d2])throw new sjcl2.exception.invalid("required parameter overridden");a[d2]=b[d2]}return a},sa:function(a,b){var c={},d2;for(d2 in a)a.hasOwnProperty(d2)&&a[d2]!==b[d2]&&(c[d2]=a[d2]);return c},ra:function(a,b){var c={},d2;for(d2=0;d2<b.length;d2++)void 0!==a[b[d2]]&&(c[b[d2]]=a[b[d2]]);return c}};sjcl2.encrypt=sjcl2.json.encrypt;sjcl2.decrypt=sjcl2.json.decrypt;sjcl2.misc.pa={};sjcl2.misc.cachedPbkdf2=function(a,b){var c=sjcl2.misc.pa,d2;b=b||{};d2=b.iter||1e3;c=c[a]=c[a]||{};d2=c[d2]=c[d2]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl2.random.randomWords(2,0)};c=void 0===b.salt?d2.firstSalt:b.salt;d2[c]=d2[c]||sjcl2.misc.pbkdf2(a,c,b.iter);return{key:d2[c].slice(0),salt:c.slice(0)}};var _HTTPfrontend2=class extends Service2{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url2="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend2.request({method:"GET",url:url2,responseType:type,mimeType,onload:ev2=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url2 instanceof URL)url2=url2.toString();this.setState({[url2]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url2="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend2.request({method:"POST",url:url2,data:message,responseType:type,mimeType,onload:ev2=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url2 instanceof URL)url2=url2.toString();this.setState({[url2]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url2)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url2);return this.POST(message,url2)};this.transponder=(url2,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend2.request({method,url:url2,data:message,responseType:type,onload:ev2=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\"))body=body.replace(/\\\\/g,"");if(body[0]===\'"\'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode2){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=`${path2}${Math.floor(Math.random()*1e15)}`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch2,that,args){const result=fetch2.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.load(this);this.listen(path,fetched)}};var HTTPfrontend2=_HTTPfrontend2;HTTPfrontend2.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker2=__toESM3(require_browser2());var WorkerService2=class extends Service2{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt)}rt.worker=worker;if(!rt.worker.__ondisconnected){let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,void 0,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev2=>{let result=this.receive(ev2.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=`worker${Math.floor(Math.random()*1e15)}`;if(options2.url)worker=new import_web_worker2.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev2=>{if(typeof ev2.data==="object"){if(ev2.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev2.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev2=>{if(typeof ev2.data==="object"){if(ev2.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev2.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev2=>{this.receive(ev2.data);this.setState({[options2._id]:ev2.data})};if(!options2.onerror){options2.onerror=ev2=>{console.error(ev2.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.open=this.addWorker;this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker2.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys22=Object.keys(this.workers);this.workers[keys22[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys22.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof import_web_worker2.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker2.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker2.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev2=>{if(typeof ev2.data==="object"){if(ev2.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev2.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker2.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker2.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,args,key,subInput,blocking)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};this.subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i22=0;i22<this.__node.state.triggers[workerId].length;i22++){await this.__node.state.triggers[workerId][i22].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}};var mouseEventHandler2=makeSendPropertiesHandler2(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var wheelEventHandlerImpl2=makeSendPropertiesHandler2(["deltaX","deltaY"]);var keydownEventHandler2=makeSendPropertiesHandler2(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler2(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler2(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();wheelEventHandlerImpl2(event,sendFn)}function preventDefaultHandler2(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault()}function copyProperties2(src,properties,dst){for(const name2 of properties){dst[name2]=src[name2]}}function makeSendPropertiesHandler2(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties2(event,properties,data);sendFn(data)}}function touchEventHandler2(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();const touches=[];const data={type:event.type,touches};for(let i22=0;i22<event.touches.length;++i22){const touch=event.touches[i22];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i2=1;var keys2={};while(i2<222){keys2[i2]=true;i2++}function filteredKeydownEventHandler2(event,sendFn,preventDefault){let{keyCode}=event;if(keys2[keyCode]){if(preventDefault&&event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler2(event,sendFn)}}var eventHandlers2={contextmenu:preventDefaultHandler2,mousedown:mouseEventHandler2,mousemove:mouseEventHandler2,mouseup:mouseEventHandler2,pointerdown:mouseEventHandler2,pointermove:mouseEventHandler2,pointerup:mouseEventHandler2,pointerlockchange:mouseEventHandler2,webkitpointerlockchange:mouseEventHandler2,focus:focusEventHandler2,blur:focusEventHandler2,pointerout:mouseEventHandler2,touchstart:touchEventHandler2,touchmove:touchEventHandler2,touchend:touchEventHandler2,wheel:wheelEventHandler2,keydown:filteredKeydownEventHandler2,keyup:filteredKeydownEventHandler2};function initProxyElement2(element,worker,id,preventDefault){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent2(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers2);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent,preventDefault)})}if(eventHandlers2.keydown){globalThis.addEventListener("keydown",function(ev2){eventHandlers2.keydown(ev2,sendEvent,preventDefault)})}if(eventHandlers2.keyup){globalThis.addEventListener("keyup",function(ev2){eventHandlers2.keyup(ev2,sendEvent,preventDefault)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher2=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i22=0,l=array.length;i22<l;i22++){array[i22].call(this,event)}}}};function noop2(){}var ElementProxyReceiver2=class extends EventDispatcher2{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop2;data.stopPropagation=noop2;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager2=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver2;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy2(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager2;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager2;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent2(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager2;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager2;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes2={initProxyElement:initProxyElement2,makeProxy:makeProxy2,handleProxyEvent:handleProxyEvent2};function Renderer2(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas2(worker,options,route)}else{initProxyElement2(options.canvas,void 0,options._id,options.preventDefault);return setupCanvas2(options)}}function transferCanvas2(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id,options.preventDefault);else initProxyElement2(options.canvas,worker,options._id,options.preventDefault);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw2(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes2.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText32(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText32(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText32(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText32(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas2(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw2(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes2.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText32(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText32(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText32(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText32(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim2(canvasOptions._id)};canvasOptions.start=draw=>{startAnim2(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw2(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame2(props,options._id)},update:props=>{updateCanvas2(props,options._id)},clear:()=>{clearCanvas2(options._id)},init:()=>{initCanvas2(options._id)},stop:()=>{stopAnim2(options._id)},start:()=>{startAnim2(options._id)},set:newDrawProps=>{setDraw2(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim2(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame2(props,_id){let canvasopts=getCanvas2.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas2(_id){let canvasopts=getCanvas2.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas2(_id){let canvasopts=getCanvas2.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas2(input,_id){let canvasopts=getCanvas2.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps2(props,_id){let canvasopts=getCanvas2.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim2(_id,draw){let canvasopts=getCanvas2.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText32(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim2(_id){let canvasopts=getCanvas2.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas2(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes2={...proxyElementWorkerRoutes2,Renderer:Renderer2,transferCanvas:transferCanvas2,setupCanvas:setupCanvas2,setDraw:setDraw2,drawFrame:drawFrame2,clearCanvas:clearCanvas2,initCanvas:initCanvas2,updateCanvas:updateCanvas2,setProps:setProps2,startAnim:startAnim2,stopAnim:stopAnim2,getCanvas:getCanvas2};function parseFunctionFromText32(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var str3=String(\'(()=>{var __require=(x=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof require!=="undefined"?require:a)[b]}):x)(function(x){if(typeof require!=="undefined")return require.apply(this,arguments);throw new Error(\\\'Dynamic require of "\\\'+x+\\\'" is not supported\\\')});var __create=Object.create;var __defProp=Object.defineProperty;var __getOwnPropDesc=Object.getOwnPropertyDescriptor;var __getOwnPropNames=Object.getOwnPropertyNames;var __getProtoOf=Object.getPrototypeOf;var __hasOwnProp=Object.prototype.hasOwnProperty;var __require2=(x=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x,{get:(a,b)=>(typeof __require!=="undefined"?__require:a)[b]}):x)(function(x){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw new Error(\\\'Dynamic require of "\\\'+x+\\\'" is not supported\\\')});var __commonJS=(cb,mod)=>function __require22(){return mod||(0,cb[__getOwnPropNames(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames(from))if(!__hasOwnProp.call(to,key)&&key!==except)__defProp(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc(from,key))||desc.enumerable})}return to};var __toESM=(mod,isNodeMode,target)=>(target=mod!=null?__create(__getProtoOf(mod)):{},__copyProps(isNodeMode||!mod||!mod.__esModule?__defProp(target,"default",{value:mod,enumerable:true}):target,mod));var require_browser=__commonJS({"node_modules/web-worker/cjs/browser.js"(exports,module2){module2.exports=Worker}});var EventHandler=class{constructor(data){this.pushToState={};this.data={};this.triggers={};this.ctr=0;this.setState=updateObj=>{Object.assign(this.data,updateObj);let props=Object.getOwnPropertyNames(updateObj);for(const prop of props){this.triggerEvent(prop,this.data[prop])}if(this.triggers[statesubKey]){let run=fn=>{fn(updateObj)};this.triggers[statesubKey].forEach(v=>{run(v.onchange)})}return this.data};this.setValue=(key,value)=>{this.data[key]=value;this.triggerEvent(key,value)};this.triggerEvent=(key,value)=>{if(this.triggers[key]){let fn=obj=>obj.onchange(value,this.triggers[key]);this.triggers[key].forEach(fn)}};this.subscribeState=onchange=>{return this.subscribeEvent(statesubKey,onchange)};this.unsubscribeState=sub=>{return this.unsubscribeEvent(statesubKey,sub)};this.subscribeEvent=(key,onchange,refObject,refKey)=>{if(key){if(refObject&&refKey&&!this.triggers[key]){Object.defineProperty(this.data,key,{get:()=>{return refObject[refKey]},set:value=>{refObject[refKey]=value},enumerable:true,configurable:true})}if(!this.triggers[key]){this.triggers[key]=[]}let l=this.ctr;this.ctr++;this.triggers[key].push({sub:l,onchange});return l}else return void 0};this.unsubscribeEvent=(key,sub)=>{let triggers=this.triggers[key];if(triggers){if(sub===void 0){delete this.triggers[key];delete this.data[key]}else{let idx=void 0;let obj=triggers.find((o,i2)=>{if(o.sub===sub){idx=i2;return true}});if(obj)triggers.splice(idx,1);if(Object.keys(triggers).length===0){delete this.triggers[key];delete this.data[key]}if(this.onRemoved)this.onRemoved(obj);return true}}};this.subscribeEventOnce=(key,onchange)=>{let sub;let changed=value=>{onchange(value);this.unsubscribeEvent(key,sub)};sub=this.subscribeEvent(key,changed);return sub};this.getEvent=(key,sub)=>{for(const s in this.triggers[key]){if(this.triggers[key][s].sub===sub)return this.triggers[key][s]}};this.getSnapshot=()=>{const snapshot={};for(const key in this.data){snapshot[key]=this.data[key]}};if(typeof data==="object")this.data=data}};var statesubKey="*s";var state=new EventHandler;var GraphNode=class{constructor(properties,parent,graph){this.__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state};this.__setProperties=(properties2,parent2,graph2)=>{let enforceProperties=()=>{let orig=properties2;if(typeof properties2==="function"){if(isNativeClass(properties2)){properties2=new properties2}else properties2={__operator:properties2,__node:{forward:true,tag:properties2.name}}}else if(typeof properties2==="string"){if(graph2?.get(properties2)){properties2=graph2.get(properties2)}}if(!("__node"in properties2))properties2.__node={};if(!properties2.__node.initial)properties2.__node.initial=orig};enforceProperties();if(typeof properties2==="object"){let assignState=()=>{if(properties2.__node?.state)this.__node.state=properties2.__node.state;else if(graph2){properties2.__node.state=graph2.__node.state}};let setProps2=()=>{if(properties2.__props){if(typeof properties2.__props==="function")properties2.__props=new properties2.__props;if(typeof properties2.__props==="object"){this.__proxyObject(properties2.__props)}}};let setTag=()=>{if(!properties2.__node.tag){if(properties2.__operator?.name)properties2.__node.tag=properties2.__operator.name;else properties2.__node.tag=`node${Math.floor(Math.random()*1e15)}`}};let setNode=()=>{if(typeof properties2.__node==="string"){if(graph2?.get(properties2.__node.tag)){properties2=graph2.get(properties2.__node.tag)}else properties2.__node={}}else if(!properties2.__node)properties2.__node={};if(graph2){properties2.__node.graph=graph2}if(properties2 instanceof Graph)properties2.__node.source=properties2};let setParent=()=>{if(!properties2.__parent&&parent2)properties2.__parent=parent2;if(parent2?.__node&&!(parent2 instanceof Graph||properties2 instanceof Graph))properties2.__node.tag=parent2.__node.tag+"."+properties2.__node.tag;if(parent2 instanceof Graph&&properties2 instanceof Graph){if(properties2.__node.loaders)Object.assign(parent2.__node.loaders?parent2.__node.loaders:{},properties2.__node.loaders);if(parent2.__node.mapGraphs){properties2.__node.nodes.forEach(n=>{parent2.set(properties2.__node.tag+"."+n.__node.tag,n)});let ondelete=()=>{properties2.__node.nodes.forEach(n=>{parent2.__node.nodes.delete(properties2.__node.tag+"."+n.__node.tag)})};this.__addOndisconnected(ondelete)}}};let setOp=()=>{if(typeof properties2.default==="function"&&!properties2.__operator){properties2.__operator=properties2.default}if(properties2.__operator){if(typeof properties2.__operator==="string"){if(graph2){let n=graph2.get(properties2.__operator);if(n)properties2.__operator=n.__operator;if(!properties2.__node.tag&&properties2.__operator.name)properties2.__node.tag=properties2.__operator.name}}if(typeof properties2.__operator==="function")properties2.__operator=this.__setOperator(properties2.__operator);if(properties2.default)properties2.default=properties2.__operator}};let assignProps=()=>{properties2.__node=Object.assign(this.__node,properties2.__node);let keys2=Object.getOwnPropertyNames(properties2);for(const key of keys2){if(key in properties2)this[key]=properties2[key]}};let bindCallbacks=()=>{if(this.__onconnected){if(typeof this.__onconnected==="function"){this.__onconnected=this.__onconnected.bind(this)}else if(Array.isArray(this.__onconnected)){this.__onconnected=this.__onconnected.map(f=>{return f.bind(this)})}if(typeof this.__ondisconnected==="function"){this.__ondisconnected=this.__ondisconnected.bind(this)}else if(Array.isArray(this.__ondisconnected)){this.__ondisconnected=this.__ondisconnected.map(f=>{return f.bind(this)})}}};assignState();setTag();setProps2();setNode();setParent();assignProps();bindCallbacks();setOp()}};this.__subscribe=(callback,key,subInput,target,tkey,args)=>{const subscribeToFunction=(k,setTarget=(callback2,target2)=>target2?target2:callback2,triggerCallback=callback)=>{if(args){triggerCallback=wrapArgs(triggerCallback,args,this.__node.graph)}let sub=this.__node.state.subscribeEvent(k,triggerCallback,this,key);let trigger=this.__node.state.getEvent(k,sub);if(!this.__listeners)this.__listeners={};this.__listeners[k]=this.__node.state.triggers[k];if(!trigger)return sub;trigger.source=this.__node.tag;if(key)trigger.key=key;trigger.target=setTarget(callback,target);if(subInput)trigger.subInput=subInput;if(args)trigger.__args=args;if(tkey)trigger.tkey=tkey;return sub};const subscribeToGraph=callback2=>{let fn=this.__node.graph.get(callback2);if(!fn&&callback2.includes(".")){target=callback2.substring(0,callback2.lastIndexOf("."));let n=this.__node.graph.get(callback2.substring(0,target));tkey=callback2.lastIndexOf(".")+1;if(n&&typeof n[key]==="function")callback2=(...args2)=>{return n[tkey](...args2)}}else if(fn.__operator){callback2=fn.__operator;tkey="__operator"}};if(key){if(!this.__node.localState||!this.__node.localState[key]){this.__addLocalState(this,key)}if(typeof callback==="string"){tkey=callback;if(target){if(this.__node.graph?.get(target)){let n=this.__node.graph?.get(target);if(typeof n[callback]==="function"){let fn=n[callback];callback=(...inp)=>{fn(...inp)}}else{let k2=callback;let setter=inp=>{n[k2]=inp};callback=setter}}}else if(typeof this[callback]==="function"){let fn=this[callback];callback=(...inp)=>{fn(...inp)}}else if(this.__node.graph?.get(callback))subscribeToGraph(callback);if(typeof callback!=="function")return void 0}let sub;let k=subInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node)sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)});return sub}else{if(typeof callback==="string"){if(this.__node.graph.get(callback))callback=this.__node.graph.get(callback);tkey="__operator";if(typeof callback!=="object")return void 0}let sub;let k=subInput?this.__node.unique+"input":this.__node.unique;if(typeof callback==="function")sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2,callback);else if(callback?.__node){sub=subscribeToFunction(k,(callback2,target2)=>target2?target2:callback2.__node.unique,(...inp)=>{if(callback.__operator)callback.__operator(...inp)})}return sub}};this.__unsubscribe=(sub,key,unsubInput)=>{if(key){return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"."+key+"input":this.__node.unique+"."+key,sub)}else return this.__node.state.unsubscribeEvent(unsubInput?this.__node.unique+"input":this.__node.unique,sub)};this.__setOperator=fn=>{fn=fn.bind(this);if(this.__args&&this.__node.graph){fn=wrapArgs(fn,this.__args,this.__node.graph)}let inpstr=`${this.__node.unique}input`;this.__operator=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[this.__node.unique]){if(typeof result?.then==="function"){result.then(res=>{if(res!==void 0)this.__node.state.setValue(this.__node.unique,res)}).catch(console.error)}else if(result!==void 0)this.__node.state.setValue(this.__node.unique,result)}return result};if(this.__parent instanceof GraphNode&&!this.__subscribedToParent){if(this.__parent.__operator){let sub=this.__parent.__subscribe(this);let ondelete=()=>{this.__parent?.__unsubscribe(sub);delete this.__subscribedToParent};this.__addOndisconnected(ondelete);this.__subscribedToParent=true}}return this.__operator};this.__addLocalState=(props,key)=>{if(!props)return;if(!this.__node.localState){this.__node.localState={}}const localState=this.__node.localState;const initState=(props2,k)=>{let str2=this.__node.unique+"."+k;let inpstr=`${str2}input`;if(typeof props2[k]==="function"&&k!=="__operator"){let fn=props2[k].bind(this);props2[k]=(...args)=>{if(this.__node.state.triggers[inpstr])this.__node.state.setValue(inpstr,args);let result=fn(...args);if(this.__node.state.triggers[str2]){if(typeof result?.then==="function"){result.then(res=>{this.__node.state.triggerEvent(str2,res)}).catch(console.error)}else this.__node.state.triggerEvent(str2,result)}return result}}else{let get,set;if(this.__props?.[k]){get=()=>{return this.__props[k]};set=v=>{this.__props[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}else{localState[k]=props2[k];get=()=>{return localState[k]};set=v=>{localState[k]=v;if(this.__node.state.triggers[str2])this.__node.state.triggerEvent(str2,v)}}const descriptor={get,set,enumerable:true,configurable:true};Object.defineProperty(props2,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}};if(key)initState(props,key);else{for(let k in props){initState(props,k)}}};this.__proxyObject=obj=>{const allProps=getAllProperties(obj);for(const k of allProps){if(typeof obj[k]==="function"){this[k]=(...args)=>{return obj[k](...args)}}else{const descriptor={get:()=>{return obj[k]},set:value=>{obj[k]=value},enumerable:true,configurable:true};Object.defineProperty(this,k,descriptor);if(typeof this.__node.initial==="object"){let dec=Object.getOwnPropertyDescriptor(this.__node.initial,k);if(dec===void 0||dec?.configurable){Object.defineProperty(this.__node.initial,k,descriptor)}}}}};this.__setProperties(properties,parent,graph)}__addOnconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__onconnected)){this.__onconnected.push(callback)}else if(typeof this.__onconnected==="function"){this.__onconnected=[callback,this.__onconnected]}else this.__onconnected=callback}__addOndisconnected(callback){callback=callback.bind(this);if(Array.isArray(this.__ondisconnected)){this.__ondisconnected.push(callback)}else if(typeof this.__ondisconnected==="function"){this.__ondisconnected=[callback,this.__ondisconnected]}else this.__ondisconnected=callback}__callConnected(node=this){if(typeof this.__onconnected==="function"){this.__onconnected(this)}else if(Array.isArray(this.__onconnected)){let fn=o=>{o(this)};this.__onconnected.forEach(fn)}}__callDisconnected(node=this){if(typeof this.__ondisconnected==="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let fn=o=>{o(this)};this.__ondisconnected.forEach(fn)}}};var Graph=class{constructor(options){this.__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state,roots:{}};this.init=options2=>{if(options2){let cpy=Object.assign({},options2);delete cpy.roots;recursivelyAssign(this.__node,cpy);if(options2.roots)this.load(options2.roots)}};this.load=roots=>{function recursivelyAssignChildren(target,obj,inChildren=true,top=true){if(top){if(target)Object.assign(target,obj);else target=Object.assign({},obj);recursivelyAssignChildren(target,obj,true,false)}if(obj.__children&&!inChildren){if(obj.__children?.constructor.name==="Object"){if(target.__children?.constructor.name==="Object")recursivelyAssignChildren(target.__children,obj.__children,true,false);else target.__children=recursivelyAssignChildren({},obj.__children,true,false)}else{target.__children=obj.__children}}else if(inChildren){for(const key in obj){target[key]=Object.assign({},obj[key]);if(obj[key].__children){recursivelyAssignChildren({},obj[key].__children,false,false)}}}return target}this.__node.roots=recursivelyAssignChildren(this.__node.roots?this.__node.roots:{},roots);let cpy=Object.assign({},roots);if(cpy.__node)delete cpy.__node;let listeners=this.recursiveSet(cpy,this,void 0,roots);if(roots.__node){if(!roots.__node.tag)roots.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(roots.__node.tag)){let node=new GraphNode(roots,this,this);this.set(node.__node.tag,node);this.runLoaders(node,this,roots,roots.__node.tag);if(node.__listeners){listeners[node.__node.tag]=node.__listeners}}}else if(roots.__listeners){this.setListeners(roots.__listeners)}this.setListeners(listeners);return cpy};this.setLoaders=(loaders2,replace)=>{if(replace)this.__node.loaders=loaders2;else Object.assign(this.__node.loaders,loaders2);return this.__node.loaders};this.runLoaders=(node,parent,properties,key)=>{for(const l in this.__node.loaders){if(typeof this.__node.loaders[l]==="object"){if(this.__node.loaders[l].init)this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key);if(this.__node.loaders[l].connected)node.__addOnconnected(this.__node.loaders[l].connect);if(this.__node.loaders[l].disconnected)node.__addOndisconnected(this.__node.loaders[l].disconnect)}else if(typeof this.__node.loaders[l]==="function")this.__node.loaders[l](node,parent,this,this.__node.roots,properties,key)}};this.add=(properties,parent)=>{let listeners={};if(typeof parent==="string")parent=this.get(parent);let instanced;if(typeof properties==="function"){if(isNativeClass(properties)){if(properties.prototype instanceof GraphNode){properties=properties.prototype.constructor(properties,parent,this);instanced=true}else properties=new properties}else properties={__operator:properties}}else if(typeof properties==="string"){properties=this.__node.roots[properties]}if(!properties)return;if(!instanced){let keys2=Object.getOwnPropertyNames(properties);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(properties));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys2.push(...nonArrowFunctions);let cpy={};for(const key of keys2){cpy[key]=properties[key]}properties=cpy}if(!properties.__node)properties.__node={};properties.__node.initial=properties;if(typeof properties==="object"&&!this.get(properties.__node.tag)){let node;if(instanced)node=properties;else node=new GraphNode(properties,parent,this);this.set(node.__node.tag,node);this.runLoaders(node,parent,properties,node.__node.tag);this.__node.roots[node.__node.tag]=properties;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key in node.__listeners){let listener=node.__listeners[key];if(node[key]){delete listeners[node.__node.tag][key];listeners[node.__node.tag][node.__node.tag+"."+key]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][key]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][key]=parent.__node.tag}}}}this.setListeners(listeners);node.__callConnected();return node}return};this.recursiveSet=(t2,parent,listeners={},origin)=>{let keys2=Object.getOwnPropertyNames(origin);let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(origin));nonArrowFunctions.splice(nonArrowFunctions.indexOf("constructor"),1);keys2.push(...nonArrowFunctions);for(const key of keys2){if(key.includes("__"))continue;let p=origin[key];if(Array.isArray(p))continue;let instanced;if(typeof p==="function"){if(isNativeClass(p)){p=new p;if(p instanceof GraphNode){p=p.prototype.constructor(p,parent,this);instanced=true}}else p={__operator:p}}else if(typeof p==="string"){if(this.__node.nodes.get(p))p=this.__node.nodes.get(p);else p=this.__node.roots[p]}else if(typeof p==="boolean"){if(this.__node.nodes.get(key))p=this.__node.nodes.get(key);else p=this.__node.roots[key]}if(typeof p==="object"){if(!instanced&&!(p instanceof GraphNode)){let ks=Object.getOwnPropertyNames(p);let nonArrowFunctions2=Object.getOwnPropertyNames(Object.getPrototypeOf(p));nonArrowFunctions2.splice(nonArrowFunctions2.indexOf("constructor"),1);ks.push(...nonArrowFunctions2);let cpy={};for(const key2 of ks){cpy[key2]=p[key2]}p=cpy}if(!p.__node)p.__node={};if(!p.__node.tag)p.__node.tag=key;if(!p.__node.initial)p.__node.initial=t2[key];if(this.get(p.__node.tag)&&!(!(parent instanceof Graph)&&parent?.__node)||parent?.__node&&this.get(parent.__node.tag+"."+p.__node.tag))continue;let node;let newnode=false;if(instanced||p instanceof GraphNode){node=p}else{node=new GraphNode(p,parent,this);newnode=true}if(!newnode&&p instanceof GraphNode&&!instanced&&parent instanceof GraphNode){let sub=this.subscribe(parent.__node.tag,node.__node.tag);let ondelete=node2=>{this.unsubscribe(parent.__node.tag,sub)};node.__addOndisconnected(ondelete)}else if(node){this.set(node.__node.tag,node);this.runLoaders(node,parent,t2[key],key);t2[key]=node;this.__node.roots[node.__node.tag]=p;if(node.__children){node.__children=Object.assign({},node.__children);this.recursiveSet(node.__children,node,listeners,node.__children)}if(node.__listeners){listeners[node.__node.tag]=Object.assign({},node.__listeners);for(const key2 in node.__listeners){let listener=node.__listeners[key2];let k=key2;if(node[key2]){delete listeners[node.__node.tag][key2];k=node.__node.tag+"."+key2;listeners[node.__node.tag][k]=listener}if(typeof listener==="string"){if(node.__children?.[listener]){listeners[node.__node.tag][k]=node.__node.tag+"."+listener}else if(parent instanceof GraphNode&&(parent.__node.tag===listener||parent.__node.tag.includes(".")&&parent.__node.tag.split(".").pop()===listener)){listeners[node.__node.tag][k]=parent.__node.tag}}}}node.__callConnected()}}}return listeners};this.remove=(node,clearListeners=true)=>{this.unsubscribe(node);if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){this.delete(node.__node.tag);delete this.__node.roots[node.__node.tag];if(clearListeners){this.clearListeners(node)}node.__callDisconnected();const recursiveRemove=t2=>{for(const key in t2){this.unsubscribe(t2[key]);this.delete(t2[key].__node.tag);delete this.__node.roots[t2[key].__node.tag];this.delete(key);delete this.__node.roots[key];t2[key].__node.tag=t2[key].__node.tag.substring(t2[key].__node.tag.lastIndexOf(".")+1);if(clearListeners){this.clearListeners(t2[key])}t2[key].__callDisconnected();if(t2[key].__children){recursiveRemove(t2[key].__children)}}};if(node.__children){recursiveRemove(node.__children)}}if(node?.__node.tag&&node?.__parent){delete node?.__parent;node.__node.tag=node.__node.tag.substring(node.__node.tag.indexOf(".")+1)}if(node?.__node.graph)node.__node.graph=void 0;return node};this.run=(node,...args)=>{if(typeof node==="string"){let nd=this.get(node);if(!nd&&node.includes(".")){nd=this.get(node.substring(0,node.lastIndexOf(".")));if(typeof nd?.[node.substring(node.lastIndexOf(".")+1)]==="function")return nd[node.substring(node.lastIndexOf(".")+1)](...args)}else if(nd?.__operator)return nd.__operator(...args)}if(node?.__operator){return node?.__operator(...args)}};this.setListeners=listeners=>{for(const key in listeners){let node=this.get(key);if(!node)continue;if(typeof listeners[key]==="object"){for(const k in listeners[key]){let n=this.get(k);let sub;if(typeof listeners[key][k]!=="object")listeners[key][k]={__callback:listeners[key][k]};else if(!listeners[key][k].__callback){for(const kk in listeners[key][k]){if(typeof listeners[key][k][kk]!=="object"){listeners[key][k][kk]={__callback:listeners[key][k][kk]};if(node.__operator&&(listeners[key][k][kk].__callback===true||typeof listeners[key][k][kk].__callback==="undefined"))listeners[key][k][kk].__callback=node.__operator}let nn=this.get(kk);if(!nn){let tag=k.substring(0,k.lastIndexOf("."));nn=this.get(tag);if(nn){let prop=k.substring(k.lastIndexOf(".")+1);sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k][kk].__args,prop,listeners[key][k][kk].inputState,key,k)}}else{sub=this.subscribe(nn,listeners[key][k][kk].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}if("__callback"in listeners[key][k]){if(listeners[key][k].__callback===true||typeof listeners[key][k].__callback==="undefined")listeners[key][k].__callback=node.__operator;if(typeof listeners[key][k].__callback==="function")listeners[key][k].__callback=listeners[key][k].__callback.bind(node);if(!n){let tag=k.substring(0,k.lastIndexOf("."));n=this.get(tag);if(n){sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,k.substring(k.lastIndexOf(".")+1),listeners[key][k].inputState,key,k)}}else{sub=this.subscribe(n,listeners[key][k].__callback,listeners[key][k].__args,void 0,listeners[key][k].inputState,key,k)}}}}}};this.clearListeners=(node,listener)=>{if(typeof node==="string")node=this.get(node);if(node?.__listeners){for(const key in node.__listeners){if(listener&&key!==listener)continue;if(typeof node.__listeners[key]?.sub!=="number")continue;let n=this.get(key);if(!n){n=this.get(key.substring(0,key.lastIndexOf(".")));if(n){if(typeof node.__listeners[key]==="object"&&!node.__listeners[key]?.__callback){for(const k in node.__listeners[key]){if(typeof node.__listeners[key][k]?.sub==="number"){this.unsubscribe(n,node.__listeners[key][k].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,key.substring(key.lastIndexOf(".")+1),node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}else{if(typeof!node.__listeners[key]?.__callback==="number"){for(const k in node.__listeners[key]){if(node.__listeners[key][k]?.sub){this.unsubscribe(n,node.__listeners[key][k].sub,void 0,node.__listeners[key][k].inputState);node.__listeners[key][k].sub=void 0}}}else if(typeof node.__listeners[key]?.sub==="number"){this.unsubscribe(n,node.__listeners[key].sub,void 0,node.__listeners[key].inputState);node.__listeners[key].sub=void 0}}}}};this.get=tag=>{return this.__node.nodes.get(tag)};this.set=(tag,node)=>{return this.__node.nodes.set(tag,node)};this.delete=tag=>{return this.__node.nodes.delete(tag)};this.getProps=(node,getInitial)=>{if(typeof node==="string")node=this.get(node);if(node instanceof GraphNode){let cpy;if(getInitial)cpy=Object.assign({},this.__node.roots[node.__node.tag]);else{cpy=Object.assign({},node);for(const key in cpy){if(key.includes("__"))delete cpy[key]}}}};this.subscribe=(nodeEvent,onEvent,args,key,subInput,target,bound,tkey)=>{let nd=nodeEvent;if(typeof nodeEvent==="string"){nd=this.get(nodeEvent);if(!nd&&nodeEvent.includes(".")){nd=this.get(nodeEvent.substring(0,nodeEvent.lastIndexOf(".")));key=nodeEvent.substring(nodeEvent.lastIndexOf(".")+1)}}if(target instanceof GraphNode)target=target.__node.tag;if(typeof onEvent==="string"){let setOnEventFromString=onEvent2=>{if(this.get(onEvent2)?.__operator){let node=this.get(onEvent2);target=onEvent2;onEvent2=function(...inp){return node.__operator(...inp)}}else if(onEvent2.includes(".")){target=onEvent2.substring(0,onEvent2.lastIndexOf("."));let n=this.get(target);let k=onEvent2.substring(onEvent2.lastIndexOf(".")+1);tkey=k;if(typeof n[k]==="function"){if(n[k]instanceof GraphNode)onEvent2=n[k];else onEvent2=function(...inp){return n[k](...inp)}}else{onEvent2=function(inp){n[k]=inp;return n[k]}}}return onEvent2};if(target){let node=this.get(target);if(typeof node?.[onEvent]==="function"){tkey=onEvent;onEvent=function(...inp){return node[key](...inp)}}else if(node[key]){tkey=key;if(node[key]instanceof GraphNode)onEvent=node[key];else onEvent=function(inp){node[key]=inp;return node[key]}}else{onEvent=setOnEventFromString(onEvent)}}else{onEvent=setOnEventFromString(onEvent)}}let sub;if(nd instanceof GraphNode){const doSub=()=>{sub=nd.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)nd.__unsubscribe(sub,key,subInput);sub=void 0};nd.__addOndisconnected(()=>{ondelete();nd.__addOnconnected(()=>{if(sub===void 0&&nd.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))onEvent=this.get(onEvent);if(onEvent instanceof GraphNode){onEvent.__addOndisconnected(()=>{ondelete()})}};doSub()}else if(typeof nodeEvent==="string"){let node=this.get(nodeEvent);if(node){if(onEvent instanceof GraphNode&&onEvent.__operator){const doSub=()=>{sub=node.__subscribe(onEvent.__operator,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput)};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});onEvent.__addOndisconnected(ondelete)};doSub()}else if(typeof onEvent==="function"||typeof onEvent==="string"){const doSub=()=>{sub=node.__subscribe(onEvent,key,subInput,target,tkey,args);let ondelete=()=>{if(sub!==void 0)node.__unsubscribe(sub,key,subInput);sub=void 0};node.__addOndisconnected(()=>{ondelete();node.__addOnconnected(()=>{if(sub===void 0&&node.__node.graph.__node.tag===this.__node.tag)doSub()})});if(typeof onEvent==="string"&&this.get(onEvent))this.get(onEvent).__addOndisconnected(ondelete)};doSub()}}else{if(typeof onEvent==="string")onEvent=this.__node.nodes.get(onEvent).__operator;if(typeof onEvent==="function")sub=this.__node.state.subscribeEvent(nodeEvent,onEvent)}}return sub};this.unsubscribe=(node,sub,key,subInput)=>{if(node instanceof GraphNode){return node.__unsubscribe(sub,key,subInput)}else return this.get(node)?.__unsubscribe(sub,key,subInput)};this.setState=update=>{this.__node.state.setState(update)};this.init(options)}};function recursivelyAssign(target,obj){for(const key in obj){if(obj[key]?.constructor.name==="Object"){if(target[key]?.constructor.name==="Object")recursivelyAssign(target[key],obj[key]);else target[key]=recursivelyAssign({},obj[key])}else{target[key]=obj[key]}}return target}function getAllProperties(obj){var allProps=[],curr=obj;do{var props=Object.getOwnPropertyNames(curr);let fn=function(prop){if(allProps.indexOf(prop)===-1)allProps.push(prop)};props.forEach(fn)}while(curr=Object.getPrototypeOf(curr));return allProps}function isNativeClass(thing){return isFunction(thing)==="class"}function isFunction(x){const res=typeof x==="function"?x.prototype?Object.getOwnPropertyDescriptor(x,"prototype")?.writable?"function":"class":x.constructor.name==="AsyncFunction"?"async":"arrow":"";return res}var wrapArgs=(callback,argOrder,graph)=>{let args=[];let getCallbackFromString=a=>{if(graph.get(a)?.__operator){let node=graph.get(a);return(...inp)=>{node.__operator(...inp)}}else if(a.includes(".")){let split=a.split(".");let popped=split.pop();let joined=split.join(".");let node=graph.get(joined);if(typeof graph.get(joined)?.[popped]==="function"){return(...inp)=>{return node[popped](...inp)}}else return()=>{return node[popped]}}else if(graph.get(a)){let node=graph.get(a);return()=>{return node}}else{let arg=a;return()=>{return arg}}};let forArg=(a,i2)=>{if(a==="__output"||a==="__input"){args[i2]=inp=>{return inp}}else if(typeof a==="string"){args[i2]=getCallbackFromString(a)}else if(typeof a==="function"){let fn2=a;args[i2]=(...inp)=>{return fn2(...inp)}}else if(typeof a==="object"&&a.__input){let recursivelyCreateCallback=function(c){let input=c.__input;if(typeof c.__input==="string"){input=getCallbackFromString(c.__input)}if(c.__args){input=wrapArgs(input,c.__args,graph)}if(c.__output){let output=c.__output;if(typeof c.__output==="string"){output=getCallbackFromString(output)}else if(typeof a.__output==="object"){output=recursivelyCreateCallback(output)}if(typeof output==="function"){let fn2=input;input=(...inp)=>{return output(fn2(...inp))}}}return input};args[i2]=recursivelyCreateCallback(a)}else{let arg=a;args[i2]=()=>{return arg}}};argOrder.forEach(forArg);if(typeof callback==="string")callback=getCallbackFromString(callback);let fn=callback;callback=function(...inp){let mapArg=arg=>{return arg(...inp)};return fn(...args.map(mapArg))};return callback};var backprop=(node,parent,graph)=>{if(node.__node.backward&&parent instanceof GraphNode){graph.setListeners({[parent.__node.tag]:{[node.__node.tag]:parent}})}};var loop=(node,parent,graph)=>{if(node.__operator&&!node.__node.looperSet){if(typeof node.__node.delay==="number"){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{setTimeout(async()=>{res(await fn(...args))},node.__node.delay)})})}else if(node.__node.frame===true){let fn=node.__operator;node.__setOperator((...args)=>{return new Promise((res,rej)=>{requestAnimationFrame(async()=>{res(await fn(...args))})})})}if(typeof node.__node.repeat==="number"||typeof node.__node.recursive==="number"){let fn=node.__operator;node.__setOperator(async(...args)=>{let i2=node.__node.repeat?node.__node.repeat:node.__node.recursive;let result;let repeater=async(tick,...inp)=>{while(tick>0){if(node.__node.delay||node.__node.frame){fn(...inp).then(async res=>{if(node.__node.recursive){await repeater(tick,res)}else await repeater(tick,...inp)});break}else result=await fn(...args);tick--}};await repeater(i2,...args);return result})}if(node.__node.loop&&typeof node.__node.loop==="number"){node.__node.looperSet=true;let fn=node.__operator;let time=node.__node.loop;node.__setOperator((...args)=>{if(!("looping"in node.__node))node.__node.looping=true;if(node.__node.looping){let last=performance.now();fn(...args);setTimeout(()=>{let now=performance.now();let overshoot=now-last-node.__node.loop;if(overshoot>0)time=node.__node.loop-overshoot;else time=node.__node.loop;if(time<=0)time=node.__node.loop;node.__operator(...args)},time)}});if(node.__node.looping)node.__operator();let ondelete=node2=>{if(node2.__node.looping)node2.__node.looping=false};node.__addOndisconnected(ondelete)}}};var animate=(node,parent,graph)=>{if(node.__node.animate===true||node.__animation){let fn=node.__operator;node.__setOperator((...args)=>{if(!("animating"in node.__node))node.__node.animating=true;if(node.__node.animating){if(typeof node.__animation==="function")node.__animation(...args);else fn(...args);requestAnimationFrame(()=>{node.__operator(...args)})}});if(node.__node.animating||(!("animating"in node.__node)||node.__node.animating)&&node.__animation)setTimeout(()=>{requestAnimationFrame(node.__operator)},10);let ondelete=node2=>{if(node2.__node.animating)node2.__node.animating=false};node.__addOndisconnected(ondelete)}};var branching=(node,parent,graph)=>{if(typeof node.__branch==="object"&&node.__operator&&!node.__branchApplied){let fn=node.__operator;node.__branchApplied=true;node.__operator=(...args)=>{let result=fn(...args);for(const key in node.__branch){let triggered=()=>{if(typeof node.__branch[key].then==="function"){node.__branch[key].then(result)}else if(node.__branch[key].then instanceof GraphNode&&node.__branch[key].then.__operator){node.__branch[key].then.__operator(result)}else result=node.__branch[key].then};if(typeof node.__branch[key].if==="function"){if(node.__branch[key].if(result)==true){triggered()}}else if(node.__branch[key].if===result){triggered()}}return result}}if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].branch&&!node.__listeners[key].branchApplied){let fn=node.__listeners[key].callback;node.__listeners[key].branchApplied=true;node.__listeners.callback=ret=>{let triggered=()=>{if(typeof node.__listeners[key].branch.then==="function"){ret=node.__listeners[key].branch.then(ret)}else if(node.__listeners[key].branch.then instanceof GraphNode&&node.__listeners[key].branch.then.__operator){ret=node.__listeners[key].branch.then.__operator(ret)}else ret=node.__listeners[key].branch.then};if(typeof node.__listeners[key].branch.if==="function"){if(node.__listeners[key].branch.if(ret)){triggered()}}else if(node.__listeners[key].branch.if===ret){triggered()}return fn(ret)}}}}}};var triggerListenerOncreate=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(node.__listeners[key].oncreate){node.__listeners[key].callback(node.__listeners[key].oncreate)}}}}};var bindListener=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].binding==="object"){node.__listeners.callback=node.__listeners.callback.bind(node.__listeners[key].binding)}}}}};var transformListenerResult=(node,parent,graph)=>{if(node.__listeners){for(const key in node.__listeners){if(typeof node.__listeners[key]==="object"){if(typeof node.__listeners[key].transform==="function"&&!node.__listeners[key].transformApplied){let fn=node.__listeners[key].callback;node.__listeners[key].transformApplied=true;node.__listeners.callback=ret=>{ret=node.__listeners[key].transform(ret);return fn(ret)}}}}}};var substitute__operator=(node,parent,graph)=>{if(node.post&&!node.__operator){node.__setOperator(node.post)}else if(!node.__operator&&typeof node.get=="function"){node.__setOperator(node.get)}if(!node.get&&node.__operator){node.get=node.__operator}if(node.aliases){node.aliases.forEach(a=>{graph.set(a,node);let ondelete=node2=>{graph.__node.nodes.delete(a)};node.__addOndisconnected(ondelete)})}if(typeof graph.__node.roots?.[node.__node.tag]==="object"&&node.get)graph.__node.roots[node.__node.tag].get=node.get};var loaders={backprop,loop,animate,branching,triggerListenerOncreate,bindListener,transformListenerResult,substitute__operator};var recursivelyStringifyFunctions=obj=>{let cpy={};for(const key in obj){if(typeof obj[key]==="object"){cpy[key]=recursivelyStringifyFunctions(obj[key])}else if(typeof obj[key]==="function"){cpy[key]=obj[key].toString()}else cpy[key]=obj[key]}return cpy};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\\\W*(function[^{]+\\\\{([\\\\s\\\\S]*)\\\\}|[^=]+=>[^{]*\\\\{([\\\\s\\\\S]*)\\\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs22(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast22(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function methodstrings(node){if(typeof node.__methods==="object"){for(const key in node.__methods){let fstr=node.__methods[key];let fn=typeof fstr==="function"?fstr:parseFunctionFromText(fstr);if(key==="__operator"){node.__setOperator(fn)}else{node[key]=fn.bind(node)}}}}var Service=class extends Graph{constructor(options){super({...options,loaders:options?.loaders?Object.assign({...loaders},options.loaders):{...loaders}});this.name=`service${Math.floor(Math.random()*1e15)}`;this.addServices=services=>{for(const s in services){if(typeof services[s]==="function")services[s]=new services[s];if(services[s]?.__node?.loaders)Object.assign(this.__node.loaders,services[s].__node.loaders);if(services[s]?.__node?.nodes){services[s].__node.nodes.forEach((n,tag)=>{if(!this.get(tag)){this.set(tag,n)}else this.set(s+"."+tag,n)});this.__node.nodes.forEach((n,k)=>{if(!services[s].__node.nodes.get(k))services[s].__node.nodes.set(k,n)});let set=this.set;this.set=(tag,node)=>{services[s].set(tag,node);return set(tag,node)};let del=this.delete;this.delete=tag=>{services[s].delete(tag);return del(tag)}}else if(typeof services[s]==="object"){this.load(services[s])}}};this.handleMethod=(route,method,args)=>{let m=method.toLowerCase();let src=this.__node.nodes.get(route);if(!src){src=this.__node.roots[route]}if(src?.[m]){if(typeof src[m]!=="function"){if(args){if(Array.isArray(args)&&args.length===1)src[m]=args[0];else src[m]=args;return}return src[m]}else{if(Array.isArray(args))return src[m](...args);else return src[m](args)}}else return this.handleServiceMessage({route,args,method})};this.transmit=(...args)=>{if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.receive=(...args)=>{if(args[0]){if(typeof args[0]==="string"){let substr=args[0].substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\\\\\"))args[0]=args[0].replace(/\\\\\\\\/g,"");if(args[0][0]===\\\'"\\\'){args[0]=args[0].substring(1,args[0].length-1)};args[0]=JSON.parse(args[0])}}}if(typeof args[0]==="object"){if(args[0].method){return this.handleMethod(args[0].route,args[0].method,args[0].args)}else if(args[0].route){return this.handleServiceMessage(args[0])}else if(args[0].node){return this.handleGraphNodeCall(args[0].node,args[0].args)}else if(this.__node.keepState){if(args[0].route)this.setState({[args[0].route]:args[0].args});if(args[0].node)this.setState({[args[0].node]:args[0].args})}return args}else return args};this.pipe=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return this.subscribe(source,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.subscribe(source,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.pipeOnce=(source,destination,endpoint,method,callback)=>{if(source instanceof GraphNode){if(callback)return source.__node.state.subscribeEventOnce(source.__node.unique,res=>{let mod=callback(res);if(mod!==void 0)this.transmit({route:destination,args:mod,method});else this.transmit({route:destination,args:res,method},endpoint)});else return this.__node.state.subscribeEventOnce(source.__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})}else if(typeof source==="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(source).__node.unique,res=>{this.transmit({route:destination,args:res,method},endpoint)})};this.terminate=(...args)=>{};this.isTypedArray=isTypedArray;this.recursivelyAssign=recursivelyAssign2;this.spliceTypedArray=spliceTypedArray;this.ping=()=>{console.log("pinged!");return"pong"};this.echo=(...args)=>{this.transmit(...args);return args};this.log=(...args)=>{console.log(...args);return true};this.error=(...args)=>{console.error(...args);return true};if(options?.services)this.addServices(options.services);this.load(this)}handleServiceMessage(message){let call;if(typeof message==="object"){if(message.route)call=message.route;else if(message.node)call=message.node}if(call){if(Array.isArray(message.args))return this.run(call,...message.args);else return this.run(call,message.args)}else return message}handleGraphNodeCall(route,args){if(!route)return args;if(args?.args){this.handleServiceMessage(args)}else if(Array.isArray(args))return this.run(route,...args);else return this.run(route,args)}};function isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}var recursivelyAssign2=(target,obj)=>{for(const key in obj){if(obj[key]?.constructor.name==="Object"&&!Array.isArray(obj[key])){if(target[key]?.constructor.name==="Object"&&!Array.isArray(target[key]))recursivelyAssign2(target[key],obj[key]);else target[key]=recursivelyAssign2({},obj[key])}else target[key]=obj[key]}return target};function spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let ta;if(s.length>0||e?.length>0)ta=new arr.constructor(s.length+e.length);if(ta){if(s.length>0)ta.set(s);if(e&&e.length>0)ta.set(e,s.length)}return ta}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str2;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str2=recursivelyStringifyFunctions(properties)}else if(typeof properties==="function")str2=properties.toString();else if(typeof properties==="string")str2=properties;if(str2){if(connection.run)return connection.run("setNode",[str2]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str2},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str2}));return new Promise(r=>r(name2))}}},setNode:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function")properties={__operator:f,__node:{tag:name2?name2:f.name}};else{f=JSON.parse(properties);if(typeof f==="object")properties=f}}if(typeof properties==="object"||typeof properties==="function"){let template={};if(typeof properties==="object")Object.assign(template,properties);else template.__operator=properties;let node=this.__node.graph.add(template);if(node){nodeTemplates[node.__node.tag]=template;return node.__node?.tag}else return false}else return false},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]==="function"){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str2=recursivelyStringifyFunctions(properties);return str2},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=methodstrings}}}if(typeof properties==="string"){let f=parseFunctionFromText(properties);if(typeof f==="function"){if(!name2)name2=f.name;properties={__operator:f,__node:{tag:name2}}}else{f=JSON.parse(properties);if(typeof f==="object"){properties=f;if(!name2&&f.__node?.tag)name2=f.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=recursivelyAssign2({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(nodeTag,fn,methodKey){if(typeof fn==="string"){let f=parseFunctionFromText(fn);if(typeof f==="function")fn=f}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(nodeTag)){this.__node.graph.get(nodeTag)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key in properties){result[key]=typeof node[key]}return result}return void 0},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str2=classObj.toString();let message={route:"receiveClass",args:[str2,className]};if(connection.run)return connection.run("receiveClass",[str2,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str2,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str2,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str2=fn.toString();let message={route:"setNode",args:[str2,fnName]};if(connection.run)return connection.run("setNode",[str2,fnName]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:[str2,fnName]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:[str2,fnName]}));return new Promise(r=>r(name))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=parseFunctionFromText(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};function html(strings,...args){return function append(elm=document.createElement("div")){let template=document.createElement("template");strings.map(function(s,i2){template.innerHTML+=s;if(args[i2]instanceof HTMLElement){let dummy2=`<span id="dummyNode12345"></span>`;dummy2.id="dummyNode12345";template.innerHTML+=dummy2}else template.innerHTML+=args[i2]});let query=template.content.querySelectorAll("#dummyNode12345");let ctr=0;args.forEach((arg,i2)=>{if(arg instanceof HTMLElement){console.log(arg,query[ctr]);template.content.replaceChild(arg,query[ctr]);ctr++}});elm.appendChild(template.content);return elm}}var dummy=html``;var sjcl={cipher:{},hash:{},keyexchange:{},mode:{},misc:{},codec:{},exception:{corrupt:function(a){this.toString=function(){return"CORRUPT: "+this.message};this.message=a},invalid:function(a){this.toString=function(){return"INVALID: "+this.message};this.message=a},bug:function(a){this.toString=function(){return"BUG: "+this.message};this.message=a},notReady:function(a){this.toString=function(){return"NOT READY: "+this.message};this.message=a}}};sjcl.cipher.aes=function(a){this.s[0][0][0]||this.O();var b,c,d,e,f=this.s[0][4],g=this.s[1];b=a.length;var h=1;if(4!==b&&6!==b&&8!==b)throw new sjcl.exception.invalid("invalid aes key size");this.b=[d=a.slice(0),e=[]];for(a=b;a<4*b+28;a++){c=d[a-1];if(0===a%b||8===b&&4===a%b)c=f[c>>>24]<<24^f[c>>16&255]<<16^f[c>>8&255]<<8^f[c&255],0===a%b&&(c=c<<8^c>>>24^h<<24,h=h<<1^283*(h>>7));d[a]=d[a-b]^c}for(b=0;a;b++,a--)c=d[b&3?a:a-4],e[b]=4>=a||4>b?c:g[0][f[c>>>24]]^g[1][f[c>>16&255]]^g[2][f[c>>8&255]]^g[3][f[c&255]]};sjcl.cipher.aes.prototype={encrypt:function(a){return t(this,a,0)},decrypt:function(a){return t(this,a,1)},s:[[[],[],[],[],[]],[[],[],[],[],[]]],O:function(){var a=this.s[0],b=this.s[1],c=a[4],d=b[4],e,f,g,h=[],k=[],l,n,m,p;for(e=0;256>e;e++)k[(h[e]=e<<1^283*(e>>7))^e]=e;for(f=g=0;!c[f];f^=l||1,g=k[g]||1)for(m=g^g<<1^g<<2^g<<3^g<<4,m=m>>8^m&255^99,c[f]=m,d[m]=f,n=h[e=h[l=h[f]]],p=16843009*n^65537*e^257*l^16843008*f,n=257*h[m]^16843008*m,e=0;4>e;e++)a[e][f]=n=n<<24^n>>>8,b[e][m]=p=p<<24^p>>>8;for(e=0;5>e;e++)a[e]=a[e].slice(0),b[e]=b[e].slice(0)}};function t(a,b,c){if(4!==b.length)throw new sjcl.exception.invalid("invalid aes block size");var d=a.b[c],e=b[0]^d[0],f=b[c?3:1]^d[1],g=b[2]^d[2];b=b[c?1:3]^d[3];var h,k,l,n=d.length/4-2,m,p=4,r=[0,0,0,0];h=a.s[c];a=h[0];var q=h[1],v=h[2],w=h[3],x=h[4];for(m=0;m<n;m++)h=a[e>>>24]^q[f>>16&255]^v[g>>8&255]^w[b&255]^d[p],k=a[f>>>24]^q[g>>16&255]^v[b>>8&255]^w[e&255]^d[p+1],l=a[g>>>24]^q[b>>16&255]^v[e>>8&255]^w[f&255]^d[p+2],b=a[b>>>24]^q[e>>16&255]^v[f>>8&255]^w[g&255]^d[p+3],p+=4,e=h,f=k,g=l;for(m=0;4>m;m++)r[c?3&-m:m]=x[e>>>24]<<24^x[f>>16&255]<<16^x[g>>8&255]<<8^x[b&255]^d[p++],h=e,e=f,f=g,g=b,b=h;return r}sjcl.bitArray={bitSlice:function(a,b,c){a=sjcl.bitArray.$(a.slice(b/32),32-(b&31)).slice(1);return void 0===c?a:sjcl.bitArray.clamp(a,c-b)},extract:function(a,b,c){var d=Math.floor(-b-c&31);return((b+c-1^b)&-32?a[b/32|0]<<32-d^a[b/32+1|0]>>>d:a[b/32|0]>>>d)&(1<<c)-1},concat:function(a,b){if(0===a.length||0===b.length)return a.concat(b);var c=a[a.length-1],d=sjcl.bitArray.getPartial(c);return 32===d?a.concat(b):sjcl.bitArray.$(b,d,c|0,a.slice(0,a.length-1))},bitLength:function(a){var b=a.length;return 0===b?0:32*(b-1)+sjcl.bitArray.getPartial(a[b-1])},clamp:function(a,b){if(32*a.length<b)return a;a=a.slice(0,Math.ceil(b/32));var c=a.length;b=b&31;0<c&&b&&(a[c-1]=sjcl.bitArray.partial(b,a[c-1]&2147483648>>b-1,1));return a},partial:function(a,b,c){return 32===a?b:(c?b|0:b<<32-a)+1099511627776*a},getPartial:function(a){return Math.round(a/1099511627776)||32},equal:function(a,b){if(sjcl.bitArray.bitLength(a)!==sjcl.bitArray.bitLength(b))return false;var c=0,d;for(d=0;d<a.length;d++)c|=a[d]^b[d];return 0===c},$:function(a,b,c,d){var e;e=0;for(void 0===d&&(d=[]);32<=b;b-=32)d.push(c),c=0;if(0===b)return d.concat(a);for(e=0;e<a.length;e++)d.push(c|a[e]>>>b),c=a[e]<<32-b;e=a.length?a[a.length-1]:0;a=sjcl.bitArray.getPartial(e);d.push(sjcl.bitArray.partial(b+a&31,32<b+a?c:d.pop(),1));return d},i:function(a,b){return[a[0]^b[0],a[1]^b[1],a[2]^b[2],a[3]^b[3]]},byteswapM:function(a){var b,c;for(b=0;b<a.length;++b)c=a[b],a[b]=c>>>24|c>>>8&65280|(c&65280)<<8|c<<24;return a}};sjcl.codec.utf8String={fromBits:function(a){var b="",c=sjcl.bitArray.bitLength(a),d,e;for(d=0;d<c/8;d++)0===(d&3)&&(e=a[d/4]),b+=String.fromCharCode(e>>>8>>>8>>>8),e<<=8;return decodeURIComponent(escape(b))},toBits:function(a){a=unescape(encodeURIComponent(a));var b=[],c,d=0;for(c=0;c<a.length;c++)d=d<<8|a.charCodeAt(c),3===(c&3)&&(b.push(d),d=0);c&3&&b.push(sjcl.bitArray.partial(8*(c&3),d));return b}};sjcl.codec.hex={fromBits:function(a){var b="",c;for(c=0;c<a.length;c++)b+=((a[c]|0)+0xf00000000000).toString(16).substr(4);return b.substr(0,sjcl.bitArray.bitLength(a)/4)},toBits:function(a){var b,c=[],d;a=a.replace(/\\\\s|0x/g,"");d=a.length;a=a+"00000000";for(b=0;b<a.length;b+=8)c.push(parseInt(a.substr(b,8),16)^0);return sjcl.bitArray.clamp(c,4*d)}};sjcl.codec.base32={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",X:"0123456789ABCDEFGHIJKLMNOPQRSTUV",BITS:32,BASE:5,REMAINING:27,fromBits:function(a,b,c){var d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f="",g=0,h=sjcl.codec.base32.B,k=0,l=sjcl.bitArray.bitLength(a);c&&(h=sjcl.codec.base32.X);for(c=0;f.length*d<l;)f+=h.charAt((k^a[c]>>>g)>>>e),g<d?(k=a[c]<<d-g,g+=e,c++):(k<<=d,g-=d);for(;f.length&7&&!b;)f+="=";return f},toBits:function(a,b){a=a.replace(/\\\\s|=/g,"").toUpperCase();var c=sjcl.codec.base32.BITS,d=sjcl.codec.base32.BASE,e=sjcl.codec.base32.REMAINING,f=[],g,h=0,k=sjcl.codec.base32.B,l=0,n,m="base32";b&&(k=sjcl.codec.base32.X,m="base32hex");for(g=0;g<a.length;g++){n=k.indexOf(a.charAt(g));if(0>n){if(!b)try{return sjcl.codec.base32hex.toBits(a)}catch(p){}throw new sjcl.exception.invalid("this isn\\\'t "+m+"!")}h>e?(h-=e,f.push(l^n>>>h),l=n<<c-h):(h+=d,l^=n<<c-h)}h&56&&f.push(sjcl.bitArray.partial(h&56,l,1));return f}};sjcl.codec.base32hex={fromBits:function(a,b){return sjcl.codec.base32.fromBits(a,b,1)},toBits:function(a){return sjcl.codec.base32.toBits(a,1)}};sjcl.codec.base64={B:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",fromBits:function(a,b,c){var d="",e=0,f=sjcl.codec.base64.B,g=0,h=sjcl.bitArray.bitLength(a);c&&(f=f.substr(0,62)+"-_");for(c=0;6*d.length<h;)d+=f.charAt((g^a[c]>>>e)>>>26),6>e?(g=a[c]<<6-e,e+=26,c++):(g<<=6,e-=6);for(;d.length&3&&!b;)d+="=";return d},toBits:function(a,b){a=a.replace(/\\\\s|=/g,"");var c=[],d,e=0,f=sjcl.codec.base64.B,g=0,h;b&&(f=f.substr(0,62)+"-_");for(d=0;d<a.length;d++){h=f.indexOf(a.charAt(d));if(0>h)throw new sjcl.exception.invalid("this isn\\\'t base64!");26<e?(e-=26,c.push(g^h>>>e),g=h<<32-e):(e+=6,g^=h<<32-e)}e&56&&c.push(sjcl.bitArray.partial(e&56,g,1));return c}};sjcl.codec.base64url={fromBits:function(a){return sjcl.codec.base64.fromBits(a,1,1)},toBits:function(a){return sjcl.codec.base64.toBits(a,1)}};sjcl.hash.sha256=function(a){this.b[0]||this.O();a?(this.F=a.F.slice(0),this.A=a.A.slice(0),this.l=a.l):this.reset()};sjcl.hash.sha256.hash=function(a){return new sjcl.hash.sha256().update(a).finalize()};sjcl.hash.sha256.prototype={blockSize:512,reset:function(){this.F=this.Y.slice(0);this.A=[];this.l=0;return this},update:function(a){"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));var b,c=this.A=sjcl.bitArray.concat(this.A,a);b=this.l;a=this.l=b+sjcl.bitArray.bitLength(a);if(9007199254740991<a)throw new sjcl.exception.invalid("Cannot hash more than 2^53 - 1 bits");if("undefined"!==typeof Uint32Array){var d=new Uint32Array(c),e=0;for(b=512+b-(512+b&511);b<=a;b+=512)u(this,d.subarray(16*e,16*(e+1))),e+=1;c.splice(0,16*e)}else for(b=512+b-(512+b&511);b<=a;b+=512)u(this,c.splice(0,16));return this},finalize:function(){var a,b=this.A,c=this.F,b=sjcl.bitArray.concat(b,[sjcl.bitArray.partial(1,1)]);for(a=b.length+2;a&15;a++)b.push(0);b.push(Math.floor(this.l/4294967296));for(b.push(this.l|0);b.length;)u(this,b.splice(0,16));this.reset();return c},Y:[],b:[],O:function(){function a(a2){return 4294967296*(a2-Math.floor(a2))|0}for(var b=0,c=2,d,e;64>b;c++){e=true;for(d=2;d*d<=c;d++)if(0===c%d){e=false;break}e&&(8>b&&(this.Y[b]=a(Math.pow(c,.5))),this.b[b]=a(Math.pow(c,1/3)),b++)}}};function u(a,b){var c,d,e,f=a.F,g=a.b,h=f[0],k=f[1],l=f[2],n=f[3],m=f[4],p=f[5],r=f[6],q=f[7];for(c=0;64>c;c++)16>c?d=b[c]:(d=b[c+1&15],e=b[c+14&15],d=b[c&15]=(d>>>7^d>>>18^d>>>3^d<<25^d<<14)+(e>>>17^e>>>19^e>>>10^e<<15^e<<13)+b[c&15]+b[c+9&15]|0),d=d+q+(m>>>6^m>>>11^m>>>25^m<<26^m<<21^m<<7)+(r^m&(p^r))+g[c],q=r,r=p,p=m,m=n+d|0,n=l,l=k,k=h,h=d+(k&l^n&(k^l))+(k>>>2^k>>>13^k>>>22^k<<30^k<<19^k<<10)|0;f[0]=f[0]+h|0;f[1]=f[1]+k|0;f[2]=f[2]+l|0;f[3]=f[3]+n|0;f[4]=f[4]+m|0;f[5]=f[5]+p|0;f[6]=f[6]+r|0;f[7]=f[7]+q|0}sjcl.mode.ccm={name:"ccm",G:[],listenProgress:function(a){sjcl.mode.ccm.G.push(a)},unListenProgress:function(a){a=sjcl.mode.ccm.G.indexOf(a);-1<a&&sjcl.mode.ccm.G.splice(a,1)},fa:function(a){var b=sjcl.mode.ccm.G.slice(),c;for(c=0;c<b.length;c+=1)b[c](a)},encrypt:function(a,b,c,d,e){var f,g=b.slice(0),h=sjcl.bitArray,k=h.bitLength(c)/8,l=h.bitLength(g)/8;e=e||64;d=d||[];if(7>k)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(f=2;4>f&&l>>>8*f;f++);f<15-k&&(f=15-k);c=h.clamp(c,8*(15-f));b=sjcl.mode.ccm.V(a,b,c,d,e,f);g=sjcl.mode.ccm.C(a,g,c,b,e,f);return h.concat(g.data,g.tag)},decrypt:function(a,b,c,d,e){e=e||64;d=d||[];var f=sjcl.bitArray,g=f.bitLength(c)/8,h=f.bitLength(b),k=f.clamp(b,h-e),l=f.bitSlice(b,h-e),h=(h-e)/8;if(7>g)throw new sjcl.exception.invalid("ccm: iv must be at least 7 bytes");for(b=2;4>b&&h>>>8*b;b++);b<15-g&&(b=15-g);c=f.clamp(c,8*(15-b));k=sjcl.mode.ccm.C(a,k,c,l,e,b);a=sjcl.mode.ccm.V(a,k.data,c,d,e,b);if(!f.equal(k.tag,a))throw new sjcl.exception.corrupt("ccm: tag doesn\\\'t match");return k.data},na:function(a,b,c,d,e,f){var g=[],h=sjcl.bitArray,k=h.i;d=[h.partial(8,(b.length?64:0)|d-2<<2|f-1)];d=h.concat(d,c);d[3]|=e;d=a.encrypt(d);if(b.length)for(c=h.bitLength(b)/8,65279>=c?g=[h.partial(16,c)]:4294967295>=c&&(g=h.concat([h.partial(16,65534)],[c])),g=h.concat(g,b),b=0;b<g.length;b+=4)d=a.encrypt(k(d,g.slice(b,b+4).concat([0,0,0])));return d},V:function(a,b,c,d,e,f){var g=sjcl.bitArray,h=g.i;e/=8;if(e%2||4>e||16<e)throw new sjcl.exception.invalid("ccm: invalid tag length");if(4294967295<d.length||4294967295<b.length)throw new sjcl.exception.bug("ccm: can\\\'t deal with 4GiB or more data");c=sjcl.mode.ccm.na(a,d,c,e,g.bitLength(b)/8,f);for(d=0;d<b.length;d+=4)c=a.encrypt(h(c,b.slice(d,d+4).concat([0,0,0])));return g.clamp(c,8*e)},C:function(a,b,c,d,e,f){var g,h=sjcl.bitArray;g=h.i;var k=b.length,l=h.bitLength(b),n=k/50,m=n;c=h.concat([h.partial(8,f-1)],c).concat([0,0,0]).slice(0,4);d=h.bitSlice(g(d,a.encrypt(c)),0,e);if(!k)return{tag:d,data:[]};for(g=0;g<k;g+=4)g>n&&(sjcl.mode.ccm.fa(g/k),n+=m),c[3]++,e=a.encrypt(c),b[g]^=e[0],b[g+1]^=e[1],b[g+2]^=e[2],b[g+3]^=e[3];return{tag:d,data:h.clamp(b,l)}}};sjcl.mode.ocb2={name:"ocb2",encrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");var g,h=sjcl.mode.ocb2.S,k=sjcl.bitArray,l=k.i,n=[0,0,0,0];c=h(a.encrypt(c));var m,p=[];d=d||[];e=e||64;for(g=0;g+4<b.length;g+=4)m=b.slice(g,g+4),n=l(n,m),p=p.concat(l(c,a.encrypt(l(c,m)))),c=h(c);m=b.slice(g);b=k.bitLength(m);g=a.encrypt(l(c,[0,0,0,b]));m=k.clamp(l(m.concat([0,0,0]),g),b);n=l(n,l(m.concat([0,0,0]),g));n=a.encrypt(l(n,l(c,h(c))));d.length&&(n=l(n,f?d:sjcl.mode.ocb2.pmac(a,d)));return p.concat(k.concat(m,k.clamp(n,e)))},decrypt:function(a,b,c,d,e,f){if(128!==sjcl.bitArray.bitLength(c))throw new sjcl.exception.invalid("ocb iv must be 128 bits");e=e||64;var g=sjcl.mode.ocb2.S,h=sjcl.bitArray,k=h.i,l=[0,0,0,0],n=g(a.encrypt(c)),m,p,r=sjcl.bitArray.bitLength(b)-e,q=[];d=d||[];for(c=0;c+4<r/32;c+=4)m=k(n,a.decrypt(k(n,b.slice(c,c+4)))),l=k(l,m),q=q.concat(m),n=g(n);p=r-32*c;m=a.encrypt(k(n,[0,0,0,p]));m=k(m,h.clamp(b.slice(c),p).concat([0,0,0]));l=k(l,m);l=a.encrypt(k(l,k(n,g(n))));d.length&&(l=k(l,f?d:sjcl.mode.ocb2.pmac(a,d)));if(!h.equal(h.clamp(l,e),h.bitSlice(b,r)))throw new sjcl.exception.corrupt("ocb: tag doesn\\\'t match");return q.concat(h.clamp(m,p))},pmac:function(a,b){var c,d=sjcl.mode.ocb2.S,e=sjcl.bitArray,f=e.i,g=[0,0,0,0],h=a.encrypt([0,0,0,0]),h=f(h,d(d(h)));for(c=0;c+4<b.length;c+=4)h=d(h),g=f(g,a.encrypt(f(h,b.slice(c,c+4))));c=b.slice(c);128>e.bitLength(c)&&(h=f(h,d(h)),c=e.concat(c,[-2147483648,0,0,0]));g=f(g,c);return a.encrypt(f(d(f(h,d(h))),g))},S:function(a){return[a[0]<<1^a[1]>>>31,a[1]<<1^a[2]>>>31,a[2]<<1^a[3]>>>31,a[3]<<1^135*(a[0]>>>31)]}};sjcl.mode.gcm={name:"gcm",encrypt:function(a,b,c,d,e){var f=b.slice(0);b=sjcl.bitArray;d=d||[];a=sjcl.mode.gcm.C(true,a,f,d,c,e||128);return b.concat(a.data,a.tag)},decrypt:function(a,b,c,d,e){var f=b.slice(0),g=sjcl.bitArray,h=g.bitLength(f);e=e||128;d=d||[];e<=h?(b=g.bitSlice(f,h-e),f=g.bitSlice(f,0,h-e)):(b=f,f=[]);a=sjcl.mode.gcm.C(false,a,f,d,c,e);if(!g.equal(a.tag,b))throw new sjcl.exception.corrupt("gcm: tag doesn\\\'t match");return a.data},ka:function(a,b){var c,d,e,f,g,h=sjcl.bitArray.i;e=[0,0,0,0];f=b.slice(0);for(c=0;128>c;c++){(d=0!==(a[Math.floor(c/32)]&1<<31-c%32))&&(e=h(e,f));g=0!==(f[3]&1);for(d=3;0<d;d--)f[d]=f[d]>>>1|(f[d-1]&1)<<31;f[0]>>>=1;g&&(f[0]^=-520093696)}return e},j:function(a,b,c){var d,e=c.length;b=b.slice(0);for(d=0;d<e;d+=4)b[0]^=4294967295&c[d],b[1]^=4294967295&c[d+1],b[2]^=4294967295&c[d+2],b[3]^=4294967295&c[d+3],b=sjcl.mode.gcm.ka(b,a);return b},C:function(a,b,c,d,e,f){var g,h,k,l,n,m,p,r,q=sjcl.bitArray;m=c.length;p=q.bitLength(c);r=q.bitLength(d);h=q.bitLength(e);g=b.encrypt([0,0,0,0]);96===h?(e=e.slice(0),e=q.concat(e,[1])):(e=sjcl.mode.gcm.j(g,[0,0,0,0],e),e=sjcl.mode.gcm.j(g,e,[0,0,Math.floor(h/4294967296),h&4294967295]));h=sjcl.mode.gcm.j(g,[0,0,0,0],d);n=e.slice(0);d=h.slice(0);a||(d=sjcl.mode.gcm.j(g,h,c));for(l=0;l<m;l+=4)n[3]++,k=b.encrypt(n),c[l]^=k[0],c[l+1]^=k[1],c[l+2]^=k[2],c[l+3]^=k[3];c=q.clamp(c,p);a&&(d=sjcl.mode.gcm.j(g,h,c));a=[Math.floor(r/4294967296),r&4294967295,Math.floor(p/4294967296),p&4294967295];d=sjcl.mode.gcm.j(g,d,a);k=b.encrypt(e);d[0]^=k[0];d[1]^=k[1];d[2]^=k[2];d[3]^=k[3];return{tag:q.bitSlice(d,0,f),data:c}}};sjcl.misc.hmac=function(a,b){this.W=b=b||sjcl.hash.sha256;var c=[[],[]],d,e=b.prototype.blockSize/32;this.w=[new b,new b];a.length>e&&(a=b.hash(a));for(d=0;d<e;d++)c[0][d]=a[d]^909522486,c[1][d]=a[d]^1549556828;this.w[0].update(c[0]);this.w[1].update(c[1]);this.R=new b(this.w[0])};sjcl.misc.hmac.prototype.encrypt=sjcl.misc.hmac.prototype.mac=function(a){if(this.aa)throw new sjcl.exception.invalid("encrypt on already updated hmac called!");this.update(a);return this.digest(a)};sjcl.misc.hmac.prototype.reset=function(){this.R=new this.W(this.w[0]);this.aa=false};sjcl.misc.hmac.prototype.update=function(a){this.aa=true;this.R.update(a)};sjcl.misc.hmac.prototype.digest=function(){var a=this.R.finalize(),a=new this.W(this.w[1]).update(a).finalize();this.reset();return a};sjcl.misc.pbkdf2=function(a,b,c,d,e){c=c||1e4;if(0>d||0>c)throw new sjcl.exception.invalid("invalid params to pbkdf2");"string"===typeof a&&(a=sjcl.codec.utf8String.toBits(a));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));e=e||sjcl.misc.hmac;a=new e(a);var f,g,h,k,l=[],n=sjcl.bitArray;for(k=1;32*l.length<(d||1);k++){e=f=a.encrypt(n.concat(b,[k]));for(g=1;g<c;g++)for(f=a.encrypt(f),h=0;h<f.length;h++)e[h]^=f[h];l=l.concat(e)}d&&(l=n.clamp(l,d));return l};sjcl.prng=function(a){this.c=[new sjcl.hash.sha256];this.m=[0];this.P=0;this.H={};this.N=0;this.U={};this.Z=this.f=this.o=this.ha=0;this.b=[0,0,0,0,0,0,0,0];this.h=[0,0,0,0];this.L=void 0;this.M=a;this.D=false;this.K={progress:{},seeded:{}};this.u=this.ga=0;this.I=1;this.J=2;this.ca=65536;this.T=[0,48,64,96,128,192,256,384,512,768,1024];this.da=3e4;this.ba=80};sjcl.prng.prototype={randomWords:function(a,b){var c=[],d;d=this.isReady(b);var e;if(d===this.u)throw new sjcl.exception.notReady("generator isn\\\'t seeded");if(d&this.J){d=!(d&this.I);e=[];var f=0,g;this.Z=e[0]=new Date().valueOf()+this.da;for(g=0;16>g;g++)e.push(4294967296*Math.random()|0);for(g=0;g<this.c.length&&(e=e.concat(this.c[g].finalize()),f+=this.m[g],this.m[g]=0,d||!(this.P&1<<g));g++);this.P>=1<<this.c.length&&(this.c.push(new sjcl.hash.sha256),this.m.push(0));this.f-=f;f>this.o&&(this.o=f);this.P++;this.b=sjcl.hash.sha256.hash(this.b.concat(e));this.L=new sjcl.cipher.aes(this.b);for(d=0;4>d&&(this.h[d]=this.h[d]+1|0,!this.h[d]);d++);}for(d=0;d<a;d+=4)0===(d+1)%this.ca&&y(this),e=z(this),c.push(e[0],e[1],e[2],e[3]);y(this);return c.slice(0,a)},setDefaultParanoia:function(a,b){if(0===a&&"Setting paranoia=0 will ruin your security; use it only for testing"!==b)throw new sjcl.exception.invalid("Setting paranoia=0 will ruin your security; use it only for testing");this.M=a},addEntropy:function(a,b,c){c=c||"user";var d,e,f=new Date().valueOf(),g=this.H[c],h=this.isReady(),k=0;d=this.U[c];void 0===d&&(d=this.U[c]=this.ha++);void 0===g&&(g=this.H[c]=0);this.H[c]=(this.H[c]+1)%this.c.length;switch(typeof a){case"number":void 0===b&&(b=1);this.c[g].update([d,this.N++,1,b,f,1,a|0]);break;case"object":c=Object.prototype.toString.call(a);if("[object Uint32Array]"===c){e=[];for(c=0;c<a.length;c++)e.push(a[c]);a=e}else for("[object Array]"!==c&&(k=1),c=0;c<a.length&&!k;c++)"number"!==typeof a[c]&&(k=1);if(!k){if(void 0===b)for(c=b=0;c<a.length;c++)for(e=a[c];0<e;)b++,e=e>>>1;this.c[g].update([d,this.N++,2,b,f,a.length].concat(a))}break;case"string":void 0===b&&(b=a.length);this.c[g].update([d,this.N++,3,b,f,a.length]);this.c[g].update(a);break;default:k=1}if(k)throw new sjcl.exception.bug("random: addEntropy only supports number, array of numbers or string");this.m[g]+=b;this.f+=b;h===this.u&&(this.isReady()!==this.u&&A("seeded",Math.max(this.o,this.f)),A("progress",this.getProgress()))},isReady:function(a){a=this.T[void 0!==a?a:this.M];return this.o&&this.o>=a?this.m[0]>this.ba&&new Date().valueOf()>this.Z?this.J|this.I:this.I:this.f>=a?this.J|this.u:this.u},getProgress:function(a){a=this.T[a?a:this.M];return this.o>=a?1:this.f>a?1:this.f/a},startCollectors:function(){if(!this.D){this.a={loadTimeCollector:B(this,this.ma),mouseCollector:B(this,this.oa),keyboardCollector:B(this,this.la),accelerometerCollector:B(this,this.ea),touchCollector:B(this,this.qa)};if(window.addEventListener)window.addEventListener("load",this.a.loadTimeCollector,false),window.addEventListener("mousemove",this.a.mouseCollector,false),window.addEventListener("keypress",this.a.keyboardCollector,false),window.addEventListener("devicemotion",this.a.accelerometerCollector,false),window.addEventListener("touchmove",this.a.touchCollector,false);else if(document.attachEvent)document.attachEvent("onload",this.a.loadTimeCollector),document.attachEvent("onmousemove",this.a.mouseCollector),document.attachEvent("keypress",this.a.keyboardCollector);else throw new sjcl.exception.bug("can\\\'t attach event");this.D=true}},stopCollectors:function(){this.D&&(window.removeEventListener?(window.removeEventListener("load",this.a.loadTimeCollector,false),window.removeEventListener("mousemove",this.a.mouseCollector,false),window.removeEventListener("keypress",this.a.keyboardCollector,false),window.removeEventListener("devicemotion",this.a.accelerometerCollector,false),window.removeEventListener("touchmove",this.a.touchCollector,false)):document.detachEvent&&(document.detachEvent("onload",this.a.loadTimeCollector),document.detachEvent("onmousemove",this.a.mouseCollector),document.detachEvent("keypress",this.a.keyboardCollector)),this.D=false)},addEventListener:function(a,b){this.K[a][this.ga++]=b},removeEventListener:function(a,b){var c,d,e=this.K[a],f=[];for(d in e)e.hasOwnProperty(d)&&e[d]===b&&f.push(d);for(c=0;c<f.length;c++)d=f[c],delete e[d]},la:function(){C(this,1)},oa:function(a){var b,c;try{b=a.x||a.clientX||a.offsetX||0,c=a.y||a.clientY||a.offsetY||0}catch(d){c=b=0}0!=b&&0!=c&&this.addEntropy([b,c],2,"mouse");C(this,0)},qa:function(a){a=a.touches[0]||a.changedTouches[0];this.addEntropy([a.pageX||a.clientX,a.pageY||a.clientY],1,"touch");C(this,0)},ma:function(){C(this,2)},ea:function(a){a=a.accelerationIncludingGravity.x||a.accelerationIncludingGravity.y||a.accelerationIncludingGravity.z;if(window.orientation){var b=window.orientation;"number"===typeof b&&this.addEntropy(b,1,"accelerometer")}a&&this.addEntropy(a,2,"accelerometer");C(this,0)}};function A(a,b){var c,d=sjcl.random.K[a],e=[];for(c in d)d.hasOwnProperty(c)&&e.push(d[c]);for(c=0;c<e.length;c++)e[c](b)}function C(a,b){"undefined"!==typeof window&&window.performance&&"function"===typeof window.performance.now?a.addEntropy(window.performance.now(),b,"loadtime"):a.addEntropy(new Date().valueOf(),b,"loadtime")}function y(a){a.b=z(a).concat(z(a));a.L=new sjcl.cipher.aes(a.b)}function z(a){for(var b=0;4>b&&(a.h[b]=a.h[b]+1|0,!a.h[b]);b++);return a.L.encrypt(a.h)}function B(a,b){return function(){b.apply(a,arguments)}}sjcl.random=new sjcl.prng(6);a:try{if(G="undefined"!==typeof module&&module.exports){try{H=__require2("crypto")}catch(a){H=null}G=E=H}if(G&&E.randomBytes)D=E.randomBytes(128),D=new Uint32Array(new Uint8Array(D).buffer),sjcl.random.addEntropy(D,1024,"crypto[\\\'randomBytes\\\']");else if("undefined"!==typeof window&&"undefined"!==typeof Uint32Array){F=new Uint32Array(32);if(window.crypto&&window.crypto.getRandomValues)window.crypto.getRandomValues(F);else if(window.msCrypto&&window.msCrypto.getRandomValues)window.msCrypto.getRandomValues(F);else break a;sjcl.random.addEntropy(F,1024,"crypto[\\\'getRandomValues\\\']")}}catch(a){"undefined"!==typeof window&&window.console&&(console.log("There was an error collecting entropy from the browser:"),console.log(a))}var D;var E;var F;var G;var H;sjcl.json={defaults:{v:1,iter:1e4,ks:128,ts:64,mode:"ccm",adata:"",cipher:"aes"},ja:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json,f=e.g({iv:sjcl.random.randomWords(4,0)},e.defaults),g;e.g(f,c);c=f.adata;"string"===typeof f.salt&&(f.salt=sjcl.codec.base64.toBits(f.salt));"string"===typeof f.iv&&(f.iv=sjcl.codec.base64.toBits(f.iv));if(!sjcl.mode[f.mode]||!sjcl.cipher[f.cipher]||"string"===typeof a&&100>=f.iter||64!==f.ts&&96!==f.ts&&128!==f.ts||128!==f.ks&&192!==f.ks&&256!==f.ks||2>f.iv.length||4<f.iv.length)throw new sjcl.exception.invalid("json encrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,f),a=g.key.slice(0,f.ks/32),f.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.publicKey&&(g=a.kem(),f.kemtag=g.tag,a=g.key.slice(0,f.ks/32));"string"===typeof b&&(b=sjcl.codec.utf8String.toBits(b));"string"===typeof c&&(f.adata=c=sjcl.codec.utf8String.toBits(c));g=new sjcl.cipher[f.cipher](a);e.g(d,f);d.key=a;f.ct="ccm"===f.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.encrypt(g,b,f.iv,c,f.ts):sjcl.mode[f.mode].encrypt(g,b,f.iv,c,f.ts);return f},encrypt:function(a,b,c,d){var e=sjcl.json,f=e.ja.apply(e,arguments);return e.encode(f)},ia:function(a,b,c,d){c=c||{};d=d||{};var e=sjcl.json;b=e.g(e.g(e.g({},e.defaults),b),c,true);var f,g;f=b.adata;"string"===typeof b.salt&&(b.salt=sjcl.codec.base64.toBits(b.salt));"string"===typeof b.iv&&(b.iv=sjcl.codec.base64.toBits(b.iv));if(!sjcl.mode[b.mode]||!sjcl.cipher[b.cipher]||"string"===typeof a&&100>=b.iter||64!==b.ts&&96!==b.ts&&128!==b.ts||128!==b.ks&&192!==b.ks&&256!==b.ks||!b.iv||2>b.iv.length||4<b.iv.length)throw new sjcl.exception.invalid("json decrypt: invalid parameters");"string"===typeof a?(g=sjcl.misc.cachedPbkdf2(a,b),a=g.key.slice(0,b.ks/32),b.salt=g.salt):sjcl.ecc&&a instanceof sjcl.ecc.elGamal.secretKey&&(a=a.unkem(sjcl.codec.base64.toBits(b.kemtag)).slice(0,b.ks/32));"string"===typeof f&&(f=sjcl.codec.utf8String.toBits(f));g=new sjcl.cipher[b.cipher](a);f="ccm"===b.mode&&sjcl.arrayBuffer&&sjcl.arrayBuffer.ccm&&b.ct instanceof ArrayBuffer?sjcl.arrayBuffer.ccm.decrypt(g,b.ct,b.iv,b.tag,f,b.ts):sjcl.mode[b.mode].decrypt(g,b.ct,b.iv,f,b.ts);e.g(d,b);d.key=a;return 1===c.raw?f:sjcl.codec.utf8String.fromBits(f)},decrypt:function(a,b,c,d){var e=sjcl.json;return e.ia(a,e.decode(b),c,d)},encode:function(a){var b,c="{",d="";for(b in a)if(a.hasOwnProperty(b)){if(!b.match(/^[a-z0-9]+$/i))throw new sjcl.exception.invalid("json encode: invalid property name");c+=d+\\\'"\\\'+b+\\\'":\\\';d=",";switch(typeof a[b]){case"number":case"boolean":c+=a[b];break;case"string":c+=\\\'"\\\'+escape(a[b])+\\\'"\\\';break;case"object":c+=\\\'"\\\'+sjcl.codec.base64.fromBits(a[b],0)+\\\'"\\\';break;default:throw new sjcl.exception.bug("json encode: unsupported type")}}return c+"}"},decode:function(a){a=a.replace(/\\\\s/g,"");if(!a.match(/^\\\\{.*\\\\}$/))throw new sjcl.exception.invalid("json decode: this isn\\\'t json!");a=a.replace(/^\\\\{|\\\\}$/g,"").split(/,/);var b={},c,d;for(c=0;c<a.length;c++){if(!(d=a[c].match(/^\\\\s*(?:(["\\\']?)([a-z][a-z0-9]*)\\\\1)\\\\s*:\\\\s*(?:(-?\\\\d+)|"([a-z0-9+\\\\/%*_.@=\\\\-]*)"|(true|false))$/i)))throw new sjcl.exception.invalid("json decode: this isn\\\'t json!");null!=d[3]?b[d[2]]=parseInt(d[3],10):null!=d[4]?b[d[2]]=d[2].match(/^(ct|adata|salt|iv)$/)?sjcl.codec.base64.toBits(d[4]):unescape(d[4]):null!=d[5]&&(b[d[2]]="true"===d[5])}return b},g:function(a,b,c){void 0===a&&(a={});if(void 0===b)return a;for(var d in b)if(b.hasOwnProperty(d)){if(c&&void 0!==a[d]&&a[d]!==b[d])throw new sjcl.exception.invalid("required parameter overridden");a[d]=b[d]}return a},sa:function(a,b){var c={},d;for(d in a)a.hasOwnProperty(d)&&a[d]!==b[d]&&(c[d]=a[d]);return c},ra:function(a,b){var c={},d;for(d=0;d<b.length;d++)void 0!==a[b[d]]&&(c[b[d]]=a[b[d]]);return c}};sjcl.encrypt=sjcl.json.encrypt;sjcl.decrypt=sjcl.json.decrypt;sjcl.misc.pa={};sjcl.misc.cachedPbkdf2=function(a,b){var c=sjcl.misc.pa,d;b=b||{};d=b.iter||1e3;c=c[a]=c[a]||{};d=c[d]=c[d]||{firstSalt:b.salt&&b.salt.length?b.salt.slice(0):sjcl.random.randomWords(2,0)};c=void 0===b.salt?d.firstSalt:b.salt;d[c]=d[c]||sjcl.misc.pbkdf2(a,c,b.iter);return{key:d[c].slice(0),salt:c.slice(0)}};var _HTTPfrontend=class extends Service{constructor(options,path,fetched){super(options);this.name="http";this.fetchProxied=false;this.listening={};this.GET=(url="http://localhost:8080/ping",type="",mimeType)=>{if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"GET",url,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.POST=(message,url="http://localhost:8080/echo",type="",mimeType)=>{if(typeof message==="object"&&(type==="json"||type==="text"||!type)){message=JSON.stringify(message)}if(type==="json")mimeType="application/json";return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method:"POST",url,data:message,responseType:type,mimeType,onload:ev=>{let data;if(xhr.responseType===""||xhr.responseType==="text")data=xhr.responseText;else data=xhr.response;if(url instanceof URL)url=url.toString();this.setState({[url]:data});resolve(data)},onabort:er=>{reject(er)}})}).catch(console.error)};this.transmit=(message,url)=>{let obj=message;if(typeof obj==="object"){message=JSON.stringify(obj)}if(obj?.method?.toLowerCase()=="get"||message?.toLowerCase()==="get")return this.GET(url);return this.POST(message,url)};this.transponder=(url,message,type="",mimeType)=>{if(typeof message==="object")message=JSON.stringify(message);let method="GET";if(message){method="POST"}if(type==="json")mimeType="application/json";else return new Promise((resolve,reject)=>{let xhr=_HTTPfrontend.request({method,url,data:message,responseType:type,onload:ev=>{let body=xhr.response;if(typeof body==="string"){let substr=body.substring(0,8);if(substr.includes("{")||substr.includes("[")){if(substr.includes("\\\\\\\\"))body=body.replace(/\\\\\\\\/g,"");if(body[0]===\\\'"\\\'){body=body.substring(1,body.length-1)};body=JSON.parse(body)}}if(typeof body?.method==="string"){return resolve(this.handleMethod(body.route,body.method,body.args))}else if(typeof body?.route==="string"){return resolve(this.handleServiceMessage(body))}else if(typeof body?.node==="string"||body.node instanceof GraphNode){return resolve(this.handleGraphNodeCall(body.node,body.args))}else return resolve(body)},onabort:er=>{reject(er)}})}).catch(console.error)};this.listen=(path2="0",fetched2=async(clone,args,response)=>{const result=await clone.text();const returned=this.receive(result);this.setState({[response.url]:returned})})=>{this.listening[path2]={};let listenerId=`${path2}${Math.floor(Math.random()*1e15)}`;this.listening[path2][listenerId]=fetched2;if(!this.fetchProxied){globalThis.fetch=new Proxy(globalThis.fetch,{apply(fetch,that,args){const result=fetch.apply(that,args);result.then(response=>{if(!response.ok)return;if(this.listening["0"]){for(const key in this.listeners){const clone=response.clone();this.listening["0"][key](clone,args,response)}}else{for(const key in this.listening){if(response.url.includes(key)){for(const key2 in this.listening[path2]){const clone=response.clone();this.listening[path2][key2](clone,args,response)}break}}}}).catch(er=>{console.error(er)});return result}});this.fetchProxied=true}return listenerId};this.stopListening=(path2,listener)=>{if(!path2&&path2!==0){for(const key in this.listening)delete this.listening[key]}else{if(!listener)delete this.listening[path2];else delete this.listening[listener]}};this.load(this);this.listen(path,fetched)}};var HTTPfrontend=_HTTPfrontend;HTTPfrontend.request=options=>{const xhr=new XMLHttpRequest;if(options.responseType)xhr.responseType=options.responseType;else options.responseType="json";if(options.mimeType){xhr.overrideMimeType(options.mimeType)}if(options.onload)xhr.addEventListener("load",options.onload,false);if(options.onprogress)xhr.addEventListener("progress",options.onprogress,false);if(options.onabort)xhr.addEventListener("abort",options.onabort,false);if(options.onloadend)xhr.addEventListener("loadend",options.onloadend,false);if(options.onerror)xhr.addEventListener("error",options.onerror,false);xhr.open(options.method,options.url,true,options.user,options.pass);if(!options.onerror)xhr.onerror=function(){xhr.abort()};xhr.send(options.data);return xhr};var import_web_worker=__toESM(require_browser());var WorkerService=class extends Service{constructor(options){super();this.name="worker";this.workers={};this.threadRot=0;this.loadWorkerRoute=(rt,routeKey)=>{if(rt.workerUrl)rt.url=rt.workerUrl;if(rt.workerId)rt.__node.tag=rt.workerId;if(!rt.__node.tag)rt.__node.tag=routeKey;rt._id=rt.__node.tag;let worker;if(this.workers[rt._id])worker=this.workers[rt._id];else if(rt.worker)worker=rt.worker;if(!worker){worker=this.addWorker(rt)}rt.worker=worker;if(!rt.worker.__ondisconnected){let ondelete=rt2=>{rt2.worker?.terminate()};rt.__addOndisconnected(ondelete)}if(rt.transferFunctions){for(const prop in rt.transferFunctions){this.transferFunction(worker,rt.transferFunctions[prop],prop)}}if(rt.transferClasses){for(const prop in rt.transferClasses){this.transferClass(worker,rt.transferClasses[prop],prop)}}if(worker){if(!rt.__operator){rt.__operator=(...args)=>{if(rt.callback){if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.post(rt.callback,args);else return worker.run(rt.callback,args)}else{if(!this.__node.nodes.get(rt.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(rt.init){worker.run(rt.init,rt.initArgs,void 0,rt.initTransfer)}return worker}};this.workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?.workerId||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};this.addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};this.postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};this.addWorker=options2=>{let worker;if(!options2._id)options2._id=`worker${Math.floor(Math.random()*1e15)}`;if(options2.url)worker=new import_web_worker.default(options2.url);else if(options2.port){worker=options2.port}else if(this.workers[options2._id]){if(this.workers[options2._id].port)worker=this.workers[options2._id].port;else worker=this.workers[options2._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options2._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options2._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options2._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options2._id)};if(!options2.onmessage)options2.onmessage=ev=>{this.receive(ev.data);this.setState({[options2._id]:ev.data})};if(!options2.onerror){options2.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options2.onmessage;worker.onerror=options2.onerror;this.workers[options2._id]={worker,send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options2};return this.workers[options2._id]};this.open=this.addWorker;this.toObjectURL=scriptTemplate=>{let blob=new Blob([scriptTemplate],{type:"text/javascript"});return URL.createObjectURL(blob)};this.transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys2=Object.keys(this.workers);this.workers[keys2[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys2.length)this.threadRot=0}return message};this.terminate=worker=>{let onclose;if(typeof worker==="string"){let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof import_web_worker.default){worker.terminate();if(onclose)onclose(worker);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);return true}return false};this.establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof import_web_worker.default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof import_web_worker.default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};this.request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};this.runRequest=(message,worker,callbackId)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId})})}else{if(worker instanceof import_web_worker.default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId});else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId})}return res};this.subscribeWorker=(route,worker,args,key,subInput,blocking)=>{let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{if(worker?.postMessage)worker.postMessage({args:r,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route})})}else{if(worker?.postMessage)worker.postMessage({args:res,callbackId:route});else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route})}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};this.subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking])}};this.triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i2=0;i2<this.__node.state.triggers[workerId].length;i2++){await this.__node.state.triggers[workerId][i2].onchange({args:result,callbackId:route})}return true};this.pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking])};this.unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}};this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}};var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault()}function copyProperties(src,properties,dst){for(const name2 of properties){dst[name2]=src[name2]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();const touches=[];const data={type:event.type,touches};for(let i2=0;i2<event.touches.length;++i2){const touch=event.touches[i2];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i=1;var keys={};while(i<222){keys[i]=true;i++}function filteredKeydownEventHandler(event,sendFn,preventDefault){let{keyCode}=event;if(keys[keyCode]){if(preventDefault&&event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,pointerlockchange:mouseEventHandler,webkitpointerlockchange:mouseEventHandler,focus:focusEventHandler,blur:focusEventHandler,pointerout:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler,keyup:filteredKeydownEventHandler};function initProxyElement(element,worker,id,preventDefault){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent,preventDefault)})}if(eventHandlers.keydown){globalThis.addEventListener("keydown",function(ev){eventHandlers.keydown(ev,sendEvent,preventDefault)})}if(eventHandlers.keyup){globalThis.addEventListener("keyup",function(ev){eventHandlers.keyup(ev,sendEvent,preventDefault)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i2=0,l=array.length;i2<l;i2++){array[i2].call(this,event)}}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id,options.preventDefault);return setupCanvas(options)}}function transferCanvas(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id,options.preventDefault);else initProxyElement(options.canvas,worker,options._id,options.preventDefault);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText3(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText3(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText3(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText3(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText3(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText3(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText3(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText3(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts=getCanvas.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText3(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim,getCanvas};function parseFunctionFromText3(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\\\W*(function[^{]+\\\\{([\\\\s\\\\S]*)\\\\}|[^=]+=>[^{]*\\\\{([\\\\s\\\\S]*)\\\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var _ArrayManip=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return y2*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y2=>{if(clamp){if(y2<min)y2=min;if(y2>max)y2=max}return 2*((y2-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps9){let now=Date.now();let toInterp=[now-ct*1e3/sps9,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i2=incr;i2<array.length;i2+=incr){let rounded=Math.round(i2);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i2=1;i2<fitCount-1;i2++){var tmp=i2*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i2]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x;b=0}else if(60<=h&&h<120){r=x;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x}else if(180<=h&&h<240){r=0;g=x;b=c}else if(240<=h&&h<300){r=x;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d={};data.forEach((arr,i2)=>{d[i2]=arr});data=d;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\\\r\\\\n")){let lines=data.split("\\\\r\\\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i2)=>{if(val.includes(":")){let[key2,v]=val.split(":");let fl=parseFloat(v);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i2]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i2)=>lastValue+slopeIncr*(i2+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x){return ArrayBuffer.isView(x)&&Object.prototype.toString.call(x)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip=_ArrayManip;ArrayManip.bufferValues=(objects,property,keys2,buffer)=>{if(!Array.isArray(keys2)&&typeof keys2==="object")keys2=Object.keys(keys2);if(!buffer){let object_keys=Object.keys(objects);if(keys2)buffer=new Float32Array(object_keys.length*keys2.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys2=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys2.length)}else buffer=new Float32Array(object_keys.length)}}let i2=0;for(const key in objects){if(objects[key][property]){if(keys2){for(let j=0;j<keys2.length;j++){buffer[i2]=objects[key][property][keys2[j]];i2++}}else{buffer[i2]=objects[key][property];i2++}}}return buffer};var rechk=/^([<>])?(([1-9]\\\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\\\d*)?([xcbB?hHiIfdsp])/g;var str=(v,o,c)=>String.fromCharCode(...new Uint8Array(v.buffer,v.byteOffset+o,c));var rts=(v,o,c,s)=>new Uint8Array(v.buffer,v.byteOffset+o,c).set(s.split("").map(str2=>str2.charCodeAt(0)));var pst=(v,o,c)=>str(v,o+1,Math.min(v.getUint8(o),c-1));var tsp=(v,o,c,s)=>{v.setUint8(o,s.length);rts(v,o+1,c-1,s)};var lut=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v=>str(v,o,1),p:(v,c2)=>rts(v,o,1,c2)})],"?":c=>[c,1,o=>({u:v=>Boolean(v.getUint8(o)),p:(v,B2)=>v.setUint8(o,B2)})],b:c=>[c,1,o=>({u:v=>v.getInt8(o),p:(v,b)=>v.setInt8(o,b)})],B:c=>[c,1,o=>({u:v=>v.getUint8(o),p:(v,B2)=>v.setUint8(o,B2)})],h:c=>[c,2,o=>({u:v=>v.getInt16(o,le),p:(v,h)=>v.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v=>v.getUint16(o,le),p:(v,H2)=>v.setUint16(o,H2,le)})],i:c=>[c,4,o=>({u:v=>v.getInt32(o,le),p:(v,i2)=>v.setInt32(o,i2,le)})],I:c=>[c,4,o=>({u:v=>v.getUint32(o,le),p:(v,I)=>v.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v=>v.getFloat32(o,le),p:(v,f)=>v.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v=>v.getFloat64(o,le),p:(v,d)=>v.setFloat64(o,d,le)})],s:c=>[1,c,o=>({u:v=>str(v,o,c),p:(v,s)=>rts(v,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v=>pst(v,o,c),p:(v,s)=>tsp(v,o,c,s.slice(0,c-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var _ByteParser=class extends ArrayManip{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){indices.push(i2);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y2){return[y2&255,y2>>8&255]}static bytesToInt24(x0,x1,x2){let int24=(255&x0)<<16|(255&x1)<<8|255&x2;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x2){return x0*65536+x1*256+x2}static Uint24ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255]}static bytesToInt32(x0,x1,x2,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x2)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x2,x3){return x0*16777216+x1*65536+x2*256+x3}static Uint32ToBytes(y2){return[y2&255,y2>>8&255,y2>>16&255,y2>>24&255]}static get2sCompliment(val,nbits3){if(val>4294967296)return null;return val<<32-nbits3>>32-nbits3}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i2=0;i2<input.length;i2++){var c=input.charCodeAt(i2);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i2]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser.asUint8Array(patternBuffer);var M=pattern.length;if(M===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R=256;var rightmost_positions=new Int32Array(R);for(var c=0;c<R;c++){rightmost_positions[c]=-1}for(var j=0;j<M;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i2=start;i2<=lastIndex;i2+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i2+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i2}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk.exec(format);if(!m){throw new RangeError("Invalid format string")}const t2=lut("<"===m[1]),lu=(n,c)=>t2[c](n?parseInt(n,10):1);while(m=refmt.exec(format)){((r,s,f)=>{for(let i2=0;i2<r;++i2,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v=new DataView(arrb,offs|0);return fns.map(f=>f.u(v))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i2)=>f.p(v,values[i2]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser=_ByteParser;ByteParser.codes={"\\\\\\\\n":10,"\\\\\\\\r":13,"\\\\\\\\t":9,"\\\\\\\\s":32,"\\\\\\\\b":8,"\\\\\\\\f":12,"\\\\\\\\":92};var WebSerial=class extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message){const writer=port.writable.getWriter();await writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i2=search(haystack);i2!==-1;i2=search(haystack,i2+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i2;else{nextIndex=i2;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}writeStream(stream,message){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();writer.write(WebSerial.toDataView(message));writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i2=0;i2<ports.length;i2++){if(ports[i2].getInfo().usbVendorId===info.usbVendorId&&ports[i2].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i2],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i2]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t2=>{let opt=transforms[t2];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str2=stream;transform.forEach(transform2=>{str2=str2.pipeThrough(transform2)});return str2}};function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i2=0;i2<9;i2++){let j=i2*25;output[0][i2]=ByteParser.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}if(arr.length>225){output.leds=arr.slice(225)}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var sps=250;var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var gain=32;var nbits=24;var vref=1.2;var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b)=>a+b;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<8;i2++){let idx=1+3*i2;if(arr[0]%2===0)output[i2+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<128;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i2=0;i2<128;i2++){freeeeg128ChartSettings.lines[i2]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i2]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i2=0;i2<32;i2++){let idx=i2*3+1;output[i2]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i2=0;i2<32;i2++){freeeeg32ChartSettings.lines[i2]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i2]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps5=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\\\n",codec:hegduinocodec,sps:sps5};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps5,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps5}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i2=0;while(i2<pktCt){let idx=i2*6;if(i2%2===0){output["ir"][i2]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i2+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i2-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i2]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i2++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i2=0;i2<20;i2++){let idx=i2*12;output.ax[i2]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i2]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i2]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i2]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i2]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i2]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i2=0;i2<7;i2++){let j=i2*26+1;if(!arr[j+23])break;output[0][i2]=ByteParser.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i2]=ByteParser.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i2]=ByteParser.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i2]=ByteParser.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i2]=ByteParser.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i2]=ByteParser.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i2]=ByteParser.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i2]=ByteParser.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps6=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps6}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps6};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps6;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting4={nSec:10,sps:sps6,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting4)),"1":JSON.parse(JSON.stringify(defaultChartSetting4)),"2":JSON.parse(JSON.stringify(defaultChartSetting4)),"3":JSON.parse(JSON.stringify(defaultChartSetting4)),"4":JSON.parse(JSON.stringify(defaultChartSetting4)),"5":JSON.parse(JSON.stringify(defaultChartSetting4)),"6":JSON.parse(JSON.stringify(defaultChartSetting4)),"7":JSON.parse(JSON.stringify(defaultChartSetting4))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i2=0;while(i2<data.length){if(PeanutCodes[data[i2]]&&i2+1+PeanutCodes[data[i2]].byteLength<=data.length){let slice=data.slice(i2+1,i2+1+PeanutCodes[data[i2]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i2]].format).unpack(slice);let code=PeanutCodes[data[i2]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i2]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type]=unpacked;else result[PeanutCodes[data[i2]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i2]].type].push(...unpacked);else result[PeanutCodes[data[i2]].type].push(unpacked)}i2+=PeanutCodes[data[i2]].byteLength+1}else i2++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j=0;j<3;j++){let i2=j*16+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}else{output.humidity=[];for(let j=0;j<3;j++){let i2=j*24+2;let tint=ByteParser.bytesToInt32(arr[3+i2],arr[2+i2],arr[1+i2],arr[0+i2]);let tfrac=ByteParser.bytesToInt32(arr[7+i2],arr[6+i2],arr[5+i2],arr[4+i2]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i2],arr[10+i2],arr[9+i2],arr[8+i2]);let pfrac=ByteParser.bytesToInt32(arr[15+i2],arr[14+i2],arr[13+i2],arr[12+i2]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToInt32(arr[19+i2],arr[18+i2],arr[17+i2],arr[16+i2]);let hfrac=ByteParser.bytesToInt32(arr[23+i2],arr[22+i2],arr[21+i2],arr[20+i2]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j],output.temp[j]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec(arr.subarray(2));Object.keys(result).forEach((key,i2)=>{output[i2+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,ads131m08codec(arr))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting5={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))},generateNewLines:true,cleanGeneration:false};var gain2=32;var nbits2=24;var vref2=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps7=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps7}}},sps:sps7};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps8},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps8}}},sps:sps8};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop2=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v,i2)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i2+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop2()},loopTime)}};loop2();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.buffer)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps9=this.sps;this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps9=this.sps){this.notch50=[makeNotchFilter(50,sps9,2),makeNotchFilter(100,sps9,2)];this.notch60=[makeNotchFilter(60,sps9,2),makeNotchFilter(120,sps9,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9),new Biquad("lowpass",this.lowpassHz,sps9)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps9,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps9=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9),makeBandpassFilter(bandpassLower,bandpassUpper,sps9)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f,i2)=>{out=f.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f,i2)=>{out=f.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps9,Q=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \\\'lowpass\\\',\\\'highpass\\\',\\\'bandpass\\\',\\\'notch\\\',\\\'peak\\\',\\\'lowshelf\\\',\\\'highshelf\\\'");return}this.type=type;this.freq=freq;this.sps=sps9;this.Q=Q;this.dbGain=dbGain;let A2=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps9;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q);let beta=Math.sqrt(A2+A2);this[type](A2,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A2,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A2,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A2,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A2,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A2,sn,cs,alpha,beta){this.b0=1+alpha*A2;this.b1=-2*cs;this.b2=1-alpha*A2;this.a0=1+alpha/A2;this.a1=-2*cs;this.a2=1-alpha/A2}lowshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1-(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1-(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1+(A2+1)*cs+beta*sn;this.a1=2*(A2-1+(A2+1)*cs);this.a2=A2+1+(A2-1)*cs-beta*sn}highshelf(A2,sn,cs,alpha,beta){this.b0=A2*(A2+1+(A2-1)*cs+beta*sn);this.b1=2*A2*(A2-1+(A2+1)*cs);this.b2=A2*(A2+1-(A2-1)*cs-beta*sn);this.a0=A2+1-(A2+1)*cs-beta*sn;this.a1=2*(A2-1-(A2+1)*cs);this.a2=A2+1-(A2-1)*cs-beta*sn}applyFilter(signal_step){let y2=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y2;return y2}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y2=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y2;return y2}};var makeNotchFilter=(frequency,sps9,bandwidth)=>{return new Biquad("notch",frequency,sps9,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps9,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps9,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};function parseFunctionFromText2(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\\\W*(function[^{]+\\\\{([\\\\s\\\\S]*)\\\\}|[^=]+=>[^{]*\\\\{([\\\\s\\\\S]*)\\\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs3(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs2}var stringifyFast2=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c=value.constructor.name;if(key&&c==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c.includes("Set")){val=Array.from(value)}else if(c!=="Object"&&c!=="Number"&&c!=="String"&&c!=="Boolean"){val="instanceof_"+c}else if(c==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p in value[prop]){if(Array.isArray(value[prop][p])){if(value[prop][p].length>20)obj[prop][p]=value[prop][p].slice(value[prop][p].length-20);else obj[prop][p]=value[prop][p]}else{if(value[prop][p]!=null){let con=value[prop][p].constructor.name;if(con.includes("Set")){obj[prop][p]=Array.from(value[prop][p])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p]="instanceof_"+con}else{obj[prop][p]=value[prop][p]}}else{obj[prop][p]=value[prop][p]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast3(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast2}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.filtering=true;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText2(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder2,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder2+")")},"receiveCodec":function receiveDeviceCodec(decoder2,deviceType,device,service,characteristic){let codec=parseFunctionFromText2(decoder2);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v=>filter.apply(v))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v=>filter.apply(v))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters)globalThis.filters={};for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){globalThis.Devices=Devices;const worker=new WorkerService({roots:{...workerCanvasRoutes,...remoteGraphRoutes,...streamWorkerRoutes}})}var stream_worker_default=self;})();\\n\');var url=URL.createObjectURL(new globalThis.Blob([str3],{type:"text/javascript"}));var _ArrayManip3=class{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y22=>{if(clamp){if(y22<min)y22=min;if(y22>max)y22=max}return y22*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y22=>{if(clamp){if(y22<min)y22=min;if(y22>max)y22=max}return 2*((y22-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps10){let now=Date.now();let toInterp=[now-ct*1e3/sps10,now];return _ArrayManip3.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i22=incr;i22<array.length;i22+=incr){let rounded=Math.round(i22);if(rounded>lastIdx)rounded=lastIdx;for(let j=last;j<rounded;j++){output[counter]+=array[j]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i22=1;i22<fitCount-1;i22++){var tmp=i22*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i22]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip3.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip3.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h,s,l,scalar=255){s/=100;l/=100;let c=(1-Math.abs(2*l-1))*s,x3=c*(1-Math.abs(h/60%2-1)),m=l-c/2,r=0,g=0,b=0;if(0<=h&&h<60){r=c;g=x3;b=0}else if(60<=h&&h<120){r=x3;g=c;b=0}else if(120<=h&&h<180){r=0;g=c;b=x3}else if(180<=h&&h<240){r=0;g=x3;b=c}else if(240<=h&&h<300){r=x3;g=0;b=c}else if(300<=h&&h<360){r=c;g=0;b=x3}r=(r+m)*scalar;g=(g+m)*scalar;b=(b+m)*scalar;return[r,g,b]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d2={};data.forEach((arr,i22)=>{d2[i22]=arr});data=d2;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i22)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i22]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i22)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i22]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_,i22)=>lastValue+slopeIncr*(i22+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip3.interpolate(data,Math.ceil(targetSPS*time))}isTypedArray(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var ArrayManip3=_ArrayManip3;ArrayManip3.bufferValues=(objects,property,keys22,buffer)=>{if(!Array.isArray(keys22)&&typeof keys22==="object")keys22=Object.keys(keys22);if(!buffer){let object_keys=Object.keys(objects);if(keys22)buffer=new Float32Array(object_keys.length*keys22.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys22=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys22.length)}else buffer=new Float32Array(object_keys.length)}}let i22=0;for(const key in objects){if(objects[key][property]){if(keys22){for(let j=0;j<keys22.length;j++){buffer[i22]=objects[key][property][keys22[j]];i22++}}else{buffer[i22]=objects[key][property];i22++}}}return buffer};var rechk3=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt3=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str22=(v2,o,c)=>String.fromCharCode(...new Uint8Array(v2.buffer,v2.byteOffset+o,c));var rts3=(v2,o,c,s)=>new Uint8Array(v2.buffer,v2.byteOffset+o,c).set(s.split("").map(str32=>str32.charCodeAt(0)));var pst3=(v2,o,c)=>str22(v2,o+1,Math.min(v2.getUint8(o),c-1));var tsp3=(v2,o,c,s)=>{v2.setUint8(o,s.length);rts3(v2,o+1,c-1,s)};var lut3=le=>({x:c=>[1,c,0],c:c=>[c,1,o=>({u:v2=>str22(v2,o,1),p:(v2,c2)=>rts3(v2,o,1,c2)})],"?":c=>[c,1,o=>({u:v2=>Boolean(v2.getUint8(o)),p:(v2,B22)=>v2.setUint8(o,B22)})],b:c=>[c,1,o=>({u:v2=>v2.getInt8(o),p:(v2,b)=>v2.setInt8(o,b)})],B:c=>[c,1,o=>({u:v2=>v2.getUint8(o),p:(v2,B22)=>v2.setUint8(o,B22)})],h:c=>[c,2,o=>({u:v2=>v2.getInt16(o,le),p:(v2,h)=>v2.setInt16(o,h,le)})],H:c=>[c,2,o=>({u:v2=>v2.getUint16(o,le),p:(v2,H22)=>v2.setUint16(o,H22,le)})],i:c=>[c,4,o=>({u:v2=>v2.getInt32(o,le),p:(v2,i22)=>v2.setInt32(o,i22,le)})],I:c=>[c,4,o=>({u:v2=>v2.getUint32(o,le),p:(v2,I)=>v2.setUint32(o,I,le)})],f:c=>[c,4,o=>({u:v2=>v2.getFloat32(o,le),p:(v2,f)=>v2.setFloat32(o,f,le)})],d:c=>[c,8,o=>({u:v2=>v2.getFloat64(o,le),p:(v2,d2)=>v2.setFloat64(o,d2,le)})],s:c=>[1,c,o=>({u:v2=>str22(v2,o,c),p:(v2,s)=>rts3(v2,o,c,s.slice(0,c))})],p:c=>[1,c,o=>({u:v2=>pst3(v2,o,c),p:(v2,s)=>tsp3(v2,o,c,s.slice(0,c-1))})]});var errbuf3=new RangeError("Structure larger than remaining buffer");var errval3=new RangeError("Not enough values for structure");var _ByteParser3=class extends ArrayManip3{static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser3.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser3.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser3.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i22=search(haystack);i22!==-1;i22=search(haystack,i22+skip)){indices.push(i22);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y22){return[y22&255,y22>>8&255]}static bytesToInt24(x0,x1,x22){let int24=(255&x0)<<16|(255&x1)<<8|255&x22;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x22){return x0*65536+x1*256+x22}static Uint24ToBytes(y22){return[y22&255,y22>>8&255,y22>>16&255]}static bytesToInt32(x0,x1,x22,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x22)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x22,x3){return x0*16777216+x1*65536+x22*256+x3}static Uint32ToBytes(y22){return[y22&255,y22>>8&255,y22>>16&255,y22>>24&255]}static get2sCompliment(val,nbits32){if(val>4294967296)return null;return val<<32-nbits32>>32-nbits32}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i22=0;i22<input.length;i22++){var c=input.charCodeAt(i22);if(c>127){throw new TypeError("Only ASCII patterns are supported")}arr[i22]=c}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){var pattern=_ByteParser3.asUint8Array(patternBuffer);var M2=pattern.length;if(M2===0){throw new TypeError("patternBuffer must be at least 1 byte long")}var R2=256;var rightmost_positions=new Int32Array(R2);for(var c=0;c<R2;c++){rightmost_positions[c]=-1}for(var j=0;j<M2;j++){rightmost_positions[pattern[j]]=j}var boyerMooreSearch=(txtBuffer,start,end)=>{var txt=_ByteParser3.asUint8Array(txtBuffer);if(start===void 0)start=0;if(end===void 0)end=txt.length;var pat=pattern;var right=rightmost_positions;var lastIndex=end-pat.length;var lastPatIndex=pat.length-1;var skip;for(var i22=start;i22<=lastIndex;i22+=skip){skip=0;for(var j2=lastPatIndex;j2>=0;j2--){var c2=txt[i22+j2];if(pat[j2]!==c2){skip=Math.max(1,j2-right[c2]);break}}if(skip===0){return i22}}return-1};boyerMooreSearch.byteLength=pattern.byteLength;return boyerMooreSearch}static struct(format){let fns=[],size=0,m=rechk3.exec(format);if(!m){throw new RangeError("Invalid format string")}const t22=lut3("<"===m[1]),lu=(n,c)=>t22[c](n?parseInt(n,10):1);while(m=refmt3.exec(format)){((r,s,f)=>{for(let i22=0;i22<r;++i22,size+=s){if(f){fns.push(f(size))}}})(...lu(...m.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf3}let v2=new DataView(arrb,offs|0);return fns.map(f=>f.u(v2))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval3}if(arrb.byteLength<offs+size){throw errbuf3}const v2=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f,i22)=>f.p(v2,values[i22]))};const pack=(...values)=>{let b=new ArrayBuffer(size);pack_into(b,0,...values);return b};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ByteParser3=_ByteParser3;ByteParser3.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92};var ScanMode;(function(ScanMode2){ScanMode2[ScanMode2["SCAN_MODE_LOW_POWER"]=0]="SCAN_MODE_LOW_POWER";ScanMode2[ScanMode2["SCAN_MODE_BALANCED"]=1]="SCAN_MODE_BALANCED";ScanMode2[ScanMode2["SCAN_MODE_LOW_LATENCY"]=2]="SCAN_MODE_LOW_LATENCY"})(ScanMode||(ScanMode={}));var ConnectionPriority;(function(ConnectionPriority2){ConnectionPriority2[ConnectionPriority2["CONNECTION_PRIORITY_BALANCED"]=0]="CONNECTION_PRIORITY_BALANCED";ConnectionPriority2[ConnectionPriority2["CONNECTION_PRIORITY_HIGH"]=1]="CONNECTION_PRIORITY_HIGH";ConnectionPriority2[ConnectionPriority2["CONNECTION_PRIORITY_LOW_POWER"]=2]="CONNECTION_PRIORITY_LOW_POWER"})(ConnectionPriority||(ConnectionPriority={}));init_dist();init_conversion();init_dist();var BluetoothLe=registerPlugin("BluetoothLe",{web:()=>Promise.resolve().then(()=>(init_web(),web_exports)).then(m=>new m.BluetoothLeWeb)});var makeQueue=()=>{let currentTask=Promise.resolve();return fn=>new Promise((resolve,reject)=>{currentTask=currentTask.then(()=>fn()).then(resolve).catch(reject)})};function getQueue(enabled){if(enabled){return makeQueue()}return fn=>fn()}function parseUUID(uuid){if(typeof uuid!=="string"){throw new Error(`Invalid UUID type ${typeof uuid}. Expected string.`)}uuid=uuid.toLowerCase();const is128BitUuid=uuid.search(/^[0-9a-f]{8}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{4}\\b-[0-9a-f]{12}$/)>=0;if(!is128BitUuid){throw new Error(`Invalid UUID format ${uuid}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`)}return uuid}var BleClientClass=class{constructor(){this.scanListener=null;this.eventListeners=new Map;this.queue=getQueue(true)}enableQueue(){this.queue=getQueue(true)}disableQueue(){this.queue=getQueue(false)}async initialize(options){await this.queue(async()=>{await BluetoothLe.initialize(options)})}async getEnabled(){return this.isEnabled()}async isEnabled(){const enabled=await this.queue(async()=>{const result=await BluetoothLe.isEnabled();return result.value});return enabled}async enable(){await this.queue(async()=>{await BluetoothLe.enable()})}async disable(){await this.queue(async()=>{await BluetoothLe.disable()})}async startEnabledNotifications(callback){await this.queue(async()=>{var _a;const key=`onEnabledChanged`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());const listener=await BluetoothLe.addListener(key,result=>{callback(result.value)});this.eventListeners.set(key,listener);await BluetoothLe.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var _a;const key=`onEnabledChanged`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());this.eventListeners.delete(key);await BluetoothLe.stopEnabledNotifications()})}async isLocationEnabled(){const enabled=await this.queue(async()=>{const result=await BluetoothLe.isLocationEnabled();return result.value});return enabled}async openLocationSettings(){await this.queue(async()=>{await BluetoothLe.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await BluetoothLe.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await BluetoothLe.openAppSettings()})}async setDisplayStrings(displayStrings){await this.queue(async()=>{await BluetoothLe.setDisplayStrings(displayStrings)})}async requestDevice(options){options=options?this.validateRequestBleDeviceOptions(options):void 0;const result=await this.queue(async()=>{const device=await BluetoothLe.requestDevice(options);return device});return result}async requestLEScan(options,callback){options=this.validateRequestBleDeviceOptions(options);await this.queue(async()=>{var _a;await((_a=this.scanListener)===null||_a===void 0?void 0:_a.remove());this.scanListener=await BluetoothLe.addListener("onScanResult",resultInternal=>{const result=Object.assign(Object.assign({},resultInternal),{manufacturerData:this.convertObject(resultInternal.manufacturerData),serviceData:this.convertObject(resultInternal.serviceData),rawAdvertisement:resultInternal.rawAdvertisement?this.convertValue(resultInternal.rawAdvertisement):void 0});callback(result)});await BluetoothLe.requestLEScan(options)})}async stopLEScan(){await this.queue(async()=>{var _a;await((_a=this.scanListener)===null||_a===void 0?void 0:_a.remove());this.scanListener=null;await BluetoothLe.stopLEScan()})}async getDevices(deviceIds){return this.queue(async()=>{const result=await BluetoothLe.getDevices({deviceIds});return result.devices})}async getConnectedDevices(services){if(!Array.isArray(services)){throw new Error("services must be an array")}services=services.map(parseUUID);return this.queue(async()=>{const result=await BluetoothLe.getConnectedDevices({services});return result.devices})}async connect(deviceId,onDisconnect,options){await this.queue(async()=>{var _a;if(onDisconnect){const key=`disconnected|${deviceId}`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());const listener=await BluetoothLe.addListener(key,()=>{onDisconnect(deviceId)});this.eventListeners.set(key,listener)}await BluetoothLe.connect(Object.assign({deviceId},options))})}async createBond(deviceId){await this.queue(async()=>{await BluetoothLe.createBond({deviceId})})}async isBonded(deviceId){const isBonded=await this.queue(async()=>{const result=await BluetoothLe.isBonded({deviceId});return result.value});return isBonded}async disconnect(deviceId){await this.queue(async()=>{await BluetoothLe.disconnect({deviceId})})}async getServices(deviceId){const services=await this.queue(async()=>{const result=await BluetoothLe.getServices({deviceId});return result.services});return services}async discoverServices(deviceId){await this.queue(async()=>{await BluetoothLe.discoverServices({deviceId})})}async getMtu(deviceId){const value=await this.queue(async()=>{const result=await BluetoothLe.getMtu({deviceId});return result.value});return value}async requestConnectionPriority(deviceId,connectionPriority){await this.queue(async()=>{await BluetoothLe.requestConnectionPriority({deviceId,connectionPriority})})}async readRssi(deviceId){const value=await this.queue(async()=>{const result=await BluetoothLe.readRssi({deviceId});return parseFloat(result.value)});return value}async read(deviceId,service,characteristic,options){service=parseUUID(service);characteristic=parseUUID(characteristic);const value=await this.queue(async()=>{const result=await BluetoothLe.read(Object.assign({deviceId,service,characteristic},options));return this.convertValue(result.value)});return value}async write(deviceId,service,characteristic,value,options){service=parseUUID(service);characteristic=parseUUID(characteristic);return this.queue(async()=>{if(!(value===null||value===void 0?void 0:value.buffer)){throw new Error("Invalid data.")}let writeValue=value;if(Capacitor.getPlatform()!=="web"){writeValue=dataViewToHexString(value)}await BluetoothLe.write(Object.assign({deviceId,service,characteristic,value:writeValue},options))})}async writeWithoutResponse(deviceId,service,characteristic,value,options){service=parseUUID(service);characteristic=parseUUID(characteristic);await this.queue(async()=>{if(!(value===null||value===void 0?void 0:value.buffer)){throw new Error("Invalid data.")}let writeValue=value;if(Capacitor.getPlatform()!=="web"){writeValue=dataViewToHexString(value)}await BluetoothLe.writeWithoutResponse(Object.assign({deviceId,service,characteristic,value:writeValue},options))})}async readDescriptor(deviceId,service,characteristic,descriptor,options){service=parseUUID(service);characteristic=parseUUID(characteristic);descriptor=parseUUID(descriptor);const value=await this.queue(async()=>{const result=await BluetoothLe.readDescriptor(Object.assign({deviceId,service,characteristic,descriptor},options));return this.convertValue(result.value)});return value}async writeDescriptor(deviceId,service,characteristic,descriptor,value,options){service=parseUUID(service);characteristic=parseUUID(characteristic);descriptor=parseUUID(descriptor);return this.queue(async()=>{if(!(value===null||value===void 0?void 0:value.buffer)){throw new Error("Invalid data.")}let writeValue=value;if(Capacitor.getPlatform()!=="web"){writeValue=dataViewToHexString(value)}await BluetoothLe.writeDescriptor(Object.assign({deviceId,service,characteristic,descriptor,value:writeValue},options))})}async startNotifications(deviceId,service,characteristic,callback){service=parseUUID(service);characteristic=parseUUID(characteristic);await this.queue(async()=>{var _a;const key=`notification|${deviceId}|${service}|${characteristic}`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());const listener=await BluetoothLe.addListener(key,event=>{callback(this.convertValue(event===null||event===void 0?void 0:event.value))});this.eventListeners.set(key,listener);await BluetoothLe.startNotifications({deviceId,service,characteristic})})}async stopNotifications(deviceId,service,characteristic){service=parseUUID(service);characteristic=parseUUID(characteristic);await this.queue(async()=>{var _a;const key=`notification|${deviceId}|${service}|${characteristic}`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());this.eventListeners.delete(key);await BluetoothLe.stopNotifications({deviceId,service,characteristic})})}validateRequestBleDeviceOptions(options){if(options.services){options.services=options.services.map(parseUUID)}if(options.optionalServices){options.optionalServices=options.optionalServices.map(parseUUID)}return options}convertValue(value){if(typeof value==="string"){return hexStringToDataView(value)}else if(value===void 0){return new DataView(new ArrayBuffer(0))}return value}convertObject(obj){if(obj===void 0){return void 0}const result={};for(const key of Object.keys(obj)){result[key]=this.convertValue(obj[key])}return result}};var BleClient=new BleClientClass;init_conversion();var BLEClient=class extends ByteParser3{constructor(options,location){super();this.client=BleClient;this.devices={};this.location=false;this.initialized=false;this.setupDevice=(device,options2)=>{return new Promise(async(res,rej)=>{this.devices[device.deviceId]={device,deviceId:device.deviceId,...options2};this.client.connect(device.deviceId,deviceId=>{if(this.devices[device.deviceId]?.ondisconnect)this.devices[device.deviceId].ondisconnect(deviceId)},options2?.connectOptions).then(async()=>{let services=await this.getServices(device.deviceId);for(const service in options2?.services){let svc=services.find(o=>{if(o.uuid===service)return true});if(svc)for(const characteristic in options2.services[service]){if(!svc.characteristics.find(o=>{if(o.uuid===characteristic)return true}))continue;let opt=options2.services[service][characteristic];if(opt.write){await this.write(device,service,characteristic,opt.write,opt.writeCallback,opt.writeOptions)}if(opt.read){await this.read(device,service,characteristic,opt.readCallback,opt.readOptions)}if(opt.notify&&opt.notifyCallback){await this.subscribe(device,service,characteristic,opt.notifyCallback);opt.notifying=true}}}}).catch(rej);res(this.devices[device.deviceId])})};this.triangulate=(device,duration=1500,sampleRate=60)=>{return new Promise((res,rej)=>{if("Accelerometer"in globalThis){if(typeof globalThis.Accelerometer==="function"){let acl=new globalThis.Accelerometer({frequency:sampleRate});let start=performance.now();let now=start;let result={samples:[],vector:{}};let onread=()=>{if(now-start<duration){this.readRssi(device).then(rssi=>{let x3=acl.x;let y22=acl.y;let z22=acl.z;now=performance.now();result.samples.push({x:x3,y:y22,z:z22,rssi,timestamp:now})})}else{let vector={x:0,y:0,z:0,rssiAvg:0};result.samples.forEach(s=>{});acl.removeEventListener("reading",onread)}};acl.addEventListener("reading",onread)}}else rej(new Error("No Accelerometer API detected"))})};if(location)this.location=location;if(options){this.setup(options)}}setup(options,location=this.location){let services=[];if(options){for(const serviceuuid in options.services){services.push(serviceuuid)}}let opts={};if(!location)opts.androidNeverForLocation=false;return new Promise(async(res,rej)=>{if(!this.initialized){await this.client.initialize(opts);this.initialized=true}if(options?.deviceId){res(await this.reconnect(options.deviceId))}else{if(options){let services2=Array.from(Object.keys(options.services));let deviceRequest={};if(!this.isMobile()){deviceRequest.optionalServices=services2}if(options.name)deviceRequest.name=options.name;if(options.namePrefix)deviceRequest.namePrefix=options.namePrefix;this.client.requestDevice(deviceRequest).then(device=>{res(this.setupDevice(device,options))}).catch(rej)}else{this.client.requestDevice().then(device=>{res(this.setupDevice(device,options))}).catch(rej)}}})}initialize(options){return new Promise((res,rej)=>{this.client.initialize(options).then(()=>{res(true)}).catch(rej)})}requestDevice(request,options){return new Promise((res,rej)=>{this.client.requestDevice(request).then(device=>{this.devices[device.deviceId]={device,deviceId:device.deviceId,...options};res(device)}).catch(rej)})}getServices(deviceId){return this.client.getServices(deviceId)}connect(device,options){return new Promise((res,rej)=>{this.client.connect(device.deviceId,deviceId=>{if(options?.ondisconnect)options.ondisconnect(deviceId)},options?.connectOptions).then(connected=>{res(device)}).catch(rej)})}reconnect(deviceId,options){return new Promise((res,rej)=>{let opts=options;if(this.devices[deviceId])opts=Object.assign(Object.assign({},this.devices[deviceId]),opts);if(opts?.deviceId)delete opts.deviceId;this.client.getDevices([deviceId]).then(devices=>{this.setupDevice(devices[0],opts).then(device=>{res(device)})}).catch(rej)})}disconnect(device){if(typeof device==="object"){if(device?.deviceId){device=device.deviceId};}if(typeof device==="string"){let info=this.devices[device];if(info.beforedisconnect)info.beforedisconnect(this,info);delete this.devices[device];return this.client.disconnect(device)}}write(device,service,characteristic,value,callback,options){if(typeof device==="object")device=device.deviceId;if(callback){return this.client.write(device,service,characteristic,BLEClient.toDataView(value)).then(callback)}else return this.client.writeWithoutResponse(device,service,characteristic,BLEClient.toDataView(value),options)}read(device,service,characteristic,ondata,options){if(typeof device==="object")device=device.deviceId;if(ondata)return this.client.read(device,service,characteristic,options).then(ondata);else return this.client.read(device,service,characteristic,options)}subscribe(device,service,characteristic,ondata){if(typeof device==="object")device=device.deviceId;return this.client.startNotifications(device,service,characteristic,ondata)}unsubscribe(device,service,characteristic){if(typeof device==="object")device=device.deviceId;return this.client.stopNotifications(device,service,characteristic)}scan(options,callback){return this.client.requestLEScan(options,callback)}stopScanning(){return this.client.stopLEScan()}readDescriptor(device,service,characteristic,descriptor,options){return this.client.readDescriptor(device.deviceId,service,characteristic,descriptor,options)}writeDescriptor(device,service,characteristic,descriptor,value,options){return this.client.writeDescriptor(device.deviceId,service,characteristic,descriptor,BLEClient.toDataView(value),options)}readRssi(device){return this.client.readRssi(device.deviceId)}isMobile(){let check=false;(function(a){if(/(android|bb\\d+|meego).+mobile|avantgo|bada\\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\\-(n|u)|c55\\/|capi|ccwa|cdm\\-|cell|chtm|cldc|cmd\\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\\-s|devi|dica|dmob|do(c|p)o|ds(12|\\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\\-|_)|g1 u|g560|gene|gf\\-5|g\\-mo|go(\\.w|od)|gr(ad|un)|haie|hcit|hd\\-(m|p|t)|hei\\-|hi(pt|ta)|hp( i|ip)|hs\\-c|ht(c(\\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\\-(20|go|ma)|i230|iac( |\\-|\\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\\/)|klon|kpt |kwc\\-|kyo(c|k)|le(no|xi)|lg( g|\\/(k|l|u)|50|54|\\-[a-w])|libw|lynx|m1\\-w|m3ga|m50\\/|ma(te|ui|xo)|mc(01|21|ca)|m\\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\\-2|po(ck|rt|se)|prox|psio|pt\\-g|qa\\-a|qc(07|12|21|32|60|\\-[2-7]|i\\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\\-|oo|p\\-)|sdk\\/|se(c(\\-|0|1)|47|mc|nd|ri)|sgh\\-|shar|sie(\\-|m)|sk\\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\\-|v\\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\\-|tdg\\-|tel(i|m)|tim\\-|t\\-mo|to(pl|sh)|ts(70|m\\-|m3|m5)|tx\\-9|up(\\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\\-|your|zeto|zte\\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check}isAndroid(){const device=navigator.userAgent.toLowerCase();return device.indexOf("android")>-1}async distance(device,txPower,x3,exp,c){let rssi=await this.readRssi(device);if(rssi==0)return void 0;let ratio=rssi/txPower;if(ratio<1){return Math.pow(ratio,10)}else{return x3*Math.pow(ratio,exp)+c}}async distanceFromPhone(device,txPower,model){let x3,exp,c;if(model){if(model==="nexus5"){x3=.42093;exp=6.9476;c=.54992}else if(model==="motoX"){x3=.9401940951;exp=6.170094565;c=0}else if(model==="iphone5"){x3=.89976;exp=7.7095;c=.111}}return await this.distance(device,txPower,x3,exp,c)}};function ads131m08codec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i22=0;i22<9;i22++){let j=i22*25;output[0][i22]=ByteParser3.bytesToInt24(arr[j],arr[j+1],arr[j+2]);output[1][i22]=ByteParser3.bytesToInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i22]=ByteParser3.bytesToInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i22]=ByteParser3.bytesToInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i22]=ByteParser3.bytesToInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i22]=ByteParser3.bytesToInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i22]=ByteParser3.bytesToInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i22]=ByteParser3.bytesToInt24(arr[j+21],arr[j+22],arr[j+23])}if(arr.length>225){output.leds=arr.slice(225)}return output}var decoder2=new TextDecoder;var sps9=250;var defaultChartSetting7={nSec:10,sps:sps9,units:"mV"};var ads131m08ChartSettings2={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting7)),"1":JSON.parse(JSON.stringify(defaultChartSetting7)),"2":JSON.parse(JSON.stringify(defaultChartSetting7)),"3":JSON.parse(JSON.stringify(defaultChartSetting7)),"4":JSON.parse(JSON.stringify(defaultChartSetting7)),"5":JSON.parse(JSON.stringify(defaultChartSetting7)),"6":JSON.parse(JSON.stringify(defaultChartSetting7)),"7":JSON.parse(JSON.stringify(defaultChartSetting7))}};var gain3=32;var nbits3=24;var vref3=1.2;var defaultsetting5={sps:sps9,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref3/(gain3*(Math.pow(2,nbits3)-1))};var ads131m08FilterSettings2={"0":JSON.parse(JSON.stringify(defaultsetting5)),"1":JSON.parse(JSON.stringify(defaultsetting5)),"2":JSON.parse(JSON.stringify(defaultsetting5)),"3":JSON.parse(JSON.stringify(defaultsetting5)),"4":JSON.parse(JSON.stringify(defaultsetting5)),"5":JSON.parse(JSON.stringify(defaultsetting5)),"6":JSON.parse(JSON.stringify(defaultsetting5)),"7":JSON.parse(JSON.stringify(defaultsetting5))};var accScale2=.002/Math.pow(2,4);var getAcc2=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b)=>a+b;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale2*ByteParser3.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale2*ByteParser3.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale2*ByteParser3.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec2(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i22=0;i22<8;i22++){let idx=1+3*i22;output[i22]=ByteParser3.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc2(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i22=0;i22<8;i22++){let idx=1+3*i22;if(arr[0]%2===0)output[i22+7]=ByteParser3.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i22]=ByteParser3.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc2(arr,output);return output}var sps22=250;var cytonSerialSettings2={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec2,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps22};var daisycytonSerialSettings2={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec2,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps22};var defaultChartSetting23={nSec:10,sps:sps22,units:"mV"};var defaultChartSetting222={nSec:10,sps:sps22};var cytonChartSettings2={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting23)),"1":JSON.parse(JSON.stringify(defaultChartSetting23)),"2":JSON.parse(JSON.stringify(defaultChartSetting23)),"3":JSON.parse(JSON.stringify(defaultChartSetting23)),"4":JSON.parse(JSON.stringify(defaultChartSetting23)),"5":JSON.parse(JSON.stringify(defaultChartSetting23)),"6":JSON.parse(JSON.stringify(defaultChartSetting23)),"7":JSON.parse(JSON.stringify(defaultChartSetting23)),"ax":JSON.parse(JSON.stringify(defaultChartSetting222)),"ay":JSON.parse(JSON.stringify(defaultChartSetting222)),"az":JSON.parse(JSON.stringify(defaultChartSetting222))},generateNewLines:true};var defaultsetting22={sps:sps22,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings2={"0":JSON.parse(JSON.stringify(defaultsetting22)),"1":JSON.parse(JSON.stringify(defaultsetting22)),"2":JSON.parse(JSON.stringify(defaultsetting22)),"3":JSON.parse(JSON.stringify(defaultsetting22)),"4":JSON.parse(JSON.stringify(defaultsetting22)),"5":JSON.parse(JSON.stringify(defaultsetting22)),"6":JSON.parse(JSON.stringify(defaultsetting22)),"7":JSON.parse(JSON.stringify(defaultsetting22)),"8":JSON.parse(JSON.stringify(defaultsetting22)),"9":JSON.parse(JSON.stringify(defaultsetting22)),"10":JSON.parse(JSON.stringify(defaultsetting22)),"11":JSON.parse(JSON.stringify(defaultsetting22)),"12":JSON.parse(JSON.stringify(defaultsetting22)),"13":JSON.parse(JSON.stringify(defaultsetting22)),"14":JSON.parse(JSON.stringify(defaultsetting22)),"15":JSON.parse(JSON.stringify(defaultsetting22))};function freeeeg128codec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i22=0;i22<128;i22++){let idx=i22*3+1;output[i22]=ByteParser3.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser3.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser3.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser3.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser3.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser3.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser3.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps32=250;var freeeeg128SerialSettings2={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec2,sps:sps32,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings2={lines:{"ax":{nSec:10,sps:sps32},"ay":{nSec:10,sps:sps32},"az":{nSec:10,sps:sps32},"gx":{nSec:10,sps:sps32},"gy":{nSec:10,sps:sps32},"gz":{nSec:10,sps:sps32}}};var freeeeg128FilterSettings2={};for(let i22=0;i22<128;i22++){freeeeg128ChartSettings2.lines[i22]={sps:sps32,nSec:10,units:"mV"};freeeeg128FilterSettings2[i22]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i22=0;i22<32;i22++){let idx=i22*3+1;output[i22]=ByteParser3.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser3.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser3.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser3.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser3.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser3.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser3.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps42=512;var freeeeg32SerialSettings2={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec2,sps:sps42,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings2={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec2,sps:sps42,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting32={nSec:10,sps:sps42};var freeeeg32ChartSettings2={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting32)),"ay":JSON.parse(JSON.stringify(defaultChartSetting32)),"az":JSON.parse(JSON.stringify(defaultChartSetting32)),"gx":JSON.parse(JSON.stringify(defaultChartSetting32)),"gy":JSON.parse(JSON.stringify(defaultChartSetting32)),"gz":JSON.parse(JSON.stringify(defaultChartSetting32))}};var freeeeg32FilterSettings2={};for(let i22=0;i22<32;i22++){freeeeg32ChartSettings2.lines[i22]={sps:sps42,nSec:10,units:"mV"};freeeeg32FilterSettings2[i22]={sps:sps42,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}var textdecoder4=new TextDecoder;function hegduinocodec2(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};let txt=textdecoder4.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps52=40;var hegduinoSerialSettings2={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\n",codec:hegduinocodec2,sps:sps52};var hegduinoV1SerialSettings2=Object.assign({},hegduinoSerialSettings2);hegduinoV1SerialSettings2.sps=19;var hegduinoBLESettings2={deviceType:"BLE",deviceName:"hegduino",sps:sps52,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec2,sps:sps52}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings2=Object.assign({},hegduinoSerialSettings2);hegduinoV1BLESettings2.sps=19;function max3010xcodec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser3.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i22=0;while(i22<pktCt){let idx=i22*6;if(i22%2===0){output["ir"][i22]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i22+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i22-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i22]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i22++}return output}function mpu6050codec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser3.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i22=0;i22<20;i22++){let idx=i22*12;output.ax[i22]=ByteParser3.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i22]=ByteParser3.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i22]=ByteParser3.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i22]=ByteParser3.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i22]=ByteParser3.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i22]=ByteParser3.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i22=0;i22<7;i22++){let j=i22*26+1;if(!arr[j+23])break;output[0][i22]=ByteParser3.bytesToUInt24(arr[j],arr[j+1],arr[j+2]);output[1][i22]=ByteParser3.bytesToUInt24(arr[j+3],arr[j+4],arr[j+5]);output[2][i22]=ByteParser3.bytesToUInt24(arr[j+6],arr[j+7],arr[j+8]);output[3][i22]=ByteParser3.bytesToUInt24(arr[j+9],arr[j+10],arr[j+11]);output[4][i22]=ByteParser3.bytesToUInt24(arr[j+12],arr[j+13],arr[j+14]);output[5][i22]=ByteParser3.bytesToUInt24(arr[j+15],arr[j+16],arr[j+17]);output[6][i22]=ByteParser3.bytesToUInt24(arr[j+18],arr[j+19],arr[j+20]);output[7][i22]=ByteParser3.bytesToUInt24(arr[j+21],arr[j+22],arr[j+23])}return output}var sps72=250;var cognixionONEBLESettings2={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec2,sps:sps72}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps72};var cognixionONESerialSettings2=Object.assign({},cytonSerialSettings2);cognixionONESerialSettings2.sps=sps72;cognixionONESerialSettings2.deviceName="cognixionONE";var defaultChartSetting42={nSec:10,sps:sps72,units:"mV"};var cognixionONEChartSettings2={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting42)),"1":JSON.parse(JSON.stringify(defaultChartSetting42)),"2":JSON.parse(JSON.stringify(defaultChartSetting42)),"3":JSON.parse(JSON.stringify(defaultChartSetting42)),"4":JSON.parse(JSON.stringify(defaultChartSetting42)),"5":JSON.parse(JSON.stringify(defaultChartSetting42)),"6":JSON.parse(JSON.stringify(defaultChartSetting42)),"7":JSON.parse(JSON.stringify(defaultChartSetting42))}};var PeanutCodes2={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec2(data){let result={};let i22=0;while(i22<data.length){if(PeanutCodes2[data[i22]]&&i22+1+PeanutCodes2[data[i22]].byteLength<=data.length){let slice=data.slice(i22+1,i22+1+PeanutCodes2[data[i22]].byteLength).buffer;let unpacked=ByteParser3.struct(PeanutCodes2[data[i22]].format).unpack(slice);let code=PeanutCodes2[data[i22]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes2[data[i22]].type]){if(Array.isArray(unpacked))result[PeanutCodes2[data[i22]].type]=unpacked;else result[PeanutCodes2[data[i22]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes2[data[i22]].type].push(...unpacked);else result[PeanutCodes2[data[i22]].type].push(unpacked)}i22+=PeanutCodes2[data[i22]].byteLength+1}else i22++}result.timestamp=Date.now();return result}var peanutSerialSettings2={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec2,sps:10.101};var sealevel_hpa2=1013.25;var bme280codec2=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j=0;j<3;j++){let i22=j*16+2;let tint=ByteParser3.bytesToInt32(arr[3+i22],arr[2+i22],arr[1+i22],arr[0+i22]);let tfrac=ByteParser3.bytesToInt32(arr[7+i22],arr[6+i22],arr[5+i22],arr[4+i22]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser3.bytesToInt32(arr[11+i22],arr[10+i22],arr[9+i22],arr[8+i22]);let pfrac=ByteParser3.bytesToInt32(arr[15+i22],arr[14+i22],arr[13+i22],arr[12+i22]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude2(output.pressure[j],output.temp[j]))}}else{output.humidity=[];for(let j=0;j<3;j++){let i22=j*24+2;let tint=ByteParser3.bytesToInt32(arr[3+i22],arr[2+i22],arr[1+i22],arr[0+i22]);let tfrac=ByteParser3.bytesToInt32(arr[7+i22],arr[6+i22],arr[5+i22],arr[4+i22]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser3.bytesToInt32(arr[11+i22],arr[10+i22],arr[9+i22],arr[8+i22]);let pfrac=ByteParser3.bytesToInt32(arr[15+i22],arr[14+i22],arr[13+i22],arr[12+i22]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser3.bytesToInt32(arr[19+i22],arr[18+i22],arr[17+i22],arr[16+i22]);let hfrac=ByteParser3.bytesToInt32(arr[23+i22],arr[22+i22],arr[21+i22],arr[20+i22]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude2(output.pressure[j],output.temp[j]))}}return output};function altitude2(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa2,.1903))}function nrf5x_usbcodec2(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec2(arr.subarray(2)))}else if(arr[0]===3){let result=ads131m08codec2(arr.subarray(2));Object.keys(result).forEach((key,i22)=>{output[i22+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec2(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec2(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec2(arr.subarray(2)))}else{Object.assign(output,ads131m08codec2(arr))}return output}var nrf5xSerialSettings2={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec2,sps:250};var nrf5xBLESettings2={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec2,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec2,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec2,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec2,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec2,sps:3.33}}}};var defaultChartSetting52={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings2={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting52)),"1":JSON.parse(JSON.stringify(defaultChartSetting52)),"2":JSON.parse(JSON.stringify(defaultChartSetting52)),"3":JSON.parse(JSON.stringify(defaultChartSetting52)),"4":JSON.parse(JSON.stringify(defaultChartSetting52)),"5":JSON.parse(JSON.stringify(defaultChartSetting52)),"6":JSON.parse(JSON.stringify(defaultChartSetting52)),"7":JSON.parse(JSON.stringify(defaultChartSetting52))},generateNewLines:true,cleanGeneration:false};var gain22=32;var nbits22=24;var vref22=1.2;var defaultsetting32={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref22/(gain22*(Math.pow(2,nbits22)-1))};var nrf5x_usbFilterSettings2={"0":JSON.parse(JSON.stringify(defaultsetting32)),"1":JSON.parse(JSON.stringify(defaultsetting32)),"2":JSON.parse(JSON.stringify(defaultsetting32)),"3":JSON.parse(JSON.stringify(defaultsetting32)),"4":JSON.parse(JSON.stringify(defaultsetting32)),"5":JSON.parse(JSON.stringify(defaultsetting32)),"6":JSON.parse(JSON.stringify(defaultsetting32)),"7":JSON.parse(JSON.stringify(defaultsetting32)),"8":JSON.parse(JSON.stringify(defaultsetting32)),"9":JSON.parse(JSON.stringify(defaultsetting32)),"10":JSON.parse(JSON.stringify(defaultsetting32)),"11":JSON.parse(JSON.stringify(defaultsetting32)),"12":JSON.parse(JSON.stringify(defaultsetting32)),"13":JSON.parse(JSON.stringify(defaultsetting32)),"14":JSON.parse(JSON.stringify(defaultsetting32)),"15":JSON.parse(JSON.stringify(defaultsetting32))};var textdecoder22=new TextDecoder;function statechangercodec2(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder22.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings2={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec2,sps:20};var statechangerBLESettings2={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec2}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec2(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps82=40;var blueberryBLESettings2={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec2,sps:sps82}}},sps:sps82};function blueberryshortcodec2(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec2(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps92=40;var blueberry2BLESettings2={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec2,sps:sps92},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec2,sps:sps92}}},sps:sps92};var defaultsetting12={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings2={"0":JSON.parse(JSON.stringify(defaultsetting12)),"1":JSON.parse(JSON.stringify(defaultsetting12)),"2":JSON.parse(JSON.stringify(defaultsetting12)),"3":JSON.parse(JSON.stringify(defaultsetting12))};var defaultChartSetting62={nSec:10,sps:250,units:"mV"};var ganglionChartSettings2={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting62)),"1":JSON.parse(JSON.stringify(defaultChartSetting62)),"2":JSON.parse(JSON.stringify(defaultChartSetting62)),"3":JSON.parse(JSON.stringify(defaultChartSetting62)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting42={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings2={"0":JSON.parse(JSON.stringify(defaultsetting42)),"1":JSON.parse(JSON.stringify(defaultsetting42)),"2":JSON.parse(JSON.stringify(defaultsetting42)),"3":JSON.parse(JSON.stringify(defaultsetting42)),"4":JSON.parse(JSON.stringify(defaultsetting42))};function hrcodec2(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings2={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec2}}}};var simulatorSettings2={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings2),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop22=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v2,i22)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i22+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop22()},loopTime)}};loop22();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var Devices2={BLE:{"nrf5x":nrf5xBLESettings2,"hegduino":hegduinoBLESettings2,"hegduinoV1":hegduinoV1BLESettings2,"cognixionONE":cognixionONEBLESettings2,"statechanger":statechangerBLESettings2,"blueberry":blueberryBLESettings2,"blueberry2":blueberry2BLESettings2,"heart_rate":heartRateBLESettings2},USB:{"nrf5x":nrf5xSerialSettings2,"freeEEG32":freeeeg32SerialSettings2,"freeEEG32_optical":freeeeg32_optical_SerialSettings2,"freeEEG128":freeeeg128SerialSettings2,"hegduino":hegduinoSerialSettings2,"hegduinoV1":hegduinoV1SerialSettings2,"cyton":cytonSerialSettings2,"cyton_daisy":daisycytonSerialSettings2,"peanut":peanutSerialSettings2,"statechanger":statechangerSerialSettings2,"cognixionONE":cytonSerialSettings2},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings2}};var textdecoder32=new TextDecoder;var BLE=new BLEClient;var workers=new WorkerService2({roots:{...workerCanvasRoutes2,...remoteGraphRoutes2}});var __create4=Object.create;var __defProp4=Object.defineProperty;var __getOwnPropDesc4=Object.getOwnPropertyDescriptor;var __getOwnPropNames4=Object.getOwnPropertyNames;var __getProtoOf4=Object.getPrototypeOf;var __hasOwnProp4=Object.prototype.hasOwnProperty;var __commonJS4=(cb,mod)=>function __require5(){return mod||(0,cb[__getOwnPropNames4(cb)[0]])((mod={exports:{}}).exports,mod),mod.exports};var __copyProps4=(to,from,except,desc)=>{if(from&&typeof from==="object"||typeof from==="function"){for(let key of __getOwnPropNames4(from))if(!__hasOwnProp4.call(to,key)&&key!==except)__defProp4(to,key,{get:()=>from[key],enumerable:!(desc=__getOwnPropDesc4(from,key))||desc.enumerable})}return to};var __toESM4=(mod,isNodeMode,target)=>(target=mod!=null?__create4(__getProtoOf4(mod)):{},__copyProps4(isNodeMode||!mod||!mod.__esModule?__defProp4(target,"default",{value:mod,enumerable:true}):target,mod));var require_browserfs=__commonJS4({"node_modules/browserfs/dist/browserfs.js"(exports,module2){(function webpackUniversalModuleDefinition(root,factory){if(typeof exports==="object"&&typeof module2==="object")module2.exports=factory();else if(typeof define==="function"&&define.amd)define([],factory);else if(typeof exports==="object")exports["BrowserFS"]=factory();else root["BrowserFS"]=factory()})(exports,function(){return function(modules){var installedModules={};function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module22=installedModules[moduleId]={exports:{},id:moduleId,loaded:false};modules[moduleId].call(module22.exports,module22,module22.exports,__webpack_require__);module22.loaded=true;return module22.exports}__webpack_require__.m=modules;__webpack_require__.c=installedModules;__webpack_require__.p="";return __webpack_require__(0)}([function(module22,exports2,__webpack_require__){(function(Buffer2,global2,module3,process){"use strict";Object.defineProperty(exports2,"__esModule",{value:true});var buffer=__webpack_require__(2);var path=__webpack_require__(9);var ErrorCode;(function(ErrorCode2){ErrorCode2[ErrorCode2["EPERM"]=1]="EPERM";ErrorCode2[ErrorCode2["ENOENT"]=2]="ENOENT";ErrorCode2[ErrorCode2["EIO"]=5]="EIO";ErrorCode2[ErrorCode2["EBADF"]=9]="EBADF";ErrorCode2[ErrorCode2["EACCES"]=13]="EACCES";ErrorCode2[ErrorCode2["EBUSY"]=16]="EBUSY";ErrorCode2[ErrorCode2["EEXIST"]=17]="EEXIST";ErrorCode2[ErrorCode2["ENOTDIR"]=20]="ENOTDIR";ErrorCode2[ErrorCode2["EISDIR"]=21]="EISDIR";ErrorCode2[ErrorCode2["EINVAL"]=22]="EINVAL";ErrorCode2[ErrorCode2["EFBIG"]=27]="EFBIG";ErrorCode2[ErrorCode2["ENOSPC"]=28]="ENOSPC";ErrorCode2[ErrorCode2["EROFS"]=30]="EROFS";ErrorCode2[ErrorCode2["ENOTEMPTY"]=39]="ENOTEMPTY";ErrorCode2[ErrorCode2["ENOTSUP"]=95]="ENOTSUP"})(ErrorCode||(ErrorCode={}));var ErrorStrings={};ErrorStrings[ErrorCode.EPERM]="Operation not permitted.";ErrorStrings[ErrorCode.ENOENT]="No such file or directory.";ErrorStrings[ErrorCode.EIO]="Input/output error.";ErrorStrings[ErrorCode.EBADF]="Bad file descriptor.";ErrorStrings[ErrorCode.EACCES]="Permission denied.";ErrorStrings[ErrorCode.EBUSY]="Resource busy or locked.";ErrorStrings[ErrorCode.EEXIST]="File exists.";ErrorStrings[ErrorCode.ENOTDIR]="File is not a directory.";ErrorStrings[ErrorCode.EISDIR]="File is a directory.";ErrorStrings[ErrorCode.EINVAL]="Invalid argument.";ErrorStrings[ErrorCode.EFBIG]="File is too big.";ErrorStrings[ErrorCode.ENOSPC]="No space left on disk.";ErrorStrings[ErrorCode.EROFS]="Cannot modify a read-only file system.";ErrorStrings[ErrorCode.ENOTEMPTY]="Directory is not empty.";ErrorStrings[ErrorCode.ENOTSUP]="Operation is not supported.";var ApiError=function(Error2){function ApiError2(type,message,path$$1){if(message===void 0)message=ErrorStrings[type];Error2.call(this,message);this.syscall="";this.errno=type;this.code=ErrorCode[type];this.path=path$$1;this.stack=new Error2().stack;this.message="Error: "+this.code+": "+message+(this.path?", \'"+this.path+"\'":"")}if(Error2)ApiError2.__proto__=Error2;ApiError2.prototype=Object.create(Error2&&Error2.prototype);ApiError2.prototype.constructor=ApiError2;ApiError2.fromJSON=function fromJSON(json){var err=new ApiError2(0);err.errno=json.errno;err.code=json.code;err.path=json.path;err.stack=json.stack;err.message=json.message;return err};ApiError2.fromBuffer=function fromBuffer(buffer$$1,i22){if(i22===void 0)i22=0;return ApiError2.fromJSON(JSON.parse(buffer$$1.toString("utf8",i22+4,i22+4+buffer$$1.readUInt32LE(i22))))};ApiError2.FileError=function FileError(code,p2){return new ApiError2(code,ErrorStrings[code],p2)};ApiError2.ENOENT=function ENOENT(path$$1){return this.FileError(ErrorCode.ENOENT,path$$1)};ApiError2.EEXIST=function EEXIST(path$$1){return this.FileError(ErrorCode.EEXIST,path$$1)};ApiError2.EISDIR=function EISDIR(path$$1){return this.FileError(ErrorCode.EISDIR,path$$1)};ApiError2.ENOTDIR=function ENOTDIR(path$$1){return this.FileError(ErrorCode.ENOTDIR,path$$1)};ApiError2.EPERM=function EPERM(path$$1){return this.FileError(ErrorCode.EPERM,path$$1)};ApiError2.ENOTEMPTY=function ENOTEMPTY(path$$1){return this.FileError(ErrorCode.ENOTEMPTY,path$$1)};ApiError2.prototype.toString=function toString(){return this.message};ApiError2.prototype.toJSON=function toJSON(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}};ApiError2.prototype.writeToBuffer=function writeToBuffer(buffer$$1,i22){if(buffer$$1===void 0)buffer$$1=Buffer2.alloc(this.bufferSize());if(i22===void 0)i22=0;var bytesWritten=buffer$$1.write(JSON.stringify(this.toJSON()),i22+4);buffer$$1.writeUInt32LE(bytesWritten,i22);return buffer$$1};ApiError2.prototype.bufferSize=function bufferSize(){return 4+Buffer2.byteLength(JSON.stringify(this.toJSON()))};return ApiError2}(Error);var api_error=Object.freeze({get ErrorCode(){return ErrorCode},ErrorStrings,ApiError});var ActionType;(function(ActionType2){ActionType2[ActionType2["NOP"]=0]="NOP";ActionType2[ActionType2["THROW_EXCEPTION"]=1]="THROW_EXCEPTION";ActionType2[ActionType2["TRUNCATE_FILE"]=2]="TRUNCATE_FILE";ActionType2[ActionType2["CREATE_FILE"]=3]="CREATE_FILE"})(ActionType||(ActionType={}));var FileFlag=function FileFlag2(flagStr){this.flagStr=flagStr;if(FileFlag2.validFlagStrs.indexOf(flagStr)<0){throw new ApiError(ErrorCode.EINVAL,"Invalid flag: "+flagStr)}};FileFlag.getFileFlag=function getFileFlag(flagStr){if(FileFlag.flagCache.hasOwnProperty(flagStr)){return FileFlag.flagCache[flagStr]}return FileFlag.flagCache[flagStr]=new FileFlag(flagStr)};FileFlag.prototype.getFlagString=function getFlagString(){return this.flagStr};FileFlag.prototype.isReadable=function isReadable(){return this.flagStr.indexOf("r")!==-1||this.flagStr.indexOf("+")!==-1};FileFlag.prototype.isWriteable=function isWriteable(){return this.flagStr.indexOf("w")!==-1||this.flagStr.indexOf("a")!==-1||this.flagStr.indexOf("+")!==-1};FileFlag.prototype.isTruncating=function isTruncating(){return this.flagStr.indexOf("w")!==-1};FileFlag.prototype.isAppendable=function isAppendable(){return this.flagStr.indexOf("a")!==-1};FileFlag.prototype.isSynchronous=function isSynchronous(){return this.flagStr.indexOf("s")!==-1};FileFlag.prototype.isExclusive=function isExclusive(){return this.flagStr.indexOf("x")!==-1};FileFlag.prototype.pathExistsAction=function pathExistsAction(){if(this.isExclusive()){return ActionType.THROW_EXCEPTION}else if(this.isTruncating()){return ActionType.TRUNCATE_FILE}else{return ActionType.NOP}};FileFlag.prototype.pathNotExistsAction=function pathNotExistsAction(){if((this.isWriteable()||this.isAppendable())&&this.flagStr!=="r+"){return ActionType.CREATE_FILE}else{return ActionType.THROW_EXCEPTION}};FileFlag.flagCache={};FileFlag.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"];var FileType;(function(FileType2){FileType2[FileType2["FILE"]=32768]="FILE";FileType2[FileType2["DIRECTORY"]=16384]="DIRECTORY";FileType2[FileType2["SYMLINK"]=40960]="SYMLINK"})(FileType||(FileType={}));var Stats=function Stats2(itemType,size,mode,atime,mtime,ctime){if(atime===void 0)atime=new Date;if(mtime===void 0)mtime=new Date;if(ctime===void 0)ctime=new Date;this.size=size;this.atime=atime;this.mtime=mtime;this.ctime=ctime;this.dev=0;this.ino=0;this.rdev=0;this.nlink=1;this.blksize=4096;this.uid=0;this.gid=0;this.birthtime=new Date(0);this.fileData=null;if(!mode){switch(itemType){case FileType.FILE:this.mode=420;break;case FileType.DIRECTORY:default:this.mode=511}}else{this.mode=mode}this.blocks=Math.ceil(size/512);if(this.mode<4096){this.mode|=itemType}};Stats.fromBuffer=function fromBuffer(buffer$$1){var size=buffer$$1.readUInt32LE(0),mode=buffer$$1.readUInt32LE(4),atime=buffer$$1.readDoubleLE(8),mtime=buffer$$1.readDoubleLE(16),ctime=buffer$$1.readDoubleLE(24);return new Stats(mode&61440,size,mode&4095,new Date(atime),new Date(mtime),new Date(ctime))};Stats.prototype.toBuffer=function toBuffer(){var buffer$$1=Buffer2.alloc(32);buffer$$1.writeUInt32LE(this.size,0);buffer$$1.writeUInt32LE(this.mode,4);buffer$$1.writeDoubleLE(this.atime.getTime(),8);buffer$$1.writeDoubleLE(this.mtime.getTime(),16);buffer$$1.writeDoubleLE(this.ctime.getTime(),24);return buffer$$1};Stats.prototype.clone=function clone(){return new Stats(this.mode&61440,this.size,this.mode&4095,this.atime,this.mtime,this.ctime)};Stats.prototype.isFile=function isFile(){return(this.mode&61440)===FileType.FILE};Stats.prototype.isDirectory=function isDirectory(){return(this.mode&61440)===FileType.DIRECTORY};Stats.prototype.isSymbolicLink=function isSymbolicLink(){return(this.mode&61440)===FileType.SYMLINK};Stats.prototype.chmod=function chmod(mode){this.mode=this.mode&61440|mode};Stats.prototype.isSocket=function isSocket(){return false};Stats.prototype.isBlockDevice=function isBlockDevice(){return false};Stats.prototype.isCharacterDevice=function isCharacterDevice(){return false};Stats.prototype.isFIFO=function isFIFO(){return false};var wrapCb=function(cb,numArgs){return cb};function assertRoot(fs4){if(fs4){return fs4}throw new ApiError(ErrorCode.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function normalizeMode(mode,def){switch(typeof mode){case"number":return mode;case"string":var trueMode=parseInt(mode,8);if(!isNaN(trueMode)){return trueMode}return def;default:return def}}function normalizeTime(time){if(time instanceof Date){return time}else if(typeof time==="number"){return new Date(time*1e3)}else{throw new ApiError(ErrorCode.EINVAL,"Invalid time.")}}function normalizePath(p2){if(p2.indexOf("\\0")>=0){throw new ApiError(ErrorCode.EINVAL,"Path must be a string without null bytes.")}else if(p2===""){throw new ApiError(ErrorCode.EINVAL,"Path must not be empty.")}return path.resolve(p2)}function normalizeOptions(options,defEnc,defFlag,defMode){switch(typeof options){case"object":return{encoding:typeof options["encoding"]!=="undefined"?options["encoding"]:defEnc,flag:typeof options["flag"]!=="undefined"?options["flag"]:defFlag,mode:normalizeMode(options["mode"],defMode)};case"string":return{encoding:options,flag:defFlag,mode:defMode};default:return{encoding:defEnc,flag:defFlag,mode:defMode}}}function nopCb(){}var FS=function FS2(){this.F_OK=0;this.R_OK=4;this.W_OK=2;this.X_OK=1;this.root=null;this.fdMap={};this.nextFd=100};FS.prototype.initialize=function initialize3(rootFS){if(!rootFS.constructor.isAvailable()){throw new ApiError(ErrorCode.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.")}return this.root=rootFS};FS.prototype._toUnixTimestamp=function _toUnixTimestamp(time){if(typeof time==="number"){return time}else if(time instanceof Date){return time.getTime()/1e3}throw new Error("Cannot parse time: "+time)};FS.prototype.getRootFS=function getRootFS(){if(this.root){return this.root}else{return null}};FS.prototype.rename=function rename(oldPath,newPath,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{assertRoot(this.root).rename(normalizePath(oldPath),normalizePath(newPath),newCb)}catch(e){newCb(e)}};FS.prototype.renameSync=function renameSync(oldPath,newPath){assertRoot(this.root).renameSync(normalizePath(oldPath),normalizePath(newPath))};FS.prototype.exists=function exists2(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{return assertRoot(this.root).exists(normalizePath(path$$1),newCb)}catch(e){return newCb(false)}};FS.prototype.existsSync=function existsSync(path$$1){try{return assertRoot(this.root).existsSync(normalizePath(path$$1))}catch(e){return false}};FS.prototype.stat=function stat(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,2);try{return assertRoot(this.root).stat(normalizePath(path$$1),false,newCb)}catch(e){return newCb(e)}};FS.prototype.statSync=function statSync(path$$1){return assertRoot(this.root).statSync(normalizePath(path$$1),false)};FS.prototype.lstat=function lstat(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,2);try{return assertRoot(this.root).stat(normalizePath(path$$1),true,newCb)}catch(e){return newCb(e)}};FS.prototype.lstatSync=function lstatSync(path$$1){return assertRoot(this.root).statSync(normalizePath(path$$1),true)};FS.prototype.truncate=function truncate(path$$1,arg2,cb){if(arg2===void 0)arg2=0;if(cb===void 0)cb=nopCb;var len=0;if(typeof arg2==="function"){cb=arg2}else if(typeof arg2==="number"){len=arg2}var newCb=wrapCb(cb,1);try{if(len<0){throw new ApiError(ErrorCode.EINVAL)}return assertRoot(this.root).truncate(normalizePath(path$$1),len,newCb)}catch(e){return newCb(e)}};FS.prototype.truncateSync=function truncateSync(path$$1,len){if(len===void 0)len=0;if(len<0){throw new ApiError(ErrorCode.EINVAL)}return assertRoot(this.root).truncateSync(normalizePath(path$$1),len)};FS.prototype.unlink=function unlink(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{return assertRoot(this.root).unlink(normalizePath(path$$1),newCb)}catch(e){return newCb(e)}};FS.prototype.unlinkSync=function unlinkSync(path$$1){return assertRoot(this.root).unlinkSync(normalizePath(path$$1))};FS.prototype.open=function open(path$$1,flag,arg2,cb){var this$1=this;if(cb===void 0)cb=nopCb;var mode=normalizeMode(arg2,420);cb=typeof arg2==="function"?arg2:cb;var newCb=wrapCb(cb,2);try{assertRoot(this.root).open(normalizePath(path$$1),FileFlag.getFileFlag(flag),mode,function(e,file){if(file){newCb(e,this$1.getFdForFile(file))}else{newCb(e)}})}catch(e){newCb(e)}};FS.prototype.openSync=function openSync(path$$1,flag,mode){if(mode===void 0)mode=420;return this.getFdForFile(assertRoot(this.root).openSync(normalizePath(path$$1),FileFlag.getFileFlag(flag),normalizeMode(mode,420)))};FS.prototype.readFile=function readFile2(filename,arg2,cb){if(arg2===void 0)arg2={};if(cb===void 0)cb=nopCb;var options=normalizeOptions(arg2,null,"r",null);cb=typeof arg2==="function"?arg2:cb;var newCb=wrapCb(cb,2);try{var flag=FileFlag.getFileFlag(options["flag"]);if(!flag.isReadable()){return newCb(new ApiError(ErrorCode.EINVAL,"Flag passed to readFile must allow for reading."))}return assertRoot(this.root).readFile(normalizePath(filename),options.encoding,flag,newCb)}catch(e){return newCb(e)}};FS.prototype.readFileSync=function readFileSync(filename,arg2){if(arg2===void 0)arg2={};var options=normalizeOptions(arg2,null,"r",null);var flag=FileFlag.getFileFlag(options.flag);if(!flag.isReadable()){throw new ApiError(ErrorCode.EINVAL,"Flag passed to readFile must allow for reading.")}return assertRoot(this.root).readFileSync(normalizePath(filename),options.encoding,flag)};FS.prototype.writeFile=function writeFile2(filename,data,arg3,cb){if(arg3===void 0)arg3={};if(cb===void 0)cb=nopCb;var options=normalizeOptions(arg3,"utf8","w",420);cb=typeof arg3==="function"?arg3:cb;var newCb=wrapCb(cb,1);try{var flag=FileFlag.getFileFlag(options.flag);if(!flag.isWriteable()){return newCb(new ApiError(ErrorCode.EINVAL,"Flag passed to writeFile must allow for writing."))}return assertRoot(this.root).writeFile(normalizePath(filename),data,options.encoding,flag,options.mode,newCb)}catch(e){return newCb(e)}};FS.prototype.writeFileSync=function writeFileSync(filename,data,arg3){var options=normalizeOptions(arg3,"utf8","w",420);var flag=FileFlag.getFileFlag(options.flag);if(!flag.isWriteable()){throw new ApiError(ErrorCode.EINVAL,"Flag passed to writeFile must allow for writing.")}return assertRoot(this.root).writeFileSync(normalizePath(filename),data,options.encoding,flag,options.mode)};FS.prototype.appendFile=function appendFile3(filename,data,arg3,cb){if(cb===void 0)cb=nopCb;var options=normalizeOptions(arg3,"utf8","a",420);cb=typeof arg3==="function"?arg3:cb;var newCb=wrapCb(cb,1);try{var flag=FileFlag.getFileFlag(options.flag);if(!flag.isAppendable()){return newCb(new ApiError(ErrorCode.EINVAL,"Flag passed to appendFile must allow for appending."))}assertRoot(this.root).appendFile(normalizePath(filename),data,options.encoding,flag,options.mode,newCb)}catch(e){newCb(e)}};FS.prototype.appendFileSync=function appendFileSync(filename,data,arg3){var options=normalizeOptions(arg3,"utf8","a",420);var flag=FileFlag.getFileFlag(options.flag);if(!flag.isAppendable()){throw new ApiError(ErrorCode.EINVAL,"Flag passed to appendFile must allow for appending.")}return assertRoot(this.root).appendFileSync(normalizePath(filename),data,options.encoding,flag,options.mode)};FS.prototype.fstat=function fstat(fd,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,2);try{var file=this.fd2file(fd);file.stat(newCb)}catch(e){newCb(e)}};FS.prototype.fstatSync=function fstatSync(fd){return this.fd2file(fd).statSync()};FS.prototype.close=function close(fd,cb){var this$1=this;if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{this.fd2file(fd).close(function(e){if(!e){this$1.closeFd(fd)}newCb(e)})}catch(e){newCb(e)}};FS.prototype.closeSync=function closeSync(fd){this.fd2file(fd).closeSync();this.closeFd(fd)};FS.prototype.ftruncate=function ftruncate(fd,arg2,cb){if(cb===void 0)cb=nopCb;var length=typeof arg2==="number"?arg2:0;cb=typeof arg2==="function"?arg2:cb;var newCb=wrapCb(cb,1);try{var file=this.fd2file(fd);if(length<0){throw new ApiError(ErrorCode.EINVAL)}file.truncate(length,newCb)}catch(e){newCb(e)}};FS.prototype.ftruncateSync=function ftruncateSync(fd,len){if(len===void 0)len=0;var file=this.fd2file(fd);if(len<0){throw new ApiError(ErrorCode.EINVAL)}file.truncateSync(len)};FS.prototype.fsync=function fsync(fd,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{this.fd2file(fd).sync(newCb)}catch(e){newCb(e)}};FS.prototype.fsyncSync=function fsyncSync(fd){this.fd2file(fd).syncSync()};FS.prototype.fdatasync=function fdatasync(fd,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{this.fd2file(fd).datasync(newCb)}catch(e){newCb(e)}};FS.prototype.fdatasyncSync=function fdatasyncSync(fd){this.fd2file(fd).datasyncSync()};FS.prototype.write=function write(fd,arg2,arg3,arg4,arg5,cb){if(cb===void 0)cb=nopCb;var buffer$$1,offset,length,position=null;if(typeof arg2==="string"){var encoding="utf8";switch(typeof arg3){case"function":cb=arg3;break;case"number":position=arg3;encoding=typeof arg4==="string"?arg4:"utf8";cb=typeof arg5==="function"?arg5:cb;break;default:cb=typeof arg4==="function"?arg4:typeof arg5==="function"?arg5:cb;return cb(new ApiError(ErrorCode.EINVAL,"Invalid arguments."))}buffer$$1=Buffer2.from(arg2,encoding);offset=0;length=buffer$$1.length}else{buffer$$1=arg2;offset=arg3;length=arg4;position=typeof arg5==="number"?arg5:null;cb=typeof arg5==="function"?arg5:cb}var newCb=wrapCb(cb,3);try{var file=this.fd2file(fd);if(position===void 0||position===null){position=file.getPos()}file.write(buffer$$1,offset,length,position,newCb)}catch(e){newCb(e)}};FS.prototype.writeSync=function writeSync(fd,arg2,arg3,arg4,arg5){var buffer$$1,offset=0,length,position;if(typeof arg2==="string"){position=typeof arg3==="number"?arg3:null;var encoding=typeof arg4==="string"?arg4:"utf8";offset=0;buffer$$1=Buffer2.from(arg2,encoding);length=buffer$$1.length}else{buffer$$1=arg2;offset=arg3;length=arg4;position=typeof arg5==="number"?arg5:null}var file=this.fd2file(fd);if(position===void 0||position===null){position=file.getPos()}return file.writeSync(buffer$$1,offset,length,position)};FS.prototype.read=function read(fd,arg2,arg3,arg4,arg5,cb){if(cb===void 0)cb=nopCb;var position,offset,length,buffer$$1,newCb;if(typeof arg2==="number"){length=arg2;position=arg3;var encoding=arg4;cb=typeof arg5==="function"?arg5:cb;offset=0;buffer$$1=Buffer2.alloc(length);newCb=wrapCb(function(err,bytesRead,buf){if(err){return cb(err)}cb(err,buf.toString(encoding),bytesRead)},3)}else{buffer$$1=arg2;offset=arg3;length=arg4;position=arg5;newCb=wrapCb(cb,3)}try{var file=this.fd2file(fd);if(position===void 0||position===null){position=file.getPos()}file.read(buffer$$1,offset,length,position,newCb)}catch(e){newCb(e)}};FS.prototype.readSync=function readSync(fd,arg2,arg3,arg4,arg5){var shenanigans=false;var buffer$$1,offset,length,position,encoding="utf8";if(typeof arg2==="number"){length=arg2;position=arg3;encoding=arg4;offset=0;buffer$$1=Buffer2.alloc(length);shenanigans=true}else{buffer$$1=arg2;offset=arg3;length=arg4;position=arg5}var file=this.fd2file(fd);if(position===void 0||position===null){position=file.getPos()}var rv=file.readSync(buffer$$1,offset,length,position);if(!shenanigans){return rv}else{return[buffer$$1.toString(encoding),rv]}};FS.prototype.fchown=function fchown(fd,uid,gid,callback){if(callback===void 0)callback=nopCb;var newCb=wrapCb(callback,1);try{this.fd2file(fd).chown(uid,gid,newCb)}catch(e){newCb(e)}};FS.prototype.fchownSync=function fchownSync(fd,uid,gid){this.fd2file(fd).chownSync(uid,gid)};FS.prototype.fchmod=function fchmod(fd,mode,cb){var newCb=wrapCb(cb,1);try{var numMode=typeof mode==="string"?parseInt(mode,8):mode;this.fd2file(fd).chmod(numMode,newCb)}catch(e){newCb(e)}};FS.prototype.fchmodSync=function fchmodSync(fd,mode){var numMode=typeof mode==="string"?parseInt(mode,8):mode;this.fd2file(fd).chmodSync(numMode)};FS.prototype.futimes=function futimes(fd,atime,mtime,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{var file=this.fd2file(fd);if(typeof atime==="number"){atime=new Date(atime*1e3)}if(typeof mtime==="number"){mtime=new Date(mtime*1e3)}file.utimes(atime,mtime,newCb)}catch(e){newCb(e)}};FS.prototype.futimesSync=function futimesSync(fd,atime,mtime){this.fd2file(fd).utimesSync(normalizeTime(atime),normalizeTime(mtime))};FS.prototype.rmdir=function rmdir(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{path$$1=normalizePath(path$$1);assertRoot(this.root).rmdir(path$$1,newCb)}catch(e){newCb(e)}};FS.prototype.rmdirSync=function rmdirSync(path$$1){path$$1=normalizePath(path$$1);return assertRoot(this.root).rmdirSync(path$$1)};FS.prototype.mkdir=function mkdir(path$$1,mode,cb){if(cb===void 0)cb=nopCb;if(typeof mode==="function"){cb=mode;mode=511}var newCb=wrapCb(cb,1);try{path$$1=normalizePath(path$$1);assertRoot(this.root).mkdir(path$$1,mode,newCb)}catch(e){newCb(e)}};FS.prototype.mkdirSync=function mkdirSync(path$$1,mode){assertRoot(this.root).mkdirSync(normalizePath(path$$1),normalizeMode(mode,511))};FS.prototype.readdir=function readdir(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,2);try{path$$1=normalizePath(path$$1);assertRoot(this.root).readdir(path$$1,newCb)}catch(e){newCb(e)}};FS.prototype.readdirSync=function readdirSync(path$$1){path$$1=normalizePath(path$$1);return assertRoot(this.root).readdirSync(path$$1)};FS.prototype.link=function link(srcpath,dstpath,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{srcpath=normalizePath(srcpath);dstpath=normalizePath(dstpath);assertRoot(this.root).link(srcpath,dstpath,newCb)}catch(e){newCb(e)}};FS.prototype.linkSync=function linkSync(srcpath,dstpath){srcpath=normalizePath(srcpath);dstpath=normalizePath(dstpath);return assertRoot(this.root).linkSync(srcpath,dstpath)};FS.prototype.symlink=function symlink(srcpath,dstpath,arg3,cb){if(cb===void 0)cb=nopCb;var type=typeof arg3==="string"?arg3:"file";cb=typeof arg3==="function"?arg3:cb;var newCb=wrapCb(cb,1);try{if(type!=="file"&&type!=="dir"){return newCb(new ApiError(ErrorCode.EINVAL,"Invalid type: "+type))}srcpath=normalizePath(srcpath);dstpath=normalizePath(dstpath);assertRoot(this.root).symlink(srcpath,dstpath,type,newCb)}catch(e){newCb(e)}};FS.prototype.symlinkSync=function symlinkSync(srcpath,dstpath,type){if(!type){type="file"}else if(type!=="file"&&type!=="dir"){throw new ApiError(ErrorCode.EINVAL,"Invalid type: "+type)}srcpath=normalizePath(srcpath);dstpath=normalizePath(dstpath);return assertRoot(this.root).symlinkSync(srcpath,dstpath,type)};FS.prototype.readlink=function readlink(path$$1,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,2);try{path$$1=normalizePath(path$$1);assertRoot(this.root).readlink(path$$1,newCb)}catch(e){newCb(e)}};FS.prototype.readlinkSync=function readlinkSync(path$$1){path$$1=normalizePath(path$$1);return assertRoot(this.root).readlinkSync(path$$1)};FS.prototype.chown=function chown(path$$1,uid,gid,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{path$$1=normalizePath(path$$1);assertRoot(this.root).chown(path$$1,false,uid,gid,newCb)}catch(e){newCb(e)}};FS.prototype.chownSync=function chownSync(path$$1,uid,gid){path$$1=normalizePath(path$$1);assertRoot(this.root).chownSync(path$$1,false,uid,gid)};FS.prototype.lchown=function lchown(path$$1,uid,gid,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{path$$1=normalizePath(path$$1);assertRoot(this.root).chown(path$$1,true,uid,gid,newCb)}catch(e){newCb(e)}};FS.prototype.lchownSync=function lchownSync(path$$1,uid,gid){path$$1=normalizePath(path$$1);assertRoot(this.root).chownSync(path$$1,true,uid,gid)};FS.prototype.chmod=function chmod(path$$1,mode,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{var numMode=normalizeMode(mode,-1);if(numMode<0){throw new ApiError(ErrorCode.EINVAL,"Invalid mode.")}assertRoot(this.root).chmod(normalizePath(path$$1),false,numMode,newCb)}catch(e){newCb(e)}};FS.prototype.chmodSync=function chmodSync(path$$1,mode){var numMode=normalizeMode(mode,-1);if(numMode<0){throw new ApiError(ErrorCode.EINVAL,"Invalid mode.")}path$$1=normalizePath(path$$1);assertRoot(this.root).chmodSync(path$$1,false,numMode)};FS.prototype.lchmod=function lchmod(path$$1,mode,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{var numMode=normalizeMode(mode,-1);if(numMode<0){throw new ApiError(ErrorCode.EINVAL,"Invalid mode.")}assertRoot(this.root).chmod(normalizePath(path$$1),true,numMode,newCb)}catch(e){newCb(e)}};FS.prototype.lchmodSync=function lchmodSync(path$$1,mode){var numMode=normalizeMode(mode,-1);if(numMode<1){throw new ApiError(ErrorCode.EINVAL,"Invalid mode.")}assertRoot(this.root).chmodSync(normalizePath(path$$1),true,numMode)};FS.prototype.utimes=function utimes(path$$1,atime,mtime,cb){if(cb===void 0)cb=nopCb;var newCb=wrapCb(cb,1);try{assertRoot(this.root).utimes(normalizePath(path$$1),normalizeTime(atime),normalizeTime(mtime),newCb)}catch(e){newCb(e)}};FS.prototype.utimesSync=function utimesSync(path$$1,atime,mtime){assertRoot(this.root).utimesSync(normalizePath(path$$1),normalizeTime(atime),normalizeTime(mtime))};FS.prototype.realpath=function realpath(path$$1,arg2,cb){if(cb===void 0)cb=nopCb;var cache=typeof arg2==="object"?arg2:{};cb=typeof arg2==="function"?arg2:nopCb;var newCb=wrapCb(cb,2);try{path$$1=normalizePath(path$$1);assertRoot(this.root).realpath(path$$1,cache,newCb)}catch(e){newCb(e)}};FS.prototype.realpathSync=function realpathSync(path$$1,cache){if(cache===void 0)cache={};path$$1=normalizePath(path$$1);return assertRoot(this.root).realpathSync(path$$1,cache)};FS.prototype.watchFile=function watchFile(filename,arg2,listener){if(listener===void 0)listener=nopCb;throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.unwatchFile=function unwatchFile(filename,listener){if(listener===void 0)listener=nopCb;throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.watch=function watch(filename,arg2,listener){if(listener===void 0)listener=nopCb;throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.access=function access(path$$1,arg2,cb){if(cb===void 0)cb=nopCb;throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.accessSync=function accessSync(path$$1,mode){throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.createReadStream=function createReadStream(path$$1,options){throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.createWriteStream=function createWriteStream(path$$1,options){throw new ApiError(ErrorCode.ENOTSUP)};FS.prototype.wrapCallbacks=function wrapCallbacks(cbWrapper){wrapCb=cbWrapper};FS.prototype.getFdForFile=function getFdForFile(file){var fd=this.nextFd++;this.fdMap[fd]=file;return fd};FS.prototype.fd2file=function fd2file(fd){var rv=this.fdMap[fd];if(rv){return rv}else{throw new ApiError(ErrorCode.EBADF,"Invalid file descriptor.")}};FS.prototype.closeFd=function closeFd(fd){delete this.fdMap[fd]};FS.Stats=Stats;var fs3=new FS;var _fsMock={};var fsProto=FS.prototype;Object.keys(fsProto).forEach(function(key){if(typeof fs3[key]==="function"){_fsMock[key]=function(){return fs3[key].apply(fs3,arguments)}}else{_fsMock[key]=fs3[key]}});_fsMock["changeFSModule"]=function(newFs){fs3=newFs};_fsMock["getFSModule"]=function(){return fs3};_fsMock["FS"]=FS;function _min(d0,d1,d2,bx,ay){return d0<d1||d2<d1?d0>d2?d2+1:d0+1:bx===ay?d1:d1+1}function levenshtein(a,b){if(a===b){return 0}if(a.length>b.length){var tmp=a;a=b;b=tmp}var la=a.length;var lb=b.length;while(la>0&&a.charCodeAt(la-1)===b.charCodeAt(lb-1)){la--;lb--}var offset=0;while(offset<la&&a.charCodeAt(offset)===b.charCodeAt(offset)){offset++}la-=offset;lb-=offset;if(la===0||lb===1){return lb}var vector=new Array(la<<1);for(var y4=0;y4<la;){vector[la+y4]=a.charCodeAt(offset+y4);vector[y4]=++y4}var x3;var d0;var d1;var d2;var d3;for(x3=0;x3+3<lb;){var bx0=b.charCodeAt(offset+(d0=x3));var bx1=b.charCodeAt(offset+(d1=x3+1));var bx2=b.charCodeAt(offset+(d2=x3+2));var bx3=b.charCodeAt(offset+(d3=x3+3));var dd$1=x3+=4;for(var y$1=0;y$1<la;){var ay=vector[la+y$1];var dy=vector[y$1];d0=_min(dy,d0,d1,bx0,ay);d1=_min(d0,d1,d2,bx1,ay);d2=_min(d1,d2,d3,bx2,ay);dd$1=_min(d2,d3,dd$1,bx3,ay);vector[y$1++]=dd$1;d3=d2;d2=d1;d1=d0;d0=dy}}var dd=0;for(;x3<lb;){var bx0$1=b.charCodeAt(offset+(d0=x3));dd=++x3;for(var y$2=0;y$2<la;y$2++){var dy$1=vector[y$2];vector[y$2]=dd=dy$1<d0||dd<d0?dy$1>dd?dd+1:dy$1+1:bx0$1===vector[la+y$2]?d0:d0+1;d0=dy$1}}return dd}function deprecationMessage(print,fsName,opts){if(print){console.warn("["+fsName+"] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the \'"+fsName+".Create("+JSON.stringify(opts)+", callback)\' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.")}}var isIE=typeof navigator!=="undefined"&&!!(/(msie) ([\\w.]+)/.exec(navigator.userAgent.toLowerCase())||navigator.userAgent.indexOf("Trident")!==-1);var isWebWorker=typeof window==="undefined";function fail(){throw new Error("BFS has reached an impossible code path; please file a bug.")}function mkdirpSync(p2,mode,fs4){if(!fs4.existsSync(p2)){mkdirpSync(path.dirname(p2),mode,fs4);fs4.mkdirSync(p2,mode)}}function buffer2ArrayBuffer(buff){var u8=buffer2Uint8array(buff),u8offset=u8.byteOffset,u8Len=u8.byteLength;if(u8offset===0&&u8Len===u8.buffer.byteLength){return u8.buffer}else{return u8.buffer.slice(u8offset,u8offset+u8Len)}}function buffer2Uint8array(buff){if(buff instanceof Uint8Array){return buff}else{return new Uint8Array(buff)}}function arrayish2Buffer(arr){if(arr instanceof Buffer2){return arr}else if(arr instanceof Uint8Array){return uint8Array2Buffer(arr)}else{return Buffer2.from(arr)}}function uint8Array2Buffer(u8){if(u8 instanceof Buffer2){return u8}else if(u8.byteOffset===0&&u8.byteLength===u8.buffer.byteLength){return arrayBuffer2Buffer(u8.buffer)}else{return Buffer2.from(u8.buffer,u8.byteOffset,u8.byteLength)}}function arrayBuffer2Buffer(ab){return Buffer2.from(ab)}function copyingSlice(buff,start,end){if(start===void 0)start=0;if(end===void 0)end=buff.length;if(start<0||end<0||end>buff.length||start>end){throw new TypeError("Invalid slice bounds on buffer of length "+buff.length+": ["+start+", "+end+"]")}if(buff.length===0){return emptyBuffer()}else{var u8=buffer2Uint8array(buff),s0=buff[0],newS0=(s0+1)%255;buff[0]=newS0;if(u8[0]===newS0){u8[0]=s0;return uint8Array2Buffer(u8.slice(start,end))}else{buff[0]=s0;return uint8Array2Buffer(u8.subarray(start,end))}}}var emptyBuff=null;function emptyBuffer(){if(emptyBuff){return emptyBuff}return emptyBuff=Buffer2.alloc(0)}function bufferValidator(v2,cb){if(Buffer2.isBuffer(v2)){cb()}else{cb(new ApiError(ErrorCode.EINVAL,"option must be a Buffer."))}}function checkOptions(fsType,opts,cb){var optsInfo=fsType.Options;var fsName=fsType.Name;var pendingValidators=0;var callbackCalled=false;var loopEnded=false;function validatorCallback(e){if(!callbackCalled){if(e){callbackCalled=true;cb(e)}pendingValidators--;if(pendingValidators===0&&loopEnded){cb()}}}var loop3=function(optName2){if(optsInfo.hasOwnProperty(optName2)){var opt=optsInfo[optName2];var providedValue=opts[optName2];if(providedValue===void 0||providedValue===null){if(!opt.optional){var incorrectOptions=Object.keys(opts).filter(function(o){return!(o in optsInfo)}).map(function(a){return{str:a,distance:levenshtein(optName2,a)}}).filter(function(o){return o.distance<5}).sort(function(a,b){return a.distance-b.distance});if(callbackCalled){return{}}callbackCalled=true;return{v:cb(new ApiError(ErrorCode.EINVAL,"["+fsName+"] Required option \'"+optName2+"\' not provided."+(incorrectOptions.length>0?" You provided unrecognized option \'"+incorrectOptions[0].str+"\'; perhaps you meant to type \'"+optName2+"\'.":"")+"\\nOption description: "+opt.description))}}}else{var typeMatches=false;if(Array.isArray(opt.type)){typeMatches=opt.type.indexOf(typeof providedValue)!==-1}else{typeMatches=typeof providedValue===opt.type}if(!typeMatches){if(callbackCalled){return{}}callbackCalled=true;return{v:cb(new ApiError(ErrorCode.EINVAL,"["+fsName+"] Value provided for option "+optName2+" is not the proper type. Expected "+(Array.isArray(opt.type)?"one of {"+opt.type.join(", ")+"}":opt.type)+", but received "+typeof providedValue+"\\nOption description: "+opt.description))}}else if(opt.validator){pendingValidators++;opt.validator(providedValue,validatorCallback)}}}};for(var optName in optsInfo){var returned=loop3(optName);if(returned)return returned.v}loopEnded=true;if(pendingValidators===0&&!callbackCalled){cb()}}var BFSUtils=Object.freeze({deprecationMessage,isIE,isWebWorker,fail,mkdirpSync,buffer2ArrayBuffer,buffer2Uint8array,arrayish2Buffer,uint8Array2Buffer,arrayBuffer2Buffer,copyingSlice,emptyBuffer,bufferValidator,checkOptions});var BFSEmscriptenStreamOps=function BFSEmscriptenStreamOps2(fs4){this.fs=fs4;this.nodefs=fs4.getNodeFS();this.FS=fs4.getFS();this.PATH=fs4.getPATH();this.ERRNO_CODES=fs4.getERRNO_CODES()};BFSEmscriptenStreamOps.prototype.open=function open(stream){var path$$1=this.fs.realPath(stream.node);var FS2=this.FS;try{if(FS2.isFile(stream.node.mode)){stream.nfd=this.nodefs.openSync(path$$1,this.fs.flagsToPermissionString(stream.flags))}}catch(e){if(!e.code){throw e}throw new FS2.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenStreamOps.prototype.close=function close(stream){var FS2=this.FS;try{if(FS2.isFile(stream.node.mode)&&stream.nfd){this.nodefs.closeSync(stream.nfd)}}catch(e){if(!e.code){throw e}throw new FS2.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenStreamOps.prototype.read=function read(stream,buffer$$1,offset,length,position){try{return this.nodefs.readSync(stream.nfd,uint8Array2Buffer(buffer$$1),offset,length,position)}catch(e){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenStreamOps.prototype.write=function write(stream,buffer$$1,offset,length,position){try{return this.nodefs.writeSync(stream.nfd,uint8Array2Buffer(buffer$$1),offset,length,position)}catch(e){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenStreamOps.prototype.llseek=function llseek(stream,offset,whence){var position=offset;if(whence===1){position+=stream.position}else if(whence===2){if(this.FS.isFile(stream.node.mode)){try{var stat=this.nodefs.fstatSync(stream.nfd);position+=stat.size}catch(e){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}}}if(position<0){throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL)}stream.position=position;return position};var BFSEmscriptenNodeOps=function BFSEmscriptenNodeOps2(fs4){this.fs=fs4;this.nodefs=fs4.getNodeFS();this.FS=fs4.getFS();this.PATH=fs4.getPATH();this.ERRNO_CODES=fs4.getERRNO_CODES()};BFSEmscriptenNodeOps.prototype.getattr=function getattr(node){var path$$1=this.fs.realPath(node);var stat;try{stat=this.nodefs.lstatSync(path$$1)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}return{dev:stat.dev,ino:stat.ino,mode:stat.mode,nlink:stat.nlink,uid:stat.uid,gid:stat.gid,rdev:stat.rdev,size:stat.size,atime:stat.atime,mtime:stat.mtime,ctime:stat.ctime,blksize:stat.blksize,blocks:stat.blocks}};BFSEmscriptenNodeOps.prototype.setattr=function setattr(node,attr){var path$$1=this.fs.realPath(node);try{if(attr.mode!==void 0){this.nodefs.chmodSync(path$$1,attr.mode);node.mode=attr.mode}if(attr.timestamp!==void 0){var date=new Date(attr.timestamp);this.nodefs.utimesSync(path$$1,date,date)}}catch(e){if(!e.code){throw e}if(e.code!=="ENOTSUP"){throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}}if(attr.size!==void 0){try{this.nodefs.truncateSync(path$$1,attr.size)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}}};BFSEmscriptenNodeOps.prototype.lookup=function lookup(parent,name2){var path$$1=this.PATH.join2(this.fs.realPath(parent),name2);var mode=this.fs.getMode(path$$1);return this.fs.createNode(parent,name2,mode)};BFSEmscriptenNodeOps.prototype.mknod=function mknod(parent,name2,mode,dev){var node=this.fs.createNode(parent,name2,mode,dev);var path$$1=this.fs.realPath(node);try{if(this.FS.isDir(node.mode)){this.nodefs.mkdirSync(path$$1,node.mode)}else{this.nodefs.writeFileSync(path$$1,"",{mode:node.mode})}}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}return node};BFSEmscriptenNodeOps.prototype.rename=function rename(oldNode,newDir,newName){var oldPath=this.fs.realPath(oldNode);var newPath=this.PATH.join2(this.fs.realPath(newDir),newName);try{this.nodefs.renameSync(oldPath,newPath);oldNode.name=newName;oldNode.parent=newDir}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenNodeOps.prototype.unlink=function unlink(parent,name2){var path$$1=this.PATH.join2(this.fs.realPath(parent),name2);try{this.nodefs.unlinkSync(path$$1)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenNodeOps.prototype.rmdir=function rmdir(parent,name2){var path$$1=this.PATH.join2(this.fs.realPath(parent),name2);try{this.nodefs.rmdirSync(path$$1)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenNodeOps.prototype.readdir=function readdir(node){var path$$1=this.fs.realPath(node);try{var contents=this.nodefs.readdirSync(path$$1);contents.push(".","..");return contents}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenNodeOps.prototype.symlink=function symlink(parent,newName,oldPath){var newPath=this.PATH.join2(this.fs.realPath(parent),newName);try{this.nodefs.symlinkSync(oldPath,newPath)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};BFSEmscriptenNodeOps.prototype.readlink=function readlink(node){var path$$1=this.fs.realPath(node);try{return this.nodefs.readlinkSync(path$$1)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}};var BFSEmscriptenFS=function BFSEmscriptenFS2(_FS,_PATH,_ERRNO_CODES,nodefs){if(_FS===void 0)_FS=self["FS"];if(_PATH===void 0)_PATH=self["PATH"];if(_ERRNO_CODES===void 0)_ERRNO_CODES=self["ERRNO_CODES"];if(nodefs===void 0)nodefs=_fsMock;this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"};this.nodefs=nodefs;this.FS=_FS;this.PATH=_PATH;this.ERRNO_CODES=_ERRNO_CODES;this.node_ops=new BFSEmscriptenNodeOps(this);this.stream_ops=new BFSEmscriptenStreamOps(this)};BFSEmscriptenFS.prototype.mount=function mount(m){return this.createNode(null,"/",this.getMode(m.opts.root),0)};BFSEmscriptenFS.prototype.createNode=function createNode(parent,name2,mode,dev){var FS2=this.FS;if(!FS2.isDir(mode)&&!FS2.isFile(mode)&&!FS2.isLink(mode)){throw new FS2.ErrnoError(this.ERRNO_CODES.EINVAL)}var node=FS2.createNode(parent,name2,mode);node.node_ops=this.node_ops;node.stream_ops=this.stream_ops;return node};BFSEmscriptenFS.prototype.getMode=function getMode(path$$1){var stat;try{stat=this.nodefs.lstatSync(path$$1)}catch(e){if(!e.code){throw e}throw new this.FS.ErrnoError(this.ERRNO_CODES[e.code])}return stat.mode};BFSEmscriptenFS.prototype.realPath=function realPath(node){var parts=[];while(node.parent!==node){parts.push(node.name);node=node.parent}parts.push(node.mount.opts.root);parts.reverse();return this.PATH.join.apply(null,parts)};BFSEmscriptenFS.prototype.flagsToPermissionString=function flagsToPermissionString(flags){var parsedFlags=typeof flags==="string"?parseInt(flags,10):flags;parsedFlags&=8191;if(parsedFlags in this.flagsToPermissionStringMap){return this.flagsToPermissionStringMap[parsedFlags]}else{return flags}};BFSEmscriptenFS.prototype.getNodeFS=function getNodeFS(){return this.nodefs};BFSEmscriptenFS.prototype.getFS=function getFS(){return this.FS};BFSEmscriptenFS.prototype.getPATH=function getPATH(){return this.PATH};BFSEmscriptenFS.prototype.getERRNO_CODES=function getERRNO_CODES(){return this.ERRNO_CODES};var BaseFileSystem=function BaseFileSystem2(){};BaseFileSystem.prototype.supportsLinks=function supportsLinks(){return false};BaseFileSystem.prototype.diskSpace=function diskSpace(p2,cb){cb(0,0)};BaseFileSystem.prototype.openFile=function openFile(p2,flag,cb){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.createFile=function createFile(p2,flag,mode,cb){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.open=function open(p2,flag,mode,cb){var this$1=this;var mustBeFile=function(e,stats){if(e){switch(flag.pathNotExistsAction()){case ActionType.CREATE_FILE:return this$1.stat(path.dirname(p2),false,function(e2,parentStats){if(e2){cb(e2)}else if(parentStats&&!parentStats.isDirectory()){cb(ApiError.ENOTDIR(path.dirname(p2)))}else{this$1.createFile(p2,flag,mode,cb)}});case ActionType.THROW_EXCEPTION:return cb(ApiError.ENOENT(p2));default:return cb(new ApiError(ErrorCode.EINVAL,"Invalid FileFlag object."))}}else{if(stats&&stats.isDirectory()){return cb(ApiError.EISDIR(p2))}switch(flag.pathExistsAction()){case ActionType.THROW_EXCEPTION:return cb(ApiError.EEXIST(p2));case ActionType.TRUNCATE_FILE:return this$1.openFile(p2,flag,function(e2,fd){if(e2){cb(e2)}else if(fd){fd.truncate(0,function(){fd.sync(function(){cb(null,fd)})})}else{fail()}});case ActionType.NOP:return this$1.openFile(p2,flag,cb);default:return cb(new ApiError(ErrorCode.EINVAL,"Invalid FileFlag object."))}}};this.stat(p2,false,mustBeFile)};BaseFileSystem.prototype.rename=function rename(oldPath,newPath,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.renameSync=function renameSync(oldPath,newPath){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.stat=function stat(p2,isLstat,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.statSync=function statSync(p2,isLstat){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.openFileSync=function openFileSync(p2,flag,mode){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.createFileSync=function createFileSync(p2,flag,mode){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.openSync=function openSync(p2,flag,mode){var stats;try{stats=this.statSync(p2,false)}catch(e){switch(flag.pathNotExistsAction()){case ActionType.CREATE_FILE:var parentStats=this.statSync(path.dirname(p2),false);if(!parentStats.isDirectory()){throw ApiError.ENOTDIR(path.dirname(p2))}return this.createFileSync(p2,flag,mode);case ActionType.THROW_EXCEPTION:throw ApiError.ENOENT(p2);default:throw new ApiError(ErrorCode.EINVAL,"Invalid FileFlag object.")}}if(stats.isDirectory()){throw ApiError.EISDIR(p2)}switch(flag.pathExistsAction()){case ActionType.THROW_EXCEPTION:throw ApiError.EEXIST(p2);case ActionType.TRUNCATE_FILE:this.unlinkSync(p2);return this.createFileSync(p2,flag,stats.mode);case ActionType.NOP:return this.openFileSync(p2,flag,mode);default:throw new ApiError(ErrorCode.EINVAL,"Invalid FileFlag object.")}};BaseFileSystem.prototype.unlink=function unlink(p2,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.unlinkSync=function unlinkSync(p2){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.rmdir=function rmdir(p2,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.rmdirSync=function rmdirSync(p2){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.mkdir=function mkdir(p2,mode,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.mkdirSync=function mkdirSync(p2,mode){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.readdir=function readdir(p2,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.readdirSync=function readdirSync(p2){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.exists=function exists2(p2,cb){this.stat(p2,null,function(err){cb(!err)})};BaseFileSystem.prototype.existsSync=function existsSync(p2){try{this.statSync(p2,true);return true}catch(e){return false}};BaseFileSystem.prototype.realpath=function realpath(p2,cache,cb){if(this.supportsLinks()){var splitPath=p2.split(path.sep);for(var i22=0;i22<splitPath.length;i22++){var addPaths=splitPath.slice(0,i22+1);splitPath[i22]=path.join.apply(null,addPaths)}}else{this.exists(p2,function(doesExist){if(doesExist){cb(null,p2)}else{cb(ApiError.ENOENT(p2))}})}};BaseFileSystem.prototype.realpathSync=function realpathSync(p2,cache){if(this.supportsLinks()){var splitPath=p2.split(path.sep);for(var i22=0;i22<splitPath.length;i22++){var addPaths=splitPath.slice(0,i22+1);splitPath[i22]=path.join.apply(path,addPaths)}return splitPath.join(path.sep)}else{if(this.existsSync(p2)){return p2}else{throw ApiError.ENOENT(p2)}}};BaseFileSystem.prototype.truncate=function truncate(p2,len,cb){this.open(p2,FileFlag.getFileFlag("r+"),420,function(er,fd){if(er){return cb(er)}fd.truncate(len,function(er2){fd.close(function(er22){cb(er2||er22)})})})};BaseFileSystem.prototype.truncateSync=function truncateSync(p2,len){var fd=this.openSync(p2,FileFlag.getFileFlag("r+"),420);try{fd.truncateSync(len)}catch(e){throw e}finally{fd.closeSync()}};BaseFileSystem.prototype.readFile=function readFile2(fname,encoding,flag,cb){var oldCb=cb;this.open(fname,flag,420,function(err,fd){if(err){return cb(err)}cb=function(err2,arg){fd.close(function(err22){if(!err2){err2=err22}return oldCb(err2,arg)})};fd.stat(function(err2,stat){if(err2){return cb(err2)}var buf=Buffer2.alloc(stat.size);fd.read(buf,0,stat.size,0,function(err3){if(err3){return cb(err3)}else if(encoding===null){return cb(err3,buf)}try{cb(null,buf.toString(encoding))}catch(e){cb(e)}})})})};BaseFileSystem.prototype.readFileSync=function readFileSync(fname,encoding,flag){var fd=this.openSync(fname,flag,420);try{var stat=fd.statSync();var buf=Buffer2.alloc(stat.size);fd.readSync(buf,0,stat.size,0);fd.closeSync();if(encoding===null){return buf}return buf.toString(encoding)}finally{fd.closeSync()}};BaseFileSystem.prototype.writeFile=function writeFile2(fname,data,encoding,flag,mode,cb){var oldCb=cb;this.open(fname,flag,420,function(err,fd){if(err){return cb(err)}cb=function(err2){fd.close(function(err22){oldCb(err2?err2:err22)})};try{if(typeof data==="string"){data=Buffer2.from(data,encoding)}}catch(e){return cb(e)}fd.write(data,0,data.length,0,cb)})};BaseFileSystem.prototype.writeFileSync=function writeFileSync(fname,data,encoding,flag,mode){var fd=this.openSync(fname,flag,mode);try{if(typeof data==="string"){data=Buffer2.from(data,encoding)}fd.writeSync(data,0,data.length,0)}finally{fd.closeSync()}};BaseFileSystem.prototype.appendFile=function appendFile3(fname,data,encoding,flag,mode,cb){var oldCb=cb;this.open(fname,flag,mode,function(err,fd){if(err){return cb(err)}cb=function(err2){fd.close(function(err22){oldCb(err2?err2:err22)})};if(typeof data==="string"){data=Buffer2.from(data,encoding)}fd.write(data,0,data.length,null,cb)})};BaseFileSystem.prototype.appendFileSync=function appendFileSync(fname,data,encoding,flag,mode){var fd=this.openSync(fname,flag,mode);try{if(typeof data==="string"){data=Buffer2.from(data,encoding)}fd.writeSync(data,0,data.length,null)}finally{fd.closeSync()}};BaseFileSystem.prototype.chmod=function chmod(p2,isLchmod,mode,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.chmodSync=function chmodSync(p2,isLchmod,mode){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.chown=function chown(p2,isLchown,uid,gid,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.chownSync=function chownSync(p2,isLchown,uid,gid){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.utimes=function utimes(p2,atime,mtime,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.utimesSync=function utimesSync(p2,atime,mtime){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.link=function link(srcpath,dstpath,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.linkSync=function linkSync(srcpath,dstpath){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.symlink=function symlink(srcpath,dstpath,type,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.symlinkSync=function symlinkSync(srcpath,dstpath,type){throw new ApiError(ErrorCode.ENOTSUP)};BaseFileSystem.prototype.readlink=function readlink(p2,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFileSystem.prototype.readlinkSync=function readlinkSync(p2){throw new ApiError(ErrorCode.ENOTSUP)};var SynchronousFileSystem=function(BaseFileSystem2){function SynchronousFileSystem2(){BaseFileSystem2.apply(this,arguments)}if(BaseFileSystem2)SynchronousFileSystem2.__proto__=BaseFileSystem2;SynchronousFileSystem2.prototype=Object.create(BaseFileSystem2&&BaseFileSystem2.prototype);SynchronousFileSystem2.prototype.constructor=SynchronousFileSystem2;SynchronousFileSystem2.prototype.supportsSynch=function supportsSynch(){return true};SynchronousFileSystem2.prototype.rename=function rename(oldPath,newPath,cb){try{this.renameSync(oldPath,newPath);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.stat=function stat(p2,isLstat,cb){try{cb(null,this.statSync(p2,isLstat))}catch(e){cb(e)}};SynchronousFileSystem2.prototype.open=function open(p2,flags,mode,cb){try{cb(null,this.openSync(p2,flags,mode))}catch(e){cb(e)}};SynchronousFileSystem2.prototype.unlink=function unlink(p2,cb){try{this.unlinkSync(p2);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.rmdir=function rmdir(p2,cb){try{this.rmdirSync(p2);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.mkdir=function mkdir(p2,mode,cb){try{this.mkdirSync(p2,mode);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.readdir=function readdir(p2,cb){try{cb(null,this.readdirSync(p2))}catch(e){cb(e)}};SynchronousFileSystem2.prototype.chmod=function chmod(p2,isLchmod,mode,cb){try{this.chmodSync(p2,isLchmod,mode);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.chown=function chown(p2,isLchown,uid,gid,cb){try{this.chownSync(p2,isLchown,uid,gid);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.utimes=function utimes(p2,atime,mtime,cb){try{this.utimesSync(p2,atime,mtime);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.link=function link(srcpath,dstpath,cb){try{this.linkSync(srcpath,dstpath);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.symlink=function symlink(srcpath,dstpath,type,cb){try{this.symlinkSync(srcpath,dstpath,type);cb()}catch(e){cb(e)}};SynchronousFileSystem2.prototype.readlink=function readlink(p2,cb){try{cb(null,this.readlinkSync(p2))}catch(e){cb(e)}};return SynchronousFileSystem2}(BaseFileSystem);var BaseFile=function BaseFile2(){};BaseFile.prototype.sync=function sync(cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFile.prototype.syncSync=function syncSync(){throw new ApiError(ErrorCode.ENOTSUP)};BaseFile.prototype.datasync=function datasync(cb){this.sync(cb)};BaseFile.prototype.datasyncSync=function datasyncSync(){return this.syncSync()};BaseFile.prototype.chown=function chown(uid,gid,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFile.prototype.chownSync=function chownSync(uid,gid){throw new ApiError(ErrorCode.ENOTSUP)};BaseFile.prototype.chmod=function chmod(mode,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFile.prototype.chmodSync=function chmodSync(mode){throw new ApiError(ErrorCode.ENOTSUP)};BaseFile.prototype.utimes=function utimes(atime,mtime,cb){cb(new ApiError(ErrorCode.ENOTSUP))};BaseFile.prototype.utimesSync=function utimesSync(atime,mtime){throw new ApiError(ErrorCode.ENOTSUP)};var PreloadFile=function(BaseFile$$1){function PreloadFile2(_fs,_path,_flag,_stat,contents){BaseFile$$1.call(this);this._pos=0;this._dirty=false;this._fs=_fs;this._path=_path;this._flag=_flag;this._stat=_stat;if(contents){this._buffer=contents}else{this._buffer=emptyBuffer()}if(this._stat.size!==this._buffer.length&&this._flag.isReadable()){throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}}if(BaseFile$$1)PreloadFile2.__proto__=BaseFile$$1;PreloadFile2.prototype=Object.create(BaseFile$$1&&BaseFile$$1.prototype);PreloadFile2.prototype.constructor=PreloadFile2;PreloadFile2.prototype.getBuffer=function getBuffer(){return this._buffer};PreloadFile2.prototype.getStats=function getStats(){return this._stat};PreloadFile2.prototype.getFlag=function getFlag2(){return this._flag};PreloadFile2.prototype.getPath=function getPath(){return this._path};PreloadFile2.prototype.getPos=function getPos(){if(this._flag.isAppendable()){return this._stat.size}return this._pos};PreloadFile2.prototype.advancePos=function advancePos(delta){return this._pos+=delta};PreloadFile2.prototype.setPos=function setPos(newPos){return this._pos=newPos};PreloadFile2.prototype.sync=function sync(cb){try{this.syncSync();cb()}catch(e){cb(e)}};PreloadFile2.prototype.syncSync=function syncSync(){throw new ApiError(ErrorCode.ENOTSUP)};PreloadFile2.prototype.close=function close(cb){try{this.closeSync();cb()}catch(e){cb(e)}};PreloadFile2.prototype.closeSync=function closeSync(){throw new ApiError(ErrorCode.ENOTSUP)};PreloadFile2.prototype.stat=function stat(cb){try{cb(null,this._stat.clone())}catch(e){cb(e)}};PreloadFile2.prototype.statSync=function statSync(){return this._stat.clone()};PreloadFile2.prototype.truncate=function truncate(len,cb){try{this.truncateSync(len);if(this._flag.isSynchronous()&&!_fsMock.getRootFS().supportsSynch()){this.sync(cb)}cb()}catch(e){return cb(e)}};PreloadFile2.prototype.truncateSync=function truncateSync(len){this._dirty=true;if(!this._flag.isWriteable()){throw new ApiError(ErrorCode.EPERM,"File not opened with a writeable mode.")}this._stat.mtime=new Date;if(len>this._buffer.length){var buf=Buffer2.alloc(len-this._buffer.length,0);this.writeSync(buf,0,buf.length,this._buffer.length);if(this._flag.isSynchronous()&&_fsMock.getRootFS().supportsSynch()){this.syncSync()}return}this._stat.size=len;var newBuff=Buffer2.alloc(len);this._buffer.copy(newBuff,0,0,len);this._buffer=newBuff;if(this._flag.isSynchronous()&&_fsMock.getRootFS().supportsSynch()){this.syncSync()}};PreloadFile2.prototype.write=function write(buffer$$1,offset,length,position,cb){try{cb(null,this.writeSync(buffer$$1,offset,length,position),buffer$$1)}catch(e){cb(e)}};PreloadFile2.prototype.writeSync=function writeSync(buffer$$1,offset,length,position){this._dirty=true;if(position===void 0||position===null){position=this.getPos()}if(!this._flag.isWriteable()){throw new ApiError(ErrorCode.EPERM,"File not opened with a writeable mode.")}var endFp=position+length;if(endFp>this._stat.size){this._stat.size=endFp;if(endFp>this._buffer.length){var newBuff=Buffer2.alloc(endFp);this._buffer.copy(newBuff);this._buffer=newBuff}}var len=buffer$$1.copy(this._buffer,position,offset,offset+length);this._stat.mtime=new Date;if(this._flag.isSynchronous()){this.syncSync();return len}this.setPos(position+len);return len};PreloadFile2.prototype.read=function read(buffer$$1,offset,length,position,cb){try{cb(null,this.readSync(buffer$$1,offset,length,position),buffer$$1)}catch(e){cb(e)}};PreloadFile2.prototype.readSync=function readSync(buffer$$1,offset,length,position){if(!this._flag.isReadable()){throw new ApiError(ErrorCode.EPERM,"File not opened with a readable mode.")}if(position===void 0||position===null){position=this.getPos()}var endRead=position+length;if(endRead>this._stat.size){length=this._stat.size-position}var rv=this._buffer.copy(buffer$$1,offset,position,position+length);this._stat.atime=new Date;this._pos=position+length;return rv};PreloadFile2.prototype.chmod=function chmod(mode,cb){try{this.chmodSync(mode);cb()}catch(e){cb(e)}};PreloadFile2.prototype.chmodSync=function chmodSync(mode){if(!this._fs.supportsProps()){throw new ApiError(ErrorCode.ENOTSUP)}this._dirty=true;this._stat.chmod(mode);this.syncSync()};PreloadFile2.prototype.isDirty=function isDirty(){return this._dirty};PreloadFile2.prototype.resetDirty=function resetDirty(){this._dirty=false};return PreloadFile2}(BaseFile);var NoSyncFile=function(PreloadFile2){function NoSyncFile2(_fs,_path,_flag,_stat,contents){PreloadFile2.call(this,_fs,_path,_flag,_stat,contents)}if(PreloadFile2)NoSyncFile2.__proto__=PreloadFile2;NoSyncFile2.prototype=Object.create(PreloadFile2&&PreloadFile2.prototype);NoSyncFile2.prototype.constructor=NoSyncFile2;NoSyncFile2.prototype.sync=function sync(cb){cb()};NoSyncFile2.prototype.syncSync=function syncSync(){};NoSyncFile2.prototype.close=function close(cb){cb()};NoSyncFile2.prototype.closeSync=function closeSync(){};return NoSyncFile2}(PreloadFile);var MirrorFile=function(PreloadFile$$1){function MirrorFile2(fs4,path$$1,flag,stat,data){PreloadFile$$1.call(this,fs4,path$$1,flag,stat,data)}if(PreloadFile$$1)MirrorFile2.__proto__=PreloadFile$$1;MirrorFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);MirrorFile2.prototype.constructor=MirrorFile2;MirrorFile2.prototype.syncSync=function syncSync(){if(this.isDirty()){this._fs._syncSync(this);this.resetDirty()}};MirrorFile2.prototype.closeSync=function closeSync(){this.syncSync()};return MirrorFile2}(PreloadFile);var AsyncMirror=function(SynchronousFileSystem$$1){function AsyncMirror2(sync,async,deprecateMsg){if(deprecateMsg===void 0)deprecateMsg=true;SynchronousFileSystem$$1.call(this);this._queue=[];this._queueRunning=false;this._isInitialized=false;this._initializeCallbacks=[];this._sync=sync;this._async=async;if(!sync.supportsSynch()){throw new Error("The first argument to AsyncMirror needs to be a synchronous file system.")}deprecationMessage(deprecateMsg,AsyncMirror2.Name,{sync:"sync file system instance",async:"async file system instance"})}if(SynchronousFileSystem$$1)AsyncMirror2.__proto__=SynchronousFileSystem$$1;AsyncMirror2.prototype=Object.create(SynchronousFileSystem$$1&&SynchronousFileSystem$$1.prototype);AsyncMirror2.prototype.constructor=AsyncMirror2;AsyncMirror2.Create=function Create(opts,cb){try{var fs4=new AsyncMirror2(opts.sync,opts.async,false);fs4.initialize(function(e){if(e){cb(e)}else{cb(null,fs4)}},false)}catch(e){cb(e)}};AsyncMirror2.isAvailable=function isAvailable(){return true};AsyncMirror2.prototype.getName=function getName(){return AsyncMirror2.Name};AsyncMirror2.prototype._syncSync=function _syncSync(fd){this._sync.writeFileSync(fd.getPath(),fd.getBuffer(),null,FileFlag.getFileFlag("w"),fd.getStats().mode);this.enqueueOp({apiMethod:"writeFile",arguments:[fd.getPath(),fd.getBuffer(),null,fd.getFlag(),fd.getStats().mode]})};AsyncMirror2.prototype.initialize=function initialize3(userCb,deprecateMsg){var this$1=this;if(deprecateMsg===void 0)deprecateMsg=true;if(deprecateMsg){console.warn("[AsyncMirror] AsyncMirror.initialize() is deprecated and will be removed in the next major version. Please use \'AsyncMirror.Create({ sync: (sync file system instance), async: (async file system instance)}, cb)\' to create and initialize AsyncMirror instances.")}var callbacks=this._initializeCallbacks;var end=function(e){this$1._isInitialized=!e;this$1._initializeCallbacks=[];callbacks.forEach(function(cb){return cb(e)})};if(!this._isInitialized){if(callbacks.push(userCb)===1){var copyDirectory=function(p2,mode,cb){if(p2!=="/"){this$1._sync.mkdirSync(p2,mode)}this$1._async.readdir(p2,function(err,files){var i22=0;function copyNextFile(err2){if(err2){cb(err2)}else if(i22<files.length){copyItem(path.join(p2,files[i22]),copyNextFile);i22++}else{cb()}}if(err){cb(err)}else{copyNextFile()}})},copyFile=function(p2,mode,cb){this$1._async.readFile(p2,null,FileFlag.getFileFlag("r"),function(err,data){if(err){cb(err)}else{try{this$1._sync.writeFileSync(p2,data,null,FileFlag.getFileFlag("w"),mode)}catch(e){err=e}finally{cb(err)}}})},copyItem=function(p2,cb){this$1._async.stat(p2,false,function(err,stats){if(err){cb(err)}else if(stats.isDirectory()){copyDirectory(p2,stats.mode,cb)}else{copyFile(p2,stats.mode,cb)}})};copyDirectory("/",0,end)}}else{userCb()}};AsyncMirror2.prototype.isReadOnly=function isReadOnly(){return false};AsyncMirror2.prototype.supportsSynch=function supportsSynch(){return true};AsyncMirror2.prototype.supportsLinks=function supportsLinks(){return false};AsyncMirror2.prototype.supportsProps=function supportsProps(){return this._sync.supportsProps()&&this._async.supportsProps()};AsyncMirror2.prototype.renameSync=function renameSync(oldPath,newPath){this.checkInitialized();this._sync.renameSync(oldPath,newPath);this.enqueueOp({apiMethod:"rename",arguments:[oldPath,newPath]})};AsyncMirror2.prototype.statSync=function statSync(p2,isLstat){this.checkInitialized();return this._sync.statSync(p2,isLstat)};AsyncMirror2.prototype.openSync=function openSync(p2,flag,mode){this.checkInitialized();var fd=this._sync.openSync(p2,flag,mode);fd.closeSync();return new MirrorFile(this,p2,flag,this._sync.statSync(p2,false),this._sync.readFileSync(p2,null,FileFlag.getFileFlag("r")))};AsyncMirror2.prototype.unlinkSync=function unlinkSync(p2){this.checkInitialized();this._sync.unlinkSync(p2);this.enqueueOp({apiMethod:"unlink",arguments:[p2]})};AsyncMirror2.prototype.rmdirSync=function rmdirSync(p2){this.checkInitialized();this._sync.rmdirSync(p2);this.enqueueOp({apiMethod:"rmdir",arguments:[p2]})};AsyncMirror2.prototype.mkdirSync=function mkdirSync(p2,mode){this.checkInitialized();this._sync.mkdirSync(p2,mode);this.enqueueOp({apiMethod:"mkdir",arguments:[p2,mode]})};AsyncMirror2.prototype.readdirSync=function readdirSync(p2){this.checkInitialized();return this._sync.readdirSync(p2)};AsyncMirror2.prototype.existsSync=function existsSync(p2){this.checkInitialized();return this._sync.existsSync(p2)};AsyncMirror2.prototype.chmodSync=function chmodSync(p2,isLchmod,mode){this.checkInitialized();this._sync.chmodSync(p2,isLchmod,mode);this.enqueueOp({apiMethod:"chmod",arguments:[p2,isLchmod,mode]})};AsyncMirror2.prototype.chownSync=function chownSync(p2,isLchown,uid,gid){this.checkInitialized();this._sync.chownSync(p2,isLchown,uid,gid);this.enqueueOp({apiMethod:"chown",arguments:[p2,isLchown,uid,gid]})};AsyncMirror2.prototype.utimesSync=function utimesSync(p2,atime,mtime){this.checkInitialized();this._sync.utimesSync(p2,atime,mtime);this.enqueueOp({apiMethod:"utimes",arguments:[p2,atime,mtime]})};AsyncMirror2.prototype.checkInitialized=function checkInitialized(){if(!this._isInitialized){throw new ApiError(ErrorCode.EPERM,"AsyncMirrorFS is not initialized. Please initialize AsyncMirrorFS using its initialize() method before using it.")}};AsyncMirror2.prototype.enqueueOp=function enqueueOp(op){var this$1=this;this._queue.push(op);if(!this._queueRunning){this._queueRunning=true;var doNextOp=function(err){if(err){console.error("WARNING: File system has desynchronized. Received following error: "+err+"\\n$")}if(this$1._queue.length>0){var op2=this$1._queue.shift(),args=op2.arguments;args.push(doNextOp);this$1._async[op2.apiMethod].apply(this$1._async,args)}else{this$1._queueRunning=false}};doNextOp()}};return AsyncMirror2}(SynchronousFileSystem);AsyncMirror.Name="AsyncMirror";AsyncMirror.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to."},async:{type:"object",description:"The asynchronous file system to mirror."}};function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}var nativeMax=Math.max;function overRest$1(func,start,transform){start=nativeMax(start===void 0?func.length-1:start,0);return function(){var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);while(++index<length){array[index]=args[start+index]}index=-1;var otherArgs=Array(start+1);while(++index<start){otherArgs[index]=args[index]}otherArgs[start]=transform(array);return apply(func,this,otherArgs)}}function identity(value){return value}function rest(func,start){return overRest$1(func,start,identity)}var initialParams=function(fn){return rest(function(args){var callback=args.pop();fn.call(this,args,callback)})};function applyEach$1(eachfn){return rest(function(fns,args){var go=initialParams(function(args2,callback){var that=this;return eachfn(fns,function(fn,cb){fn.apply(that,args2.concat(cb))},callback)});if(args.length){return go.apply(this,args)}else{return go}})}var freeGlobal=typeof global2=="object"&&global2&&global2.Object===Object&&global2;var freeSelf=typeof self=="object"&&self&&self.Object===Object&&self;var root=freeGlobal||freeSelf||Function("return this")();var Symbol$1=root.Symbol;var objectProto=Object.prototype;var hasOwnProperty=objectProto.hasOwnProperty;var nativeObjectToString=objectProto.toString;var symToStringTag$1=Symbol$1?Symbol$1.toStringTag:void 0;function getRawTag(value){var isOwn=hasOwnProperty.call(value,symToStringTag$1),tag=value[symToStringTag$1];try{value[symToStringTag$1]=void 0;var unmasked=true}catch(e){}var result=nativeObjectToString.call(value);if(unmasked){if(isOwn){value[symToStringTag$1]=tag}else{delete value[symToStringTag$1]}}return result}var objectProto$1=Object.prototype;var nativeObjectToString$1=objectProto$1.toString;function objectToString(value){return nativeObjectToString$1.call(value)}var nullTag="[object Null]";var undefinedTag="[object Undefined]";var symToStringTag=Symbol$1?Symbol$1.toStringTag:void 0;function baseGetTag(value){if(value==null){return value===void 0?undefinedTag:nullTag}return symToStringTag&&symToStringTag in Object(value)?getRawTag(value):objectToString(value)}function isObject(value){var type=typeof value;return value!=null&&(type=="object"||type=="function")}var asyncTag="[object AsyncFunction]";var funcTag="[object Function]";var genTag="[object GeneratorFunction]";var proxyTag="[object Proxy]";function isFunction3(value){if(!isObject(value)){return false}var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}var MAX_SAFE_INTEGER=9007199254740991;function isLength(value){return typeof value=="number"&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}function isArrayLike(value){return value!=null&&isLength(value.length)&&!isFunction3(value)}var breakLoop={};function noop3(){}function once(fn){return function(){if(fn===null){return}var callFn=fn;fn=null;callFn.apply(this,arguments)}}var iteratorSymbol=typeof Symbol==="function"&&Symbol.iterator;var getIterator=function(coll){return iteratorSymbol&&coll[iteratorSymbol]&&coll[iteratorSymbol]()};function baseTimes(n,iteratee){var index=-1,result=Array(n);while(++index<n){result[index]=iteratee(index)}return result}function isObjectLike(value){return value!=null&&typeof value=="object"}var argsTag="[object Arguments]";function baseIsArguments(value){return isObjectLike(value)&&baseGetTag(value)==argsTag}var objectProto$3=Object.prototype;var hasOwnProperty$2=objectProto$3.hasOwnProperty;var propertyIsEnumerable=objectProto$3.propertyIsEnumerable;var isArguments=baseIsArguments(function(){return arguments}())?baseIsArguments:function(value){return isObjectLike(value)&&hasOwnProperty$2.call(value,"callee")&&!propertyIsEnumerable.call(value,"callee")};var isArray=Array.isArray;function stubFalse(){return false}var freeExports=typeof exports2=="object"&&exports2&&!exports2.nodeType&&exports2;var freeModule=freeExports&&typeof module3=="object"&&module3&&!module3.nodeType&&module3;var moduleExports=freeModule&&freeModule.exports===freeExports;var Buffer$1=moduleExports?root.Buffer:void 0;var nativeIsBuffer=Buffer$1?Buffer$1.isBuffer:void 0;var isBuffer=nativeIsBuffer||stubFalse;var MAX_SAFE_INTEGER$1=9007199254740991;var reIsUint=/^(?:0|[1-9]\\d*)$/;function isIndex(value,length){length=length==null?MAX_SAFE_INTEGER$1:length;return!!length&&(typeof value=="number"||reIsUint.test(value))&&(value>-1&&value%1==0&&value<length)}var argsTag$1="[object Arguments]";var arrayTag="[object Array]";var boolTag="[object Boolean]";var dateTag="[object Date]";var errorTag="[object Error]";var funcTag$1="[object Function]";var mapTag="[object Map]";var numberTag="[object Number]";var objectTag="[object Object]";var regexpTag="[object RegExp]";var setTag="[object Set]";var stringTag="[object String]";var weakMapTag="[object WeakMap]";var arrayBufferTag="[object ArrayBuffer]";var dataViewTag="[object DataView]";var float32Tag="[object Float32Array]";var float64Tag="[object Float64Array]";var int8Tag="[object Int8Array]";var int16Tag="[object Int16Array]";var int32Tag="[object Int32Array]";var uint8Tag="[object Uint8Array]";var uint8ClampedTag="[object Uint8ClampedArray]";var uint16Tag="[object Uint16Array]";var uint32Tag="[object Uint32Array]";var typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=true;typedArrayTags[argsTag$1]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dataViewTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag$1]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=false;function baseIsTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[baseGetTag(value)]}function baseUnary(func){return function(value){return func(value)}}var freeExports$1=typeof exports2=="object"&&exports2&&!exports2.nodeType&&exports2;var freeModule$1=freeExports$1&&typeof module3=="object"&&module3&&!module3.nodeType&&module3;var moduleExports$1=freeModule$1&&freeModule$1.exports===freeExports$1;var freeProcess=moduleExports$1&&freeGlobal.process;var nodeUtil=function(){try{return freeProcess&&freeProcess.binding&&freeProcess.binding("util")}catch(e){}}();var nodeIsTypedArray=nodeUtil&&nodeUtil.isTypedArray;var isTypedArray3=nodeIsTypedArray?baseUnary(nodeIsTypedArray):baseIsTypedArray;var objectProto$2=Object.prototype;var hasOwnProperty$1=objectProto$2.hasOwnProperty;function arrayLikeKeys(value,inherited){var isArr=isArray(value),isArg=!isArr&&isArguments(value),isBuff=!isArr&&!isArg&&isBuffer(value),isType=!isArr&&!isArg&&!isBuff&&isTypedArray3(value),skipIndexes=isArr||isArg||isBuff||isType,result=skipIndexes?baseTimes(value.length,String):[],length=result.length;for(var key in value){if((inherited||hasOwnProperty$1.call(value,key))&&!(skipIndexes&&(key=="length"||isBuff&&(key=="offset"||key=="parent")||isType&&(key=="buffer"||key=="byteLength"||key=="byteOffset")||isIndex(key,length)))){result.push(key)}}return result}var objectProto$5=Object.prototype;function isPrototype(value){var Ctor=value&&value.constructor,proto=typeof Ctor=="function"&&Ctor.prototype||objectProto$5;return value===proto}function overArg(func,transform){return function(arg){return func(transform(arg))}}var nativeKeys=overArg(Object.keys,Object);var objectProto$4=Object.prototype;var hasOwnProperty$3=objectProto$4.hasOwnProperty;function baseKeys(object){if(!isPrototype(object)){return nativeKeys(object)}var result=[];for(var key in Object(object)){if(hasOwnProperty$3.call(object,key)&&key!="constructor"){result.push(key)}}return result}function keys3(object){return isArrayLike(object)?arrayLikeKeys(object):baseKeys(object)}function createArrayIterator(coll){var i22=-1;var len=coll.length;return function next(){return++i22<len?{value:coll[i22],key:i22}:null}}function createES2015Iterator(iterator2){var i22=-1;return function next(){var item=iterator2.next();if(item.done){return null}i22++;return{value:item.value,key:i22}}}function createObjectIterator(obj){var okeys=keys3(obj);var i22=-1;var len=okeys.length;return function next(){var key=okeys[++i22];return i22<len?{value:obj[key],key}:null}}function iterator(coll){if(isArrayLike(coll)){return createArrayIterator(coll)}var iterator2=getIterator(coll);return iterator2?createES2015Iterator(iterator2):createObjectIterator(coll)}function onlyOnce(fn){return function(){if(fn===null){throw new Error("Callback was already called.")}var callFn=fn;fn=null;callFn.apply(this,arguments)}}function _eachOfLimit(limit){return function(obj,iteratee,callback){callback=once(callback||noop3);if(limit<=0||!obj){return callback(null)}var nextElem=iterator(obj);var done=false;var running=0;function iterateeCallback(err,value){running-=1;if(err){done=true;callback(err)}else if(value===breakLoop||done&&running<=0){done=true;return callback(null)}else{replenish()}}function replenish(){while(running<limit&&!done){var elem=nextElem();if(elem===null){done=true;if(running<=0){callback(null)}return}running+=1;iteratee(elem.value,elem.key,onlyOnce(iterateeCallback))}}replenish()}}function eachOfLimit(coll,limit,iteratee,callback){_eachOfLimit(limit)(coll,iteratee,callback)}function doLimit(fn,limit){return function(iterable,iteratee,callback){return fn(iterable,limit,iteratee,callback)}}function eachOfArrayLike(coll,iteratee,callback){callback=once(callback||noop3);var index=0,completed=0,length=coll.length;if(length===0){callback(null)}function iteratorCallback(err,value){if(err){callback(err)}else if(++completed===length||value===breakLoop){callback(null)}}for(;index<length;index++){iteratee(coll[index],index,onlyOnce(iteratorCallback))}}var eachOfGeneric=doLimit(eachOfLimit,Infinity);var eachOf=function(coll,iteratee,callback){var eachOfImplementation=isArrayLike(coll)?eachOfArrayLike:eachOfGeneric;eachOfImplementation(coll,iteratee,callback)};function doParallel(fn){return function(obj,iteratee,callback){return fn(eachOf,obj,iteratee,callback)}}function _asyncMap(eachfn,arr,iteratee,callback){callback=callback||noop3;arr=arr||[];var results=[];var counter=0;eachfn(arr,function(value,_,callback2){var index=counter++;iteratee(value,function(err,v2){results[index]=v2;callback2(err)})},function(err){callback(err,results)})}var map=doParallel(_asyncMap);applyEach$1(map);function doParallelLimit(fn){return function(obj,limit,iteratee,callback){return fn(_eachOfLimit(limit),obj,iteratee,callback)}}var mapLimit=doParallelLimit(_asyncMap);var mapSeries=doLimit(mapLimit,1);applyEach$1(mapSeries);rest(function(fn,args){return rest(function(callArgs){return fn.apply(null,args.concat(callArgs))})});function arrayEach(array,iteratee){var index=-1,length=array==null?0:array.length;while(++index<length){if(iteratee(array[index],index,array)===false){break}}return array}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){var index=-1,iterable=Object(object),props=keysFunc(object),length=props.length;while(length--){var key=props[fromRight?length:++index];if(iteratee(iterable[key],key,iterable)===false){break}}return object}}var baseFor=createBaseFor();function baseForOwn(object,iteratee){return object&&baseFor(object,iteratee,keys3)}function baseFindIndex(array,predicate,fromIndex,fromRight){var length=array.length,index=fromIndex+(fromRight?1:-1);while(fromRight?index--:++index<length){if(predicate(array[index],index,array)){return index}}return-1}function baseIsNaN(value){return value!==value}function strictIndexOf(array,value,fromIndex){var index=fromIndex-1,length=array.length;while(++index<length){if(array[index]===value){return index}}return-1}function baseIndexOf(array,value,fromIndex){return value===value?strictIndexOf(array,value,fromIndex):baseFindIndex(array,baseIsNaN,fromIndex)}var rsAstralRange$1="\\\\ud800-\\\\udfff";var rsComboMarksRange$1="\\\\u0300-\\\\u036f";var reComboHalfMarksRange$1="\\\\ufe20-\\\\ufe2f";var rsComboSymbolsRange$1="\\\\u20d0-\\\\u20ff";var rsComboRange$1=rsComboMarksRange$1+reComboHalfMarksRange$1+rsComboSymbolsRange$1;var rsVarRange$1="\\\\ufe0e\\\\ufe0f";var rsAstral="["+rsAstralRange$1+"]";var rsCombo="["+rsComboRange$1+"]";var rsFitz="\\\\ud83c[\\\\udffb-\\\\udfff]";var rsModifier="(?:"+rsCombo+"|"+rsFitz+")";var rsNonAstral="[^"+rsAstralRange$1+"]";var rsRegional="(?:\\\\ud83c[\\\\udde6-\\\\uddff]){2}";var rsSurrPair="[\\\\ud800-\\\\udbff][\\\\udc00-\\\\udfff]";var rsZWJ$1="\\\\u200d";var reOptMod=rsModifier+"?";var rsOptVar="["+rsVarRange$1+"]?";var rsOptJoin="(?:"+rsZWJ$1+"(?:"+[rsNonAstral,rsRegional,rsSurrPair].join("|")+")"+rsOptVar+reOptMod+")*";var rsSeq=rsOptVar+reOptMod+rsOptJoin;var rsSymbol="(?:"+[rsNonAstral+rsCombo+"?",rsCombo,rsRegional,rsSurrPair,rsAstral].join("|")+")";var hasSetImmediate=typeof setImmediate==="function"&&setImmediate;var hasNextTick=typeof process==="object"&&typeof process.nextTick==="function";function fallback(fn){setTimeout(fn,0)}function wrap(defer){return rest(function(fn,args){defer(function(){fn.apply(null,args)})})}var _defer;if(hasSetImmediate){_defer=setImmediate}else if(hasNextTick){_defer=process.nextTick}else{_defer=fallback}wrap(_defer);var eachOfSeries=doLimit(eachOfLimit,1);function reduce(coll,memo,iteratee,callback){callback=once(callback||noop3);eachOfSeries(coll,function(x3,i22,callback2){iteratee(memo,x3,function(err,v2){memo=v2;callback2(err)})},function(err){callback(err,memo)})}var seq=rest(function seq2(functions){return rest(function(args){var that=this;var cb=args[args.length-1];if(typeof cb=="function"){args.pop()}else{cb=noop3}reduce(functions,args,function(newargs,fn,cb2){fn.apply(that,newargs.concat(rest(function(err,nextargs){cb2(err,nextargs)})))},function(err,results){cb.apply(that,[err].concat(results))})})});rest(function(args){return seq.apply(null,args.reverse())});rest(function(values){var args=[null].concat(values);return initialParams(function(ignoredArgs,callback){return callback.apply(this,args)})});function consoleFunc(name2){return rest(function(fn,args){fn.apply(null,args.concat(rest(function(err,args2){if(typeof console==="object"){if(err){if(console.error){console.error(err)}}else if(console[name2]){arrayEach(args2,function(x3){console[name2](x3)})}}})))})}consoleFunc("dir");function _withoutIndex(iteratee){return function(value,index,callback){return iteratee(value,callback)}}function eachLimit(coll,iteratee,callback){eachOf(coll,_withoutIndex(iteratee),callback)}consoleFunc("log");var _defer$1;if(hasNextTick){_defer$1=process.nextTick}else if(hasSetImmediate){_defer$1=setImmediate}else{_defer$1=fallback}wrap(_defer$1);var nativeCeil=Math.ceil;var nativeMax$1=Math.max;var errorCodeLookup;function constructErrorCodeLookup(){if(errorCodeLookup){return}errorCodeLookup={};errorCodeLookup[Dropbox.ApiError.NETWORK_ERROR]=ErrorCode.EIO;errorCodeLookup[Dropbox.ApiError.INVALID_PARAM]=ErrorCode.EINVAL;errorCodeLookup[Dropbox.ApiError.INVALID_TOKEN]=ErrorCode.EPERM;errorCodeLookup[Dropbox.ApiError.OAUTH_ERROR]=ErrorCode.EPERM;errorCodeLookup[Dropbox.ApiError.NOT_FOUND]=ErrorCode.ENOENT;errorCodeLookup[Dropbox.ApiError.INVALID_METHOD]=ErrorCode.EINVAL;errorCodeLookup[Dropbox.ApiError.NOT_ACCEPTABLE]=ErrorCode.EINVAL;errorCodeLookup[Dropbox.ApiError.CONFLICT]=ErrorCode.EINVAL;errorCodeLookup[Dropbox.ApiError.RATE_LIMITED]=ErrorCode.EBUSY;errorCodeLookup[Dropbox.ApiError.SERVER_ERROR]=ErrorCode.EBUSY;errorCodeLookup[Dropbox.ApiError.OVER_QUOTA]=ErrorCode.ENOSPC}function isFileInfo(cache){return cache&&cache.stat.isFile}function isDirInfo(cache){return cache&&cache.stat.isFolder}function isArrayBuffer(ab){return ab===null||ab===void 0||typeof ab==="object"&&typeof ab["byteLength"]==="number"}var CachedDropboxClient=function CachedDropboxClient2(client){this._cache={};this._client=client};CachedDropboxClient.prototype.readdir=function readdir(p2,cb){var this$1=this;var cacheInfo=this.getCachedDirInfo(p2);this._wrap(function(interceptCb){if(cacheInfo!==null&&cacheInfo.contents){this$1._client.readdir(p2,{contentHash:cacheInfo.stat.contentHash},interceptCb)}else{this$1._client.readdir(p2,interceptCb)}},function(err,filenames,stat,folderEntries){if(err){if(err.status===Dropbox.ApiError.NO_CONTENT&&cacheInfo!==null){cb(null,cacheInfo.contents.slice(0))}else{cb(err)}}else{this$1.updateCachedDirInfo(p2,stat,filenames.slice(0));folderEntries.forEach(function(entry){this$1.updateCachedInfo(path.join(p2,entry.name),entry)});cb(null,filenames)}})};CachedDropboxClient.prototype.remove=function remove(p2,cb){var this$1=this;this._wrap(function(interceptCb){this$1._client.remove(p2,interceptCb)},function(err,stat){if(!err){this$1.updateCachedInfo(p2,stat)}cb(err)})};CachedDropboxClient.prototype.move=function move(src,dest,cb){var this$1=this;this._wrap(function(interceptCb){this$1._client.move(src,dest,interceptCb)},function(err,stat){if(!err){this$1.deleteCachedInfo(src);this$1.updateCachedInfo(dest,stat)}cb(err)})};CachedDropboxClient.prototype.stat=function stat(p2,cb){var this$1=this;this._wrap(function(interceptCb){this$1._client.stat(p2,interceptCb)},function(err,stat2){if(!err){this$1.updateCachedInfo(p2,stat2)}cb(err,stat2)})};CachedDropboxClient.prototype.readFile=function readFile2(p2,cb){var this$1=this;var cacheInfo=this.getCachedFileInfo(p2);if(cacheInfo!==null&&cacheInfo.contents!==null){this.stat(p2,function(error,stat){if(error){cb(error)}else if(stat.contentHash===cacheInfo.stat.contentHash){cb(error,cacheInfo.contents.slice(0),cacheInfo.stat)}else{this$1.readFile(p2,cb)}})}else{this._wrap(function(interceptCb){this$1._client.readFile(p2,{arrayBuffer:true},interceptCb)},function(err,contents,stat){if(!err){this$1.updateCachedInfo(p2,stat,contents.slice(0))}cb(err,contents,stat)})}};CachedDropboxClient.prototype.writeFile=function writeFile2(p2,contents,cb){var this$1=this;this._wrap(function(interceptCb){this$1._client.writeFile(p2,contents,interceptCb)},function(err,stat){if(!err){this$1.updateCachedInfo(p2,stat,contents.slice(0))}cb(err,stat)})};CachedDropboxClient.prototype.mkdir=function mkdir(p2,cb){var this$1=this;this._wrap(function(interceptCb){this$1._client.mkdir(p2,interceptCb)},function(err,stat){if(!err){this$1.updateCachedInfo(p2,stat,[])}cb(err)})};CachedDropboxClient.prototype._wrap=function _wrap(performOp,cb){var numRun=0;var interceptCb=function(error){var timeoutDuration=2;if(error&&3>++numRun){switch(error.status){case Dropbox.ApiError.SERVER_ERROR:case Dropbox.ApiError.NETWORK_ERROR:case Dropbox.ApiError.RATE_LIMITED:setTimeout(function(){performOp(interceptCb)},timeoutDuration*1e3);break;default:cb.apply(null,arguments);break}}else{cb.apply(null,arguments)}};performOp(interceptCb)};CachedDropboxClient.prototype.getCachedInfo=function getCachedInfo(p2){return this._cache[p2.toLowerCase()]};CachedDropboxClient.prototype.putCachedInfo=function putCachedInfo(p2,cache){this._cache[p2.toLowerCase()]=cache};CachedDropboxClient.prototype.deleteCachedInfo=function deleteCachedInfo(p2){delete this._cache[p2.toLowerCase()]};CachedDropboxClient.prototype.getCachedDirInfo=function getCachedDirInfo(p2){var info=this.getCachedInfo(p2);if(isDirInfo(info)){return info}else{return null}};CachedDropboxClient.prototype.getCachedFileInfo=function getCachedFileInfo(p2){var info=this.getCachedInfo(p2);if(isFileInfo(info)){return info}else{return null}};CachedDropboxClient.prototype.updateCachedDirInfo=function updateCachedDirInfo(p2,stat,contents){if(contents===void 0)contents=null;var cachedInfo=this.getCachedInfo(p2);if(stat.contentHash!==null&&(cachedInfo===void 0||cachedInfo.stat.contentHash!==stat.contentHash)){this.putCachedInfo(p2,{stat,contents})}};CachedDropboxClient.prototype.updateCachedFileInfo=function updateCachedFileInfo(p2,stat,contents){if(contents===void 0)contents=null;var cachedInfo=this.getCachedInfo(p2);if(stat.versionTag!==null&&(cachedInfo===void 0||cachedInfo.stat.versionTag!==stat.versionTag)){this.putCachedInfo(p2,{stat,contents})}};CachedDropboxClient.prototype.updateCachedInfo=function updateCachedInfo(p2,stat,contents){if(contents===void 0)contents=null;if(stat.isFile&&isArrayBuffer(contents)){this.updateCachedFileInfo(p2,stat,contents)}else if(stat.isFolder&&Array.isArray(contents)){this.updateCachedDirInfo(p2,stat,contents)}};var DropboxFile=function(PreloadFile$$1){function DropboxFile2(_fs,_path,_flag,_stat,contents){PreloadFile$$1.call(this,_fs,_path,_flag,_stat,contents)}if(PreloadFile$$1)DropboxFile2.__proto__=PreloadFile$$1;DropboxFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);DropboxFile2.prototype.constructor=DropboxFile2;DropboxFile2.prototype.sync=function sync(cb){var this$1=this;if(this.isDirty()){var buffer$$1=this.getBuffer(),arrayBuffer=buffer2ArrayBuffer(buffer$$1);this._fs._writeFileStrict(this.getPath(),arrayBuffer,function(e){if(!e){this$1.resetDirty()}cb(e)})}else{cb()}};DropboxFile2.prototype.close=function close(cb){this.sync(cb)};return DropboxFile2}(PreloadFile);var DropboxFileSystem=function(BaseFileSystem$$1){function DropboxFileSystem2(client,deprecateMsg){if(deprecateMsg===void 0)deprecateMsg=true;BaseFileSystem$$1.call(this);this._client=new CachedDropboxClient(client);deprecationMessage(deprecateMsg,DropboxFileSystem2.Name,{client:"authenticated dropbox client instance"});constructErrorCodeLookup()}if(BaseFileSystem$$1)DropboxFileSystem2.__proto__=BaseFileSystem$$1;DropboxFileSystem2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);DropboxFileSystem2.prototype.constructor=DropboxFileSystem2;DropboxFileSystem2.Create=function Create(opts,cb){cb(null,new DropboxFileSystem2(opts.client,false))};DropboxFileSystem2.isAvailable=function isAvailable(){return typeof Dropbox!=="undefined"};DropboxFileSystem2.prototype.getName=function getName(){return DropboxFileSystem2.Name};DropboxFileSystem2.prototype.isReadOnly=function isReadOnly(){return false};DropboxFileSystem2.prototype.supportsSymlinks=function supportsSymlinks(){return false};DropboxFileSystem2.prototype.supportsProps=function supportsProps(){return false};DropboxFileSystem2.prototype.supportsSynch=function supportsSynch(){return false};DropboxFileSystem2.prototype.empty=function empty(mainCb){var this$1=this;this._client.readdir("/",function(error,files){if(error){mainCb(this$1.convert(error,"/"))}else{var deleteFile2=function(file,cb){var p2=path.join("/",file);this$1._client.remove(p2,function(err){cb(err?this$1.convert(err,p2):null)})};var finished=function(err){if(err){mainCb(err)}else{mainCb()}};eachLimit(files,deleteFile2,finished)}})};DropboxFileSystem2.prototype.rename=function rename(oldPath,newPath,cb){var this$1=this;this._client.move(oldPath,newPath,function(error){if(error){this$1._client.stat(newPath,function(error2,stat){if(error2||stat.isFolder){var missingPath=error.response.error.indexOf(oldPath)>-1?oldPath:newPath;cb(this$1.convert(error,missingPath))}else{this$1._client.remove(newPath,function(error22){if(error22){cb(this$1.convert(error22,newPath))}else{this$1.rename(oldPath,newPath,cb)}})}})}else{cb()}})};DropboxFileSystem2.prototype.stat=function stat(path$$1,isLstat,cb){var this$1=this;this._client.stat(path$$1,function(error,stat2){if(error){cb(this$1.convert(error,path$$1))}else if(stat2&&stat2.isRemoved){cb(ApiError.FileError(ErrorCode.ENOENT,path$$1))}else{var stats=new Stats(this$1._statType(stat2),stat2.size);return cb(null,stats)}})};DropboxFileSystem2.prototype.open=function open(path$$1,flags,mode,cb){var this$1=this;this._client.readFile(path$$1,function(error,content,dbStat){if(error){if(flags.isReadable()){cb(this$1.convert(error,path$$1))}else{switch(error.status){case Dropbox.ApiError.NOT_FOUND:var ab=new ArrayBuffer(0);return this$1._writeFileStrict(path$$1,ab,function(error2,stat){if(error2){cb(error2)}else{var file2=this$1._makeFile(path$$1,flags,stat,arrayBuffer2Buffer(ab));cb(null,file2)}});default:return cb(this$1.convert(error,path$$1))}}}else{var buffer$$1;if(content===null){buffer$$1=emptyBuffer()}else{buffer$$1=arrayBuffer2Buffer(content)}var file=this$1._makeFile(path$$1,flags,dbStat,buffer$$1);return cb(null,file)}})};DropboxFileSystem2.prototype._writeFileStrict=function _writeFileStrict(p2,data,cb){var this$1=this;var parent=path.dirname(p2);this.stat(parent,false,function(error,stat){if(error){cb(ApiError.FileError(ErrorCode.ENOENT,parent))}else{this$1._client.writeFile(p2,data,function(error2,stat2){if(error2){cb(this$1.convert(error2,p2))}else{cb(null,stat2)}})}})};DropboxFileSystem2.prototype._statType=function _statType(stat){return stat.isFile?FileType.FILE:FileType.DIRECTORY};DropboxFileSystem2.prototype._makeFile=function _makeFile(path$$1,flag,stat,buffer$$1){var type=this._statType(stat);var stats=new Stats(type,stat.size);return new DropboxFile(this,path$$1,flag,stats,buffer$$1)};DropboxFileSystem2.prototype._remove=function _remove(path$$1,cb,isFile){var this$1=this;this._client.stat(path$$1,function(error,stat){if(error){cb(this$1.convert(error,path$$1))}else{if(stat.isFile&&!isFile){cb(ApiError.FileError(ErrorCode.ENOTDIR,path$$1))}else if(!stat.isFile&&isFile){cb(ApiError.FileError(ErrorCode.EISDIR,path$$1))}else{this$1._client.remove(path$$1,function(error2){if(error2){cb(this$1.convert(error2,path$$1))}else{cb(null)}})}}})};DropboxFileSystem2.prototype.unlink=function unlink(path$$1,cb){this._remove(path$$1,cb,true)};DropboxFileSystem2.prototype.rmdir=function rmdir(path$$1,cb){this._remove(path$$1,cb,false)};DropboxFileSystem2.prototype.mkdir=function mkdir(p2,mode,cb){var this$1=this;var parent=path.dirname(p2);this._client.stat(parent,function(error,stat){if(error){cb(this$1.convert(error,parent))}else{this$1._client.mkdir(p2,function(error2){if(error2){cb(ApiError.FileError(ErrorCode.EEXIST,p2))}else{cb(null)}})}})};DropboxFileSystem2.prototype.readdir=function readdir(path$$1,cb){var this$1=this;this._client.readdir(path$$1,function(error,files){if(error){return cb(this$1.convert(error))}else{return cb(null,files)}})};DropboxFileSystem2.prototype.convert=function convert(err,path$$1){if(path$$1===void 0)path$$1=null;var errorCode=errorCodeLookup[err.status];if(errorCode===void 0){errorCode=ErrorCode.EIO}if(!path$$1){return new ApiError(errorCode)}else{return ApiError.FileError(errorCode,path$$1)}};return DropboxFileSystem2}(BaseFileSystem);DropboxFileSystem.Name="Dropbox";DropboxFileSystem.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 0.10 JS SDK.",validator:function(opt,cb){if(opt.isAuthenticated&&opt.isAuthenticated()){cb()}else{cb(new ApiError(ErrorCode.EINVAL,"\'client\' option must be an authenticated Dropbox client from the v0.10 JS SDK."))}}}};function convertError(e,path$$1){if(path$$1===void 0)path$$1="";var errno=e.errno;var parent=e.node;var paths=[];while(parent){paths.unshift(parent.name);if(parent===parent.parent){break}parent=parent.parent}return new ApiError(errno,ErrorStrings[errno],paths.length>0?"/"+paths.join("/"):path$$1)}var EmscriptenFile=function(BaseFile$$1){function EmscriptenFile2(_fs,_FS,_path,_stream){BaseFile$$1.call(this);this._fs=_fs;this._FS=_FS;this._path=_path;this._stream=_stream}if(BaseFile$$1)EmscriptenFile2.__proto__=BaseFile$$1;EmscriptenFile2.prototype=Object.create(BaseFile$$1&&BaseFile$$1.prototype);EmscriptenFile2.prototype.constructor=EmscriptenFile2;EmscriptenFile2.prototype.getPos=function getPos(){return void 0};EmscriptenFile2.prototype.close=function close(cb){var err=null;try{this.closeSync()}catch(e){err=e}finally{cb(err)}};EmscriptenFile2.prototype.closeSync=function closeSync(){try{this._FS.close(this._stream)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.stat=function stat(cb){try{cb(null,this.statSync())}catch(e){cb(e)}};EmscriptenFile2.prototype.statSync=function statSync(){try{return this._fs.statSync(this._path,false)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.truncate=function truncate(len,cb){var err=null;try{this.truncateSync(len)}catch(e){err=e}finally{cb(err)}};EmscriptenFile2.prototype.truncateSync=function truncateSync(len){try{this._FS.ftruncate(this._stream.fd,len)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.write=function write(buffer$$1,offset,length,position,cb){try{cb(null,this.writeSync(buffer$$1,offset,length,position),buffer$$1)}catch(e){cb(e)}};EmscriptenFile2.prototype.writeSync=function writeSync(buffer$$1,offset,length,position){try{var u8=buffer2Uint8array(buffer$$1);var emPosition=position===null?void 0:position;return this._FS.write(this._stream,u8,offset,length,emPosition)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.read=function read(buffer$$1,offset,length,position,cb){try{cb(null,this.readSync(buffer$$1,offset,length,position),buffer$$1)}catch(e){cb(e)}};EmscriptenFile2.prototype.readSync=function readSync(buffer$$1,offset,length,position){try{var u8=buffer2Uint8array(buffer$$1);var emPosition=position===null?void 0:position;return this._FS.read(this._stream,u8,offset,length,emPosition)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.sync=function sync(cb){cb()};EmscriptenFile2.prototype.syncSync=function syncSync(){};EmscriptenFile2.prototype.chown=function chown(uid,gid,cb){var err=null;try{this.chownSync(uid,gid)}catch(e){err=e}finally{cb(err)}};EmscriptenFile2.prototype.chownSync=function chownSync(uid,gid){try{this._FS.fchown(this._stream.fd,uid,gid)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.chmod=function chmod(mode,cb){var err=null;try{this.chmodSync(mode)}catch(e){err=e}finally{cb(err)}};EmscriptenFile2.prototype.chmodSync=function chmodSync(mode){try{this._FS.fchmod(this._stream.fd,mode)}catch(e){throw convertError(e,this._path)}};EmscriptenFile2.prototype.utimes=function utimes(atime,mtime,cb){var err=null;try{this.utimesSync(atime,mtime)}catch(e){err=e}finally{cb(err)}};EmscriptenFile2.prototype.utimesSync=function utimesSync(atime,mtime){this._fs.utimesSync(this._path,atime,mtime)};return EmscriptenFile2}(BaseFile);var EmscriptenFileSystem=function(SynchronousFileSystem$$1){function EmscriptenFileSystem2(_FS){SynchronousFileSystem$$1.call(this);this._FS=_FS}if(SynchronousFileSystem$$1)EmscriptenFileSystem2.__proto__=SynchronousFileSystem$$1;EmscriptenFileSystem2.prototype=Object.create(SynchronousFileSystem$$1&&SynchronousFileSystem$$1.prototype);EmscriptenFileSystem2.prototype.constructor=EmscriptenFileSystem2;EmscriptenFileSystem2.Create=function Create(opts,cb){cb(null,new EmscriptenFileSystem2(opts.FS))};EmscriptenFileSystem2.isAvailable=function isAvailable(){return true};EmscriptenFileSystem2.prototype.getName=function getName(){return this._FS.DB_NAME()};EmscriptenFileSystem2.prototype.isReadOnly=function isReadOnly(){return false};EmscriptenFileSystem2.prototype.supportsLinks=function supportsLinks(){return true};EmscriptenFileSystem2.prototype.supportsProps=function supportsProps(){return true};EmscriptenFileSystem2.prototype.supportsSynch=function supportsSynch(){return true};EmscriptenFileSystem2.prototype.renameSync=function renameSync(oldPath,newPath){try{this._FS.rename(oldPath,newPath)}catch(e){if(e.errno===ErrorCode.ENOENT){throw convertError(e,this.existsSync(oldPath)?newPath:oldPath)}else{throw convertError(e)}}};EmscriptenFileSystem2.prototype.statSync=function statSync(p2,isLstat){try{var stats=isLstat?this._FS.lstat(p2):this._FS.stat(p2);var itemType=this.modeToFileType(stats.mode);return new Stats(itemType,stats.size,stats.mode,stats.atime,stats.mtime,stats.ctime)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.openSync=function openSync(p2,flag,mode){try{var stream=this._FS.open(p2,flag.getFlagString(),mode);if(this._FS.isDir(stream.node.mode)){this._FS.close(stream);throw ApiError.EISDIR(p2)}return new EmscriptenFile(this,this._FS,p2,stream)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.unlinkSync=function unlinkSync(p2){try{this._FS.unlink(p2)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.rmdirSync=function rmdirSync(p2){try{this._FS.rmdir(p2)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.mkdirSync=function mkdirSync(p2,mode){try{this._FS.mkdir(p2,mode)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.readdirSync=function readdirSync(p2){try{return this._FS.readdir(p2).filter(function(p22){return p22!=="."&&p22!==".."})}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.truncateSync=function truncateSync(p2,len){try{this._FS.truncate(p2,len)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.readFileSync=function readFileSync(p2,encoding,flag){try{var data=this._FS.readFile(p2,{flags:flag.getFlagString()});var buff=uint8Array2Buffer(data);if(encoding){return buff.toString(encoding)}else{return buff}}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.writeFileSync=function writeFileSync(p2,data,encoding,flag,mode){try{if(encoding){data=Buffer2.from(data,encoding)}var u8=buffer2Uint8array(data);this._FS.writeFile(p2,u8,{flags:flag.getFlagString(),encoding:"binary"});this._FS.chmod(p2,mode)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.chmodSync=function chmodSync(p2,isLchmod,mode){try{isLchmod?this._FS.lchmod(p2,mode):this._FS.chmod(p2,mode)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.chownSync=function chownSync(p2,isLchown,uid,gid){try{isLchown?this._FS.lchown(p2,uid,gid):this._FS.chown(p2,uid,gid)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.symlinkSync=function symlinkSync(srcpath,dstpath,type){try{this._FS.symlink(srcpath,dstpath)}catch(e){throw convertError(e)}};EmscriptenFileSystem2.prototype.readlinkSync=function readlinkSync(p2){try{return this._FS.readlink(p2)}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.utimesSync=function utimesSync(p2,atime,mtime){try{this._FS.utime(p2,atime.getTime(),mtime.getTime())}catch(e){throw convertError(e,p2)}};EmscriptenFileSystem2.prototype.modeToFileType=function modeToFileType(mode){if(this._FS.isDir(mode)){return FileType.DIRECTORY}else if(this._FS.isFile(mode)){return FileType.FILE}else if(this._FS.isLink(mode)){return FileType.SYMLINK}else{throw ApiError.EPERM("Invalid mode: "+mode)}};return EmscriptenFileSystem2}(SynchronousFileSystem);EmscriptenFileSystem.Name="EmscriptenFileSystem";EmscriptenFileSystem.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}};var FolderAdapter=function(BaseFileSystem$$1){function FolderAdapter2(folder,wrapped){BaseFileSystem$$1.call(this);this._folder=folder;this._wrapped=wrapped}if(BaseFileSystem$$1)FolderAdapter2.__proto__=BaseFileSystem$$1;FolderAdapter2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);FolderAdapter2.prototype.constructor=FolderAdapter2;FolderAdapter2.Create=function Create(opts,cb){cb(null,new FolderAdapter2(opts.folder,opts.wrapped))};FolderAdapter2.isAvailable=function isAvailable(){return true};FolderAdapter2.prototype.initialize=function initialize3(cb){var this$1=this;this._wrapped.exists(this._folder,function(exists2){if(exists2){cb()}else if(this$1._wrapped.isReadOnly()){cb(ApiError.ENOENT(this$1._folder))}else{this$1._wrapped.mkdir(this$1._folder,511,cb)}})};FolderAdapter2.prototype.getName=function getName(){return this._wrapped.getName()};FolderAdapter2.prototype.isReadOnly=function isReadOnly(){return this._wrapped.isReadOnly()};FolderAdapter2.prototype.supportsProps=function supportsProps(){return this._wrapped.supportsProps()};FolderAdapter2.prototype.supportsSynch=function supportsSynch(){return this._wrapped.supportsSynch()};FolderAdapter2.prototype.supportsLinks=function supportsLinks(){return false};return FolderAdapter2}(BaseFileSystem);FolderAdapter.Name="FolderAdapter";FolderAdapter.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}};function translateError(folder,e){if(e!==null&&typeof e==="object"){var err=e;var p2=err.path;if(p2){p2="/"+path.relative(folder,p2);err.message=err.message.replace(err.path,p2);err.path=p2}}return e}function wrapCallback(folder,cb){if(typeof cb==="function"){return function(err){if(arguments.length>0){arguments[0]=translateError(folder,err)}cb.apply(null,arguments)}}else{return cb}}function wrapFunction(name2,wrapFirst,wrapSecond){if(name2.slice(name2.length-4)!=="Sync"){return function(){if(arguments.length>0){if(wrapFirst){arguments[0]=path.join(this._folder,arguments[0])}if(wrapSecond){arguments[1]=path.join(this._folder,arguments[1])}arguments[arguments.length-1]=wrapCallback(this._folder,arguments[arguments.length-1])}return this._wrapped[name2].apply(this._wrapped,arguments)}}else{return function(){try{if(wrapFirst){arguments[0]=path.join(this._folder,arguments[0])}if(wrapSecond){arguments[1]=path.join(this._folder,arguments[1])}return this._wrapped[name2].apply(this._wrapped,arguments)}catch(e){throw translateError(this._folder,e)}}}}["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach(function(name2){FolderAdapter.prototype[name2]=wrapFunction(name2,true,false)});["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach(function(name2){FolderAdapter.prototype[name2]=wrapFunction(name2,true,true)});var toExport;if(typeof window!=="undefined"){toExport=window}else if(typeof self!=="undefined"){toExport=self}else{toExport=global2}var global$1=toExport;function isDirectoryEntry(entry){return entry.isDirectory}var _getFS=global$1.webkitRequestFileSystem||global$1.requestFileSystem||null;function _requestQuota(type,size,success,errorCallback){if(typeof navigator["webkitPersistentStorage"]!=="undefined"){switch(type){case global$1.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(size,success,errorCallback);break;case global$1.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(size,success,errorCallback);break;default:errorCallback(new TypeError("Invalid storage type: "+type));break}}else{global$1.webkitStorageInfo.requestQuota(type,size,success,errorCallback)}}function _toArray(list2){return Array.prototype.slice.call(list2||[],0)}function convertError$1(err,p2,expectedDir){switch(err.name){case"PathExistsError":return ApiError.EEXIST(p2);case"QuotaExceededError":return ApiError.FileError(ErrorCode.ENOSPC,p2);case"NotFoundError":return ApiError.ENOENT(p2);case"SecurityError":return ApiError.FileError(ErrorCode.EACCES,p2);case"InvalidModificationError":return ApiError.FileError(ErrorCode.EPERM,p2);case"TypeMismatchError":return ApiError.FileError(expectedDir?ErrorCode.ENOTDIR:ErrorCode.EISDIR,p2);case"EncodingError":case"InvalidStateError":case"NoModificationAllowedError":default:return ApiError.FileError(ErrorCode.EINVAL,p2)}}var HTML5FSFile=function(PreloadFile$$1){function HTML5FSFile2(fs4,entry,path$$1,flag,stat,contents){PreloadFile$$1.call(this,fs4,path$$1,flag,stat,contents);this._entry=entry}if(PreloadFile$$1)HTML5FSFile2.__proto__=PreloadFile$$1;HTML5FSFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);HTML5FSFile2.prototype.constructor=HTML5FSFile2;HTML5FSFile2.prototype.sync=function sync(cb){var this$1=this;if(!this.isDirty()){return cb()}this._entry.createWriter(function(writer){var buffer$$1=this$1.getBuffer();var blob=new Blob([buffer2ArrayBuffer(buffer$$1)]);var length=blob.size;writer.onwriteend=function(err){writer.onwriteend=null;writer.onerror=null;writer.truncate(length);this$1.resetDirty();cb()};writer.onerror=function(err){cb(convertError$1(err,this$1.getPath(),false))};writer.write(blob)})};HTML5FSFile2.prototype.close=function close(cb){this.sync(cb)};return HTML5FSFile2}(PreloadFile);var HTML5FS=function(BaseFileSystem$$1){function HTML5FS2(size,type,deprecateMsg){if(size===void 0)size=5;if(type===void 0)type=global$1.PERSISTENT;if(deprecateMsg===void 0)deprecateMsg=true;BaseFileSystem$$1.call(this);this.size=1024*1024*size;this.type=type;deprecationMessage(deprecateMsg,HTML5FS2.Name,{size,type})}if(BaseFileSystem$$1)HTML5FS2.__proto__=BaseFileSystem$$1;HTML5FS2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);HTML5FS2.prototype.constructor=HTML5FS2;HTML5FS2.Create=function Create(opts,cb){var fs4=new HTML5FS2(opts.size,opts.type,false);fs4.allocate(function(e){return e?cb(e):cb(null,fs4)},false)};HTML5FS2.isAvailable=function isAvailable(){return!!_getFS};HTML5FS2.prototype.getName=function getName(){return HTML5FS2.Name};HTML5FS2.prototype.isReadOnly=function isReadOnly(){return false};HTML5FS2.prototype.supportsSymlinks=function supportsSymlinks(){return false};HTML5FS2.prototype.supportsProps=function supportsProps(){return false};HTML5FS2.prototype.supportsSynch=function supportsSynch(){return false};HTML5FS2.prototype.allocate=function allocate(cb,deprecateMsg){var this$1=this;if(cb===void 0)cb=function(){};if(deprecateMsg===void 0)deprecateMsg=true;if(deprecateMsg){console.warn("[HTML5FS] HTML5FS.allocate() is deprecated and will be removed in the next major release. Please use \'HTML5FS.Create({type: "+this.type+", size: "+this.size+"}, cb)\' to create and allocate HTML5FS instances.")}var success=function(fs4){this$1.fs=fs4;cb()};var error=function(err){cb(convertError$1(err,"/",true))};if(this.type===global$1.PERSISTENT){_requestQuota(this.type,this.size,function(granted){_getFS(this$1.type,granted,success,error)},error)}else{_getFS(this.type,this.size,success,error)}};HTML5FS2.prototype.empty=function empty(mainCb){this._readdir("/",function(err,entries){if(err){console.error("Failed to empty FS");mainCb(err)}else{var finished=function(er){if(err){console.error("Failed to empty FS");mainCb(err)}else{mainCb()}};var deleteEntry=function(entry,cb){var succ=function(){cb()};var error=function(err2){cb(convertError$1(err2,entry.fullPath,!entry.isDirectory))};if(isDirectoryEntry(entry)){entry.removeRecursively(succ,error)}else{entry.remove(succ,error)}};eachLimit(entries,deleteEntry,finished)}})};HTML5FS2.prototype.rename=function rename(oldPath,newPath,cb){var this$1=this;var semaphore=2;var successCount=0;var root2=this.fs.root;var currentPath=oldPath;var error=function(err){if(--semaphore<=0){cb(convertError$1(err,currentPath,false))}};var success=function(file){if(++successCount===2){return cb(new ApiError(ErrorCode.EINVAL,"Something was identified as both a file and a directory. This should never happen."))}if(oldPath===newPath){return cb()}currentPath=path.dirname(newPath);root2.getDirectory(currentPath,{},function(parentDir){currentPath=path.basename(newPath);file.moveTo(parentDir,currentPath,function(entry){cb()},function(err){if(file.isDirectory){currentPath=newPath;this$1.unlink(newPath,function(e){if(e){error(err)}else{this$1.rename(oldPath,newPath,cb)}})}else{error(err)}})},error)};root2.getFile(oldPath,{},success,error);root2.getDirectory(oldPath,{},success,error)};HTML5FS2.prototype.stat=function stat(path$$1,isLstat,cb){var this$1=this;var opts={create:false};var loadAsFile=function(entry){var fileFromEntry=function(file){var stat2=new Stats(FileType.FILE,file.size);cb(null,stat2)};entry.file(fileFromEntry,failedToLoad)};var loadAsDir=function(dir$$1){var size=4096;var stat2=new Stats(FileType.DIRECTORY,size);cb(null,stat2)};var failedToLoad=function(err){cb(convertError$1(err,path$$1,false))};var failedToLoadAsFile=function(){this$1.fs.root.getDirectory(path$$1,opts,loadAsDir,failedToLoad)};this.fs.root.getFile(path$$1,opts,loadAsFile,failedToLoadAsFile)};HTML5FS2.prototype.open=function open(p2,flags,mode,cb){var this$1=this;var error=function(err){if(err.name==="InvalidModificationError"&&flags.isExclusive()){cb(ApiError.EEXIST(p2))}else{cb(convertError$1(err,p2,false))}};this.fs.root.getFile(p2,{create:flags.pathNotExistsAction()===ActionType.CREATE_FILE,exclusive:flags.isExclusive()},function(entry){entry.file(function(file){var reader=new FileReader;reader.onloadend=function(event){var bfsFile=this$1._makeFile(p2,entry,flags,file,reader.result);cb(null,bfsFile)};reader.onerror=function(ev2){error(reader.error)};reader.readAsArrayBuffer(file)},error)},error)};HTML5FS2.prototype.unlink=function unlink(path$$1,cb){this._remove(path$$1,cb,true)};HTML5FS2.prototype.rmdir=function rmdir(path$$1,cb){var this$1=this;this.readdir(path$$1,function(e,files){if(e){cb(e)}else if(files.length>0){cb(ApiError.ENOTEMPTY(path$$1))}else{this$1._remove(path$$1,cb,false)}})};HTML5FS2.prototype.mkdir=function mkdir(path$$1,mode,cb){var opts={create:true,exclusive:true};var success=function(dir$$1){cb()};var error=function(err){cb(convertError$1(err,path$$1,true))};this.fs.root.getDirectory(path$$1,opts,success,error)};HTML5FS2.prototype.readdir=function readdir(path$$1,cb){this._readdir(path$$1,function(e,entries){if(entries){var rv=[];for(var i22=0,list2=entries;i22<list2.length;i22+=1){var entry=list2[i22];rv.push(entry.name)}cb(null,rv)}else{return cb(e)}})};HTML5FS2.prototype._makeFile=function _makeFile(path$$1,entry,flag,stat,data){if(data===void 0)data=new ArrayBuffer(0);var stats=new Stats(FileType.FILE,stat.size);var buffer$$1=arrayBuffer2Buffer(data);return new HTML5FSFile(this,entry,path$$1,flag,stats,buffer$$1)};HTML5FS2.prototype._readdir=function _readdir(path$$1,cb){var error=function(err){cb(convertError$1(err,path$$1,true))};this.fs.root.getDirectory(path$$1,{create:false},function(dirEntry){var reader=dirEntry.createReader();var entries=[];var readEntries=function(){reader.readEntries(function(results){if(results.length){entries=entries.concat(_toArray(results));readEntries()}else{cb(null,entries)}},error)};readEntries()},error)};HTML5FS2.prototype._remove=function _remove(path$$1,cb,isFile){var success=function(entry){var succ=function(){cb()};var err=function(err2){cb(convertError$1(err2,path$$1,!isFile))};entry.remove(succ,err)};var error=function(err){cb(convertError$1(err,path$$1,!isFile))};var opts={create:false};if(isFile){this.fs.root.getFile(path$$1,opts,success,error)}else{this.fs.root.getDirectory(path$$1,opts,success,error)}};return HTML5FS2}(BaseFileSystem);HTML5FS.Name="HTML5FS";HTML5FS.Options={size:{type:"number",optional:true,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:true,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}};var Inode=function Inode2(id,size,mode,atime,mtime,ctime){this.id=id;this.size=size;this.mode=mode;this.atime=atime;this.mtime=mtime;this.ctime=ctime};Inode.fromBuffer=function fromBuffer(buffer$$1){if(buffer$$1===void 0){throw new Error("NO")}return new Inode(buffer$$1.toString("ascii",30),buffer$$1.readUInt32LE(0),buffer$$1.readUInt16LE(4),buffer$$1.readDoubleLE(6),buffer$$1.readDoubleLE(14),buffer$$1.readDoubleLE(22))};Inode.prototype.toStats=function toStats(){return new Stats((this.mode&61440)===FileType.DIRECTORY?FileType.DIRECTORY:FileType.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))};Inode.prototype.getSize=function getSize(){return 30+this.id.length};Inode.prototype.toBuffer=function toBuffer(buff){if(buff===void 0)buff=Buffer2.alloc(this.getSize());buff.writeUInt32LE(this.size,0);buff.writeUInt16LE(this.mode,4);buff.writeDoubleLE(this.atime,6);buff.writeDoubleLE(this.mtime,14);buff.writeDoubleLE(this.ctime,22);buff.write(this.id,30,this.id.length,"ascii");return buff};Inode.prototype.update=function update(stats){var hasChanged=false;if(this.size!==stats.size){this.size=stats.size;hasChanged=true}if(this.mode!==stats.mode){this.mode=stats.mode;hasChanged=true}var atimeMs=stats.atime.getTime();if(this.atime!==atimeMs){this.atime=atimeMs;hasChanged=true}var mtimeMs=stats.mtime.getTime();if(this.mtime!==mtimeMs){this.mtime=mtimeMs;hasChanged=true}var ctimeMs=stats.ctime.getTime();if(this.ctime!==ctimeMs){this.ctime=ctimeMs;hasChanged=true}return hasChanged};Inode.prototype.isFile=function isFile(){return(this.mode&61440)===FileType.FILE};Inode.prototype.isDirectory=function isDirectory(){return(this.mode&61440)===FileType.DIRECTORY};var ROOT_NODE_ID="/";var emptyDirNode=null;function getEmptyDirNode(){if(emptyDirNode){return emptyDirNode}return emptyDirNode=Buffer2.from("{}")}function GenerateRandomID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.random()*16|0;var v2=c==="x"?r:r&3|8;return v2.toString(16)})}function noError(e,cb){if(e){cb(e);return false}return true}function noErrorTx(e,tx,cb){if(e){tx.abort(function(){cb(e)});return false}return true}var SimpleSyncRWTransaction=function SimpleSyncRWTransaction2(store){this.store=store;this.originalData={};this.modifiedKeys=[]};SimpleSyncRWTransaction.prototype.get=function get(key){var val=this.store.get(key);this.stashOldValue(key,val);return val};SimpleSyncRWTransaction.prototype.put=function put(key,data,overwrite){this.markModified(key);return this.store.put(key,data,overwrite)};SimpleSyncRWTransaction.prototype.del=function del(key){this.markModified(key);this.store.del(key)};SimpleSyncRWTransaction.prototype.commit=function commit(){};SimpleSyncRWTransaction.prototype.abort=function abort(){var this$1=this;for(var i22=0,list2=this$1.modifiedKeys;i22<list2.length;i22+=1){var key=list2[i22];var value=this$1.originalData[key];if(!value){this$1.store.del(key)}else{this$1.store.put(key,value,true)}}};SimpleSyncRWTransaction.prototype.stashOldValue=function stashOldValue(key,value){if(!this.originalData.hasOwnProperty(key)){this.originalData[key]=value}};SimpleSyncRWTransaction.prototype.markModified=function markModified(key){if(this.modifiedKeys.indexOf(key)===-1){this.modifiedKeys.push(key);if(!this.originalData.hasOwnProperty(key)){this.originalData[key]=this.store.get(key)}}};var SyncKeyValueFile=function(PreloadFile$$1){function SyncKeyValueFile2(_fs,_path,_flag,_stat,contents){PreloadFile$$1.call(this,_fs,_path,_flag,_stat,contents)}if(PreloadFile$$1)SyncKeyValueFile2.__proto__=PreloadFile$$1;SyncKeyValueFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);SyncKeyValueFile2.prototype.constructor=SyncKeyValueFile2;SyncKeyValueFile2.prototype.syncSync=function syncSync(){if(this.isDirty()){this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats());this.resetDirty()}};SyncKeyValueFile2.prototype.closeSync=function closeSync(){this.syncSync()};return SyncKeyValueFile2}(PreloadFile);var SyncKeyValueFileSystem=function(SynchronousFileSystem$$1){function SyncKeyValueFileSystem2(options){SynchronousFileSystem$$1.call(this);this.store=options.store;this.makeRootDirectory()}if(SynchronousFileSystem$$1)SyncKeyValueFileSystem2.__proto__=SynchronousFileSystem$$1;SyncKeyValueFileSystem2.prototype=Object.create(SynchronousFileSystem$$1&&SynchronousFileSystem$$1.prototype);SyncKeyValueFileSystem2.prototype.constructor=SyncKeyValueFileSystem2;SyncKeyValueFileSystem2.isAvailable=function isAvailable(){return true};SyncKeyValueFileSystem2.prototype.getName=function getName(){return this.store.name()};SyncKeyValueFileSystem2.prototype.isReadOnly=function isReadOnly(){return false};SyncKeyValueFileSystem2.prototype.supportsSymlinks=function supportsSymlinks(){return false};SyncKeyValueFileSystem2.prototype.supportsProps=function supportsProps(){return false};SyncKeyValueFileSystem2.prototype.supportsSynch=function supportsSynch(){return true};SyncKeyValueFileSystem2.prototype.empty=function empty(){this.store.clear();this.makeRootDirectory()};SyncKeyValueFileSystem2.prototype.renameSync=function renameSync(oldPath,newPath){var tx=this.store.beginTransaction("readwrite"),oldParent=path.dirname(oldPath),oldName=path.basename(oldPath),newParent=path.dirname(newPath),newName=path.basename(newPath),oldDirNode=this.findINode(tx,oldParent),oldDirList=this.getDirListing(tx,oldParent,oldDirNode);if(!oldDirList[oldName]){throw ApiError.ENOENT(oldPath)}var nodeId=oldDirList[oldName];delete oldDirList[oldName];if((newParent+"/").indexOf(oldPath+"/")===0){throw new ApiError(ErrorCode.EBUSY,oldParent)}var newDirNode,newDirList;if(newParent===oldParent){newDirNode=oldDirNode;newDirList=oldDirList}else{newDirNode=this.findINode(tx,newParent);newDirList=this.getDirListing(tx,newParent,newDirNode)}if(newDirList[newName]){var newNameNode=this.getINode(tx,newPath,newDirList[newName]);if(newNameNode.isFile()){try{tx.del(newNameNode.id);tx.del(newDirList[newName])}catch(e){tx.abort();throw e}}else{throw ApiError.EPERM(newPath)}}newDirList[newName]=nodeId;try{tx.put(oldDirNode.id,Buffer2.from(JSON.stringify(oldDirList)),true);tx.put(newDirNode.id,Buffer2.from(JSON.stringify(newDirList)),true)}catch(e){tx.abort();throw e}tx.commit()};SyncKeyValueFileSystem2.prototype.statSync=function statSync(p2,isLstat){return this.findINode(this.store.beginTransaction("readonly"),p2).toStats()};SyncKeyValueFileSystem2.prototype.createFileSync=function createFileSync(p2,flag,mode){var tx=this.store.beginTransaction("readwrite"),data=emptyBuffer(),newFile=this.commitNewFile(tx,p2,FileType.FILE,mode,data);return new SyncKeyValueFile(this,p2,flag,newFile.toStats(),data)};SyncKeyValueFileSystem2.prototype.openFileSync=function openFileSync(p2,flag){var tx=this.store.beginTransaction("readonly"),node=this.findINode(tx,p2),data=tx.get(node.id);if(data===void 0){throw ApiError.ENOENT(p2)}return new SyncKeyValueFile(this,p2,flag,node.toStats(),data)};SyncKeyValueFileSystem2.prototype.unlinkSync=function unlinkSync(p2){this.removeEntry(p2,false)};SyncKeyValueFileSystem2.prototype.rmdirSync=function rmdirSync(p2){if(this.readdirSync(p2).length>0){throw ApiError.ENOTEMPTY(p2)}else{this.removeEntry(p2,true)}};SyncKeyValueFileSystem2.prototype.mkdirSync=function mkdirSync(p2,mode){var tx=this.store.beginTransaction("readwrite"),data=Buffer2.from("{}");this.commitNewFile(tx,p2,FileType.DIRECTORY,mode,data)};SyncKeyValueFileSystem2.prototype.readdirSync=function readdirSync(p2){var tx=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(tx,p2,this.findINode(tx,p2)))};SyncKeyValueFileSystem2.prototype._syncSync=function _syncSync(p2,data,stats){var tx=this.store.beginTransaction("readwrite"),fileInodeId=this._findINode(tx,path.dirname(p2),path.basename(p2)),fileInode=this.getINode(tx,p2,fileInodeId),inodeChanged=fileInode.update(stats);try{tx.put(fileInode.id,data,true);if(inodeChanged){tx.put(fileInodeId,fileInode.toBuffer(),true)}}catch(e){tx.abort();throw e}tx.commit()};SyncKeyValueFileSystem2.prototype.makeRootDirectory=function makeRootDirectory(){var tx=this.store.beginTransaction("readwrite");if(tx.get(ROOT_NODE_ID)===void 0){var currTime=new Date().getTime(),dirInode=new Inode(GenerateRandomID(),4096,511|FileType.DIRECTORY,currTime,currTime,currTime);tx.put(dirInode.id,getEmptyDirNode(),false);tx.put(ROOT_NODE_ID,dirInode.toBuffer(),false);tx.commit()}};SyncKeyValueFileSystem2.prototype._findINode=function _findINode(tx,parent,filename){var this$1=this;var readDirectory=function(inode){var dirList=this$1.getDirListing(tx,parent,inode);if(dirList[filename]){return dirList[filename]}else{throw ApiError.ENOENT(path.resolve(parent,filename))}};if(parent==="/"){if(filename===""){return ROOT_NODE_ID}else{return readDirectory(this.getINode(tx,parent,ROOT_NODE_ID))}}else{return readDirectory(this.getINode(tx,parent+path.sep+filename,this._findINode(tx,path.dirname(parent),path.basename(parent))))}};SyncKeyValueFileSystem2.prototype.findINode=function findINode(tx,p2){return this.getINode(tx,p2,this._findINode(tx,path.dirname(p2),path.basename(p2)))};SyncKeyValueFileSystem2.prototype.getINode=function getINode(tx,p2,id){var inode=tx.get(id);if(inode===void 0){throw ApiError.ENOENT(p2)}return Inode.fromBuffer(inode)};SyncKeyValueFileSystem2.prototype.getDirListing=function getDirListing(tx,p2,inode){if(!inode.isDirectory()){throw ApiError.ENOTDIR(p2)}var data=tx.get(inode.id);if(data===void 0){throw ApiError.ENOENT(p2)}return JSON.parse(data.toString())};SyncKeyValueFileSystem2.prototype.addNewNode=function addNewNode(tx,data){var retries=0;var currId;while(retries<5){try{currId=GenerateRandomID();tx.put(currId,data,false);return currId}catch(e){}}throw new ApiError(ErrorCode.EIO,"Unable to commit data to key-value store.")};SyncKeyValueFileSystem2.prototype.commitNewFile=function commitNewFile(tx,p2,type,mode,data){var parentDir=path.dirname(p2),fname=path.basename(p2),parentNode=this.findINode(tx,parentDir),dirListing=this.getDirListing(tx,parentDir,parentNode),currTime=new Date().getTime();if(p2==="/"){throw ApiError.EEXIST(p2)}if(dirListing[fname]){throw ApiError.EEXIST(p2)}var fileNode;try{var dataId=this.addNewNode(tx,data);fileNode=new Inode(dataId,data.length,mode|type,currTime,currTime,currTime);var fileNodeId=this.addNewNode(tx,fileNode.toBuffer());dirListing[fname]=fileNodeId;tx.put(parentNode.id,Buffer2.from(JSON.stringify(dirListing)),true)}catch(e){tx.abort();throw e}tx.commit();return fileNode};SyncKeyValueFileSystem2.prototype.removeEntry=function removeEntry(p2,isDir){var tx=this.store.beginTransaction("readwrite"),parent=path.dirname(p2),parentNode=this.findINode(tx,parent),parentListing=this.getDirListing(tx,parent,parentNode),fileName=path.basename(p2);if(!parentListing[fileName]){throw ApiError.ENOENT(p2)}var fileNodeId=parentListing[fileName];delete parentListing[fileName];var fileNode=this.getINode(tx,p2,fileNodeId);if(!isDir&&fileNode.isDirectory()){throw ApiError.EISDIR(p2)}else if(isDir&&!fileNode.isDirectory()){throw ApiError.ENOTDIR(p2)}try{tx.del(fileNode.id);tx.del(fileNodeId);tx.put(parentNode.id,Buffer2.from(JSON.stringify(parentListing)),true)}catch(e){tx.abort();throw e}tx.commit()};return SyncKeyValueFileSystem2}(SynchronousFileSystem);var AsyncKeyValueFile=function(PreloadFile$$1){function AsyncKeyValueFile2(_fs,_path,_flag,_stat,contents){PreloadFile$$1.call(this,_fs,_path,_flag,_stat,contents)}if(PreloadFile$$1)AsyncKeyValueFile2.__proto__=PreloadFile$$1;AsyncKeyValueFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);AsyncKeyValueFile2.prototype.constructor=AsyncKeyValueFile2;AsyncKeyValueFile2.prototype.sync=function sync(cb){var this$1=this;if(this.isDirty()){this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),function(e){if(!e){this$1.resetDirty()}cb(e)})}else{cb()}};AsyncKeyValueFile2.prototype.close=function close(cb){this.sync(cb)};return AsyncKeyValueFile2}(PreloadFile);var AsyncKeyValueFileSystem=function(BaseFileSystem$$1){function AsyncKeyValueFileSystem2(){BaseFileSystem$$1.apply(this,arguments)}if(BaseFileSystem$$1)AsyncKeyValueFileSystem2.__proto__=BaseFileSystem$$1;AsyncKeyValueFileSystem2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);AsyncKeyValueFileSystem2.prototype.constructor=AsyncKeyValueFileSystem2;AsyncKeyValueFileSystem2.isAvailable=function isAvailable(){return true};AsyncKeyValueFileSystem2.prototype.init=function init(store,cb){this.store=store;this.makeRootDirectory(cb)};AsyncKeyValueFileSystem2.prototype.getName=function getName(){return this.store.name()};AsyncKeyValueFileSystem2.prototype.isReadOnly=function isReadOnly(){return false};AsyncKeyValueFileSystem2.prototype.supportsSymlinks=function supportsSymlinks(){return false};AsyncKeyValueFileSystem2.prototype.supportsProps=function supportsProps(){return false};AsyncKeyValueFileSystem2.prototype.supportsSynch=function supportsSynch(){return false};AsyncKeyValueFileSystem2.prototype.empty=function empty(cb){var this$1=this;this.store.clear(function(e){if(noError(e,cb)){this$1.makeRootDirectory(cb)}})};AsyncKeyValueFileSystem2.prototype.rename=function rename(oldPath,newPath,cb){var this$1=this;var tx=this.store.beginTransaction("readwrite");var oldParent=path.dirname(oldPath),oldName=path.basename(oldPath);var newParent=path.dirname(newPath),newName=path.basename(newPath);var inodes={};var lists={};var errorOccurred=false;if((newParent+"/").indexOf(oldPath+"/")===0){return cb(new ApiError(ErrorCode.EBUSY,oldParent))}var theOleSwitcharoo=function(){if(errorOccurred||!lists.hasOwnProperty(oldParent)||!lists.hasOwnProperty(newParent)){return}var oldParentList=lists[oldParent],oldParentINode=inodes[oldParent],newParentList=lists[newParent],newParentINode=inodes[newParent];if(!oldParentList[oldName]){cb(ApiError.ENOENT(oldPath))}else{var fileId=oldParentList[oldName];delete oldParentList[oldName];var completeRename=function(){newParentList[newName]=fileId;tx.put(oldParentINode.id,Buffer2.from(JSON.stringify(oldParentList)),true,function(e){if(noErrorTx(e,tx,cb)){if(oldParent===newParent){tx.commit(cb)}else{tx.put(newParentINode.id,Buffer2.from(JSON.stringify(newParentList)),true,function(e2){if(noErrorTx(e2,tx,cb)){tx.commit(cb)}})}}})};if(newParentList[newName]){this$1.getINode(tx,newPath,newParentList[newName],function(e,inode){if(noErrorTx(e,tx,cb)){if(inode.isFile()){tx.del(inode.id,function(e2){if(noErrorTx(e2,tx,cb)){tx.del(newParentList[newName],function(e3){if(noErrorTx(e3,tx,cb)){completeRename()}})}})}else{tx.abort(function(e2){cb(ApiError.EPERM(newPath))})}}})}else{completeRename()}}};var processInodeAndListings=function(p2){this$1.findINodeAndDirListing(tx,p2,function(e,node,dirList){if(e){if(!errorOccurred){errorOccurred=true;tx.abort(function(){cb(e)})}}else{inodes[p2]=node;lists[p2]=dirList;theOleSwitcharoo()}})};processInodeAndListings(oldParent);if(oldParent!==newParent){processInodeAndListings(newParent)}};AsyncKeyValueFileSystem2.prototype.stat=function stat(p2,isLstat,cb){var tx=this.store.beginTransaction("readonly");this.findINode(tx,p2,function(e,inode){if(noError(e,cb)){cb(null,inode.toStats())}})};AsyncKeyValueFileSystem2.prototype.createFile=function createFile(p2,flag,mode,cb){var this$1=this;var tx=this.store.beginTransaction("readwrite"),data=emptyBuffer();this.commitNewFile(tx,p2,FileType.FILE,mode,data,function(e,newFile){if(noError(e,cb)){cb(null,new AsyncKeyValueFile(this$1,p2,flag,newFile.toStats(),data))}})};AsyncKeyValueFileSystem2.prototype.openFile=function openFile(p2,flag,cb){var this$1=this;var tx=this.store.beginTransaction("readonly");this.findINode(tx,p2,function(e,inode){if(noError(e,cb)){tx.get(inode.id,function(e2,data){if(noError(e2,cb)){if(data===void 0){cb(ApiError.ENOENT(p2))}else{cb(null,new AsyncKeyValueFile(this$1,p2,flag,inode.toStats(),data))}}})}})};AsyncKeyValueFileSystem2.prototype.unlink=function unlink(p2,cb){this.removeEntry(p2,false,cb)};AsyncKeyValueFileSystem2.prototype.rmdir=function rmdir(p2,cb){var this$1=this;this.readdir(p2,function(err,files){if(err){cb(err)}else if(files.length>0){cb(ApiError.ENOTEMPTY(p2))}else{this$1.removeEntry(p2,true,cb)}})};AsyncKeyValueFileSystem2.prototype.mkdir=function mkdir(p2,mode,cb){var tx=this.store.beginTransaction("readwrite"),data=Buffer2.from("{}");this.commitNewFile(tx,p2,FileType.DIRECTORY,mode,data,cb)};AsyncKeyValueFileSystem2.prototype.readdir=function readdir(p2,cb){var this$1=this;var tx=this.store.beginTransaction("readonly");this.findINode(tx,p2,function(e,inode){if(noError(e,cb)){this$1.getDirListing(tx,p2,inode,function(e2,dirListing){if(noError(e2,cb)){cb(null,Object.keys(dirListing))}})}})};AsyncKeyValueFileSystem2.prototype._sync=function _sync(p2,data,stats,cb){var this$1=this;var tx=this.store.beginTransaction("readwrite");this._findINode(tx,path.dirname(p2),path.basename(p2),function(e,fileInodeId){if(noErrorTx(e,tx,cb)){this$1.getINode(tx,p2,fileInodeId,function(e2,fileInode){if(noErrorTx(e2,tx,cb)){var inodeChanged=fileInode.update(stats);tx.put(fileInode.id,data,true,function(e3){if(noErrorTx(e3,tx,cb)){if(inodeChanged){tx.put(fileInodeId,fileInode.toBuffer(),true,function(e4){if(noErrorTx(e4,tx,cb)){tx.commit(cb)}})}else{tx.commit(cb)}}})}})}})};AsyncKeyValueFileSystem2.prototype.makeRootDirectory=function makeRootDirectory(cb){var tx=this.store.beginTransaction("readwrite");tx.get(ROOT_NODE_ID,function(e,data){if(e||data===void 0){var currTime=new Date().getTime(),dirInode=new Inode(GenerateRandomID(),4096,511|FileType.DIRECTORY,currTime,currTime,currTime);tx.put(dirInode.id,getEmptyDirNode(),false,function(e2){if(noErrorTx(e2,tx,cb)){tx.put(ROOT_NODE_ID,dirInode.toBuffer(),false,function(e3){if(e3){tx.abort(function(){cb(e3)})}else{tx.commit(cb)}})}})}else{tx.commit(cb)}})};AsyncKeyValueFileSystem2.prototype._findINode=function _findINode(tx,parent,filename,cb){var this$1=this;var handleDirectoryListings=function(e,inode,dirList){if(e){cb(e)}else if(dirList[filename]){cb(null,dirList[filename])}else{cb(ApiError.ENOENT(path.resolve(parent,filename)))}};if(parent==="/"){if(filename===""){cb(null,ROOT_NODE_ID)}else{this.getINode(tx,parent,ROOT_NODE_ID,function(e,inode){if(noError(e,cb)){this$1.getDirListing(tx,parent,inode,function(e2,dirList){handleDirectoryListings(e2,inode,dirList)})}})}}else{this.findINodeAndDirListing(tx,parent,handleDirectoryListings)}};AsyncKeyValueFileSystem2.prototype.findINode=function findINode(tx,p2,cb){var this$1=this;this._findINode(tx,path.dirname(p2),path.basename(p2),function(e,id){if(noError(e,cb)){this$1.getINode(tx,p2,id,cb)}})};AsyncKeyValueFileSystem2.prototype.getINode=function getINode(tx,p2,id,cb){tx.get(id,function(e,data){if(noError(e,cb)){if(data===void 0){cb(ApiError.ENOENT(p2))}else{cb(null,Inode.fromBuffer(data))}}})};AsyncKeyValueFileSystem2.prototype.getDirListing=function getDirListing(tx,p2,inode,cb){if(!inode.isDirectory()){cb(ApiError.ENOTDIR(p2))}else{tx.get(inode.id,function(e,data){if(noError(e,cb)){try{cb(null,JSON.parse(data.toString()))}catch(e2){cb(ApiError.ENOENT(p2))}}})}};AsyncKeyValueFileSystem2.prototype.findINodeAndDirListing=function findINodeAndDirListing(tx,p2,cb){var this$1=this;this.findINode(tx,p2,function(e,inode){if(noError(e,cb)){this$1.getDirListing(tx,p2,inode,function(e2,listing){if(noError(e2,cb)){cb(null,inode,listing)}})}})};AsyncKeyValueFileSystem2.prototype.addNewNode=function addNewNode(tx,data,cb){var retries=0,currId;var reroll=function(){if(++retries===5){cb(new ApiError(ErrorCode.EIO,"Unable to commit data to key-value store."))}else{currId=GenerateRandomID();tx.put(currId,data,false,function(e,committed){if(e||!committed){reroll()}else{cb(null,currId)}})}};reroll()};AsyncKeyValueFileSystem2.prototype.commitNewFile=function commitNewFile(tx,p2,type,mode,data,cb){var this$1=this;var parentDir=path.dirname(p2),fname=path.basename(p2),currTime=new Date().getTime();if(p2==="/"){return cb(ApiError.EEXIST(p2))}this.findINodeAndDirListing(tx,parentDir,function(e,parentNode,dirListing){if(noErrorTx(e,tx,cb)){if(dirListing[fname]){tx.abort(function(){cb(ApiError.EEXIST(p2))})}else{this$1.addNewNode(tx,data,function(e2,dataId){if(noErrorTx(e2,tx,cb)){var fileInode=new Inode(dataId,data.length,mode|type,currTime,currTime,currTime);this$1.addNewNode(tx,fileInode.toBuffer(),function(e3,fileInodeId){if(noErrorTx(e3,tx,cb)){dirListing[fname]=fileInodeId;tx.put(parentNode.id,Buffer2.from(JSON.stringify(dirListing)),true,function(e4){if(noErrorTx(e4,tx,cb)){tx.commit(function(e5){if(noErrorTx(e5,tx,cb)){cb(null,fileInode)}})}})}})}})}}})};AsyncKeyValueFileSystem2.prototype.removeEntry=function removeEntry(p2,isDir,cb){var this$1=this;var tx=this.store.beginTransaction("readwrite"),parent=path.dirname(p2),fileName=path.basename(p2);this.findINodeAndDirListing(tx,parent,function(e,parentNode,parentListing){if(noErrorTx(e,tx,cb)){if(!parentListing[fileName]){tx.abort(function(){cb(ApiError.ENOENT(p2))})}else{var fileNodeId=parentListing[fileName];delete parentListing[fileName];this$1.getINode(tx,p2,fileNodeId,function(e2,fileNode){if(noErrorTx(e2,tx,cb)){if(!isDir&&fileNode.isDirectory()){tx.abort(function(){cb(ApiError.EISDIR(p2))})}else if(isDir&&!fileNode.isDirectory()){tx.abort(function(){cb(ApiError.ENOTDIR(p2))})}else{tx.del(fileNode.id,function(e3){if(noErrorTx(e3,tx,cb)){tx.del(fileNodeId,function(e4){if(noErrorTx(e4,tx,cb)){tx.put(parentNode.id,Buffer2.from(JSON.stringify(parentListing)),true,function(e5){if(noErrorTx(e5,tx,cb)){tx.commit(cb)}})}})}})}}})}}})};return AsyncKeyValueFileSystem2}(BaseFileSystem);var InMemoryStore=function InMemoryStore2(){this.store={}};InMemoryStore.prototype.name=function name2(){return InMemoryFileSystem.Name};InMemoryStore.prototype.clear=function clear(){this.store={}};InMemoryStore.prototype.beginTransaction=function beginTransaction(type){return new SimpleSyncRWTransaction(this)};InMemoryStore.prototype.get=function get(key){return this.store[key]};InMemoryStore.prototype.put=function put(key,data,overwrite){if(!overwrite&&this.store.hasOwnProperty(key)){return false}this.store[key]=data;return true};InMemoryStore.prototype.del=function del(key){delete this.store[key]};var InMemoryFileSystem=function(SyncKeyValueFileSystem$$1){function InMemoryFileSystem2(){SyncKeyValueFileSystem$$1.call(this,{store:new InMemoryStore})}if(SyncKeyValueFileSystem$$1)InMemoryFileSystem2.__proto__=SyncKeyValueFileSystem$$1;InMemoryFileSystem2.prototype=Object.create(SyncKeyValueFileSystem$$1&&SyncKeyValueFileSystem$$1.prototype);InMemoryFileSystem2.prototype.constructor=InMemoryFileSystem2;InMemoryFileSystem2.Create=function Create(options,cb){cb(null,new InMemoryFileSystem2)};return InMemoryFileSystem2}(SyncKeyValueFileSystem);InMemoryFileSystem.Name="InMemory";InMemoryFileSystem.Options={};var indexedDB=global$1.indexedDB||global$1.mozIndexedDB||global$1.webkitIndexedDB||global$1.msIndexedDB;function convertError$2(e,message){if(message===void 0)message=e.toString();switch(e.name){case"NotFoundError":return new ApiError(ErrorCode.ENOENT,message);case"QuotaExceededError":return new ApiError(ErrorCode.ENOSPC,message);default:return new ApiError(ErrorCode.EIO,message)}}function onErrorHandler(cb,code,message){if(code===void 0)code=ErrorCode.EIO;if(message===void 0)message=null;return function(e){e.preventDefault();cb(new ApiError(code,message!==null?message:void 0))}}var IndexedDBROTransaction=function IndexedDBROTransaction2(tx,store){this.tx=tx;this.store=store};IndexedDBROTransaction.prototype.get=function get(key,cb){try{var r=this.store.get(key);r.onerror=onErrorHandler(cb);r.onsuccess=function(event){var result=event.target.result;if(result===void 0){cb(null,result)}else{cb(null,arrayBuffer2Buffer(result))}}}catch(e){cb(convertError$2(e))}};var IndexedDBRWTransaction=function(IndexedDBROTransaction2){function IndexedDBRWTransaction2(tx,store){IndexedDBROTransaction2.call(this,tx,store)}if(IndexedDBROTransaction2)IndexedDBRWTransaction2.__proto__=IndexedDBROTransaction2;IndexedDBRWTransaction2.prototype=Object.create(IndexedDBROTransaction2&&IndexedDBROTransaction2.prototype);IndexedDBRWTransaction2.prototype.constructor=IndexedDBRWTransaction2;IndexedDBRWTransaction2.prototype.put=function put(key,data,overwrite,cb){try{var arraybuffer=buffer2ArrayBuffer(data);var r;if(overwrite){r=this.store.put(arraybuffer,key)}else{r=this.store.add(arraybuffer,key)}r.onerror=onErrorHandler(cb);r.onsuccess=function(event){cb(null,true)}}catch(e){cb(convertError$2(e))}};IndexedDBRWTransaction2.prototype.del=function del(key,cb){try{var r=this.store["delete"](key);r.onerror=onErrorHandler(cb);r.onsuccess=function(event){cb()}}catch(e){cb(convertError$2(e))}};IndexedDBRWTransaction2.prototype.commit=function commit(cb){setTimeout(cb,0)};IndexedDBRWTransaction2.prototype.abort=function abort(cb){var _e=null;try{this.tx.abort()}catch(e){_e=convertError$2(e)}finally{cb(_e)}};return IndexedDBRWTransaction2}(IndexedDBROTransaction);var IndexedDBStore=function IndexedDBStore2(cb,storeName){var this$1=this;if(storeName===void 0)storeName="browserfs";this.storeName=storeName;var openReq=indexedDB.open(this.storeName,1);openReq.onupgradeneeded=function(event){var db=event.target.result;if(db.objectStoreNames.contains(this$1.storeName)){db.deleteObjectStore(this$1.storeName)}db.createObjectStore(this$1.storeName)};openReq.onsuccess=function(event){this$1.db=event.target.result;cb(null,this$1)};openReq.onerror=onErrorHandler(cb,ErrorCode.EACCES)};IndexedDBStore.prototype.name=function name2(){return IndexedDBFileSystem.Name+" - "+this.storeName};IndexedDBStore.prototype.clear=function clear(cb){try{var tx=this.db.transaction(this.storeName,"readwrite"),objectStore=tx.objectStore(this.storeName),r=objectStore.clear();r.onsuccess=function(event){setTimeout(cb,0)};r.onerror=onErrorHandler(cb)}catch(e){cb(convertError$2(e))}};IndexedDBStore.prototype.beginTransaction=function beginTransaction(type){if(type===void 0)type="readonly";var tx=this.db.transaction(this.storeName,type),objectStore=tx.objectStore(this.storeName);if(type==="readwrite"){return new IndexedDBRWTransaction(tx,objectStore)}else if(type==="readonly"){return new IndexedDBROTransaction(tx,objectStore)}else{throw new ApiError(ErrorCode.EINVAL,"Invalid transaction type.")}};var IndexedDBFileSystem=function(AsyncKeyValueFileSystem$$1){function IndexedDBFileSystem2(cb,storeName,deprecateMsg){var this$1=this;if(deprecateMsg===void 0)deprecateMsg=true;AsyncKeyValueFileSystem$$1.call(this);this.store=new IndexedDBStore(function(e){if(e){cb(e)}else{this$1.init(this$1.store,function(e2){cb(e2,this$1)})}},storeName);deprecationMessage(deprecateMsg,IndexedDBFileSystem2.Name,{storeName})}if(AsyncKeyValueFileSystem$$1)IndexedDBFileSystem2.__proto__=AsyncKeyValueFileSystem$$1;IndexedDBFileSystem2.prototype=Object.create(AsyncKeyValueFileSystem$$1&&AsyncKeyValueFileSystem$$1.prototype);IndexedDBFileSystem2.prototype.constructor=IndexedDBFileSystem2;IndexedDBFileSystem2.Create=function Create(opts,cb){new IndexedDBFileSystem2(cb,opts.storeName,false)};IndexedDBFileSystem2.isAvailable=function isAvailable(){try{return typeof indexedDB!=="undefined"&&null!==indexedDB.open("__browserfs_test__")}catch(e){return false}};return IndexedDBFileSystem2}(AsyncKeyValueFileSystem);IndexedDBFileSystem.Name="IndexedDB";IndexedDBFileSystem.Options={storeName:{type:"string",optional:true,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."}};var supportsBinaryString=false;var binaryEncoding;try{global$1.localStorage.setItem("__test__",String.fromCharCode(55296));supportsBinaryString=global$1.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch(e){supportsBinaryString=false}binaryEncoding=supportsBinaryString?"binary_string":"binary_string_ie";if(!Buffer2.isEncoding(binaryEncoding)){binaryEncoding="base64"}var LocalStorageStore=function LocalStorageStore2(){};LocalStorageStore.prototype.name=function name2(){return LocalStorageFileSystem.Name};LocalStorageStore.prototype.clear=function clear(){global$1.localStorage.clear()};LocalStorageStore.prototype.beginTransaction=function beginTransaction(type){return new SimpleSyncRWTransaction(this)};LocalStorageStore.prototype.get=function get(key){try{var data=global$1.localStorage.getItem(key);if(data!==null){return Buffer2.from(data,binaryEncoding)}}catch(e){}return void 0};LocalStorageStore.prototype.put=function put(key,data,overwrite){try{if(!overwrite&&global$1.localStorage.getItem(key)!==null){return false}global$1.localStorage.setItem(key,data.toString(binaryEncoding));return true}catch(e){throw new ApiError(ErrorCode.ENOSPC,"LocalStorage is full.")}};LocalStorageStore.prototype.del=function del(key){try{global$1.localStorage.removeItem(key)}catch(e){throw new ApiError(ErrorCode.EIO,"Unable to delete key "+key+": "+e)}};var LocalStorageFileSystem=function(SyncKeyValueFileSystem$$1){function LocalStorageFileSystem2(){SyncKeyValueFileSystem$$1.call(this,{store:new LocalStorageStore})}if(SyncKeyValueFileSystem$$1)LocalStorageFileSystem2.__proto__=SyncKeyValueFileSystem$$1;LocalStorageFileSystem2.prototype=Object.create(SyncKeyValueFileSystem$$1&&SyncKeyValueFileSystem$$1.prototype);LocalStorageFileSystem2.prototype.constructor=LocalStorageFileSystem2;LocalStorageFileSystem2.Create=function Create(options,cb){cb(null,new LocalStorageFileSystem2)};LocalStorageFileSystem2.isAvailable=function isAvailable(){return typeof global$1.localStorage!=="undefined"};return LocalStorageFileSystem2}(SyncKeyValueFileSystem);LocalStorageFileSystem.Name="LocalStorage";LocalStorageFileSystem.Options={};var MountableFileSystem=function(BaseFileSystem$$1){function MountableFileSystem2(){BaseFileSystem$$1.call(this);this.mountList=[];this.mntMap={};this.rootFs=new InMemoryFileSystem}if(BaseFileSystem$$1)MountableFileSystem2.__proto__=BaseFileSystem$$1;MountableFileSystem2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);MountableFileSystem2.prototype.constructor=MountableFileSystem2;MountableFileSystem2.Create=function Create(opts,cb){var fs4=new MountableFileSystem2;Object.keys(opts).forEach(function(mountPoint){fs4.mount(mountPoint,opts[mountPoint])});cb(null,fs4)};MountableFileSystem2.isAvailable=function isAvailable(){return true};MountableFileSystem2.prototype.mount=function mount(mountPoint,fs4){if(mountPoint[0]!=="/"){mountPoint="/"+mountPoint}mountPoint=path.resolve(mountPoint);if(this.mntMap[mountPoint]){throw new ApiError(ErrorCode.EINVAL,"Mount point "+mountPoint+" is already taken.")}mkdirpSync(mountPoint,511,this.rootFs);this.mntMap[mountPoint]=fs4;this.mountList.push(mountPoint);this.mountList=this.mountList.sort(function(a,b){return b.length-a.length})};MountableFileSystem2.prototype.umount=function umount(mountPoint){var this$1=this;if(mountPoint[0]!=="/"){mountPoint="/"+mountPoint}mountPoint=path.resolve(mountPoint);if(!this.mntMap[mountPoint]){throw new ApiError(ErrorCode.EINVAL,"Mount point "+mountPoint+" is already unmounted.")}delete this.mntMap[mountPoint];this.mountList.splice(this.mountList.indexOf(mountPoint),1);while(mountPoint!=="/"){if(this$1.rootFs.readdirSync(mountPoint).length===0){this$1.rootFs.rmdirSync(mountPoint);mountPoint=path.dirname(mountPoint)}else{break}}};MountableFileSystem2.prototype._getFs=function _getFs(path$$1){var this$1=this;var mountList=this.mountList,len=mountList.length;for(var i22=0;i22<len;i22++){var mountPoint=mountList[i22];if(mountPoint.length<=path$$1.length&&path$$1.indexOf(mountPoint)===0){path$$1=path$$1.substr(mountPoint.length>1?mountPoint.length:0);if(path$$1===""){path$$1="/"}return{fs:this$1.mntMap[mountPoint],path:path$$1}}}return{fs:this.rootFs,path:path$$1}};MountableFileSystem2.prototype.getName=function getName(){return MountableFileSystem2.Name};MountableFileSystem2.prototype.diskSpace=function diskSpace(path$$1,cb){cb(0,0)};MountableFileSystem2.prototype.isReadOnly=function isReadOnly(){return false};MountableFileSystem2.prototype.supportsLinks=function supportsLinks(){return false};MountableFileSystem2.prototype.supportsProps=function supportsProps(){return false};MountableFileSystem2.prototype.supportsSynch=function supportsSynch(){return true};MountableFileSystem2.prototype.standardizeError=function standardizeError(err,path$$1,realPath){var index=err.message.indexOf(path$$1);if(index!==-1){err.message=err.message.substr(0,index)+realPath+err.message.substr(index+path$$1.length);err.path=realPath}return err};MountableFileSystem2.prototype.rename=function rename(oldPath,newPath,cb){var this$1=this;var fs1rv=this._getFs(oldPath);var fs2rv=this._getFs(newPath);if(fs1rv.fs===fs2rv.fs){return fs1rv.fs.rename(fs1rv.path,fs2rv.path,function(e){if(e){this$1.standardizeError(this$1.standardizeError(e,fs1rv.path,oldPath),fs2rv.path,newPath)}cb(e)})}return _fsMock.readFile(oldPath,function(err,data){if(err){return cb(err)}_fsMock.writeFile(newPath,data,function(err2){if(err2){return cb(err2)}_fsMock.unlink(oldPath,cb)})})};MountableFileSystem2.prototype.renameSync=function renameSync(oldPath,newPath){var fs1rv=this._getFs(oldPath);var fs2rv=this._getFs(newPath);if(fs1rv.fs===fs2rv.fs){try{return fs1rv.fs.renameSync(fs1rv.path,fs2rv.path)}catch(e){this.standardizeError(this.standardizeError(e,fs1rv.path,oldPath),fs2rv.path,newPath);throw e}}var data=_fsMock.readFileSync(oldPath);_fsMock.writeFileSync(newPath,data);return _fsMock.unlinkSync(oldPath)};MountableFileSystem2.prototype.readdirSync=function readdirSync(p2){var fsInfo=this._getFs(p2);var rv=null;if(fsInfo.fs!==this.rootFs){try{rv=this.rootFs.readdirSync(p2)}catch(e){}}try{var rv2=fsInfo.fs.readdirSync(fsInfo.path);if(rv===null){return rv2}else{return rv2.concat(rv.filter(function(val){return rv2.indexOf(val)===-1}))}}catch(e){if(rv===null){throw this.standardizeError(e,fsInfo.path,p2)}else{return rv}}};MountableFileSystem2.prototype.readdir=function readdir(p2,cb){var this$1=this;var fsInfo=this._getFs(p2);fsInfo.fs.readdir(fsInfo.path,function(err,files){if(fsInfo.fs!==this$1.rootFs){try{var rv=this$1.rootFs.readdirSync(p2);if(files){files=files.concat(rv.filter(function(val){return files.indexOf(val)===-1}))}else{files=rv}}catch(e){if(err){return cb(this$1.standardizeError(err,fsInfo.path,p2))}}}else if(err){return cb(this$1.standardizeError(err,fsInfo.path,p2))}cb(null,files)})};MountableFileSystem2.prototype.rmdirSync=function rmdirSync(p2){var fsInfo=this._getFs(p2);if(this._containsMountPt(p2)){throw ApiError.ENOTEMPTY(p2)}else{try{fsInfo.fs.rmdirSync(fsInfo.path)}catch(e){throw this.standardizeError(e,fsInfo.path,p2)}}};MountableFileSystem2.prototype.rmdir=function rmdir(p2,cb){var this$1=this;var fsInfo=this._getFs(p2);if(this._containsMountPt(p2)){cb(ApiError.ENOTEMPTY(p2))}else{fsInfo.fs.rmdir(fsInfo.path,function(err){cb(err?this$1.standardizeError(err,fsInfo.path,p2):null)})}};MountableFileSystem2.prototype._containsMountPt=function _containsMountPt(p2){var mountPoints=this.mountList,len=mountPoints.length;for(var i22=0;i22<len;i22++){var pt=mountPoints[i22];if(pt.length>=p2.length&&pt.slice(0,p2.length)===p2){return true}}return false};return MountableFileSystem2}(BaseFileSystem);MountableFileSystem.Name="MountableFileSystem";MountableFileSystem.Options={};function defineFcn(name2,isSync,numArgs){if(isSync){return function(){var args=[],len=arguments.length;while(len--)args[len]=arguments[len];var path$$1=args[0];var rv=this._getFs(path$$1);args[0]=rv.path;try{return rv.fs[name2].apply(rv.fs,args)}catch(e){this.standardizeError(e,rv.path,path$$1);throw e}}}else{return function(){var this$1=this;var args=[],len=arguments.length;while(len--)args[len]=arguments[len];var path$$1=args[0];var rv=this._getFs(path$$1);args[0]=rv.path;if(typeof args[args.length-1]==="function"){var cb=args[args.length-1];args[args.length-1]=function(){var args2=[],len2=arguments.length;while(len2--)args2[len2]=arguments[len2];if(args2.length>0&&args2[0]instanceof ApiError){this$1.standardizeError(args2[0],rv.path,path$$1)}cb.apply(null,args2)}}return rv.fs[name2].apply(rv.fs,args)}}}var fsCmdMap=[["exists","unlink","readlink"],["stat","mkdir","realpath","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]];for(var i3=0;i3<fsCmdMap.length;i3++){var cmds=fsCmdMap[i3];for(var i$1=0,list=cmds;i$1<list.length;i$1+=1){var fnName=list[i$1];MountableFileSystem.prototype[fnName]=defineFcn(fnName,false,i3+1);MountableFileSystem.prototype[fnName+"Sync"]=defineFcn(fnName+"Sync",true,i3+1)}}var bfsSetImmediate;if(typeof setImmediate!=="undefined"){bfsSetImmediate=setImmediate}else{var gScope=global$1;var timeouts=[];var messageName="zero-timeout-message";var canUsePostMessage=function(){if(typeof gScope.importScripts!=="undefined"||!gScope.postMessage){return false}var postMessageIsAsync=true;var oldOnMessage=gScope.onmessage;gScope.onmessage=function(){postMessageIsAsync=false};gScope.postMessage("","*");gScope.onmessage=oldOnMessage;return postMessageIsAsync};if(canUsePostMessage()){bfsSetImmediate=function(fn){timeouts.push(fn);gScope.postMessage(messageName,"*")};var handleMessage=function(event){if(event.source===self&&event.data===messageName){if(event.stopPropagation){event.stopPropagation()}else{event.cancelBubble=true}if(timeouts.length>0){var fn=timeouts.shift();return fn()}}};if(gScope.addEventListener){gScope.addEventListener("message",handleMessage,true)}else{gScope.attachEvent("onmessage",handleMessage)}}else if(gScope.MessageChannel){var channel=new gScope.MessageChannel;channel.port1.onmessage=function(event){if(timeouts.length>0){return timeouts.shift()()}};bfsSetImmediate=function(fn){timeouts.push(fn);channel.port2.postMessage("")}}else{bfsSetImmediate=function(fn){return setTimeout(fn,0)}}}var setImmediate$3=bfsSetImmediate;var Mutex=function Mutex2(){this._locked=false;this._waiters=[]};Mutex.prototype.lock=function lock(cb){if(this._locked){this._waiters.push(cb);return}this._locked=true;cb()};Mutex.prototype.unlock=function unlock(){if(!this._locked){throw new Error("unlock of a non-locked mutex")}var next=this._waiters.shift();if(next){setImmediate$3(next);return}this._locked=false};Mutex.prototype.tryLock=function tryLock(){if(this._locked){return false}this._locked=true;return true};Mutex.prototype.isLocked=function isLocked(){return this._locked};var LockedFS=function LockedFS2(fs4){this._fs=fs4;this._mu=new Mutex};LockedFS.prototype.getName=function getName(){return"LockedFS<"+this._fs.getName()+">"};LockedFS.prototype.getFSUnlocked=function getFSUnlocked(){return this._fs};LockedFS.prototype.initialize=function initialize3(cb){this._fs.initialize(cb)};LockedFS.prototype.diskSpace=function diskSpace(p2,cb){this._fs.diskSpace(p2,cb)};LockedFS.prototype.isReadOnly=function isReadOnly(){return this._fs.isReadOnly()};LockedFS.prototype.supportsLinks=function supportsLinks(){return this._fs.supportsLinks()};LockedFS.prototype.supportsProps=function supportsProps(){return this._fs.supportsProps()};LockedFS.prototype.supportsSynch=function supportsSynch(){return this._fs.supportsSynch()};LockedFS.prototype.rename=function rename(oldPath,newPath,cb){var this$1=this;this._mu.lock(function(){this$1._fs.rename(oldPath,newPath,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.renameSync=function renameSync(oldPath,newPath){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.renameSync(oldPath,newPath)};LockedFS.prototype.stat=function stat(p2,isLstat,cb){var this$1=this;this._mu.lock(function(){this$1._fs.stat(p2,isLstat,function(err,stat2){this$1._mu.unlock();cb(err,stat2)})})};LockedFS.prototype.statSync=function statSync(p2,isLstat){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.statSync(p2,isLstat)};LockedFS.prototype.open=function open(p2,flag,mode,cb){var this$1=this;this._mu.lock(function(){this$1._fs.open(p2,flag,mode,function(err,fd){this$1._mu.unlock();cb(err,fd)})})};LockedFS.prototype.openSync=function openSync(p2,flag,mode){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.openSync(p2,flag,mode)};LockedFS.prototype.unlink=function unlink(p2,cb){var this$1=this;this._mu.lock(function(){this$1._fs.unlink(p2,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.unlinkSync=function unlinkSync(p2){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.unlinkSync(p2)};LockedFS.prototype.rmdir=function rmdir(p2,cb){var this$1=this;this._mu.lock(function(){this$1._fs.rmdir(p2,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.rmdirSync=function rmdirSync(p2){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.rmdirSync(p2)};LockedFS.prototype.mkdir=function mkdir(p2,mode,cb){var this$1=this;this._mu.lock(function(){this$1._fs.mkdir(p2,mode,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.mkdirSync=function mkdirSync(p2,mode){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.mkdirSync(p2,mode)};LockedFS.prototype.readdir=function readdir(p2,cb){var this$1=this;this._mu.lock(function(){this$1._fs.readdir(p2,function(err,files){this$1._mu.unlock();cb(err,files)})})};LockedFS.prototype.readdirSync=function readdirSync(p2){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.readdirSync(p2)};LockedFS.prototype.exists=function exists2(p2,cb){var this$1=this;this._mu.lock(function(){this$1._fs.exists(p2,function(exists3){this$1._mu.unlock();cb(exists3)})})};LockedFS.prototype.existsSync=function existsSync(p2){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.existsSync(p2)};LockedFS.prototype.realpath=function realpath(p2,cache,cb){var this$1=this;this._mu.lock(function(){this$1._fs.realpath(p2,cache,function(err,resolvedPath){this$1._mu.unlock();cb(err,resolvedPath)})})};LockedFS.prototype.realpathSync=function realpathSync(p2,cache){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.realpathSync(p2,cache)};LockedFS.prototype.truncate=function truncate(p2,len,cb){var this$1=this;this._mu.lock(function(){this$1._fs.truncate(p2,len,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.truncateSync=function truncateSync(p2,len){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.truncateSync(p2,len)};LockedFS.prototype.readFile=function readFile2(fname,encoding,flag,cb){var this$1=this;this._mu.lock(function(){this$1._fs.readFile(fname,encoding,flag,function(err,data){this$1._mu.unlock();cb(err,data)})})};LockedFS.prototype.readFileSync=function readFileSync(fname,encoding,flag){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.readFileSync(fname,encoding,flag)};LockedFS.prototype.writeFile=function writeFile2(fname,data,encoding,flag,mode,cb){var this$1=this;this._mu.lock(function(){this$1._fs.writeFile(fname,data,encoding,flag,mode,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.writeFileSync=function writeFileSync(fname,data,encoding,flag,mode){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.writeFileSync(fname,data,encoding,flag,mode)};LockedFS.prototype.appendFile=function appendFile3(fname,data,encoding,flag,mode,cb){var this$1=this;this._mu.lock(function(){this$1._fs.appendFile(fname,data,encoding,flag,mode,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.appendFileSync=function appendFileSync(fname,data,encoding,flag,mode){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.appendFileSync(fname,data,encoding,flag,mode)};LockedFS.prototype.chmod=function chmod(p2,isLchmod,mode,cb){var this$1=this;this._mu.lock(function(){this$1._fs.chmod(p2,isLchmod,mode,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.chmodSync=function chmodSync(p2,isLchmod,mode){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.chmodSync(p2,isLchmod,mode)};LockedFS.prototype.chown=function chown(p2,isLchown,uid,gid,cb){var this$1=this;this._mu.lock(function(){this$1._fs.chown(p2,isLchown,uid,gid,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.chownSync=function chownSync(p2,isLchown,uid,gid){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.chownSync(p2,isLchown,uid,gid)};LockedFS.prototype.utimes=function utimes(p2,atime,mtime,cb){var this$1=this;this._mu.lock(function(){this$1._fs.utimes(p2,atime,mtime,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.utimesSync=function utimesSync(p2,atime,mtime){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.utimesSync(p2,atime,mtime)};LockedFS.prototype.link=function link(srcpath,dstpath,cb){var this$1=this;this._mu.lock(function(){this$1._fs.link(srcpath,dstpath,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.linkSync=function linkSync(srcpath,dstpath){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.linkSync(srcpath,dstpath)};LockedFS.prototype.symlink=function symlink(srcpath,dstpath,type,cb){var this$1=this;this._mu.lock(function(){this$1._fs.symlink(srcpath,dstpath,type,function(err){this$1._mu.unlock();cb(err)})})};LockedFS.prototype.symlinkSync=function symlinkSync(srcpath,dstpath,type){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.symlinkSync(srcpath,dstpath,type)};LockedFS.prototype.readlink=function readlink(p2,cb){var this$1=this;this._mu.lock(function(){this$1._fs.readlink(p2,function(err,linkString){this$1._mu.unlock();cb(err,linkString)})})};LockedFS.prototype.readlinkSync=function readlinkSync(p2){if(this._mu.isLocked()){throw new Error("invalid sync call")}return this._fs.readlinkSync(p2)};var deletionLogPath="/.deletedFiles.log";function makeModeWritable(mode){return 146|mode}function getFlag(f){return FileFlag.getFileFlag(f)}var OverlayFile=function(PreloadFile$$1){function OverlayFile2(fs4,path$$1,flag,stats,data){PreloadFile$$1.call(this,fs4,path$$1,flag,stats,data)}if(PreloadFile$$1)OverlayFile2.__proto__=PreloadFile$$1;OverlayFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);OverlayFile2.prototype.constructor=OverlayFile2;OverlayFile2.prototype.sync=function sync(cb){var this$1=this;if(!this.isDirty()){cb(null);return}this._fs._syncAsync(this,function(err){this$1.resetDirty();cb(err)})};OverlayFile2.prototype.syncSync=function syncSync(){if(this.isDirty()){this._fs._syncSync(this);this.resetDirty()}};OverlayFile2.prototype.close=function close(cb){this.sync(cb)};OverlayFile2.prototype.closeSync=function closeSync(){this.syncSync()};return OverlayFile2}(PreloadFile);var UnlockedOverlayFS=function(BaseFileSystem$$1){function UnlockedOverlayFS2(writable,readable){BaseFileSystem$$1.call(this);this._isInitialized=false;this._initializeCallbacks=[];this._deletedFiles={};this._deleteLog="";this._deleteLogUpdatePending=false;this._deleteLogUpdateNeeded=false;this._deleteLogError=null;this._writable=writable;this._readable=readable;if(this._writable.isReadOnly()){throw new ApiError(ErrorCode.EINVAL,"Writable file system must be writable.")}}if(BaseFileSystem$$1)UnlockedOverlayFS2.__proto__=BaseFileSystem$$1;UnlockedOverlayFS2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);UnlockedOverlayFS2.prototype.constructor=UnlockedOverlayFS2;UnlockedOverlayFS2.isAvailable=function isAvailable(){return true};UnlockedOverlayFS2.prototype.getOverlayedFileSystems=function getOverlayedFileSystems(){return{readable:this._readable,writable:this._writable}};UnlockedOverlayFS2.prototype._syncAsync=function _syncAsync(file,cb){var this$1=this;this.createParentDirectoriesAsync(file.getPath(),function(err){if(err){return cb(err)}this$1._writable.writeFile(file.getPath(),file.getBuffer(),null,getFlag("w"),file.getStats().mode,cb)})};UnlockedOverlayFS2.prototype._syncSync=function _syncSync(file){this.createParentDirectories(file.getPath());this._writable.writeFileSync(file.getPath(),file.getBuffer(),null,getFlag("w"),file.getStats().mode)};UnlockedOverlayFS2.prototype.getName=function getName(){return OverlayFS.Name};UnlockedOverlayFS2.prototype.initialize=function initialize3(cb){var this$1=this;var callbackArray=this._initializeCallbacks;var end=function(e){this$1._isInitialized=!e;this$1._initializeCallbacks=[];callbackArray.forEach(function(cb2){return cb2(e)})};if(this._isInitialized){return cb()}callbackArray.push(cb);if(callbackArray.length!==1){return}this._writable.readFile(deletionLogPath,"utf8",getFlag("r"),function(err,data){if(err){if(err.errno!==ErrorCode.ENOENT){return end(err)}}else{this$1._deleteLog=data}this$1._reparseDeletionLog();end()})};UnlockedOverlayFS2.prototype.isReadOnly=function isReadOnly(){return false};UnlockedOverlayFS2.prototype.supportsSynch=function supportsSynch(){return this._readable.supportsSynch()&&this._writable.supportsSynch()};UnlockedOverlayFS2.prototype.supportsLinks=function supportsLinks(){return false};UnlockedOverlayFS2.prototype.supportsProps=function supportsProps(){return this._readable.supportsProps()&&this._writable.supportsProps()};UnlockedOverlayFS2.prototype.getDeletionLog=function getDeletionLog(){return this._deleteLog};UnlockedOverlayFS2.prototype.restoreDeletionLog=function restoreDeletionLog(log){this._deleteLog=log;this._reparseDeletionLog();this.updateLog("")};UnlockedOverlayFS2.prototype.rename=function rename(oldPath,newPath,cb){var this$1=this;if(!this.checkInitAsync(cb)||this.checkPathAsync(oldPath,cb)||this.checkPathAsync(newPath,cb)){return}if(oldPath===deletionLogPath||newPath===deletionLogPath){return cb(ApiError.EPERM("Cannot rename deletion log."))}if(oldPath===newPath){return cb()}this.stat(oldPath,false,function(oldErr,oldStats){if(oldErr){return cb(oldErr)}return this$1.stat(newPath,false,function(newErr,newStats){var self2=this$1;function copyDirContents(files){var file=files.shift();if(!file){return cb()}var oldFile=path.resolve(oldPath,file);var newFile=path.resolve(newPath,file);self2.rename(oldFile,newFile,function(err){if(err){return cb(err)}copyDirContents(files)})}var mode=511;if(oldStats.isDirectory()){if(newErr){if(newErr.errno!==ErrorCode.ENOENT){return cb(newErr)}return this$1._writable.exists(oldPath,function(exists2){if(exists2){return this$1._writable.rename(oldPath,newPath,cb)}this$1._writable.mkdir(newPath,mode,function(mkdirErr){if(mkdirErr){return cb(mkdirErr)}this$1._readable.readdir(oldPath,function(err,files){if(err){return cb()}copyDirContents(files)})})})}mode=newStats.mode;if(!newStats.isDirectory()){return cb(ApiError.ENOTDIR(newPath))}this$1.readdir(newPath,function(readdirErr,files){if(files&&files.length){return cb(ApiError.ENOTEMPTY(newPath))}this$1._readable.readdir(oldPath,function(err,files2){if(err){return cb()}copyDirContents(files2)})})}if(newStats&&newStats.isDirectory()){return cb(ApiError.EISDIR(newPath))}this$1.readFile(oldPath,null,getFlag("r"),function(err,data){if(err){return cb(err)}return this$1.writeFile(newPath,data,null,getFlag("w"),oldStats.mode,function(err2){if(err2){return cb(err2)}return this$1.unlink(oldPath,cb)})})})})};UnlockedOverlayFS2.prototype.renameSync=function renameSync(oldPath,newPath){var this$1=this;this.checkInitialized();this.checkPath(oldPath);this.checkPath(newPath);if(oldPath===deletionLogPath||newPath===deletionLogPath){throw ApiError.EPERM("Cannot rename deletion log.")}var oldStats=this.statSync(oldPath,false);if(oldStats.isDirectory()){if(oldPath===newPath){return}var mode=511;if(this.existsSync(newPath)){var stats=this.statSync(newPath,false);mode=stats.mode;if(stats.isDirectory()){if(this.readdirSync(newPath).length>0){throw ApiError.ENOTEMPTY(newPath)}}else{throw ApiError.ENOTDIR(newPath)}}if(this._writable.existsSync(oldPath)){this._writable.renameSync(oldPath,newPath)}else if(!this._writable.existsSync(newPath)){this._writable.mkdirSync(newPath,mode)}if(this._readable.existsSync(oldPath)){this._readable.readdirSync(oldPath).forEach(function(name2){this$1.renameSync(path.resolve(oldPath,name2),path.resolve(newPath,name2))})}}else{if(this.existsSync(newPath)&&this.statSync(newPath,false).isDirectory()){throw ApiError.EISDIR(newPath)}this.writeFileSync(newPath,this.readFileSync(oldPath,null,getFlag("r")),null,getFlag("w"),oldStats.mode)}if(oldPath!==newPath&&this.existsSync(oldPath)){this.unlinkSync(oldPath)}};UnlockedOverlayFS2.prototype.stat=function stat(p2,isLstat,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}this._writable.stat(p2,isLstat,function(err,stat2){if(err&&err.errno===ErrorCode.ENOENT){if(this$1._deletedFiles[p2]){cb(ApiError.ENOENT(p2))}this$1._readable.stat(p2,isLstat,function(err2,stat3){if(stat3){stat3=stat3.clone();stat3.mode=makeModeWritable(stat3.mode)}cb(err2,stat3)})}else{cb(err,stat2)}})};UnlockedOverlayFS2.prototype.statSync=function statSync(p2,isLstat){this.checkInitialized();try{return this._writable.statSync(p2,isLstat)}catch(e){if(this._deletedFiles[p2]){throw ApiError.ENOENT(p2)}var oldStat=this._readable.statSync(p2,isLstat).clone();oldStat.mode=makeModeWritable(oldStat.mode);return oldStat}};UnlockedOverlayFS2.prototype.open=function open(p2,flag,mode,cb){var this$1=this;if(!this.checkInitAsync(cb)||this.checkPathAsync(p2,cb)){return}this.stat(p2,false,function(err,stats){if(stats){switch(flag.pathExistsAction()){case ActionType.TRUNCATE_FILE:return this$1.createParentDirectoriesAsync(p2,function(err2){if(err2){return cb(err2)}this$1._writable.open(p2,flag,mode,cb)});case ActionType.NOP:return this$1._writable.exists(p2,function(exists2){if(exists2){this$1._writable.open(p2,flag,mode,cb)}else{stats=stats.clone();stats.mode=mode;this$1._readable.readFile(p2,null,getFlag("r"),function(readFileErr,data){if(readFileErr){return cb(readFileErr)}if(stats.size===-1){stats.size=data.length}var f=new OverlayFile(this$1,p2,flag,stats,data);cb(null,f)})}});default:return cb(ApiError.EEXIST(p2))}}else{switch(flag.pathNotExistsAction()){case ActionType.CREATE_FILE:return this$1.createParentDirectoriesAsync(p2,function(err2){if(err2){return cb(err2)}return this$1._writable.open(p2,flag,mode,cb)});default:return cb(ApiError.ENOENT(p2))}}})};UnlockedOverlayFS2.prototype.openSync=function openSync(p2,flag,mode){this.checkInitialized();this.checkPath(p2);if(p2===deletionLogPath){throw ApiError.EPERM("Cannot open deletion log.")}if(this.existsSync(p2)){switch(flag.pathExistsAction()){case ActionType.TRUNCATE_FILE:this.createParentDirectories(p2);return this._writable.openSync(p2,flag,mode);case ActionType.NOP:if(this._writable.existsSync(p2)){return this._writable.openSync(p2,flag,mode)}else{var buf=this._readable.readFileSync(p2,null,getFlag("r"));var stats=this._readable.statSync(p2,false).clone();stats.mode=mode;return new OverlayFile(this,p2,flag,stats,buf)}default:throw ApiError.EEXIST(p2)}}else{switch(flag.pathNotExistsAction()){case ActionType.CREATE_FILE:this.createParentDirectories(p2);return this._writable.openSync(p2,flag,mode);default:throw ApiError.ENOENT(p2)}}};UnlockedOverlayFS2.prototype.unlink=function unlink(p2,cb){var this$1=this;if(!this.checkInitAsync(cb)||this.checkPathAsync(p2,cb)){return}this.exists(p2,function(exists2){if(!exists2){return cb(ApiError.ENOENT(p2))}this$1._writable.exists(p2,function(writableExists){if(writableExists){return this$1._writable.unlink(p2,function(err){if(err){return cb(err)}this$1.exists(p2,function(readableExists){if(readableExists){this$1.deletePath(p2)}cb(null)})})}else{this$1.deletePath(p2);cb(null)}})})};UnlockedOverlayFS2.prototype.unlinkSync=function unlinkSync(p2){this.checkInitialized();this.checkPath(p2);if(this.existsSync(p2)){if(this._writable.existsSync(p2)){this._writable.unlinkSync(p2)}if(this.existsSync(p2)){this.deletePath(p2)}}else{throw ApiError.ENOENT(p2)}};UnlockedOverlayFS2.prototype.rmdir=function rmdir(p2,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}var rmdirLower=function(){this$1.readdir(p2,function(err,files){if(err){return cb(err)}if(files.length){return cb(ApiError.ENOTEMPTY(p2))}this$1.deletePath(p2);cb(null)})};this.exists(p2,function(exists2){if(!exists2){return cb(ApiError.ENOENT(p2))}this$1._writable.exists(p2,function(writableExists){if(writableExists){this$1._writable.rmdir(p2,function(err){if(err){return cb(err)}this$1._readable.exists(p2,function(readableExists){if(readableExists){rmdirLower()}else{cb()}})})}else{rmdirLower()}})})};UnlockedOverlayFS2.prototype.rmdirSync=function rmdirSync(p2){this.checkInitialized();if(this.existsSync(p2)){if(this._writable.existsSync(p2)){this._writable.rmdirSync(p2)}if(this.existsSync(p2)){if(this.readdirSync(p2).length>0){throw ApiError.ENOTEMPTY(p2)}else{this.deletePath(p2)}}}else{throw ApiError.ENOENT(p2)}};UnlockedOverlayFS2.prototype.mkdir=function mkdir(p2,mode,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}this.exists(p2,function(exists2){if(exists2){return cb(ApiError.EEXIST(p2))}this$1.createParentDirectoriesAsync(p2,function(err){if(err){return cb(err)}this$1._writable.mkdir(p2,mode,cb)})})};UnlockedOverlayFS2.prototype.mkdirSync=function mkdirSync(p2,mode){this.checkInitialized();if(this.existsSync(p2)){throw ApiError.EEXIST(p2)}else{this.createParentDirectories(p2);this._writable.mkdirSync(p2,mode)}};UnlockedOverlayFS2.prototype.readdir=function readdir(p2,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}this.stat(p2,false,function(err,dirStats){if(err){return cb(err)}if(!dirStats.isDirectory()){return cb(ApiError.ENOTDIR(p2))}this$1._writable.readdir(p2,function(err2,wFiles){if(err2&&err2.code!=="ENOENT"){return cb(err2)}else if(err2||!wFiles){wFiles=[]}this$1._readable.readdir(p2,function(err3,rFiles){if(err3||!rFiles){rFiles=[]}var seenMap={};var filtered=wFiles.concat(rFiles.filter(function(fPath){return!this$1._deletedFiles[p2+"/"+fPath]})).filter(function(fPath){var result=!seenMap[fPath];seenMap[fPath]=true;return result});cb(null,filtered)})})})};UnlockedOverlayFS2.prototype.readdirSync=function readdirSync(p2){var this$1=this;this.checkInitialized();var dirStats=this.statSync(p2,false);if(!dirStats.isDirectory()){throw ApiError.ENOTDIR(p2)}var contents=[];try{contents=contents.concat(this._writable.readdirSync(p2))}catch(e){}try{contents=contents.concat(this._readable.readdirSync(p2).filter(function(fPath){return!this$1._deletedFiles[p2+"/"+fPath]}))}catch(e){}var seenMap={};return contents.filter(function(fileP){var result=!seenMap[fileP];seenMap[fileP]=true;return result})};UnlockedOverlayFS2.prototype.exists=function exists2(p2,cb){var this$1=this;this.checkInitialized();this._writable.exists(p2,function(existsWritable){if(existsWritable){return cb(true)}this$1._readable.exists(p2,function(existsReadable){cb(existsReadable&&this$1._deletedFiles[p2]!==true)})})};UnlockedOverlayFS2.prototype.existsSync=function existsSync(p2){this.checkInitialized();return this._writable.existsSync(p2)||this._readable.existsSync(p2)&&this._deletedFiles[p2]!==true};UnlockedOverlayFS2.prototype.chmod=function chmod(p2,isLchmod,mode,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}this.operateOnWritableAsync(p2,function(err){if(err){return cb(err)}else{this$1._writable.chmod(p2,isLchmod,mode,cb)}})};UnlockedOverlayFS2.prototype.chmodSync=function chmodSync(p2,isLchmod,mode){var this$1=this;this.checkInitialized();this.operateOnWritable(p2,function(){this$1._writable.chmodSync(p2,isLchmod,mode)})};UnlockedOverlayFS2.prototype.chown=function chown(p2,isLchmod,uid,gid,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}this.operateOnWritableAsync(p2,function(err){if(err){return cb(err)}else{this$1._writable.chown(p2,isLchmod,uid,gid,cb)}})};UnlockedOverlayFS2.prototype.chownSync=function chownSync(p2,isLchown,uid,gid){var this$1=this;this.checkInitialized();this.operateOnWritable(p2,function(){this$1._writable.chownSync(p2,isLchown,uid,gid)})};UnlockedOverlayFS2.prototype.utimes=function utimes(p2,atime,mtime,cb){var this$1=this;if(!this.checkInitAsync(cb)){return}this.operateOnWritableAsync(p2,function(err){if(err){return cb(err)}else{this$1._writable.utimes(p2,atime,mtime,cb)}})};UnlockedOverlayFS2.prototype.utimesSync=function utimesSync(p2,atime,mtime){var this$1=this;this.checkInitialized();this.operateOnWritable(p2,function(){this$1._writable.utimesSync(p2,atime,mtime)})};UnlockedOverlayFS2.prototype.deletePath=function deletePath(p2){this._deletedFiles[p2]=true;this.updateLog("d"+p2+"\\n")};UnlockedOverlayFS2.prototype.updateLog=function updateLog(addition){var this$1=this;this._deleteLog+=addition;if(this._deleteLogUpdatePending){this._deleteLogUpdateNeeded=true}else{this._deleteLogUpdatePending=true;this._writable.writeFile(deletionLogPath,this._deleteLog,"utf8",FileFlag.getFileFlag("w"),420,function(e){this$1._deleteLogUpdatePending=false;if(e){this$1._deleteLogError=e}else if(this$1._deleteLogUpdateNeeded){this$1._deleteLogUpdateNeeded=false;this$1.updateLog("")}})}};UnlockedOverlayFS2.prototype._reparseDeletionLog=function _reparseDeletionLog(){var this$1=this;this._deletedFiles={};this._deleteLog.split("\\n").forEach(function(path$$1){this$1._deletedFiles[path$$1.slice(1)]=path$$1.slice(0,1)==="d"})};UnlockedOverlayFS2.prototype.checkInitialized=function checkInitialized(){if(!this._isInitialized){throw new ApiError(ErrorCode.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")}else if(this._deleteLogError!==null){var e=this._deleteLogError;this._deleteLogError=null;throw e}};UnlockedOverlayFS2.prototype.checkInitAsync=function checkInitAsync(cb){if(!this._isInitialized){cb(new ApiError(ErrorCode.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it."));return false}else if(this._deleteLogError!==null){var e=this._deleteLogError;this._deleteLogError=null;cb(e);return false}return true};UnlockedOverlayFS2.prototype.checkPath=function checkPath(p2){if(p2===deletionLogPath){throw ApiError.EPERM(p2)}};UnlockedOverlayFS2.prototype.checkPathAsync=function checkPathAsync(p2,cb){if(p2===deletionLogPath){cb(ApiError.EPERM(p2));return true}return false};UnlockedOverlayFS2.prototype.createParentDirectoriesAsync=function createParentDirectoriesAsync(p2,cb){var parent=path.dirname(p2);var toCreate=[];var self2=this;this._writable.stat(parent,false,statDone);function statDone(err,stat){if(err){toCreate.push(parent);parent=path.dirname(parent);self2._writable.stat(parent,false,statDone)}else{createParents()}}function createParents(){if(!toCreate.length){return cb()}var dir=toCreate.pop();self2._readable.stat(dir,false,function(err,stats){if(!stats){return cb()}self2._writable.mkdir(dir,stats.mode,function(err2){if(err2){return cb(err2)}createParents()})})}};UnlockedOverlayFS2.prototype.createParentDirectories=function createParentDirectories(p2){var this$1=this;var parent=path.dirname(p2),toCreate=[];while(!this._writable.existsSync(parent)){toCreate.push(parent);parent=path.dirname(parent)}toCreate=toCreate.reverse();toCreate.forEach(function(p22){this$1._writable.mkdirSync(p22,this$1.statSync(p22,false).mode)})};UnlockedOverlayFS2.prototype.operateOnWritable=function operateOnWritable(p2,f){if(this.existsSync(p2)){if(!this._writable.existsSync(p2)){this.copyToWritable(p2)}f()}else{throw ApiError.ENOENT(p2)}};UnlockedOverlayFS2.prototype.operateOnWritableAsync=function operateOnWritableAsync(p2,cb){var this$1=this;this.exists(p2,function(exists2){if(!exists2){return cb(ApiError.ENOENT(p2))}this$1._writable.exists(p2,function(existsWritable){if(existsWritable){cb()}else{return this$1.copyToWritableAsync(p2,cb)}})})};UnlockedOverlayFS2.prototype.copyToWritable=function copyToWritable(p2){var pStats=this.statSync(p2,false);if(pStats.isDirectory()){this._writable.mkdirSync(p2,pStats.mode)}else{this.writeFileSync(p2,this._readable.readFileSync(p2,null,getFlag("r")),null,getFlag("w"),this.statSync(p2,false).mode)}};UnlockedOverlayFS2.prototype.copyToWritableAsync=function copyToWritableAsync(p2,cb){var this$1=this;this.stat(p2,false,function(err,pStats){if(err){return cb(err)}if(pStats.isDirectory()){return this$1._writable.mkdir(p2,pStats.mode,cb)}this$1._readable.readFile(p2,null,getFlag("r"),function(err2,data){if(err2){return cb(err2)}this$1.writeFile(p2,data,null,getFlag("w"),pStats.mode,cb)})})};return UnlockedOverlayFS2}(BaseFileSystem);var OverlayFS=function(LockedFS$$1){function OverlayFS2(writable,readable,deprecateMsg){if(deprecateMsg===void 0)deprecateMsg=true;LockedFS$$1.call(this,new UnlockedOverlayFS(writable,readable));deprecationMessage(deprecateMsg,OverlayFS2.Name,{readable:"readable file system",writable:"writable file system"})}if(LockedFS$$1)OverlayFS2.__proto__=LockedFS$$1;OverlayFS2.prototype=Object.create(LockedFS$$1&&LockedFS$$1.prototype);OverlayFS2.prototype.constructor=OverlayFS2;OverlayFS2.Create=function Create(opts,cb){try{var fs4=new OverlayFS2(opts.writable,opts.readable,false);fs4.initialize(function(e){cb(e,fs4)},false)}catch(e){cb(e)}};OverlayFS2.isAvailable=function isAvailable(){return UnlockedOverlayFS.isAvailable()};OverlayFS2.prototype.initialize=function initialize3(cb,deprecateMsg){if(deprecateMsg===void 0)deprecateMsg=true;if(deprecateMsg){console.warn("[OverlayFS] OverlayFS.initialize() is deprecated and will be removed in the next major release. Please use \'OverlayFS.Create({readable: readable file system instance, writable: writable file system instance}, cb)\' to create and initialize OverlayFS instances.")}LockedFS$$1.prototype.initialize.call(this,cb)};OverlayFS2.prototype.getOverlayedFileSystems=function getOverlayedFileSystems(){return LockedFS$$1.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()};OverlayFS2.prototype.unwrap=function unwrap(){return LockedFS$$1.prototype.getFSUnlocked.call(this)};return OverlayFS2}(LockedFS);OverlayFS.Name="OverlayFS";OverlayFS.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}};var SpecialArgType;(function(SpecialArgType2){SpecialArgType2[SpecialArgType2["CB"]=0]="CB";SpecialArgType2[SpecialArgType2["FD"]=1]="FD";SpecialArgType2[SpecialArgType2["API_ERROR"]=2]="API_ERROR";SpecialArgType2[SpecialArgType2["STATS"]=3]="STATS";SpecialArgType2[SpecialArgType2["PROBE"]=4]="PROBE";SpecialArgType2[SpecialArgType2["FILEFLAG"]=5]="FILEFLAG";SpecialArgType2[SpecialArgType2["BUFFER"]=6]="BUFFER";SpecialArgType2[SpecialArgType2["ERROR"]=7]="ERROR"})(SpecialArgType||(SpecialArgType={}));var CallbackArgumentConverter=function CallbackArgumentConverter2(){this._callbacks={};this._nextId=0};CallbackArgumentConverter.prototype.toRemoteArg=function toRemoteArg(cb){var id=this._nextId++;this._callbacks[id]=cb;return{type:SpecialArgType.CB,id}};CallbackArgumentConverter.prototype.toLocalArg=function toLocalArg(id){var cb=this._callbacks[id];delete this._callbacks[id];return cb};var FileDescriptorArgumentConverter=function FileDescriptorArgumentConverter2(){this._fileDescriptors={};this._nextId=0};FileDescriptorArgumentConverter.prototype.toRemoteArg=function toRemoteArg(fd,p2,flag,cb){var id=this._nextId++;var data;var stat;this._fileDescriptors[id]=fd;fd.stat(function(err,stats){if(err){cb(err)}else{stat=bufferToTransferrableObject(stats.toBuffer());if(flag.isReadable()){fd.read(Buffer2.alloc(stats.size),0,stats.size,0,function(err2,bytesRead,buff){if(err2){cb(err2)}else{data=bufferToTransferrableObject(buff);cb(null,{type:SpecialArgType.FD,id,data,stat,path:p2,flag:flag.getFlagString()})}})}else{cb(null,{type:SpecialArgType.FD,id,data:new ArrayBuffer(0),stat,path:p2,flag:flag.getFlagString()})}}})};FileDescriptorArgumentConverter.prototype.applyFdAPIRequest=function applyFdAPIRequest(request,cb){var this$1=this;var fdArg=request.args[0];this._applyFdChanges(fdArg,function(err,fd){if(err){cb(err)}else{fd[request.method](function(e){if(request.method==="close"){delete this$1._fileDescriptors[fdArg.id]}cb(e)})}})};FileDescriptorArgumentConverter.prototype._applyFdChanges=function _applyFdChanges(remoteFd,cb){var fd=this._fileDescriptors[remoteFd.id],data=transferrableObjectToBuffer(remoteFd.data),remoteStats=Stats.fromBuffer(transferrableObjectToBuffer(remoteFd.stat));var flag=FileFlag.getFileFlag(remoteFd.flag);if(flag.isWriteable()){fd.write(data,0,data.length,flag.isAppendable()?fd.getPos():0,function(e){function applyStatChanges(){fd.stat(function(e2,stats){if(e2){cb(e2)}else{if(stats.mode!==remoteStats.mode){fd.chmod(remoteStats.mode,function(e3){cb(e3,fd)})}else{cb(e2,fd)}}})}if(e){cb(e)}else{if(!flag.isAppendable()){fd.truncate(data.length,function(){applyStatChanges()})}else{applyStatChanges()}}})}else{cb(null,fd)}};function apiErrorLocal2Remote(e){return{type:SpecialArgType.API_ERROR,errorData:bufferToTransferrableObject(e.writeToBuffer())}}function apiErrorRemote2Local(e){return ApiError.fromBuffer(transferrableObjectToBuffer(e.errorData))}function errorLocal2Remote(e){return{type:SpecialArgType.ERROR,name:e.name,message:e.message,stack:e.stack}}function errorRemote2Local(e){var cnstr=global$1[e.name];if(typeof cnstr!=="function"){cnstr=Error}var err=new cnstr(e.message);err.stack=e.stack;return err}function statsLocal2Remote(stats){return{type:SpecialArgType.STATS,statsData:bufferToTransferrableObject(stats.toBuffer())}}function statsRemote2Local(stats){return Stats.fromBuffer(transferrableObjectToBuffer(stats.statsData))}function fileFlagLocal2Remote(flag){return{type:SpecialArgType.FILEFLAG,flagStr:flag.getFlagString()}}function fileFlagRemote2Local(remoteFlag){return FileFlag.getFileFlag(remoteFlag.flagStr)}function bufferToTransferrableObject(buff){return buffer2ArrayBuffer(buff)}function transferrableObjectToBuffer(buff){return arrayBuffer2Buffer(buff)}function bufferLocal2Remote(buff){return{type:SpecialArgType.BUFFER,data:bufferToTransferrableObject(buff)}}function bufferRemote2Local(buffArg){return transferrableObjectToBuffer(buffArg.data)}function isAPIRequest(data){return data&&typeof data==="object"&&data.hasOwnProperty("browserfsMessage")&&data["browserfsMessage"]}function isAPIResponse(data){return data&&typeof data==="object"&&data.hasOwnProperty("browserfsMessage")&&data["browserfsMessage"]}var WorkerFile=function(PreloadFile$$1){function WorkerFile2(_fs,_path,_flag,_stat,remoteFdId,contents){PreloadFile$$1.call(this,_fs,_path,_flag,_stat,contents);this._remoteFdId=remoteFdId}if(PreloadFile$$1)WorkerFile2.__proto__=PreloadFile$$1;WorkerFile2.prototype=Object.create(PreloadFile$$1&&PreloadFile$$1.prototype);WorkerFile2.prototype.constructor=WorkerFile2;WorkerFile2.prototype.getRemoteFdId=function getRemoteFdId(){return this._remoteFdId};WorkerFile2.prototype.toRemoteArg=function toRemoteArg(){return{type:SpecialArgType.FD,id:this._remoteFdId,data:bufferToTransferrableObject(this.getBuffer()),stat:bufferToTransferrableObject(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}};WorkerFile2.prototype.sync=function sync(cb){this._syncClose("sync",cb)};WorkerFile2.prototype.close=function close(cb){this._syncClose("close",cb)};WorkerFile2.prototype._syncClose=function _syncClose(type,cb){var this$1=this;if(this.isDirty()){this._fs.syncClose(type,this,function(e){if(!e){this$1.resetDirty()}cb(e)})}else{cb()}};return WorkerFile2}(PreloadFile);var WorkerFS=function(BaseFileSystem$$1){function WorkerFS2(worker,deprecateMsg){var this$1=this;if(deprecateMsg===void 0)deprecateMsg=true;BaseFileSystem$$1.call(this);this._callbackConverter=new CallbackArgumentConverter;this._isInitialized=false;this._isReadOnly=false;this._supportLinks=false;this._supportProps=false;this._worker=worker;deprecationMessage(deprecateMsg,WorkerFS2.Name,{worker:"Web Worker instance"});this._worker.addEventListener("message",function(e){var resp=e.data;if(isAPIResponse(resp)){var i22;var args=resp.args;var fixedArgs=new Array(args.length);for(i22=0;i22<fixedArgs.length;i22++){fixedArgs[i22]=this$1._argRemote2Local(args[i22])}this$1._callbackConverter.toLocalArg(resp.cbId).apply(null,fixedArgs)}})}if(BaseFileSystem$$1)WorkerFS2.__proto__=BaseFileSystem$$1;WorkerFS2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);WorkerFS2.prototype.constructor=WorkerFS2;WorkerFS2.Create=function Create(opts,cb){var fs4=new WorkerFS2(opts.worker,false);fs4.initialize(function(){cb(null,fs4)})};WorkerFS2.isAvailable=function isAvailable(){return typeof importScripts!=="undefined"||typeof Worker!=="undefined"};WorkerFS2.attachRemoteListener=function attachRemoteListener(worker){var fdConverter=new FileDescriptorArgumentConverter;function argLocal2Remote(arg,requestArgs,cb){switch(typeof arg){case"object":if(arg instanceof Stats){cb(null,statsLocal2Remote(arg))}else if(arg instanceof ApiError){cb(null,apiErrorLocal2Remote(arg))}else if(arg instanceof BaseFile){cb(null,fdConverter.toRemoteArg(arg,requestArgs[0],requestArgs[1],cb))}else if(arg instanceof FileFlag){cb(null,fileFlagLocal2Remote(arg))}else if(arg instanceof Buffer2){cb(null,bufferLocal2Remote(arg))}else if(arg instanceof Error){cb(null,errorLocal2Remote(arg))}else{cb(null,arg)}break;default:cb(null,arg);break}}function argRemote2Local(arg,fixedRequestArgs){if(!arg){return arg}switch(typeof arg){case"object":if(typeof arg["type"]==="number"){var specialArg=arg;switch(specialArg.type){case SpecialArgType.CB:var cbId=arg.id;return function(){var arguments$1=arguments;var i22;var fixedArgs=new Array(arguments.length);var message,countdown=arguments.length;function abortAndSendError(err){if(countdown>0){countdown=-1;message={browserfsMessage:true,cbId,args:[apiErrorLocal2Remote(err)]};worker.postMessage(message)}}for(i22=0;i22<arguments.length;i22++){(function(i32,arg2){argLocal2Remote(arg2,fixedRequestArgs,function(err,fixedArg){fixedArgs[i32]=fixedArg;if(err){abortAndSendError(err)}else if(--countdown===0){message={browserfsMessage:true,cbId,args:fixedArgs};worker.postMessage(message)}})})(i22,arguments$1[i22])}if(arguments.length===0){message={browserfsMessage:true,cbId,args:fixedArgs};worker.postMessage(message)}};case SpecialArgType.API_ERROR:return apiErrorRemote2Local(specialArg);case SpecialArgType.STATS:return statsRemote2Local(specialArg);case SpecialArgType.FILEFLAG:return fileFlagRemote2Local(specialArg);case SpecialArgType.BUFFER:return bufferRemote2Local(specialArg);case SpecialArgType.ERROR:return errorRemote2Local(specialArg);default:return arg}}else{return arg}default:return arg}}worker.addEventListener("message",function(e){var request=e.data;if(isAPIRequest(request)){var args=request.args,fixedArgs=new Array(args.length);switch(request.method){case"close":case"sync":(function(){var remoteCb=args[1];fdConverter.applyFdAPIRequest(request,function(err){var response={browserfsMessage:true,cbId:remoteCb.id,args:err?[apiErrorLocal2Remote(err)]:[]};worker.postMessage(response)})})();break;case"probe":(function(){var rootFs=_fsMock.getRootFS(),remoteCb=args[1],probeResponse={type:SpecialArgType.PROBE,isReadOnly:rootFs.isReadOnly(),supportsLinks:rootFs.supportsLinks(),supportsProps:rootFs.supportsProps()},response={browserfsMessage:true,cbId:remoteCb.id,args:[probeResponse]};worker.postMessage(response)})();break;default:for(var i22=0;i22<args.length;i22++){fixedArgs[i22]=argRemote2Local(args[i22],fixedArgs)}var rootFS=_fsMock.getRootFS();rootFS[request.method].apply(rootFS,fixedArgs);break}}})};WorkerFS2.prototype.getName=function getName(){return WorkerFS2.Name};WorkerFS2.prototype.initialize=function initialize3(cb){var this$1=this;if(!this._isInitialized){var message={browserfsMessage:true,method:"probe",args:[this._argLocal2Remote(emptyBuffer()),this._callbackConverter.toRemoteArg(function(probeResponse){this$1._isInitialized=true;this$1._isReadOnly=probeResponse.isReadOnly;this$1._supportLinks=probeResponse.supportsLinks;this$1._supportProps=probeResponse.supportsProps;cb()})]};this._worker.postMessage(message)}else{cb()}};WorkerFS2.prototype.isReadOnly=function isReadOnly(){return this._isReadOnly};WorkerFS2.prototype.supportsSynch=function supportsSynch(){return false};WorkerFS2.prototype.supportsLinks=function supportsLinks(){return this._supportLinks};WorkerFS2.prototype.supportsProps=function supportsProps(){return this._supportProps};WorkerFS2.prototype.rename=function rename(oldPath,newPath,cb){this._rpc("rename",arguments)};WorkerFS2.prototype.stat=function stat(p2,isLstat,cb){this._rpc("stat",arguments)};WorkerFS2.prototype.open=function open(p2,flag,mode,cb){this._rpc("open",arguments)};WorkerFS2.prototype.unlink=function unlink(p2,cb){this._rpc("unlink",arguments)};WorkerFS2.prototype.rmdir=function rmdir(p2,cb){this._rpc("rmdir",arguments)};WorkerFS2.prototype.mkdir=function mkdir(p2,mode,cb){this._rpc("mkdir",arguments)};WorkerFS2.prototype.readdir=function readdir(p2,cb){this._rpc("readdir",arguments)};WorkerFS2.prototype.exists=function exists2(p2,cb){this._rpc("exists",arguments)};WorkerFS2.prototype.realpath=function realpath(p2,cache,cb){this._rpc("realpath",arguments)};WorkerFS2.prototype.truncate=function truncate(p2,len,cb){this._rpc("truncate",arguments)};WorkerFS2.prototype.readFile=function readFile2(fname,encoding,flag,cb){this._rpc("readFile",arguments)};WorkerFS2.prototype.writeFile=function writeFile2(fname,data,encoding,flag,mode,cb){this._rpc("writeFile",arguments)};WorkerFS2.prototype.appendFile=function appendFile3(fname,data,encoding,flag,mode,cb){this._rpc("appendFile",arguments)};WorkerFS2.prototype.chmod=function chmod(p2,isLchmod,mode,cb){this._rpc("chmod",arguments)};WorkerFS2.prototype.chown=function chown(p2,isLchown,uid,gid,cb){this._rpc("chown",arguments)};WorkerFS2.prototype.utimes=function utimes(p2,atime,mtime,cb){this._rpc("utimes",arguments)};WorkerFS2.prototype.link=function link(srcpath,dstpath,cb){this._rpc("link",arguments)};WorkerFS2.prototype.symlink=function symlink(srcpath,dstpath,type,cb){this._rpc("symlink",arguments)};WorkerFS2.prototype.readlink=function readlink(p2,cb){this._rpc("readlink",arguments)};WorkerFS2.prototype.syncClose=function syncClose(method,fd,cb){this._worker.postMessage({browserfsMessage:true,method,args:[fd.toRemoteArg(),this._callbackConverter.toRemoteArg(cb)]})};WorkerFS2.prototype._argRemote2Local=function _argRemote2Local(arg){if(!arg){return arg}switch(typeof arg){case"object":if(typeof arg["type"]==="number"){var specialArg=arg;switch(specialArg.type){case SpecialArgType.API_ERROR:return apiErrorRemote2Local(specialArg);case SpecialArgType.FD:var fdArg=specialArg;return new WorkerFile(this,fdArg.path,FileFlag.getFileFlag(fdArg.flag),Stats.fromBuffer(transferrableObjectToBuffer(fdArg.stat)),fdArg.id,transferrableObjectToBuffer(fdArg.data));case SpecialArgType.STATS:return statsRemote2Local(specialArg);case SpecialArgType.FILEFLAG:return fileFlagRemote2Local(specialArg);case SpecialArgType.BUFFER:return bufferRemote2Local(specialArg);case SpecialArgType.ERROR:return errorRemote2Local(specialArg);default:return arg}}else{return arg}default:return arg}};WorkerFS2.prototype._rpc=function _rpc(methodName,args){var this$1=this;var fixedArgs=new Array(args.length);for(var i22=0;i22<args.length;i22++){fixedArgs[i22]=this$1._argLocal2Remote(args[i22])}var message={browserfsMessage:true,method:methodName,args:fixedArgs};this._worker.postMessage(message)};WorkerFS2.prototype._argLocal2Remote=function _argLocal2Remote(arg){if(!arg){return arg}switch(typeof arg){case"object":if(arg instanceof Stats){return statsLocal2Remote(arg)}else if(arg instanceof ApiError){return apiErrorLocal2Remote(arg)}else if(arg instanceof WorkerFile){return arg.toRemoteArg()}else if(arg instanceof FileFlag){return fileFlagLocal2Remote(arg)}else if(arg instanceof Buffer2){return bufferLocal2Remote(arg)}else if(arg instanceof Error){return errorLocal2Remote(arg)}else{return"Unknown argument"}case"function":return this._callbackConverter.toRemoteArg(arg);default:return arg}};return WorkerFS2}(BaseFileSystem);WorkerFS.Name="WorkerFS";WorkerFS.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(v2,cb){if(v2["postMessage"]){cb()}else{cb(new ApiError(ErrorCode.EINVAL,"option must be a Web Worker instance."))}}}};function asyncDownloadFileModern(p2,type,cb){var req=new XMLHttpRequest;req.open("GET",p2,true);var jsonSupported=true;switch(type){case"buffer":req.responseType="arraybuffer";break;case"json":try{req.responseType="json";jsonSupported=req.responseType==="json"}catch(e){jsonSupported=false}break;default:return cb(new ApiError(ErrorCode.EINVAL,"Invalid download type: "+type))}req.onreadystatechange=function(e){if(req.readyState===4){if(req.status===200){switch(type){case"buffer":return cb(null,req.response?Buffer2.from(req.response):emptyBuffer());case"json":if(jsonSupported){return cb(null,req.response)}else{return cb(null,JSON.parse(req.responseText))}}}else{return cb(new ApiError(req.status,"XHR error."))}}};req.send()}function syncDownloadFileModern(p2,type){var req=new XMLHttpRequest;req.open("GET",p2,false);var data=null;var err=null;req.overrideMimeType("text/plain; charset=x-user-defined");req.onreadystatechange=function(e){if(req.readyState===4){if(req.status===200){switch(type){case"buffer":var text=req.responseText;data=Buffer2.alloc(text.length);for(var i22=0;i22<text.length;i22++){data[i22]=text.charCodeAt(i22)}return;case"json":data=JSON.parse(req.responseText);return}}else{err=new ApiError(req.status,"XHR error.");return}}};req.send();if(err){throw err}return data}function syncDownloadFileIE10(p2,type){var req=new XMLHttpRequest;req.open("GET",p2,false);switch(type){case"buffer":req.responseType="arraybuffer";break;case"json":break;default:throw new ApiError(ErrorCode.EINVAL,"Invalid download type: "+type)}var data;var err;req.onreadystatechange=function(e){if(req.readyState===4){if(req.status===200){switch(type){case"buffer":data=Buffer2.from(req.response);break;case"json":data=JSON.parse(req.response);break}}else{err=new ApiError(req.status,"XHR error.")}}};req.send();if(err){throw err}return data}function getFileSize2(async,p2,cb){var req=new XMLHttpRequest;req.open("HEAD",p2,async);req.onreadystatechange=function(e){if(req.readyState===4){if(req.status===200){try{return cb(null,parseInt(req.getResponseHeader("Content-Length")||"-1",10))}catch(e2){return cb(new ApiError(ErrorCode.EIO,"XHR HEAD error: Could not read content-length."))}}else{return cb(new ApiError(req.status,"XHR HEAD error."))}}};req.send()}var asyncDownloadFile=asyncDownloadFileModern;var syncDownloadFile=isIE&&typeof Blob!=="undefined"?syncDownloadFileIE10:syncDownloadFileModern;function getFileSizeSync(p2){var rv=-1;getFileSize2(false,p2,function(err,size){if(err){throw err}rv=size});return rv}function getFileSizeAsync(p2,cb){getFileSize2(true,p2,cb)}var FileIndex=function FileIndex2(){this._index={};this.addPath("/",new DirInode)};FileIndex.fromListing=function fromListing(listing){var idx=new FileIndex;var rootInode=new DirInode;idx._index["/"]=rootInode;var queue=[["",listing,rootInode]];while(queue.length>0){var inode=void 0;var next=queue.pop();var pwd=next[0];var tree=next[1];var parent=next[2];for(var node in tree){if(tree.hasOwnProperty(node)){var children=tree[node];var name2=pwd+"/"+node;if(children){idx._index[name2]=inode=new DirInode;queue.push([name2,children,inode])}else{inode=new FileInode(new Stats(FileType.FILE,-1,365))}if(parent){parent._ls[node]=inode}}}}return idx};FileIndex.prototype.fileIterator=function fileIterator(cb){var this$1=this;for(var path$$1 in this$1._index){if(this$1._index.hasOwnProperty(path$$1)){var dir=this$1._index[path$$1];var files=dir.getListing();for(var i22=0,list2=files;i22<list2.length;i22+=1){var file=list2[i22];var item=dir.getItem(file);if(isFileInode(item)){cb(item.getData())}}}}};FileIndex.prototype.addPath=function addPath(path$$1,inode){if(!inode){throw new Error("Inode must be specified")}if(path$$1[0]!=="/"){throw new Error("Path must be absolute, got: "+path$$1)}if(this._index.hasOwnProperty(path$$1)){return this._index[path$$1]===inode}var splitPath=this._split_path(path$$1);var dirpath=splitPath[0];var itemname=splitPath[1];var parent=this._index[dirpath];if(parent===void 0&&path$$1!=="/"){parent=new DirInode;if(!this.addPath(dirpath,parent)){return false}}if(path$$1!=="/"){if(!parent.addItem(itemname,inode)){return false}}if(isDirInode(inode)){this._index[path$$1]=inode}return true};FileIndex.prototype.addPathFast=function addPathFast(path$$1,inode){var itemNameMark=path$$1.lastIndexOf("/");var parentPath=itemNameMark===0?"/":path$$1.substring(0,itemNameMark);var itemName=path$$1.substring(itemNameMark+1);var parent=this._index[parentPath];if(parent===void 0){parent=new DirInode;this.addPathFast(parentPath,parent)}if(!parent.addItem(itemName,inode)){return false}if(inode.isDir()){this._index[path$$1]=inode}return true};FileIndex.prototype.removePath=function removePath(path$$1){var this$1=this;var splitPath=this._split_path(path$$1);var dirpath=splitPath[0];var itemname=splitPath[1];var parent=this._index[dirpath];if(parent===void 0){return null}var inode=parent.remItem(itemname);if(inode===null){return null}if(isDirInode(inode)){var children=inode.getListing();for(var i22=0,list2=children;i22<list2.length;i22+=1){var child=list2[i22];this$1.removePath(path$$1+"/"+child)}if(path$$1!=="/"){delete this._index[path$$1]}}return inode};FileIndex.prototype.ls=function ls(path$$1){var item=this._index[path$$1];if(item===void 0){return null}return item.getListing()};FileIndex.prototype.getInode=function getInode(path$$1){var splitPath=this._split_path(path$$1);var dirpath=splitPath[0];var itemname=splitPath[1];var parent=this._index[dirpath];if(parent===void 0){return null}if(dirpath===path$$1){return parent}return parent.getItem(itemname)};FileIndex.prototype._split_path=function _split_path(p2){var dirpath=path.dirname(p2);var itemname=p2.substr(dirpath.length+(dirpath==="/"?0:1));return[dirpath,itemname]};var FileInode=function FileInode2(data){this.data=data};FileInode.prototype.isFile=function isFile(){return true};FileInode.prototype.isDir=function isDir(){return false};FileInode.prototype.getData=function getData(){return this.data};FileInode.prototype.setData=function setData(data){this.data=data};var DirInode=function DirInode2(data){if(data===void 0)data=null;this.data=data;this._ls={}};DirInode.prototype.isFile=function isFile(){return false};DirInode.prototype.isDir=function isDir(){return true};DirInode.prototype.getData=function getData(){return this.data};DirInode.prototype.getStats=function getStats(){return new Stats(FileType.DIRECTORY,4096,365)};DirInode.prototype.getListing=function getListing(){return Object.keys(this._ls)};DirInode.prototype.getItem=function getItem(p2){var item=this._ls[p2];return item?item:null};DirInode.prototype.addItem=function addItem(p2,inode){if(p2 in this._ls){return false}this._ls[p2]=inode;return true};DirInode.prototype.remItem=function remItem(p2){var item=this._ls[p2];if(item===void 0){return null}delete this._ls[p2];return item};function isFileInode(inode){return!!inode&&inode.isFile()}function isDirInode(inode){return!!inode&&inode.isDir()}function tryToString(buff,encoding,cb){try{cb(null,buff.toString(encoding))}catch(e){cb(e)}}var XmlHttpRequest=function(BaseFileSystem$$1){function XmlHttpRequest2(listingUrlOrObj,prefixUrl,deprecateMsg){if(prefixUrl===void 0)prefixUrl="";if(deprecateMsg===void 0)deprecateMsg=true;BaseFileSystem$$1.call(this);if(!listingUrlOrObj){listingUrlOrObj="index.json"}if(prefixUrl.length>0&&prefixUrl.charAt(prefixUrl.length-1)!=="/"){prefixUrl=prefixUrl+"/"}this.prefixUrl=prefixUrl;var listing=null;if(typeof listingUrlOrObj==="string"){listing=this._requestFileSync(listingUrlOrObj,"json");if(!listing){throw new Error("Unable to find listing at URL: ${listingUrlOrObj}")}}else{listing=listingUrlOrObj}deprecationMessage(deprecateMsg,XmlHttpRequest2.Name,{index:typeof listingUrlOrObj==="string"?listingUrlOrObj:"file index as an object",baseUrl:prefixUrl});this._index=FileIndex.fromListing(listing)}if(BaseFileSystem$$1)XmlHttpRequest2.__proto__=BaseFileSystem$$1;XmlHttpRequest2.prototype=Object.create(BaseFileSystem$$1&&BaseFileSystem$$1.prototype);XmlHttpRequest2.prototype.constructor=XmlHttpRequest2;XmlHttpRequest2.Create=function Create(opts,cb){if(opts.index===void 0){opts.index="index.json"}if(typeof opts.index==="string"){XmlHttpRequest2.FromURL(opts.index,cb,opts.baseUrl,false)}else{cb(null,new XmlHttpRequest2(opts.index,opts.baseUrl,false))}};XmlHttpRequest2.isAvailable=function isAvailable(){return typeof XMLHttpRequest!=="undefined"&&XMLHttpRequest!==null};XmlHttpRequest2.FromURL=function FromURL(url2,cb,baseUrl,deprecateMsg){if(baseUrl===void 0)baseUrl=url2.slice(0,url2.lastIndexOf("/")+1);if(deprecateMsg===void 0)deprecateMsg=true;if(deprecateMsg){console.warn(`[XmlHttpRequest] XmlHttpRequest.FromURL() is deprecated and will be removed in the next major release. Please use \'XmlHttpRequest.Create({ index: "`+url2+\'", baseUrl: "\'+baseUrl+`" }, cb)\' instead.`)}asyncDownloadFile(url2,"json",function(e,data){if(e){cb(e)}else{cb(null,new XmlHttpRequest2(data,baseUrl,false))}})};XmlHttpRequest2.prototype.empty=function empty(){this._index.fileIterator(function(file){file.fileData=null})};XmlHttpRequest2.prototype.getName=function getName(){return XmlHttpRequest2.Name};XmlHttpRequest2.prototype.diskSpace=function diskSpace(path$$1,cb){cb(0,0)};XmlHttpRequest2.prototype.isReadOnly=function isReadOnly(){return true};XmlHttpRequest2.prototype.supportsLinks=function supportsLinks(){return false};XmlHttpRequest2.prototype.supportsProps=function supportsProps(){return false};XmlHttpRequest2.prototype.supportsSynch=function supportsSynch(){return true};XmlHttpRequest2.prototype.preloadFile=function preloadFile(path$$1,buffer$$1){var inode=this._index.getInode(path$$1);if(isFileInode(inode)){if(inode===null){throw ApiError.ENOENT(path$$1)}var stats=inode.getData();stats.size=buffer$$1.length;stats.fileData=buffer$$1}else{throw ApiError.EISDIR(path$$1)}};XmlHttpRequest2.prototype.stat=function stat(path$$1,isLstat,cb){var inode=this._index.getInode(path$$1);if(inode===null){return cb(ApiError.ENOENT(path$$1))}var stats;if(isFileInode(inode)){stats=inode.getData();if(stats.size<0){this._requestFileSizeAsync(path$$1,function(e,size){if(e){return cb(e)}stats.size=size;cb(null,stats.clone())})}else{cb(null,stats.clone())}}else if(isDirInode(inode)){stats=inode.getStats();cb(null,stats)}else{cb(ApiError.FileError(ErrorCode.EINVAL,path$$1))}};XmlHttpRequest2.prototype.statSync=function statSync(path$$1,isLstat){var inode=this._index.getInode(path$$1);if(inode===null){throw ApiError.ENOENT(path$$1)}var stats;if(isFileInode(inode)){stats=inode.getData();if(stats.size<0){stats.size=this._requestFileSizeSync(path$$1)}}else if(isDirInode(inode)){stats=inode.getStats()}else{throw ApiError.FileError(ErrorCode.EINVAL,path$$1)}return stats};XmlHttpRequest2.prototype.open=function open(path$$1,flags,mode,cb){if(flags.isWriteable()){return cb(new ApiError(ErrorCode.EPERM,path$$1))}var self2=this;var inode=this._index.getInode(path$$1);if(inode===null){return cb(ApiError.ENOENT(path$$1))}if(isFileInode(inode)){var stats=inode.getData();switch(flags.pathExistsAction()){case ActionType.THROW_EXCEPTION:case ActionType.TRUNCATE_FILE:return cb(ApiError.EEXIST(path$$1));case ActionType.NOP:if(stats.fileData){return cb(null,new NoSyncFile(self2,path$$1,flags,stats.clone(),stats.fileData))}this._requestFileAsync(path$$1,"buffer",function(err,buffer$$1){if(err){return cb(err)}stats.size=buffer$$1.length;stats.fileData=buffer$$1;return cb(null,new NoSyncFile(self2,path$$1,flags,stats.clone(),buffer$$1))});break;default:return cb(new ApiError(ErrorCode.EINVAL,"Invalid FileMode object."))}}else{return cb(ApiError.EISDIR(path$$1))}};XmlHttpRequest2.prototype.openSync=function openSync(path$$1,flags,mode){if(flags.isWriteable()){throw new ApiError(ErrorCode.EPERM,path$$1)}var inode=this._index.getInode(path$$1);if(inode===null){throw ApiError.ENOENT(path$$1)}if(isFileInode(inode)){var stats=inode.getData();switch(flags.pathExistsAction()){case ActionType.THROW_EXCEPTION:case ActionType.TRUNCATE_FILE:throw ApiError.EEXIST(path$$1);case ActionType.NOP:if(stats.fileData){return new NoSyncFile(this,path$$1,flags,stats.clone(),stats.fileData)}var buffer$$1=this._requestFileSync(path$$1,"buffer");stats.size=buffer$$1.length;stats.fileData=buffer$$1;return new NoSyncFile(this,path$$1,flags,stats.clone(),buffer$$1);default:throw new ApiError(ErrorCode.EINVAL,"Invalid FileMode object.")}}else{throw ApiError.EISDIR(path$$1)}};XmlHttpRequest2.prototype.readdir=function readdir(path$$1,cb){try{cb(null,this.readdirSync(path$$1))}catch(e){cb(e)}};XmlHttpRequest2.prototype.readdirSync=function readdirSync(path$$1){var inode=this._index.getInode(path$$1);if(inode===null){throw ApiError.ENOENT(path$$1)}else if(isDirInode(inode)){return inode.getListing()}else{throw ApiError.ENOTDIR(path$$1)}};XmlHttpRequest2.prototype.readFile=function readFile2(fname,encoding,flag,cb){var oldCb=cb;this.open(fname,flag,420,function(err,fd){if(err){return cb(err)}cb=function(err2,arg){fd.close(function(err22){if(!err2){err2=err22}return oldCb(err2,arg)})};var fdCast=fd;var fdBuff=fdCast.getBuffer();if(encoding===null){cb(err,copyingSlice(fdBuff))}else{tryToString(fdBuff,encoding,cb)}})};XmlHttpRequest2.prototype.readFileSync=function readFileSync(fname,encoding,flag){var fd=this.openSync(fname,flag,420);try{var fdCast=fd;var fdBuff=fdCast.getBuffer();if(encoding===null){return copyingSlice(fdBuff)}return fdBuff.toString(encoding)}finally{fd.closeSync()}};XmlHttpRequest2.prototype.getXhrPath=function getXhrPath(filePath){if(filePath.charAt(0)==="/"){filePath=filePath.slice(1)}return this.prefixUrl+filePath};XmlHttpRequest2.prototype._requestFileAsync=function _requestFileAsync(p2,type,cb){asyncDownloadFile(this.getXhrPath(p2),type,cb)};XmlHttpRequest2.prototype._requestFileSync=function _requestFileSync(p2,type){return syncDownloadFile(this.getXhrPath(p2),type)};XmlHttpRequest2.prototype._requestFileSizeAsync=function _requestFileSizeAsync(path$$1,cb){getFileSizeAsync(this.getXhrPath(path$$1),cb)};XmlHttpRequest2.prototype._requestFileSizeSync=function _requestFileSizeSync(path$$1){return getFileSizeSync(this.getXhrPath(path$$1))};return XmlHttpRequest2}(BaseFileSystem);XmlHttpRequest.Name="XmlHttpRequest";XmlHttpRequest.Options={index:{type:["string","object"],optional:true,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_xhrfs_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:true,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var ExtendedASCII=function ExtendedASCII2(){};ExtendedASCII.str2byte=function str2byte(str4,buf){var length=str4.length>buf.length?buf.length:str4.length;for(var i22=0;i22<length;i22++){var charCode=str4.charCodeAt(i22);if(charCode>127){var charIdx=ExtendedASCII.extendedChars.indexOf(str4.charAt(i22));if(charIdx>-1){charCode=charIdx+128}}buf[charCode]=i22}return length};ExtendedASCII.byte2str=function byte2str(buff){var chars=new Array(buff.length);for(var i22=0;i22<buff.length;i22++){var charCode=buff[i22];if(charCode>127){chars[i22]=ExtendedASCII.extendedChars[charCode-128]}else{chars[i22]=String.fromCharCode(charCode)}}return chars.join("")};ExtendedASCII.byteLength=function byteLength(str4){return str4.length};ExtendedASCII.extendedChars=["\\xC7","\\xFC","\\xE9","\\xE2","\\xE4","\\xE0","\\xE5","\\xE7","\\xEA","\\xEB","\\xE8","\\xEF","\\xEE","\\xEC","\\xC4","\\xC5","\\xC9","\\xE6","\\xC6","\\xF4","\\xF6","\\xF2","\\xFB","\\xF9","\\xFF","\\xD6","\\xDC","\\xF8","\\xA3","\\xD8","\\xD7","\\u0192","\\xE1","\\xED","\\xF3","\\xFA","\\xF1","\\xD1","\\xAA","\\xBA","\\xBF","\\xAE","\\xAC","\\xBD","\\xBC","\\xA1","\\xAB","\\xBB","_","_","_","\\xA6","\\xA6","\\xC1","\\xC2","\\xC0","\\xA9","\\xA6","\\xA6","+","+","\\xA2","\\xA5","+","+","-","-","+","-","+","\\xE3","\\xC3","+","+","-","-","\\xA6","-","+","\\xA4","\\xF0","\\xD0","\\xCA","\\xCB","\\xC8","i","\\xCD","\\xCE","\\xCF","+","+","_","_","\\xA6","\\xCC","_","\\xD3","\\xDF","\\xD4","\\xD2","\\xF5","\\xD5","\\xB5","\\xFE","\\xDE","\\xDA","\\xDB","\\xD9","\\xFD","\\xDD","\\xAF","\\xB4","\\xAD","\\xB1","_","\\xBE","\\xB6","\\xA7","\\xF7","\\xB8","\\xB0","\\xA8","\\xB7","\\xB9","\\xB3","\\xB2","_"," "];var inflateRaw=__webpack_require__(31).inflateRaw;var decompressionMethods={};var ExternalFileAttributeType;(function(ExternalFileAttributeType2){ExternalFileAttributeType2[ExternalFileAttributeType2["MSDOS"]=0]="MSDOS";ExternalFileAttributeType2[ExternalFileAttributeType2["AMIGA"]=1]="AMIGA";ExternalFileAttributeType2[ExternalFileAttributeType2["OPENVMS"]=2]="OPENVMS";ExternalFileAttributeType2[ExternalFileAttributeType2["UNIX"]=3]="UNIX";ExternalFileAttributeType2[ExternalFileAttributeType2["VM_CMS"]=4]="VM_CMS";ExternalFileAttributeType2[ExternalFileAttributeType2["ATARI_ST"]=5]="ATARI_ST";ExternalFileAttributeType2[ExternalFileAttributeType2["OS2_HPFS"]=6]="OS2_HPFS";ExternalFileAttributeType2[ExternalFileAttributeType2["MAC"]=7]="MAC";ExternalFileAttributeType2[ExternalFileAttributeType2["Z_SYSTEM"]=8]="Z_SYSTEM";ExternalFileAttributeType2[ExternalFileAttributeType2["CP_M"]=9]="CP_M";ExternalFileAttributeType2[ExternalFileAttributeType2["NTFS"]=10]="NTFS";ExternalFileAttributeType2[ExternalFileAttributeType2["MVS"]=11]="MVS";ExternalFileAttributeType2[ExternalFileAttributeType2["VSE"]=12]="VSE";ExternalFileAttributeType2[ExternalFileAttributeType2["ACORN_RISC"]=13]="ACORN_RISC";ExternalFileAttributeType2[ExternalFileAttributeType2["VFAT"]=14]="VFAT";ExternalFileAttributeType2[ExternalFileAttributeType2["ALT_MVS"]=15]="ALT_MVS";ExternalFileAttributeType2[ExternalFileAttributeType2["BEOS"]=16]="BEOS";ExternalFileAttributeType2[ExternalFileAttributeType2["TANDEM"]=17]="TANDEM";ExternalFileAttributeType2[ExternalFileAttributeType2["OS_400"]=18]="OS_400";ExternalFileAttributeType2[ExternalFileAttributeType2["OSX"]=19]="OSX"})(ExternalFileAttributeType||(ExternalFileAttributeType={}));var CompressionMethod;(function(CompressionMethod2){CompressionMethod2[CompressionMethod2["STORED"]=0]="STORED";CompressionMethod2[CompressionMethod2["SHRUNK"]=1]="SHRUNK";CompressionMethod2[CompressionMethod2["REDUCED_1"]=2]="REDUCED_1";CompressionMethod2[CompressionMethod2["REDUCED_2"]=3]="REDUCED_2";CompressionMethod2[CompressionMethod2["REDUCED_3"]=4]="REDUCED_3";CompressionMethod2[CompressionMethod2["REDUCED_4"]=5]="REDUCED_4";CompressionMethod2[CompressionMethod2["IMPLODE"]=6]="IMPLODE";CompressionMethod2[CompressionMethod2["DEFLATE"]=8]="DEFLATE";CompressionMethod2[CompressionMethod2["DEFLATE64"]=9]="DEFLATE64";CompressionMethod2[CompressionMethod2["TERSE_OLD"]=10]="TERSE_OLD";CompressionMethod2[CompressionMethod2["BZIP2"]=12]="BZIP2";CompressionMethod2[CompressionMethod2["LZMA"]=14]="LZMA";CompressionMethod2[CompressionMethod2["TERSE_NEW"]=18]="TERSE_NEW";CompressionMethod2[CompressionMethod2["LZ77"]=19]="LZ77";CompressionMethod2[CompressionMethod2["WAVPACK"]=97]="WAVPACK";CompressionMethod2[CompressionMethod2["PPMD"]=98]="PPMD"})(CompressionMethod||(CompressionMethod={}));function msdos2date(time,date){var day=date&31;var month=(date>>5&15)-1;var year=(date>>9)+1980;var second=time&31;var minute=time>>5&63;var hour=time>>11;return new Date(year,month,day,hour,minute,second)}function safeToString(buff,useUTF8,start,length){if(length===0){return""}else if(useUTF8){return buff.toString("utf8",start,start+length)}else{return ExtendedASCII.byte2str(buff.slice(start,start+length))}}var FileHeader=function FileHeader2(data){this.data=data;if(data.readUInt32LE(0)!==67324752){throw new ApiError(ErrorCode.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))}};FileHeader.prototype.versionNeeded=function versionNeeded(){return this.data.readUInt16LE(4)};FileHeader.prototype.flags=function flags(){return this.data.readUInt16LE(6)};FileHeader.prototype.compressionMethod=function compressionMethod(){return this.data.readUInt16LE(8)};FileHeader.prototype.lastModFileTime=function lastModFileTime(){return msdos2date(this.data.readUInt16LE(10),this.data.readUInt16LE(12))};FileHeader.prototype.rawLastModFileTime=function rawLastModFileTime(){return this.data.readUInt32LE(10)};FileHeader.prototype.crc32=function crc32(){return this.data.readUInt32LE(14)};FileHeader.prototype.fileNameLength=function fileNameLength(){return this.data.readUInt16LE(26)};FileHeader.prototype.extraFieldLength=function extraFieldLength(){return this.data.readUInt16LE(28)};FileHeader.prototype.fileName=function fileName(){return safeToString(this.data,this.useUTF8(),30,this.fileNameLength())};FileHeader.prototype.extraField=function extraField(){var start=30+this.fileNameLength();return this.data.slice(start,start+this.extraFieldLength())};FileHeader.prototype.totalSize=function totalSize(){return 30+this.fileNameLength()+this.extraFieldLength()};FileHeader.prototype.useUTF8=function useUTF8(){return(this.flags()&2048)===2048};var FileData=function FileData2(header,record,data){this.header=header;this.record=record;this.data=data};FileData.prototype.decompress=function decompress(){var compressionMethod=this.header.compressionMethod();var fcn=decompressionMethods[compressionMethod];if(fcn){return fcn(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag())}else{var name2=CompressionMethod[compressionMethod];if(!name2){name2="Unknown: "+compressionMethod}throw new ApiError(ErrorCode.EINVAL,"Invalid compression method on file \'"+this.header.fileName()+"\': "+name2)}};FileData.prototype.getHeader=function getHeader(){return this.header};FileData.prototype.getRecord=function getRecord(){return this.record};FileData.prototype.getRawData=function getRawData(){return this.data};var DataDescriptor=function DataDescriptor2(data){this.data=data};DataDescriptor.prototype.crc32=function crc32(){return this.data.readUInt32LE(0)};DataDescriptor.prototype.compressedSize=function compressedSize(){return this.data.readUInt32LE(4)};DataDescriptor.prototype.uncompressedSize=function uncompressedSize(){return this.data.readUInt32LE(8)};var ArchiveExtraDataRecord=function ArchiveExtraDataRecord2(data){this.data=data;if(this.data.readUInt32LE(0)!==134630224){throw new ApiError(ErrorCode.EINVAL,"Invalid archive extra data record signature: "+this.data.readUInt32LE(0))}};ArchiveExtraDataRecord.prototype.length=function length(){return this.data.readUInt32LE(4)};ArchiveExtraDataRecord.prototype.extraFieldData=function extraFieldData(){return this.data.slice(8,8+this.length())};var DigitalSignature=function DigitalSignature2(data){this.data=data;if(this.data.readUInt32LE(0)!==84233040){throw new ApiError(ErrorCode.EINVAL,"Invalid digital signature signature: "+this.data.readUInt32LE(0))}};DigitalSignature.prototype.size=function size(){return this.data.readUInt16LE(4)};DigitalSignature.prototype.signatureData=function signatureData(){return this.data.slice(6,6+this.size())};var CentralDirectory=function CentralDirectory2(zipData,data){this.zipData=zipData;this.data=data;if(this.data.readUInt32LE(0)!==33639248){throw new ApiError(ErrorCode.EINVAL,"Invalid Zip file: Central directory record has invalid signature: "+this.data.readUInt32LE(0))}this._filename=this.produceFilename()};CentralDirectory.prototype.versionMadeBy=function versionMadeBy(){return this.data.readUInt16LE(4)};CentralDirectory.prototype.versionNeeded=function versionNeeded(){return this.data.readUInt16LE(6)};CentralDirectory.prototype.flag=function flag(){return this.data.readUInt16LE(8)};CentralDirectory.prototype.compressionMethod=function compressionMethod(){return this.data.readUInt16LE(10)};CentralDirectory.prototype.lastModFileTime=function lastModFileTime(){return msdos2date(this.data.readUInt16LE(12),this.data.readUInt16LE(14))};CentralDirectory.prototype.rawLastModFileTime=function rawLastModFileTime(){return this.data.readUInt32LE(12)};CentralDirectory.prototype.crc32=function crc32(){return this.data.readUInt32LE(16)};CentralDirectory.prototype.compressedSize=function compressedSize(){return this.data.readUInt32LE(20)};CentralDirectory.prototype.uncompressedSize=function uncompressedSize(){return this.data.readUInt32LE(24)};CentralDirectory.prototype.fileNameLength=function fileNameLength(){return this.data.readUInt16LE(28)};CentralDirectory.prototype.extraFieldLength=function extraFieldLength(){return this.data.readUInt16LE(30)};CentralDirectory.prototype.fileCommentLength=function fileCommentLength(){return this.data.readUInt16LE(32)};CentralDirectory.prototype.diskNumberStart=function diskNumberStart(){return this.data.readUInt16LE(34)};CentralDirectory.prototype.internalAttributes=function internalAttributes(){return this.data.readUInt16LE(36)};CentralDirectory.prototype.externalAttributes=function externalAttributes(){return this.data.readUInt32LE(38)};CentralDirectory.prototype.headerRelativeOffset=function headerRelativeOffset(){return this.data.readUInt32LE(42)};CentralDirectory.prototype.produceFilename=function produceFilename(){var fileName=safeToString(this.data,this.useUTF8(),46,this.fileNameLength());return fileName.replace(/\\\\/g,"/")};CentralDirectory.prototype.fileName=function fileName(){return this._filename};CentralDirectory.prototype.rawFileName=function rawFileName(){return this.data.slice(46,46+this.fileNameLength())};CentralDirectory.prototype.extraField=function extraField(){var start=44+this.fileNameLength();return this.data.slice(start,start+this.extraFieldLength())};CentralDirectory.prototype.fileComment=function fileComment(){var start=46+this.fileNameLength()+this.extraFieldLength();return safeToString(this.data,this.useUTF8(),start,this.fileCommentLength())};CentralDirectory.prototype.rawFileComment=function rawFileComment(){var start=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(start,start+this.fileCommentLength())};CentralDirectory.prototype.totalSize=function totalSize(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()};CentralDirectory.prototype.isDirectory=function isDirectory(){var fileName=this.fileName();return(this.externalAttributes()&16?true:false)||fileName.charAt(fileName.length-1)==="/"};CentralDirectory.prototype.isFile=function isFile(){return!this.isDirectory()};CentralDirectory.prototype.useUTF8=function useUTF8(){return(this.flag()&2048)===2048};CentralDirectory.prototype.isEncrypted=function isEncrypted(){return(this.flag()&1)===1};CentralDirectory.prototype.getFileData=function getFileData(){var start=this.headerRelativeOffset();var header=new FileHeader(this.zipData.slice(start));return new FileData(header,this,this.zipData.slice(start+header.totalSize()))};CentralDirectory.prototype.getData=function getData(){return this.getFileData().decompress()};CentralDirectory.prototype.getRawData=function getRawData(){return this.getFileData().getRawData()};CentralDirectory.prototype.getStats=function getStats(){return new Stats(FileType.FILE,this.uncompressedSize(),365,new Date,this.lastModFileTime())};var EndOfCentralDirectory=function EndOfCentralDirectory2(data){this.data=data;if(this.data.readUInt32LE(0)!==101010256){throw new ApiError(ErrorCode.EINVAL,"Invalid Zip file: End of central directory record has invalid signature: "+this.data.readUInt32LE(0))}};EndOfCentralDirectory.prototype.diskNumber=function diskNumber(){return this.data.readUInt16LE(4)};EndOfCentralDirectory.prototype.cdDiskNumber=function cdDiskNumber(){return this.data.readUInt16LE(6)};EndOfCentralDirectory.prototype.cdDiskEntryCount=function cdDiskEntryCount(){return this.data.readUInt16LE(8)};EndOfCentralDirectory.prototype.cdTotalEntryCount=function cdTotalEntryCount(){return this.data.readUInt16LE(10)};EndOfCentralDirectory.prototype.cdSize=function cdSize(){return this.data.readUInt32LE(12)};EndOfCentralDirectory.prototype.cdOffset=function cdOffset(){return this.data.readUInt32LE(16)};EndOfCentralDirectory.prototype.cdZipCommentLength=function cdZipCommentLength(){return this.data.readUInt16LE(20)};EndOfCentralDirectory.prototype.cdZipComment=function cdZipComment(){return safeToString(this.data,true,22,this.cdZipCommentLength())};EndOfCentralDirectory.prototype.rawCdZipComment=function rawCdZipComment(){return this.data.slice(22,22+this.cdZipCommentLength())};var ZipTOC=function ZipTOC2(index,directoryEntries,eocd,data){this.index=index;this.directoryEntries=directoryEntries;this.eocd=eocd;this.data=data};var ZipFS=function(SynchronousFileSystem$$1){function ZipFS2(input,name2,deprecateMsg){if(name2===void 0)name2="";if(deprecateMsg===void 0)deprecateMsg=true;SynchronousFileSystem$$1.call(this);this.name=name2;this._index=new FileIndex;this._directoryEntries=[];this._eocd=null;deprecationMessage(deprecateMsg,ZipFS2.Name,{zipData:"zip data as a Buffer",name:name2});if(input instanceof ZipTOC){this._index=input.index;this._directoryEntries=input.directoryEntries;this._eocd=input.eocd;this.data=input.data}else{this.data=input;this.populateIndex()}}if(SynchronousFileSystem$$1)ZipFS2.__proto__=SynchronousFileSystem$$1;ZipFS2.prototype=Object.create(SynchronousFileSystem$$1&&SynchronousFileSystem$$1.prototype);ZipFS2.prototype.constructor=ZipFS2;ZipFS2.Create=function Create(opts,cb){try{ZipFS2.computeIndex(opts.zipData,function(zipTOC){var fs4=new ZipFS2(zipTOC,opts.name,false);cb(null,fs4)},false)}catch(e){cb(e)}};ZipFS2.isAvailable=function isAvailable(){return true};ZipFS2.RegisterDecompressionMethod=function RegisterDecompressionMethod(m,fcn){decompressionMethods[m]=fcn};ZipFS2.computeIndex=function computeIndex(data,cb,deprecateMsg){if(deprecateMsg===void 0)deprecateMsg=true;if(deprecateMsg){console.warn("[ZipFS] ZipFS.computeIndex is now deprecated, and will be removed in the next major release. Please update your code to use \'ZipFS.Create({ zipData: zip file as a Buffer}, cb)\' instead.")}var index=new FileIndex;var eocd=ZipFS2.getEOCD(data);if(eocd.diskNumber()!==eocd.cdDiskNumber()){throw new ApiError(ErrorCode.EINVAL,"ZipFS does not support spanned zip files.")}var cdPtr=eocd.cdOffset();if(cdPtr===4294967295){throw new ApiError(ErrorCode.EINVAL,"ZipFS does not support Zip64.")}var cdEnd=cdPtr+eocd.cdSize();ZipFS2.computeIndexResponsive(data,index,cdPtr,cdEnd,cb,[],eocd)};ZipFS2.getEOCD=function getEOCD(data){var startOffset=22;var endOffset=Math.min(startOffset+65535,data.length-1);for(var i22=startOffset;i22<endOffset;i22++){if(data.readUInt32LE(data.length-i22)===101010256){return new EndOfCentralDirectory(data.slice(data.length-i22))}}throw new ApiError(ErrorCode.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")};ZipFS2.addToIndex=function addToIndex(cd,index){var filename=cd.fileName();if(filename.charAt(0)==="/"){throw new Error("WHY IS THIS ABSOLUTE")}if(filename.charAt(filename.length-1)==="/"){filename=filename.substr(0,filename.length-1)}if(cd.isDirectory()){index.addPathFast("/"+filename,new DirInode(cd))}else{index.addPathFast("/"+filename,new FileInode(cd))}};ZipFS2.computeIndexResponsive=function computeIndexResponsive(data,index,cdPtr,cdEnd,cb,cdEntries,eocd){if(cdPtr<cdEnd){var count=0;while(count++<200&&cdPtr<cdEnd){var cd=new CentralDirectory(data,data.slice(cdPtr));ZipFS2.addToIndex(cd,index);cdPtr+=cd.totalSize();cdEntries.push(cd)}setImmediate$3(function(){ZipFS2.computeIndexResponsive(data,index,cdPtr,cdEnd,cb,cdEntries,eocd)})}else{cb(new ZipTOC(index,cdEntries,eocd,data))}};ZipFS2.prototype.getName=function getName(){return ZipFS2.Name+(this.name!==""?" "+this.name:"")};ZipFS2.prototype.getCentralDirectoryEntry=function getCentralDirectoryEntry(path$$1){var inode=this._index.getInode(path$$1);if(inode===null){throw ApiError.ENOENT(path$$1)}if(isFileInode(inode)){return inode.getData()}else if(isDirInode(inode)){return inode.getData()}else{throw ApiError.EPERM("Invalid inode: "+inode)}};ZipFS2.prototype.getCentralDirectoryEntryAt=function getCentralDirectoryEntryAt(index){var dirEntry=this._directoryEntries[index];if(!dirEntry){throw new RangeError("Invalid directory index: "+index+".")}return dirEntry};ZipFS2.prototype.getNumberOfCentralDirectoryEntries=function getNumberOfCentralDirectoryEntries(){return this._directoryEntries.length};ZipFS2.prototype.getEndOfCentralDirectory=function getEndOfCentralDirectory(){return this._eocd};ZipFS2.prototype.diskSpace=function diskSpace(path$$1,cb){cb(this.data.length,0)};ZipFS2.prototype.isReadOnly=function isReadOnly(){return true};ZipFS2.prototype.supportsLinks=function supportsLinks(){return false};ZipFS2.prototype.supportsProps=function supportsProps(){return false};ZipFS2.prototype.supportsSynch=function supportsSynch(){return true};ZipFS2.prototype.statSync=function statSync(path$$1,isLstat){var inode=this._index.getInode(path$$1);if(inode===null){throw ApiError.ENOENT(path$$1)}var stats;if(isFileInode(inode)){stats=inode.getData().getStats()}else if(isDirInode(inode)){stats=inode.getStats()}else{throw new ApiError(ErrorCode.EINVAL,"Invalid inode.")}return stats};ZipFS2.prototype.openSync=function openSync(path$$1,flags,mode){if(flags.isWriteable()){throw new ApiError(ErrorCode.EPERM,path$$1)}var inode=this._index.getInode(path$$1);if(!inode){throw ApiError.ENOENT(path$$1)}else if(isFileInode(inode)){var cdRecord=inode.getData();var stats=cdRecord.getStats();switch(flags.pathExistsAction()){case ActionType.THROW_EXCEPTION:case ActionType.TRUNCATE_FILE:throw ApiError.EEXIST(path$$1);case ActionType.NOP:return new NoSyncFile(this,path$$1,flags,stats,cdRecord.getData());default:throw new ApiError(ErrorCode.EINVAL,"Invalid FileMode object.")}}else{throw ApiError.EISDIR(path$$1)}};ZipFS2.prototype.readdirSync=function readdirSync(path$$1){var inode=this._index.getInode(path$$1);if(!inode){throw ApiError.ENOENT(path$$1)}else if(isDirInode(inode)){return inode.getListing()}else{throw ApiError.ENOTDIR(path$$1)}};ZipFS2.prototype.readFileSync=function readFileSync(fname,encoding,flag){var fd=this.openSync(fname,flag,420);try{var fdCast=fd;var fdBuff=fdCast.getBuffer();if(encoding===null){return copyingSlice(fdBuff)}return fdBuff.toString(encoding)}finally{fd.closeSync()}};ZipFS2.prototype.populateIndex=function populateIndex(){var this$1=this;var eocd=this._eocd=ZipFS2.getEOCD(this.data);if(eocd.diskNumber()!==eocd.cdDiskNumber()){throw new ApiError(ErrorCode.EINVAL,"ZipFS does not support spanned zip files.")}var cdPtr=eocd.cdOffset();if(cdPtr===4294967295){throw new ApiError(ErrorCode.EINVAL,"ZipFS does not support Zip64.")}var cdEnd=cdPtr+eocd.cdSize();while(cdPtr<cdEnd){var cd=new CentralDirectory(this$1.data,this$1.data.slice(cdPtr));cdPtr+=cd.totalSize();ZipFS2.addToIndex(cd,this$1._index);this$1._directoryEntries.push(cd)}};return ZipFS2}(SynchronousFileSystem);ZipFS.Name="ZipFS";ZipFS.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:bufferValidator},name:{type:"string",optional:true,description:"The name of the zip file (optional)."}};ZipFS.CompressionMethod=CompressionMethod;ZipFS.RegisterDecompressionMethod(CompressionMethod.DEFLATE,function(data,compressedSize,uncompressedSize){return arrayish2Buffer(inflateRaw(data.slice(0,compressedSize),{chunkSize:uncompressedSize}))});ZipFS.RegisterDecompressionMethod(CompressionMethod.STORED,function(data,compressedSize,uncompressedSize){return copyingSlice(data,0,uncompressedSize)});var rockRidgeIdentifier="IEEE_P1282";function getASCIIString(data,startIndex,length){return data.toString("ascii",startIndex,startIndex+length).trim()}function getJolietString(data,startIndex,length){if(length===1){return String.fromCharCode(data[startIndex])}var pairs=Math.floor(length/2);var chars=new Array(pairs);for(var i22=0;i22<pairs;i22++){var pos=startIndex+(i22<<1);chars[i22]=String.fromCharCode(data[pos+1]|data[pos]<<8)}return chars.join("")}function getDate(data,startIndex){var year=parseInt(getASCIIString(data,startIndex,4),10);var mon=parseInt(getASCIIString(data,startIndex+4,2),10);var day=parseInt(getASCIIString(data,startIndex+6,2),10);var hour=parseInt(getASCIIString(data,startIndex+8,2),10);var min=parseInt(getASCIIString(data,startIndex+10,2),10);var sec=parseInt(getASCIIString(data,startIndex+12,2),10);var hundrethsSec=parseInt(getASCIIString(data,startIndex+14,2),10);return new Date(year,mon,day,hour,min,sec,hundrethsSec*100)}function getShortFormDate(data,startIndex){var yearsSince1900=data[startIndex];var month=data[startIndex+1];var day=data[startIndex+2];var hour=data[startIndex+3];var minute=data[startIndex+4];var second=data[startIndex+5];return new Date(yearsSince1900,month-1,day,hour,minute,second)}function constructSystemUseEntry(bigData,i22){var data=bigData.slice(i22);var sue=new SystemUseEntry(data);switch(sue.signatureWord()){case 17221:return new CEEntry(data);case 20548:return new PDEntry(data);case 21328:return new SPEntry(data);case 21332:return new STEntry(data);case 17746:return new EREntry(data);case 17747:return new ESEntry(data);case 20568:return new PXEntry(data);case 20558:return new PNEntry(data);case 21324:return new SLEntry(data);case 20045:return new NMEntry(data);case 17228:return new CLEntry(data);case 20556:return new PLEntry(data);case 21061:return new REEntry(data);case 21574:return new TFEntry(data);case 21318:return new SFEntry(data);case 21074:return new RREntry(data);default:return sue}}function constructSystemUseEntries(data,i22,len,isoData){len=len-4;var entries=new Array;while(i22<len){var entry=constructSystemUseEntry(data,i22);var length=entry.length();if(length===0){return entries}i22+=length;if(entry instanceof STEntry){break}if(entry instanceof CEEntry){entries=entries.concat(entry.getEntries(isoData))}else{entries.push(entry)}}return entries}var VolumeDescriptor=function VolumeDescriptor2(data){this._data=data};VolumeDescriptor.prototype.type=function type(){return this._data[0]};VolumeDescriptor.prototype.standardIdentifier=function standardIdentifier(){return getASCIIString(this._data,1,5)};VolumeDescriptor.prototype.version=function version(){return this._data[6]};VolumeDescriptor.prototype.data=function data(){return this._data.slice(7,2048)};var PrimaryOrSupplementaryVolumeDescriptor=function(VolumeDescriptor2){function PrimaryOrSupplementaryVolumeDescriptor2(data){VolumeDescriptor2.call(this,data);this._root=null}if(VolumeDescriptor2)PrimaryOrSupplementaryVolumeDescriptor2.__proto__=VolumeDescriptor2;PrimaryOrSupplementaryVolumeDescriptor2.prototype=Object.create(VolumeDescriptor2&&VolumeDescriptor2.prototype);PrimaryOrSupplementaryVolumeDescriptor2.prototype.constructor=PrimaryOrSupplementaryVolumeDescriptor2;PrimaryOrSupplementaryVolumeDescriptor2.prototype.systemIdentifier=function systemIdentifier(){return this._getString32(8)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeIdentifier=function volumeIdentifier(){return this._getString32(40)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeSpaceSize=function volumeSpaceSize(){return this._data.readUInt32LE(80)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeSetSize=function volumeSetSize(){return this._data.readUInt16LE(120)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeSequenceNumber=function volumeSequenceNumber(){return this._data.readUInt16LE(124)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.logicalBlockSize=function logicalBlockSize(){return this._data.readUInt16LE(128)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.pathTableSize=function pathTableSize(){return this._data.readUInt32LE(132)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.locationOfTypeLPathTable=function locationOfTypeLPathTable(){return this._data.readUInt32LE(140)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.locationOfOptionalTypeLPathTable=function locationOfOptionalTypeLPathTable(){return this._data.readUInt32LE(144)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.locationOfTypeMPathTable=function locationOfTypeMPathTable(){return this._data.readUInt32BE(148)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.locationOfOptionalTypeMPathTable=function locationOfOptionalTypeMPathTable(){return this._data.readUInt32BE(152)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.rootDirectoryEntry=function rootDirectoryEntry(isoData){if(this._root===null){this._root=this._constructRootDirectoryRecord(this._data.slice(156));this._root.rootCheckForRockRidge(isoData)}return this._root};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeSetIdentifier=function volumeSetIdentifier(){return this._getString(190,128)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.publisherIdentifier=function publisherIdentifier(){return this._getString(318,128)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.dataPreparerIdentifier=function dataPreparerIdentifier(){return this._getString(446,128)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.applicationIdentifier=function applicationIdentifier(){return this._getString(574,128)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.copyrightFileIdentifier=function copyrightFileIdentifier(){return this._getString(702,38)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.abstractFileIdentifier=function abstractFileIdentifier(){return this._getString(740,36)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.bibliographicFileIdentifier=function bibliographicFileIdentifier(){return this._getString(776,37)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeCreationDate=function volumeCreationDate(){return getDate(this._data,813)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeModificationDate=function volumeModificationDate(){return getDate(this._data,830)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeExpirationDate=function volumeExpirationDate(){return getDate(this._data,847)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.volumeEffectiveDate=function volumeEffectiveDate(){return getDate(this._data,864)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.fileStructureVersion=function fileStructureVersion(){return this._data[881]};PrimaryOrSupplementaryVolumeDescriptor2.prototype.applicationUsed=function applicationUsed(){return this._data.slice(883,883+512)};PrimaryOrSupplementaryVolumeDescriptor2.prototype.reserved=function reserved(){return this._data.slice(1395,1395+653)};PrimaryOrSupplementaryVolumeDescriptor2.prototype._getString32=function _getString32(idx){return this._getString(idx,32)};return PrimaryOrSupplementaryVolumeDescriptor2}(VolumeDescriptor);var PrimaryVolumeDescriptor=function(PrimaryOrSupplementaryVolumeDescriptor2){function PrimaryVolumeDescriptor2(data){PrimaryOrSupplementaryVolumeDescriptor2.call(this,data);if(this.type()!==1){throw new ApiError(ErrorCode.EIO,"Invalid primary volume descriptor.")}}if(PrimaryOrSupplementaryVolumeDescriptor2)PrimaryVolumeDescriptor2.__proto__=PrimaryOrSupplementaryVolumeDescriptor2;PrimaryVolumeDescriptor2.prototype=Object.create(PrimaryOrSupplementaryVolumeDescriptor2&&PrimaryOrSupplementaryVolumeDescriptor2.prototype);PrimaryVolumeDescriptor2.prototype.constructor=PrimaryVolumeDescriptor2;PrimaryVolumeDescriptor2.prototype.name=function name2(){return"ISO9660"};PrimaryVolumeDescriptor2.prototype._constructRootDirectoryRecord=function _constructRootDirectoryRecord(data){return new ISODirectoryRecord(data,-1)};PrimaryVolumeDescriptor2.prototype._getString=function _getString(idx,len){return this._getString(idx,len)};return PrimaryVolumeDescriptor2}(PrimaryOrSupplementaryVolumeDescriptor);var SupplementaryVolumeDescriptor=function(PrimaryOrSupplementaryVolumeDescriptor2){function SupplementaryVolumeDescriptor2(data){PrimaryOrSupplementaryVolumeDescriptor2.call(this,data);if(this.type()!==2){throw new ApiError(ErrorCode.EIO,"Invalid supplementary volume descriptor.")}var escapeSequence=this.escapeSequence();var third=escapeSequence[2];if(escapeSequence[0]!==37||escapeSequence[1]!==47||third!==64&&third!==67&&third!==69){throw new ApiError(ErrorCode.EIO,"Unrecognized escape sequence for SupplementaryVolumeDescriptor: "+escapeSequence.toString())}}if(PrimaryOrSupplementaryVolumeDescriptor2)SupplementaryVolumeDescriptor2.__proto__=PrimaryOrSupplementaryVolumeDescriptor2;SupplementaryVolumeDescriptor2.prototype=Object.create(PrimaryOrSupplementaryVolumeDescriptor2&&PrimaryOrSupplementaryVolumeDescriptor2.prototype);SupplementaryVolumeDescriptor2.prototype.constructor=SupplementaryVolumeDescriptor2;SupplementaryVolumeDescriptor2.prototype.name=function name2(){return"Joliet"};SupplementaryVolumeDescriptor2.prototype.escapeSequence=function escapeSequence(){return this._data.slice(88,120)};SupplementaryVolumeDescriptor2.prototype._constructRootDirectoryRecord=function _constructRootDirectoryRecord(data){return new JolietDirectoryRecord(data,-1)};SupplementaryVolumeDescriptor2.prototype._getString=function _getString(idx,len){return getJolietString(this._data,idx,len)};return SupplementaryVolumeDescriptor2}(PrimaryOrSupplementaryVolumeDescriptor);var DirectoryRecord=function DirectoryRecord2(data,rockRidgeOffset){this._suEntries=null;this._fileOrDir=null;this._data=data;this._rockRidgeOffset=rockRidgeOffset};DirectoryRecord.prototype.hasRockRidge=function hasRockRidge(){return this._rockRidgeOffset>-1};DirectoryRecord.prototype.getRockRidgeOffset=function getRockRidgeOffset(){return this._rockRidgeOffset};DirectoryRecord.prototype.rootCheckForRockRidge=function rootCheckForRockRidge(isoData){var dir=this.getDirectory(isoData);this._rockRidgeOffset=dir.getDotEntry(isoData)._getRockRidgeOffset(isoData);if(this._rockRidgeOffset>-1){this._fileOrDir=null}};DirectoryRecord.prototype.length=function length(){return this._data[0]};DirectoryRecord.prototype.extendedAttributeRecordLength=function extendedAttributeRecordLength(){return this._data[1]};DirectoryRecord.prototype.lba=function lba(){return this._data.readUInt32LE(2)*2048};DirectoryRecord.prototype.dataLength=function dataLength(){return this._data.readUInt32LE(10)};DirectoryRecord.prototype.recordingDate=function recordingDate(){return getShortFormDate(this._data,18)};DirectoryRecord.prototype.fileFlags=function fileFlags(){return this._data[25]};DirectoryRecord.prototype.fileUnitSize=function fileUnitSize(){return this._data[26]};DirectoryRecord.prototype.interleaveGapSize=function interleaveGapSize(){return this._data[27]};DirectoryRecord.prototype.volumeSequenceNumber=function volumeSequenceNumber(){return this._data.readUInt16LE(28)};DirectoryRecord.prototype.identifier=function identifier(){return this._getString(33,this._data[32])};DirectoryRecord.prototype.fileName=function fileName(isoData){if(this.hasRockRidge()){var fn=this._rockRidgeFilename(isoData);if(fn!==null){return fn}}var ident=this.identifier();if(this.isDirectory(isoData)){return ident}var versionSeparator=ident.indexOf(";");if(versionSeparator===-1){return ident}else if(ident[versionSeparator-1]==="."){return ident.slice(0,versionSeparator-1)}else{return ident.slice(0,versionSeparator)}};DirectoryRecord.prototype.isDirectory=function isDirectory(isoData){var rv=!!(this.fileFlags()&2);if(!rv&&this.hasRockRidge()){rv=this.getSUEntries(isoData).filter(function(e){return e instanceof CLEntry}).length>0}return rv};DirectoryRecord.prototype.isSymlink=function isSymlink(isoData){return this.hasRockRidge()&&this.getSUEntries(isoData).filter(function(e){return e instanceof SLEntry}).length>0};DirectoryRecord.prototype.getSymlinkPath=function getSymlinkPath(isoData){var p2="";var entries=this.getSUEntries(isoData);var getStr=this._getGetString();for(var i22=0,list2=entries;i22<list2.length;i22+=1){var entry=list2[i22];if(entry instanceof SLEntry){var components=entry.componentRecords();for(var i$12=0,list$1=components;i$12<list$1.length;i$12+=1){var component=list$1[i$12];var flags=component.flags();if(flags&2){p2+="./"}else if(flags&4){p2+="../"}else if(flags&8){p2+="/"}else{p2+=component.content(getStr);if(!(flags&1)){p2+="/"}}}if(!entry.continueFlag()){break}}}if(p2.length>1&&p2[p2.length-1]==="/"){return p2.slice(0,p2.length-1)}else{return p2}};DirectoryRecord.prototype.getFile=function getFile(isoData){if(this.isDirectory(isoData)){throw new Error("Tried to get a File from a directory.")}if(this._fileOrDir===null){this._fileOrDir=isoData.slice(this.lba(),this.lba()+this.dataLength())}return this._fileOrDir};DirectoryRecord.prototype.getDirectory=function getDirectory(isoData){if(!this.isDirectory(isoData)){throw new Error("Tried to get a Directory from a file.")}if(this._fileOrDir===null){this._fileOrDir=this._constructDirectory(isoData)}return this._fileOrDir};DirectoryRecord.prototype.getSUEntries=function getSUEntries(isoData){if(!this._suEntries){this._constructSUEntries(isoData)}return this._suEntries};DirectoryRecord.prototype._rockRidgeFilename=function _rockRidgeFilename(isoData){var nmEntries=this.getSUEntries(isoData).filter(function(e2){return e2 instanceof NMEntry});if(nmEntries.length===0||nmEntries[0].flags()&(2|4)){return null}var str4="";var getString=this._getGetString();for(var i22=0,list2=nmEntries;i22<list2.length;i22+=1){var e=list2[i22];str4+=e.name(getString);if(!(e.flags()&1)){break}}return str4};DirectoryRecord.prototype._constructSUEntries=function _constructSUEntries(isoData){var i22=33+this._data[32];if(i22%2===1){i22++}i22+=this._rockRidgeOffset;this._suEntries=constructSystemUseEntries(this._data,i22,this.length(),isoData)};DirectoryRecord.prototype._getRockRidgeOffset=function _getRockRidgeOffset(isoData){this._rockRidgeOffset=0;var suEntries=this.getSUEntries(isoData);if(suEntries.length>0){var spEntry=suEntries[0];if(spEntry instanceof SPEntry&&spEntry.checkBytesPass()){for(var i22=1;i22<suEntries.length;i22++){var entry=suEntries[i22];if(entry instanceof RREntry||entry instanceof EREntry&&entry.extensionIdentifier()===rockRidgeIdentifier){return spEntry.bytesSkipped()}}}}this._rockRidgeOffset=-1;return-1};var ISODirectoryRecord=function(DirectoryRecord2){function ISODirectoryRecord2(data,rockRidgeOffset){DirectoryRecord2.call(this,data,rockRidgeOffset)}if(DirectoryRecord2)ISODirectoryRecord2.__proto__=DirectoryRecord2;ISODirectoryRecord2.prototype=Object.create(DirectoryRecord2&&DirectoryRecord2.prototype);ISODirectoryRecord2.prototype.constructor=ISODirectoryRecord2;ISODirectoryRecord2.prototype._getString=function _getString(i22,len){return getASCIIString(this._data,i22,len)};ISODirectoryRecord2.prototype._constructDirectory=function _constructDirectory(isoData){return new ISODirectory(this,isoData)};ISODirectoryRecord2.prototype._getGetString=function _getGetString(){return getASCIIString};return ISODirectoryRecord2}(DirectoryRecord);var JolietDirectoryRecord=function(DirectoryRecord2){function JolietDirectoryRecord2(data,rockRidgeOffset){DirectoryRecord2.call(this,data,rockRidgeOffset)}if(DirectoryRecord2)JolietDirectoryRecord2.__proto__=DirectoryRecord2;JolietDirectoryRecord2.prototype=Object.create(DirectoryRecord2&&DirectoryRecord2.prototype);JolietDirectoryRecord2.prototype.constructor=JolietDirectoryRecord2;JolietDirectoryRecord2.prototype._getString=function _getString(i22,len){return getJolietString(this._data,i22,len)};JolietDirectoryRecord2.prototype._constructDirectory=function _constructDirectory(isoData){return new JolietDirectory(this,isoData)};JolietDirectoryRecord2.prototype._getGetString=function _getGetString(){return getJolietString};return JolietDirectoryRecord2}(DirectoryRecord);var SystemUseEntry=function SystemUseEntry2(data){this._data=data};SystemUseEntry.prototype.signatureWord=function signatureWord(){return this._data.readUInt16BE(0)};SystemUseEntry.prototype.signatureWordString=function signatureWordString(){return getASCIIString(this._data,0,2)};SystemUseEntry.prototype.length=function length(){return this._data[2]};SystemUseEntry.prototype.suVersion=function suVersion(){return this._data[3]};var CEEntry=function(SystemUseEntry2){function CEEntry2(data){SystemUseEntry2.call(this,data);this._entries=null}if(SystemUseEntry2)CEEntry2.__proto__=SystemUseEntry2;CEEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);CEEntry2.prototype.constructor=CEEntry2;CEEntry2.prototype.continuationLba=function continuationLba(){return this._data.readUInt32LE(4)};CEEntry2.prototype.continuationLbaOffset=function continuationLbaOffset(){return this._data.readUInt32LE(12)};CEEntry2.prototype.continuationLength=function continuationLength(){return this._data.readUInt32LE(20)};CEEntry2.prototype.getEntries=function getEntries(isoData){if(!this._entries){var start=this.continuationLba()*2048+this.continuationLbaOffset();this._entries=constructSystemUseEntries(isoData,start,this.continuationLength(),isoData)}return this._entries};return CEEntry2}(SystemUseEntry);var PDEntry=function(SystemUseEntry2){function PDEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)PDEntry2.__proto__=SystemUseEntry2;PDEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);PDEntry2.prototype.constructor=PDEntry2;return PDEntry2}(SystemUseEntry);var SPEntry=function(SystemUseEntry2){function SPEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)SPEntry2.__proto__=SystemUseEntry2;SPEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);SPEntry2.prototype.constructor=SPEntry2;SPEntry2.prototype.checkBytesPass=function checkBytesPass(){return this._data[4]===190&&this._data[5]===239};SPEntry2.prototype.bytesSkipped=function bytesSkipped(){return this._data[6]};return SPEntry2}(SystemUseEntry);var STEntry=function(SystemUseEntry2){function STEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)STEntry2.__proto__=SystemUseEntry2;STEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);STEntry2.prototype.constructor=STEntry2;return STEntry2}(SystemUseEntry);var EREntry=function(SystemUseEntry2){function EREntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)EREntry2.__proto__=SystemUseEntry2;EREntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);EREntry2.prototype.constructor=EREntry2;EREntry2.prototype.identifierLength=function identifierLength(){return this._data[4]};EREntry2.prototype.descriptorLength=function descriptorLength(){return this._data[5]};EREntry2.prototype.sourceLength=function sourceLength(){return this._data[6]};EREntry2.prototype.extensionVersion=function extensionVersion(){return this._data[7]};EREntry2.prototype.extensionIdentifier=function extensionIdentifier(){return getASCIIString(this._data,8,this.identifierLength())};EREntry2.prototype.extensionDescriptor=function extensionDescriptor(){return getASCIIString(this._data,8+this.identifierLength(),this.descriptorLength())};EREntry2.prototype.extensionSource=function extensionSource(){return getASCIIString(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())};return EREntry2}(SystemUseEntry);var ESEntry=function(SystemUseEntry2){function ESEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)ESEntry2.__proto__=SystemUseEntry2;ESEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);ESEntry2.prototype.constructor=ESEntry2;ESEntry2.prototype.extensionSequence=function extensionSequence(){return this._data[4]};return ESEntry2}(SystemUseEntry);var RREntry=function(SystemUseEntry2){function RREntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)RREntry2.__proto__=SystemUseEntry2;RREntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);RREntry2.prototype.constructor=RREntry2;return RREntry2}(SystemUseEntry);var PXEntry=function(SystemUseEntry2){function PXEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)PXEntry2.__proto__=SystemUseEntry2;PXEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);PXEntry2.prototype.constructor=PXEntry2;PXEntry2.prototype.mode=function mode(){return this._data.readUInt32LE(4)};PXEntry2.prototype.fileLinks=function fileLinks(){return this._data.readUInt32LE(12)};PXEntry2.prototype.uid=function uid(){return this._data.readUInt32LE(20)};PXEntry2.prototype.gid=function gid(){return this._data.readUInt32LE(28)};PXEntry2.prototype.inode=function inode(){return this._data.readUInt32LE(36)};return PXEntry2}(SystemUseEntry);var PNEntry=function(SystemUseEntry2){function PNEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)PNEntry2.__proto__=SystemUseEntry2;PNEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);PNEntry2.prototype.constructor=PNEntry2;PNEntry2.prototype.devTHigh=function devTHigh(){return this._data.readUInt32LE(4)};PNEntry2.prototype.devTLow=function devTLow(){return this._data.readUInt32LE(12)};return PNEntry2}(SystemUseEntry);var SLEntry=function(SystemUseEntry2){function SLEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)SLEntry2.__proto__=SystemUseEntry2;SLEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);SLEntry2.prototype.constructor=SLEntry2;SLEntry2.prototype.flags=function flags(){return this._data[4]};SLEntry2.prototype.continueFlag=function continueFlag(){return this.flags()&1};SLEntry2.prototype.componentRecords=function componentRecords(){var this$1=this;var records=new Array;var i22=5;while(i22<this.length()){var record=new SLComponentRecord(this$1._data.slice(i22));records.push(record);i22+=record.length()}return records};return SLEntry2}(SystemUseEntry);var SLComponentRecord=function SLComponentRecord2(data){this._data=data};SLComponentRecord.prototype.flags=function flags(){return this._data[0]};SLComponentRecord.prototype.length=function length(){return 2+this.componentLength()};SLComponentRecord.prototype.componentLength=function componentLength(){return this._data[1]};SLComponentRecord.prototype.content=function content(getString){return getString(this._data,2,this.componentLength())};var NMEntry=function(SystemUseEntry2){function NMEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)NMEntry2.__proto__=SystemUseEntry2;NMEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);NMEntry2.prototype.constructor=NMEntry2;NMEntry2.prototype.flags=function flags(){return this._data[4]};NMEntry2.prototype.name=function name2(getString){return getString(this._data,5,this.length()-5)};return NMEntry2}(SystemUseEntry);var CLEntry=function(SystemUseEntry2){function CLEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)CLEntry2.__proto__=SystemUseEntry2;CLEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);CLEntry2.prototype.constructor=CLEntry2;CLEntry2.prototype.childDirectoryLba=function childDirectoryLba(){return this._data.readUInt32LE(4)};return CLEntry2}(SystemUseEntry);var PLEntry=function(SystemUseEntry2){function PLEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)PLEntry2.__proto__=SystemUseEntry2;PLEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);PLEntry2.prototype.constructor=PLEntry2;PLEntry2.prototype.parentDirectoryLba=function parentDirectoryLba(){return this._data.readUInt32LE(4)};return PLEntry2}(SystemUseEntry);var REEntry=function(SystemUseEntry2){function REEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)REEntry2.__proto__=SystemUseEntry2;REEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);REEntry2.prototype.constructor=REEntry2;return REEntry2}(SystemUseEntry);var TFEntry=function(SystemUseEntry2){function TFEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)TFEntry2.__proto__=SystemUseEntry2;TFEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);TFEntry2.prototype.constructor=TFEntry2;TFEntry2.prototype.flags=function flags(){return this._data[4]};TFEntry2.prototype.creation=function creation(){if(this.flags()&1){if(this._longFormDates()){return getDate(this._data,5)}else{return getShortFormDate(this._data,5)}}else{return null}};TFEntry2.prototype.modify=function modify(){if(this.flags()&2){var previousDates=this.flags()&1?1:0;if(this._longFormDates){return getDate(this._data,5+previousDates*17)}else{return getShortFormDate(this._data,5+previousDates*7)}}else{return null}};TFEntry2.prototype.access=function access(){if(this.flags()&4){var previousDates=this.flags()&1?1:0;previousDates+=this.flags()&2?1:0;if(this._longFormDates){return getDate(this._data,5+previousDates*17)}else{return getShortFormDate(this._data,5+previousDates*7)}}else{return null}};TFEntry2.prototype.backup=function backup(){if(this.flags()&16){var previousDates=this.flags()&1?1:0;previousDates+=this.flags()&2?1:0;previousDates+=this.flags()&4?1:0;if(this._longFormDates){return getDate(this._data,5+previousDates*17)}else{return getShortFormDate(this._data,5+previousDates*7)}}else{return null}};TFEntry2.prototype.expiration=function expiration(){if(this.flags()&32){var previousDates=this.flags()&1?1:0;previousDates+=this.flags()&2?1:0;previousDates+=this.flags()&4?1:0;previousDates+=this.flags()&16?1:0;if(this._longFormDates){return getDate(this._data,5+previousDates*17)}else{return getShortFormDate(this._data,5+previousDates*7)}}else{return null}};TFEntry2.prototype.effective=function effective(){if(this.flags()&64){var previousDates=this.flags()&1?1:0;previousDates+=this.flags()&2?1:0;previousDates+=this.flags()&4?1:0;previousDates+=this.flags()&16?1:0;previousDates+=this.flags()&32?1:0;if(this._longFormDates){return getDate(this._data,5+previousDates*17)}else{return getShortFormDate(this._data,5+previousDates*7)}}else{return null}};TFEntry2.prototype._longFormDates=function _longFormDates(){return!!(this.flags()&&128)};return TFEntry2}(SystemUseEntry);var SFEntry=function(SystemUseEntry2){function SFEntry2(data){SystemUseEntry2.call(this,data)}if(SystemUseEntry2)SFEntry2.__proto__=SystemUseEntry2;SFEntry2.prototype=Object.create(SystemUseEntry2&&SystemUseEntry2.prototype);SFEntry2.prototype.constructor=SFEntry2;SFEntry2.prototype.virtualSizeHigh=function virtualSizeHigh(){return this._data.readUInt32LE(4)};SFEntry2.prototype.virtualSizeLow=function virtualSizeLow(){return this._data.readUInt32LE(12)};SFEntry2.prototype.tableDepth=function tableDepth(){return this._data[20]};return SFEntry2}(SystemUseEntry);var Directory=function Directory2(record,isoData){var this$1=this;this._fileList=[];this._fileMap={};this._record=record;var i22=record.lba();var iLimit=i22+record.dataLength();if(!(record.fileFlags()&2)){var cl=record.getSUEntries(isoData).filter(function(e){return e instanceof CLEntry})[0];i22=cl.childDirectoryLba()*2048;iLimit=Infinity}while(i22<iLimit){var len=isoData[i22];if(len===0){i22++;continue}var r=this$1._constructDirectoryRecord(isoData.slice(i22));var fname=r.fileName(isoData);if(fname!=="\\0"&&fname!==""){if(!r.hasRockRidge()||r.getSUEntries(isoData).filter(function(e){return e instanceof REEntry}).length===0){this$1._fileMap[fname]=r;this$1._fileList.push(fname)}}else if(iLimit===Infinity){iLimit=i22+r.dataLength()}i22+=r.length()}};Directory.prototype.getRecord=function getRecord(name2){return this._fileMap[name2]};Directory.prototype.getFileList=function getFileList(){return this._fileList};Directory.prototype.getDotEntry=function getDotEntry(isoData){return this._constructDirectoryRecord(isoData.slice(this._record.lba()))};var ISODirectory=function(Directory2){function ISODirectory2(record,isoData){Directory2.call(this,record,isoData)}if(Directory2)ISODirectory2.__proto__=Directory2;ISODirectory2.prototype=Object.create(Directory2&&Directory2.prototype);ISODirectory2.prototype.constructor=ISODirectory2;ISODirectory2.prototype._constructDirectoryRecord=function _constructDirectoryRecord(data){return new ISODirectoryRecord(data,this._record.getRockRidgeOffset())};return ISODirectory2}(Directory);var JolietDirectory=function(Directory2){function JolietDirectory2(record,isoData){Directory2.call(this,record,isoData)}if(Directory2)JolietDirectory2.__proto__=Directory2;JolietDirectory2.prototype=Object.create(Directory2&&Directory2.prototype);JolietDirectory2.prototype.constructor=JolietDirectory2;JolietDirectory2.prototype._constructDirectoryRecord=function _constructDirectoryRecord(data){return new JolietDirectoryRecord(data,this._record.getRockRidgeOffset())};return JolietDirectory2}(Directory);var IsoFS=function(SynchronousFileSystem$$1){function IsoFS2(data,name2,deprecateMsg){var this$1=this;if(name2===void 0)name2="";if(deprecateMsg===void 0)deprecateMsg=true;SynchronousFileSystem$$1.call(this);this._data=data;deprecationMessage(deprecateMsg,IsoFS2.Name,{data:"ISO data as a Buffer",name:name2});var vdTerminatorFound=false;var i22=16*2048;var candidateVDs=new Array;while(!vdTerminatorFound){var slice=data.slice(i22);var vd=new VolumeDescriptor(slice);switch(vd.type()){case 1:candidateVDs.push(new PrimaryVolumeDescriptor(slice));break;case 2:candidateVDs.push(new SupplementaryVolumeDescriptor(slice));break;case 255:vdTerminatorFound=true;break}i22+=2048}if(candidateVDs.length===0){throw new ApiError(ErrorCode.EIO,"Unable to find a suitable volume descriptor.")}candidateVDs.forEach(function(v2){if(!this$1._pvd||this$1._pvd.type()!==2){this$1._pvd=v2}});this._root=this._pvd.rootDirectoryEntry(data);this._name=name2}if(SynchronousFileSystem$$1)IsoFS2.__proto__=SynchronousFileSystem$$1;IsoFS2.prototype=Object.create(SynchronousFileSystem$$1&&SynchronousFileSystem$$1.prototype);IsoFS2.prototype.constructor=IsoFS2;IsoFS2.Create=function Create(opts,cb){var fs4;var e;try{fs4=new IsoFS2(opts.data,opts.name,false)}catch(e2){e2=e2}finally{cb(e,fs4)}};IsoFS2.isAvailable=function isAvailable(){return true};IsoFS2.prototype.getName=function getName(){var name2="IsoFS"+this._name+(this._pvd?"-"+this._pvd.name():"");if(this._root&&this._root.hasRockRidge()){name2+="-RockRidge"}return name2};IsoFS2.prototype.diskSpace=function diskSpace(path$$1,cb){cb(this._data.length,0)};IsoFS2.prototype.isReadOnly=function isReadOnly(){return true};IsoFS2.prototype.supportsLinks=function supportsLinks(){return false};IsoFS2.prototype.supportsProps=function supportsProps(){return false};IsoFS2.prototype.supportsSynch=function supportsSynch(){return true};IsoFS2.prototype.statSync=function statSync(p2,isLstat){var record=this._getDirectoryRecord(p2);if(record===null){throw ApiError.ENOENT(p2)}return this._getStats(p2,record)};IsoFS2.prototype.openSync=function openSync(p2,flags,mode){if(flags.isWriteable()){throw new ApiError(ErrorCode.EPERM,p2)}var record=this._getDirectoryRecord(p2);if(!record){throw ApiError.ENOENT(p2)}else if(record.isSymlink(this._data)){return this.openSync(path.resolve(p2,record.getSymlinkPath(this._data)),flags,mode)}else if(!record.isDirectory(this._data)){var data=record.getFile(this._data);var stats=this._getStats(p2,record);switch(flags.pathExistsAction()){case ActionType.THROW_EXCEPTION:case ActionType.TRUNCATE_FILE:throw ApiError.EEXIST(p2);case ActionType.NOP:return new NoSyncFile(this,p2,flags,stats,data);default:throw new ApiError(ErrorCode.EINVAL,"Invalid FileMode object.")}}else{throw ApiError.EISDIR(p2)}};IsoFS2.prototype.readdirSync=function readdirSync(path$$1){var record=this._getDirectoryRecord(path$$1);if(!record){throw ApiError.ENOENT(path$$1)}else if(record.isDirectory(this._data)){return record.getDirectory(this._data).getFileList().slice(0)}else{throw ApiError.ENOTDIR(path$$1)}};IsoFS2.prototype.readFileSync=function readFileSync(fname,encoding,flag){var fd=this.openSync(fname,flag,420);try{var fdCast=fd;var fdBuff=fdCast.getBuffer();if(encoding===null){return copyingSlice(fdBuff)}return fdBuff.toString(encoding)}finally{fd.closeSync()}};IsoFS2.prototype._getDirectoryRecord=function _getDirectoryRecord(path$$1){var this$1=this;if(path$$1==="/"){return this._root}var components=path$$1.split("/").slice(1);var dir=this._root;for(var i22=0,list2=components;i22<list2.length;i22+=1){var component=list2[i22];if(dir.isDirectory(this$1._data)){dir=dir.getDirectory(this$1._data).getRecord(component);if(!dir){return null}}else{return null}}return dir};IsoFS2.prototype._getStats=function _getStats(p2,record){if(record.isSymlink(this._data)){var newP=path.resolve(p2,record.getSymlinkPath(this._data));var dirRec=this._getDirectoryRecord(newP);if(!dirRec){return null}return this._getStats(newP,dirRec)}else{var len=record.dataLength();var mode=365;var date=record.recordingDate();var atime=date;var mtime=date;var ctime=date;if(record.hasRockRidge()){var entries=record.getSUEntries(this._data);for(var i22=0,list2=entries;i22<list2.length;i22+=1){var entry=list2[i22];if(entry instanceof PXEntry){mode=entry.mode()}else if(entry instanceof TFEntry){var flags=entry.flags();if(flags&4){atime=entry.access()}if(flags&2){mtime=entry.modify()}if(flags&1){ctime=entry.creation()}}}}mode=mode&365;return new Stats(record.isDirectory(this._data)?FileType.DIRECTORY:FileType.FILE,len,mode,atime,mtime,ctime)}};return IsoFS2}(SynchronousFileSystem);IsoFS.Name="IsoFS";IsoFS.Options={data:{type:"object",description:"The ISO file in a buffer",validator:bufferValidator}};[AsyncMirror,DropboxFileSystem,EmscriptenFileSystem,FolderAdapter,HTML5FS,InMemoryFileSystem,IndexedDBFileSystem,IsoFS,LocalStorageFileSystem,MountableFileSystem,OverlayFS,WorkerFS,XmlHttpRequest,ZipFS].forEach(function(fsType){var create=fsType.Create;fsType.Create=function(opts,cb){var oneArg=typeof opts==="function";var normalizedCb=oneArg?opts:cb;var normalizedOpts=oneArg?{}:opts;function wrappedCb(e){if(e){normalizedCb(e)}else{create.call(fsType,normalizedOpts,normalizedCb)}}checkOptions(fsType,normalizedOpts,wrappedCb)}});var Backends={AsyncMirror,Dropbox:DropboxFileSystem,Emscripten:EmscriptenFileSystem,FolderAdapter,HTML5FS,InMemory:InMemoryFileSystem,IndexedDB:IndexedDBFileSystem,IsoFS,LocalStorage:LocalStorageFileSystem,MountableFileSystem,OverlayFS,WorkerFS,XmlHttpRequest,ZipFS};if(process["initializeTTYs"]){process["initializeTTYs"]()}function install(obj){obj.Buffer=Buffer2;obj.process=process;var oldRequire=obj.require?obj.require:null;obj.require=function(arg){var rv=BFSRequire2(arg);if(!rv){return oldRequire.apply(null,Array.prototype.slice.call(arguments,0))}else{return rv}}}function registerFileSystem(name2,fs4){Backends[name2]=fs4}function BFSRequire2(module4){switch(module4){case"fs":return _fsMock;case"path":return path;case"buffer":return buffer;case"process":return process;case"bfs_utils":return BFSUtils;default:return Backends[module4]}}function initialize2(rootfs){return _fsMock.initialize(rootfs)}function configure(config,cb){getFileSystem(config,function(e,fs4){if(fs4){initialize2(fs4);cb()}else{cb(e)}})}function getFileSystem(config,cb){var fsName=config["fs"];if(!fsName){return cb(new ApiError(ErrorCode.EPERM,\'Missing "fs" property on configuration object.\'))}var options=config["options"];var waitCount=0;var called=false;function finish(){if(!called){called=true;var fsc=Backends[fsName];if(!fsc){cb(new ApiError(ErrorCode.EPERM,"File system "+fsName+" is not available in BrowserFS."))}else{fsc.Create(options,cb)}}}if(options!==null&&typeof options==="object"){var finishedIterating=false;var props=Object.keys(options).filter(function(k){return k!=="fs"});props.forEach(function(p2){var d2=options[p2];if(d2!==null&&typeof d2==="object"&&d2["fs"]){waitCount++;getFileSystem(d2,function(e,fs4){waitCount--;if(e){if(called){return}called=true;cb(e)}else{options[p2]=fs4;if(waitCount===0&&finishedIterating){finish()}}})}});finishedIterating=true}if(waitCount===0){finish()}}if("ab".substr(-1)!=="b"){String.prototype.substr=function(substr){return function(start,length){if(start<0){start=this.length+start}return substr.call(this,start,length)}}(String.prototype.substr)}if(typeof ArrayBuffer!=="undefined"&&typeof Uint8Array!=="undefined"){if(!Uint8Array.prototype["slice"]){Uint8Array.prototype.slice=function(start,end){if(start===void 0)start=0;if(end===void 0)end=this.length;var self2=this;if(start<0){start=this.length+start;if(start<0){start=0}}if(end<0){end=this.length+end;if(end<0){end=0}}if(end<start){end=start}return new Uint8Array(self2.buffer,self2.byteOffset+start,end-start)}}}exports2.install=install;exports2.registerFileSystem=registerFileSystem;exports2.BFSRequire=BFSRequire2;exports2.initialize=initialize2;exports2.configure=configure;exports2.getFileSystem=getFileSystem;exports2.EmscriptenFS=BFSEmscriptenFS;exports2.FileSystem=Backends;exports2.Errors=api_error;exports2.setImmediate=setImmediate$3}).call(exports2,__webpack_require__(1),function(){return this}(),__webpack_require__(5)(module22),__webpack_require__(6))},function(module22,exports2,__webpack_require__){module22.exports=__webpack_require__(2).Buffer},function(module22,exports2,__webpack_require__){(function(Buffer2){"use strict";var base64=__webpack_require__(3);var ieee754=__webpack_require__(4);exports2.Buffer=Buffer2;exports2.SlowBuffer=SlowBuffer;exports2.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;exports2.kMaxLength=K_MAX_LENGTH;Buffer2.TYPED_ARRAY_SUPPORT=typedArraySupport();if(!Buffer2.TYPED_ARRAY_SUPPORT&&typeof console!=="undefined"&&typeof console.error==="function"){console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.")}function typedArraySupport(){try{var arr=new Uint8Array(1);arr.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}};return arr.foo()===42}catch(e){return false}}function createBuffer(length){if(length>K_MAX_LENGTH){throw new RangeError("Invalid typed array length")}var buf=new Uint8Array(length);buf.__proto__=Buffer2.prototype;return buf}function Buffer2(arg,encodingOrOffset,length){if(typeof arg==="number"){if(typeof encodingOrOffset==="string"){throw new Error("If encoding is specified then the first argument must be a string")}return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}if(typeof Symbol!=="undefined"&&Symbol.species&&Buffer2[Symbol.species]===Buffer2){Object.defineProperty(Buffer2,Symbol.species,{value:null,configurable:true,enumerable:false,writable:false})}Buffer2.poolSize=8192;function from(value,encodingOrOffset,length){if(typeof value==="number"){throw new TypeError(\'"value" argument must not be a number\')}if(isArrayBuffer(value)){return fromArrayBuffer(value,encodingOrOffset,length)}if(typeof value==="string"){return fromString(value,encodingOrOffset)}return fromObject(value)}Buffer2.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)};Buffer2.prototype.__proto__=Uint8Array.prototype;Buffer2.__proto__=Uint8Array;function assertSize(size){if(typeof size!=="number"){throw new TypeError(\'"size" argument must be a number\')}else if(size<0){throw new RangeError(\'"size" argument must not be negative\')}}function alloc(size,fill,encoding){assertSize(size);if(size<=0){return createBuffer(size)}if(fill!==void 0){return typeof encoding==="string"?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill)}return createBuffer(size)}Buffer2.alloc=function(size,fill,encoding){return alloc(size,fill,encoding)};function allocUnsafe(size){assertSize(size);return createBuffer(size<0?0:checked(size)|0)}Buffer2.allocUnsafe=function(size){return allocUnsafe(size)};Buffer2.allocUnsafeSlow=function(size){return allocUnsafe(size)};function fromString(string,encoding){if(typeof encoding!=="string"||encoding===""){encoding="utf8"}if(!Buffer2.isEncoding(encoding)){throw new TypeError(\'"encoding" must be a valid string encoding\')}var length=byteLength(string,encoding)|0;var buf=createBuffer(length);var actual=buf.write(string,encoding);if(actual!==length){buf=buf.slice(0,actual)}return buf}function fromArrayLike(array){var length=array.length<0?0:checked(array.length)|0;var buf=createBuffer(length);for(var i3=0;i3<length;i3+=1){buf[i3]=array[i3]&255}return buf}function fromArrayBuffer(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset){throw new RangeError("\'offset\' is out of bounds")}if(array.byteLength<byteOffset+(length||0)){throw new RangeError("\'length\' is out of bounds")}var buf;if(byteOffset===void 0&&length===void 0){buf=new Uint8Array(array)}else if(length===void 0){buf=new Uint8Array(array,byteOffset)}else{buf=new Uint8Array(array,byteOffset,length)}buf.__proto__=Buffer2.prototype;return buf}function fromObject(obj){if(Buffer2.isBuffer(obj)){var len=checked(obj.length)|0;var buf=createBuffer(len);if(buf.length===0){return buf}obj.copy(buf,0,0,len);return buf}if(obj){if(isArrayBufferView(obj)||"length"in obj){if(typeof obj.length!=="number"||numberIsNaN(obj.length)){return createBuffer(0)}return fromArrayLike(obj)}if(obj.type==="Buffer"&&Array.isArray(obj.data)){return fromArrayLike(obj.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function checked(length){if(length>=K_MAX_LENGTH){throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+K_MAX_LENGTH.toString(16)+" bytes")}return length|0}function SlowBuffer(length){if(+length!=length){length=0}return Buffer2.alloc(+length)}Buffer2.isBuffer=function isBuffer(b){return b!=null&&b._isBuffer===true};Buffer2.compare=function compare(a,b){if(!Buffer2.isBuffer(a)||!Buffer2.isBuffer(b)){throw new TypeError("Arguments must be Buffers")}if(a===b)return 0;var x3=a.length;var y4=b.length;for(var i3=0,len=Math.min(x3,y4);i3<len;++i3){if(a[i3]!==b[i3]){x3=a[i3];y4=b[i3];break}}if(x3<y4)return-1;if(y4<x3)return 1;return 0};Buffer2.isEncoding=function isEncoding(encoding){switch(String(encoding).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return true;default:return false}};Buffer2.concat=function concat(list,length){if(!Array.isArray(list)){throw new TypeError(\'"list" argument must be an Array of Buffers\')}if(list.length===0){return Buffer2.alloc(0)}var i3;if(length===void 0){length=0;for(i3=0;i3<list.length;++i3){length+=list[i3].length}}var buffer=Buffer2.allocUnsafe(length);var pos=0;for(i3=0;i3<list.length;++i3){var buf=list[i3];if(!Buffer2.isBuffer(buf)){throw new TypeError(\'"list" argument must be an Array of Buffers\')}buf.copy(buffer,pos);pos+=buf.length}return buffer};function byteLength(string,encoding){if(Buffer2.isBuffer(string)){return string.length}if(isArrayBufferView(string)||isArrayBuffer(string)){return string.byteLength}if(typeof string!=="string"){string=""+string}var len=string.length;if(len===0)return 0;var loweredCase=false;for(;;){switch(encoding){case"ascii":case"latin1":case"binary":return len;case"utf8":case"utf-8":case void 0:return utf8ToBytes(string).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return len*2;case"hex":return len>>>1;case"base64":return base64ToBytes(string).length;default:if(loweredCase)return utf8ToBytes(string).length;encoding=(""+encoding).toLowerCase();loweredCase=true}}}Buffer2.byteLength=byteLength;function slowToString(encoding,start,end){var loweredCase=false;if(start===void 0||start<0){start=0}if(start>this.length){return""}if(end===void 0||end>this.length){end=this.length}if(end<=0){return""}end>>>=0;start>>>=0;if(end<=start){return""}if(!encoding)encoding="utf8";while(true){switch(encoding){case"hex":return hexSlice(this,start,end);case"utf8":case"utf-8":return utf8Slice(this,start,end);case"ascii":return asciiSlice(this,start,end);case"latin1":case"binary":return latin1Slice(this,start,end);case"base64":return base64Slice(this,start,end);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(encoding+"").toLowerCase();loweredCase=true}}}Buffer2.prototype._isBuffer=true;function swap(b,n,m){var i3=b[n];b[n]=b[m];b[m]=i3}Buffer2.prototype.swap16=function swap16(){var len=this.length;if(len%2!==0){throw new RangeError("Buffer size must be a multiple of 16-bits")}for(var i3=0;i3<len;i3+=2){swap(this,i3,i3+1)}return this};Buffer2.prototype.swap32=function swap32(){var len=this.length;if(len%4!==0){throw new RangeError("Buffer size must be a multiple of 32-bits")}for(var i3=0;i3<len;i3+=4){swap(this,i3,i3+3);swap(this,i3+1,i3+2)}return this};Buffer2.prototype.swap64=function swap64(){var len=this.length;if(len%8!==0){throw new RangeError("Buffer size must be a multiple of 64-bits")}for(var i3=0;i3<len;i3+=8){swap(this,i3,i3+7);swap(this,i3+1,i3+6);swap(this,i3+2,i3+5);swap(this,i3+3,i3+4)}return this};Buffer2.prototype.toString=function toString(){var length=this.length;if(length===0)return"";if(arguments.length===0)return utf8Slice(this,0,length);return slowToString.apply(this,arguments)};Buffer2.prototype.equals=function equals(b){if(!Buffer2.isBuffer(b))throw new TypeError("Argument must be a Buffer");if(this===b)return true;return Buffer2.compare(this,b)===0};Buffer2.prototype.inspect=function inspect(){var str4="";var max=exports2.INSPECT_MAX_BYTES;if(this.length>0){str4=this.toString("hex",0,max).match(/.{2}/g).join(" ");if(this.length>max)str4+=" ... "}return"<Buffer "+str4+">"};Buffer2.prototype.compare=function compare(target,start,end,thisStart,thisEnd){if(!Buffer2.isBuffer(target)){throw new TypeError("Argument must be a Buffer")}if(start===void 0){start=0}if(end===void 0){end=target?target.length:0}if(thisStart===void 0){thisStart=0}if(thisEnd===void 0){thisEnd=this.length}if(start<0||end>target.length||thisStart<0||thisEnd>this.length){throw new RangeError("out of range index")}if(thisStart>=thisEnd&&start>=end){return 0}if(thisStart>=thisEnd){return-1}if(start>=end){return 1}start>>>=0;end>>>=0;thisStart>>>=0;thisEnd>>>=0;if(this===target)return 0;var x3=thisEnd-thisStart;var y4=end-start;var len=Math.min(x3,y4);var thisCopy=this.slice(thisStart,thisEnd);var targetCopy=target.slice(start,end);for(var i3=0;i3<len;++i3){if(thisCopy[i3]!==targetCopy[i3]){x3=thisCopy[i3];y4=targetCopy[i3];break}}if(x3<y4)return-1;if(y4<x3)return 1;return 0};function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(buffer.length===0)return-1;if(typeof byteOffset==="string"){encoding=byteOffset;byteOffset=0}else if(byteOffset>2147483647){byteOffset=2147483647}else if(byteOffset<-2147483648){byteOffset=-2147483648}byteOffset=+byteOffset;if(numberIsNaN(byteOffset)){byteOffset=dir?0:buffer.length-1}if(byteOffset<0)byteOffset=buffer.length+byteOffset;if(byteOffset>=buffer.length){if(dir)return-1;else byteOffset=buffer.length-1}else if(byteOffset<0){if(dir)byteOffset=0;else return-1}if(typeof val==="string"){val=Buffer2.from(val,encoding)}if(Buffer2.isBuffer(val)){if(val.length===0){return-1}return arrayIndexOf(buffer,val,byteOffset,encoding,dir)}else if(typeof val==="number"){val=val&255;if(typeof Uint8Array.prototype.indexOf==="function"){if(dir){return Uint8Array.prototype.indexOf.call(buffer,val,byteOffset)}else{return Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset)}}return arrayIndexOf(buffer,[val],byteOffset,encoding,dir)}throw new TypeError("val must be string, number or Buffer")}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var indexSize=1;var arrLength=arr.length;var valLength=val.length;if(encoding!==void 0){encoding=String(encoding).toLowerCase();if(encoding==="ucs2"||encoding==="ucs-2"||encoding==="utf16le"||encoding==="utf-16le"){if(arr.length<2||val.length<2){return-1}indexSize=2;arrLength/=2;valLength/=2;byteOffset/=2}}function read(buf,i22){if(indexSize===1){return buf[i22]}else{return buf.readUInt16BE(i22*indexSize)}}var i3;if(dir){var foundIndex=-1;for(i3=byteOffset;i3<arrLength;i3++){if(read(arr,i3)===read(val,foundIndex===-1?0:i3-foundIndex)){if(foundIndex===-1)foundIndex=i3;if(i3-foundIndex+1===valLength)return foundIndex*indexSize}else{if(foundIndex!==-1)i3-=i3-foundIndex;foundIndex=-1}}}else{if(byteOffset+valLength>arrLength)byteOffset=arrLength-valLength;for(i3=byteOffset;i3>=0;i3--){var found=true;for(var j=0;j<valLength;j++){if(read(arr,i3+j)!==read(val,j)){found=false;break}}if(found)return i3}}return-1}Buffer2.prototype.includes=function includes(val,byteOffset,encoding){return this.indexOf(val,byteOffset,encoding)!==-1};Buffer2.prototype.indexOf=function indexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,true)};Buffer2.prototype.lastIndexOf=function lastIndexOf(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,false)};function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;if(!length){length=remaining}else{length=Number(length);if(length>remaining){length=remaining}}var strLen=string.length;if(strLen%2!==0)throw new TypeError("Invalid hex string");if(length>strLen/2){length=strLen/2}for(var i3=0;i3<length;++i3){var parsed=parseInt(string.substr(i3*2,2),16);if(numberIsNaN(parsed))return i3;buf[offset+i3]=parsed}return i3}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(asciiToBytes(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(utf16leToBytes(string,buf.length-offset),buf,offset,length)}Buffer2.prototype.write=function write(string,offset,length,encoding){if(offset===void 0){encoding="utf8";length=this.length;offset=0}else if(length===void 0&&typeof offset==="string"){encoding=offset;length=this.length;offset=0}else if(isFinite(offset)){offset=offset>>>0;if(isFinite(length)){length=length>>>0;if(encoding===void 0)encoding="utf8"}else{encoding=length;length=void 0}}else{throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported")}var remaining=this.length-offset;if(length===void 0||length>remaining)length=remaining;if(string.length>0&&(length<0||offset<0)||offset>this.length){throw new RangeError("Attempt to write outside buffer bounds")}if(!encoding)encoding="utf8";var loweredCase=false;for(;;){switch(encoding){case"hex":return hexWrite(this,string,offset,length);case"utf8":case"utf-8":return utf8Write(this,string,offset,length);case"ascii":return asciiWrite(this,string,offset,length);case"latin1":case"binary":return latin1Write(this,string,offset,length);case"base64":return base64Write(this,string,offset,length);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError("Unknown encoding: "+encoding);encoding=(""+encoding).toLowerCase();loweredCase=true}}};Buffer2.prototype.toJSON=function toJSON(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function base64Slice(buf,start,end){if(start===0&&end===buf.length){return base64.fromByteArray(buf)}else{return base64.fromByteArray(buf.slice(start,end))}}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);var res=[];var i3=start;while(i3<end){var firstByte=buf[i3];var codePoint=null;var bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i3+bytesPerSequence<=end){var secondByte,thirdByte,fourthByte,tempCodePoint;switch(bytesPerSequence){case 1:if(firstByte<128){codePoint=firstByte}break;case 2:secondByte=buf[i3+1];if((secondByte&192)===128){tempCodePoint=(firstByte&31)<<6|secondByte&63;if(tempCodePoint>127){codePoint=tempCodePoint}}break;case 3:secondByte=buf[i3+1];thirdByte=buf[i3+2];if((secondByte&192)===128&&(thirdByte&192)===128){tempCodePoint=(firstByte&15)<<12|(secondByte&63)<<6|thirdByte&63;if(tempCodePoint>2047&&(tempCodePoint<55296||tempCodePoint>57343)){codePoint=tempCodePoint}}break;case 4:secondByte=buf[i3+1];thirdByte=buf[i3+2];fourthByte=buf[i3+3];if((secondByte&192)===128&&(thirdByte&192)===128&&(fourthByte&192)===128){tempCodePoint=(firstByte&15)<<18|(secondByte&63)<<12|(thirdByte&63)<<6|fourthByte&63;if(tempCodePoint>65535&&tempCodePoint<1114112){codePoint=tempCodePoint}}}}if(codePoint===null){codePoint=65533;bytesPerSequence=1}else if(codePoint>65535){codePoint-=65536;res.push(codePoint>>>10&1023|55296);codePoint=56320|codePoint&1023}res.push(codePoint);i3+=bytesPerSequence}return decodeCodePointsArray(res)}var MAX_ARGUMENTS_LENGTH=4096;function decodeCodePointsArray(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH){return String.fromCharCode.apply(String,codePoints)}var res="";var i3=0;while(i3<len){res+=String.fromCharCode.apply(String,codePoints.slice(i3,i3+=MAX_ARGUMENTS_LENGTH))}return res}function asciiSlice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i3=start;i3<end;++i3){ret+=String.fromCharCode(buf[i3]&127)}return ret}function latin1Slice(buf,start,end){var ret="";end=Math.min(buf.length,end);for(var i3=start;i3<end;++i3){ret+=String.fromCharCode(buf[i3])}return ret}function hexSlice(buf,start,end){var len=buf.length;if(!start||start<0)start=0;if(!end||end<0||end>len)end=len;var out="";for(var i3=start;i3<end;++i3){out+=toHex(buf[i3])}return out}function utf16leSlice(buf,start,end){var bytes=buf.slice(start,end);var res="";for(var i3=0;i3<bytes.length;i3+=2){res+=String.fromCharCode(bytes[i3]+bytes[i3+1]*256)}return res}Buffer2.prototype.slice=function slice(start,end){var len=this.length;start=~~start;end=end===void 0?len:~~end;if(start<0){start+=len;if(start<0)start=0}else if(start>len){start=len}if(end<0){end+=len;if(end<0)end=0}else if(end>len){end=len}if(end<start)end=start;var newBuf=this.subarray(start,end);newBuf.__proto__=Buffer2.prototype;return newBuf};function checkOffset(offset,ext,length){if(offset%1!==0||offset<0)throw new RangeError("offset is not uint");if(offset+ext>length)throw new RangeError("Trying to access beyond buffer length")}Buffer2.prototype.readUIntLE=function readUIntLE(offset,byteLength2,noAssert){offset=offset>>>0;byteLength2=byteLength2>>>0;if(!noAssert)checkOffset(offset,byteLength2,this.length);var val=this[offset];var mul=1;var i3=0;while(++i3<byteLength2&&(mul*=256)){val+=this[offset+i3]*mul}return val};Buffer2.prototype.readUIntBE=function readUIntBE(offset,byteLength2,noAssert){offset=offset>>>0;byteLength2=byteLength2>>>0;if(!noAssert){checkOffset(offset,byteLength2,this.length)}var val=this[offset+--byteLength2];var mul=1;while(byteLength2>0&&(mul*=256)){val+=this[offset+--byteLength2]*mul}return val};Buffer2.prototype.readUInt8=function readUInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);return this[offset]};Buffer2.prototype.readUInt16LE=function readUInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]|this[offset+1]<<8};Buffer2.prototype.readUInt16BE=function readUInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);return this[offset]<<8|this[offset+1]};Buffer2.prototype.readUInt32LE=function readUInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+this[offset+3]*16777216};Buffer2.prototype.readUInt32BE=function readUInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]*16777216+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])};Buffer2.prototype.readIntLE=function readIntLE(offset,byteLength2,noAssert){offset=offset>>>0;byteLength2=byteLength2>>>0;if(!noAssert)checkOffset(offset,byteLength2,this.length);var val=this[offset];var mul=1;var i3=0;while(++i3<byteLength2&&(mul*=256)){val+=this[offset+i3]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength2);return val};Buffer2.prototype.readIntBE=function readIntBE(offset,byteLength2,noAssert){offset=offset>>>0;byteLength2=byteLength2>>>0;if(!noAssert)checkOffset(offset,byteLength2,this.length);var i3=byteLength2;var mul=1;var val=this[offset+--i3];while(i3>0&&(mul*=256)){val+=this[offset+--i3]*mul}mul*=128;if(val>=mul)val-=Math.pow(2,8*byteLength2);return val};Buffer2.prototype.readInt8=function readInt8(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,1,this.length);if(!(this[offset]&128))return this[offset];return(255-this[offset]+1)*-1};Buffer2.prototype.readInt16LE=function readInt16LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return val&32768?val|4294901760:val};Buffer2.prototype.readInt16BE=function readInt16BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return val&32768?val|4294901760:val};Buffer2.prototype.readInt32LE=function readInt32LE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24};Buffer2.prototype.readInt32BE=function readInt32BE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]};Buffer2.prototype.readFloatLE=function readFloatLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,true,23,4)};Buffer2.prototype.readFloatBE=function readFloatBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,4,this.length);return ieee754.read(this,offset,false,23,4)};Buffer2.prototype.readDoubleLE=function readDoubleLE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,true,52,8)};Buffer2.prototype.readDoubleBE=function readDoubleBE(offset,noAssert){offset=offset>>>0;if(!noAssert)checkOffset(offset,8,this.length);return ieee754.read(this,offset,false,52,8)};function checkInt(buf,value,offset,ext,max,min){if(!Buffer2.isBuffer(buf))throw new TypeError(\'"buffer" argument must be a Buffer instance\');if(value>max||value<min)throw new RangeError(\'"value" argument is out of bounds\');if(offset+ext>buf.length)throw new RangeError("Index out of range")}Buffer2.prototype.writeUIntLE=function writeUIntLE(value,offset,byteLength2,noAssert){value=+value;offset=offset>>>0;byteLength2=byteLength2>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength2)-1;checkInt(this,value,offset,byteLength2,maxBytes,0)}var mul=1;var i3=0;this[offset]=value&255;while(++i3<byteLength2&&(mul*=256)){this[offset+i3]=value/mul&255}return offset+byteLength2};Buffer2.prototype.writeUIntBE=function writeUIntBE(value,offset,byteLength2,noAssert){value=+value;offset=offset>>>0;byteLength2=byteLength2>>>0;if(!noAssert){var maxBytes=Math.pow(2,8*byteLength2)-1;checkInt(this,value,offset,byteLength2,maxBytes,0)}var i3=byteLength2-1;var mul=1;this[offset+i3]=value&255;while(--i3>=0&&(mul*=256)){this[offset+i3]=value/mul&255}return offset+byteLength2};Buffer2.prototype.writeUInt8=function writeUInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,255,0);this[offset]=value&255;return offset+1};Buffer2.prototype.writeUInt16LE=function writeUInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer2.prototype.writeUInt16BE=function writeUInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,65535,0);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer2.prototype.writeUInt32LE=function writeUInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset+3]=value>>>24;this[offset+2]=value>>>16;this[offset+1]=value>>>8;this[offset]=value&255;return offset+4};Buffer2.prototype.writeUInt32BE=function writeUInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,4294967295,0);this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};Buffer2.prototype.writeIntLE=function writeIntLE(value,offset,byteLength2,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength2-1);checkInt(this,value,offset,byteLength2,limit-1,-limit)}var i3=0;var mul=1;var sub=0;this[offset]=value&255;while(++i3<byteLength2&&(mul*=256)){if(value<0&&sub===0&&this[offset+i3-1]!==0){sub=1}this[offset+i3]=(value/mul>>0)-sub&255}return offset+byteLength2};Buffer2.prototype.writeIntBE=function writeIntBE(value,offset,byteLength2,noAssert){value=+value;offset=offset>>>0;if(!noAssert){var limit=Math.pow(2,8*byteLength2-1);checkInt(this,value,offset,byteLength2,limit-1,-limit)}var i3=byteLength2-1;var mul=1;var sub=0;this[offset+i3]=value&255;while(--i3>=0&&(mul*=256)){if(value<0&&sub===0&&this[offset+i3+1]!==0){sub=1}this[offset+i3]=(value/mul>>0)-sub&255}return offset+byteLength2};Buffer2.prototype.writeInt8=function writeInt8(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,1,127,-128);if(value<0)value=255+value+1;this[offset]=value&255;return offset+1};Buffer2.prototype.writeInt16LE=function writeInt16LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value&255;this[offset+1]=value>>>8;return offset+2};Buffer2.prototype.writeInt16BE=function writeInt16BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,2,32767,-32768);this[offset]=value>>>8;this[offset+1]=value&255;return offset+2};Buffer2.prototype.writeInt32LE=function writeInt32LE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);this[offset]=value&255;this[offset+1]=value>>>8;this[offset+2]=value>>>16;this[offset+3]=value>>>24;return offset+4};Buffer2.prototype.writeInt32BE=function writeInt32BE(value,offset,noAssert){value=+value;offset=offset>>>0;if(!noAssert)checkInt(this,value,offset,4,2147483647,-2147483648);if(value<0)value=4294967295+value+1;this[offset]=value>>>24;this[offset+1]=value>>>16;this[offset+2]=value>>>8;this[offset+3]=value&255;return offset+4};function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError("Index out of range");if(offset<0)throw new RangeError("Index out of range")}function writeFloat(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,4,34028234663852886e22,-34028234663852886e22)}ieee754.write(buf,value,offset,littleEndian,23,4);return offset+4}Buffer2.prototype.writeFloatLE=function writeFloatLE(value,offset,noAssert){return writeFloat(this,value,offset,true,noAssert)};Buffer2.prototype.writeFloatBE=function writeFloatBE(value,offset,noAssert){return writeFloat(this,value,offset,false,noAssert)};function writeDouble(buf,value,offset,littleEndian,noAssert){value=+value;offset=offset>>>0;if(!noAssert){checkIEEE754(buf,value,offset,8,17976931348623157e292,-17976931348623157e292)}ieee754.write(buf,value,offset,littleEndian,52,8);return offset+8}Buffer2.prototype.writeDoubleLE=function writeDoubleLE(value,offset,noAssert){return writeDouble(this,value,offset,true,noAssert)};Buffer2.prototype.writeDoubleBE=function writeDoubleBE(value,offset,noAssert){return writeDouble(this,value,offset,false,noAssert)};Buffer2.prototype.copy=function copy(target,targetStart,start,end){if(!start)start=0;if(!end&&end!==0)end=this.length;if(targetStart>=target.length)targetStart=target.length;if(!targetStart)targetStart=0;if(end>0&&end<start)end=start;if(end===start)return 0;if(target.length===0||this.length===0)return 0;if(targetStart<0){throw new RangeError("targetStart out of bounds")}if(start<0||start>=this.length)throw new RangeError("sourceStart out of bounds");if(end<0)throw new RangeError("sourceEnd out of bounds");if(end>this.length)end=this.length;if(target.length-targetStart<end-start){end=target.length-targetStart+start}var len=end-start;var i3;if(this===target&&start<targetStart&&targetStart<end){for(i3=len-1;i3>=0;--i3){target[i3+targetStart]=this[i3+start]}}else if(len<1e3){for(i3=0;i3<len;++i3){target[i3+targetStart]=this[i3+start]}}else{Uint8Array.prototype.set.call(target,this.subarray(start,start+len),targetStart)}return len};Buffer2.prototype.fill=function fill(val,start,end,encoding){if(typeof val==="string"){if(typeof start==="string"){encoding=start;start=0;end=this.length}else if(typeof end==="string"){encoding=end;end=this.length}if(val.length===1){var code=val.charCodeAt(0);if(code<256){val=code}}if(encoding!==void 0&&typeof encoding!=="string"){throw new TypeError("encoding must be a string")}if(typeof encoding==="string"&&!Buffer2.isEncoding(encoding)){throw new TypeError("Unknown encoding: "+encoding)}}else if(typeof val==="number"){val=val&255}if(start<0||this.length<start||this.length<end){throw new RangeError("Out of range index")}if(end<=start){return this}start=start>>>0;end=end===void 0?this.length:end>>>0;if(!val)val=0;var i3;if(typeof val==="number"){for(i3=start;i3<end;++i3){this[i3]=val}}else{var bytes=Buffer2.isBuffer(val)?val:new Buffer2(val,encoding);var len=bytes.length;for(i3=0;i3<end-start;++i3){this[i3+start]=bytes[i3%len]}}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function base64clean(str4){str4=str4.trim().replace(INVALID_BASE64_RE,"");if(str4.length<2)return"";while(str4.length%4!==0){str4=str4+"="}return str4}function toHex(n){if(n<16)return"0"+n.toString(16);return n.toString(16)}function utf8ToBytes(string,units){units=units||Infinity;var codePoint;var length=string.length;var leadSurrogate=null;var bytes=[];for(var i3=0;i3<length;++i3){codePoint=string.charCodeAt(i3);if(codePoint>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){if((units-=3)>-1)bytes.push(239,191,189);continue}else if(i3+1===length){if((units-=3)>-1)bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){if((units-=3)>-1)bytes.push(239,191,189);leadSurrogate=codePoint;continue}codePoint=(leadSurrogate-55296<<10|codePoint-56320)+65536}else if(leadSurrogate){if((units-=3)>-1)bytes.push(239,191,189)}leadSurrogate=null;if(codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,codePoint&63|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,codePoint&63|128)}else if(codePoint<1114112){if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,codePoint&63|128)}else{throw new Error("Invalid code point")}}return bytes}function asciiToBytes(str4){var byteArray=[];for(var i3=0;i3<str4.length;++i3){byteArray.push(str4.charCodeAt(i3)&255)}return byteArray}function utf16leToBytes(str4,units){var c,hi,lo;var byteArray=[];for(var i3=0;i3<str4.length;++i3){if((units-=2)<0)break;c=str4.charCodeAt(i3);hi=c>>8;lo=c%256;byteArray.push(lo);byteArray.push(hi)}return byteArray}function base64ToBytes(str4){return base64.toByteArray(base64clean(str4))}function blitBuffer(src,dst,offset,length){for(var i3=0;i3<length;++i3){if(i3+offset>=dst.length||i3>=src.length)break;dst[i3+offset]=src[i3]}return i3}function isArrayBuffer(obj){return obj instanceof ArrayBuffer||obj!=null&&obj.constructor!=null&&obj.constructor.name==="ArrayBuffer"&&typeof obj.byteLength==="number"}function isArrayBufferView(obj){return typeof ArrayBuffer.isView==="function"&&ArrayBuffer.isView(obj)}function numberIsNaN(obj){return obj!==obj}}).call(exports2,__webpack_require__(1))},function(module22,exports2){"use strict";exports2.byteLength=byteLength;exports2.toByteArray=toByteArray;exports2.fromByteArray=fromByteArray;var lookup=[];var revLookup=[];var Arr=typeof Uint8Array!=="undefined"?Uint8Array:Array;var code="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var i3=0,len=code.length;i3<len;++i3){lookup[i3]=code[i3];revLookup[code.charCodeAt(i3)]=i3}revLookup["-".charCodeAt(0)]=62;revLookup["_".charCodeAt(0)]=63;function placeHoldersCount(b64){var len2=b64.length;if(len2%4>0){throw new Error("Invalid string. Length must be a multiple of 4")}return b64[len2-2]==="="?2:b64[len2-1]==="="?1:0}function byteLength(b64){return b64.length*3/4-placeHoldersCount(b64)}function toByteArray(b64){var i22,j,l,tmp,placeHolders,arr;var len2=b64.length;placeHolders=placeHoldersCount(b64);arr=new Arr(len2*3/4-placeHolders);l=placeHolders>0?len2-4:len2;var L2=0;for(i22=0,j=0;i22<l;i22+=4,j+=3){tmp=revLookup[b64.charCodeAt(i22)]<<18|revLookup[b64.charCodeAt(i22+1)]<<12|revLookup[b64.charCodeAt(i22+2)]<<6|revLookup[b64.charCodeAt(i22+3)];arr[L2++]=tmp>>16&255;arr[L2++]=tmp>>8&255;arr[L2++]=tmp&255}if(placeHolders===2){tmp=revLookup[b64.charCodeAt(i22)]<<2|revLookup[b64.charCodeAt(i22+1)]>>4;arr[L2++]=tmp&255}else if(placeHolders===1){tmp=revLookup[b64.charCodeAt(i22)]<<10|revLookup[b64.charCodeAt(i22+1)]<<4|revLookup[b64.charCodeAt(i22+2)]>>2;arr[L2++]=tmp>>8&255;arr[L2++]=tmp&255}return arr}function tripletToBase64(num){return lookup[num>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[num&63]}function encodeChunk(uint8,start,end){var tmp;var output=[];for(var i22=start;i22<end;i22+=3){tmp=(uint8[i22]<<16)+(uint8[i22+1]<<8)+uint8[i22+2];output.push(tripletToBase64(tmp))}return output.join("")}function fromByteArray(uint8){var tmp;var len2=uint8.length;var extraBytes=len2%3;var output="";var parts=[];var maxChunkLength=16383;for(var i22=0,len22=len2-extraBytes;i22<len22;i22+=maxChunkLength){parts.push(encodeChunk(uint8,i22,i22+maxChunkLength>len22?len22:i22+maxChunkLength))}if(extraBytes===1){tmp=uint8[len2-1];output+=lookup[tmp>>2];output+=lookup[tmp<<4&63];output+="=="}else if(extraBytes===2){tmp=(uint8[len2-2]<<8)+uint8[len2-1];output+=lookup[tmp>>10];output+=lookup[tmp>>4&63];output+=lookup[tmp<<2&63];output+="="}parts.push(output);return parts.join("")}},function(module22,exports2){exports2.read=function(buffer,offset,isLE,mLen,nBytes){var e,m;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var nBits=-7;var i3=isLE?nBytes-1:0;var d2=isLE?-1:1;var s=buffer[offset+i3];i3+=d2;e=s&(1<<-nBits)-1;s>>=-nBits;nBits+=eLen;for(;nBits>0;e=e*256+buffer[offset+i3],i3+=d2,nBits-=8){}m=e&(1<<-nBits)-1;e>>=-nBits;nBits+=mLen;for(;nBits>0;m=m*256+buffer[offset+i3],i3+=d2,nBits-=8){}if(e===0){e=1-eBias}else if(e===eMax){return m?NaN:(s?-1:1)*Infinity}else{m=m+Math.pow(2,mLen);e=e-eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)};exports2.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c;var eLen=nBytes*8-mLen-1;var eMax=(1<<eLen)-1;var eBias=eMax>>1;var rt=mLen===23?Math.pow(2,-24)-Math.pow(2,-77):0;var i3=isLE?0:nBytes-1;var d2=isLE?1:-1;var s=value<0||value===0&&1/value<0?1:0;value=Math.abs(value);if(isNaN(value)||value===Infinity){m=isNaN(value)?1:0;e=eMax}else{e=Math.floor(Math.log(value)/Math.LN2);if(value*(c=Math.pow(2,-e))<1){e--;c*=2}if(e+eBias>=1){value+=rt/c}else{value+=rt*Math.pow(2,1-eBias)}if(value*c>=2){e++;c/=2}if(e+eBias>=eMax){m=0;e=eMax}else if(e+eBias>=1){m=(value*c-1)*Math.pow(2,mLen);e=e+eBias}else{m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen);e=0}}for(;mLen>=8;buffer[offset+i3]=m&255,i3+=d2,m/=256,mLen-=8){}e=e<<mLen|m;eLen+=mLen;for(;eLen>0;buffer[offset+i3]=e&255,i3+=d2,e/=256,eLen-=8){}buffer[offset+i3-d2]|=s*128}},function(module22,exports2){module22.exports=function(module3){if(!module3.webpackPolyfill){module3.deprecate=function(){};module3.paths=[];module3.children=[];module3.webpackPolyfill=1}return module3}},function(module22,exports2,__webpack_require__){"use strict";var Process=__webpack_require__(7);var process=new Process,processProxy={};function defineKey(key2){if(processProxy[key2]){return}if(typeof process[key2]==="function"){processProxy[key2]=function(){return process[key2].apply(process,arguments)}}else{processProxy[key2]=process[key2]}}for(var key in process){defineKey(key)}processProxy.initializeTTYs=function(){if(process.stdin===null){process.initializeTTYs();processProxy.stdin=process.stdin;processProxy.stdout=process.stdout;processProxy.stderr=process.stderr}};process.nextTick(function(){processProxy.initializeTTYs()});module22.exports=processProxy},function(module22,exports2,__webpack_require__){(function(__dirname){"use strict";var __extends=this&&this.__extends||function(d2,b){for(var p2 in b)if(b.hasOwnProperty(p2))d2[p2]=b[p2];function __(){this.constructor=d2}d2.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var events=__webpack_require__(8);var path=null;var Item=function(){function Item2(fun,array){this.fun=fun;this.array=array}Item2.prototype.run=function(){this.fun.apply(null,this.array)};return Item2}();var NextTickQueue=function(){function NextTickQueue2(){this._queue=[];this._draining=false;this._currentQueue=null;this._queueIndex=-1}NextTickQueue2.prototype.push=function(item){var _this=this;if(this._queue.push(item)===1&&!this._draining){setTimeout(function(){return _this._drainQueue()},0)}};NextTickQueue2.prototype._cleanUpNextTick=function(){this._draining=false;if(this._currentQueue&&this._currentQueue.length){this._queue=this._currentQueue.concat(this._queue)}else{this._queueIndex=-1}if(this._queue.length){this._drainQueue()}};NextTickQueue2.prototype._drainQueue=function(){var _this=this;if(this._draining){return}var timeout=setTimeout(function(){return _this._cleanUpNextTick()});this._draining=true;var len=this._queue.length;while(len){this._currentQueue=this._queue;this._queue=[];while(++this._queueIndex<len){if(this._currentQueue){this._currentQueue[this._queueIndex].run()}}this._queueIndex=-1;len=this._queue.length}this._currentQueue=null;this._draining=false;clearTimeout(timeout)};return NextTickQueue2}();var Process=function(_super){__extends(Process2,_super);function Process2(){_super.apply(this,arguments);this.startTime=Date.now();this._cwd="/";this.platform="browser";this.argv=[];this.execArgv=[];this.stdout=null;this.stderr=null;this.stdin=null;this.domain=null;this._queue=new NextTickQueue;this.execPath=__dirname;this.env={};this.exitCode=0;this._gid=1;this._uid=1;this.version="v5.0";this.versions={http_parser:"0.0",node:"5.0",v8:"0.0",uv:"0.0",zlib:"0.0",ares:"0.0",icu:"0.0",modules:"0",openssl:"0.0"};this.config={target_defaults:{cflags:[],default_configuration:"Release",defines:[],include_dirs:[],libraries:[]},variables:{clang:0,host_arch:"x32",node_install_npm:false,node_install_waf:false,node_prefix:"",node_shared_cares:false,node_shared_http_parser:false,node_shared_libuv:false,node_shared_zlib:false,node_shared_v8:false,node_use_dtrace:false,node_use_etw:false,node_use_openssl:false,node_shared_openssl:false,strict_aliasing:false,target_arch:"x32",v8_use_snapshot:false,v8_no_strict_aliasing:0,visibility:""}};this.pid=Math.random()*1e3|0;this.title="node";this.arch="x32";this._mask=18;this.connected=void 0}Process2.prototype.chdir=function(dir){if(path===null){path=__webpack_require__(9)}this._cwd=path.resolve(dir)};Process2.prototype.cwd=function(){return this._cwd};Process2.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0};Process2.prototype.nextTick=function(fun){var args=[];for(var _i=1;_i<arguments.length;_i++){args[_i-1]=arguments[_i]}this._queue.push(new Item(fun,args))};Process2.prototype.abort=function(){this.emit("abort")};Process2.prototype.exit=function(code){this.exitCode=code;this.emit("exit",[code])};Process2.prototype.getgid=function(){return this._gid};Process2.prototype.setgid=function(gid){if(typeof gid==="number"){this._gid=gid}else{this._gid=1}};Process2.prototype.getuid=function(){return this._uid};Process2.prototype.setuid=function(uid){if(typeof uid==="number"){this._uid=uid}else{this._uid=1}};Process2.prototype.kill=function(pid,signal){this.emit("kill",[pid,signal])};Process2.prototype.memoryUsage=function(){return{rss:0,heapTotal:0,heapUsed:0}};Process2.prototype.umask=function(mask){if(mask===void 0){mask=this._mask}var oldMask=this._mask;this._mask=mask;this.emit("umask",[mask]);return oldMask};Process2.prototype.hrtime=function(){var timeinfo;if(typeof performance!=="undefined"){timeinfo=performance.now()}else if(Date["now"]){timeinfo=Date.now()}else{timeinfo=new Date().getTime()}var secs=timeinfo/1e3|0;timeinfo-=secs*1e3;timeinfo=timeinfo*1e6|0;return[secs,timeinfo]};Process2.prototype.initializeTTYs=function(){if(this.stdout===null){var TTY=__webpack_require__(10);this.stdout=new TTY;this.stderr=new TTY;this.stdin=new TTY}};Process2.prototype.disconnect=function(){};return Process2}(events.EventEmitter);module22.exports=Process}).call(exports2,"/")},function(module22,exports2){function EventEmitter(){this._events=this._events||{};this._maxListeners=this._maxListeners||void 0}module22.exports=EventEmitter;EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._maxListeners=void 0;EventEmitter.defaultMaxListeners=10;EventEmitter.prototype.setMaxListeners=function(n){if(!isNumber(n)||n<0||isNaN(n))throw TypeError("n must be a positive number");this._maxListeners=n;return this};EventEmitter.prototype.emit=function(type){var er,handler,len,args,i3,listeners;if(!this._events)this._events={};if(type==="error"){if(!this._events.error||isObject(this._events.error)&&!this._events.error.length){er=arguments[1];if(er instanceof Error){throw er}else{var err=new Error(\'Uncaught, unspecified "error" event. (\'+er+")");err.context=er;throw err}}}handler=this._events[type];if(isUndefined(handler))return false;if(isFunction3(handler)){switch(arguments.length){case 1:handler.call(this);break;case 2:handler.call(this,arguments[1]);break;case 3:handler.call(this,arguments[1],arguments[2]);break;default:args=Array.prototype.slice.call(arguments,1);handler.apply(this,args)}}else if(isObject(handler)){args=Array.prototype.slice.call(arguments,1);listeners=handler.slice();len=listeners.length;for(i3=0;i3<len;i3++)listeners[i3].apply(this,args)}return true};EventEmitter.prototype.addListener=function(type,listener){var m;if(!isFunction3(listener))throw TypeError("listener must be a function");if(!this._events)this._events={};if(this._events.newListener)this.emit("newListener",type,isFunction3(listener.listener)?listener.listener:listener);if(!this._events[type])this._events[type]=listener;else if(isObject(this._events[type]))this._events[type].push(listener);else this._events[type]=[this._events[type],listener];if(isObject(this._events[type])&&!this._events[type].warned){if(!isUndefined(this._maxListeners)){m=this._maxListeners}else{m=EventEmitter.defaultMaxListeners}if(m&&m>0&&this._events[type].length>m){this._events[type].warned=true;console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[type].length);if(typeof console.trace==="function"){console.trace()}}}return this};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.once=function(type,listener){if(!isFunction3(listener))throw TypeError("listener must be a function");var fired=false;function g(){this.removeListener(type,g);if(!fired){fired=true;listener.apply(this,arguments)}}g.listener=listener;this.on(type,g);return this};EventEmitter.prototype.removeListener=function(type,listener){var list,position,length,i3;if(!isFunction3(listener))throw TypeError("listener must be a function");if(!this._events||!this._events[type])return this;list=this._events[type];length=list.length;position=-1;if(list===listener||isFunction3(list.listener)&&list.listener===listener){delete this._events[type];if(this._events.removeListener)this.emit("removeListener",type,listener)}else if(isObject(list)){for(i3=length;i3-- >0;){if(list[i3]===listener||list[i3].listener&&list[i3].listener===listener){position=i3;break}}if(position<0)return this;if(list.length===1){list.length=0;delete this._events[type]}else{list.splice(position,1)}if(this._events.removeListener)this.emit("removeListener",type,listener)}return this};EventEmitter.prototype.removeAllListeners=function(type){var key,listeners;if(!this._events)return this;if(!this._events.removeListener){if(arguments.length===0)this._events={};else if(this._events[type])delete this._events[type];return this}if(arguments.length===0){for(key in this._events){if(key==="removeListener")continue;this.removeAllListeners(key)}this.removeAllListeners("removeListener");this._events={};return this}listeners=this._events[type];if(isFunction3(listeners)){this.removeListener(type,listeners)}else if(listeners){while(listeners.length)this.removeListener(type,listeners[listeners.length-1])}delete this._events[type];return this};EventEmitter.prototype.listeners=function(type){var ret;if(!this._events||!this._events[type])ret=[];else if(isFunction3(this._events[type]))ret=[this._events[type]];else ret=this._events[type].slice();return ret};EventEmitter.prototype.listenerCount=function(type){if(this._events){var evlistener=this._events[type];if(isFunction3(evlistener))return 1;else if(evlistener)return evlistener.length}return 0};EventEmitter.listenerCount=function(emitter,type){return emitter.listenerCount(type)};function isFunction3(arg){return typeof arg==="function"}function isNumber(arg){return typeof arg==="number"}function isObject(arg){return typeof arg==="object"&&arg!==null}function isUndefined(arg){return arg===void 0}},function(module22,exports2,__webpack_require__){(function(process){"use strict";var splitPathRe=/^(\\/?|)([\\s\\S]*?)((?:\\.{1,2}|[^\\/]+?|)(\\.[^.\\/]*|))(?:[\\/]*)$/;function posixSplitPath(filename){var out=splitPathRe.exec(filename);out.shift();return out}var path=function(){function path2(){}path2.normalize=function(p2){if(p2===""){p2="."}var absolute=p2.charAt(0)===path2.sep;p2=path2._removeDuplicateSeps(p2);var components=p2.split(path2.sep);var goodComponents=[];for(var idx=0;idx<components.length;idx++){var c=components[idx];if(c==="."){continue}else if(c===".."&&(absolute||!absolute&&goodComponents.length>0&&goodComponents[0]!=="..")){goodComponents.pop()}else{goodComponents.push(c)}}if(!absolute&&goodComponents.length<2){switch(goodComponents.length){case 1:if(goodComponents[0]===""){goodComponents.unshift(".")}break;default:goodComponents.push(".")}}p2=goodComponents.join(path2.sep);if(absolute&&p2.charAt(0)!==path2.sep){p2=path2.sep+p2}return p2};path2.join=function(){var paths=[];for(var _i=0;_i<arguments.length;_i++){paths[_i-0]=arguments[_i]}var processed=[];for(var i3=0;i3<paths.length;i3++){var segment=paths[i3];if(typeof segment!=="string"){throw new TypeError("Invalid argument type to path.join: "+typeof segment)}else if(segment!==""){processed.push(segment)}}return path2.normalize(processed.join(path2.sep))};path2.resolve=function(){var paths=[];for(var _i=0;_i<arguments.length;_i++){paths[_i-0]=arguments[_i]}var processed=[];for(var i3=0;i3<paths.length;i3++){var p2=paths[i3];if(typeof p2!=="string"){throw new TypeError("Invalid argument type to path.join: "+typeof p2)}else if(p2!==""){if(p2.charAt(0)===path2.sep){processed=[]}processed.push(p2)}}var resolved=path2.normalize(processed.join(path2.sep));if(resolved.length>1&&resolved.charAt(resolved.length-1)===path2.sep){return resolved.substr(0,resolved.length-1)}if(resolved.charAt(0)!==path2.sep){if(resolved.charAt(0)==="."&&(resolved.length===1||resolved.charAt(1)===path2.sep)){resolved=resolved.length===1?"":resolved.substr(2)}var cwd=process.cwd();if(resolved!==""){resolved=this.normalize(cwd+(cwd!=="/"?path2.sep:"")+resolved)}else{resolved=cwd}}return resolved};path2.relative=function(from,to){var i3;from=path2.resolve(from);to=path2.resolve(to);var fromSegs=from.split(path2.sep);var toSegs=to.split(path2.sep);toSegs.shift();fromSegs.shift();var upCount=0;var downSegs=[];for(i3=0;i3<fromSegs.length;i3++){var seg=fromSegs[i3];if(seg===toSegs[i3]){continue}upCount=fromSegs.length-i3;break}downSegs=toSegs.slice(i3);if(fromSegs.length===1&&fromSegs[0]===""){upCount=0}if(upCount>fromSegs.length){upCount=fromSegs.length}var rv="";for(i3=0;i3<upCount;i3++){rv+="../"}rv+=downSegs.join(path2.sep);if(rv.length>1&&rv.charAt(rv.length-1)===path2.sep){rv=rv.substr(0,rv.length-1)}return rv};path2.dirname=function(p2){p2=path2._removeDuplicateSeps(p2);var absolute=p2.charAt(0)===path2.sep;var sections=p2.split(path2.sep);if(sections.pop()===""&&sections.length>0){sections.pop()}if(sections.length>1||sections.length===1&&!absolute){return sections.join(path2.sep)}else if(absolute){return path2.sep}else{return"."}};path2.basename=function(p2,ext){if(ext===void 0){ext=""}if(p2===""){return p2}p2=path2.normalize(p2);var sections=p2.split(path2.sep);var lastPart=sections[sections.length-1];if(lastPart===""&&sections.length>1){return sections[sections.length-2]}if(ext.length>0){var lastPartExt=lastPart.substr(lastPart.length-ext.length);if(lastPartExt===ext){return lastPart.substr(0,lastPart.length-ext.length)}}return lastPart};path2.extname=function(p2){p2=path2.normalize(p2);var sections=p2.split(path2.sep);p2=sections.pop();if(p2===""&&sections.length>0){p2=sections.pop()}if(p2===".."){return""}var i3=p2.lastIndexOf(".");if(i3===-1||i3===0){return""}return p2.substr(i3)};path2.isAbsolute=function(p2){return p2.length>0&&p2.charAt(0)===path2.sep};path2._makeLong=function(p2){return p2};path2.parse=function(p2){var allParts=posixSplitPath(p2);return{root:allParts[0],dir:allParts[0]+allParts[1].slice(0,-1),base:allParts[2],ext:allParts[3],name:allParts[2].slice(0,allParts[2].length-allParts[3].length)}};path2.format=function(pathObject){if(pathObject===null||typeof pathObject!=="object"){throw new TypeError("Parameter \'pathObject\' must be an object, not "+typeof pathObject)}var root=pathObject.root||"";if(typeof root!=="string"){throw new TypeError("\'pathObject.root\' must be a string or undefined, not "+typeof pathObject.root)}var dir=pathObject.dir?pathObject.dir+path2.sep:"";var base=pathObject.base||"";return dir+base};path2._removeDuplicateSeps=function(p2){p2=p2.replace(this._replaceRegex,this.sep);return p2};path2.sep="/";path2._replaceRegex=new RegExp("//+","g");path2.delimiter=":";path2.posix=path2;path2.win32=path2;return path2}();var _=path;module22.exports=path}).call(exports2,__webpack_require__(6))},function(module22,exports2,__webpack_require__){(function(Buffer2){"use strict";var __extends=this&&this.__extends||function(d2,b){for(var p2 in b)if(b.hasOwnProperty(p2))d2[p2]=b[p2];function __(){this.constructor=d2}d2.prototype=b===null?Object.create(b):(__.prototype=b.prototype,new __)};var stream=__webpack_require__(11);var TTY=function(_super){__extends(TTY2,_super);function TTY2(){_super.call(this);this.isRaw=false;this.columns=80;this.rows=120;this.isTTY=true;this._bufferedWrites=[];this._waitingForWrites=false}TTY2.prototype.setRawMode=function(mode){if(this.isRaw!==mode){this.isRaw=mode;this.emit("modeChange")}};TTY2.prototype.changeColumns=function(columns){if(columns!==this.columns){this.columns=columns;this.emit("resize")}};TTY2.prototype.changeRows=function(rows){if(rows!==this.rows){this.rows=rows;this.emit("resize")}};TTY2.isatty=function(fd){return fd&&fd instanceof TTY2};TTY2.prototype._write=function(chunk,encoding,cb){var error;try{var data;if(typeof chunk==="string"){data=new Buffer2(chunk,encoding)}else{data=chunk}this._bufferedWrites.push(data);if(this._waitingForWrites){this._read(1024)}}catch(e){error=e}finally{cb(error)}};TTY2.prototype._read=function(size){if(this._bufferedWrites.length===0){this._waitingForWrites=true}else{while(this._bufferedWrites.length>0){this._waitingForWrites=this.push(this._bufferedWrites.shift());if(!this._waitingForWrites){break}}}};return TTY2}(stream.Duplex);module22.exports=TTY}).call(exports2,__webpack_require__(1))},function(module22,exports2,__webpack_require__){module22.exports=Stream;var EE=__webpack_require__(8).EventEmitter;var inherits=__webpack_require__(12);inherits(Stream,EE);Stream.Readable=__webpack_require__(13);Stream.Writable=__webpack_require__(27);Stream.Duplex=__webpack_require__(28);Stream.Transform=__webpack_require__(29);Stream.PassThrough=__webpack_require__(30);Stream.Stream=Stream;function Stream(){EE.call(this)}Stream.prototype.pipe=function(dest,options){var source=this;function ondata(chunk){if(dest.writable){if(false===dest.write(chunk)&&source.pause){source.pause()}}}source.on("data",ondata);function ondrain(){if(source.readable&&source.resume){source.resume()}}dest.on("drain",ondrain);if(!dest._isStdio&&(!options||options.end!==false)){source.on("end",onend);source.on("close",onclose)}var didOnEnd=false;function onend(){if(didOnEnd)return;didOnEnd=true;dest.end()}function onclose(){if(didOnEnd)return;didOnEnd=true;if(typeof dest.destroy==="function")dest.destroy()}function onerror(er){cleanup();if(EE.listenerCount(this,"error")===0){throw er}}source.on("error",onerror);dest.on("error",onerror);function cleanup(){source.removeListener("data",ondata);dest.removeListener("drain",ondrain);source.removeListener("end",onend);source.removeListener("close",onclose);source.removeListener("error",onerror);dest.removeListener("error",onerror);source.removeListener("end",cleanup);source.removeListener("close",cleanup);dest.removeListener("close",cleanup)}source.on("end",cleanup);source.on("close",cleanup);dest.on("close",cleanup);dest.emit("pipe",source);return dest}},function(module22,exports2){if(typeof Object.create==="function"){module22.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:false,writable:true,configurable:true}})}}else{module22.exports=function inherits(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype;ctor.prototype=new TempCtor;ctor.prototype.constructor=ctor}}},function(module22,exports2,__webpack_require__){(function(process){var Stream=function(){try{return __webpack_require__(11)}catch(_){}}();exports2=module22.exports=__webpack_require__(14);exports2.Stream=Stream||exports2;exports2.Readable=exports2;exports2.Writable=__webpack_require__(22);exports2.Duplex=__webpack_require__(21);exports2.Transform=__webpack_require__(25);exports2.PassThrough=__webpack_require__(26);if(!process.browser&&process.env.READABLE_STREAM==="disable"&&Stream){module22.exports=Stream}}).call(exports2,__webpack_require__(6))},function(module22,exports2,__webpack_require__){(function(process){"use strict";module22.exports=Readable;var processNextTick=__webpack_require__(15);var isArray=__webpack_require__(16);var Duplex;Readable.ReadableState=ReadableState;var EE=__webpack_require__(8).EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length};var Stream;(function(){try{Stream=__webpack_require__(11)}catch(_){}finally{if(!Stream)Stream=__webpack_require__(8).EventEmitter}})();var Buffer2=__webpack_require__(2).Buffer;var bufferShim=__webpack_require__(17);var util=__webpack_require__(18);util.inherits=__webpack_require__(12);var debugUtil=__webpack_require__(19);var debug=void 0;if(debugUtil&&debugUtil.debuglog){debug=debugUtil.debuglog("stream")}else{debug=function(){}}var BufferList=__webpack_require__(20);var StringDecoder;util.inherits(Readable,Stream);function prependListener(emitter,event,fn){if(typeof emitter.prependListener==="function"){return emitter.prependListener(event,fn)}else{if(!emitter._events||!emitter._events[event])emitter.on(event,fn);else if(isArray(emitter._events[event]))emitter._events[event].unshift(fn);else emitter._events[event]=[fn,emitter._events[event]]}}function ReadableState(options,stream){Duplex=Duplex||__webpack_require__(21);options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.readableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.buffer=new BufferList;this.length=0;this.pipes=null;this.pipesCount=0;this.flowing=null;this.ended=false;this.endEmitted=false;this.reading=false;this.sync=true;this.needReadable=false;this.emittedReadable=false;this.readableListening=false;this.resumeScheduled=false;this.defaultEncoding=options.defaultEncoding||"utf8";this.ranOut=false;this.awaitDrain=0;this.readingMore=false;this.decoder=null;this.encoding=null;if(options.encoding){if(!StringDecoder)StringDecoder=__webpack_require__(24).StringDecoder;this.decoder=new StringDecoder(options.encoding);this.encoding=options.encoding}}function Readable(options){Duplex=Duplex||__webpack_require__(21);if(!(this instanceof Readable))return new Readable(options);this._readableState=new ReadableState(options,this);this.readable=true;if(options&&typeof options.read==="function")this._read=options.read;Stream.call(this)}Readable.prototype.push=function(chunk,encoding){var state4=this._readableState;if(!state4.objectMode&&typeof chunk==="string"){encoding=encoding||state4.defaultEncoding;if(encoding!==state4.encoding){chunk=bufferShim.from(chunk,encoding);encoding=""}}return readableAddChunk(this,state4,chunk,encoding,false)};Readable.prototype.unshift=function(chunk){var state4=this._readableState;return readableAddChunk(this,state4,chunk,"",true)};Readable.prototype.isPaused=function(){return this._readableState.flowing===false};function readableAddChunk(stream,state4,chunk,encoding,addToFront){var er=chunkInvalid(state4,chunk);if(er){stream.emit("error",er)}else if(chunk===null){state4.reading=false;onEofChunk(stream,state4)}else if(state4.objectMode||chunk&&chunk.length>0){if(state4.ended&&!addToFront){var e=new Error("stream.push() after EOF");stream.emit("error",e)}else if(state4.endEmitted&&addToFront){var _e=new Error("stream.unshift() after end event");stream.emit("error",_e)}else{var skipAdd;if(state4.decoder&&!addToFront&&!encoding){chunk=state4.decoder.write(chunk);skipAdd=!state4.objectMode&&chunk.length===0}if(!addToFront)state4.reading=false;if(!skipAdd){if(state4.flowing&&state4.length===0&&!state4.sync){stream.emit("data",chunk);stream.read(0)}else{state4.length+=state4.objectMode?1:chunk.length;if(addToFront)state4.buffer.unshift(chunk);else state4.buffer.push(chunk);if(state4.needReadable)emitReadable(stream)}}maybeReadMore(stream,state4)}}else if(!addToFront){state4.reading=false}return needMoreData(state4)}function needMoreData(state4){return!state4.ended&&(state4.needReadable||state4.length<state4.highWaterMark||state4.length===0)}Readable.prototype.setEncoding=function(enc){if(!StringDecoder)StringDecoder=__webpack_require__(24).StringDecoder;this._readableState.decoder=new StringDecoder(enc);this._readableState.encoding=enc;return this};var MAX_HWM=8388608;function computeNewHighWaterMark(n){if(n>=MAX_HWM){n=MAX_HWM}else{n--;n|=n>>>1;n|=n>>>2;n|=n>>>4;n|=n>>>8;n|=n>>>16;n++}return n}function howMuchToRead(n,state4){if(n<=0||state4.length===0&&state4.ended)return 0;if(state4.objectMode)return 1;if(n!==n){if(state4.flowing&&state4.length)return state4.buffer.head.data.length;else return state4.length}if(n>state4.highWaterMark)state4.highWaterMark=computeNewHighWaterMark(n);if(n<=state4.length)return n;if(!state4.ended){state4.needReadable=true;return 0}return state4.length}Readable.prototype.read=function(n){debug("read",n);n=parseInt(n,10);var state4=this._readableState;var nOrig=n;if(n!==0)state4.emittedReadable=false;if(n===0&&state4.needReadable&&(state4.length>=state4.highWaterMark||state4.ended)){debug("read: emitReadable",state4.length,state4.ended);if(state4.length===0&&state4.ended)endReadable(this);else emitReadable(this);return null}n=howMuchToRead(n,state4);if(n===0&&state4.ended){if(state4.length===0)endReadable(this);return null}var doRead=state4.needReadable;debug("need readable",doRead);if(state4.length===0||state4.length-n<state4.highWaterMark){doRead=true;debug("length less than watermark",doRead)}if(state4.ended||state4.reading){doRead=false;debug("reading or ended",doRead)}else if(doRead){debug("do read");state4.reading=true;state4.sync=true;if(state4.length===0)state4.needReadable=true;this._read(state4.highWaterMark);state4.sync=false;if(!state4.reading)n=howMuchToRead(nOrig,state4)}var ret;if(n>0)ret=fromList(n,state4);else ret=null;if(ret===null){state4.needReadable=true;n=0}else{state4.length-=n}if(state4.length===0){if(!state4.ended)state4.needReadable=true;if(nOrig!==n&&state4.ended)endReadable(this)}if(ret!==null)this.emit("data",ret);return ret};function chunkInvalid(state4,chunk){var er=null;if(!Buffer2.isBuffer(chunk)&&typeof chunk!=="string"&&chunk!==null&&chunk!==void 0&&!state4.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}return er}function onEofChunk(stream,state4){if(state4.ended)return;if(state4.decoder){var chunk=state4.decoder.end();if(chunk&&chunk.length){state4.buffer.push(chunk);state4.length+=state4.objectMode?1:chunk.length}}state4.ended=true;emitReadable(stream)}function emitReadable(stream){var state4=stream._readableState;state4.needReadable=false;if(!state4.emittedReadable){debug("emitReadable",state4.flowing);state4.emittedReadable=true;if(state4.sync)processNextTick(emitReadable_,stream);else emitReadable_(stream)}}function emitReadable_(stream){debug("emit readable");stream.emit("readable");flow(stream)}function maybeReadMore(stream,state4){if(!state4.readingMore){state4.readingMore=true;processNextTick(maybeReadMore_,stream,state4)}}function maybeReadMore_(stream,state4){var len=state4.length;while(!state4.reading&&!state4.flowing&&!state4.ended&&state4.length<state4.highWaterMark){debug("maybeReadMore read 0");stream.read(0);if(len===state4.length)break;else len=state4.length}state4.readingMore=false}Readable.prototype._read=function(n){this.emit("error",new Error("_read() is not implemented"))};Readable.prototype.pipe=function(dest,pipeOpts){var src=this;var state4=this._readableState;switch(state4.pipesCount){case 0:state4.pipes=dest;break;case 1:state4.pipes=[state4.pipes,dest];break;default:state4.pipes.push(dest);break}state4.pipesCount+=1;debug("pipe count=%d opts=%j",state4.pipesCount,pipeOpts);var doEnd=(!pipeOpts||pipeOpts.end!==false)&&dest!==process.stdout&&dest!==process.stderr;var endFn=doEnd?onend:cleanup;if(state4.endEmitted)processNextTick(endFn);else src.once("end",endFn);dest.on("unpipe",onunpipe);function onunpipe(readable){debug("onunpipe");if(readable===src){cleanup()}}function onend(){debug("onend");dest.end()}var ondrain=pipeOnDrain(src);dest.on("drain",ondrain);var cleanedUp=false;function cleanup(){debug("cleanup");dest.removeListener("close",onclose);dest.removeListener("finish",onfinish);dest.removeListener("drain",ondrain);dest.removeListener("error",onerror);dest.removeListener("unpipe",onunpipe);src.removeListener("end",onend);src.removeListener("end",cleanup);src.removeListener("data",ondata);cleanedUp=true;if(state4.awaitDrain&&(!dest._writableState||dest._writableState.needDrain))ondrain()}var increasedAwaitDrain=false;src.on("data",ondata);function ondata(chunk){debug("ondata");increasedAwaitDrain=false;var ret=dest.write(chunk);if(false===ret&&!increasedAwaitDrain){if((state4.pipesCount===1&&state4.pipes===dest||state4.pipesCount>1&&indexOf(state4.pipes,dest)!==-1)&&!cleanedUp){debug("false write response, pause",src._readableState.awaitDrain);src._readableState.awaitDrain++;increasedAwaitDrain=true}src.pause()}}function onerror(er){debug("onerror",er);unpipe();dest.removeListener("error",onerror);if(EElistenerCount(dest,"error")===0)dest.emit("error",er)}prependListener(dest,"error",onerror);function onclose(){dest.removeListener("finish",onfinish);unpipe()}dest.once("close",onclose);function onfinish(){debug("onfinish");dest.removeListener("close",onclose);unpipe()}dest.once("finish",onfinish);function unpipe(){debug("unpipe");src.unpipe(dest)}dest.emit("pipe",src);if(!state4.flowing){debug("pipe resume");src.resume()}return dest};function pipeOnDrain(src){return function(){var state4=src._readableState;debug("pipeOnDrain",state4.awaitDrain);if(state4.awaitDrain)state4.awaitDrain--;if(state4.awaitDrain===0&&EElistenerCount(src,"data")){state4.flowing=true;flow(src)}}}Readable.prototype.unpipe=function(dest){var state4=this._readableState;if(state4.pipesCount===0)return this;if(state4.pipesCount===1){if(dest&&dest!==state4.pipes)return this;if(!dest)dest=state4.pipes;state4.pipes=null;state4.pipesCount=0;state4.flowing=false;if(dest)dest.emit("unpipe",this);return this}if(!dest){var dests=state4.pipes;var len=state4.pipesCount;state4.pipes=null;state4.pipesCount=0;state4.flowing=false;for(var i3=0;i3<len;i3++){dests[i3].emit("unpipe",this)}return this}var index=indexOf(state4.pipes,dest);if(index===-1)return this;state4.pipes.splice(index,1);state4.pipesCount-=1;if(state4.pipesCount===1)state4.pipes=state4.pipes[0];dest.emit("unpipe",this);return this};Readable.prototype.on=function(ev2,fn){var res=Stream.prototype.on.call(this,ev2,fn);if(ev2==="data"){if(this._readableState.flowing!==false)this.resume()}else if(ev2==="readable"){var state4=this._readableState;if(!state4.endEmitted&&!state4.readableListening){state4.readableListening=state4.needReadable=true;state4.emittedReadable=false;if(!state4.reading){processNextTick(nReadingNextTick,this)}else if(state4.length){emitReadable(this,state4)}}}return res};Readable.prototype.addListener=Readable.prototype.on;function nReadingNextTick(self2){debug("readable nexttick read 0");self2.read(0)}Readable.prototype.resume=function(){var state4=this._readableState;if(!state4.flowing){debug("resume");state4.flowing=true;resume(this,state4)}return this};function resume(stream,state4){if(!state4.resumeScheduled){state4.resumeScheduled=true;processNextTick(resume_,stream,state4)}}function resume_(stream,state4){if(!state4.reading){debug("resume read 0");stream.read(0)}state4.resumeScheduled=false;state4.awaitDrain=0;stream.emit("resume");flow(stream);if(state4.flowing&&!state4.reading)stream.read(0)}Readable.prototype.pause=function(){debug("call pause flowing=%j",this._readableState.flowing);if(false!==this._readableState.flowing){debug("pause");this._readableState.flowing=false;this.emit("pause")}return this};function flow(stream){var state4=stream._readableState;debug("flow",state4.flowing);while(state4.flowing&&stream.read()!==null){}}Readable.prototype.wrap=function(stream){var state4=this._readableState;var paused=false;var self2=this;stream.on("end",function(){debug("wrapped end");if(state4.decoder&&!state4.ended){var chunk=state4.decoder.end();if(chunk&&chunk.length)self2.push(chunk)}self2.push(null)});stream.on("data",function(chunk){debug("wrapped data");if(state4.decoder)chunk=state4.decoder.write(chunk);if(state4.objectMode&&(chunk===null||chunk===void 0))return;else if(!state4.objectMode&&(!chunk||!chunk.length))return;var ret=self2.push(chunk);if(!ret){paused=true;stream.pause()}});for(var i3 in stream){if(this[i3]===void 0&&typeof stream[i3]==="function"){this[i3]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i3)}}var events=["error","close","destroy","pause","resume"];forEach(events,function(ev2){stream.on(ev2,self2.emit.bind(self2,ev2))});self2._read=function(n){debug("wrapped _read",n);if(paused){paused=false;stream.resume()}};return self2};Readable._fromList=fromList;function fromList(n,state4){if(state4.length===0)return null;var ret;if(state4.objectMode)ret=state4.buffer.shift();else if(!n||n>=state4.length){if(state4.decoder)ret=state4.buffer.join("");else if(state4.buffer.length===1)ret=state4.buffer.head.data;else ret=state4.buffer.concat(state4.length);state4.buffer.clear()}else{ret=fromListPartial(n,state4.buffer,state4.decoder)}return ret}function fromListPartial(n,list,hasStrings){var ret;if(n<list.head.data.length){ret=list.head.data.slice(0,n);list.head.data=list.head.data.slice(n)}else if(n===list.head.data.length){ret=list.shift()}else{ret=hasStrings?copyFromBufferString(n,list):copyFromBuffer(n,list)}return ret}function copyFromBufferString(n,list){var p2=list.head;var c=1;var ret=p2.data;n-=ret.length;while(p2=p2.next){var str4=p2.data;var nb=n>str4.length?str4.length:n;if(nb===str4.length)ret+=str4;else ret+=str4.slice(0,n);n-=nb;if(n===0){if(nb===str4.length){++c;if(p2.next)list.head=p2.next;else list.head=list.tail=null}else{list.head=p2;p2.data=str4.slice(nb)}break}++c}list.length-=c;return ret}function copyFromBuffer(n,list){var ret=bufferShim.allocUnsafe(n);var p2=list.head;var c=1;p2.data.copy(ret);n-=p2.data.length;while(p2=p2.next){var buf=p2.data;var nb=n>buf.length?buf.length:n;buf.copy(ret,ret.length-n,0,nb);n-=nb;if(n===0){if(nb===buf.length){++c;if(p2.next)list.head=p2.next;else list.head=list.tail=null}else{list.head=p2;p2.data=buf.slice(nb)}break}++c}list.length-=c;return ret}function endReadable(stream){var state4=stream._readableState;if(state4.length>0)throw new Error(\'"endReadable()" called on non-empty stream\');if(!state4.endEmitted){state4.ended=true;processNextTick(endReadableNT,state4,stream)}}function endReadableNT(state4,stream){if(!state4.endEmitted&&state4.length===0){state4.endEmitted=true;stream.readable=false;stream.emit("end")}}function forEach(xs,f){for(var i3=0,l=xs.length;i3<l;i3++){f(xs[i3],i3)}}function indexOf(xs,x3){for(var i3=0,l=xs.length;i3<l;i3++){if(xs[i3]===x3)return i3}return-1}}).call(exports2,__webpack_require__(6))},function(module22,exports2,__webpack_require__){(function(process){"use strict";if(!process.version||process.version.indexOf("v0.")===0||process.version.indexOf("v1.")===0&&process.version.indexOf("v1.8.")!==0){module22.exports=nextTick}else{module22.exports=process.nextTick}function nextTick(fn,arg1,arg2,arg3){if(typeof fn!=="function"){throw new TypeError(\'"callback" argument must be a function\')}var len=arguments.length;var args,i3;switch(len){case 0:case 1:return process.nextTick(fn);case 2:return process.nextTick(function afterTickOne(){fn.call(null,arg1)});case 3:return process.nextTick(function afterTickTwo(){fn.call(null,arg1,arg2)});case 4:return process.nextTick(function afterTickThree(){fn.call(null,arg1,arg2,arg3)});default:args=new Array(len-1);i3=0;while(i3<args.length){args[i3++]=arguments[i3]}return process.nextTick(function afterTick(){fn.apply(null,args)})}}}).call(exports2,__webpack_require__(6))},function(module22,exports2){var toString={}.toString;module22.exports=Array.isArray||function(arr){return toString.call(arr)=="[object Array]"}},function(module22,exports2,__webpack_require__){(function(global2){"use strict";var buffer=__webpack_require__(2);var Buffer2=buffer.Buffer;var SlowBuffer=buffer.SlowBuffer;var MAX_LEN=buffer.kMaxLength||2147483647;exports2.alloc=function alloc(size,fill,encoding){if(typeof Buffer2.alloc==="function"){return Buffer2.alloc(size,fill,encoding)}if(typeof encoding==="number"){throw new TypeError("encoding must not be number")}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}var enc=encoding;var _fill=fill;if(_fill===void 0){enc=void 0;_fill=0}var buf=new Buffer2(size);if(typeof _fill==="string"){var fillBuf=new Buffer2(_fill,enc);var flen=fillBuf.length;var i3=-1;while(++i3<size){buf[i3]=fillBuf[i3%flen]}}else{buf.fill(_fill)}return buf};exports2.allocUnsafe=function allocUnsafe(size){if(typeof Buffer2.allocUnsafe==="function"){return Buffer2.allocUnsafe(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>MAX_LEN){throw new RangeError("size is too large")}return new Buffer2(size)};exports2.from=function from(value,encodingOrOffset,length){if(typeof Buffer2.from==="function"&&(!global2.Uint8Array||Uint8Array.from!==Buffer2.from)){return Buffer2.from(value,encodingOrOffset,length)}if(typeof value==="number"){throw new TypeError(\'"value" argument must not be a number\')}if(typeof value==="string"){return new Buffer2(value,encodingOrOffset)}if(typeof ArrayBuffer!=="undefined"&&value instanceof ArrayBuffer){var offset=encodingOrOffset;if(arguments.length===1){return new Buffer2(value)}if(typeof offset==="undefined"){offset=0}var len=length;if(typeof len==="undefined"){len=value.byteLength-offset}if(offset>=value.byteLength){throw new RangeError("\'offset\' is out of bounds")}if(len>value.byteLength-offset){throw new RangeError("\'length\' is out of bounds")}return new Buffer2(value.slice(offset,offset+len))}if(Buffer2.isBuffer(value)){var out=new Buffer2(value.length);value.copy(out,0,0,value.length);return out}if(value){if(Array.isArray(value)||typeof ArrayBuffer!=="undefined"&&value.buffer instanceof ArrayBuffer||"length"in value){return new Buffer2(value)}if(value.type==="Buffer"&&Array.isArray(value.data)){return new Buffer2(value.data)}}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")};exports2.allocUnsafeSlow=function allocUnsafeSlow(size){if(typeof Buffer2.allocUnsafeSlow==="function"){return Buffer2.allocUnsafeSlow(size)}if(typeof size!=="number"){throw new TypeError("size must be a number")}if(size>=MAX_LEN){throw new RangeError("size is too large")}return new SlowBuffer(size)}}).call(exports2,function(){return this}())},function(module22,exports2,__webpack_require__){(function(Buffer2){function isArray(arg){if(Array.isArray){return Array.isArray(arg)}return objectToString(arg)==="[object Array]"}exports2.isArray=isArray;function isBoolean(arg){return typeof arg==="boolean"}exports2.isBoolean=isBoolean;function isNull(arg){return arg===null}exports2.isNull=isNull;function isNullOrUndefined(arg){return arg==null}exports2.isNullOrUndefined=isNullOrUndefined;function isNumber(arg){return typeof arg==="number"}exports2.isNumber=isNumber;function isString(arg){return typeof arg==="string"}exports2.isString=isString;function isSymbol(arg){return typeof arg==="symbol"}exports2.isSymbol=isSymbol;function isUndefined(arg){return arg===void 0}exports2.isUndefined=isUndefined;function isRegExp(re){return objectToString(re)==="[object RegExp]"}exports2.isRegExp=isRegExp;function isObject(arg){return typeof arg==="object"&&arg!==null}exports2.isObject=isObject;function isDate(d2){return objectToString(d2)==="[object Date]"}exports2.isDate=isDate;function isError(e){return objectToString(e)==="[object Error]"||e instanceof Error}exports2.isError=isError;function isFunction3(arg){return typeof arg==="function"}exports2.isFunction=isFunction3;function isPrimitive(arg){return arg===null||typeof arg==="boolean"||typeof arg==="number"||typeof arg==="string"||typeof arg==="symbol"||typeof arg==="undefined"}exports2.isPrimitive=isPrimitive;exports2.isBuffer=Buffer2.isBuffer;function objectToString(o){return Object.prototype.toString.call(o)}}).call(exports2,__webpack_require__(1))},function(module22,exports2){},function(module22,exports2,__webpack_require__){"use strict";var Buffer2=__webpack_require__(2).Buffer;var bufferShim=__webpack_require__(17);module22.exports=BufferList;function BufferList(){this.head=null;this.tail=null;this.length=0}BufferList.prototype.push=function(v2){var entry={data:v2,next:null};if(this.length>0)this.tail.next=entry;else this.head=entry;this.tail=entry;++this.length};BufferList.prototype.unshift=function(v2){var entry={data:v2,next:this.head};if(this.length===0)this.tail=entry;this.head=entry;++this.length};BufferList.prototype.shift=function(){if(this.length===0)return;var ret=this.head.data;if(this.length===1)this.head=this.tail=null;else this.head=this.head.next;--this.length;return ret};BufferList.prototype.clear=function(){this.head=this.tail=null;this.length=0};BufferList.prototype.join=function(s){if(this.length===0)return"";var p2=this.head;var ret=""+p2.data;while(p2=p2.next){ret+=s+p2.data}return ret};BufferList.prototype.concat=function(n){if(this.length===0)return bufferShim.alloc(0);if(this.length===1)return this.head.data;var ret=bufferShim.allocUnsafe(n>>>0);var p2=this.head;var i3=0;while(p2){p2.data.copy(ret,i3);i3+=p2.data.length;p2=p2.next}return ret}},function(module22,exports2,__webpack_require__){"use strict";var objectKeys=Object.keys||function(obj){var keys22=[];for(var key in obj){keys22.push(key)}return keys22};module22.exports=Duplex;var processNextTick=__webpack_require__(15);var util=__webpack_require__(18);util.inherits=__webpack_require__(12);var Readable=__webpack_require__(14);var Writable=__webpack_require__(22);util.inherits(Duplex,Readable);var keys3=objectKeys(Writable.prototype);for(var v2=0;v2<keys3.length;v2++){var method=keys3[v2];if(!Duplex.prototype[method])Duplex.prototype[method]=Writable.prototype[method]}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options);Writable.call(this,options);if(options&&options.readable===false)this.readable=false;if(options&&options.writable===false)this.writable=false;this.allowHalfOpen=true;if(options&&options.allowHalfOpen===false)this.allowHalfOpen=false;this.once("end",onend)}function onend(){if(this.allowHalfOpen||this._writableState.ended)return;processNextTick(onEndNT,this)}function onEndNT(self2){self2.end()}function forEach(xs,f){for(var i3=0,l=xs.length;i3<l;i3++){f(xs[i3],i3)}}},function(module22,exports2,__webpack_require__){(function(process){"use strict";module22.exports=Writable;var processNextTick=__webpack_require__(15);var asyncWrite=!process.browser&&["v0.10","v0.9."].indexOf(process.version.slice(0,5))>-1?setImmediate:processNextTick;var Duplex;Writable.WritableState=WritableState;var util=__webpack_require__(18);util.inherits=__webpack_require__(12);var internalUtil={deprecate:__webpack_require__(23)};var Stream;(function(){try{Stream=__webpack_require__(11)}catch(_){}finally{if(!Stream)Stream=__webpack_require__(8).EventEmitter}})();var Buffer2=__webpack_require__(2).Buffer;var bufferShim=__webpack_require__(17);util.inherits(Writable,Stream);function nop(){}function WriteReq(chunk,encoding,cb){this.chunk=chunk;this.encoding=encoding;this.callback=cb;this.next=null}function WritableState(options,stream){Duplex=Duplex||__webpack_require__(21);options=options||{};this.objectMode=!!options.objectMode;if(stream instanceof Duplex)this.objectMode=this.objectMode||!!options.writableObjectMode;var hwm=options.highWaterMark;var defaultHwm=this.objectMode?16:16*1024;this.highWaterMark=hwm||hwm===0?hwm:defaultHwm;this.highWaterMark=~~this.highWaterMark;this.needDrain=false;this.ending=false;this.ended=false;this.finished=false;var noDecode=options.decodeStrings===false;this.decodeStrings=!noDecode;this.defaultEncoding=options.defaultEncoding||"utf8";this.length=0;this.writing=false;this.corked=0;this.sync=true;this.bufferProcessing=false;this.onwrite=function(er){onwrite(stream,er)};this.writecb=null;this.writelen=0;this.bufferedRequest=null;this.lastBufferedRequest=null;this.pendingcb=0;this.prefinished=false;this.errorEmitted=false;this.bufferedRequestCount=0;this.corkedRequestsFree=new CorkedRequest(this)}WritableState.prototype.getBuffer=function getBuffer(){var current=this.bufferedRequest;var out=[];while(current){out.push(current);current=current.next}return out};(function(){try{Object.defineProperty(WritableState.prototype,"buffer",{get:internalUtil.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch(_){}})();var realHasInstance;if(typeof Symbol==="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]==="function"){realHasInstance=Function.prototype[Symbol.hasInstance];Object.defineProperty(Writable,Symbol.hasInstance,{value:function(object){if(realHasInstance.call(this,object))return true;return object&&object._writableState instanceof WritableState}})}else{realHasInstance=function(object){return object instanceof this}}function Writable(options){Duplex=Duplex||__webpack_require__(21);if(!realHasInstance.call(Writable,this)&&!(this instanceof Duplex)){return new Writable(options)}this._writableState=new WritableState(options,this);this.writable=true;if(options){if(typeof options.write==="function")this._write=options.write;if(typeof options.writev==="function")this._writev=options.writev}Stream.call(this)}Writable.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function writeAfterEnd(stream,cb){var er=new Error("write after end");stream.emit("error",er);processNextTick(cb,er)}function validChunk(stream,state4,chunk,cb){var valid=true;var er=false;if(chunk===null){er=new TypeError("May not write null values to stream")}else if(typeof chunk!=="string"&&chunk!==void 0&&!state4.objectMode){er=new TypeError("Invalid non-string/buffer chunk")}if(er){stream.emit("error",er);processNextTick(cb,er);valid=false}return valid}Writable.prototype.write=function(chunk,encoding,cb){var state4=this._writableState;var ret=false;var isBuf=Buffer2.isBuffer(chunk);if(typeof encoding==="function"){cb=encoding;encoding=null}if(isBuf)encoding="buffer";else if(!encoding)encoding=state4.defaultEncoding;if(typeof cb!=="function")cb=nop;if(state4.ended)writeAfterEnd(this,cb);else if(isBuf||validChunk(this,state4,chunk,cb)){state4.pendingcb++;ret=writeOrBuffer(this,state4,isBuf,chunk,encoding,cb)}return ret};Writable.prototype.cork=function(){var state4=this._writableState;state4.corked++};Writable.prototype.uncork=function(){var state4=this._writableState;if(state4.corked){state4.corked--;if(!state4.writing&&!state4.corked&&!state4.finished&&!state4.bufferProcessing&&state4.bufferedRequest)clearBuffer(this,state4)}};Writable.prototype.setDefaultEncoding=function setDefaultEncoding(encoding){if(typeof encoding==="string")encoding=encoding.toLowerCase();if(!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((encoding+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+encoding);this._writableState.defaultEncoding=encoding;return this};function decodeChunk(state4,chunk,encoding){if(!state4.objectMode&&state4.decodeStrings!==false&&typeof chunk==="string"){chunk=bufferShim.from(chunk,encoding)}return chunk}function writeOrBuffer(stream,state4,isBuf,chunk,encoding,cb){if(!isBuf){chunk=decodeChunk(state4,chunk,encoding);if(Buffer2.isBuffer(chunk))encoding="buffer"}var len=state4.objectMode?1:chunk.length;state4.length+=len;var ret=state4.length<state4.highWaterMark;if(!ret)state4.needDrain=true;if(state4.writing||state4.corked){var last=state4.lastBufferedRequest;state4.lastBufferedRequest=new WriteReq(chunk,encoding,cb);if(last){last.next=state4.lastBufferedRequest}else{state4.bufferedRequest=state4.lastBufferedRequest}state4.bufferedRequestCount+=1}else{doWrite(stream,state4,false,len,chunk,encoding,cb)}return ret}function doWrite(stream,state4,writev,len,chunk,encoding,cb){state4.writelen=len;state4.writecb=cb;state4.writing=true;state4.sync=true;if(writev)stream._writev(chunk,state4.onwrite);else stream._write(chunk,encoding,state4.onwrite);state4.sync=false}function onwriteError(stream,state4,sync,er,cb){--state4.pendingcb;if(sync)processNextTick(cb,er);else cb(er);stream._writableState.errorEmitted=true;stream.emit("error",er)}function onwriteStateUpdate(state4){state4.writing=false;state4.writecb=null;state4.length-=state4.writelen;state4.writelen=0}function onwrite(stream,er){var state4=stream._writableState;var sync=state4.sync;var cb=state4.writecb;onwriteStateUpdate(state4);if(er)onwriteError(stream,state4,sync,er,cb);else{var finished=needFinish(state4);if(!finished&&!state4.corked&&!state4.bufferProcessing&&state4.bufferedRequest){clearBuffer(stream,state4)}if(sync){asyncWrite(afterWrite,stream,state4,finished,cb)}else{afterWrite(stream,state4,finished,cb)}}}function afterWrite(stream,state4,finished,cb){if(!finished)onwriteDrain(stream,state4);state4.pendingcb--;cb();finishMaybe(stream,state4)}function onwriteDrain(stream,state4){if(state4.length===0&&state4.needDrain){state4.needDrain=false;stream.emit("drain")}}function clearBuffer(stream,state4){state4.bufferProcessing=true;var entry=state4.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state4.bufferedRequestCount;var buffer=new Array(l);var holder=state4.corkedRequestsFree;holder.entry=entry;var count=0;while(entry){buffer[count]=entry;entry=entry.next;count+=1}doWrite(stream,state4,true,state4.length,buffer,"",holder.finish);state4.pendingcb++;state4.lastBufferedRequest=null;if(holder.next){state4.corkedRequestsFree=holder.next;holder.next=null}else{state4.corkedRequestsFree=new CorkedRequest(state4)}}else{while(entry){var chunk=entry.chunk;var encoding=entry.encoding;var cb=entry.callback;var len=state4.objectMode?1:chunk.length;doWrite(stream,state4,false,len,chunk,encoding,cb);entry=entry.next;if(state4.writing){break}}if(entry===null)state4.lastBufferedRequest=null}state4.bufferedRequestCount=0;state4.bufferedRequest=entry;state4.bufferProcessing=false}Writable.prototype._write=function(chunk,encoding,cb){cb(new Error("_write() is not implemented"))};Writable.prototype._writev=null;Writable.prototype.end=function(chunk,encoding,cb){var state4=this._writableState;if(typeof chunk==="function"){cb=chunk;chunk=null;encoding=null}else if(typeof encoding==="function"){cb=encoding;encoding=null}if(chunk!==null&&chunk!==void 0)this.write(chunk,encoding);if(state4.corked){state4.corked=1;this.uncork()}if(!state4.ending&&!state4.finished)endWritable(this,state4,cb)};function needFinish(state4){return state4.ending&&state4.length===0&&state4.bufferedRequest===null&&!state4.finished&&!state4.writing}function prefinish(stream,state4){if(!state4.prefinished){state4.prefinished=true;stream.emit("prefinish")}}function finishMaybe(stream,state4){var need=needFinish(state4);if(need){if(state4.pendingcb===0){prefinish(stream,state4);state4.finished=true;stream.emit("finish")}else{prefinish(stream,state4)}}return need}function endWritable(stream,state4,cb){state4.ending=true;finishMaybe(stream,state4);if(cb){if(state4.finished)processNextTick(cb);else stream.once("finish",cb)}state4.ended=true;stream.writable=false}function CorkedRequest(state4){var _this=this;this.next=null;this.entry=null;this.finish=function(err){var entry=_this.entry;_this.entry=null;while(entry){var cb=entry.callback;state4.pendingcb--;cb(err);entry=entry.next}if(state4.corkedRequestsFree){state4.corkedRequestsFree.next=_this}else{state4.corkedRequestsFree=_this}}}}).call(exports2,__webpack_require__(6))},function(module22,exports2){(function(global2){module22.exports=deprecate;function deprecate(fn,msg){if(config("noDeprecation")){return fn}var warned=false;function deprecated(){if(!warned){if(config("throwDeprecation")){throw new Error(msg)}else if(config("traceDeprecation")){console.trace(msg)}else{console.warn(msg)}warned=true}return fn.apply(this,arguments)}return deprecated}function config(name2){try{if(!global2.localStorage)return false}catch(_){return false}var val=global2.localStorage[name2];if(null==val)return false;return String(val).toLowerCase()==="true"}}).call(exports2,function(){return this}())},function(module22,exports2,__webpack_require__){var Buffer2=__webpack_require__(2).Buffer;var isBufferEncoding=Buffer2.isEncoding||function(encoding){switch(encoding&&encoding.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return true;default:return false}};function assertEncoding(encoding){if(encoding&&!isBufferEncoding(encoding)){throw new Error("Unknown encoding: "+encoding)}}var StringDecoder=exports2.StringDecoder=function(encoding){this.encoding=(encoding||"utf8").toLowerCase().replace(/[-_]/,"");assertEncoding(encoding);switch(this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2;this.detectIncompleteChar=utf16DetectIncompleteChar;break;case"base64":this.surrogateSize=3;this.detectIncompleteChar=base64DetectIncompleteChar;break;default:this.write=passThroughWrite;return}this.charBuffer=new Buffer2(6);this.charReceived=0;this.charLength=0};StringDecoder.prototype.write=function(buffer){var charStr="";while(this.charLength){var available=buffer.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:buffer.length;buffer.copy(this.charBuffer,this.charReceived,0,available);this.charReceived+=available;if(this.charReceived<this.charLength){return""}buffer=buffer.slice(available,buffer.length);charStr=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var charCode=charStr.charCodeAt(charStr.length-1);if(charCode>=55296&&charCode<=56319){this.charLength+=this.surrogateSize;charStr="";continue}this.charReceived=this.charLength=0;if(buffer.length===0){return charStr}break}this.detectIncompleteChar(buffer);var end=buffer.length;if(this.charLength){buffer.copy(this.charBuffer,0,buffer.length-this.charReceived,end);end-=this.charReceived}charStr+=buffer.toString(this.encoding,0,end);var end=charStr.length-1;var charCode=charStr.charCodeAt(end);if(charCode>=55296&&charCode<=56319){var size=this.surrogateSize;this.charLength+=size;this.charReceived+=size;this.charBuffer.copy(this.charBuffer,size,0,size);buffer.copy(this.charBuffer,0,0,size);return charStr.substring(0,end)}return charStr};StringDecoder.prototype.detectIncompleteChar=function(buffer){var i3=buffer.length>=3?3:buffer.length;for(;i3>0;i3--){var c=buffer[buffer.length-i3];if(i3==1&&c>>5==6){this.charLength=2;break}if(i3<=2&&c>>4==14){this.charLength=3;break}if(i3<=3&&c>>3==30){this.charLength=4;break}}this.charReceived=i3};StringDecoder.prototype.end=function(buffer){var res="";if(buffer&&buffer.length)res=this.write(buffer);if(this.charReceived){var cr=this.charReceived;var buf=this.charBuffer;var enc=this.encoding;res+=buf.slice(0,cr).toString(enc)}return res};function passThroughWrite(buffer){return buffer.toString(this.encoding)}function utf16DetectIncompleteChar(buffer){this.charReceived=buffer.length%2;this.charLength=this.charReceived?2:0}function base64DetectIncompleteChar(buffer){this.charReceived=buffer.length%3;this.charLength=this.charReceived?3:0}},function(module22,exports2,__webpack_require__){"use strict";module22.exports=Transform;var Duplex=__webpack_require__(21);var util=__webpack_require__(18);util.inherits=__webpack_require__(12);util.inherits(Transform,Duplex);function TransformState(stream){this.afterTransform=function(er,data){return afterTransform(stream,er,data)};this.needTransform=false;this.transforming=false;this.writecb=null;this.writechunk=null;this.writeencoding=null}function afterTransform(stream,er,data){var ts=stream._transformState;ts.transforming=false;var cb=ts.writecb;if(!cb)return stream.emit("error",new Error("no writecb in Transform class"));ts.writechunk=null;ts.writecb=null;if(data!==null&&data!==void 0)stream.push(data);cb(er);var rs=stream._readableState;rs.reading=false;if(rs.needReadable||rs.length<rs.highWaterMark){stream._read(rs.highWaterMark)}}function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options);this._transformState=new TransformState(this);var stream=this;this._readableState.needReadable=true;this._readableState.sync=false;if(options){if(typeof options.transform==="function")this._transform=options.transform;if(typeof options.flush==="function")this._flush=options.flush}this.once("prefinish",function(){if(typeof this._flush==="function")this._flush(function(er,data){done(stream,er,data)});else done(stream)})}Transform.prototype.push=function(chunk,encoding){this._transformState.needTransform=false;return Duplex.prototype.push.call(this,chunk,encoding)};Transform.prototype._transform=function(chunk,encoding,cb){throw new Error("_transform() is not implemented")};Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;ts.writecb=cb;ts.writechunk=chunk;ts.writeencoding=encoding;if(!ts.transforming){var rs=this._readableState;if(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)this._read(rs.highWaterMark)}};Transform.prototype._read=function(n){var ts=this._transformState;if(ts.writechunk!==null&&ts.writecb&&!ts.transforming){ts.transforming=true;this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform)}else{ts.needTransform=true}};function done(stream,er,data){if(er)return stream.emit("error",er);if(data!==null&&data!==void 0)stream.push(data);var ws=stream._writableState;var ts=stream._transformState;if(ws.length)throw new Error("Calling transform done when ws.length != 0");if(ts.transforming)throw new Error("Calling transform done when still transforming");return stream.push(null)}},function(module22,exports2,__webpack_require__){"use strict";module22.exports=PassThrough;var Transform=__webpack_require__(25);var util=__webpack_require__(18);util.inherits=__webpack_require__(12);util.inherits(PassThrough,Transform);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},function(module22,exports2,__webpack_require__){module22.exports=__webpack_require__(22)},function(module22,exports2,__webpack_require__){module22.exports=__webpack_require__(21)},function(module22,exports2,__webpack_require__){module22.exports=__webpack_require__(25)},function(module22,exports2,__webpack_require__){module22.exports=__webpack_require__(26)},function(module22,exports2,__webpack_require__){"use strict";var zlib_inflate=__webpack_require__(32);var utils=__webpack_require__(33);var strings=__webpack_require__(38);var c=__webpack_require__(39);var msg=__webpack_require__(40);var ZStream=__webpack_require__(41);var GZheader=__webpack_require__(42);var toString=Object.prototype.toString;function Inflate(options){if(!(this instanceof Inflate))return new Inflate(options);this.options=utils.assign({chunkSize:16384,windowBits:0,to:""},options||{});var opt=this.options;if(opt.raw&&opt.windowBits>=0&&opt.windowBits<16){opt.windowBits=-opt.windowBits;if(opt.windowBits===0){opt.windowBits=-15}}if(opt.windowBits>=0&&opt.windowBits<16&&!(options&&options.windowBits)){opt.windowBits+=32}if(opt.windowBits>15&&opt.windowBits<48){if((opt.windowBits&15)===0){opt.windowBits|=15}}this.err=0;this.msg="";this.ended=false;this.chunks=[];this.strm=new ZStream;this.strm.avail_out=0;var status=zlib_inflate.inflateInit2(this.strm,opt.windowBits);if(status!==c.Z_OK){throw new Error(msg[status])}this.header=new GZheader;zlib_inflate.inflateGetHeader(this.strm,this.header)}Inflate.prototype.push=function(data,mode){var strm=this.strm;var chunkSize=this.options.chunkSize;var dictionary=this.options.dictionary;var status,_mode;var next_out_utf8,tail,utf8str;var dict;var allowBufError=false;if(this.ended){return false}_mode=mode===~~mode?mode:mode===true?c.Z_FINISH:c.Z_NO_FLUSH;if(typeof data==="string"){strm.input=strings.binstring2buf(data)}else if(toString.call(data)==="[object ArrayBuffer]"){strm.input=new Uint8Array(data)}else{strm.input=data}strm.next_in=0;strm.avail_in=strm.input.length;do{if(strm.avail_out===0){strm.output=new utils.Buf8(chunkSize);strm.next_out=0;strm.avail_out=chunkSize}status=zlib_inflate.inflate(strm,c.Z_NO_FLUSH);if(status===c.Z_NEED_DICT&&dictionary){if(typeof dictionary==="string"){dict=strings.string2buf(dictionary)}else if(toString.call(dictionary)==="[object ArrayBuffer]"){dict=new Uint8Array(dictionary)}else{dict=dictionary}status=zlib_inflate.inflateSetDictionary(this.strm,dict)}if(status===c.Z_BUF_ERROR&&allowBufError===true){status=c.Z_OK;allowBufError=false}if(status!==c.Z_STREAM_END&&status!==c.Z_OK){this.onEnd(status);this.ended=true;return false}if(strm.next_out){if(strm.avail_out===0||status===c.Z_STREAM_END||strm.avail_in===0&&(_mode===c.Z_FINISH||_mode===c.Z_SYNC_FLUSH)){if(this.options.to==="string"){next_out_utf8=strings.utf8border(strm.output,strm.next_out);tail=strm.next_out-next_out_utf8;utf8str=strings.buf2string(strm.output,next_out_utf8);strm.next_out=tail;strm.avail_out=chunkSize-tail;if(tail){utils.arraySet(strm.output,strm.output,next_out_utf8,tail,0)}this.onData(utf8str)}else{this.onData(utils.shrinkBuf(strm.output,strm.next_out))}}}if(strm.avail_in===0&&strm.avail_out===0){allowBufError=true}}while((strm.avail_in>0||strm.avail_out===0)&&status!==c.Z_STREAM_END);if(status===c.Z_STREAM_END){_mode=c.Z_FINISH}if(_mode===c.Z_FINISH){status=zlib_inflate.inflateEnd(this.strm);this.onEnd(status);this.ended=true;return status===c.Z_OK}if(_mode===c.Z_SYNC_FLUSH){this.onEnd(c.Z_OK);strm.avail_out=0;return true}return true};Inflate.prototype.onData=function(chunk){this.chunks.push(chunk)};Inflate.prototype.onEnd=function(status){if(status===c.Z_OK){if(this.options.to==="string"){this.result=this.chunks.join("")}else{this.result=utils.flattenChunks(this.chunks)}}this.chunks=[];this.err=status;this.msg=this.strm.msg};function inflate(input,options){var inflator=new Inflate(options);inflator.push(input,true);if(inflator.err){throw inflator.msg||msg[inflator.err]}return inflator.result}function inflateRaw(input,options){options=options||{};options.raw=true;return inflate(input,options)}exports2.Inflate=Inflate;exports2.inflate=inflate;exports2.inflateRaw=inflateRaw;exports2.ungzip=inflate},function(module22,exports2,__webpack_require__){"use strict";var utils=__webpack_require__(33);var adler32=__webpack_require__(34);var crc32=__webpack_require__(35);var inflate_fast=__webpack_require__(36);var inflate_table=__webpack_require__(37);var CODES=0;var LENS=1;var DISTS=2;var Z_FINISH=4;var Z_BLOCK=5;var Z_TREES=6;var Z_OK=0;var Z_STREAM_END=1;var Z_NEED_DICT=2;var Z_STREAM_ERROR=-2;var Z_DATA_ERROR=-3;var Z_MEM_ERROR=-4;var Z_BUF_ERROR=-5;var Z_DEFLATED=8;var HEAD=1;var FLAGS=2;var TIME=3;var OS=4;var EXLEN=5;var EXTRA=6;var NAME=7;var COMMENT=8;var HCRC=9;var DICTID=10;var DICT=11;var TYPE=12;var TYPEDO=13;var STORED=14;var COPY_=15;var COPY=16;var TABLE=17;var LENLENS=18;var CODELENS=19;var LEN_=20;var LEN=21;var LENEXT=22;var DIST=23;var DISTEXT=24;var MATCH=25;var LIT=26;var CHECK=27;var LENGTH=28;var DONE=29;var BAD=30;var MEM=31;var SYNC=32;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var MAX_WBITS=15;var DEF_WBITS=MAX_WBITS;function zswap32(q){return(q>>>24&255)+(q>>>8&65280)+((q&65280)<<8)+((q&255)<<24)}function InflateState(){this.mode=0;this.last=false;this.wrap=0;this.havedict=false;this.flags=0;this.dmax=0;this.check=0;this.total=0;this.head=null;this.wbits=0;this.wsize=0;this.whave=0;this.wnext=0;this.window=null;this.hold=0;this.bits=0;this.length=0;this.offset=0;this.extra=0;this.lencode=null;this.distcode=null;this.lenbits=0;this.distbits=0;this.ncode=0;this.nlen=0;this.ndist=0;this.have=0;this.next=null;this.lens=new utils.Buf16(320);this.work=new utils.Buf16(288);this.lendyn=null;this.distdyn=null;this.sane=0;this.back=0;this.was=0}function inflateResetKeep(strm){var state4;if(!strm||!strm.state){return Z_STREAM_ERROR}state4=strm.state;strm.total_in=strm.total_out=state4.total=0;strm.msg="";if(state4.wrap){strm.adler=state4.wrap&1}state4.mode=HEAD;state4.last=0;state4.havedict=0;state4.dmax=32768;state4.head=null;state4.hold=0;state4.bits=0;state4.lencode=state4.lendyn=new utils.Buf32(ENOUGH_LENS);state4.distcode=state4.distdyn=new utils.Buf32(ENOUGH_DISTS);state4.sane=1;state4.back=-1;return Z_OK}function inflateReset(strm){var state4;if(!strm||!strm.state){return Z_STREAM_ERROR}state4=strm.state;state4.wsize=0;state4.whave=0;state4.wnext=0;return inflateResetKeep(strm)}function inflateReset2(strm,windowBits){var wrap;var state4;if(!strm||!strm.state){return Z_STREAM_ERROR}state4=strm.state;if(windowBits<0){wrap=0;windowBits=-windowBits}else{wrap=(windowBits>>4)+1;if(windowBits<48){windowBits&=15}}if(windowBits&&(windowBits<8||windowBits>15)){return Z_STREAM_ERROR}if(state4.window!==null&&state4.wbits!==windowBits){state4.window=null}state4.wrap=wrap;state4.wbits=windowBits;return inflateReset(strm)}function inflateInit2(strm,windowBits){var ret;var state4;if(!strm){return Z_STREAM_ERROR}state4=new InflateState;strm.state=state4;state4.window=null;ret=inflateReset2(strm,windowBits);if(ret!==Z_OK){strm.state=null}return ret}function inflateInit(strm){return inflateInit2(strm,DEF_WBITS)}var virgin=true;var lenfix,distfix;function fixedtables(state4){if(virgin){var sym;lenfix=new utils.Buf32(512);distfix=new utils.Buf32(32);sym=0;while(sym<144){state4.lens[sym++]=8}while(sym<256){state4.lens[sym++]=9}while(sym<280){state4.lens[sym++]=7}while(sym<288){state4.lens[sym++]=8}inflate_table(LENS,state4.lens,0,288,lenfix,0,state4.work,{bits:9});sym=0;while(sym<32){state4.lens[sym++]=5}inflate_table(DISTS,state4.lens,0,32,distfix,0,state4.work,{bits:5});virgin=false}state4.lencode=lenfix;state4.lenbits=9;state4.distcode=distfix;state4.distbits=5}function updatewindow(strm,src,end,copy){var dist;var state4=strm.state;if(state4.window===null){state4.wsize=1<<state4.wbits;state4.wnext=0;state4.whave=0;state4.window=new utils.Buf8(state4.wsize)}if(copy>=state4.wsize){utils.arraySet(state4.window,src,end-state4.wsize,state4.wsize,0);state4.wnext=0;state4.whave=state4.wsize}else{dist=state4.wsize-state4.wnext;if(dist>copy){dist=copy}utils.arraySet(state4.window,src,end-copy,dist,state4.wnext);copy-=dist;if(copy){utils.arraySet(state4.window,src,end-copy,copy,0);state4.wnext=copy;state4.whave=state4.wsize}else{state4.wnext+=dist;if(state4.wnext===state4.wsize){state4.wnext=0}if(state4.whave<state4.wsize){state4.whave+=dist}}}return 0}function inflate(strm,flush){var state4;var input,output;var next;var put;var have,left;var hold;var bits;var _in,_out;var copy;var from;var from_source;var here=0;var here_bits,here_op,here_val;var last_bits,last_op,last_val;var len;var ret;var hbuf=new utils.Buf8(4);var opts;var n;var order=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!strm||!strm.state||!strm.output||!strm.input&&strm.avail_in!==0){return Z_STREAM_ERROR}state4=strm.state;if(state4.mode===TYPE){state4.mode=TYPEDO}put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state4.hold;bits=state4.bits;_in=have;_out=left;ret=Z_OK;inf_leave:for(;;){switch(state4.mode){case HEAD:if(state4.wrap===0){state4.mode=TYPEDO;break}while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state4.wrap&2&&hold===35615){state4.check=0;hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state4.check=crc32(state4.check,hbuf,2,0);hold=0;bits=0;state4.mode=FLAGS;break}state4.flags=0;if(state4.head){state4.head.done=false}if(!(state4.wrap&1)||(((hold&255)<<8)+(hold>>8))%31){strm.msg="incorrect header check";state4.mode=BAD;break}if((hold&15)!==Z_DEFLATED){strm.msg="unknown compression method";state4.mode=BAD;break}hold>>>=4;bits-=4;len=(hold&15)+8;if(state4.wbits===0){state4.wbits=len}else if(len>state4.wbits){strm.msg="invalid window size";state4.mode=BAD;break}state4.dmax=1<<len;strm.adler=state4.check=1;state4.mode=hold&512?DICTID:TYPE;hold=0;bits=0;break;case FLAGS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.flags=hold;if((state4.flags&255)!==Z_DEFLATED){strm.msg="unknown compression method";state4.mode=BAD;break}if(state4.flags&57344){strm.msg="unknown header flags set";state4.mode=BAD;break}if(state4.head){state4.head.text=hold>>8&1}if(state4.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state4.check=crc32(state4.check,hbuf,2,0)}hold=0;bits=0;state4.mode=TIME;case TIME:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state4.head){state4.head.time=hold}if(state4.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;hbuf[2]=hold>>>16&255;hbuf[3]=hold>>>24&255;state4.check=crc32(state4.check,hbuf,4,0)}hold=0;bits=0;state4.mode=OS;case OS:while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(state4.head){state4.head.xflags=hold&255;state4.head.os=hold>>8}if(state4.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state4.check=crc32(state4.check,hbuf,2,0)}hold=0;bits=0;state4.mode=EXLEN;case EXLEN:if(state4.flags&1024){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.length=hold;if(state4.head){state4.head.extra_len=hold}if(state4.flags&512){hbuf[0]=hold&255;hbuf[1]=hold>>>8&255;state4.check=crc32(state4.check,hbuf,2,0)}hold=0;bits=0}else if(state4.head){state4.head.extra=null}state4.mode=EXTRA;case EXTRA:if(state4.flags&1024){copy=state4.length;if(copy>have){copy=have}if(copy){if(state4.head){len=state4.head.extra_len-state4.length;if(!state4.head.extra){state4.head.extra=new Array(state4.head.extra_len)}utils.arraySet(state4.head.extra,input,next,copy,len)}if(state4.flags&512){state4.check=crc32(state4.check,input,copy,next)}have-=copy;next+=copy;state4.length-=copy}if(state4.length){break inf_leave}}state4.length=0;state4.mode=NAME;case NAME:if(state4.flags&2048){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state4.head&&len&&state4.length<65536){state4.head.name+=String.fromCharCode(len)}}while(len&&copy<have);if(state4.flags&512){state4.check=crc32(state4.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state4.head){state4.head.name=null}state4.length=0;state4.mode=COMMENT;case COMMENT:if(state4.flags&4096){if(have===0){break inf_leave}copy=0;do{len=input[next+copy++];if(state4.head&&len&&state4.length<65536){state4.head.comment+=String.fromCharCode(len)}}while(len&&copy<have);if(state4.flags&512){state4.check=crc32(state4.check,input,copy,next)}have-=copy;next+=copy;if(len){break inf_leave}}else if(state4.head){state4.head.comment=null}state4.mode=HCRC;case HCRC:if(state4.flags&512){while(bits<16){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state4.check&65535)){strm.msg="header crc mismatch";state4.mode=BAD;break}hold=0;bits=0}if(state4.head){state4.head.hcrc=state4.flags>>9&1;state4.head.done=true}strm.adler=state4.check=0;state4.mode=TYPE;break;case DICTID:while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}strm.adler=state4.check=zswap32(hold);hold=0;bits=0;state4.mode=DICT;case DICT:if(state4.havedict===0){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state4.hold=hold;state4.bits=bits;return Z_NEED_DICT}strm.adler=state4.check=1;state4.mode=TYPE;case TYPE:if(flush===Z_BLOCK||flush===Z_TREES){break inf_leave}case TYPEDO:if(state4.last){hold>>>=bits&7;bits-=bits&7;state4.mode=CHECK;break}while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.last=hold&1;hold>>>=1;bits-=1;switch(hold&3){case 0:state4.mode=STORED;break;case 1:fixedtables(state4);state4.mode=LEN_;if(flush===Z_TREES){hold>>>=2;bits-=2;break inf_leave}break;case 2:state4.mode=TABLE;break;case 3:strm.msg="invalid block type";state4.mode=BAD}hold>>>=2;bits-=2;break;case STORED:hold>>>=bits&7;bits-=bits&7;while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((hold&65535)!==(hold>>>16^65535)){strm.msg="invalid stored block lengths";state4.mode=BAD;break}state4.length=hold&65535;hold=0;bits=0;state4.mode=COPY_;if(flush===Z_TREES){break inf_leave}case COPY_:state4.mode=COPY;case COPY:copy=state4.length;if(copy){if(copy>have){copy=have}if(copy>left){copy=left}if(copy===0){break inf_leave}utils.arraySet(output,input,next,copy,put);have-=copy;next+=copy;left-=copy;put+=copy;state4.length-=copy;break}state4.mode=TYPE;break;case TABLE:while(bits<14){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.nlen=(hold&31)+257;hold>>>=5;bits-=5;state4.ndist=(hold&31)+1;hold>>>=5;bits-=5;state4.ncode=(hold&15)+4;hold>>>=4;bits-=4;if(state4.nlen>286||state4.ndist>30){strm.msg="too many length or distance symbols";state4.mode=BAD;break}state4.have=0;state4.mode=LENLENS;case LENLENS:while(state4.have<state4.ncode){while(bits<3){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.lens[order[state4.have++]]=hold&7;hold>>>=3;bits-=3}while(state4.have<19){state4.lens[order[state4.have++]]=0}state4.lencode=state4.lendyn;state4.lenbits=7;opts={bits:state4.lenbits};ret=inflate_table(CODES,state4.lens,0,19,state4.lencode,0,state4.work,opts);state4.lenbits=opts.bits;if(ret){strm.msg="invalid code lengths set";state4.mode=BAD;break}state4.have=0;state4.mode=CODELENS;case CODELENS:while(state4.have<state4.nlen+state4.ndist){for(;;){here=state4.lencode[hold&(1<<state4.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_val<16){hold>>>=here_bits;bits-=here_bits;state4.lens[state4.have++]=here_val}else{if(here_val===16){n=here_bits+2;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;if(state4.have===0){strm.msg="invalid bit length repeat";state4.mode=BAD;break}len=state4.lens[state4.have-1];copy=3+(hold&3);hold>>>=2;bits-=2}else if(here_val===17){n=here_bits+3;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=3+(hold&7);hold>>>=3;bits-=3}else{n=here_bits+7;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=here_bits;bits-=here_bits;len=0;copy=11+(hold&127);hold>>>=7;bits-=7}if(state4.have+copy>state4.nlen+state4.ndist){strm.msg="invalid bit length repeat";state4.mode=BAD;break}while(copy--){state4.lens[state4.have++]=len}}}if(state4.mode===BAD){break}if(state4.lens[256]===0){strm.msg="invalid code -- missing end-of-block";state4.mode=BAD;break}state4.lenbits=9;opts={bits:state4.lenbits};ret=inflate_table(LENS,state4.lens,0,state4.nlen,state4.lencode,0,state4.work,opts);state4.lenbits=opts.bits;if(ret){strm.msg="invalid literal/lengths set";state4.mode=BAD;break}state4.distbits=6;state4.distcode=state4.distdyn;opts={bits:state4.distbits};ret=inflate_table(DISTS,state4.lens,state4.nlen,state4.ndist,state4.distcode,0,state4.work,opts);state4.distbits=opts.bits;if(ret){strm.msg="invalid distances set";state4.mode=BAD;break}state4.mode=LEN_;if(flush===Z_TREES){break inf_leave}case LEN_:state4.mode=LEN;case LEN:if(have>=6&&left>=258){strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state4.hold=hold;state4.bits=bits;inflate_fast(strm,_out);put=strm.next_out;output=strm.output;left=strm.avail_out;next=strm.next_in;input=strm.input;have=strm.avail_in;hold=state4.hold;bits=state4.bits;if(state4.mode===TYPE){state4.back=-1}break}state4.back=0;for(;;){here=state4.lencode[hold&(1<<state4.lenbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(here_op&&(here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state4.lencode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state4.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state4.back+=here_bits;state4.length=here_val;if(here_op===0){state4.mode=LIT;break}if(here_op&32){state4.back=-1;state4.mode=TYPE;break}if(here_op&64){strm.msg="invalid literal/length code";state4.mode=BAD;break}state4.extra=here_op&15;state4.mode=LENEXT;case LENEXT:if(state4.extra){n=state4.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.length+=hold&(1<<state4.extra)-1;hold>>>=state4.extra;bits-=state4.extra;state4.back+=state4.extra}state4.was=state4.length;state4.mode=DIST;case DIST:for(;;){here=state4.distcode[hold&(1<<state4.distbits)-1];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if((here_op&240)===0){last_bits=here_bits;last_op=here_op;last_val=here_val;for(;;){here=state4.distcode[last_val+((hold&(1<<last_bits+last_op)-1)>>last_bits)];here_bits=here>>>24;here_op=here>>>16&255;here_val=here&65535;if(last_bits+here_bits<=bits){break}if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}hold>>>=last_bits;bits-=last_bits;state4.back+=last_bits}hold>>>=here_bits;bits-=here_bits;state4.back+=here_bits;if(here_op&64){strm.msg="invalid distance code";state4.mode=BAD;break}state4.offset=here_val;state4.extra=here_op&15;state4.mode=DISTEXT;case DISTEXT:if(state4.extra){n=state4.extra;while(bits<n){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}state4.offset+=hold&(1<<state4.extra)-1;hold>>>=state4.extra;bits-=state4.extra;state4.back+=state4.extra}if(state4.offset>state4.dmax){strm.msg="invalid distance too far back";state4.mode=BAD;break}state4.mode=MATCH;case MATCH:if(left===0){break inf_leave}copy=_out-left;if(state4.offset>copy){copy=state4.offset-copy;if(copy>state4.whave){if(state4.sane){strm.msg="invalid distance too far back";state4.mode=BAD;break}}if(copy>state4.wnext){copy-=state4.wnext;from=state4.wsize-copy}else{from=state4.wnext-copy}if(copy>state4.length){copy=state4.length}from_source=state4.window}else{from_source=output;from=put-state4.offset;copy=state4.length}if(copy>left){copy=left}left-=copy;state4.length-=copy;do{output[put++]=from_source[from++]}while(--copy);if(state4.length===0){state4.mode=LEN}break;case LIT:if(left===0){break inf_leave}output[put++]=state4.length;left--;state4.mode=LEN;break;case CHECK:if(state4.wrap){while(bits<32){if(have===0){break inf_leave}have--;hold|=input[next++]<<bits;bits+=8}_out-=left;strm.total_out+=_out;state4.total+=_out;if(_out){strm.adler=state4.check=state4.flags?crc32(state4.check,output,_out,put-_out):adler32(state4.check,output,_out,put-_out)}_out=left;if((state4.flags?hold:zswap32(hold))!==state4.check){strm.msg="incorrect data check";state4.mode=BAD;break}hold=0;bits=0}state4.mode=LENGTH;case LENGTH:if(state4.wrap&&state4.flags){while(bits<32){if(have===0){break inf_leave}have--;hold+=input[next++]<<bits;bits+=8}if(hold!==(state4.total&4294967295)){strm.msg="incorrect length check";state4.mode=BAD;break}hold=0;bits=0}state4.mode=DONE;case DONE:ret=Z_STREAM_END;break inf_leave;case BAD:ret=Z_DATA_ERROR;break inf_leave;case MEM:return Z_MEM_ERROR;case SYNC:default:return Z_STREAM_ERROR}}strm.next_out=put;strm.avail_out=left;strm.next_in=next;strm.avail_in=have;state4.hold=hold;state4.bits=bits;if(state4.wsize||_out!==strm.avail_out&&state4.mode<BAD&&(state4.mode<CHECK||flush!==Z_FINISH)){if(updatewindow(strm,strm.output,strm.next_out,_out-strm.avail_out)){state4.mode=MEM;return Z_MEM_ERROR}}_in-=strm.avail_in;_out-=strm.avail_out;strm.total_in+=_in;strm.total_out+=_out;state4.total+=_out;if(state4.wrap&&_out){strm.adler=state4.check=state4.flags?crc32(state4.check,output,_out,strm.next_out-_out):adler32(state4.check,output,_out,strm.next_out-_out)}strm.data_type=state4.bits+(state4.last?64:0)+(state4.mode===TYPE?128:0)+(state4.mode===LEN_||state4.mode===COPY_?256:0);if((_in===0&&_out===0||flush===Z_FINISH)&&ret===Z_OK){ret=Z_BUF_ERROR}return ret}function inflateEnd(strm){if(!strm||!strm.state){return Z_STREAM_ERROR}var state4=strm.state;if(state4.window){state4.window=null}strm.state=null;return Z_OK}function inflateGetHeader(strm,head){var state4;if(!strm||!strm.state){return Z_STREAM_ERROR}state4=strm.state;if((state4.wrap&2)===0){return Z_STREAM_ERROR}state4.head=head;head.done=false;return Z_OK}function inflateSetDictionary(strm,dictionary){var dictLength=dictionary.length;var state4;var dictid;var ret;if(!strm||!strm.state){return Z_STREAM_ERROR}state4=strm.state;if(state4.wrap!==0&&state4.mode!==DICT){return Z_STREAM_ERROR}if(state4.mode===DICT){dictid=1;dictid=adler32(dictid,dictionary,dictLength,0);if(dictid!==state4.check){return Z_DATA_ERROR}}ret=updatewindow(strm,dictionary,dictLength,dictLength);if(ret){state4.mode=MEM;return Z_MEM_ERROR}state4.havedict=1;return Z_OK}exports2.inflateReset=inflateReset;exports2.inflateReset2=inflateReset2;exports2.inflateResetKeep=inflateResetKeep;exports2.inflateInit=inflateInit;exports2.inflateInit2=inflateInit2;exports2.inflate=inflate;exports2.inflateEnd=inflateEnd;exports2.inflateGetHeader=inflateGetHeader;exports2.inflateSetDictionary=inflateSetDictionary;exports2.inflateInfo="pako inflate (from Nodeca project)"},function(module22,exports2){"use strict";var TYPED_OK=typeof Uint8Array!=="undefined"&&typeof Uint16Array!=="undefined"&&typeof Int32Array!=="undefined";exports2.assign=function(obj){var sources=Array.prototype.slice.call(arguments,1);while(sources.length){var source=sources.shift();if(!source){continue}if(typeof source!=="object"){throw new TypeError(source+"must be non-object")}for(var p2 in source){if(source.hasOwnProperty(p2)){obj[p2]=source[p2]}}}return obj};exports2.shrinkBuf=function(buf,size){if(buf.length===size){return buf}if(buf.subarray){return buf.subarray(0,size)}buf.length=size;return buf};var fnTyped={arraySet:function(dest,src,src_offs,len,dest_offs){if(src.subarray&&dest.subarray){dest.set(src.subarray(src_offs,src_offs+len),dest_offs);return}for(var i3=0;i3<len;i3++){dest[dest_offs+i3]=src[src_offs+i3]}},flattenChunks:function(chunks){var i3,l,len,pos,chunk,result;len=0;for(i3=0,l=chunks.length;i3<l;i3++){len+=chunks[i3].length}result=new Uint8Array(len);pos=0;for(i3=0,l=chunks.length;i3<l;i3++){chunk=chunks[i3];result.set(chunk,pos);pos+=chunk.length}return result}};var fnUntyped={arraySet:function(dest,src,src_offs,len,dest_offs){for(var i3=0;i3<len;i3++){dest[dest_offs+i3]=src[src_offs+i3]}},flattenChunks:function(chunks){return[].concat.apply([],chunks)}};exports2.setTyped=function(on){if(on){exports2.Buf8=Uint8Array;exports2.Buf16=Uint16Array;exports2.Buf32=Int32Array;exports2.assign(exports2,fnTyped)}else{exports2.Buf8=Array;exports2.Buf16=Array;exports2.Buf32=Array;exports2.assign(exports2,fnUntyped)}};exports2.setTyped(TYPED_OK)},function(module22,exports2){"use strict";function adler32(adler,buf,len,pos){var s1=adler&65535|0,s2=adler>>>16&65535|0,n=0;while(len!==0){n=len>2e3?2e3:len;len-=n;do{s1=s1+buf[pos++]|0;s2=s2+s1|0}while(--n);s1%=65521;s2%=65521}return s1|s2<<16|0}module22.exports=adler32},function(module22,exports2){"use strict";function makeTable(){var c,table=[];for(var n=0;n<256;n++){c=n;for(var k=0;k<8;k++){c=c&1?3988292384^c>>>1:c>>>1}table[n]=c}return table}var crcTable=makeTable();function crc32(crc,buf,len,pos){var t3=crcTable,end=pos+len;crc^=-1;for(var i3=pos;i3<end;i3++){crc=crc>>>8^t3[(crc^buf[i3])&255]}return crc^-1}module22.exports=crc32},function(module22,exports2){"use strict";var BAD=30;var TYPE=12;module22.exports=function inflate_fast(strm,start){var state4;var _in;var last;var _out;var beg;var end;var dmax;var wsize;var whave;var wnext;var s_window;var hold;var bits;var lcode;var dcode;var lmask;var dmask;var here;var op;var len;var dist;var from;var from_source;var input,output;state4=strm.state;_in=strm.next_in;input=strm.input;last=_in+(strm.avail_in-5);_out=strm.next_out;output=strm.output;beg=_out-(start-strm.avail_out);end=_out+(strm.avail_out-257);dmax=state4.dmax;wsize=state4.wsize;whave=state4.whave;wnext=state4.wnext;s_window=state4.window;hold=state4.hold;bits=state4.bits;lcode=state4.lencode;dcode=state4.distcode;lmask=(1<<state4.lenbits)-1;dmask=(1<<state4.distbits)-1;top:do{if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=lcode[hold&lmask];dolen:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op===0){output[_out++]=here&65535}else if(op&16){len=here&65535;op&=15;if(op){if(bits<op){hold+=input[_in++]<<bits;bits+=8}len+=hold&(1<<op)-1;hold>>>=op;bits-=op}if(bits<15){hold+=input[_in++]<<bits;bits+=8;hold+=input[_in++]<<bits;bits+=8}here=dcode[hold&dmask];dodist:for(;;){op=here>>>24;hold>>>=op;bits-=op;op=here>>>16&255;if(op&16){dist=here&65535;op&=15;if(bits<op){hold+=input[_in++]<<bits;bits+=8;if(bits<op){hold+=input[_in++]<<bits;bits+=8}}dist+=hold&(1<<op)-1;if(dist>dmax){strm.msg="invalid distance too far back";state4.mode=BAD;break top}hold>>>=op;bits-=op;op=_out-beg;if(dist>op){op=dist-op;if(op>whave){if(state4.sane){strm.msg="invalid distance too far back";state4.mode=BAD;break top}}from=0;from_source=s_window;if(wnext===0){from+=wsize-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}else if(wnext<op){from+=wsize+wnext-op;op-=wnext;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=0;if(wnext<len){op=wnext;len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}}else{from+=wnext-op;if(op<len){len-=op;do{output[_out++]=s_window[from++]}while(--op);from=_out-dist;from_source=output}}while(len>2){output[_out++]=from_source[from++];output[_out++]=from_source[from++];output[_out++]=from_source[from++];len-=3}if(len){output[_out++]=from_source[from++];if(len>1){output[_out++]=from_source[from++]}}}else{from=_out-dist;do{output[_out++]=output[from++];output[_out++]=output[from++];output[_out++]=output[from++];len-=3}while(len>2);if(len){output[_out++]=output[from++];if(len>1){output[_out++]=output[from++]}}}}else if((op&64)===0){here=dcode[(here&65535)+(hold&(1<<op)-1)];continue dodist}else{strm.msg="invalid distance code";state4.mode=BAD;break top}break}}else if((op&64)===0){here=lcode[(here&65535)+(hold&(1<<op)-1)];continue dolen}else if(op&32){state4.mode=TYPE;break top}else{strm.msg="invalid literal/length code";state4.mode=BAD;break top}break}}while(_in<last&&_out<end);len=bits>>3;_in-=len;bits-=len<<3;hold&=(1<<bits)-1;strm.next_in=_in;strm.next_out=_out;strm.avail_in=_in<last?5+(last-_in):5-(_in-last);strm.avail_out=_out<end?257+(end-_out):257-(_out-end);state4.hold=hold;state4.bits=bits;return}},function(module22,exports2,__webpack_require__){"use strict";var utils=__webpack_require__(33);var MAXBITS=15;var ENOUGH_LENS=852;var ENOUGH_DISTS=592;var CODES=0;var LENS=1;var DISTS=2;var lbase=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0];var lext=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78];var dbase=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0];var dext=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];module22.exports=function inflate_table(type,lens,lens_index,codes,table,table_index,work,opts){var bits=opts.bits;var len=0;var sym=0;var min=0,max=0;var root=0;var curr=0;var drop=0;var left=0;var used=0;var huff=0;var incr;var fill;var low;var mask;var next;var base=null;var base_index=0;var end;var count=new utils.Buf16(MAXBITS+1);var offs=new utils.Buf16(MAXBITS+1);var extra=null;var extra_index=0;var here_bits,here_op,here_val;for(len=0;len<=MAXBITS;len++){count[len]=0}for(sym=0;sym<codes;sym++){count[lens[lens_index+sym]]++}root=bits;for(max=MAXBITS;max>=1;max--){if(count[max]!==0){break}}if(root>max){root=max}if(max===0){table[table_index++]=1<<24|64<<16|0;table[table_index++]=1<<24|64<<16|0;opts.bits=1;return 0}for(min=1;min<max;min++){if(count[min]!==0){break}}if(root<min){root=min}left=1;for(len=1;len<=MAXBITS;len++){left<<=1;left-=count[len];if(left<0){return-1}}if(left>0&&(type===CODES||max!==1)){return-1}offs[1]=0;for(len=1;len<MAXBITS;len++){offs[len+1]=offs[len]+count[len]}for(sym=0;sym<codes;sym++){if(lens[lens_index+sym]!==0){work[offs[lens[lens_index+sym]]++]=sym}}if(type===CODES){base=extra=work;end=19}else if(type===LENS){base=lbase;base_index-=257;extra=lext;extra_index-=257;end=256}else{base=dbase;extra=dext;end=-1}huff=0;sym=0;len=min;next=table_index;curr=root;drop=0;low=-1;used=1<<root;mask=used-1;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}for(;;){here_bits=len-drop;if(work[sym]<end){here_op=0;here_val=work[sym]}else if(work[sym]>end){here_op=extra[extra_index+work[sym]];here_val=base[base_index+work[sym]]}else{here_op=32+64;here_val=0}incr=1<<len-drop;fill=1<<curr;min=fill;do{fill-=incr;table[next+(huff>>drop)+fill]=here_bits<<24|here_op<<16|here_val|0}while(fill!==0);incr=1<<len-1;while(huff&incr){incr>>=1}if(incr!==0){huff&=incr-1;huff+=incr}else{huff=0}sym++;if(--count[len]===0){if(len===max){break}len=lens[lens_index+work[sym]]}if(len>root&&(huff&mask)!==low){if(drop===0){drop=root}next+=min;curr=len-drop;left=1<<curr;while(curr+drop<max){left-=count[curr+drop];if(left<=0){break}curr++;left<<=1}used+=1<<curr;if(type===LENS&&used>ENOUGH_LENS||type===DISTS&&used>ENOUGH_DISTS){return 1}low=huff&mask;table[low]=root<<24|curr<<16|next-table_index|0}}if(huff!==0){table[next+huff]=len-drop<<24|64<<16|0}opts.bits=root;return 0}},function(module22,exports2,__webpack_require__){"use strict";var utils=__webpack_require__(33);var STR_APPLY_OK=true;var STR_APPLY_UIA_OK=true;try{String.fromCharCode.apply(null,[0])}catch(__){STR_APPLY_OK=false}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(__){STR_APPLY_UIA_OK=false}var _utf8len=new utils.Buf8(256);for(var q=0;q<256;q++){_utf8len[q]=q>=252?6:q>=248?5:q>=240?4:q>=224?3:q>=192?2:1}_utf8len[254]=_utf8len[254]=1;exports2.string2buf=function(str4){var buf,c,c2,m_pos,i3,str_len=str4.length,buf_len=0;for(m_pos=0;m_pos<str_len;m_pos++){c=str4.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str4.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}buf_len+=c<128?1:c<2048?2:c<65536?3:4}buf=new utils.Buf8(buf_len);for(i3=0,m_pos=0;i3<buf_len;m_pos++){c=str4.charCodeAt(m_pos);if((c&64512)===55296&&m_pos+1<str_len){c2=str4.charCodeAt(m_pos+1);if((c2&64512)===56320){c=65536+(c-55296<<10)+(c2-56320);m_pos++}}if(c<128){buf[i3++]=c}else if(c<2048){buf[i3++]=192|c>>>6;buf[i3++]=128|c&63}else if(c<65536){buf[i3++]=224|c>>>12;buf[i3++]=128|c>>>6&63;buf[i3++]=128|c&63}else{buf[i3++]=240|c>>>18;buf[i3++]=128|c>>>12&63;buf[i3++]=128|c>>>6&63;buf[i3++]=128|c&63}}return buf};function buf2binstring(buf,len){if(len<65537){if(buf.subarray&&STR_APPLY_UIA_OK||!buf.subarray&&STR_APPLY_OK){return String.fromCharCode.apply(null,utils.shrinkBuf(buf,len))}}var result="";for(var i3=0;i3<len;i3++){result+=String.fromCharCode(buf[i3])}return result}exports2.buf2binstring=function(buf){return buf2binstring(buf,buf.length)};exports2.binstring2buf=function(str4){var buf=new utils.Buf8(str4.length);for(var i3=0,len=buf.length;i3<len;i3++){buf[i3]=str4.charCodeAt(i3)}return buf};exports2.buf2string=function(buf,max){var i3,out,c,c_len;var len=max||buf.length;var utf16buf=new Array(len*2);for(out=0,i3=0;i3<len;){c=buf[i3++];if(c<128){utf16buf[out++]=c;continue}c_len=_utf8len[c];if(c_len>4){utf16buf[out++]=65533;i3+=c_len-1;continue}c&=c_len===2?31:c_len===3?15:7;while(c_len>1&&i3<len){c=c<<6|buf[i3++]&63;c_len--}if(c_len>1){utf16buf[out++]=65533;continue}if(c<65536){utf16buf[out++]=c}else{c-=65536;utf16buf[out++]=55296|c>>10&1023;utf16buf[out++]=56320|c&1023}}return buf2binstring(utf16buf,out)};exports2.utf8border=function(buf,max){var pos;max=max||buf.length;if(max>buf.length){max=buf.length}pos=max-1;while(pos>=0&&(buf[pos]&192)===128){pos--}if(pos<0){return max}if(pos===0){return max}return pos+_utf8len[buf[pos]]>max?pos:max}},function(module22,exports2){"use strict";module22.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(module22,exports2){"use strict";module22.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(module22,exports2){"use strict";function ZStream(){this.input=null;this.next_in=0;this.avail_in=0;this.total_in=0;this.output=null;this.next_out=0;this.avail_out=0;this.total_out=0;this.msg="";this.state=null;this.data_type=2;this.adler=0}module22.exports=ZStream},function(module22,exports2){"use strict";function GZheader(){this.text=0;this.time=0;this.xflags=0;this.os=0;this.extra=null;this.extra_len=0;this.name="";this.comment="";this.hcrc=0;this.done=false}module22.exports=GZheader}])})}});var CSV=class{constructor(onOpen=this.onOpen,saveButtonId=null,openButtonId=null){this.onOpen=onOpen;this.notes=[{idx:0,text:"comment"}];if(saveButtonId!==null){document.getElementById(saveButtonId).addEventListener("click",this.saveCSV)}if(openButtonId!==null){document.getElementById(openButtonId).addEventListener("click",this.openCSV)}}processArraysForCSV(data=["1|2|3","3|2|1"],delimiter="|",header="a,b,c",saveNotes=false){let csvDat=header+"\\n";let noteIdx=0;data.forEach((line,i3)=>{if(data[i3]==="string"&&delimiter!==","){csvDat+=line.split(delimiter).join(",")}else{csvData+=line.join(",")}if(saveNotes===true){if(this.notes[noteIdx].idx===i3){line+=this.notes[noteIdx].text;noteIdx++}}if(line.indexOf("\\n")<0){csvDat+="\\n"}});return csvDat}static saveCSV(csvDat="a,b,c\\n1,2,3\\n3,2,1\\n",name2=new Date().toISOString()){var hiddenElement=document.createElement("a");hiddenElement.href="data:text/csv;charset=utf-8,"+encodeURI(csvDat);hiddenElement.target="_blank";if(name2!==""){hiddenElement.download=name2}else{hiddenElement.download=Date().toISOString()}hiddenElement.click()}static openCSV(delimiter=",",onOpen=(csvDat,header,path)=>{return csvDat,header,path}){return new Promise((res,rej)=>{var input=document.createElement("input");input.accept=".csv";input.type="file";input.onchange=e=>{var file=e.target.files[0];var reader=new FileReader;reader.onload=event=>{var tempcsvData=event.target.result;var tempcsvArr=tempcsvData.split("\\n");let header=[];var csvDat=[];tempcsvArr.pop();tempcsvArr.forEach((row,i3)=>{if(i3==0){header=row.split(delimiter)}else{var temp=row.split(delimiter);csvDat.push(temp)}});onOpen(csvDat,header,input.value);input.value="";res({data:csvDat,header,filename:input.value})};reader.readAsText(file)};input.click()})}static openCSVRaw(onOpen=(csvDat,path)=>{return csvDat,path}){return new Promise((res,rej)=>{var input=document.createElement("input");input.accept=".csv";input.type="file";input.onchange=e=>{var file=e.target.files[0];var reader=new FileReader;reader.onload=event=>{var tempcsvData=event.target.result;onOpen(tempcsvData,input.value);input.value="";res({data:tempcsvData,filename:input.value})};reader.readAsText(file)};input.click()})}onOpen(csvDat=[],header=[]){console.log("CSV Opened!",header,csvDat)}};var parseCSVData=(data,filename,head,hasend=true,parser=(lines,filename2,head2)=>{let result={filename:filename2};let header=head2;if(typeof head2==="string")header=head2.split(",");result.header=header;for(let i3=0;i3<lines.length;i3++){let line=lines[i3].split(",");for(let j=0;j<line.length;j++){if(!result[header[j]])result[header[j]]=[];result[header[j]].push(line[j])}}return result})=>{let lines=data.split("\\r\\n");if(!head)head=lines[0];lines.shift();if(hasend===false)lines.pop();let result=parser(lines,filename,head);return result};function toISOLocal(d2){d2=new Date(d2);var z3=n=>("0"+n).slice(-2);var zz=n=>("00"+n).slice(-3);var off=d2.getTimezoneOffset();var sign=off<0?"+":"-";off=Math.abs(off);return d2.getFullYear()+"-"+z3(d2.getMonth()+1)+"-"+z3(d2.getDate())+"T"+z3(d2.getHours())+":"+z3(d2.getMinutes())+":"+z3(d2.getSeconds())+"."+zz(d2.getMilliseconds())+"(UTC"+sign+z3(off/60|0)+":00)"}var BrowserFS=__toESM4(require_browserfs());var fsInited=false;var fs2=BrowserFS.BFSRequire("fs");var BFSBuffer=BrowserFS.BFSRequire("buffer").Buffer;var initFS=async(dirs=["data"],oninit=(exists2=[])=>{},onerror=e=>{},filesystem="IndexedDB")=>{if(fsInited)return true;else{fsInited=true;return new Promise((resolve,reject)=>{let oldmfs=fs2.getRootFS();BrowserFS.FileSystem[filesystem].Create({},(e,mountableFileSystem)=>{if(e){reject(e);return}if(!mountableFileSystem){onerror(e);reject(new Error(`Error creating BrowserFS`));return}BrowserFS.initialize(mountableFileSystem);let promises=[];dirs.forEach(async dir=>{promises.push(dirExists(fs2,dir))});Promise.all(promises).then(values=>{oninit(values);fsInited=true;resolve(true)})})})}};var exists=async(path="")=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise(resolve=>{fs2.exists("/"+path,function(exists2){resolve(exists2)})})};var readFile=async(path="data")=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise(resolve=>{fs2.readFile("/"+path,function(e,output){resolve(output)})})};async function readFileChunk(path="data",begin=0,end=5120,onread=data=>{}){if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);if(path!=""){return new Promise(async(resolve,reject)=>{fs2.open("/"+path,"r",(e,fd)=>{if(e){reject(e);return}fs2.read(fd,end,begin,"utf-8",(er,output,bytesRead)=>{if(er){reject(er);return}if(bytesRead!==0){let data=output.toString();fs2.close(fd,()=>{onread(data,path);resolve(data)})}else resolve(void 0)})})})}else{console.error("Path name is not defined");return void 0}}var getFilenames=async(directory="data",onload=directory2=>{})=>{if(!fsInited)await initFS([directory]);else await dirExists(fs2,directory);return new Promise((resolve,reject)=>{fs2.readdir("/"+directory,(e,dir)=>{if(e){reject(e);return}if(dir){onload(dir);resolve(dir)}else resolve(void 0)})})};var writeFile=async(path,data,onwrite=data2=>{})=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise((resolve,reject)=>{fs2.writeFile("/"+path,data,err=>{if(err){reject(err);return}onwrite(data);resolve(true)})})};var appendFile2=async(path,data,onwrite=data2=>{})=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise((resolve,reject)=>{fs2.appendFile("/"+path,data,err=>{if(err){reject(err);return}onwrite(data);resolve(true)})})};var deleteFile=async(path="data",ondelete=()=>{})=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise(resolve=>{if(path!=""){fs2.unlink("/"+path,e=>{if(e)console.error(e);ondelete();resolve(true)})}else{console.error("Path name is not defined");resolve(false)}})};var readFileAsText=async(path="data",end="end",begin=0,onread=(data,filename)=>{})=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise(async(resolve,reject)=>{let size=await getFileSize(path);if(end==="end"){end=size}else if(typeof end==="number"){if(end>size)end=size}fs2.open("/"+path,"r",(e,fd)=>{if(e){reject(e);return}fs2.read(fd,end,begin,"utf-8",(er,output,bytesRead)=>{if(er){reject(er);return}if(bytesRead!==0){let data=output.toString();fs2.close(fd,()=>{onread(data,path);resolve(data)})}else resolve(void 0)})})})};var listFiles=async(dir="data",onload=directory=>{})=>{if(!fsInited)await initFS([dir]);else await dirExists(fs2,dir);return new Promise((resolve,reject)=>{fs2.readdir("/"+dir,(e,directory)=>{if(e){reject(e);return}if(directory){onload(directory)}resolve(directory)})})};var getFileSize=async(path="data",onread=size=>{console.log(size)})=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise((resolve,reject)=>{fs2.stat("/"+path,(e,stats)=>{if(e){reject(e);return}let filesize=stats.size;onread(filesize);resolve(filesize)})})};var getCSVHeader=async(path="data",onopen=(header,filename)=>{console.log(header,filename)})=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise((resolve,reject)=>{fs2.open("/"+path,"r",(e,fd)=>{if(e){reject(e);return}fs2.read(fd,65535,0,"utf-8",(er,output,bytesRead)=>{if(er){reject(er);return}if(bytesRead!==0){let data=output.toString();let lines=data.split("\\n");let header=lines[0];fs2.close(fd,()=>{onopen(header,path);resolve(header)})}else resolve(void 0)})})})};var writeToCSVFromDB=async(path="data",fileSizeLimitMb=10)=>{if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);return new Promise((resolve,reject)=>{if(path!=""){fs2.stat("/"+path,(e,stats)=>{if(e){reject(e);return}let filesize=stats.size;console.log(filesize);fs2.open(path,"r",(e2,fd)=>{if(e2){reject(e2);return}let i3=0;let maxFileSize=fileSizeLimitMb*1024*1024;let end=maxFileSize;if(filesize<maxFileSize){end=filesize;fs2.read(fd,end,0,"utf-8",(e3,output,bytesRead)=>{if(e3){reject(e3);return}if(bytesRead!==0)CSV.saveCSV(output.toString(),path);fs2.close(fd);resolve(true)})}else{const writeChunkToFile=async()=>{if(i3<filesize){if(i3+end>filesize){end=filesize-i3}let chunk=0;fs2.read(fd,end,i3,"utf-8",(e3,output,bytesRead)=>{if(e3){reject(e3);return}if(bytesRead!==0){CSV.saveCSV(output.toString(),path+"_"+chunk);i3+=maxFileSize;chunk++;writeChunkToFile();fs2.close(fd);resolve(true)}})}}}})})}else{console.error("File name is not defined.");resolve(false)}})};async function readCSVChunkFromDB(path="data",start=0,end="end",options={}){if(!fsInited)await initFS([path.split("/")[0]]);else await dirExists(fs2,path.split("/")[0]);const transpose=options.transpose||false;let head=await getCSVHeader(path);if(head)head=head.split(",");else return void 0;let resultLengths=[];let resultNames=[];let results=transpose?[]:{};head.forEach(v2=>{if(v2){resultNames.push(v2);resultLengths.push(1)}else resultLengths[resultLengths.length-1]++});let size=await getFileSize(path);if(end==="end")end=size;else if(end>size){start=size-(end-start);end=size}let data=(await readFileChunk(path,start,end)).split("\\n").slice(1,-1);let preprocess=value=>{if(options.json){try{value=JSON.parse(value)}catch{}}return value};data.forEach((r,i3)=>{let row=r.split(",");if(transpose){const entry={};row.forEach((v2,idx)=>entry[resultNames[idx]]=preprocess(v2));results.push(entry)}else{row.forEach((v2,i22)=>{const header=resultNames[i22];if(!results[header])results[header]=[];results[header].push(preprocess(v2))})}});return results}var directories={};var dirExists=async(fs3,directory)=>{return new Promise((resolve,reject)=>{if(directories[directory]==="exists"||directories[directory]==="created"){resolve()}else{fs3.exists(`/${directory}`,exists2=>{if(exists2){directories[directory]="exists";console.log(`/${directory} exists!`);resolve()}else if(directories[directory]==="creating"){console.log(directory+" is still being created.");resolve()}else{console.log(`creating /${directory}`,fs3);directories[directory]="creating";fs3.mkdir(`/${directory}`,1,err=>{if(err){reject(err);return}directories[directory]="created";setTimeout(resolve,500)})}})}})};var BFSRoutes={initFS,dirExists,exists,readFile,readFileChunk,getFilenames,writeFile,appendFile:appendFile2,deleteFile,readFileAsText,getFileSize,getCSVHeader,listFiles};var CSV_REFERENCE={};function lerp(v0,v1,t3){return(1-t3)*v0+t3*v1}function interpolerp(v0,v1,fit,floor=true){if(fit<=2)return[v0,v1];let a=1/fit;let result=new Array(fit);result[0]=v0;for(let i3=1;i3<=fit;i3++){result[i3]=lerp(v0,v1,a*i3);if(floor)result[i3]=Math.floor(result[i3])}return result}var appendCSV=async(newData,filename,header,options)=>{if(!filename){let keys3=Object.keys(CSV_REFERENCE);if(keys3.length>0)filename=keys3[keys3.length-1];else filename=`csv${new Date().toISOString()}`}let csv=CSV_REFERENCE[filename];if(!csv){let keys3=Array.from(Object.keys(newData));if(keys3.indexOf("timestamp")>-1)keys3.splice(keys3.indexOf("timestamp"),1);CSV_REFERENCE[filename]={header:header?header:["timestamp","localized",...keys3],lastX:void 0,buffer:"",buffered:0,bufferSize:0,toFixed:0,xIncrement:void 0};csv=CSV_REFERENCE[filename];const existingHeader=await getCSVHeader(filename).catch(()=>null);const isDifferent=!existingHeader||existingHeader!==csv.header.join(",");if(isDifferent)header=csv.header}if(!csv.header||csv.header?.length===0){let keys3=Array.from(Object.keys(newData));if(keys3.indexOf("timestamp")>-1)keys3.splice(keys3.indexOf("timestamp"),1);csv.header=header?header:["timestamp","localized",...keys3]}else if(header)csv.header=header;let maxLen=1;for(const key in newData){const value=newData[key];if(csv.header.indexOf(key)>-1&&value&&Array.isArray(value)&&value?.length>maxLen)maxLen=value?.length}let x3;if(csv.xIncrement){if(!csv.lastX){if(typeof newData[csv.header[0]]!=="undefined"){x3=newData[csv.header[0]]}else if(csv.header[0].toLowerCase().includes("time")||csv.header[0].toLowerCase().includes("unix"))x3=Date.now()}else{if(newData[csv.header[2]]){if(Array.isArray(newData[csv.header[2]]))x3=csv.lastX+csv.xIncrement*newData[csv.header[2]].length;else x3=csv.lastX+csv.xIncrement}else if(newData[csv.header[0]]){if(Array.isArray(newData[csv.header[0]]))x3=csv.lastX+csv.xIncrement*newData[csv.header[0]].length;else x3=csv.lastX+csv.xIncrement}else x3=csv.lastX+csv.xIncrement}}else if(newData[csv.header[0]])x3=newData[csv.header[0]];else x3=Date.now();if(typeof csv.lastX==="undefined")csv.lastX=Array.isArray(x3)?x3[0]:x3;if(typeof x3==="undefined"){if(csv.header[0].includes("time")){let now=Date.now();if(maxLen===1)x3=Date.now();else{x3=interpolerp(csv.lastX,now,maxLen);x3.shift()}}else{let newX=csv.lastX+1;if(maxLen>1){x3=new Array(maxLen).fill("");x3[maxLen-1]=newX}else x3=newX}}else if(maxLen>1&&x3?.length!==maxLen){if(!Array.isArray(x3)||x3.length===1){x3=interpolerp(csv.lastX,x3,maxLen);x3.shift()}else{x3=interpolerp(x3[0],x3[x3.length-1],maxLen);x3.shift()}}let toAppend=[];if(Array.isArray(x3)){let curIdcs={};for(let i3=0;i3<x3.length;i3++){toAppend.push([]);for(let j=0;j<csv.header.length;j++){let d2=newData[csv.header[j]];if(j===0){toAppend[i3][0]=x3[i3];if(csv.header[j+1]==="localized"){j++;toAppend[i3][j]=toISOLocal(x3[i3])}continue}if(d2===void 0){toAppend[i3][j]=""}else if(Array.isArray(d2)){if(d2.length===x3.length)toAppend[i3][j]=d2[i3];else{if(!(csv.header[j]in curIdcs)){curIdcs[csv.header[j]]=i3;if(d2.length!==1)toAppend[i3][j]=d2[i3]}else{if(d2.length===1&&i3===x3.length-1){toAppend[i3][j]=d2[curIdcs[csv.header[j]]]}else if(Math.floor(d2.length*i3/x3.length)>curIdcs[csv.header[j]]){curIdcs[csv.header[j]]++;toAppend[i3][j]=d2[curIdcs[csv.header[j]]]}else{toAppend[i3][j]=""}}}}else{if(i3===x3.length-1){toAppend[i3][j]=d2}else{toAppend[i3][j]=""}}if(typeof toAppend[i3][j]==="number"&&Math.floor(toAppend[i3][j])!==toAppend[i3][j])toAppend[i3][j]=toAppend[i3][j].toFixed(CSV_REFERENCE[filename].toFixed)}}}else{toAppend.push([]);for(let j=0;j<csv.header.length;j++){if(j===0){toAppend[0][0]=x3;if(csv.header[j+1]==="localized"){j++;toAppend[0][j]=toISOLocal(x3)}continue}if(csv.header[j]in newData)toAppend[0][j]=newData[csv.header[j]];else toAppend[0][j]="";if(typeof toAppend[0][j]==="number"&&Math.floor(toAppend[0][j])!==toAppend[0][j])toAppend[0][j]=toAppend[0][j].toFixed(CSV_REFERENCE[filename].toFixed)}}let csvProcessed="";if(header)csvProcessed+=header.join(",")+"\\n";toAppend.forEach(arr=>{csvProcessed+=(options?.json?arr.map(v2=>JSON.stringify(v2)):arr).join(",")+"\\n";if(csv.bufferSize)csv.buffered++});csv.lastX=toAppend[toAppend.length-1][0];if(csv.bufferSize){csv.buffer+=csvProcessed;if(csv.buffered>csv.bufferSize){let r=new Promise((res,rej)=>{exists(filename).then(fileExists=>{if(!fileExists){writeFile(filename,csv.buffer,written=>{res(written)})}else{appendFile2(filename,csv.buffer,written=>{res(written)})}})});await r;csv.buffer="";csv.buffered=0;return r}else return Promise.resolve(true)}else{return new Promise((res,rej)=>{exists(filename).then(fileExists=>{if(!fileExists){writeFile(filename,csvProcessed,written=>{res(written)})}else{appendFile2(filename,csvProcessed,written=>{res(written)})}})})}};var updateCSVHeader=(header,filename)=>{if(CSV_REFERENCE[filename]){CSV_REFERENCE[filename].header=header}};var createCSV=(filename,header,toFixed=5,bufferSize=0,xIncrement)=>{if(header?.indexOf("timestamp")>1){header.splice(header.indexOf("timestamp"),1);header.unshift("timestamp")}if((header?.[0].toLowerCase().includes("time")||header?.[0].toLowerCase().includes("unix"))&&header[1]!=="localized"){header.splice(1,0,"localized")}CSV_REFERENCE[filename]={header,lastX:header[1]==="localized"?Date.now():0,bufferSize,buffer:"",buffered:0,toFixed,xIncrement};return new Promise((res,rej)=>{writeFile(filename,CSV_REFERENCE[filename].header?CSV_REFERENCE[filename].header.join(",")+"\\n":"",written=>{res(written)}).catch(rej)})};var visualizeDirectory=(dir,parentNode=document.body)=>{return new Promise(async(res,rej)=>{if(parentNode.querySelector("#bfs"+dir))parentNode.querySelector("#bfs"+dir)?.remove();parentNode.insertAdjacentHTML("beforeend",`<div id=\'bfs${dir}\' class=\'bfs${dir}\'></div>`);let div=parentNode.querySelector("#bfs"+dir);await listFiles(dir).then(directory=>{if(directory.length===0)div.innerHTML="No Files!";else directory.forEach(listing=>{div?.insertAdjacentHTML("beforeend",`<div id=\'${listing}\' class=\'bfsfilediv\'>\n                        <span class=\'bfsfiletitle\'>Data: </span>\n                        <span>${listing}</span>\n                        <button class=\'bfsdownloadbtn\' id=\'download${listing}\'>Download CSV</button>\n                        ${listing.indexOf(".")>-1?`<button class=\'bfsdeletebtn\' id=\'delete${listing}\'>Delete</button>`:""}\n                    </div>`);if(document.getElementById(`delete${listing}`)){document.getElementById(`delete${listing}`).onclick=()=>{deleteFile(dir+"/"+listing,()=>{visualizeDirectory(dir,parentNode)})}}if(document.getElementById(`download${listing}`)){document.getElementById(`download${listing}`).onclick=()=>{writeToCSVFromDB(dir+"/"+listing,10)}}});res(directory)}).catch(rej)})};var csvRoutes={appendCSV,updateCSVHeader,createCSV,visualizeDirectory,openCSV:CSV.openCSV,saveCSV:CSV.saveCSV,openCSVRaw:CSV.openCSVRaw,parseCSVData,getCSVHeader,writeToCSVFromDB,readCSVChunkFromDB,toISOLocal};Object.assign(nodeTemplates,algorithms);if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){globalThis.Devices=Devices2;const worker=new WorkerService({roots:{...workerCanvasRoutes,...remoteGraphRoutes,...BFSRoutes,...csvRoutes,...streamWorkerRoutes,...webglPlotRoutes}});console.log("worker",worker)}var device_worker_default=self;})();\n/*! Bundled license information:\n\ndevice-decoder/dist/device.frontend.esm.js:\n  (*! Bundled license information:\n  \n  @capacitor/core/dist/index.js:\n    (*! Capacitor: https://capacitorjs.com/ - MIT License *)\n  *)\n\ngraphscript-services.storage/dist/index.storage.services.esm.js:\n  (*! Bundled license information:\n  \n  browserfs/dist/browserfs.js:\n    (*!\n    * The buffer module from node.js, for the browser.\n    *\n    * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>\n    * @license  MIT\n    *)\n  *)\n*/\n',gp=URL.createObjectURL(new globalThis.Blob([hp],{type:"text/javascript"})),fa=gp;var yp=Object.create,Lc=Object.defineProperty,bp=Object.getOwnPropertyDescriptor,Dc=Object.getOwnPropertyNames,mp=Object.getPrototypeOf,_p=Object.prototype.hasOwnProperty,vp=(e,t)=>function(){return t||(0,e[Dc(e)[0]])((t={exports:{}}).exports,t),t.exports},wp=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Dc(t))!_p.call(e,n)&&n!==r&&Lc(e,n,{get:()=>t[n],enumerable:!(i=bp(t,n))||i.enumerable});return e},Sp=(e,t,r)=>(r=e!=null?yp(mp(e)):{},wp(t||!e||!e.__esModule?Lc(r,"default",{value:e,enumerable:!0}):r,e)),kp=vp({"node_modules/browserfs/dist/browserfs.js"(e,t){(function(i,n){typeof e=="object"&&typeof t=="object"?t.exports=n():typeof define=="function"&&define.amd?define([],n):typeof e=="object"?e.BrowserFS=n():i.BrowserFS=n()})(e,function(){return function(r){var i={};function n(a){if(i[a])return i[a].exports;var p=i[a]={exports:{},id:a,loaded:!1};return r[a].call(p.exports,p,p.exports,n),p.loaded=!0,p.exports}return n.m=r,n.c=i,n.p="",n(0)}([function(r,i,n){(function(a,p,d,y){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var b=n(2),v=n(9),h;(function(f){f[f.EPERM=1]="EPERM",f[f.ENOENT=2]="ENOENT",f[f.EIO=5]="EIO",f[f.EBADF=9]="EBADF",f[f.EACCES=13]="EACCES",f[f.EBUSY=16]="EBUSY",f[f.EEXIST=17]="EEXIST",f[f.ENOTDIR=20]="ENOTDIR",f[f.EISDIR=21]="EISDIR",f[f.EINVAL=22]="EINVAL",f[f.EFBIG=27]="EFBIG",f[f.ENOSPC=28]="ENOSPC",f[f.EROFS=30]="EROFS",f[f.ENOTEMPTY=39]="ENOTEMPTY",f[f.ENOTSUP=95]="ENOTSUP"})(h||(h={}));var w={};w[h.EPERM]="Operation not permitted.",w[h.ENOENT]="No such file or directory.",w[h.EIO]="Input/output error.",w[h.EBADF]="Bad file descriptor.",w[h.EACCES]="Permission denied.",w[h.EBUSY]="Resource busy or locked.",w[h.EEXIST]="File exists.",w[h.ENOTDIR]="File is not a directory.",w[h.EISDIR]="File is a directory.",w[h.EINVAL]="Invalid argument.",w[h.EFBIG]="File is too big.",w[h.ENOSPC]="No space left on disk.",w[h.EROFS]="Cannot modify a read-only file system.",w[h.ENOTEMPTY]="Directory is not empty.",w[h.ENOTSUP]="Operation is not supported.";var _=function(f){function s(l,o,u){o===void 0&&(o=w[l]),f.call(this,o),this.syscall="",this.errno=l,this.code=h[l],this.path=u,this.stack=new f().stack,this.message="Error: "+this.code+": "+o+(this.path?", '"+this.path+"'":"")}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.fromJSON=function(o){var u=new s(0);return u.errno=o.errno,u.code=o.code,u.path=o.path,u.stack=o.stack,u.message=o.message,u},s.fromBuffer=function(o,u){return u===void 0&&(u=0),s.fromJSON(JSON.parse(o.toString("utf8",u+4,u+4+o.readUInt32LE(u))))},s.FileError=function(o,u){return new s(o,w[o],u)},s.ENOENT=function(o){return this.FileError(h.ENOENT,o)},s.EEXIST=function(o){return this.FileError(h.EEXIST,o)},s.EISDIR=function(o){return this.FileError(h.EISDIR,o)},s.ENOTDIR=function(o){return this.FileError(h.ENOTDIR,o)},s.EPERM=function(o){return this.FileError(h.EPERM,o)},s.ENOTEMPTY=function(o){return this.FileError(h.ENOTEMPTY,o)},s.prototype.toString=function(){return this.message},s.prototype.toJSON=function(){return{errno:this.errno,code:this.code,path:this.path,stack:this.stack,message:this.message}},s.prototype.writeToBuffer=function(o,u){o===void 0&&(o=a.alloc(this.bufferSize())),u===void 0&&(u=0);var g=o.write(JSON.stringify(this.toJSON()),u+4);return o.writeUInt32LE(g,u),o},s.prototype.bufferSize=function(){return 4+a.byteLength(JSON.stringify(this.toJSON()))},s}(Error),T=Object.freeze({get ErrorCode(){return h},ErrorStrings:w,ApiError:_}),C;(function(f){f[f.NOP=0]="NOP",f[f.THROW_EXCEPTION=1]="THROW_EXCEPTION",f[f.TRUNCATE_FILE=2]="TRUNCATE_FILE",f[f.CREATE_FILE=3]="CREATE_FILE"})(C||(C={}));var I=function f(s){if(this.flagStr=s,f.validFlagStrs.indexOf(s)<0)throw new _(h.EINVAL,"Invalid flag: "+s)};I.getFileFlag=function(s){return I.flagCache.hasOwnProperty(s)?I.flagCache[s]:I.flagCache[s]=new I(s)},I.prototype.getFlagString=function(){return this.flagStr},I.prototype.isReadable=function(){return this.flagStr.indexOf("r")!==-1||this.flagStr.indexOf("+")!==-1},I.prototype.isWriteable=function(){return this.flagStr.indexOf("w")!==-1||this.flagStr.indexOf("a")!==-1||this.flagStr.indexOf("+")!==-1},I.prototype.isTruncating=function(){return this.flagStr.indexOf("w")!==-1},I.prototype.isAppendable=function(){return this.flagStr.indexOf("a")!==-1},I.prototype.isSynchronous=function(){return this.flagStr.indexOf("s")!==-1},I.prototype.isExclusive=function(){return this.flagStr.indexOf("x")!==-1},I.prototype.pathExistsAction=function(){return this.isExclusive()?C.THROW_EXCEPTION:this.isTruncating()?C.TRUNCATE_FILE:C.NOP},I.prototype.pathNotExistsAction=function(){return(this.isWriteable()||this.isAppendable())&&this.flagStr!=="r+"?C.CREATE_FILE:C.THROW_EXCEPTION},I.flagCache={},I.validFlagStrs=["r","r+","rs","rs+","w","wx","w+","wx+","a","ax","a+","ax+"];var P;(function(f){f[f.FILE=32768]="FILE",f[f.DIRECTORY=16384]="DIRECTORY",f[f.SYMLINK=40960]="SYMLINK"})(P||(P={}));var U=function(s,l,o,u,g,m){if(u===void 0&&(u=new Date),g===void 0&&(g=new Date),m===void 0&&(m=new Date),this.size=l,this.atime=u,this.mtime=g,this.ctime=m,this.dev=0,this.ino=0,this.rdev=0,this.nlink=1,this.blksize=4096,this.uid=0,this.gid=0,this.birthtime=new Date(0),this.fileData=null,o)this.mode=o;else switch(s){case P.FILE:this.mode=420;break;case P.DIRECTORY:default:this.mode=511}this.blocks=Math.ceil(l/512),this.mode<4096&&(this.mode|=s)};U.fromBuffer=function(s){var l=s.readUInt32LE(0),o=s.readUInt32LE(4),u=s.readDoubleLE(8),g=s.readDoubleLE(16),m=s.readDoubleLE(24);return new U(o&61440,l,o&4095,new Date(u),new Date(g),new Date(m))},U.prototype.toBuffer=function(){var s=a.alloc(32);return s.writeUInt32LE(this.size,0),s.writeUInt32LE(this.mode,4),s.writeDoubleLE(this.atime.getTime(),8),s.writeDoubleLE(this.mtime.getTime(),16),s.writeDoubleLE(this.ctime.getTime(),24),s},U.prototype.clone=function(){return new U(this.mode&61440,this.size,this.mode&4095,this.atime,this.mtime,this.ctime)},U.prototype.isFile=function(){return(this.mode&61440)===P.FILE},U.prototype.isDirectory=function(){return(this.mode&61440)===P.DIRECTORY},U.prototype.isSymbolicLink=function(){return(this.mode&61440)===P.SYMLINK},U.prototype.chmod=function(s){this.mode=this.mode&61440|s},U.prototype.isSocket=function(){return!1},U.prototype.isBlockDevice=function(){return!1},U.prototype.isCharacterDevice=function(){return!1},U.prototype.isFIFO=function(){return!1};var H=function(f,s){return f};function Q(f){if(f)return f;throw new _(h.EIO,"Initialize BrowserFS with a file system using BrowserFS.initialize(filesystem)")}function W(f,s){switch(typeof f){case"number":return f;case"string":var l=parseInt(f,8);return isNaN(l)?s:l;default:return s}}function Be(f){if(f instanceof Date)return f;if(typeof f=="number")return new Date(f*1e3);throw new _(h.EINVAL,"Invalid time.")}function re(f){if(f.indexOf("\0")>=0)throw new _(h.EINVAL,"Path must be a string without null bytes.");if(f==="")throw new _(h.EINVAL,"Path must not be empty.");return v.resolve(f)}function me(f,s,l,o){switch(typeof f){case"object":return{encoding:typeof f.encoding<"u"?f.encoding:s,flag:typeof f.flag<"u"?f.flag:l,mode:W(f.mode,o)};case"string":return{encoding:f,flag:l,mode:o};default:return{encoding:s,flag:l,mode:o}}}function Fe(){}var ee=function(){this.F_OK=0,this.R_OK=4,this.W_OK=2,this.X_OK=1,this.root=null,this.fdMap={},this.nextFd=100};ee.prototype.initialize=function(s){if(!s.constructor.isAvailable())throw new _(h.EINVAL,"Tried to instantiate BrowserFS with an unavailable file system.");return this.root=s},ee.prototype._toUnixTimestamp=function(s){if(typeof s=="number")return s;if(s instanceof Date)return s.getTime()/1e3;throw new Error("Cannot parse time: "+s)},ee.prototype.getRootFS=function(){return this.root?this.root:null},ee.prototype.rename=function(s,l,o){o===void 0&&(o=Fe);var u=H(o,1);try{Q(this.root).rename(re(s),re(l),u)}catch(g){u(g)}},ee.prototype.renameSync=function(s,l){Q(this.root).renameSync(re(s),re(l))},ee.prototype.exists=function(s,l){l===void 0&&(l=Fe);var o=H(l,1);try{return Q(this.root).exists(re(s),o)}catch{return o(!1)}},ee.prototype.existsSync=function(s){try{return Q(this.root).existsSync(re(s))}catch{return!1}},ee.prototype.stat=function(s,l){l===void 0&&(l=Fe);var o=H(l,2);try{return Q(this.root).stat(re(s),!1,o)}catch(u){return o(u)}},ee.prototype.statSync=function(s){return Q(this.root).statSync(re(s),!1)},ee.prototype.lstat=function(s,l){l===void 0&&(l=Fe);var o=H(l,2);try{return Q(this.root).stat(re(s),!0,o)}catch(u){return o(u)}},ee.prototype.lstatSync=function(s){return Q(this.root).statSync(re(s),!0)},ee.prototype.truncate=function(s,l,o){l===void 0&&(l=0),o===void 0&&(o=Fe);var u=0;typeof l=="function"?o=l:typeof l=="number"&&(u=l);var g=H(o,1);try{if(u<0)throw new _(h.EINVAL);return Q(this.root).truncate(re(s),u,g)}catch(m){return g(m)}},ee.prototype.truncateSync=function(s,l){if(l===void 0&&(l=0),l<0)throw new _(h.EINVAL);return Q(this.root).truncateSync(re(s),l)},ee.prototype.unlink=function(s,l){l===void 0&&(l=Fe);var o=H(l,1);try{return Q(this.root).unlink(re(s),o)}catch(u){return o(u)}},ee.prototype.unlinkSync=function(s){return Q(this.root).unlinkSync(re(s))},ee.prototype.open=function(s,l,o,u){var g=this;u===void 0&&(u=Fe);var m=W(o,420);u=typeof o=="function"?o:u;var k=H(u,2);try{Q(this.root).open(re(s),I.getFileFlag(l),m,function(N,F){F?k(N,g.getFdForFile(F)):k(N)})}catch(N){k(N)}},ee.prototype.openSync=function(s,l,o){return o===void 0&&(o=420),this.getFdForFile(Q(this.root).openSync(re(s),I.getFileFlag(l),W(o,420)))},ee.prototype.readFile=function(s,l,o){l===void 0&&(l={}),o===void 0&&(o=Fe);var u=me(l,null,"r",null);o=typeof l=="function"?l:o;var g=H(o,2);try{var m=I.getFileFlag(u.flag);return m.isReadable()?Q(this.root).readFile(re(s),u.encoding,m,g):g(new _(h.EINVAL,"Flag passed to readFile must allow for reading."))}catch(k){return g(k)}},ee.prototype.readFileSync=function(s,l){l===void 0&&(l={});var o=me(l,null,"r",null),u=I.getFileFlag(o.flag);if(!u.isReadable())throw new _(h.EINVAL,"Flag passed to readFile must allow for reading.");return Q(this.root).readFileSync(re(s),o.encoding,u)},ee.prototype.writeFile=function(s,l,o,u){o===void 0&&(o={}),u===void 0&&(u=Fe);var g=me(o,"utf8","w",420);u=typeof o=="function"?o:u;var m=H(u,1);try{var k=I.getFileFlag(g.flag);return k.isWriteable()?Q(this.root).writeFile(re(s),l,g.encoding,k,g.mode,m):m(new _(h.EINVAL,"Flag passed to writeFile must allow for writing."))}catch(N){return m(N)}},ee.prototype.writeFileSync=function(s,l,o){var u=me(o,"utf8","w",420),g=I.getFileFlag(u.flag);if(!g.isWriteable())throw new _(h.EINVAL,"Flag passed to writeFile must allow for writing.");return Q(this.root).writeFileSync(re(s),l,u.encoding,g,u.mode)},ee.prototype.appendFile=function(s,l,o,u){u===void 0&&(u=Fe);var g=me(o,"utf8","a",420);u=typeof o=="function"?o:u;var m=H(u,1);try{var k=I.getFileFlag(g.flag);if(!k.isAppendable())return m(new _(h.EINVAL,"Flag passed to appendFile must allow for appending."));Q(this.root).appendFile(re(s),l,g.encoding,k,g.mode,m)}catch(N){m(N)}},ee.prototype.appendFileSync=function(s,l,o){var u=me(o,"utf8","a",420),g=I.getFileFlag(u.flag);if(!g.isAppendable())throw new _(h.EINVAL,"Flag passed to appendFile must allow for appending.");return Q(this.root).appendFileSync(re(s),l,u.encoding,g,u.mode)},ee.prototype.fstat=function(s,l){l===void 0&&(l=Fe);var o=H(l,2);try{var u=this.fd2file(s);u.stat(o)}catch(g){o(g)}},ee.prototype.fstatSync=function(s){return this.fd2file(s).statSync()},ee.prototype.close=function(s,l){var o=this;l===void 0&&(l=Fe);var u=H(l,1);try{this.fd2file(s).close(function(g){g||o.closeFd(s),u(g)})}catch(g){u(g)}},ee.prototype.closeSync=function(s){this.fd2file(s).closeSync(),this.closeFd(s)},ee.prototype.ftruncate=function(s,l,o){o===void 0&&(o=Fe);var u=typeof l=="number"?l:0;o=typeof l=="function"?l:o;var g=H(o,1);try{var m=this.fd2file(s);if(u<0)throw new _(h.EINVAL);m.truncate(u,g)}catch(k){g(k)}},ee.prototype.ftruncateSync=function(s,l){l===void 0&&(l=0);var o=this.fd2file(s);if(l<0)throw new _(h.EINVAL);o.truncateSync(l)},ee.prototype.fsync=function(s,l){l===void 0&&(l=Fe);var o=H(l,1);try{this.fd2file(s).sync(o)}catch(u){o(u)}},ee.prototype.fsyncSync=function(s){this.fd2file(s).syncSync()},ee.prototype.fdatasync=function(s,l){l===void 0&&(l=Fe);var o=H(l,1);try{this.fd2file(s).datasync(o)}catch(u){o(u)}},ee.prototype.fdatasyncSync=function(s){this.fd2file(s).datasyncSync()},ee.prototype.write=function(s,l,o,u,g,m){m===void 0&&(m=Fe);var k,N,F,z=null;if(typeof l=="string"){var G="utf8";switch(typeof o){case"function":m=o;break;case"number":z=o,G=typeof u=="string"?u:"utf8",m=typeof g=="function"?g:m;break;default:return m=typeof u=="function"?u:typeof g=="function"?g:m,m(new _(h.EINVAL,"Invalid arguments."))}k=a.from(l,G),N=0,F=k.length}else k=l,N=o,F=u,z=typeof g=="number"?g:null,m=typeof g=="function"?g:m;var ae=H(m,3);try{var we=this.fd2file(s);z==null&&(z=we.getPos()),we.write(k,N,F,z,ae)}catch(ke){ae(ke)}},ee.prototype.writeSync=function(s,l,o,u,g){var m,k=0,N,F;if(typeof l=="string"){F=typeof o=="number"?o:null;var z=typeof u=="string"?u:"utf8";k=0,m=a.from(l,z),N=m.length}else m=l,k=o,N=u,F=typeof g=="number"?g:null;var G=this.fd2file(s);return F==null&&(F=G.getPos()),G.writeSync(m,k,N,F)},ee.prototype.read=function(s,l,o,u,g,m){m===void 0&&(m=Fe);var k,N,F,z,G;if(typeof l=="number"){F=l,k=o;var ae=u;m=typeof g=="function"?g:m,N=0,z=a.alloc(F),G=H(function(ke,$e,Ke){if(ke)return m(ke);m(ke,Ke.toString(ae),$e)},3)}else z=l,N=o,F=u,k=g,G=H(m,3);try{var we=this.fd2file(s);k==null&&(k=we.getPos()),we.read(z,N,F,k,G)}catch(ke){G(ke)}},ee.prototype.readSync=function(s,l,o,u,g){var m=!1,k,N,F,z,G="utf8";typeof l=="number"?(F=l,z=o,G=u,N=0,k=a.alloc(F),m=!0):(k=l,N=o,F=u,z=g);var ae=this.fd2file(s);z==null&&(z=ae.getPos());var we=ae.readSync(k,N,F,z);return m?[k.toString(G),we]:we},ee.prototype.fchown=function(s,l,o,u){u===void 0&&(u=Fe);var g=H(u,1);try{this.fd2file(s).chown(l,o,g)}catch(m){g(m)}},ee.prototype.fchownSync=function(s,l,o){this.fd2file(s).chownSync(l,o)},ee.prototype.fchmod=function(s,l,o){var u=H(o,1);try{var g=typeof l=="string"?parseInt(l,8):l;this.fd2file(s).chmod(g,u)}catch(m){u(m)}},ee.prototype.fchmodSync=function(s,l){var o=typeof l=="string"?parseInt(l,8):l;this.fd2file(s).chmodSync(o)},ee.prototype.futimes=function(s,l,o,u){u===void 0&&(u=Fe);var g=H(u,1);try{var m=this.fd2file(s);typeof l=="number"&&(l=new Date(l*1e3)),typeof o=="number"&&(o=new Date(o*1e3)),m.utimes(l,o,g)}catch(k){g(k)}},ee.prototype.futimesSync=function(s,l,o){this.fd2file(s).utimesSync(Be(l),Be(o))},ee.prototype.rmdir=function(s,l){l===void 0&&(l=Fe);var o=H(l,1);try{s=re(s),Q(this.root).rmdir(s,o)}catch(u){o(u)}},ee.prototype.rmdirSync=function(s){return s=re(s),Q(this.root).rmdirSync(s)},ee.prototype.mkdir=function(s,l,o){o===void 0&&(o=Fe),typeof l=="function"&&(o=l,l=511);var u=H(o,1);try{s=re(s),Q(this.root).mkdir(s,l,u)}catch(g){u(g)}},ee.prototype.mkdirSync=function(s,l){Q(this.root).mkdirSync(re(s),W(l,511))},ee.prototype.readdir=function(s,l){l===void 0&&(l=Fe);var o=H(l,2);try{s=re(s),Q(this.root).readdir(s,o)}catch(u){o(u)}},ee.prototype.readdirSync=function(s){return s=re(s),Q(this.root).readdirSync(s)},ee.prototype.link=function(s,l,o){o===void 0&&(o=Fe);var u=H(o,1);try{s=re(s),l=re(l),Q(this.root).link(s,l,u)}catch(g){u(g)}},ee.prototype.linkSync=function(s,l){return s=re(s),l=re(l),Q(this.root).linkSync(s,l)},ee.prototype.symlink=function(s,l,o,u){u===void 0&&(u=Fe);var g=typeof o=="string"?o:"file";u=typeof o=="function"?o:u;var m=H(u,1);try{if(g!=="file"&&g!=="dir")return m(new _(h.EINVAL,"Invalid type: "+g));s=re(s),l=re(l),Q(this.root).symlink(s,l,g,m)}catch(k){m(k)}},ee.prototype.symlinkSync=function(s,l,o){if(!o)o="file";else if(o!=="file"&&o!=="dir")throw new _(h.EINVAL,"Invalid type: "+o);return s=re(s),l=re(l),Q(this.root).symlinkSync(s,l,o)},ee.prototype.readlink=function(s,l){l===void 0&&(l=Fe);var o=H(l,2);try{s=re(s),Q(this.root).readlink(s,o)}catch(u){o(u)}},ee.prototype.readlinkSync=function(s){return s=re(s),Q(this.root).readlinkSync(s)},ee.prototype.chown=function(s,l,o,u){u===void 0&&(u=Fe);var g=H(u,1);try{s=re(s),Q(this.root).chown(s,!1,l,o,g)}catch(m){g(m)}},ee.prototype.chownSync=function(s,l,o){s=re(s),Q(this.root).chownSync(s,!1,l,o)},ee.prototype.lchown=function(s,l,o,u){u===void 0&&(u=Fe);var g=H(u,1);try{s=re(s),Q(this.root).chown(s,!0,l,o,g)}catch(m){g(m)}},ee.prototype.lchownSync=function(s,l,o){s=re(s),Q(this.root).chownSync(s,!0,l,o)},ee.prototype.chmod=function(s,l,o){o===void 0&&(o=Fe);var u=H(o,1);try{var g=W(l,-1);if(g<0)throw new _(h.EINVAL,"Invalid mode.");Q(this.root).chmod(re(s),!1,g,u)}catch(m){u(m)}},ee.prototype.chmodSync=function(s,l){var o=W(l,-1);if(o<0)throw new _(h.EINVAL,"Invalid mode.");s=re(s),Q(this.root).chmodSync(s,!1,o)},ee.prototype.lchmod=function(s,l,o){o===void 0&&(o=Fe);var u=H(o,1);try{var g=W(l,-1);if(g<0)throw new _(h.EINVAL,"Invalid mode.");Q(this.root).chmod(re(s),!0,g,u)}catch(m){u(m)}},ee.prototype.lchmodSync=function(s,l){var o=W(l,-1);if(o<1)throw new _(h.EINVAL,"Invalid mode.");Q(this.root).chmodSync(re(s),!0,o)},ee.prototype.utimes=function(s,l,o,u){u===void 0&&(u=Fe);var g=H(u,1);try{Q(this.root).utimes(re(s),Be(l),Be(o),g)}catch(m){g(m)}},ee.prototype.utimesSync=function(s,l,o){Q(this.root).utimesSync(re(s),Be(l),Be(o))},ee.prototype.realpath=function(s,l,o){o===void 0&&(o=Fe);var u=typeof l=="object"?l:{};o=typeof l=="function"?l:Fe;var g=H(o,2);try{s=re(s),Q(this.root).realpath(s,u,g)}catch(m){g(m)}},ee.prototype.realpathSync=function(s,l){return l===void 0&&(l={}),s=re(s),Q(this.root).realpathSync(s,l)},ee.prototype.watchFile=function(s,l,o){throw o===void 0&&(o=Fe),new _(h.ENOTSUP)},ee.prototype.unwatchFile=function(s,l){throw l===void 0&&(l=Fe),new _(h.ENOTSUP)},ee.prototype.watch=function(s,l,o){throw o===void 0&&(o=Fe),new _(h.ENOTSUP)},ee.prototype.access=function(s,l,o){throw o===void 0&&(o=Fe),new _(h.ENOTSUP)},ee.prototype.accessSync=function(s,l){throw new _(h.ENOTSUP)},ee.prototype.createReadStream=function(s,l){throw new _(h.ENOTSUP)},ee.prototype.createWriteStream=function(s,l){throw new _(h.ENOTSUP)},ee.prototype.wrapCallbacks=function(s){H=s},ee.prototype.getFdForFile=function(s){var l=this.nextFd++;return this.fdMap[l]=s,l},ee.prototype.fd2file=function(s){var l=this.fdMap[s];if(l)return l;throw new _(h.EBADF,"Invalid file descriptor.")},ee.prototype.closeFd=function(s){delete this.fdMap[s]},ee.Stats=U;var ye=new ee,fe={},Ce=ee.prototype;Object.keys(Ce).forEach(function(f){typeof ye[f]=="function"?fe[f]=function(){return ye[f].apply(ye,arguments)}:fe[f]=ye[f]}),fe.changeFSModule=function(f){ye=f},fe.getFSModule=function(){return ye},fe.FS=ee;function Re(f,s,l,o,u){return f<s||l<s?f>l?l+1:f+1:o===u?s:s+1}function ot(f,s){if(f===s)return 0;if(f.length>s.length){var l=f;f=s,s=l}for(var o=f.length,u=s.length;o>0&&f.charCodeAt(o-1)===s.charCodeAt(u-1);)o--,u--;for(var g=0;g<o&&f.charCodeAt(g)===s.charCodeAt(g);)g++;if(o-=g,u-=g,o===0||u===1)return u;for(var m=new Array(o<<1),k=0;k<o;)m[o+k]=f.charCodeAt(g+k),m[k]=++k;var N,F,z,G,ae;for(N=0;N+3<u;)for(var we=s.charCodeAt(g+(F=N)),ke=s.charCodeAt(g+(z=N+1)),$e=s.charCodeAt(g+(G=N+2)),Ke=s.charCodeAt(g+(ae=N+3)),at=N+=4,Pt=0;Pt<o;){var er=m[o+Pt],Br=m[Pt];F=Re(Br,F,z,we,er),z=Re(F,z,G,ke,er),G=Re(z,G,ae,$e,er),at=Re(G,ae,at,Ke,er),m[Pt++]=at,ae=G,G=z,z=F,F=Br}for(var Cr=0;N<u;){var qi=s.charCodeAt(g+(F=N));Cr=++N;for(var zr=0;zr<o;zr++){var $r=m[zr];m[zr]=Cr=$r<F||Cr<F?$r>Cr?Cr+1:$r+1:qi===m[o+zr]?F:F+1,F=$r}}return Cr}function Z(f,s,l){f&&console.warn("["+s+"] Direct file system constructor usage is deprecated for this file system, and will be removed in the next major version. Please use the '"+s+".Create("+JSON.stringify(l)+", callback)' method instead. See https://github.com/jvilk/BrowserFS/issues/176 for more details.")}var ze=typeof navigator<"u"&&!!(/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||navigator.userAgent.indexOf("Trident")!==-1),ht=typeof window>"u";function te(){throw new Error("BFS has reached an impossible code path; please file a bug.")}function K(f,s,l){l.existsSync(f)||(K(v.dirname(f),s,l),l.mkdirSync(f,s))}function ne(f){var s=Te(f),l=s.byteOffset,o=s.byteLength;return l===0&&o===s.buffer.byteLength?s.buffer:s.buffer.slice(l,l+o)}function Te(f){return f instanceof Uint8Array?f:new Uint8Array(f)}function He(f){return f instanceof a?f:f instanceof Uint8Array?qe(f):a.from(f)}function qe(f){return f instanceof a?f:f.byteOffset===0&&f.byteLength===f.buffer.byteLength?Me(f.buffer):a.from(f.buffer,f.byteOffset,f.byteLength)}function Me(f){return a.from(f)}function Ge(f,s,l){if(s===void 0&&(s=0),l===void 0&&(l=f.length),s<0||l<0||l>f.length||s>l)throw new TypeError("Invalid slice bounds on buffer of length "+f.length+": ["+s+", "+l+"]");if(f.length===0)return Y();var o=Te(f),u=f[0],g=(u+1)%255;return f[0]=g,o[0]===g?(o[0]=u,qe(o.slice(s,l))):(f[0]=u,qe(o.subarray(s,l)))}var gt=null;function Y(){return gt||(gt=a.alloc(0))}function Tt(f,s){a.isBuffer(f)?s():s(new _(h.EINVAL,"option must be a Buffer."))}function R(f,s,l){var o=f.Options,u=f.Name,g=0,m=!1,k=!1;function N(ae){m||(ae&&(m=!0,l(ae)),g--,g===0&&k&&l())}var F=function(ae){if(o.hasOwnProperty(ae)){var we=o[ae],ke=s[ae];if(ke==null){if(!we.optional){var $e=Object.keys(s).filter(function(at){return!(at in o)}).map(function(at){return{str:at,distance:ot(ae,at)}}).filter(function(at){return at.distance<5}).sort(function(at,Pt){return at.distance-Pt.distance});return m?{}:(m=!0,{v:l(new _(h.EINVAL,"["+u+"] Required option '"+ae+"' not provided."+($e.length>0?" You provided unrecognized option '"+$e[0].str+"'; perhaps you meant to type '"+ae+"'.":"")+`
Option description: `+we.description))})}}else{var Ke=!1;if(Array.isArray(we.type)?Ke=we.type.indexOf(typeof ke)!==-1:Ke=typeof ke===we.type,Ke)we.validator&&(g++,we.validator(ke,N));else return m?{}:(m=!0,{v:l(new _(h.EINVAL,"["+u+"] Value provided for option "+ae+" is not the proper type. Expected "+(Array.isArray(we.type)?"one of {"+we.type.join(", ")+"}":we.type)+", but received "+typeof ke+`
Option description: `+we.description))})}}};for(var z in o){var G=F(z);if(G)return G.v}k=!0,g===0&&!m&&l()}var M=Object.freeze({deprecationMessage:Z,isIE:ze,isWebWorker:ht,fail:te,mkdirpSync:K,buffer2ArrayBuffer:ne,buffer2Uint8array:Te,arrayish2Buffer:He,uint8Array2Buffer:qe,arrayBuffer2Buffer:Me,copyingSlice:Ge,emptyBuffer:Y,bufferValidator:Tt,checkOptions:R}),pe=function(s){this.fs=s,this.nodefs=s.getNodeFS(),this.FS=s.getFS(),this.PATH=s.getPATH(),this.ERRNO_CODES=s.getERRNO_CODES()};pe.prototype.open=function(s){var l=this.fs.realPath(s.node),o=this.FS;try{o.isFile(s.node.mode)&&(s.nfd=this.nodefs.openSync(l,this.fs.flagsToPermissionString(s.flags)))}catch(u){throw u.code?new o.ErrnoError(this.ERRNO_CODES[u.code]):u}},pe.prototype.close=function(s){var l=this.FS;try{l.isFile(s.node.mode)&&s.nfd&&this.nodefs.closeSync(s.nfd)}catch(o){throw o.code?new l.ErrnoError(this.ERRNO_CODES[o.code]):o}},pe.prototype.read=function(s,l,o,u,g){try{return this.nodefs.readSync(s.nfd,qe(l),o,u,g)}catch(m){throw new this.FS.ErrnoError(this.ERRNO_CODES[m.code])}},pe.prototype.write=function(s,l,o,u,g){try{return this.nodefs.writeSync(s.nfd,qe(l),o,u,g)}catch(m){throw new this.FS.ErrnoError(this.ERRNO_CODES[m.code])}},pe.prototype.llseek=function(s,l,o){var u=l;if(o===1)u+=s.position;else if(o===2&&this.FS.isFile(s.node.mode))try{var g=this.nodefs.fstatSync(s.nfd);u+=g.size}catch(m){throw new this.FS.ErrnoError(this.ERRNO_CODES[m.code])}if(u<0)throw new this.FS.ErrnoError(this.ERRNO_CODES.EINVAL);return s.position=u,u};var _e=function(s){this.fs=s,this.nodefs=s.getNodeFS(),this.FS=s.getFS(),this.PATH=s.getPATH(),this.ERRNO_CODES=s.getERRNO_CODES()};_e.prototype.getattr=function(s){var l=this.fs.realPath(s),o;try{o=this.nodefs.lstatSync(l)}catch(u){throw u.code?new this.FS.ErrnoError(this.ERRNO_CODES[u.code]):u}return{dev:o.dev,ino:o.ino,mode:o.mode,nlink:o.nlink,uid:o.uid,gid:o.gid,rdev:o.rdev,size:o.size,atime:o.atime,mtime:o.mtime,ctime:o.ctime,blksize:o.blksize,blocks:o.blocks}},_e.prototype.setattr=function(s,l){var o=this.fs.realPath(s);try{if(l.mode!==void 0&&(this.nodefs.chmodSync(o,l.mode),s.mode=l.mode),l.timestamp!==void 0){var u=new Date(l.timestamp);this.nodefs.utimesSync(o,u,u)}}catch(g){if(!g.code)throw g;if(g.code!=="ENOTSUP")throw new this.FS.ErrnoError(this.ERRNO_CODES[g.code])}if(l.size!==void 0)try{this.nodefs.truncateSync(o,l.size)}catch(g){throw g.code?new this.FS.ErrnoError(this.ERRNO_CODES[g.code]):g}},_e.prototype.lookup=function(s,l){var o=this.PATH.join2(this.fs.realPath(s),l),u=this.fs.getMode(o);return this.fs.createNode(s,l,u)},_e.prototype.mknod=function(s,l,o,u){var g=this.fs.createNode(s,l,o,u),m=this.fs.realPath(g);try{this.FS.isDir(g.mode)?this.nodefs.mkdirSync(m,g.mode):this.nodefs.writeFileSync(m,"",{mode:g.mode})}catch(k){throw k.code?new this.FS.ErrnoError(this.ERRNO_CODES[k.code]):k}return g},_e.prototype.rename=function(s,l,o){var u=this.fs.realPath(s),g=this.PATH.join2(this.fs.realPath(l),o);try{this.nodefs.renameSync(u,g),s.name=o,s.parent=l}catch(m){throw m.code?new this.FS.ErrnoError(this.ERRNO_CODES[m.code]):m}},_e.prototype.unlink=function(s,l){var o=this.PATH.join2(this.fs.realPath(s),l);try{this.nodefs.unlinkSync(o)}catch(u){throw u.code?new this.FS.ErrnoError(this.ERRNO_CODES[u.code]):u}},_e.prototype.rmdir=function(s,l){var o=this.PATH.join2(this.fs.realPath(s),l);try{this.nodefs.rmdirSync(o)}catch(u){throw u.code?new this.FS.ErrnoError(this.ERRNO_CODES[u.code]):u}},_e.prototype.readdir=function(s){var l=this.fs.realPath(s);try{var o=this.nodefs.readdirSync(l);return o.push(".",".."),o}catch(u){throw u.code?new this.FS.ErrnoError(this.ERRNO_CODES[u.code]):u}},_e.prototype.symlink=function(s,l,o){var u=this.PATH.join2(this.fs.realPath(s),l);try{this.nodefs.symlinkSync(o,u)}catch(g){throw g.code?new this.FS.ErrnoError(this.ERRNO_CODES[g.code]):g}},_e.prototype.readlink=function(s){var l=this.fs.realPath(s);try{return this.nodefs.readlinkSync(l)}catch(o){throw o.code?new this.FS.ErrnoError(this.ERRNO_CODES[o.code]):o}};var Ve=function(s,l,o,u){s===void 0&&(s=self.FS),l===void 0&&(l=self.PATH),o===void 0&&(o=self.ERRNO_CODES),u===void 0&&(u=fe),this.flagsToPermissionStringMap={0:"r",1:"r+",2:"r+",64:"r",65:"r+",66:"r+",129:"rx+",193:"rx+",514:"w+",577:"w",578:"w+",705:"wx",706:"wx+",1024:"a",1025:"a",1026:"a+",1089:"a",1090:"a+",1153:"ax",1154:"ax+",1217:"ax",1218:"ax+",4096:"rs",4098:"rs+"},this.nodefs=u,this.FS=s,this.PATH=l,this.ERRNO_CODES=o,this.node_ops=new _e(this),this.stream_ops=new pe(this)};Ve.prototype.mount=function(s){return this.createNode(null,"/",this.getMode(s.opts.root),0)},Ve.prototype.createNode=function(s,l,o,u){var g=this.FS;if(!g.isDir(o)&&!g.isFile(o)&&!g.isLink(o))throw new g.ErrnoError(this.ERRNO_CODES.EINVAL);var m=g.createNode(s,l,o);return m.node_ops=this.node_ops,m.stream_ops=this.stream_ops,m},Ve.prototype.getMode=function(s){var l;try{l=this.nodefs.lstatSync(s)}catch(o){throw o.code?new this.FS.ErrnoError(this.ERRNO_CODES[o.code]):o}return l.mode},Ve.prototype.realPath=function(s){for(var l=[];s.parent!==s;)l.push(s.name),s=s.parent;return l.push(s.mount.opts.root),l.reverse(),this.PATH.join.apply(null,l)},Ve.prototype.flagsToPermissionString=function(s){var l=typeof s=="string"?parseInt(s,10):s;return l&=8191,l in this.flagsToPermissionStringMap?this.flagsToPermissionStringMap[l]:s},Ve.prototype.getNodeFS=function(){return this.nodefs},Ve.prototype.getFS=function(){return this.FS},Ve.prototype.getPATH=function(){return this.PATH},Ve.prototype.getERRNO_CODES=function(){return this.ERRNO_CODES};var ve=function(){};ve.prototype.supportsLinks=function(){return!1},ve.prototype.diskSpace=function(s,l){l(0,0)},ve.prototype.openFile=function(s,l,o){throw new _(h.ENOTSUP)},ve.prototype.createFile=function(s,l,o,u){throw new _(h.ENOTSUP)},ve.prototype.open=function(s,l,o,u){var g=this,m=function(k,N){if(k)switch(l.pathNotExistsAction()){case C.CREATE_FILE:return g.stat(v.dirname(s),!1,function(F,z){F?u(F):z&&!z.isDirectory()?u(_.ENOTDIR(v.dirname(s))):g.createFile(s,l,o,u)});case C.THROW_EXCEPTION:return u(_.ENOENT(s));default:return u(new _(h.EINVAL,"Invalid FileFlag object."))}else{if(N&&N.isDirectory())return u(_.EISDIR(s));switch(l.pathExistsAction()){case C.THROW_EXCEPTION:return u(_.EEXIST(s));case C.TRUNCATE_FILE:return g.openFile(s,l,function(F,z){F?u(F):z?z.truncate(0,function(){z.sync(function(){u(null,z)})}):te()});case C.NOP:return g.openFile(s,l,u);default:return u(new _(h.EINVAL,"Invalid FileFlag object."))}}};this.stat(s,!1,m)},ve.prototype.rename=function(s,l,o){o(new _(h.ENOTSUP))},ve.prototype.renameSync=function(s,l){throw new _(h.ENOTSUP)},ve.prototype.stat=function(s,l,o){o(new _(h.ENOTSUP))},ve.prototype.statSync=function(s,l){throw new _(h.ENOTSUP)},ve.prototype.openFileSync=function(s,l,o){throw new _(h.ENOTSUP)},ve.prototype.createFileSync=function(s,l,o){throw new _(h.ENOTSUP)},ve.prototype.openSync=function(s,l,o){var u;try{u=this.statSync(s,!1)}catch{switch(l.pathNotExistsAction()){case C.CREATE_FILE:var g=this.statSync(v.dirname(s),!1);if(!g.isDirectory())throw _.ENOTDIR(v.dirname(s));return this.createFileSync(s,l,o);case C.THROW_EXCEPTION:throw _.ENOENT(s);default:throw new _(h.EINVAL,"Invalid FileFlag object.")}}if(u.isDirectory())throw _.EISDIR(s);switch(l.pathExistsAction()){case C.THROW_EXCEPTION:throw _.EEXIST(s);case C.TRUNCATE_FILE:return this.unlinkSync(s),this.createFileSync(s,l,u.mode);case C.NOP:return this.openFileSync(s,l,o);default:throw new _(h.EINVAL,"Invalid FileFlag object.")}},ve.prototype.unlink=function(s,l){l(new _(h.ENOTSUP))},ve.prototype.unlinkSync=function(s){throw new _(h.ENOTSUP)},ve.prototype.rmdir=function(s,l){l(new _(h.ENOTSUP))},ve.prototype.rmdirSync=function(s){throw new _(h.ENOTSUP)},ve.prototype.mkdir=function(s,l,o){o(new _(h.ENOTSUP))},ve.prototype.mkdirSync=function(s,l){throw new _(h.ENOTSUP)},ve.prototype.readdir=function(s,l){l(new _(h.ENOTSUP))},ve.prototype.readdirSync=function(s){throw new _(h.ENOTSUP)},ve.prototype.exists=function(s,l){this.stat(s,null,function(o){l(!o)})},ve.prototype.existsSync=function(s){try{return this.statSync(s,!0),!0}catch{return!1}},ve.prototype.realpath=function(s,l,o){if(this.supportsLinks())for(var u=s.split(v.sep),g=0;g<u.length;g++){var m=u.slice(0,g+1);u[g]=v.join.apply(null,m)}else this.exists(s,function(k){k?o(null,s):o(_.ENOENT(s))})},ve.prototype.realpathSync=function(s,l){if(this.supportsLinks()){for(var o=s.split(v.sep),u=0;u<o.length;u++){var g=o.slice(0,u+1);o[u]=v.join.apply(v,g)}return o.join(v.sep)}else{if(this.existsSync(s))return s;throw _.ENOENT(s)}},ve.prototype.truncate=function(s,l,o){this.open(s,I.getFileFlag("r+"),420,function(u,g){if(u)return o(u);g.truncate(l,function(m){g.close(function(k){o(m||k)})})})},ve.prototype.truncateSync=function(s,l){var o=this.openSync(s,I.getFileFlag("r+"),420);try{o.truncateSync(l)}catch(u){throw u}finally{o.closeSync()}},ve.prototype.readFile=function(s,l,o,u){var g=u;this.open(s,o,420,function(m,k){if(m)return u(m);u=function(N,F){k.close(function(z){return N||(N=z),g(N,F)})},k.stat(function(N,F){if(N)return u(N);var z=a.alloc(F.size);k.read(z,0,F.size,0,function(G){if(G)return u(G);if(l===null)return u(G,z);try{u(null,z.toString(l))}catch(ae){u(ae)}})})})},ve.prototype.readFileSync=function(s,l,o){var u=this.openSync(s,o,420);try{var g=u.statSync(),m=a.alloc(g.size);return u.readSync(m,0,g.size,0),u.closeSync(),l===null?m:m.toString(l)}finally{u.closeSync()}},ve.prototype.writeFile=function(s,l,o,u,g,m){var k=m;this.open(s,u,420,function(N,F){if(N)return m(N);m=function(z){F.close(function(G){k(z||G)})};try{typeof l=="string"&&(l=a.from(l,o))}catch(z){return m(z)}F.write(l,0,l.length,0,m)})},ve.prototype.writeFileSync=function(s,l,o,u,g){var m=this.openSync(s,u,g);try{typeof l=="string"&&(l=a.from(l,o)),m.writeSync(l,0,l.length,0)}finally{m.closeSync()}},ve.prototype.appendFile=function(s,l,o,u,g,m){var k=m;this.open(s,u,g,function(N,F){if(N)return m(N);m=function(z){F.close(function(G){k(z||G)})},typeof l=="string"&&(l=a.from(l,o)),F.write(l,0,l.length,null,m)})},ve.prototype.appendFileSync=function(s,l,o,u,g){var m=this.openSync(s,u,g);try{typeof l=="string"&&(l=a.from(l,o)),m.writeSync(l,0,l.length,null)}finally{m.closeSync()}},ve.prototype.chmod=function(s,l,o,u){u(new _(h.ENOTSUP))},ve.prototype.chmodSync=function(s,l,o){throw new _(h.ENOTSUP)},ve.prototype.chown=function(s,l,o,u,g){g(new _(h.ENOTSUP))},ve.prototype.chownSync=function(s,l,o,u){throw new _(h.ENOTSUP)},ve.prototype.utimes=function(s,l,o,u){u(new _(h.ENOTSUP))},ve.prototype.utimesSync=function(s,l,o){throw new _(h.ENOTSUP)},ve.prototype.link=function(s,l,o){o(new _(h.ENOTSUP))},ve.prototype.linkSync=function(s,l){throw new _(h.ENOTSUP)},ve.prototype.symlink=function(s,l,o,u){u(new _(h.ENOTSUP))},ve.prototype.symlinkSync=function(s,l,o){throw new _(h.ENOTSUP)},ve.prototype.readlink=function(s,l){l(new _(h.ENOTSUP))},ve.prototype.readlinkSync=function(s){throw new _(h.ENOTSUP)};var Ye=function(f){function s(){f.apply(this,arguments)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.supportsSynch=function(){return!0},s.prototype.rename=function(o,u,g){try{this.renameSync(o,u),g()}catch(m){g(m)}},s.prototype.stat=function(o,u,g){try{g(null,this.statSync(o,u))}catch(m){g(m)}},s.prototype.open=function(o,u,g,m){try{m(null,this.openSync(o,u,g))}catch(k){m(k)}},s.prototype.unlink=function(o,u){try{this.unlinkSync(o),u()}catch(g){u(g)}},s.prototype.rmdir=function(o,u){try{this.rmdirSync(o),u()}catch(g){u(g)}},s.prototype.mkdir=function(o,u,g){try{this.mkdirSync(o,u),g()}catch(m){g(m)}},s.prototype.readdir=function(o,u){try{u(null,this.readdirSync(o))}catch(g){u(g)}},s.prototype.chmod=function(o,u,g,m){try{this.chmodSync(o,u,g),m()}catch(k){m(k)}},s.prototype.chown=function(o,u,g,m,k){try{this.chownSync(o,u,g,m),k()}catch(N){k(N)}},s.prototype.utimes=function(o,u,g,m){try{this.utimesSync(o,u,g),m()}catch(k){m(k)}},s.prototype.link=function(o,u,g){try{this.linkSync(o,u),g()}catch(m){g(m)}},s.prototype.symlink=function(o,u,g,m){try{this.symlinkSync(o,u,g),m()}catch(k){m(k)}},s.prototype.readlink=function(o,u){try{u(null,this.readlinkSync(o))}catch(g){u(g)}},s}(ve),We=function(){};We.prototype.sync=function(s){s(new _(h.ENOTSUP))},We.prototype.syncSync=function(){throw new _(h.ENOTSUP)},We.prototype.datasync=function(s){this.sync(s)},We.prototype.datasyncSync=function(){return this.syncSync()},We.prototype.chown=function(s,l,o){o(new _(h.ENOTSUP))},We.prototype.chownSync=function(s,l){throw new _(h.ENOTSUP)},We.prototype.chmod=function(s,l){l(new _(h.ENOTSUP))},We.prototype.chmodSync=function(s){throw new _(h.ENOTSUP)},We.prototype.utimes=function(s,l,o){o(new _(h.ENOTSUP))},We.prototype.utimesSync=function(s,l){throw new _(h.ENOTSUP)};var xt=function(f){function s(l,o,u,g,m){if(f.call(this),this._pos=0,this._dirty=!1,this._fs=l,this._path=o,this._flag=u,this._stat=g,m?this._buffer=m:this._buffer=Y(),this._stat.size!==this._buffer.length&&this._flag.isReadable())throw new Error("Invalid buffer: Buffer is "+this._buffer.length+" long, yet Stats object specifies that file is "+this._stat.size+" long.")}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.getBuffer=function(){return this._buffer},s.prototype.getStats=function(){return this._stat},s.prototype.getFlag=function(){return this._flag},s.prototype.getPath=function(){return this._path},s.prototype.getPos=function(){return this._flag.isAppendable()?this._stat.size:this._pos},s.prototype.advancePos=function(o){return this._pos+=o},s.prototype.setPos=function(o){return this._pos=o},s.prototype.sync=function(o){try{this.syncSync(),o()}catch(u){o(u)}},s.prototype.syncSync=function(){throw new _(h.ENOTSUP)},s.prototype.close=function(o){try{this.closeSync(),o()}catch(u){o(u)}},s.prototype.closeSync=function(){throw new _(h.ENOTSUP)},s.prototype.stat=function(o){try{o(null,this._stat.clone())}catch(u){o(u)}},s.prototype.statSync=function(){return this._stat.clone()},s.prototype.truncate=function(o,u){try{this.truncateSync(o),this._flag.isSynchronous()&&!fe.getRootFS().supportsSynch()&&this.sync(u),u()}catch(g){return u(g)}},s.prototype.truncateSync=function(o){if(this._dirty=!0,!this._flag.isWriteable())throw new _(h.EPERM,"File not opened with a writeable mode.");if(this._stat.mtime=new Date,o>this._buffer.length){var u=a.alloc(o-this._buffer.length,0);this.writeSync(u,0,u.length,this._buffer.length),this._flag.isSynchronous()&&fe.getRootFS().supportsSynch()&&this.syncSync();return}this._stat.size=o;var g=a.alloc(o);this._buffer.copy(g,0,0,o),this._buffer=g,this._flag.isSynchronous()&&fe.getRootFS().supportsSynch()&&this.syncSync()},s.prototype.write=function(o,u,g,m,k){try{k(null,this.writeSync(o,u,g,m),o)}catch(N){k(N)}},s.prototype.writeSync=function(o,u,g,m){if(this._dirty=!0,m==null&&(m=this.getPos()),!this._flag.isWriteable())throw new _(h.EPERM,"File not opened with a writeable mode.");var k=m+g;if(k>this._stat.size&&(this._stat.size=k,k>this._buffer.length)){var N=a.alloc(k);this._buffer.copy(N),this._buffer=N}var F=o.copy(this._buffer,m,u,u+g);return this._stat.mtime=new Date,this._flag.isSynchronous()?(this.syncSync(),F):(this.setPos(m+F),F)},s.prototype.read=function(o,u,g,m,k){try{k(null,this.readSync(o,u,g,m),o)}catch(N){k(N)}},s.prototype.readSync=function(o,u,g,m){if(!this._flag.isReadable())throw new _(h.EPERM,"File not opened with a readable mode.");m==null&&(m=this.getPos());var k=m+g;k>this._stat.size&&(g=this._stat.size-m);var N=this._buffer.copy(o,u,m,m+g);return this._stat.atime=new Date,this._pos=m+g,N},s.prototype.chmod=function(o,u){try{this.chmodSync(o),u()}catch(g){u(g)}},s.prototype.chmodSync=function(o){if(!this._fs.supportsProps())throw new _(h.ENOTSUP);this._dirty=!0,this._stat.chmod(o),this.syncSync()},s.prototype.isDirty=function(){return this._dirty},s.prototype.resetDirty=function(){this._dirty=!1},s}(We),Et=function(f){function s(l,o,u,g,m){f.call(this,l,o,u,g,m)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.sync=function(o){o()},s.prototype.syncSync=function(){},s.prototype.close=function(o){o()},s.prototype.closeSync=function(){},s}(xt),rt=function(f){function s(l,o,u,g,m){f.call(this,l,o,u,g,m)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},s.prototype.closeSync=function(){this.syncSync()},s}(xt),L=function(f){function s(l,o,u){if(u===void 0&&(u=!0),f.call(this),this._queue=[],this._queueRunning=!1,this._isInitialized=!1,this._initializeCallbacks=[],this._sync=l,this._async=o,!l.supportsSynch())throw new Error("The first argument to AsyncMirror needs to be a synchronous file system.");Z(u,s.Name,{sync:"sync file system instance",async:"async file system instance"})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){try{var g=new s(o.sync,o.async,!1);g.initialize(function(m){m?u(m):u(null,g)},!1)}catch(m){u(m)}},s.isAvailable=function(){return!0},s.prototype.getName=function(){return s.Name},s.prototype._syncSync=function(o){this._sync.writeFileSync(o.getPath(),o.getBuffer(),null,I.getFileFlag("w"),o.getStats().mode),this.enqueueOp({apiMethod:"writeFile",arguments:[o.getPath(),o.getBuffer(),null,o.getFlag(),o.getStats().mode]})},s.prototype.initialize=function(o,u){var g=this;u===void 0&&(u=!0),u&&console.warn("[AsyncMirror] AsyncMirror.initialize() is deprecated and will be removed in the next major version. Please use 'AsyncMirror.Create({ sync: (sync file system instance), async: (async file system instance)}, cb)' to create and initialize AsyncMirror instances.");var m=this._initializeCallbacks,k=function(G){g._isInitialized=!G,g._initializeCallbacks=[],m.forEach(function(ae){return ae(G)})};if(this._isInitialized)o();else if(m.push(o)===1){var N=function(G,ae,we){G!=="/"&&g._sync.mkdirSync(G,ae),g._async.readdir(G,function(ke,$e){var Ke=0;function at(Pt){Pt?we(Pt):Ke<$e.length?(z(v.join(G,$e[Ke]),at),Ke++):we()}ke?we(ke):at()})},F=function(G,ae,we){g._async.readFile(G,null,I.getFileFlag("r"),function(ke,$e){if(ke)we(ke);else try{g._sync.writeFileSync(G,$e,null,I.getFileFlag("w"),ae)}catch(Ke){ke=Ke}finally{we(ke)}})},z=function(G,ae){g._async.stat(G,!1,function(we,ke){we?ae(we):ke.isDirectory()?N(G,ke.mode,ae):F(G,ke.mode,ae)})};N("/",0,k)}},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsSynch=function(){return!0},s.prototype.supportsLinks=function(){return!1},s.prototype.supportsProps=function(){return this._sync.supportsProps()&&this._async.supportsProps()},s.prototype.renameSync=function(o,u){this.checkInitialized(),this._sync.renameSync(o,u),this.enqueueOp({apiMethod:"rename",arguments:[o,u]})},s.prototype.statSync=function(o,u){return this.checkInitialized(),this._sync.statSync(o,u)},s.prototype.openSync=function(o,u,g){this.checkInitialized();var m=this._sync.openSync(o,u,g);return m.closeSync(),new rt(this,o,u,this._sync.statSync(o,!1),this._sync.readFileSync(o,null,I.getFileFlag("r")))},s.prototype.unlinkSync=function(o){this.checkInitialized(),this._sync.unlinkSync(o),this.enqueueOp({apiMethod:"unlink",arguments:[o]})},s.prototype.rmdirSync=function(o){this.checkInitialized(),this._sync.rmdirSync(o),this.enqueueOp({apiMethod:"rmdir",arguments:[o]})},s.prototype.mkdirSync=function(o,u){this.checkInitialized(),this._sync.mkdirSync(o,u),this.enqueueOp({apiMethod:"mkdir",arguments:[o,u]})},s.prototype.readdirSync=function(o){return this.checkInitialized(),this._sync.readdirSync(o)},s.prototype.existsSync=function(o){return this.checkInitialized(),this._sync.existsSync(o)},s.prototype.chmodSync=function(o,u,g){this.checkInitialized(),this._sync.chmodSync(o,u,g),this.enqueueOp({apiMethod:"chmod",arguments:[o,u,g]})},s.prototype.chownSync=function(o,u,g,m){this.checkInitialized(),this._sync.chownSync(o,u,g,m),this.enqueueOp({apiMethod:"chown",arguments:[o,u,g,m]})},s.prototype.utimesSync=function(o,u,g){this.checkInitialized(),this._sync.utimesSync(o,u,g),this.enqueueOp({apiMethod:"utimes",arguments:[o,u,g]})},s.prototype.checkInitialized=function(){if(!this._isInitialized)throw new _(h.EPERM,"AsyncMirrorFS is not initialized. Please initialize AsyncMirrorFS using its initialize() method before using it.")},s.prototype.enqueueOp=function(o){var u=this;if(this._queue.push(o),!this._queueRunning){this._queueRunning=!0;var g=function(m){if(m&&console.error("WARNING: File system has desynchronized. Received following error: "+m+`
$`),u._queue.length>0){var k=u._queue.shift(),N=k.arguments;N.push(g),u._async[k.apiMethod].apply(u._async,N)}else u._queueRunning=!1};g()}},s}(Ye);L.Name="AsyncMirror",L.Options={sync:{type:"object",description:"The synchronous file system to mirror the asynchronous file system to."},async:{type:"object",description:"The asynchronous file system to mirror."}};function O(f,s,l){switch(l.length){case 0:return f.call(s);case 1:return f.call(s,l[0]);case 2:return f.call(s,l[0],l[1]);case 3:return f.call(s,l[0],l[1],l[2])}return f.apply(s,l)}var A=Math.max;function D(f,s,l){return s=A(s===void 0?f.length-1:s,0),function(){for(var o=arguments,u=-1,g=A(o.length-s,0),m=Array(g);++u<g;)m[u]=o[s+u];u=-1;for(var k=Array(s+1);++u<s;)k[u]=o[u];return k[s]=l(m),O(f,this,k)}}function X(f){return f}function se(f,s){return D(f,s,X)}var ge=function(f){return se(function(s){var l=s.pop();f.call(this,s,l)})};function nt(f){return se(function(s,l){var o=ge(function(u,g){var m=this;return f(s,function(k,N){k.apply(m,u.concat(N))},g)});return l.length?o.apply(this,l):o})}var ct=typeof p=="object"&&p&&p.Object===Object&&p,mt=typeof self=="object"&&self&&self.Object===Object&&self,Bt=ct||mt||Function("return this")(),yt=Bt.Symbol,ar=Object.prototype,Wr=ar.hasOwnProperty,jr=ar.toString,$=yt?yt.toStringTag:void 0;function Qi(f){var s=Wr.call(f,$),l=f[$];try{f[$]=void 0;var o=!0}catch{}var u=jr.call(f);return o&&(s?f[$]=l:delete f[$]),u}var en=Object.prototype,tn=en.toString;function ie(f){return tn.call(f)}var Ae="[object Null]",j="[object Undefined]",Le=yt?yt.toStringTag:void 0;function _t(f){return f==null?f===void 0?j:Ae:Le&&Le in Object(f)?Qi(f):ie(f)}function Ne(f){var s=typeof f;return f!=null&&(s=="object"||s=="function")}var Xt="[object AsyncFunction]",je="[object Function]",Rt="[object GeneratorFunction]",ue="[object Proxy]";function de(f){if(!Ne(f))return!1;var s=_t(f);return s==je||s==Rt||s==Xt||s==ue}var Gr=9007199254740991;function Ot(f){return typeof f=="number"&&f>-1&&f%1==0&&f<=Gr}function Ue(f){return f!=null&&Ot(f.length)&&!de(f)}var Lr={};function kr(){}function vt(f){return function(){if(f!==null){var s=f;f=null,s.apply(this,arguments)}}}var Qe=typeof Symbol=="function"&&Symbol.iterator,Ft=function(f){return Qe&&f[Qe]&&f[Qe]()};function Mt(f,s){for(var l=-1,o=Array(f);++l<f;)o[l]=s(l);return o}function Ct(f){return f!=null&&typeof f=="object"}var yr="[object Arguments]";function Dr(f){return Ct(f)&&_t(f)==yr}var wt=Object.prototype,jt=wt.hasOwnProperty,it=wt.propertyIsEnumerable,tr=Dr(function(){return arguments}())?Dr:function(f){return Ct(f)&&jt.call(f,"callee")&&!it.call(f,"callee")},sr=Array.isArray;function Ei(){return!1}var lr=typeof i=="object"&&i&&!i.nodeType&&i,Pr=lr&&typeof d=="object"&&d&&!d.nodeType&&d,Zs=Pr&&Pr.exports===lr,cr=Zs?Bt.Buffer:void 0,Qs=cr?cr.isBuffer:void 0,eo=Qs||Ei,to=9007199254740991,ro=/^(?:0|[1-9]\d*)$/;function io(f,s){return s=s??to,!!s&&(typeof f=="number"||ro.test(f))&&f>-1&&f%1==0&&f<s}var no="[object Arguments]",so="[object Array]",oo="[object Boolean]",ao="[object Date]",Vn="[object Error]",lo="[object Function]",co="[object Map]",Jn="[object Number]",fo="[object Object]",Oi="[object RegExp]",Ai="[object Set]",Ni="[object String]",Hn="[object WeakMap]",rn="[object ArrayBuffer]",Yr="[object DataView]",uo="[object Float32Array]",Ti="[object Float64Array]",nn="[object Int8Array]",sn="[object Int16Array]",ci="[object Int32Array]",on="[object Uint8Array]",an="[object Uint8ClampedArray]",ln="[object Uint16Array]",cn="[object Uint32Array]",At={};At[uo]=At[Ti]=At[nn]=At[sn]=At[ci]=At[on]=At[an]=At[ln]=At[cn]=!0,At[no]=At[so]=At[rn]=At[oo]=At[Yr]=At[ao]=At[Vn]=At[lo]=At[co]=At[Jn]=At[fo]=At[Oi]=At[Ai]=At[Ni]=At[Hn]=!1;function fn(f){return Ct(f)&&Ot(f.length)&&!!At[_t(f)]}function un(f){return function(s){return f(s)}}var Ii=typeof i=="object"&&i&&!i.nodeType&&i,Fi=Ii&&typeof d=="object"&&d&&!d.nodeType&&d,dn=Fi&&Fi.exports===Ii,fi=dn&&ct.process,Bi=function(){try{return fi&&fi.binding&&fi.binding("util")}catch{}}(),Ci=Bi&&Bi.isTypedArray,pn=Ci?un(Ci):fn,hn=Object.prototype,gn=hn.hasOwnProperty;function yn(f,s){var l=sr(f),o=!l&&tr(f),u=!l&&!o&&eo(f),g=!l&&!o&&!u&&pn(f),m=l||o||u||g,k=m?Mt(f.length,String):[],N=k.length;for(var F in f)(s||gn.call(f,F))&&!(m&&(F=="length"||u&&(F=="offset"||F=="parent")||g&&(F=="buffer"||F=="byteLength"||F=="byteOffset")||io(F,N)))&&k.push(F);return k}var ui=Object.prototype;function po(f){var s=f&&f.constructor,l=typeof s=="function"&&s.prototype||ui;return f===l}function ho(f,s){return function(l){return f(s(l))}}var Wn=ho(Object.keys,Object),go=Object.prototype,Gn=go.hasOwnProperty;function xr(f){if(!po(f))return Wn(f);var s=[];for(var l in Object(f))Gn.call(f,l)&&l!="constructor"&&s.push(l);return s}function Yn(f){return Ue(f)?yn(f):xr(f)}function yo(f){var s=-1,l=f.length;return function(){return++s<l?{value:f[s],key:s}:null}}function Xn(f){var s=-1;return function(){var o=f.next();return o.done?null:(s++,{value:o.value,key:s})}}function Kn(f){var s=Yn(f),l=-1,o=s.length;return function(){var g=s[++l];return l<o?{value:f[g],key:g}:null}}function bo(f){if(Ue(f))return yo(f);var s=Ft(f);return s?Xn(s):Kn(f)}function Zn(f){return function(){if(f===null)throw new Error("Callback was already called.");var s=f;f=null,s.apply(this,arguments)}}function Nr(f){return function(s,l,o){if(o=vt(o||kr),f<=0||!s)return o(null);var u=bo(s),g=!1,m=0;function k(F,z){if(m-=1,F)g=!0,o(F);else{if(z===Lr||g&&m<=0)return g=!0,o(null);N()}}function N(){for(;m<f&&!g;){var F=u();if(F===null){g=!0,m<=0&&o(null);return}m+=1,l(F.value,F.key,Zn(k))}}N()}}function bn(f,s,l,o){Nr(s)(f,l,o)}function vr(f,s){return function(l,o,u){return f(l,s,o,u)}}function Qn(f,s,l){l=vt(l||kr);var o=0,u=0,g=f.length;g===0&&l(null);function m(k,N){k?l(k):(++u===g||N===Lr)&&l(null)}for(;o<g;o++)s(f[o],o,Zn(m))}var es=vr(bn,1/0),mn=function(f,s,l){var o=Ue(f)?Qn:es;o(f,s,l)};function ts(f){return function(s,l,o){return f(mn,s,l,o)}}function _n(f,s,l,o){o=o||kr,s=s||[];var u=[],g=0;f(s,function(m,k,N){var F=g++;l(m,function(z,G){u[F]=G,N(z)})},function(m){o(m,u)})}var rs=ts(_n);nt(rs);function mo(f){return function(s,l,o,u){return f(Nr(l),s,o,u)}}var c=mo(_n),S=vr(c,1);nt(S),se(function(f,s){return se(function(l){return f.apply(null,s.concat(l))})});function B(f,s){for(var l=-1,o=f==null?0:f.length;++l<o&&s(f[l],l,f)!==!1;);return f}function E(f){return function(s,l,o){for(var u=-1,g=Object(s),m=o(s),k=m.length;k--;){var N=m[f?k:++u];if(l(g[N],N,g)===!1)break}return s}}var J=E();function oe(f,s){return f&&J(f,s,Yn)}function le(f,s,l,o){for(var u=f.length,g=l+(o?1:-1);o?g--:++g<u;)if(s(f[g],g,f))return g;return-1}function Oe(f){return f!==f}function V(f,s,l){for(var o=l-1,u=f.length;++o<u;)if(f[o]===s)return o;return-1}function xe(f,s,l){return s===s?V(f,s,l):le(f,Oe,l)}var he="\\ud800-\\udfff",ce="\\u0300-\\u036f",be="\\ufe20-\\ufe2f",Pe="\\u20d0-\\u20ff",Se=ce+be+Pe,Jt="\\ufe0e\\ufe0f",Kt="["+he+"]",St="["+Se+"]",zt="\\ud83c[\\udffb-\\udfff]",De="(?:"+St+"|"+zt+")",Ht="[^"+he+"]",Xr="(?:\\ud83c[\\udde6-\\uddff]){2}",di="[\\ud800-\\udbff][\\udc00-\\udfff]",Ze="\\u200d",Ee=De+"?",Nt="["+Jt+"]?",ft="(?:"+Ze+"(?:"+[Ht,Xr,di].join("|")+")"+Nt+Ee+")*",st=Nt+Ee+ft,Ie="(?:"+[Ht+St+"?",St,Xr,di,Kt].join("|")+")",Xe=typeof setImmediate=="function"&&setImmediate,kt=typeof y=="object"&&typeof y.nextTick=="function";function Zt(f){setTimeout(f,0)}function ji(f){return se(function(s,l){f(function(){s.apply(null,l)})})}var Li;Xe?Li=setImmediate:kt?Li=y.nextTick:Li=Zt,ji(Li);var Tf=vr(bn,1);function If(f,s,l,o){o=vt(o||kr),Tf(f,function(u,g,m){l(s,u,function(k,N){s=N,m(k)})},function(u){o(u,s)})}var Ff=se(function(s){return se(function(l){var o=this,u=l[l.length-1];typeof u=="function"?l.pop():u=kr,If(s,l,function(g,m,k){m.apply(o,g.concat(se(function(N,F){k(N,F)})))},function(g,m){u.apply(o,[g].concat(m))})})});se(function(f){return Ff.apply(null,f.reverse())}),se(function(f){var s=[null].concat(f);return ge(function(l,o){return o.apply(this,s)})});function Ma(f){return se(function(s,l){s.apply(null,l.concat(se(function(o,u){typeof console=="object"&&(o?console.error&&console.error(o):console[f]&&B(u,function(g){console[f](g)}))})))})}Ma("dir");function Bf(f){return function(s,l,o){return f(s,o)}}function Ua(f,s,l){mn(f,Bf(s),l)}Ma("log");var is;kt?is=y.nextTick:Xe?is=setImmediate:is=Zt,ji(is);var Eh=Math.ceil,Oh=Math.max,fr;function Cf(){fr||(fr={},fr[Dropbox.ApiError.NETWORK_ERROR]=h.EIO,fr[Dropbox.ApiError.INVALID_PARAM]=h.EINVAL,fr[Dropbox.ApiError.INVALID_TOKEN]=h.EPERM,fr[Dropbox.ApiError.OAUTH_ERROR]=h.EPERM,fr[Dropbox.ApiError.NOT_FOUND]=h.ENOENT,fr[Dropbox.ApiError.INVALID_METHOD]=h.EINVAL,fr[Dropbox.ApiError.NOT_ACCEPTABLE]=h.EINVAL,fr[Dropbox.ApiError.CONFLICT]=h.EINVAL,fr[Dropbox.ApiError.RATE_LIMITED]=h.EBUSY,fr[Dropbox.ApiError.SERVER_ERROR]=h.EBUSY,fr[Dropbox.ApiError.OVER_QUOTA]=h.ENOSPC)}function jf(f){return f&&f.stat.isFile}function Lf(f){return f&&f.stat.isFolder}function Df(f){return f==null||typeof f=="object"&&typeof f.byteLength=="number"}var Qt=function(s){this._cache={},this._client=s};Qt.prototype.readdir=function(s,l){var o=this,u=this.getCachedDirInfo(s);this._wrap(function(g){u!==null&&u.contents?o._client.readdir(s,{contentHash:u.stat.contentHash},g):o._client.readdir(s,g)},function(g,m,k,N){g?g.status===Dropbox.ApiError.NO_CONTENT&&u!==null?l(null,u.contents.slice(0)):l(g):(o.updateCachedDirInfo(s,k,m.slice(0)),N.forEach(function(F){o.updateCachedInfo(v.join(s,F.name),F)}),l(null,m))})},Qt.prototype.remove=function(s,l){var o=this;this._wrap(function(u){o._client.remove(s,u)},function(u,g){u||o.updateCachedInfo(s,g),l(u)})},Qt.prototype.move=function(s,l,o){var u=this;this._wrap(function(g){u._client.move(s,l,g)},function(g,m){g||(u.deleteCachedInfo(s),u.updateCachedInfo(l,m)),o(g)})},Qt.prototype.stat=function(s,l){var o=this;this._wrap(function(u){o._client.stat(s,u)},function(u,g){u||o.updateCachedInfo(s,g),l(u,g)})},Qt.prototype.readFile=function(s,l){var o=this,u=this.getCachedFileInfo(s);u!==null&&u.contents!==null?this.stat(s,function(g,m){g?l(g):m.contentHash===u.stat.contentHash?l(g,u.contents.slice(0),u.stat):o.readFile(s,l)}):this._wrap(function(g){o._client.readFile(s,{arrayBuffer:!0},g)},function(g,m,k){g||o.updateCachedInfo(s,k,m.slice(0)),l(g,m,k)})},Qt.prototype.writeFile=function(s,l,o){var u=this;this._wrap(function(g){u._client.writeFile(s,l,g)},function(g,m){g||u.updateCachedInfo(s,m,l.slice(0)),o(g,m)})},Qt.prototype.mkdir=function(s,l){var o=this;this._wrap(function(u){o._client.mkdir(s,u)},function(u,g){u||o.updateCachedInfo(s,g,[]),l(u)})},Qt.prototype._wrap=function(s,l){var o=0,u=function(g){var m=2;if(g&&3>++o)switch(g.status){case Dropbox.ApiError.SERVER_ERROR:case Dropbox.ApiError.NETWORK_ERROR:case Dropbox.ApiError.RATE_LIMITED:setTimeout(function(){s(u)},m*1e3);break;default:l.apply(null,arguments);break}else l.apply(null,arguments)};s(u)},Qt.prototype.getCachedInfo=function(s){return this._cache[s.toLowerCase()]},Qt.prototype.putCachedInfo=function(s,l){this._cache[s.toLowerCase()]=l},Qt.prototype.deleteCachedInfo=function(s){delete this._cache[s.toLowerCase()]},Qt.prototype.getCachedDirInfo=function(s){var l=this.getCachedInfo(s);return Lf(l)?l:null},Qt.prototype.getCachedFileInfo=function(s){var l=this.getCachedInfo(s);return jf(l)?l:null},Qt.prototype.updateCachedDirInfo=function(s,l,o){o===void 0&&(o=null);var u=this.getCachedInfo(s);l.contentHash!==null&&(u===void 0||u.stat.contentHash!==l.contentHash)&&this.putCachedInfo(s,{stat:l,contents:o})},Qt.prototype.updateCachedFileInfo=function(s,l,o){o===void 0&&(o=null);var u=this.getCachedInfo(s);l.versionTag!==null&&(u===void 0||u.stat.versionTag!==l.versionTag)&&this.putCachedInfo(s,{stat:l,contents:o})},Qt.prototype.updateCachedInfo=function(s,l,o){o===void 0&&(o=null),l.isFile&&Df(o)?this.updateCachedFileInfo(s,l,o):l.isFolder&&Array.isArray(o)&&this.updateCachedDirInfo(s,l,o)};var Pf=function(f){function s(l,o,u,g,m){f.call(this,l,o,u,g,m)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.sync=function(o){var u=this;if(this.isDirty()){var g=this.getBuffer(),m=ne(g);this._fs._writeFileStrict(this.getPath(),m,function(k){k||u.resetDirty(),o(k)})}else o()},s.prototype.close=function(o){this.sync(o)},s}(xt),ns=function(f){function s(l,o){o===void 0&&(o=!0),f.call(this),this._client=new Qt(l),Z(o,s.Name,{client:"authenticated dropbox client instance"}),Cf()}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){u(null,new s(o.client,!1))},s.isAvailable=function(){return typeof Dropbox<"u"},s.prototype.getName=function(){return s.Name},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsSymlinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!1},s.prototype.empty=function(o){var u=this;this._client.readdir("/",function(g,m){if(g)o(u.convert(g,"/"));else{var k=function(F,z){var G=v.join("/",F);u._client.remove(G,function(ae){z(ae?u.convert(ae,G):null)})},N=function(F){F?o(F):o()};Ua(m,k,N)}})},s.prototype.rename=function(o,u,g){var m=this;this._client.move(o,u,function(k){k?m._client.stat(u,function(N,F){if(N||F.isFolder){var z=k.response.error.indexOf(o)>-1?o:u;g(m.convert(k,z))}else m._client.remove(u,function(G){G?g(m.convert(G,u)):m.rename(o,u,g)})}):g()})},s.prototype.stat=function(o,u,g){var m=this;this._client.stat(o,function(k,N){if(k)g(m.convert(k,o));else if(N&&N.isRemoved)g(_.FileError(h.ENOENT,o));else{var F=new U(m._statType(N),N.size);return g(null,F)}})},s.prototype.open=function(o,u,g,m){var k=this;this._client.readFile(o,function(N,F,z){if(N)if(u.isReadable())m(k.convert(N,o));else switch(N.status){case Dropbox.ApiError.NOT_FOUND:var G=new ArrayBuffer(0);return k._writeFileStrict(o,G,function(ke,$e){if(ke)m(ke);else{var Ke=k._makeFile(o,u,$e,Me(G));m(null,Ke)}});default:return m(k.convert(N,o))}else{var ae;F===null?ae=Y():ae=Me(F);var we=k._makeFile(o,u,z,ae);return m(null,we)}})},s.prototype._writeFileStrict=function(o,u,g){var m=this,k=v.dirname(o);this.stat(k,!1,function(N,F){N?g(_.FileError(h.ENOENT,k)):m._client.writeFile(o,u,function(z,G){z?g(m.convert(z,o)):g(null,G)})})},s.prototype._statType=function(o){return o.isFile?P.FILE:P.DIRECTORY},s.prototype._makeFile=function(o,u,g,m){var k=this._statType(g),N=new U(k,g.size);return new Pf(this,o,u,N,m)},s.prototype._remove=function(o,u,g){var m=this;this._client.stat(o,function(k,N){k?u(m.convert(k,o)):N.isFile&&!g?u(_.FileError(h.ENOTDIR,o)):!N.isFile&&g?u(_.FileError(h.EISDIR,o)):m._client.remove(o,function(F){u(F?m.convert(F,o):null)})})},s.prototype.unlink=function(o,u){this._remove(o,u,!0)},s.prototype.rmdir=function(o,u){this._remove(o,u,!1)},s.prototype.mkdir=function(o,u,g){var m=this,k=v.dirname(o);this._client.stat(k,function(N,F){N?g(m.convert(N,k)):m._client.mkdir(o,function(z){g(z?_.FileError(h.EEXIST,o):null)})})},s.prototype.readdir=function(o,u){var g=this;this._client.readdir(o,function(m,k){return m?u(g.convert(m)):u(null,k)})},s.prototype.convert=function(o,u){u===void 0&&(u=null);var g=fr[o.status];return g===void 0&&(g=h.EIO),u?_.FileError(g,u):new _(g)},s}(ve);ns.Name="Dropbox",ns.Options={client:{type:"object",description:"An *authenticated* Dropbox client. Must be from the 0.10 JS SDK.",validator:function(f,s){f.isAuthenticated&&f.isAuthenticated()?s():s(new _(h.EINVAL,"'client' option must be an authenticated Dropbox client from the v0.10 JS SDK."))}}};function Ut(f,s){s===void 0&&(s="");for(var l=f.errno,o=f.node,u=[];o&&(u.unshift(o.name),o!==o.parent);)o=o.parent;return new _(l,w[l],u.length>0?"/"+u.join("/"):s)}var Rf=function(f){function s(l,o,u,g){f.call(this),this._fs=l,this._FS=o,this._path=u,this._stream=g}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.getPos=function(){},s.prototype.close=function(o){var u=null;try{this.closeSync()}catch(g){u=g}finally{o(u)}},s.prototype.closeSync=function(){try{this._FS.close(this._stream)}catch(o){throw Ut(o,this._path)}},s.prototype.stat=function(o){try{o(null,this.statSync())}catch(u){o(u)}},s.prototype.statSync=function(){try{return this._fs.statSync(this._path,!1)}catch(o){throw Ut(o,this._path)}},s.prototype.truncate=function(o,u){var g=null;try{this.truncateSync(o)}catch(m){g=m}finally{u(g)}},s.prototype.truncateSync=function(o){try{this._FS.ftruncate(this._stream.fd,o)}catch(u){throw Ut(u,this._path)}},s.prototype.write=function(o,u,g,m,k){try{k(null,this.writeSync(o,u,g,m),o)}catch(N){k(N)}},s.prototype.writeSync=function(o,u,g,m){try{var k=Te(o),N=m===null?void 0:m;return this._FS.write(this._stream,k,u,g,N)}catch(F){throw Ut(F,this._path)}},s.prototype.read=function(o,u,g,m,k){try{k(null,this.readSync(o,u,g,m),o)}catch(N){k(N)}},s.prototype.readSync=function(o,u,g,m){try{var k=Te(o),N=m===null?void 0:m;return this._FS.read(this._stream,k,u,g,N)}catch(F){throw Ut(F,this._path)}},s.prototype.sync=function(o){o()},s.prototype.syncSync=function(){},s.prototype.chown=function(o,u,g){var m=null;try{this.chownSync(o,u)}catch(k){m=k}finally{g(m)}},s.prototype.chownSync=function(o,u){try{this._FS.fchown(this._stream.fd,o,u)}catch(g){throw Ut(g,this._path)}},s.prototype.chmod=function(o,u){var g=null;try{this.chmodSync(o)}catch(m){g=m}finally{u(g)}},s.prototype.chmodSync=function(o){try{this._FS.fchmod(this._stream.fd,o)}catch(u){throw Ut(u,this._path)}},s.prototype.utimes=function(o,u,g){var m=null;try{this.utimesSync(o,u)}catch(k){m=k}finally{g(m)}},s.prototype.utimesSync=function(o,u){this._fs.utimesSync(this._path,o,u)},s}(We),ss=function(f){function s(l){f.call(this),this._FS=l}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){u(null,new s(o.FS))},s.isAvailable=function(){return!0},s.prototype.getName=function(){return this._FS.DB_NAME()},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsLinks=function(){return!0},s.prototype.supportsProps=function(){return!0},s.prototype.supportsSynch=function(){return!0},s.prototype.renameSync=function(o,u){try{this._FS.rename(o,u)}catch(g){throw g.errno===h.ENOENT?Ut(g,this.existsSync(o)?u:o):Ut(g)}},s.prototype.statSync=function(o,u){try{var g=u?this._FS.lstat(o):this._FS.stat(o),m=this.modeToFileType(g.mode);return new U(m,g.size,g.mode,g.atime,g.mtime,g.ctime)}catch(k){throw Ut(k,o)}},s.prototype.openSync=function(o,u,g){try{var m=this._FS.open(o,u.getFlagString(),g);if(this._FS.isDir(m.node.mode))throw this._FS.close(m),_.EISDIR(o);return new Rf(this,this._FS,o,m)}catch(k){throw Ut(k,o)}},s.prototype.unlinkSync=function(o){try{this._FS.unlink(o)}catch(u){throw Ut(u,o)}},s.prototype.rmdirSync=function(o){try{this._FS.rmdir(o)}catch(u){throw Ut(u,o)}},s.prototype.mkdirSync=function(o,u){try{this._FS.mkdir(o,u)}catch(g){throw Ut(g,o)}},s.prototype.readdirSync=function(o){try{return this._FS.readdir(o).filter(function(u){return u!=="."&&u!==".."})}catch(u){throw Ut(u,o)}},s.prototype.truncateSync=function(o,u){try{this._FS.truncate(o,u)}catch(g){throw Ut(g,o)}},s.prototype.readFileSync=function(o,u,g){try{var m=this._FS.readFile(o,{flags:g.getFlagString()}),k=qe(m);return u?k.toString(u):k}catch(N){throw Ut(N,o)}},s.prototype.writeFileSync=function(o,u,g,m,k){try{g&&(u=a.from(u,g));var N=Te(u);this._FS.writeFile(o,N,{flags:m.getFlagString(),encoding:"binary"}),this._FS.chmod(o,k)}catch(F){throw Ut(F,o)}},s.prototype.chmodSync=function(o,u,g){try{u?this._FS.lchmod(o,g):this._FS.chmod(o,g)}catch(m){throw Ut(m,o)}},s.prototype.chownSync=function(o,u,g,m){try{u?this._FS.lchown(o,g,m):this._FS.chown(o,g,m)}catch(k){throw Ut(k,o)}},s.prototype.symlinkSync=function(o,u,g){try{this._FS.symlink(o,u)}catch(m){throw Ut(m)}},s.prototype.readlinkSync=function(o){try{return this._FS.readlink(o)}catch(u){throw Ut(u,o)}},s.prototype.utimesSync=function(o,u,g){try{this._FS.utime(o,u.getTime(),g.getTime())}catch(m){throw Ut(m,o)}},s.prototype.modeToFileType=function(o){if(this._FS.isDir(o))return P.DIRECTORY;if(this._FS.isFile(o))return P.FILE;if(this._FS.isLink(o))return P.SYMLINK;throw _.EPERM("Invalid mode: "+o)},s}(Ye);ss.Name="EmscriptenFileSystem",ss.Options={FS:{type:"object",description:"The Emscripten file system to use (the `FS` variable)"}};var Di=function(f){function s(l,o){f.call(this),this._folder=l,this._wrapped=o}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){u(null,new s(o.folder,o.wrapped))},s.isAvailable=function(){return!0},s.prototype.initialize=function(o){var u=this;this._wrapped.exists(this._folder,function(g){g?o():u._wrapped.isReadOnly()?o(_.ENOENT(u._folder)):u._wrapped.mkdir(u._folder,511,o)})},s.prototype.getName=function(){return this._wrapped.getName()},s.prototype.isReadOnly=function(){return this._wrapped.isReadOnly()},s.prototype.supportsProps=function(){return this._wrapped.supportsProps()},s.prototype.supportsSynch=function(){return this._wrapped.supportsSynch()},s.prototype.supportsLinks=function(){return!1},s}(ve);Di.Name="FolderAdapter",Di.Options={folder:{type:"string",description:"The folder to use as the root directory"},wrapped:{type:"object",description:"The file system to wrap"}};function za(f,s){if(s!==null&&typeof s=="object"){var l=s,o=l.path;o&&(o="/"+v.relative(f,o),l.message=l.message.replace(l.path,o),l.path=o)}return s}function Mf(f,s){return typeof s=="function"?function(l){arguments.length>0&&(arguments[0]=za(f,l)),s.apply(null,arguments)}:s}function $a(f,s,l){return f.slice(f.length-4)!=="Sync"?function(){return arguments.length>0&&(s&&(arguments[0]=v.join(this._folder,arguments[0])),l&&(arguments[1]=v.join(this._folder,arguments[1])),arguments[arguments.length-1]=Mf(this._folder,arguments[arguments.length-1])),this._wrapped[f].apply(this._wrapped,arguments)}:function(){try{return s&&(arguments[0]=v.join(this._folder,arguments[0])),l&&(arguments[1]=v.join(this._folder,arguments[1])),this._wrapped[f].apply(this._wrapped,arguments)}catch(o){throw za(this._folder,o)}}}["diskSpace","stat","statSync","open","openSync","unlink","unlinkSync","rmdir","rmdirSync","mkdir","mkdirSync","readdir","readdirSync","exists","existsSync","realpath","realpathSync","truncate","truncateSync","readFile","readFileSync","writeFile","writeFileSync","appendFile","appendFileSync","chmod","chmodSync","chown","chownSync","utimes","utimesSync","readlink","readlinkSync"].forEach(function(f){Di.prototype[f]=$a(f,!0,!1)}),["rename","renameSync","link","linkSync","symlink","symlinkSync"].forEach(function(f){Di.prototype[f]=$a(f,!0,!0)});var os;typeof window<"u"?os=window:typeof self<"u"?os=self:os=p;var $t=os;function Uf(f){return f.isDirectory}var _o=$t.webkitRequestFileSystem||$t.requestFileSystem||null;function zf(f,s,l,o){if(typeof navigator.webkitPersistentStorage<"u")switch(f){case $t.PERSISTENT:navigator.webkitPersistentStorage.requestQuota(s,l,o);break;case $t.TEMPORARY:navigator.webkitTemporaryStorage.requestQuota(s,l,o);break;default:o(new TypeError("Invalid storage type: "+f));break}else $t.webkitStorageInfo.requestQuota(f,s,l,o)}function $f(f){return Array.prototype.slice.call(f||[],0)}function Tr(f,s,l){switch(f.name){case"PathExistsError":return _.EEXIST(s);case"QuotaExceededError":return _.FileError(h.ENOSPC,s);case"NotFoundError":return _.ENOENT(s);case"SecurityError":return _.FileError(h.EACCES,s);case"InvalidModificationError":return _.FileError(h.EPERM,s);case"TypeMismatchError":return _.FileError(l?h.ENOTDIR:h.EISDIR,s);case"EncodingError":case"InvalidStateError":case"NoModificationAllowedError":default:return _.FileError(h.EINVAL,s)}}var qf=function(f){function s(l,o,u,g,m,k){f.call(this,l,u,g,m,k),this._entry=o}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.sync=function(o){var u=this;if(!this.isDirty())return o();this._entry.createWriter(function(g){var m=u.getBuffer(),k=new Blob([ne(m)]),N=k.size;g.onwriteend=function(F){g.onwriteend=null,g.onerror=null,g.truncate(N),u.resetDirty(),o()},g.onerror=function(F){o(Tr(F,u.getPath(),!1))},g.write(k)})},s.prototype.close=function(o){this.sync(o)},s}(xt),as=function(f){function s(l,o,u){l===void 0&&(l=5),o===void 0&&(o=$t.PERSISTENT),u===void 0&&(u=!0),f.call(this),this.size=1024*1024*l,this.type=o,Z(u,s.Name,{size:l,type:o})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){var g=new s(o.size,o.type,!1);g.allocate(function(m){return m?u(m):u(null,g)},!1)},s.isAvailable=function(){return!!_o},s.prototype.getName=function(){return s.Name},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsSymlinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!1},s.prototype.allocate=function(o,u){var g=this;o===void 0&&(o=function(){}),u===void 0&&(u=!0),u&&console.warn("[HTML5FS] HTML5FS.allocate() is deprecated and will be removed in the next major release. Please use 'HTML5FS.Create({type: "+this.type+", size: "+this.size+"}, cb)' to create and allocate HTML5FS instances.");var m=function(N){g.fs=N,o()},k=function(N){o(Tr(N,"/",!0))};this.type===$t.PERSISTENT?zf(this.type,this.size,function(N){_o(g.type,N,m,k)},k):_o(this.type,this.size,m,k)},s.prototype.empty=function(o){this._readdir("/",function(u,g){if(u)console.error("Failed to empty FS"),o(u);else{var m=function(N){u?(console.error("Failed to empty FS"),o(u)):o()},k=function(N,F){var z=function(){F()},G=function(ae){F(Tr(ae,N.fullPath,!N.isDirectory))};Uf(N)?N.removeRecursively(z,G):N.remove(z,G)};Ua(g,k,m)}})},s.prototype.rename=function(o,u,g){var m=this,k=2,N=0,F=this.fs.root,z=o,G=function(we){--k<=0&&g(Tr(we,z,!1))},ae=function(we){if(++N===2)return g(new _(h.EINVAL,"Something was identified as both a file and a directory. This should never happen."));if(o===u)return g();z=v.dirname(u),F.getDirectory(z,{},function(ke){z=v.basename(u),we.moveTo(ke,z,function($e){g()},function($e){we.isDirectory?(z=u,m.unlink(u,function(Ke){Ke?G($e):m.rename(o,u,g)})):G($e)})},G)};F.getFile(o,{},ae,G),F.getDirectory(o,{},ae,G)},s.prototype.stat=function(o,u,g){var m=this,k={create:!1},N=function(ae){var we=function(ke){var $e=new U(P.FILE,ke.size);g(null,$e)};ae.file(we,z)},F=function(ae){var we=4096,ke=new U(P.DIRECTORY,we);g(null,ke)},z=function(ae){g(Tr(ae,o,!1))},G=function(){m.fs.root.getDirectory(o,k,F,z)};this.fs.root.getFile(o,k,N,G)},s.prototype.open=function(o,u,g,m){var k=this,N=function(F){F.name==="InvalidModificationError"&&u.isExclusive()?m(_.EEXIST(o)):m(Tr(F,o,!1))};this.fs.root.getFile(o,{create:u.pathNotExistsAction()===C.CREATE_FILE,exclusive:u.isExclusive()},function(F){F.file(function(z){var G=new FileReader;G.onloadend=function(ae){var we=k._makeFile(o,F,u,z,G.result);m(null,we)},G.onerror=function(ae){N(G.error)},G.readAsArrayBuffer(z)},N)},N)},s.prototype.unlink=function(o,u){this._remove(o,u,!0)},s.prototype.rmdir=function(o,u){var g=this;this.readdir(o,function(m,k){m?u(m):k.length>0?u(_.ENOTEMPTY(o)):g._remove(o,u,!1)})},s.prototype.mkdir=function(o,u,g){var m={create:!0,exclusive:!0},k=function(F){g()},N=function(F){g(Tr(F,o,!0))};this.fs.root.getDirectory(o,m,k,N)},s.prototype.readdir=function(o,u){this._readdir(o,function(g,m){if(m){for(var k=[],N=0,F=m;N<F.length;N+=1){var z=F[N];k.push(z.name)}u(null,k)}else return u(g)})},s.prototype._makeFile=function(o,u,g,m,k){k===void 0&&(k=new ArrayBuffer(0));var N=new U(P.FILE,m.size),F=Me(k);return new qf(this,u,o,g,N,F)},s.prototype._readdir=function(o,u){var g=function(m){u(Tr(m,o,!0))};this.fs.root.getDirectory(o,{create:!1},function(m){var k=m.createReader(),N=[],F=function(){k.readEntries(function(z){z.length?(N=N.concat($f(z)),F()):u(null,N)},g)};F()},g)},s.prototype._remove=function(o,u,g){var m=function(F){var z=function(){u()},G=function(ae){u(Tr(ae,o,!g))};F.remove(z,G)},k=function(F){u(Tr(F,o,!g))},N={create:!1};g?this.fs.root.getFile(o,N,m,k):this.fs.root.getDirectory(o,N,m,k)},s}(ve);as.Name="HTML5FS",as.Options={size:{type:"number",optional:!0,description:"Storage quota to request, in megabytes. Allocated value may be less. Defaults to 5."},type:{type:"number",optional:!0,description:"window.PERSISTENT or window.TEMPORARY. Defaults to PERSISTENT."}};var ur=function(s,l,o,u,g,m){this.id=s,this.size=l,this.mode=o,this.atime=u,this.mtime=g,this.ctime=m};ur.fromBuffer=function(s){if(s===void 0)throw new Error("NO");return new ur(s.toString("ascii",30),s.readUInt32LE(0),s.readUInt16LE(4),s.readDoubleLE(6),s.readDoubleLE(14),s.readDoubleLE(22))},ur.prototype.toStats=function(){return new U((this.mode&61440)===P.DIRECTORY?P.DIRECTORY:P.FILE,this.size,this.mode,new Date(this.atime),new Date(this.mtime),new Date(this.ctime))},ur.prototype.getSize=function(){return 30+this.id.length},ur.prototype.toBuffer=function(s){return s===void 0&&(s=a.alloc(this.getSize())),s.writeUInt32LE(this.size,0),s.writeUInt16LE(this.mode,4),s.writeDoubleLE(this.atime,6),s.writeDoubleLE(this.mtime,14),s.writeDoubleLE(this.ctime,22),s.write(this.id,30,this.id.length,"ascii"),s},ur.prototype.update=function(s){var l=!1;this.size!==s.size&&(this.size=s.size,l=!0),this.mode!==s.mode&&(this.mode=s.mode,l=!0);var o=s.atime.getTime();this.atime!==o&&(this.atime=o,l=!0);var u=s.mtime.getTime();this.mtime!==u&&(this.mtime=u,l=!0);var g=s.ctime.getTime();return this.ctime!==g&&(this.ctime=g,l=!0),l},ur.prototype.isFile=function(){return(this.mode&61440)===P.FILE},ur.prototype.isDirectory=function(){return(this.mode&61440)===P.DIRECTORY};var Kr="/",vo=null;function qa(){return vo||(vo=a.from("{}"))}function ls(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(f){var s=Math.random()*16|0,l=f==="x"?s:s&3|8;return l.toString(16)})}function br(f,s){return f?(s(f),!1):!0}function Wt(f,s,l){return f?(s.abort(function(){l(f)}),!1):!0}var Rr=function(s){this.store=s,this.originalData={},this.modifiedKeys=[]};Rr.prototype.get=function(s){var l=this.store.get(s);return this.stashOldValue(s,l),l},Rr.prototype.put=function(s,l,o){return this.markModified(s),this.store.put(s,l,o)},Rr.prototype.del=function(s){this.markModified(s),this.store.del(s)},Rr.prototype.commit=function(){},Rr.prototype.abort=function(){for(var s=this,l=0,o=s.modifiedKeys;l<o.length;l+=1){var u=o[l],g=s.originalData[u];g?s.store.put(u,g,!0):s.store.del(u)}},Rr.prototype.stashOldValue=function(s,l){this.originalData.hasOwnProperty(s)||(this.originalData[s]=l)},Rr.prototype.markModified=function(s){this.modifiedKeys.indexOf(s)===-1&&(this.modifiedKeys.push(s),this.originalData.hasOwnProperty(s)||(this.originalData[s]=this.store.get(s)))};var Va=function(f){function s(l,o,u,g,m){f.call(this,l,o,u,g,m)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this.getPath(),this.getBuffer(),this.getStats()),this.resetDirty())},s.prototype.closeSync=function(){this.syncSync()},s}(xt),Ja=function(f){function s(l){f.call(this),this.store=l.store,this.makeRootDirectory()}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.isAvailable=function(){return!0},s.prototype.getName=function(){return this.store.name()},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsSymlinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!0},s.prototype.empty=function(){this.store.clear(),this.makeRootDirectory()},s.prototype.renameSync=function(o,u){var g=this.store.beginTransaction("readwrite"),m=v.dirname(o),k=v.basename(o),N=v.dirname(u),F=v.basename(u),z=this.findINode(g,m),G=this.getDirListing(g,m,z);if(!G[k])throw _.ENOENT(o);var ae=G[k];if(delete G[k],(N+"/").indexOf(o+"/")===0)throw new _(h.EBUSY,m);var we,ke;if(N===m?(we=z,ke=G):(we=this.findINode(g,N),ke=this.getDirListing(g,N,we)),ke[F]){var $e=this.getINode(g,u,ke[F]);if($e.isFile())try{g.del($e.id),g.del(ke[F])}catch(Ke){throw g.abort(),Ke}else throw _.EPERM(u)}ke[F]=ae;try{g.put(z.id,a.from(JSON.stringify(G)),!0),g.put(we.id,a.from(JSON.stringify(ke)),!0)}catch(Ke){throw g.abort(),Ke}g.commit()},s.prototype.statSync=function(o,u){return this.findINode(this.store.beginTransaction("readonly"),o).toStats()},s.prototype.createFileSync=function(o,u,g){var m=this.store.beginTransaction("readwrite"),k=Y(),N=this.commitNewFile(m,o,P.FILE,g,k);return new Va(this,o,u,N.toStats(),k)},s.prototype.openFileSync=function(o,u){var g=this.store.beginTransaction("readonly"),m=this.findINode(g,o),k=g.get(m.id);if(k===void 0)throw _.ENOENT(o);return new Va(this,o,u,m.toStats(),k)},s.prototype.unlinkSync=function(o){this.removeEntry(o,!1)},s.prototype.rmdirSync=function(o){if(this.readdirSync(o).length>0)throw _.ENOTEMPTY(o);this.removeEntry(o,!0)},s.prototype.mkdirSync=function(o,u){var g=this.store.beginTransaction("readwrite"),m=a.from("{}");this.commitNewFile(g,o,P.DIRECTORY,u,m)},s.prototype.readdirSync=function(o){var u=this.store.beginTransaction("readonly");return Object.keys(this.getDirListing(u,o,this.findINode(u,o)))},s.prototype._syncSync=function(o,u,g){var m=this.store.beginTransaction("readwrite"),k=this._findINode(m,v.dirname(o),v.basename(o)),N=this.getINode(m,o,k),F=N.update(g);try{m.put(N.id,u,!0),F&&m.put(k,N.toBuffer(),!0)}catch(z){throw m.abort(),z}m.commit()},s.prototype.makeRootDirectory=function(){var o=this.store.beginTransaction("readwrite");if(o.get(Kr)===void 0){var u=new Date().getTime(),g=new ur(ls(),4096,511|P.DIRECTORY,u,u,u);o.put(g.id,qa(),!1),o.put(Kr,g.toBuffer(),!1),o.commit()}},s.prototype._findINode=function(o,u,g){var m=this,k=function(N){var F=m.getDirListing(o,u,N);if(F[g])return F[g];throw _.ENOENT(v.resolve(u,g))};return u==="/"?g===""?Kr:k(this.getINode(o,u,Kr)):k(this.getINode(o,u+v.sep+g,this._findINode(o,v.dirname(u),v.basename(u))))},s.prototype.findINode=function(o,u){return this.getINode(o,u,this._findINode(o,v.dirname(u),v.basename(u)))},s.prototype.getINode=function(o,u,g){var m=o.get(g);if(m===void 0)throw _.ENOENT(u);return ur.fromBuffer(m)},s.prototype.getDirListing=function(o,u,g){if(!g.isDirectory())throw _.ENOTDIR(u);var m=o.get(g.id);if(m===void 0)throw _.ENOENT(u);return JSON.parse(m.toString())},s.prototype.addNewNode=function(o,u){for(var g=0,m;g<5;)try{return m=ls(),o.put(m,u,!1),m}catch{}throw new _(h.EIO,"Unable to commit data to key-value store.")},s.prototype.commitNewFile=function(o,u,g,m,k){var N=v.dirname(u),F=v.basename(u),z=this.findINode(o,N),G=this.getDirListing(o,N,z),ae=new Date().getTime();if(u==="/"||G[F])throw _.EEXIST(u);var we;try{var ke=this.addNewNode(o,k);we=new ur(ke,k.length,m|g,ae,ae,ae);var $e=this.addNewNode(o,we.toBuffer());G[F]=$e,o.put(z.id,a.from(JSON.stringify(G)),!0)}catch(Ke){throw o.abort(),Ke}return o.commit(),we},s.prototype.removeEntry=function(o,u){var g=this.store.beginTransaction("readwrite"),m=v.dirname(o),k=this.findINode(g,m),N=this.getDirListing(g,m,k),F=v.basename(o);if(!N[F])throw _.ENOENT(o);var z=N[F];delete N[F];var G=this.getINode(g,o,z);if(!u&&G.isDirectory())throw _.EISDIR(o);if(u&&!G.isDirectory())throw _.ENOTDIR(o);try{g.del(G.id),g.del(z),g.put(k.id,a.from(JSON.stringify(N)),!0)}catch(ae){throw g.abort(),ae}g.commit()},s}(Ye),Ha=function(f){function s(l,o,u,g,m){f.call(this,l,o,u,g,m)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.sync=function(o){var u=this;this.isDirty()?this._fs._sync(this.getPath(),this.getBuffer(),this.getStats(),function(g){g||u.resetDirty(),o(g)}):o()},s.prototype.close=function(o){this.sync(o)},s}(xt),Vf=function(f){function s(){f.apply(this,arguments)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.isAvailable=function(){return!0},s.prototype.init=function(o,u){this.store=o,this.makeRootDirectory(u)},s.prototype.getName=function(){return this.store.name()},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsSymlinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!1},s.prototype.empty=function(o){var u=this;this.store.clear(function(g){br(g,o)&&u.makeRootDirectory(o)})},s.prototype.rename=function(o,u,g){var m=this,k=this.store.beginTransaction("readwrite"),N=v.dirname(o),F=v.basename(o),z=v.dirname(u),G=v.basename(u),ae={},we={},ke=!1;if((z+"/").indexOf(o+"/")===0)return g(new _(h.EBUSY,N));var $e=function(){if(!(ke||!we.hasOwnProperty(N)||!we.hasOwnProperty(z))){var at=we[N],Pt=ae[N],er=we[z],Br=ae[z];if(!at[F])g(_.ENOENT(o));else{var Cr=at[F];delete at[F];var qi=function(){er[G]=Cr,k.put(Pt.id,a.from(JSON.stringify(at)),!0,function(zr){Wt(zr,k,g)&&(N===z?k.commit(g):k.put(Br.id,a.from(JSON.stringify(er)),!0,function($r){Wt($r,k,g)&&k.commit(g)}))})};er[G]?m.getINode(k,u,er[G],function(zr,$r){Wt(zr,k,g)&&($r.isFile()?k.del($r.id,function(Ll){Wt(Ll,k,g)&&k.del(er[G],function(mu){Wt(mu,k,g)&&qi()})}):k.abort(function(Ll){g(_.EPERM(u))}))}):qi()}}},Ke=function(at){m.findINodeAndDirListing(k,at,function(Pt,er,Br){Pt?ke||(ke=!0,k.abort(function(){g(Pt)})):(ae[at]=er,we[at]=Br,$e())})};Ke(N),N!==z&&Ke(z)},s.prototype.stat=function(o,u,g){var m=this.store.beginTransaction("readonly");this.findINode(m,o,function(k,N){br(k,g)&&g(null,N.toStats())})},s.prototype.createFile=function(o,u,g,m){var k=this,N=this.store.beginTransaction("readwrite"),F=Y();this.commitNewFile(N,o,P.FILE,g,F,function(z,G){br(z,m)&&m(null,new Ha(k,o,u,G.toStats(),F))})},s.prototype.openFile=function(o,u,g){var m=this,k=this.store.beginTransaction("readonly");this.findINode(k,o,function(N,F){br(N,g)&&k.get(F.id,function(z,G){br(z,g)&&(G===void 0?g(_.ENOENT(o)):g(null,new Ha(m,o,u,F.toStats(),G)))})})},s.prototype.unlink=function(o,u){this.removeEntry(o,!1,u)},s.prototype.rmdir=function(o,u){var g=this;this.readdir(o,function(m,k){m?u(m):k.length>0?u(_.ENOTEMPTY(o)):g.removeEntry(o,!0,u)})},s.prototype.mkdir=function(o,u,g){var m=this.store.beginTransaction("readwrite"),k=a.from("{}");this.commitNewFile(m,o,P.DIRECTORY,u,k,g)},s.prototype.readdir=function(o,u){var g=this,m=this.store.beginTransaction("readonly");this.findINode(m,o,function(k,N){br(k,u)&&g.getDirListing(m,o,N,function(F,z){br(F,u)&&u(null,Object.keys(z))})})},s.prototype._sync=function(o,u,g,m){var k=this,N=this.store.beginTransaction("readwrite");this._findINode(N,v.dirname(o),v.basename(o),function(F,z){Wt(F,N,m)&&k.getINode(N,o,z,function(G,ae){if(Wt(G,N,m)){var we=ae.update(g);N.put(ae.id,u,!0,function(ke){Wt(ke,N,m)&&(we?N.put(z,ae.toBuffer(),!0,function($e){Wt($e,N,m)&&N.commit(m)}):N.commit(m))})}})})},s.prototype.makeRootDirectory=function(o){var u=this.store.beginTransaction("readwrite");u.get(Kr,function(g,m){if(g||m===void 0){var k=new Date().getTime(),N=new ur(ls(),4096,511|P.DIRECTORY,k,k,k);u.put(N.id,qa(),!1,function(F){Wt(F,u,o)&&u.put(Kr,N.toBuffer(),!1,function(z){z?u.abort(function(){o(z)}):u.commit(o)})})}else u.commit(o)})},s.prototype._findINode=function(o,u,g,m){var k=this,N=function(F,z,G){F?m(F):G[g]?m(null,G[g]):m(_.ENOENT(v.resolve(u,g)))};u==="/"?g===""?m(null,Kr):this.getINode(o,u,Kr,function(F,z){br(F,m)&&k.getDirListing(o,u,z,function(G,ae){N(G,z,ae)})}):this.findINodeAndDirListing(o,u,N)},s.prototype.findINode=function(o,u,g){var m=this;this._findINode(o,v.dirname(u),v.basename(u),function(k,N){br(k,g)&&m.getINode(o,u,N,g)})},s.prototype.getINode=function(o,u,g,m){o.get(g,function(k,N){br(k,m)&&(N===void 0?m(_.ENOENT(u)):m(null,ur.fromBuffer(N)))})},s.prototype.getDirListing=function(o,u,g,m){g.isDirectory()?o.get(g.id,function(k,N){if(br(k,m))try{m(null,JSON.parse(N.toString()))}catch{m(_.ENOENT(u))}}):m(_.ENOTDIR(u))},s.prototype.findINodeAndDirListing=function(o,u,g){var m=this;this.findINode(o,u,function(k,N){br(k,g)&&m.getDirListing(o,u,N,function(F,z){br(F,g)&&g(null,N,z)})})},s.prototype.addNewNode=function(o,u,g){var m=0,k,N=function(){++m===5?g(new _(h.EIO,"Unable to commit data to key-value store.")):(k=ls(),o.put(k,u,!1,function(F,z){F||!z?N():g(null,k)}))};N()},s.prototype.commitNewFile=function(o,u,g,m,k,N){var F=this,z=v.dirname(u),G=v.basename(u),ae=new Date().getTime();if(u==="/")return N(_.EEXIST(u));this.findINodeAndDirListing(o,z,function(we,ke,$e){Wt(we,o,N)&&($e[G]?o.abort(function(){N(_.EEXIST(u))}):F.addNewNode(o,k,function(Ke,at){if(Wt(Ke,o,N)){var Pt=new ur(at,k.length,m|g,ae,ae,ae);F.addNewNode(o,Pt.toBuffer(),function(er,Br){Wt(er,o,N)&&($e[G]=Br,o.put(ke.id,a.from(JSON.stringify($e)),!0,function(Cr){Wt(Cr,o,N)&&o.commit(function(qi){Wt(qi,o,N)&&N(null,Pt)})}))})}}))})},s.prototype.removeEntry=function(o,u,g){var m=this,k=this.store.beginTransaction("readwrite"),N=v.dirname(o),F=v.basename(o);this.findINodeAndDirListing(k,N,function(z,G,ae){if(Wt(z,k,g))if(!ae[F])k.abort(function(){g(_.ENOENT(o))});else{var we=ae[F];delete ae[F],m.getINode(k,o,we,function(ke,$e){Wt(ke,k,g)&&(!u&&$e.isDirectory()?k.abort(function(){g(_.EISDIR(o))}):u&&!$e.isDirectory()?k.abort(function(){g(_.ENOTDIR(o))}):k.del($e.id,function(Ke){Wt(Ke,k,g)&&k.del(we,function(at){Wt(at,k,g)&&k.put(G.id,a.from(JSON.stringify(ae)),!0,function(Pt){Wt(Pt,k,g)&&k.commit(g)})})}))})}})},s}(ve),pi=function(){this.store={}};pi.prototype.name=function(){return Pi.Name},pi.prototype.clear=function(){this.store={}},pi.prototype.beginTransaction=function(s){return new Rr(this)},pi.prototype.get=function(s){return this.store[s]},pi.prototype.put=function(s,l,o){return!o&&this.store.hasOwnProperty(s)?!1:(this.store[s]=l,!0)},pi.prototype.del=function(s){delete this.store[s]};var Pi=function(f){function s(){f.call(this,{store:new pi})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){u(null,new s)},s}(Ja);Pi.Name="InMemory",Pi.Options={};var wo=$t.indexedDB||$t.mozIndexedDB||$t.webkitIndexedDB||$t.msIndexedDB;function vn(f,s){switch(s===void 0&&(s=f.toString()),f.name){case"NotFoundError":return new _(h.ENOENT,s);case"QuotaExceededError":return new _(h.ENOSPC,s);default:return new _(h.EIO,s)}}function wn(f,s,l){return s===void 0&&(s=h.EIO),l===void 0&&(l=null),function(o){o.preventDefault(),f(new _(s,l!==null?l:void 0))}}var So=function(s,l){this.tx=s,this.store=l};So.prototype.get=function(s,l){try{var o=this.store.get(s);o.onerror=wn(l),o.onsuccess=function(u){var g=u.target.result;g===void 0?l(null,g):l(null,Me(g))}}catch(u){l(vn(u))}};var Jf=function(f){function s(l,o){f.call(this,l,o)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.put=function(o,u,g,m){try{var k=ne(u),N;g?N=this.store.put(k,o):N=this.store.add(k,o),N.onerror=wn(m),N.onsuccess=function(F){m(null,!0)}}catch(F){m(vn(F))}},s.prototype.del=function(o,u){try{var g=this.store.delete(o);g.onerror=wn(u),g.onsuccess=function(m){u()}}catch(m){u(vn(m))}},s.prototype.commit=function(o){setTimeout(o,0)},s.prototype.abort=function(o){var u=null;try{this.tx.abort()}catch(g){u=vn(g)}finally{o(u)}},s}(So),cs=function(s,l){var o=this;l===void 0&&(l="browserfs"),this.storeName=l;var u=wo.open(this.storeName,1);u.onupgradeneeded=function(g){var m=g.target.result;m.objectStoreNames.contains(o.storeName)&&m.deleteObjectStore(o.storeName),m.createObjectStore(o.storeName)},u.onsuccess=function(g){o.db=g.target.result,s(null,o)},u.onerror=wn(s,h.EACCES)};cs.prototype.name=function(){return Sn.Name+" - "+this.storeName},cs.prototype.clear=function(s){try{var l=this.db.transaction(this.storeName,"readwrite"),o=l.objectStore(this.storeName),u=o.clear();u.onsuccess=function(g){setTimeout(s,0)},u.onerror=wn(s)}catch(g){s(vn(g))}},cs.prototype.beginTransaction=function(s){s===void 0&&(s="readonly");var l=this.db.transaction(this.storeName,s),o=l.objectStore(this.storeName);if(s==="readwrite")return new Jf(l,o);if(s==="readonly")return new So(l,o);throw new _(h.EINVAL,"Invalid transaction type.")};var Sn=function(f){function s(l,o,u){var g=this;u===void 0&&(u=!0),f.call(this),this.store=new cs(function(m){m?l(m):g.init(g.store,function(k){l(k,g)})},o),Z(u,s.Name,{storeName:o})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){new s(u,o.storeName,!1)},s.isAvailable=function(){try{return typeof wo<"u"&&wo.open("__browserfs_test__")!==null}catch{return!1}},s}(Vf);Sn.Name="IndexedDB",Sn.Options={storeName:{type:"string",optional:!0,description:"The name of this file system. You can have multiple IndexedDB file systems operating at once, but each must have a different name."}};var ko=!1,kn;try{$t.localStorage.setItem("__test__",String.fromCharCode(55296)),ko=$t.localStorage.getItem("__test__")===String.fromCharCode(55296)}catch{ko=!1}kn=ko?"binary_string":"binary_string_ie",a.isEncoding(kn)||(kn="base64");var hi=function(){};hi.prototype.name=function(){return xn.Name},hi.prototype.clear=function(){$t.localStorage.clear()},hi.prototype.beginTransaction=function(s){return new Rr(this)},hi.prototype.get=function(s){try{var l=$t.localStorage.getItem(s);if(l!==null)return a.from(l,kn)}catch{}},hi.prototype.put=function(s,l,o){try{return!o&&$t.localStorage.getItem(s)!==null?!1:($t.localStorage.setItem(s,l.toString(kn)),!0)}catch{throw new _(h.ENOSPC,"LocalStorage is full.")}},hi.prototype.del=function(s){try{$t.localStorage.removeItem(s)}catch(l){throw new _(h.EIO,"Unable to delete key "+s+": "+l)}};var xn=function(f){function s(){f.call(this,{store:new hi})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){u(null,new s)},s.isAvailable=function(){return typeof $t.localStorage<"u"},s}(Ja);xn.Name="LocalStorage",xn.Options={};var Ri=function(f){function s(){f.call(this),this.mountList=[],this.mntMap={},this.rootFs=new Pi}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){var g=new s;Object.keys(o).forEach(function(m){g.mount(m,o[m])}),u(null,g)},s.isAvailable=function(){return!0},s.prototype.mount=function(o,u){if(o[0]!=="/"&&(o="/"+o),o=v.resolve(o),this.mntMap[o])throw new _(h.EINVAL,"Mount point "+o+" is already taken.");K(o,511,this.rootFs),this.mntMap[o]=u,this.mountList.push(o),this.mountList=this.mountList.sort(function(g,m){return m.length-g.length})},s.prototype.umount=function(o){var u=this;if(o[0]!=="/"&&(o="/"+o),o=v.resolve(o),!this.mntMap[o])throw new _(h.EINVAL,"Mount point "+o+" is already unmounted.");for(delete this.mntMap[o],this.mountList.splice(this.mountList.indexOf(o),1);o!=="/"&&u.rootFs.readdirSync(o).length===0;)u.rootFs.rmdirSync(o),o=v.dirname(o)},s.prototype._getFs=function(o){for(var u=this,g=this.mountList,m=g.length,k=0;k<m;k++){var N=g[k];if(N.length<=o.length&&o.indexOf(N)===0)return o=o.substr(N.length>1?N.length:0),o===""&&(o="/"),{fs:u.mntMap[N],path:o}}return{fs:this.rootFs,path:o}},s.prototype.getName=function(){return s.Name},s.prototype.diskSpace=function(o,u){u(0,0)},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsLinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!0},s.prototype.standardizeError=function(o,u,g){var m=o.message.indexOf(u);return m!==-1&&(o.message=o.message.substr(0,m)+g+o.message.substr(m+u.length),o.path=g),o},s.prototype.rename=function(o,u,g){var m=this,k=this._getFs(o),N=this._getFs(u);return k.fs===N.fs?k.fs.rename(k.path,N.path,function(F){F&&m.standardizeError(m.standardizeError(F,k.path,o),N.path,u),g(F)}):fe.readFile(o,function(F,z){if(F)return g(F);fe.writeFile(u,z,function(G){if(G)return g(G);fe.unlink(o,g)})})},s.prototype.renameSync=function(o,u){var g=this._getFs(o),m=this._getFs(u);if(g.fs===m.fs)try{return g.fs.renameSync(g.path,m.path)}catch(N){throw this.standardizeError(this.standardizeError(N,g.path,o),m.path,u),N}var k=fe.readFileSync(o);return fe.writeFileSync(u,k),fe.unlinkSync(o)},s.prototype.readdirSync=function(o){var u=this._getFs(o),g=null;if(u.fs!==this.rootFs)try{g=this.rootFs.readdirSync(o)}catch{}try{var m=u.fs.readdirSync(u.path);return g===null?m:m.concat(g.filter(function(k){return m.indexOf(k)===-1}))}catch(k){if(g===null)throw this.standardizeError(k,u.path,o);return g}},s.prototype.readdir=function(o,u){var g=this,m=this._getFs(o);m.fs.readdir(m.path,function(k,N){if(m.fs!==g.rootFs)try{var F=g.rootFs.readdirSync(o);N?N=N.concat(F.filter(function(z){return N.indexOf(z)===-1})):N=F}catch{if(k)return u(g.standardizeError(k,m.path,o))}else if(k)return u(g.standardizeError(k,m.path,o));u(null,N)})},s.prototype.rmdirSync=function(o){var u=this._getFs(o);if(this._containsMountPt(o))throw _.ENOTEMPTY(o);try{u.fs.rmdirSync(u.path)}catch(g){throw this.standardizeError(g,u.path,o)}},s.prototype.rmdir=function(o,u){var g=this,m=this._getFs(o);this._containsMountPt(o)?u(_.ENOTEMPTY(o)):m.fs.rmdir(m.path,function(k){u(k?g.standardizeError(k,m.path,o):null)})},s.prototype._containsMountPt=function(o){for(var u=this.mountList,g=u.length,m=0;m<g;m++){var k=u[m];if(k.length>=o.length&&k.slice(0,o.length)===o)return!0}return!1},s}(ve);Ri.Name="MountableFileSystem",Ri.Options={};function Wa(f,s,l){return s?function(){for(var o=[],u=arguments.length;u--;)o[u]=arguments[u];var g=o[0],m=this._getFs(g);o[0]=m.path;try{return m.fs[f].apply(m.fs,o)}catch(k){throw this.standardizeError(k,m.path,g),k}}:function(){for(var o=this,u=[],g=arguments.length;g--;)u[g]=arguments[g];var m=u[0],k=this._getFs(m);if(u[0]=k.path,typeof u[u.length-1]=="function"){var N=u[u.length-1];u[u.length-1]=function(){for(var F=[],z=arguments.length;z--;)F[z]=arguments[z];F.length>0&&F[0]instanceof _&&o.standardizeError(F[0],k.path,m),N.apply(null,F)}}return k.fs[f].apply(k.fs,u)}}for(var Ga=[["exists","unlink","readlink"],["stat","mkdir","realpath","truncate"],["open","readFile","chmod","utimes"],["chown"],["writeFile","appendFile"]],En=0;En<Ga.length;En++)for(var Hf=Ga[En],xo=0,Ya=Hf;xo<Ya.length;xo+=1){var us=Ya[xo];Ri.prototype[us]=Wa(us,!1,En+1),Ri.prototype[us+"Sync"]=Wa(us+"Sync",!0,En+1)}var On;if(typeof setImmediate<"u")On=setImmediate;else{var wr=$t,Mi=[],Xa="zero-timeout-message",Wf=function(){if(typeof wr.importScripts<"u"||!wr.postMessage)return!1;var f=!0,s=wr.onmessage;return wr.onmessage=function(){f=!1},wr.postMessage("","*"),wr.onmessage=s,f};if(Wf()){On=function(f){Mi.push(f),wr.postMessage(Xa,"*")};var Ka=function(f){if(f.source===self&&f.data===Xa&&(f.stopPropagation?f.stopPropagation():f.cancelBubble=!0,Mi.length>0)){var s=Mi.shift();return s()}};wr.addEventListener?wr.addEventListener("message",Ka,!0):wr.attachEvent("onmessage",Ka)}else if(wr.MessageChannel){var Za=new wr.MessageChannel;Za.port1.onmessage=function(f){if(Mi.length>0)return Mi.shift()()},On=function(f){Mi.push(f),Za.port2.postMessage("")}}else On=function(f){return setTimeout(f,0)}}var Eo=On,An=function(){this._locked=!1,this._waiters=[]};An.prototype.lock=function(s){if(this._locked){this._waiters.push(s);return}this._locked=!0,s()},An.prototype.unlock=function(){if(!this._locked)throw new Error("unlock of a non-locked mutex");var s=this._waiters.shift();if(s){Eo(s);return}this._locked=!1},An.prototype.tryLock=function(){return this._locked?!1:(this._locked=!0,!0)},An.prototype.isLocked=function(){return this._locked};var et=function(s){this._fs=s,this._mu=new An};et.prototype.getName=function(){return"LockedFS<"+this._fs.getName()+">"},et.prototype.getFSUnlocked=function(){return this._fs},et.prototype.initialize=function(s){this._fs.initialize(s)},et.prototype.diskSpace=function(s,l){this._fs.diskSpace(s,l)},et.prototype.isReadOnly=function(){return this._fs.isReadOnly()},et.prototype.supportsLinks=function(){return this._fs.supportsLinks()},et.prototype.supportsProps=function(){return this._fs.supportsProps()},et.prototype.supportsSynch=function(){return this._fs.supportsSynch()},et.prototype.rename=function(s,l,o){var u=this;this._mu.lock(function(){u._fs.rename(s,l,function(g){u._mu.unlock(),o(g)})})},et.prototype.renameSync=function(s,l){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.renameSync(s,l)},et.prototype.stat=function(s,l,o){var u=this;this._mu.lock(function(){u._fs.stat(s,l,function(g,m){u._mu.unlock(),o(g,m)})})},et.prototype.statSync=function(s,l){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.statSync(s,l)},et.prototype.open=function(s,l,o,u){var g=this;this._mu.lock(function(){g._fs.open(s,l,o,function(m,k){g._mu.unlock(),u(m,k)})})},et.prototype.openSync=function(s,l,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.openSync(s,l,o)},et.prototype.unlink=function(s,l){var o=this;this._mu.lock(function(){o._fs.unlink(s,function(u){o._mu.unlock(),l(u)})})},et.prototype.unlinkSync=function(s){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.unlinkSync(s)},et.prototype.rmdir=function(s,l){var o=this;this._mu.lock(function(){o._fs.rmdir(s,function(u){o._mu.unlock(),l(u)})})},et.prototype.rmdirSync=function(s){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.rmdirSync(s)},et.prototype.mkdir=function(s,l,o){var u=this;this._mu.lock(function(){u._fs.mkdir(s,l,function(g){u._mu.unlock(),o(g)})})},et.prototype.mkdirSync=function(s,l){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.mkdirSync(s,l)},et.prototype.readdir=function(s,l){var o=this;this._mu.lock(function(){o._fs.readdir(s,function(u,g){o._mu.unlock(),l(u,g)})})},et.prototype.readdirSync=function(s){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readdirSync(s)},et.prototype.exists=function(s,l){var o=this;this._mu.lock(function(){o._fs.exists(s,function(u){o._mu.unlock(),l(u)})})},et.prototype.existsSync=function(s){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.existsSync(s)},et.prototype.realpath=function(s,l,o){var u=this;this._mu.lock(function(){u._fs.realpath(s,l,function(g,m){u._mu.unlock(),o(g,m)})})},et.prototype.realpathSync=function(s,l){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.realpathSync(s,l)},et.prototype.truncate=function(s,l,o){var u=this;this._mu.lock(function(){u._fs.truncate(s,l,function(g){u._mu.unlock(),o(g)})})},et.prototype.truncateSync=function(s,l){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.truncateSync(s,l)},et.prototype.readFile=function(s,l,o,u){var g=this;this._mu.lock(function(){g._fs.readFile(s,l,o,function(m,k){g._mu.unlock(),u(m,k)})})},et.prototype.readFileSync=function(s,l,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readFileSync(s,l,o)},et.prototype.writeFile=function(s,l,o,u,g,m){var k=this;this._mu.lock(function(){k._fs.writeFile(s,l,o,u,g,function(N){k._mu.unlock(),m(N)})})},et.prototype.writeFileSync=function(s,l,o,u,g){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.writeFileSync(s,l,o,u,g)},et.prototype.appendFile=function(s,l,o,u,g,m){var k=this;this._mu.lock(function(){k._fs.appendFile(s,l,o,u,g,function(N){k._mu.unlock(),m(N)})})},et.prototype.appendFileSync=function(s,l,o,u,g){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.appendFileSync(s,l,o,u,g)},et.prototype.chmod=function(s,l,o,u){var g=this;this._mu.lock(function(){g._fs.chmod(s,l,o,function(m){g._mu.unlock(),u(m)})})},et.prototype.chmodSync=function(s,l,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chmodSync(s,l,o)},et.prototype.chown=function(s,l,o,u,g){var m=this;this._mu.lock(function(){m._fs.chown(s,l,o,u,function(k){m._mu.unlock(),g(k)})})},et.prototype.chownSync=function(s,l,o,u){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.chownSync(s,l,o,u)},et.prototype.utimes=function(s,l,o,u){var g=this;this._mu.lock(function(){g._fs.utimes(s,l,o,function(m){g._mu.unlock(),u(m)})})},et.prototype.utimesSync=function(s,l,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.utimesSync(s,l,o)},et.prototype.link=function(s,l,o){var u=this;this._mu.lock(function(){u._fs.link(s,l,function(g){u._mu.unlock(),o(g)})})},et.prototype.linkSync=function(s,l){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.linkSync(s,l)},et.prototype.symlink=function(s,l,o,u){var g=this;this._mu.lock(function(){g._fs.symlink(s,l,o,function(m){g._mu.unlock(),u(m)})})},et.prototype.symlinkSync=function(s,l,o){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.symlinkSync(s,l,o)},et.prototype.readlink=function(s,l){var o=this;this._mu.lock(function(){o._fs.readlink(s,function(u,g){o._mu.unlock(),l(u,g)})})},et.prototype.readlinkSync=function(s){if(this._mu.isLocked())throw new Error("invalid sync call");return this._fs.readlinkSync(s)};var Mr="/.deletedFiles.log";function Qa(f){return 146|f}function mr(f){return I.getFileFlag(f)}var el=function(f){function s(l,o,u,g,m){f.call(this,l,o,u,g,m)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.sync=function(o){var u=this;if(!this.isDirty()){o(null);return}this._fs._syncAsync(this,function(g){u.resetDirty(),o(g)})},s.prototype.syncSync=function(){this.isDirty()&&(this._fs._syncSync(this),this.resetDirty())},s.prototype.close=function(o){this.sync(o)},s.prototype.closeSync=function(){this.syncSync()},s}(xt),tl=function(f){function s(l,o){if(f.call(this),this._isInitialized=!1,this._initializeCallbacks=[],this._deletedFiles={},this._deleteLog="",this._deleteLogUpdatePending=!1,this._deleteLogUpdateNeeded=!1,this._deleteLogError=null,this._writable=l,this._readable=o,this._writable.isReadOnly())throw new _(h.EINVAL,"Writable file system must be writable.")}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.isAvailable=function(){return!0},s.prototype.getOverlayedFileSystems=function(){return{readable:this._readable,writable:this._writable}},s.prototype._syncAsync=function(o,u){var g=this;this.createParentDirectoriesAsync(o.getPath(),function(m){if(m)return u(m);g._writable.writeFile(o.getPath(),o.getBuffer(),null,mr("w"),o.getStats().mode,u)})},s.prototype._syncSync=function(o){this.createParentDirectories(o.getPath()),this._writable.writeFileSync(o.getPath(),o.getBuffer(),null,mr("w"),o.getStats().mode)},s.prototype.getName=function(){return Nn.Name},s.prototype.initialize=function(o){var u=this,g=this._initializeCallbacks,m=function(k){u._isInitialized=!k,u._initializeCallbacks=[],g.forEach(function(N){return N(k)})};if(this._isInitialized)return o();g.push(o),g.length===1&&this._writable.readFile(Mr,"utf8",mr("r"),function(k,N){if(k){if(k.errno!==h.ENOENT)return m(k)}else u._deleteLog=N;u._reparseDeletionLog(),m()})},s.prototype.isReadOnly=function(){return!1},s.prototype.supportsSynch=function(){return this._readable.supportsSynch()&&this._writable.supportsSynch()},s.prototype.supportsLinks=function(){return!1},s.prototype.supportsProps=function(){return this._readable.supportsProps()&&this._writable.supportsProps()},s.prototype.getDeletionLog=function(){return this._deleteLog},s.prototype.restoreDeletionLog=function(o){this._deleteLog=o,this._reparseDeletionLog(),this.updateLog("")},s.prototype.rename=function(o,u,g){var m=this;if(!(!this.checkInitAsync(g)||this.checkPathAsync(o,g)||this.checkPathAsync(u,g))){if(o===Mr||u===Mr)return g(_.EPERM("Cannot rename deletion log."));if(o===u)return g();this.stat(o,!1,function(k,N){return k?g(k):m.stat(u,!1,function(F,z){var G=m;function ae(ke){var $e=ke.shift();if(!$e)return g();var Ke=v.resolve(o,$e),at=v.resolve(u,$e);G.rename(Ke,at,function(Pt){if(Pt)return g(Pt);ae(ke)})}var we=511;if(N.isDirectory()){if(F)return F.errno!==h.ENOENT?g(F):m._writable.exists(o,function(ke){if(ke)return m._writable.rename(o,u,g);m._writable.mkdir(u,we,function($e){if($e)return g($e);m._readable.readdir(o,function(Ke,at){if(Ke)return g();ae(at)})})});if(we=z.mode,!z.isDirectory())return g(_.ENOTDIR(u));m.readdir(u,function(ke,$e){if($e&&$e.length)return g(_.ENOTEMPTY(u));m._readable.readdir(o,function(Ke,at){if(Ke)return g();ae(at)})})}if(z&&z.isDirectory())return g(_.EISDIR(u));m.readFile(o,null,mr("r"),function(ke,$e){return ke?g(ke):m.writeFile(u,$e,null,mr("w"),N.mode,function(Ke){return Ke?g(Ke):m.unlink(o,g)})})})})}},s.prototype.renameSync=function(o,u){var g=this;if(this.checkInitialized(),this.checkPath(o),this.checkPath(u),o===Mr||u===Mr)throw _.EPERM("Cannot rename deletion log.");var m=this.statSync(o,!1);if(m.isDirectory()){if(o===u)return;var k=511;if(this.existsSync(u)){var N=this.statSync(u,!1);if(k=N.mode,N.isDirectory()){if(this.readdirSync(u).length>0)throw _.ENOTEMPTY(u)}else throw _.ENOTDIR(u)}this._writable.existsSync(o)?this._writable.renameSync(o,u):this._writable.existsSync(u)||this._writable.mkdirSync(u,k),this._readable.existsSync(o)&&this._readable.readdirSync(o).forEach(function(F){g.renameSync(v.resolve(o,F),v.resolve(u,F))})}else{if(this.existsSync(u)&&this.statSync(u,!1).isDirectory())throw _.EISDIR(u);this.writeFileSync(u,this.readFileSync(o,null,mr("r")),null,mr("w"),m.mode)}o!==u&&this.existsSync(o)&&this.unlinkSync(o)},s.prototype.stat=function(o,u,g){var m=this;this.checkInitAsync(g)&&this._writable.stat(o,u,function(k,N){k&&k.errno===h.ENOENT?(m._deletedFiles[o]&&g(_.ENOENT(o)),m._readable.stat(o,u,function(F,z){z&&(z=z.clone(),z.mode=Qa(z.mode)),g(F,z)})):g(k,N)})},s.prototype.statSync=function(o,u){this.checkInitialized();try{return this._writable.statSync(o,u)}catch{if(this._deletedFiles[o])throw _.ENOENT(o);var g=this._readable.statSync(o,u).clone();return g.mode=Qa(g.mode),g}},s.prototype.open=function(o,u,g,m){var k=this;!this.checkInitAsync(m)||this.checkPathAsync(o,m)||this.stat(o,!1,function(N,F){if(F)switch(u.pathExistsAction()){case C.TRUNCATE_FILE:return k.createParentDirectoriesAsync(o,function(z){if(z)return m(z);k._writable.open(o,u,g,m)});case C.NOP:return k._writable.exists(o,function(z){z?k._writable.open(o,u,g,m):(F=F.clone(),F.mode=g,k._readable.readFile(o,null,mr("r"),function(G,ae){if(G)return m(G);F.size===-1&&(F.size=ae.length);var we=new el(k,o,u,F,ae);m(null,we)}))});default:return m(_.EEXIST(o))}else switch(u.pathNotExistsAction()){case C.CREATE_FILE:return k.createParentDirectoriesAsync(o,function(z){return z?m(z):k._writable.open(o,u,g,m)});default:return m(_.ENOENT(o))}})},s.prototype.openSync=function(o,u,g){if(this.checkInitialized(),this.checkPath(o),o===Mr)throw _.EPERM("Cannot open deletion log.");if(this.existsSync(o))switch(u.pathExistsAction()){case C.TRUNCATE_FILE:return this.createParentDirectories(o),this._writable.openSync(o,u,g);case C.NOP:if(this._writable.existsSync(o))return this._writable.openSync(o,u,g);var m=this._readable.readFileSync(o,null,mr("r")),k=this._readable.statSync(o,!1).clone();return k.mode=g,new el(this,o,u,k,m);default:throw _.EEXIST(o)}else switch(u.pathNotExistsAction()){case C.CREATE_FILE:return this.createParentDirectories(o),this._writable.openSync(o,u,g);default:throw _.ENOENT(o)}},s.prototype.unlink=function(o,u){var g=this;!this.checkInitAsync(u)||this.checkPathAsync(o,u)||this.exists(o,function(m){if(!m)return u(_.ENOENT(o));g._writable.exists(o,function(k){if(k)return g._writable.unlink(o,function(N){if(N)return u(N);g.exists(o,function(F){F&&g.deletePath(o),u(null)})});g.deletePath(o),u(null)})})},s.prototype.unlinkSync=function(o){if(this.checkInitialized(),this.checkPath(o),this.existsSync(o))this._writable.existsSync(o)&&this._writable.unlinkSync(o),this.existsSync(o)&&this.deletePath(o);else throw _.ENOENT(o)},s.prototype.rmdir=function(o,u){var g=this;if(this.checkInitAsync(u)){var m=function(){g.readdir(o,function(k,N){if(k)return u(k);if(N.length)return u(_.ENOTEMPTY(o));g.deletePath(o),u(null)})};this.exists(o,function(k){if(!k)return u(_.ENOENT(o));g._writable.exists(o,function(N){N?g._writable.rmdir(o,function(F){if(F)return u(F);g._readable.exists(o,function(z){z?m():u()})}):m()})})}},s.prototype.rmdirSync=function(o){if(this.checkInitialized(),this.existsSync(o)){if(this._writable.existsSync(o)&&this._writable.rmdirSync(o),this.existsSync(o)){if(this.readdirSync(o).length>0)throw _.ENOTEMPTY(o);this.deletePath(o)}}else throw _.ENOENT(o)},s.prototype.mkdir=function(o,u,g){var m=this;this.checkInitAsync(g)&&this.exists(o,function(k){if(k)return g(_.EEXIST(o));m.createParentDirectoriesAsync(o,function(N){if(N)return g(N);m._writable.mkdir(o,u,g)})})},s.prototype.mkdirSync=function(o,u){if(this.checkInitialized(),this.existsSync(o))throw _.EEXIST(o);this.createParentDirectories(o),this._writable.mkdirSync(o,u)},s.prototype.readdir=function(o,u){var g=this;this.checkInitAsync(u)&&this.stat(o,!1,function(m,k){if(m)return u(m);if(!k.isDirectory())return u(_.ENOTDIR(o));g._writable.readdir(o,function(N,F){if(N&&N.code!=="ENOENT")return u(N);(N||!F)&&(F=[]),g._readable.readdir(o,function(z,G){(z||!G)&&(G=[]);var ae={},we=F.concat(G.filter(function(ke){return!g._deletedFiles[o+"/"+ke]})).filter(function(ke){var $e=!ae[ke];return ae[ke]=!0,$e});u(null,we)})})})},s.prototype.readdirSync=function(o){var u=this;this.checkInitialized();var g=this.statSync(o,!1);if(!g.isDirectory())throw _.ENOTDIR(o);var m=[];try{m=m.concat(this._writable.readdirSync(o))}catch{}try{m=m.concat(this._readable.readdirSync(o).filter(function(N){return!u._deletedFiles[o+"/"+N]}))}catch{}var k={};return m.filter(function(N){var F=!k[N];return k[N]=!0,F})},s.prototype.exists=function(o,u){var g=this;this.checkInitialized(),this._writable.exists(o,function(m){if(m)return u(!0);g._readable.exists(o,function(k){u(k&&g._deletedFiles[o]!==!0)})})},s.prototype.existsSync=function(o){return this.checkInitialized(),this._writable.existsSync(o)||this._readable.existsSync(o)&&this._deletedFiles[o]!==!0},s.prototype.chmod=function(o,u,g,m){var k=this;this.checkInitAsync(m)&&this.operateOnWritableAsync(o,function(N){if(N)return m(N);k._writable.chmod(o,u,g,m)})},s.prototype.chmodSync=function(o,u,g){var m=this;this.checkInitialized(),this.operateOnWritable(o,function(){m._writable.chmodSync(o,u,g)})},s.prototype.chown=function(o,u,g,m,k){var N=this;this.checkInitAsync(k)&&this.operateOnWritableAsync(o,function(F){if(F)return k(F);N._writable.chown(o,u,g,m,k)})},s.prototype.chownSync=function(o,u,g,m){var k=this;this.checkInitialized(),this.operateOnWritable(o,function(){k._writable.chownSync(o,u,g,m)})},s.prototype.utimes=function(o,u,g,m){var k=this;this.checkInitAsync(m)&&this.operateOnWritableAsync(o,function(N){if(N)return m(N);k._writable.utimes(o,u,g,m)})},s.prototype.utimesSync=function(o,u,g){var m=this;this.checkInitialized(),this.operateOnWritable(o,function(){m._writable.utimesSync(o,u,g)})},s.prototype.deletePath=function(o){this._deletedFiles[o]=!0,this.updateLog("d"+o+`
`)},s.prototype.updateLog=function(o){var u=this;this._deleteLog+=o,this._deleteLogUpdatePending?this._deleteLogUpdateNeeded=!0:(this._deleteLogUpdatePending=!0,this._writable.writeFile(Mr,this._deleteLog,"utf8",I.getFileFlag("w"),420,function(g){u._deleteLogUpdatePending=!1,g?u._deleteLogError=g:u._deleteLogUpdateNeeded&&(u._deleteLogUpdateNeeded=!1,u.updateLog(""))}))},s.prototype._reparseDeletionLog=function(){var o=this;this._deletedFiles={},this._deleteLog.split(`
`).forEach(function(u){o._deletedFiles[u.slice(1)]=u.slice(0,1)==="d"})},s.prototype.checkInitialized=function(){if(this._isInitialized){if(this._deleteLogError!==null){var o=this._deleteLogError;throw this._deleteLogError=null,o}}else throw new _(h.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")},s.prototype.checkInitAsync=function(o){if(this._isInitialized){if(this._deleteLogError!==null){var u=this._deleteLogError;return this._deleteLogError=null,o(u),!1}}else return o(new _(h.EPERM,"OverlayFS is not initialized. Please initialize OverlayFS using its initialize() method before using it.")),!1;return!0},s.prototype.checkPath=function(o){if(o===Mr)throw _.EPERM(o)},s.prototype.checkPathAsync=function(o,u){return o===Mr?(u(_.EPERM(o)),!0):!1},s.prototype.createParentDirectoriesAsync=function(o,u){var g=v.dirname(o),m=[],k=this;this._writable.stat(g,!1,N);function N(z,G){z?(m.push(g),g=v.dirname(g),k._writable.stat(g,!1,N)):F()}function F(){if(!m.length)return u();var z=m.pop();k._readable.stat(z,!1,function(G,ae){if(!ae)return u();k._writable.mkdir(z,ae.mode,function(we){if(we)return u(we);F()})})}},s.prototype.createParentDirectories=function(o){for(var u=this,g=v.dirname(o),m=[];!this._writable.existsSync(g);)m.push(g),g=v.dirname(g);m=m.reverse(),m.forEach(function(k){u._writable.mkdirSync(k,u.statSync(k,!1).mode)})},s.prototype.operateOnWritable=function(o,u){if(this.existsSync(o))this._writable.existsSync(o)||this.copyToWritable(o),u();else throw _.ENOENT(o)},s.prototype.operateOnWritableAsync=function(o,u){var g=this;this.exists(o,function(m){if(!m)return u(_.ENOENT(o));g._writable.exists(o,function(k){if(k)u();else return g.copyToWritableAsync(o,u)})})},s.prototype.copyToWritable=function(o){var u=this.statSync(o,!1);u.isDirectory()?this._writable.mkdirSync(o,u.mode):this.writeFileSync(o,this._readable.readFileSync(o,null,mr("r")),null,mr("w"),this.statSync(o,!1).mode)},s.prototype.copyToWritableAsync=function(o,u){var g=this;this.stat(o,!1,function(m,k){if(m)return u(m);if(k.isDirectory())return g._writable.mkdir(o,k.mode,u);g._readable.readFile(o,null,mr("r"),function(N,F){if(N)return u(N);g.writeFile(o,F,null,mr("w"),k.mode,u)})})},s}(ve),Nn=function(f){function s(l,o,u){u===void 0&&(u=!0),f.call(this,new tl(l,o)),Z(u,s.Name,{readable:"readable file system",writable:"writable file system"})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){try{var g=new s(o.writable,o.readable,!1);g.initialize(function(m){u(m,g)},!1)}catch(m){u(m)}},s.isAvailable=function(){return tl.isAvailable()},s.prototype.initialize=function(o,u){u===void 0&&(u=!0),u&&console.warn("[OverlayFS] OverlayFS.initialize() is deprecated and will be removed in the next major release. Please use 'OverlayFS.Create({readable: readable file system instance, writable: writable file system instance}, cb)' to create and initialize OverlayFS instances."),f.prototype.initialize.call(this,o)},s.prototype.getOverlayedFileSystems=function(){return f.prototype.getFSUnlocked.call(this).getOverlayedFileSystems()},s.prototype.unwrap=function(){return f.prototype.getFSUnlocked.call(this)},s}(et);Nn.Name="OverlayFS",Nn.Options={writable:{type:"object",description:"The file system to write modified files to."},readable:{type:"object",description:"The file system that initially populates this file system."}};var Dt;(function(f){f[f.CB=0]="CB",f[f.FD=1]="FD",f[f.API_ERROR=2]="API_ERROR",f[f.STATS=3]="STATS",f[f.PROBE=4]="PROBE",f[f.FILEFLAG=5]="FILEFLAG",f[f.BUFFER=6]="BUFFER",f[f.ERROR=7]="ERROR"})(Dt||(Dt={}));var Oo=function(){this._callbacks={},this._nextId=0};Oo.prototype.toRemoteArg=function(s){var l=this._nextId++;return this._callbacks[l]=s,{type:Dt.CB,id:l}},Oo.prototype.toLocalArg=function(s){var l=this._callbacks[s];return delete this._callbacks[s],l};var ds=function(){this._fileDescriptors={},this._nextId=0};ds.prototype.toRemoteArg=function(s,l,o,u){var g=this._nextId++,m,k;this._fileDescriptors[g]=s,s.stat(function(N,F){N?u(N):(k=gi(F.toBuffer()),o.isReadable()?s.read(a.alloc(F.size),0,F.size,0,function(z,G,ae){z?u(z):(m=gi(ae),u(null,{type:Dt.FD,id:g,data:m,stat:k,path:l,flag:o.getFlagString()}))}):u(null,{type:Dt.FD,id:g,data:new ArrayBuffer(0),stat:k,path:l,flag:o.getFlagString()}))})},ds.prototype.applyFdAPIRequest=function(s,l){var o=this,u=s.args[0];this._applyFdChanges(u,function(g,m){g?l(g):m[s.method](function(k){s.method==="close"&&delete o._fileDescriptors[u.id],l(k)})})},ds.prototype._applyFdChanges=function(s,l){var o=this._fileDescriptors[s.id],u=yi(s.data),g=U.fromBuffer(yi(s.stat)),m=I.getFileFlag(s.flag);m.isWriteable()?o.write(u,0,u.length,m.isAppendable()?o.getPos():0,function(k){function N(){o.stat(function(F,z){F?l(F):z.mode!==g.mode?o.chmod(g.mode,function(G){l(G,o)}):l(F,o)})}k?l(k):m.isAppendable()?N():o.truncate(u.length,function(){N()})}):l(null,o)};function ps(f){return{type:Dt.API_ERROR,errorData:gi(f.writeToBuffer())}}function rl(f){return _.fromBuffer(yi(f.errorData))}function il(f){return{type:Dt.ERROR,name:f.name,message:f.message,stack:f.stack}}function nl(f){var s=$t[f.name];typeof s!="function"&&(s=Error);var l=new s(f.message);return l.stack=f.stack,l}function sl(f){return{type:Dt.STATS,statsData:gi(f.toBuffer())}}function ol(f){return U.fromBuffer(yi(f.statsData))}function al(f){return{type:Dt.FILEFLAG,flagStr:f.getFlagString()}}function ll(f){return I.getFileFlag(f.flagStr)}function gi(f){return ne(f)}function yi(f){return Me(f)}function cl(f){return{type:Dt.BUFFER,data:gi(f)}}function fl(f){return yi(f.data)}function Gf(f){return f&&typeof f=="object"&&f.hasOwnProperty("browserfsMessage")&&f.browserfsMessage}function Yf(f){return f&&typeof f=="object"&&f.hasOwnProperty("browserfsMessage")&&f.browserfsMessage}var ul=function(f){function s(l,o,u,g,m,k){f.call(this,l,o,u,g,k),this._remoteFdId=m}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.getRemoteFdId=function(){return this._remoteFdId},s.prototype.toRemoteArg=function(){return{type:Dt.FD,id:this._remoteFdId,data:gi(this.getBuffer()),stat:gi(this.getStats().toBuffer()),path:this.getPath(),flag:this.getFlag().getFlagString()}},s.prototype.sync=function(o){this._syncClose("sync",o)},s.prototype.close=function(o){this._syncClose("close",o)},s.prototype._syncClose=function(o,u){var g=this;this.isDirty()?this._fs.syncClose(o,this,function(m){m||g.resetDirty(),u(m)}):u()},s}(xt),hs=function(f){function s(l,o){var u=this;o===void 0&&(o=!0),f.call(this),this._callbackConverter=new Oo,this._isInitialized=!1,this._isReadOnly=!1,this._supportLinks=!1,this._supportProps=!1,this._worker=l,Z(o,s.Name,{worker:"Web Worker instance"}),this._worker.addEventListener("message",function(g){var m=g.data;if(Yf(m)){var k,N=m.args,F=new Array(N.length);for(k=0;k<F.length;k++)F[k]=u._argRemote2Local(N[k]);u._callbackConverter.toLocalArg(m.cbId).apply(null,F)}})}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){var g=new s(o.worker,!1);g.initialize(function(){u(null,g)})},s.isAvailable=function(){return typeof importScripts<"u"||typeof Worker<"u"},s.attachRemoteListener=function(o){var u=new ds;function g(k,N,F){switch(typeof k){case"object":k instanceof U?F(null,sl(k)):k instanceof _?F(null,ps(k)):k instanceof We?F(null,u.toRemoteArg(k,N[0],N[1],F)):k instanceof I?F(null,al(k)):k instanceof a?F(null,cl(k)):k instanceof Error?F(null,il(k)):F(null,k);break;default:F(null,k);break}}function m(k,N){if(!k)return k;switch(typeof k){case"object":if(typeof k.type=="number"){var F=k;switch(F.type){case Dt.CB:var z=k.id;return function(){var G=arguments,ae,we=new Array(arguments.length),ke,$e=arguments.length;function Ke(at){$e>0&&($e=-1,ke={browserfsMessage:!0,cbId:z,args:[ps(at)]},o.postMessage(ke))}for(ae=0;ae<arguments.length;ae++)(function(at,Pt){g(Pt,N,function(er,Br){we[at]=Br,er?Ke(er):--$e===0&&(ke={browserfsMessage:!0,cbId:z,args:we},o.postMessage(ke))})})(ae,G[ae]);arguments.length===0&&(ke={browserfsMessage:!0,cbId:z,args:we},o.postMessage(ke))};case Dt.API_ERROR:return rl(F);case Dt.STATS:return ol(F);case Dt.FILEFLAG:return ll(F);case Dt.BUFFER:return fl(F);case Dt.ERROR:return nl(F);default:return k}}else return k;default:return k}}o.addEventListener("message",function(k){var N=k.data;if(Gf(N)){var F=N.args,z=new Array(F.length);switch(N.method){case"close":case"sync":(function(){var we=F[1];u.applyFdAPIRequest(N,function(ke){var $e={browserfsMessage:!0,cbId:we.id,args:ke?[ps(ke)]:[]};o.postMessage($e)})})();break;case"probe":(function(){var we=fe.getRootFS(),ke=F[1],$e={type:Dt.PROBE,isReadOnly:we.isReadOnly(),supportsLinks:we.supportsLinks(),supportsProps:we.supportsProps()},Ke={browserfsMessage:!0,cbId:ke.id,args:[$e]};o.postMessage(Ke)})();break;default:for(var G=0;G<F.length;G++)z[G]=m(F[G],z);var ae=fe.getRootFS();ae[N.method].apply(ae,z);break}}})},s.prototype.getName=function(){return s.Name},s.prototype.initialize=function(o){var u=this;if(this._isInitialized)o();else{var g={browserfsMessage:!0,method:"probe",args:[this._argLocal2Remote(Y()),this._callbackConverter.toRemoteArg(function(m){u._isInitialized=!0,u._isReadOnly=m.isReadOnly,u._supportLinks=m.supportsLinks,u._supportProps=m.supportsProps,o()})]};this._worker.postMessage(g)}},s.prototype.isReadOnly=function(){return this._isReadOnly},s.prototype.supportsSynch=function(){return!1},s.prototype.supportsLinks=function(){return this._supportLinks},s.prototype.supportsProps=function(){return this._supportProps},s.prototype.rename=function(o,u,g){this._rpc("rename",arguments)},s.prototype.stat=function(o,u,g){this._rpc("stat",arguments)},s.prototype.open=function(o,u,g,m){this._rpc("open",arguments)},s.prototype.unlink=function(o,u){this._rpc("unlink",arguments)},s.prototype.rmdir=function(o,u){this._rpc("rmdir",arguments)},s.prototype.mkdir=function(o,u,g){this._rpc("mkdir",arguments)},s.prototype.readdir=function(o,u){this._rpc("readdir",arguments)},s.prototype.exists=function(o,u){this._rpc("exists",arguments)},s.prototype.realpath=function(o,u,g){this._rpc("realpath",arguments)},s.prototype.truncate=function(o,u,g){this._rpc("truncate",arguments)},s.prototype.readFile=function(o,u,g,m){this._rpc("readFile",arguments)},s.prototype.writeFile=function(o,u,g,m,k,N){this._rpc("writeFile",arguments)},s.prototype.appendFile=function(o,u,g,m,k,N){this._rpc("appendFile",arguments)},s.prototype.chmod=function(o,u,g,m){this._rpc("chmod",arguments)},s.prototype.chown=function(o,u,g,m,k){this._rpc("chown",arguments)},s.prototype.utimes=function(o,u,g,m){this._rpc("utimes",arguments)},s.prototype.link=function(o,u,g){this._rpc("link",arguments)},s.prototype.symlink=function(o,u,g,m){this._rpc("symlink",arguments)},s.prototype.readlink=function(o,u){this._rpc("readlink",arguments)},s.prototype.syncClose=function(o,u,g){this._worker.postMessage({browserfsMessage:!0,method:o,args:[u.toRemoteArg(),this._callbackConverter.toRemoteArg(g)]})},s.prototype._argRemote2Local=function(o){if(!o)return o;switch(typeof o){case"object":if(typeof o.type=="number"){var u=o;switch(u.type){case Dt.API_ERROR:return rl(u);case Dt.FD:var g=u;return new ul(this,g.path,I.getFileFlag(g.flag),U.fromBuffer(yi(g.stat)),g.id,yi(g.data));case Dt.STATS:return ol(u);case Dt.FILEFLAG:return ll(u);case Dt.BUFFER:return fl(u);case Dt.ERROR:return nl(u);default:return o}}else return o;default:return o}},s.prototype._rpc=function(o,u){for(var g=this,m=new Array(u.length),k=0;k<u.length;k++)m[k]=g._argLocal2Remote(u[k]);var N={browserfsMessage:!0,method:o,args:m};this._worker.postMessage(N)},s.prototype._argLocal2Remote=function(o){if(!o)return o;switch(typeof o){case"object":return o instanceof U?sl(o):o instanceof _?ps(o):o instanceof ul?o.toRemoteArg():o instanceof I?al(o):o instanceof a?cl(o):o instanceof Error?il(o):"Unknown argument";case"function":return this._callbackConverter.toRemoteArg(o);default:return o}},s}(ve);hs.Name="WorkerFS",hs.Options={worker:{type:"object",description:"The target worker that you want to connect to, or the current worker if in a worker context.",validator:function(f,s){f.postMessage?s():s(new _(h.EINVAL,"option must be a Web Worker instance."))}}};function Xf(f,s,l){var o=new XMLHttpRequest;o.open("GET",f,!0);var u=!0;switch(s){case"buffer":o.responseType="arraybuffer";break;case"json":try{o.responseType="json",u=o.responseType==="json"}catch{u=!1}break;default:return l(new _(h.EINVAL,"Invalid download type: "+s))}o.onreadystatechange=function(g){if(o.readyState===4)if(o.status===200)switch(s){case"buffer":return l(null,o.response?a.from(o.response):Y());case"json":return u?l(null,o.response):l(null,JSON.parse(o.responseText))}else return l(new _(o.status,"XHR error."))},o.send()}function Kf(f,s){var l=new XMLHttpRequest;l.open("GET",f,!1);var o=null,u=null;if(l.overrideMimeType("text/plain; charset=x-user-defined"),l.onreadystatechange=function(g){if(l.readyState===4)if(l.status===200)switch(s){case"buffer":var m=l.responseText;o=a.alloc(m.length);for(var k=0;k<m.length;k++)o[k]=m.charCodeAt(k);return;case"json":o=JSON.parse(l.responseText);return}else{u=new _(l.status,"XHR error.");return}},l.send(),u)throw u;return o}function Zf(f,s){var l=new XMLHttpRequest;switch(l.open("GET",f,!1),s){case"buffer":l.responseType="arraybuffer";break;case"json":break;default:throw new _(h.EINVAL,"Invalid download type: "+s)}var o,u;if(l.onreadystatechange=function(g){if(l.readyState===4)if(l.status===200)switch(s){case"buffer":o=a.from(l.response);break;case"json":o=JSON.parse(l.response);break}else u=new _(l.status,"XHR error.")},l.send(),u)throw u;return o}function dl(f,s,l){var o=new XMLHttpRequest;o.open("HEAD",s,f),o.onreadystatechange=function(u){if(o.readyState===4)if(o.status===200)try{return l(null,parseInt(o.getResponseHeader("Content-Length")||"-1",10))}catch{return l(new _(h.EIO,"XHR HEAD error: Could not read content-length."))}else return l(new _(o.status,"XHR HEAD error."))},o.send()}var pl=Xf,Qf=ze&&typeof Blob<"u"?Zf:Kf;function eu(f){var s=-1;return dl(!1,f,function(l,o){if(l)throw l;s=o}),s}function tu(f,s){dl(!0,f,s)}var Sr=function(){this._index={},this.addPath("/",new dr)};Sr.fromListing=function(s){var l=new Sr,o=new dr;l._index["/"]=o;for(var u=[["",s,o]];u.length>0;){var g=void 0,m=u.pop(),k=m[0],N=m[1],F=m[2];for(var z in N)if(N.hasOwnProperty(z)){var G=N[z],ae=k+"/"+z;G?(l._index[ae]=g=new dr,u.push([ae,G,g])):g=new Ui(new U(P.FILE,-1,365)),F&&(F._ls[z]=g)}}return l},Sr.prototype.fileIterator=function(s){var l=this;for(var o in l._index)if(l._index.hasOwnProperty(o))for(var u=l._index[o],g=u.getListing(),m=0,k=g;m<k.length;m+=1){var N=k[m],F=u.getItem(N);Ur(F)&&s(F.getData())}},Sr.prototype.addPath=function(s,l){if(!l)throw new Error("Inode must be specified");if(s[0]!=="/")throw new Error("Path must be absolute, got: "+s);if(this._index.hasOwnProperty(s))return this._index[s]===l;var o=this._split_path(s),u=o[0],g=o[1],m=this._index[u];return m===void 0&&s!=="/"&&(m=new dr,!this.addPath(u,m))||s!=="/"&&!m.addItem(g,l)?!1:(Zr(l)&&(this._index[s]=l),!0)},Sr.prototype.addPathFast=function(s,l){var o=s.lastIndexOf("/"),u=o===0?"/":s.substring(0,o),g=s.substring(o+1),m=this._index[u];return m===void 0&&(m=new dr,this.addPathFast(u,m)),m.addItem(g,l)?(l.isDir()&&(this._index[s]=l),!0):!1},Sr.prototype.removePath=function(s){var l=this,o=this._split_path(s),u=o[0],g=o[1],m=this._index[u];if(m===void 0)return null;var k=m.remItem(g);if(k===null)return null;if(Zr(k)){for(var N=k.getListing(),F=0,z=N;F<z.length;F+=1){var G=z[F];l.removePath(s+"/"+G)}s!=="/"&&delete this._index[s]}return k},Sr.prototype.ls=function(s){var l=this._index[s];return l===void 0?null:l.getListing()},Sr.prototype.getInode=function(s){var l=this._split_path(s),o=l[0],u=l[1],g=this._index[o];return g===void 0?null:o===s?g:g.getItem(u)},Sr.prototype._split_path=function(s){var l=v.dirname(s),o=s.substr(l.length+(l==="/"?0:1));return[l,o]};var Ui=function(s){this.data=s};Ui.prototype.isFile=function(){return!0},Ui.prototype.isDir=function(){return!1},Ui.prototype.getData=function(){return this.data},Ui.prototype.setData=function(s){this.data=s};var dr=function(s){s===void 0&&(s=null),this.data=s,this._ls={}};dr.prototype.isFile=function(){return!1},dr.prototype.isDir=function(){return!0},dr.prototype.getData=function(){return this.data},dr.prototype.getStats=function(){return new U(P.DIRECTORY,4096,365)},dr.prototype.getListing=function(){return Object.keys(this._ls)},dr.prototype.getItem=function(s){var l=this._ls[s];return l||null},dr.prototype.addItem=function(s,l){return s in this._ls?!1:(this._ls[s]=l,!0)},dr.prototype.remItem=function(s){var l=this._ls[s];return l===void 0?null:(delete this._ls[s],l)};function Ur(f){return!!f&&f.isFile()}function Zr(f){return!!f&&f.isDir()}function ru(f,s,l){try{l(null,f.toString(s))}catch(o){l(o)}}var gs=function(f){function s(l,o,u){o===void 0&&(o=""),u===void 0&&(u=!0),f.call(this),l||(l="index.json"),o.length>0&&o.charAt(o.length-1)!=="/"&&(o=o+"/"),this.prefixUrl=o;var g=null;if(typeof l=="string"){if(g=this._requestFileSync(l,"json"),!g)throw new Error("Unable to find listing at URL: ${listingUrlOrObj}")}else g=l;Z(u,s.Name,{index:typeof l=="string"?l:"file index as an object",baseUrl:o}),this._index=Sr.fromListing(g)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){o.index===void 0&&(o.index="index.json"),typeof o.index=="string"?s.FromURL(o.index,u,o.baseUrl,!1):u(null,new s(o.index,o.baseUrl,!1))},s.isAvailable=function(){return typeof XMLHttpRequest<"u"&&XMLHttpRequest!==null},s.FromURL=function(o,u,g,m){g===void 0&&(g=o.slice(0,o.lastIndexOf("/")+1)),m===void 0&&(m=!0),m&&console.warn(`[XmlHttpRequest] XmlHttpRequest.FromURL() is deprecated and will be removed in the next major release. Please use 'XmlHttpRequest.Create({ index: "`+o+'", baseUrl: "'+g+`" }, cb)' instead.`),pl(o,"json",function(k,N){k?u(k):u(null,new s(N,g,!1))})},s.prototype.empty=function(){this._index.fileIterator(function(o){o.fileData=null})},s.prototype.getName=function(){return s.Name},s.prototype.diskSpace=function(o,u){u(0,0)},s.prototype.isReadOnly=function(){return!0},s.prototype.supportsLinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!0},s.prototype.preloadFile=function(o,u){var g=this._index.getInode(o);if(Ur(g)){if(g===null)throw _.ENOENT(o);var m=g.getData();m.size=u.length,m.fileData=u}else throw _.EISDIR(o)},s.prototype.stat=function(o,u,g){var m=this._index.getInode(o);if(m===null)return g(_.ENOENT(o));var k;Ur(m)?(k=m.getData(),k.size<0?this._requestFileSizeAsync(o,function(N,F){if(N)return g(N);k.size=F,g(null,k.clone())}):g(null,k.clone())):Zr(m)?(k=m.getStats(),g(null,k)):g(_.FileError(h.EINVAL,o))},s.prototype.statSync=function(o,u){var g=this._index.getInode(o);if(g===null)throw _.ENOENT(o);var m;if(Ur(g))m=g.getData(),m.size<0&&(m.size=this._requestFileSizeSync(o));else if(Zr(g))m=g.getStats();else throw _.FileError(h.EINVAL,o);return m},s.prototype.open=function(o,u,g,m){if(u.isWriteable())return m(new _(h.EPERM,o));var k=this,N=this._index.getInode(o);if(N===null)return m(_.ENOENT(o));if(Ur(N)){var F=N.getData();switch(u.pathExistsAction()){case C.THROW_EXCEPTION:case C.TRUNCATE_FILE:return m(_.EEXIST(o));case C.NOP:if(F.fileData)return m(null,new Et(k,o,u,F.clone(),F.fileData));this._requestFileAsync(o,"buffer",function(z,G){return z?m(z):(F.size=G.length,F.fileData=G,m(null,new Et(k,o,u,F.clone(),G)))});break;default:return m(new _(h.EINVAL,"Invalid FileMode object."))}}else return m(_.EISDIR(o))},s.prototype.openSync=function(o,u,g){if(u.isWriteable())throw new _(h.EPERM,o);var m=this._index.getInode(o);if(m===null)throw _.ENOENT(o);if(Ur(m)){var k=m.getData();switch(u.pathExistsAction()){case C.THROW_EXCEPTION:case C.TRUNCATE_FILE:throw _.EEXIST(o);case C.NOP:if(k.fileData)return new Et(this,o,u,k.clone(),k.fileData);var N=this._requestFileSync(o,"buffer");return k.size=N.length,k.fileData=N,new Et(this,o,u,k.clone(),N);default:throw new _(h.EINVAL,"Invalid FileMode object.")}}else throw _.EISDIR(o)},s.prototype.readdir=function(o,u){try{u(null,this.readdirSync(o))}catch(g){u(g)}},s.prototype.readdirSync=function(o){var u=this._index.getInode(o);if(u===null)throw _.ENOENT(o);if(Zr(u))return u.getListing();throw _.ENOTDIR(o)},s.prototype.readFile=function(o,u,g,m){var k=m;this.open(o,g,420,function(N,F){if(N)return m(N);m=function(ae,we){F.close(function(ke){return ae||(ae=ke),k(ae,we)})};var z=F,G=z.getBuffer();u===null?m(N,Ge(G)):ru(G,u,m)})},s.prototype.readFileSync=function(o,u,g){var m=this.openSync(o,g,420);try{var k=m,N=k.getBuffer();return u===null?Ge(N):N.toString(u)}finally{m.closeSync()}},s.prototype.getXhrPath=function(o){return o.charAt(0)==="/"&&(o=o.slice(1)),this.prefixUrl+o},s.prototype._requestFileAsync=function(o,u,g){pl(this.getXhrPath(o),u,g)},s.prototype._requestFileSync=function(o,u){return Qf(this.getXhrPath(o),u)},s.prototype._requestFileSizeAsync=function(o,u){tu(this.getXhrPath(o),u)},s.prototype._requestFileSizeSync=function(o){return eu(this.getXhrPath(o))},s}(ve);gs.Name="XmlHttpRequest",gs.Options={index:{type:["string","object"],optional:!0,description:"URL to a file index as a JSON file or the file index object itself, generated with the make_xhrfs_index script. Defaults to `index.json`."},baseUrl:{type:"string",optional:!0,description:"Used as the URL prefix for fetched files. Default: Fetch files relative to the index."}};var bi=function(){};bi.str2byte=function(s,l){for(var o=s.length>l.length?l.length:s.length,u=0;u<o;u++){var g=s.charCodeAt(u);if(g>127){var m=bi.extendedChars.indexOf(s.charAt(u));m>-1&&(g=m+128)}l[g]=u}return o},bi.byte2str=function(s){for(var l=new Array(s.length),o=0;o<s.length;o++){var u=s[o];u>127?l[o]=bi.extendedChars[u-128]:l[o]=String.fromCharCode(u)}return l.join("")},bi.byteLength=function(s){return s.length},bi.extendedChars=["\xC7","\xFC","\xE9","\xE2","\xE4","\xE0","\xE5","\xE7","\xEA","\xEB","\xE8","\xEF","\xEE","\xEC","\xC4","\xC5","\xC9","\xE6","\xC6","\xF4","\xF6","\xF2","\xFB","\xF9","\xFF","\xD6","\xDC","\xF8","\xA3","\xD8","\xD7","\u0192","\xE1","\xED","\xF3","\xFA","\xF1","\xD1","\xAA","\xBA","\xBF","\xAE","\xAC","\xBD","\xBC","\xA1","\xAB","\xBB","_","_","_","\xA6","\xA6","\xC1","\xC2","\xC0","\xA9","\xA6","\xA6","+","+","\xA2","\xA5","+","+","-","-","+","-","+","\xE3","\xC3","+","+","-","-","\xA6","-","+","\xA4","\xF0","\xD0","\xCA","\xCB","\xC8","i","\xCD","\xCE","\xCF","+","+","_","_","\xA6","\xCC","_","\xD3","\xDF","\xD4","\xD2","\xF5","\xD5","\xB5","\xFE","\xDE","\xDA","\xDB","\xD9","\xFD","\xDD","\xAF","\xB4","\xAD","\xB1","_","\xBE","\xB6","\xA7","\xF7","\xB8","\xB0","\xA8","\xB7","\xB9","\xB3","\xB2","_"," "];var iu=n(31).inflateRaw,hl={},gl;(function(f){f[f.MSDOS=0]="MSDOS",f[f.AMIGA=1]="AMIGA",f[f.OPENVMS=2]="OPENVMS",f[f.UNIX=3]="UNIX",f[f.VM_CMS=4]="VM_CMS",f[f.ATARI_ST=5]="ATARI_ST",f[f.OS2_HPFS=6]="OS2_HPFS",f[f.MAC=7]="MAC",f[f.Z_SYSTEM=8]="Z_SYSTEM",f[f.CP_M=9]="CP_M",f[f.NTFS=10]="NTFS",f[f.MVS=11]="MVS",f[f.VSE=12]="VSE",f[f.ACORN_RISC=13]="ACORN_RISC",f[f.VFAT=14]="VFAT",f[f.ALT_MVS=15]="ALT_MVS",f[f.BEOS=16]="BEOS",f[f.TANDEM=17]="TANDEM",f[f.OS_400=18]="OS_400",f[f.OSX=19]="OSX"})(gl||(gl={}));var zi;(function(f){f[f.STORED=0]="STORED",f[f.SHRUNK=1]="SHRUNK",f[f.REDUCED_1=2]="REDUCED_1",f[f.REDUCED_2=3]="REDUCED_2",f[f.REDUCED_3=4]="REDUCED_3",f[f.REDUCED_4=5]="REDUCED_4",f[f.IMPLODE=6]="IMPLODE",f[f.DEFLATE=8]="DEFLATE",f[f.DEFLATE64=9]="DEFLATE64",f[f.TERSE_OLD=10]="TERSE_OLD",f[f.BZIP2=12]="BZIP2",f[f.LZMA=14]="LZMA",f[f.TERSE_NEW=18]="TERSE_NEW",f[f.LZ77=19]="LZ77",f[f.WAVPACK=97]="WAVPACK",f[f.PPMD=98]="PPMD"})(zi||(zi={}));function yl(f,s){var l=s&31,o=(s>>5&15)-1,u=(s>>9)+1980,g=f&31,m=f>>5&63,k=f>>11;return new Date(u,o,l,k,m,g)}function ys(f,s,l,o){return o===0?"":s?f.toString("utf8",l,l+o):bi.byte2str(f.slice(l,l+o))}var _r=function(s){if(this.data=s,s.readUInt32LE(0)!==67324752)throw new _(h.EINVAL,"Invalid Zip file: Local file header has invalid signature: "+this.data.readUInt32LE(0))};_r.prototype.versionNeeded=function(){return this.data.readUInt16LE(4)},_r.prototype.flags=function(){return this.data.readUInt16LE(6)},_r.prototype.compressionMethod=function(){return this.data.readUInt16LE(8)},_r.prototype.lastModFileTime=function(){return yl(this.data.readUInt16LE(10),this.data.readUInt16LE(12))},_r.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(10)},_r.prototype.crc32=function(){return this.data.readUInt32LE(14)},_r.prototype.fileNameLength=function(){return this.data.readUInt16LE(26)},_r.prototype.extraFieldLength=function(){return this.data.readUInt16LE(28)},_r.prototype.fileName=function(){return ys(this.data,this.useUTF8(),30,this.fileNameLength())},_r.prototype.extraField=function(){var s=30+this.fileNameLength();return this.data.slice(s,s+this.extraFieldLength())},_r.prototype.totalSize=function(){return 30+this.fileNameLength()+this.extraFieldLength()},_r.prototype.useUTF8=function(){return(this.flags()&2048)===2048};var Tn=function(s,l,o){this.header=s,this.record=l,this.data=o};Tn.prototype.decompress=function(){var s=this.header.compressionMethod(),l=hl[s];if(l)return l(this.data,this.record.compressedSize(),this.record.uncompressedSize(),this.record.flag());var o=zi[s];throw o||(o="Unknown: "+s),new _(h.EINVAL,"Invalid compression method on file '"+this.header.fileName()+"': "+o)},Tn.prototype.getHeader=function(){return this.header},Tn.prototype.getRecord=function(){return this.record},Tn.prototype.getRawData=function(){return this.data};var Ao=function(s){this.data=s};Ao.prototype.crc32=function(){return this.data.readUInt32LE(0)},Ao.prototype.compressedSize=function(){return this.data.readUInt32LE(4)},Ao.prototype.uncompressedSize=function(){return this.data.readUInt32LE(8)};var bl=function(s){if(this.data=s,this.data.readUInt32LE(0)!==134630224)throw new _(h.EINVAL,"Invalid archive extra data record signature: "+this.data.readUInt32LE(0))};bl.prototype.length=function(){return this.data.readUInt32LE(4)},bl.prototype.extraFieldData=function(){return this.data.slice(8,8+this.length())};var ml=function(s){if(this.data=s,this.data.readUInt32LE(0)!==84233040)throw new _(h.EINVAL,"Invalid digital signature signature: "+this.data.readUInt32LE(0))};ml.prototype.size=function(){return this.data.readUInt16LE(4)},ml.prototype.signatureData=function(){return this.data.slice(6,6+this.size())};var bt=function(s,l){if(this.zipData=s,this.data=l,this.data.readUInt32LE(0)!==33639248)throw new _(h.EINVAL,"Invalid Zip file: Central directory record has invalid signature: "+this.data.readUInt32LE(0));this._filename=this.produceFilename()};bt.prototype.versionMadeBy=function(){return this.data.readUInt16LE(4)},bt.prototype.versionNeeded=function(){return this.data.readUInt16LE(6)},bt.prototype.flag=function(){return this.data.readUInt16LE(8)},bt.prototype.compressionMethod=function(){return this.data.readUInt16LE(10)},bt.prototype.lastModFileTime=function(){return yl(this.data.readUInt16LE(12),this.data.readUInt16LE(14))},bt.prototype.rawLastModFileTime=function(){return this.data.readUInt32LE(12)},bt.prototype.crc32=function(){return this.data.readUInt32LE(16)},bt.prototype.compressedSize=function(){return this.data.readUInt32LE(20)},bt.prototype.uncompressedSize=function(){return this.data.readUInt32LE(24)},bt.prototype.fileNameLength=function(){return this.data.readUInt16LE(28)},bt.prototype.extraFieldLength=function(){return this.data.readUInt16LE(30)},bt.prototype.fileCommentLength=function(){return this.data.readUInt16LE(32)},bt.prototype.diskNumberStart=function(){return this.data.readUInt16LE(34)},bt.prototype.internalAttributes=function(){return this.data.readUInt16LE(36)},bt.prototype.externalAttributes=function(){return this.data.readUInt32LE(38)},bt.prototype.headerRelativeOffset=function(){return this.data.readUInt32LE(42)},bt.prototype.produceFilename=function(){var s=ys(this.data,this.useUTF8(),46,this.fileNameLength());return s.replace(/\\/g,"/")},bt.prototype.fileName=function(){return this._filename},bt.prototype.rawFileName=function(){return this.data.slice(46,46+this.fileNameLength())},bt.prototype.extraField=function(){var s=44+this.fileNameLength();return this.data.slice(s,s+this.extraFieldLength())},bt.prototype.fileComment=function(){var s=46+this.fileNameLength()+this.extraFieldLength();return ys(this.data,this.useUTF8(),s,this.fileCommentLength())},bt.prototype.rawFileComment=function(){var s=46+this.fileNameLength()+this.extraFieldLength();return this.data.slice(s,s+this.fileCommentLength())},bt.prototype.totalSize=function(){return 46+this.fileNameLength()+this.extraFieldLength()+this.fileCommentLength()},bt.prototype.isDirectory=function(){var s=this.fileName();return!!(this.externalAttributes()&16)||s.charAt(s.length-1)==="/"},bt.prototype.isFile=function(){return!this.isDirectory()},bt.prototype.useUTF8=function(){return(this.flag()&2048)===2048},bt.prototype.isEncrypted=function(){return(this.flag()&1)===1},bt.prototype.getFileData=function(){var s=this.headerRelativeOffset(),l=new _r(this.zipData.slice(s));return new Tn(l,this,this.zipData.slice(s+l.totalSize()))},bt.prototype.getData=function(){return this.getFileData().decompress()},bt.prototype.getRawData=function(){return this.getFileData().getRawData()},bt.prototype.getStats=function(){return new U(P.FILE,this.uncompressedSize(),365,new Date,this.lastModFileTime())};var Ir=function(s){if(this.data=s,this.data.readUInt32LE(0)!==101010256)throw new _(h.EINVAL,"Invalid Zip file: End of central directory record has invalid signature: "+this.data.readUInt32LE(0))};Ir.prototype.diskNumber=function(){return this.data.readUInt16LE(4)},Ir.prototype.cdDiskNumber=function(){return this.data.readUInt16LE(6)},Ir.prototype.cdDiskEntryCount=function(){return this.data.readUInt16LE(8)},Ir.prototype.cdTotalEntryCount=function(){return this.data.readUInt16LE(10)},Ir.prototype.cdSize=function(){return this.data.readUInt32LE(12)},Ir.prototype.cdOffset=function(){return this.data.readUInt32LE(16)},Ir.prototype.cdZipCommentLength=function(){return this.data.readUInt16LE(20)},Ir.prototype.cdZipComment=function(){return ys(this.data,!0,22,this.cdZipCommentLength())},Ir.prototype.rawCdZipComment=function(){return this.data.slice(22,22+this.cdZipCommentLength())};var _l=function(s,l,o,u){this.index=s,this.directoryEntries=l,this.eocd=o,this.data=u},mi=function(f){function s(l,o,u){o===void 0&&(o=""),u===void 0&&(u=!0),f.call(this),this.name=o,this._index=new Sr,this._directoryEntries=[],this._eocd=null,Z(u,s.Name,{zipData:"zip data as a Buffer",name:o}),l instanceof _l?(this._index=l.index,this._directoryEntries=l.directoryEntries,this._eocd=l.eocd,this.data=l.data):(this.data=l,this.populateIndex())}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){try{s.computeIndex(o.zipData,function(g){var m=new s(g,o.name,!1);u(null,m)},!1)}catch(g){u(g)}},s.isAvailable=function(){return!0},s.RegisterDecompressionMethod=function(o,u){hl[o]=u},s.computeIndex=function(o,u,g){g===void 0&&(g=!0),g&&console.warn("[ZipFS] ZipFS.computeIndex is now deprecated, and will be removed in the next major release. Please update your code to use 'ZipFS.Create({ zipData: zip file as a Buffer}, cb)' instead.");var m=new Sr,k=s.getEOCD(o);if(k.diskNumber()!==k.cdDiskNumber())throw new _(h.EINVAL,"ZipFS does not support spanned zip files.");var N=k.cdOffset();if(N===4294967295)throw new _(h.EINVAL,"ZipFS does not support Zip64.");var F=N+k.cdSize();s.computeIndexResponsive(o,m,N,F,u,[],k)},s.getEOCD=function(o){for(var u=22,g=Math.min(u+65535,o.length-1),m=u;m<g;m++)if(o.readUInt32LE(o.length-m)===101010256)return new Ir(o.slice(o.length-m));throw new _(h.EINVAL,"Invalid ZIP file: Could not locate End of Central Directory signature.")},s.addToIndex=function(o,u){var g=o.fileName();if(g.charAt(0)==="/")throw new Error("WHY IS THIS ABSOLUTE");g.charAt(g.length-1)==="/"&&(g=g.substr(0,g.length-1)),o.isDirectory()?u.addPathFast("/"+g,new dr(o)):u.addPathFast("/"+g,new Ui(o))},s.computeIndexResponsive=function(o,u,g,m,k,N,F){if(g<m){for(var z=0;z++<200&&g<m;){var G=new bt(o,o.slice(g));s.addToIndex(G,u),g+=G.totalSize(),N.push(G)}Eo(function(){s.computeIndexResponsive(o,u,g,m,k,N,F)})}else k(new _l(u,N,F,o))},s.prototype.getName=function(){return s.Name+(this.name!==""?" "+this.name:"")},s.prototype.getCentralDirectoryEntry=function(o){var u=this._index.getInode(o);if(u===null)throw _.ENOENT(o);if(Ur(u))return u.getData();if(Zr(u))return u.getData();throw _.EPERM("Invalid inode: "+u)},s.prototype.getCentralDirectoryEntryAt=function(o){var u=this._directoryEntries[o];if(!u)throw new RangeError("Invalid directory index: "+o+".");return u},s.prototype.getNumberOfCentralDirectoryEntries=function(){return this._directoryEntries.length},s.prototype.getEndOfCentralDirectory=function(){return this._eocd},s.prototype.diskSpace=function(o,u){u(this.data.length,0)},s.prototype.isReadOnly=function(){return!0},s.prototype.supportsLinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!0},s.prototype.statSync=function(o,u){var g=this._index.getInode(o);if(g===null)throw _.ENOENT(o);var m;if(Ur(g))m=g.getData().getStats();else if(Zr(g))m=g.getStats();else throw new _(h.EINVAL,"Invalid inode.");return m},s.prototype.openSync=function(o,u,g){if(u.isWriteable())throw new _(h.EPERM,o);var m=this._index.getInode(o);if(m)if(Ur(m)){var k=m.getData(),N=k.getStats();switch(u.pathExistsAction()){case C.THROW_EXCEPTION:case C.TRUNCATE_FILE:throw _.EEXIST(o);case C.NOP:return new Et(this,o,u,N,k.getData());default:throw new _(h.EINVAL,"Invalid FileMode object.")}}else throw _.EISDIR(o);else throw _.ENOENT(o)},s.prototype.readdirSync=function(o){var u=this._index.getInode(o);if(u){if(Zr(u))return u.getListing();throw _.ENOTDIR(o)}else throw _.ENOENT(o)},s.prototype.readFileSync=function(o,u,g){var m=this.openSync(o,g,420);try{var k=m,N=k.getBuffer();return u===null?Ge(N):N.toString(u)}finally{m.closeSync()}},s.prototype.populateIndex=function(){var o=this,u=this._eocd=s.getEOCD(this.data);if(u.diskNumber()!==u.cdDiskNumber())throw new _(h.EINVAL,"ZipFS does not support spanned zip files.");var g=u.cdOffset();if(g===4294967295)throw new _(h.EINVAL,"ZipFS does not support Zip64.");for(var m=g+u.cdSize();g<m;){var k=new bt(o.data,o.data.slice(g));g+=k.totalSize(),s.addToIndex(k,o._index),o._directoryEntries.push(k)}},s}(Ye);mi.Name="ZipFS",mi.Options={zipData:{type:"object",description:"The zip file as a Buffer object.",validator:Tt},name:{type:"string",optional:!0,description:"The name of the zip file (optional)."}},mi.CompressionMethod=zi,mi.RegisterDecompressionMethod(zi.DEFLATE,function(f,s,l){return He(iu(f.slice(0,s),{chunkSize:l}))}),mi.RegisterDecompressionMethod(zi.STORED,function(f,s,l){return Ge(f,0,l)});var nu="IEEE_P1282";function pr(f,s,l){return f.toString("ascii",s,s+l).trim()}function No(f,s,l){if(l===1)return String.fromCharCode(f[s]);for(var o=Math.floor(l/2),u=new Array(o),g=0;g<o;g++){var m=s+(g<<1);u[g]=String.fromCharCode(f[m+1]|f[m]<<8)}return u.join("")}function Fr(f,s){var l=parseInt(pr(f,s,4),10),o=parseInt(pr(f,s+4,2),10),u=parseInt(pr(f,s+6,2),10),g=parseInt(pr(f,s+8,2),10),m=parseInt(pr(f,s+10,2),10),k=parseInt(pr(f,s+12,2),10),N=parseInt(pr(f,s+14,2),10);return new Date(l,o,u,g,m,k,N*100)}function _i(f,s){var l=f[s],o=f[s+1],u=f[s+2],g=f[s+3],m=f[s+4],k=f[s+5];return new Date(l,o-1,u,g,m,k)}function su(f,s){var l=f.slice(s),o=new qt(l);switch(o.signatureWord()){case 17221:return new xl(l);case 20548:return new lu(l);case 21328:return new El(l);case 21332:return new Ol(l);case 17746:return new Al(l);case 17747:return new cu(l);case 20568:return new Tl(l);case 20558:return new fu(l);case 21324:return new To(l);case 20045:return new Il(l);case 17228:return new Io(l);case 20556:return new uu(l);case 21061:return new Fl(l);case 21574:return new Bl(l);case 21318:return new du(l);case 21074:return new Nl(l);default:return o}}function vl(f,s,l,o){l=l-4;for(var u=new Array;s<l;){var g=su(f,s),m=g.length();if(m===0)return u;if(s+=m,g instanceof Ol)break;g instanceof xl?u=u.concat(g.getEntries(o)):u.push(g)}return u}var $i=function(s){this._data=s};$i.prototype.type=function(){return this._data[0]},$i.prototype.standardIdentifier=function(){return pr(this._data,1,5)},$i.prototype.version=function(){return this._data[6]},$i.prototype.data=function(){return this._data.slice(7,2048)};var wl=function(f){function s(l){f.call(this,l),this._root=null}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.systemIdentifier=function(){return this._getString32(8)},s.prototype.volumeIdentifier=function(){return this._getString32(40)},s.prototype.volumeSpaceSize=function(){return this._data.readUInt32LE(80)},s.prototype.volumeSetSize=function(){return this._data.readUInt16LE(120)},s.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(124)},s.prototype.logicalBlockSize=function(){return this._data.readUInt16LE(128)},s.prototype.pathTableSize=function(){return this._data.readUInt32LE(132)},s.prototype.locationOfTypeLPathTable=function(){return this._data.readUInt32LE(140)},s.prototype.locationOfOptionalTypeLPathTable=function(){return this._data.readUInt32LE(144)},s.prototype.locationOfTypeMPathTable=function(){return this._data.readUInt32BE(148)},s.prototype.locationOfOptionalTypeMPathTable=function(){return this._data.readUInt32BE(152)},s.prototype.rootDirectoryEntry=function(o){return this._root===null&&(this._root=this._constructRootDirectoryRecord(this._data.slice(156)),this._root.rootCheckForRockRidge(o)),this._root},s.prototype.volumeSetIdentifier=function(){return this._getString(190,128)},s.prototype.publisherIdentifier=function(){return this._getString(318,128)},s.prototype.dataPreparerIdentifier=function(){return this._getString(446,128)},s.prototype.applicationIdentifier=function(){return this._getString(574,128)},s.prototype.copyrightFileIdentifier=function(){return this._getString(702,38)},s.prototype.abstractFileIdentifier=function(){return this._getString(740,36)},s.prototype.bibliographicFileIdentifier=function(){return this._getString(776,37)},s.prototype.volumeCreationDate=function(){return Fr(this._data,813)},s.prototype.volumeModificationDate=function(){return Fr(this._data,830)},s.prototype.volumeExpirationDate=function(){return Fr(this._data,847)},s.prototype.volumeEffectiveDate=function(){return Fr(this._data,864)},s.prototype.fileStructureVersion=function(){return this._data[881]},s.prototype.applicationUsed=function(){return this._data.slice(883,883+512)},s.prototype.reserved=function(){return this._data.slice(1395,1395+653)},s.prototype._getString32=function(o){return this._getString(o,32)},s}($i),ou=function(f){function s(l){if(f.call(this,l),this.type()!==1)throw new _(h.EIO,"Invalid primary volume descriptor.")}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.name=function(){return"ISO9660"},s.prototype._constructRootDirectoryRecord=function(o){return new Sl(o,-1)},s.prototype._getString=function(o,u){return this._getString(o,u)},s}(wl),au=function(f){function s(l){if(f.call(this,l),this.type()!==2)throw new _(h.EIO,"Invalid supplementary volume descriptor.");var o=this.escapeSequence(),u=o[2];if(o[0]!==37||o[1]!==47||u!==64&&u!==67&&u!==69)throw new _(h.EIO,"Unrecognized escape sequence for SupplementaryVolumeDescriptor: "+o.toString())}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.name=function(){return"Joliet"},s.prototype.escapeSequence=function(){return this._data.slice(88,120)},s.prototype._constructRootDirectoryRecord=function(o){return new kl(o,-1)},s.prototype._getString=function(o,u){return No(this._data,o,u)},s}(wl),Lt=function(s,l){this._suEntries=null,this._fileOrDir=null,this._data=s,this._rockRidgeOffset=l};Lt.prototype.hasRockRidge=function(){return this._rockRidgeOffset>-1},Lt.prototype.getRockRidgeOffset=function(){return this._rockRidgeOffset},Lt.prototype.rootCheckForRockRidge=function(s){var l=this.getDirectory(s);this._rockRidgeOffset=l.getDotEntry(s)._getRockRidgeOffset(s),this._rockRidgeOffset>-1&&(this._fileOrDir=null)},Lt.prototype.length=function(){return this._data[0]},Lt.prototype.extendedAttributeRecordLength=function(){return this._data[1]},Lt.prototype.lba=function(){return this._data.readUInt32LE(2)*2048},Lt.prototype.dataLength=function(){return this._data.readUInt32LE(10)},Lt.prototype.recordingDate=function(){return _i(this._data,18)},Lt.prototype.fileFlags=function(){return this._data[25]},Lt.prototype.fileUnitSize=function(){return this._data[26]},Lt.prototype.interleaveGapSize=function(){return this._data[27]},Lt.prototype.volumeSequenceNumber=function(){return this._data.readUInt16LE(28)},Lt.prototype.identifier=function(){return this._getString(33,this._data[32])},Lt.prototype.fileName=function(s){if(this.hasRockRidge()){var l=this._rockRidgeFilename(s);if(l!==null)return l}var o=this.identifier();if(this.isDirectory(s))return o;var u=o.indexOf(";");return u===-1?o:o[u-1]==="."?o.slice(0,u-1):o.slice(0,u)},Lt.prototype.isDirectory=function(s){var l=!!(this.fileFlags()&2);return!l&&this.hasRockRidge()&&(l=this.getSUEntries(s).filter(function(o){return o instanceof Io}).length>0),l},Lt.prototype.isSymlink=function(s){return this.hasRockRidge()&&this.getSUEntries(s).filter(function(l){return l instanceof To}).length>0},Lt.prototype.getSymlinkPath=function(s){for(var l="",o=this.getSUEntries(s),u=this._getGetString(),g=0,m=o;g<m.length;g+=1){var k=m[g];if(k instanceof To){for(var N=k.componentRecords(),F=0,z=N;F<z.length;F+=1){var G=z[F],ae=G.flags();ae&2?l+="./":ae&4?l+="../":ae&8?l+="/":(l+=G.content(u),ae&1||(l+="/"))}if(!k.continueFlag())break}}return l.length>1&&l[l.length-1]==="/"?l.slice(0,l.length-1):l},Lt.prototype.getFile=function(s){if(this.isDirectory(s))throw new Error("Tried to get a File from a directory.");return this._fileOrDir===null&&(this._fileOrDir=s.slice(this.lba(),this.lba()+this.dataLength())),this._fileOrDir},Lt.prototype.getDirectory=function(s){if(!this.isDirectory(s))throw new Error("Tried to get a Directory from a file.");return this._fileOrDir===null&&(this._fileOrDir=this._constructDirectory(s)),this._fileOrDir},Lt.prototype.getSUEntries=function(s){return this._suEntries||this._constructSUEntries(s),this._suEntries},Lt.prototype._rockRidgeFilename=function(s){var l=this.getSUEntries(s).filter(function(N){return N instanceof Il});if(l.length===0||l[0].flags()&6)return null;for(var o="",u=this._getGetString(),g=0,m=l;g<m.length;g+=1){var k=m[g];if(o+=k.name(u),!(k.flags()&1))break}return o},Lt.prototype._constructSUEntries=function(s){var l=33+this._data[32];l%2===1&&l++,l+=this._rockRidgeOffset,this._suEntries=vl(this._data,l,this.length(),s)},Lt.prototype._getRockRidgeOffset=function(s){this._rockRidgeOffset=0;var l=this.getSUEntries(s);if(l.length>0){var o=l[0];if(o instanceof El&&o.checkBytesPass())for(var u=1;u<l.length;u++){var g=l[u];if(g instanceof Nl||g instanceof Al&&g.extensionIdentifier()===nu)return o.bytesSkipped()}}return this._rockRidgeOffset=-1,-1};var Sl=function(f){function s(l,o){f.call(this,l,o)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype._getString=function(o,u){return pr(this._data,o,u)},s.prototype._constructDirectory=function(o){return new pu(this,o)},s.prototype._getGetString=function(){return pr},s}(Lt),kl=function(f){function s(l,o){f.call(this,l,o)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype._getString=function(o,u){return No(this._data,o,u)},s.prototype._constructDirectory=function(o){return new hu(this,o)},s.prototype._getGetString=function(){return No},s}(Lt),qt=function(s){this._data=s};qt.prototype.signatureWord=function(){return this._data.readUInt16BE(0)},qt.prototype.signatureWordString=function(){return pr(this._data,0,2)},qt.prototype.length=function(){return this._data[2]},qt.prototype.suVersion=function(){return this._data[3]};var xl=function(f){function s(l){f.call(this,l),this._entries=null}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.continuationLba=function(){return this._data.readUInt32LE(4)},s.prototype.continuationLbaOffset=function(){return this._data.readUInt32LE(12)},s.prototype.continuationLength=function(){return this._data.readUInt32LE(20)},s.prototype.getEntries=function(o){if(!this._entries){var u=this.continuationLba()*2048+this.continuationLbaOffset();this._entries=vl(o,u,this.continuationLength(),o)}return this._entries},s}(qt),lu=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s}(qt),El=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.checkBytesPass=function(){return this._data[4]===190&&this._data[5]===239},s.prototype.bytesSkipped=function(){return this._data[6]},s}(qt),Ol=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s}(qt),Al=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.identifierLength=function(){return this._data[4]},s.prototype.descriptorLength=function(){return this._data[5]},s.prototype.sourceLength=function(){return this._data[6]},s.prototype.extensionVersion=function(){return this._data[7]},s.prototype.extensionIdentifier=function(){return pr(this._data,8,this.identifierLength())},s.prototype.extensionDescriptor=function(){return pr(this._data,8+this.identifierLength(),this.descriptorLength())},s.prototype.extensionSource=function(){return pr(this._data,8+this.identifierLength()+this.descriptorLength(),this.sourceLength())},s}(qt),cu=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.extensionSequence=function(){return this._data[4]},s}(qt),Nl=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s}(qt),Tl=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.mode=function(){return this._data.readUInt32LE(4)},s.prototype.fileLinks=function(){return this._data.readUInt32LE(12)},s.prototype.uid=function(){return this._data.readUInt32LE(20)},s.prototype.gid=function(){return this._data.readUInt32LE(28)},s.prototype.inode=function(){return this._data.readUInt32LE(36)},s}(qt),fu=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.devTHigh=function(){return this._data.readUInt32LE(4)},s.prototype.devTLow=function(){return this._data.readUInt32LE(12)},s}(qt),To=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.flags=function(){return this._data[4]},s.prototype.continueFlag=function(){return this.flags()&1},s.prototype.componentRecords=function(){for(var o=this,u=new Array,g=5;g<this.length();){var m=new In(o._data.slice(g));u.push(m),g+=m.length()}return u},s}(qt),In=function(s){this._data=s};In.prototype.flags=function(){return this._data[0]},In.prototype.length=function(){return 2+this.componentLength()},In.prototype.componentLength=function(){return this._data[1]},In.prototype.content=function(s){return s(this._data,2,this.componentLength())};var Il=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.flags=function(){return this._data[4]},s.prototype.name=function(o){return o(this._data,5,this.length()-5)},s}(qt),Io=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.childDirectoryLba=function(){return this._data.readUInt32LE(4)},s}(qt),uu=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.parentDirectoryLba=function(){return this._data.readUInt32LE(4)},s}(qt),Fl=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s}(qt),Bl=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.flags=function(){return this._data[4]},s.prototype.creation=function(){return this.flags()&1?this._longFormDates()?Fr(this._data,5):_i(this._data,5):null},s.prototype.modify=function(){if(this.flags()&2){var o=this.flags()&1?1:0;return this._longFormDates?Fr(this._data,5+o*17):_i(this._data,5+o*7)}else return null},s.prototype.access=function(){if(this.flags()&4){var o=this.flags()&1?1:0;return o+=this.flags()&2?1:0,this._longFormDates?Fr(this._data,5+o*17):_i(this._data,5+o*7)}else return null},s.prototype.backup=function(){if(this.flags()&16){var o=this.flags()&1?1:0;return o+=this.flags()&2?1:0,o+=this.flags()&4?1:0,this._longFormDates?Fr(this._data,5+o*17):_i(this._data,5+o*7)}else return null},s.prototype.expiration=function(){if(this.flags()&32){var o=this.flags()&1?1:0;return o+=this.flags()&2?1:0,o+=this.flags()&4?1:0,o+=this.flags()&16?1:0,this._longFormDates?Fr(this._data,5+o*17):_i(this._data,5+o*7)}else return null},s.prototype.effective=function(){if(this.flags()&64){var o=this.flags()&1?1:0;return o+=this.flags()&2?1:0,o+=this.flags()&4?1:0,o+=this.flags()&16?1:0,o+=this.flags()&32?1:0,this._longFormDates?Fr(this._data,5+o*17):_i(this._data,5+o*7)}else return null},s.prototype._longFormDates=function(){return!!this.flags()},s}(qt),du=function(f){function s(l){f.call(this,l)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype.virtualSizeHigh=function(){return this._data.readUInt32LE(4)},s.prototype.virtualSizeLow=function(){return this._data.readUInt32LE(12)},s.prototype.tableDepth=function(){return this._data[20]},s}(qt),Fn=function(s,l){var o=this;this._fileList=[],this._fileMap={},this._record=s;var u=s.lba(),g=u+s.dataLength();if(!(s.fileFlags()&2)){var m=s.getSUEntries(l).filter(function(z){return z instanceof Io})[0];u=m.childDirectoryLba()*2048,g=1/0}for(;u<g;){var k=l[u];if(k===0){u++;continue}var N=o._constructDirectoryRecord(l.slice(u)),F=N.fileName(l);F!=="\0"&&F!==""?(!N.hasRockRidge()||N.getSUEntries(l).filter(function(z){return z instanceof Fl}).length===0)&&(o._fileMap[F]=N,o._fileList.push(F)):g===1/0&&(g=u+N.dataLength()),u+=N.length()}};Fn.prototype.getRecord=function(s){return this._fileMap[s]},Fn.prototype.getFileList=function(){return this._fileList},Fn.prototype.getDotEntry=function(s){return this._constructDirectoryRecord(s.slice(this._record.lba()))};var pu=function(f){function s(l,o){f.call(this,l,o)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype._constructDirectoryRecord=function(o){return new Sl(o,this._record.getRockRidgeOffset())},s}(Fn),hu=function(f){function s(l,o){f.call(this,l,o)}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.prototype._constructDirectoryRecord=function(o){return new kl(o,this._record.getRockRidgeOffset())},s}(Fn),bs=function(f){function s(l,o,u){var g=this;o===void 0&&(o=""),u===void 0&&(u=!0),f.call(this),this._data=l,Z(u,s.Name,{data:"ISO data as a Buffer",name:o});for(var m=!1,k=16*2048,N=new Array;!m;){var F=l.slice(k),z=new $i(F);switch(z.type()){case 1:N.push(new ou(F));break;case 2:N.push(new au(F));break;case 255:m=!0;break}k+=2048}if(N.length===0)throw new _(h.EIO,"Unable to find a suitable volume descriptor.");N.forEach(function(G){(!g._pvd||g._pvd.type()!==2)&&(g._pvd=G)}),this._root=this._pvd.rootDirectoryEntry(l),this._name=o}return f&&(s.__proto__=f),s.prototype=Object.create(f&&f.prototype),s.prototype.constructor=s,s.Create=function(o,u){var g,m;try{g=new s(o.data,o.name,!1)}catch(k){k=k}finally{u(m,g)}},s.isAvailable=function(){return!0},s.prototype.getName=function(){var o="IsoFS"+this._name+(this._pvd?"-"+this._pvd.name():"");return this._root&&this._root.hasRockRidge()&&(o+="-RockRidge"),o},s.prototype.diskSpace=function(o,u){u(this._data.length,0)},s.prototype.isReadOnly=function(){return!0},s.prototype.supportsLinks=function(){return!1},s.prototype.supportsProps=function(){return!1},s.prototype.supportsSynch=function(){return!0},s.prototype.statSync=function(o,u){var g=this._getDirectoryRecord(o);if(g===null)throw _.ENOENT(o);return this._getStats(o,g)},s.prototype.openSync=function(o,u,g){if(u.isWriteable())throw new _(h.EPERM,o);var m=this._getDirectoryRecord(o);if(m){if(m.isSymlink(this._data))return this.openSync(v.resolve(o,m.getSymlinkPath(this._data)),u,g);if(m.isDirectory(this._data))throw _.EISDIR(o);var k=m.getFile(this._data),N=this._getStats(o,m);switch(u.pathExistsAction()){case C.THROW_EXCEPTION:case C.TRUNCATE_FILE:throw _.EEXIST(o);case C.NOP:return new Et(this,o,u,N,k);default:throw new _(h.EINVAL,"Invalid FileMode object.")}}else throw _.ENOENT(o)},s.prototype.readdirSync=function(o){var u=this._getDirectoryRecord(o);if(u){if(u.isDirectory(this._data))return u.getDirectory(this._data).getFileList().slice(0);throw _.ENOTDIR(o)}else throw _.ENOENT(o)},s.prototype.readFileSync=function(o,u,g){var m=this.openSync(o,g,420);try{var k=m,N=k.getBuffer();return u===null?Ge(N):N.toString(u)}finally{m.closeSync()}},s.prototype._getDirectoryRecord=function(o){var u=this;if(o==="/")return this._root;for(var g=o.split("/").slice(1),m=this._root,k=0,N=g;k<N.length;k+=1){var F=N[k];if(m.isDirectory(u._data)){if(m=m.getDirectory(u._data).getRecord(F),!m)return null}else return null}return m},s.prototype._getStats=function(o,u){if(u.isSymlink(this._data)){var g=v.resolve(o,u.getSymlinkPath(this._data)),m=this._getDirectoryRecord(g);return m?this._getStats(g,m):null}else{var k=u.dataLength(),N=365,F=u.recordingDate(),z=F,G=F,ae=F;if(u.hasRockRidge())for(var we=u.getSUEntries(this._data),ke=0,$e=we;ke<$e.length;ke+=1){var Ke=$e[ke];if(Ke instanceof Tl)N=Ke.mode();else if(Ke instanceof Bl){var at=Ke.flags();at&4&&(z=Ke.access()),at&2&&(G=Ke.modify()),at&1&&(ae=Ke.creation())}}return N=N&365,new U(u.isDirectory(this._data)?P.DIRECTORY:P.FILE,k,N,z,G,ae)}},s}(Ye);bs.Name="IsoFS",bs.Options={data:{type:"object",description:"The ISO file in a buffer",validator:Tt}},[L,ns,ss,Di,as,Pi,Sn,bs,xn,Ri,Nn,hs,gs,mi].forEach(function(f){var s=f.Create;f.Create=function(l,o){var u=typeof l=="function",g=u?l:o,m=u?{}:l;function k(N){N?g(N):s.call(f,m,g)}R(f,m,k)}});var ms={AsyncMirror:L,Dropbox:ns,Emscripten:ss,FolderAdapter:Di,HTML5FS:as,InMemory:Pi,IndexedDB:Sn,IsoFS:bs,LocalStorage:xn,MountableFileSystem:Ri,OverlayFS:Nn,WorkerFS:hs,XmlHttpRequest:gs,ZipFS:mi};y.initializeTTYs&&y.initializeTTYs();function gu(f){f.Buffer=a,f.process=y;var s=f.require?f.require:null;f.require=function(l){var o=Cl(l);return o||s.apply(null,Array.prototype.slice.call(arguments,0))}}function yu(f,s){ms[f]=s}function Cl(f){switch(f){case"fs":return fe;case"path":return v;case"buffer":return b;case"process":return y;case"bfs_utils":return M;default:return ms[f]}}function jl(f){return fe.initialize(f)}function bu(f,s){Fo(f,function(l,o){o?(jl(o),s()):s(l)})}function Fo(f,s){var l=f.fs;if(!l)return s(new _(h.EPERM,'Missing "fs" property on configuration object.'));var o=f.options,u=0,g=!1;function m(){if(!g){g=!0;var F=ms[l];F?F.Create(o,s):s(new _(h.EPERM,"File system "+l+" is not available in BrowserFS."))}}if(o!==null&&typeof o=="object"){var k=!1,N=Object.keys(o).filter(function(F){return F!=="fs"});N.forEach(function(F){var z=o[F];z!==null&&typeof z=="object"&&z.fs&&(u++,Fo(z,function(G,ae){if(u--,G){if(g)return;g=!0,s(G)}else o[F]=ae,u===0&&k&&m()}))}),k=!0}u===0&&m()}"ab".substr(-1)!=="b"&&(String.prototype.substr=function(f){return function(s,l){return s<0&&(s=this.length+s),f.call(this,s,l)}}(String.prototype.substr)),typeof ArrayBuffer<"u"&&typeof Uint8Array<"u"&&(Uint8Array.prototype.slice||(Uint8Array.prototype.slice=function(f,s){f===void 0&&(f=0),s===void 0&&(s=this.length);var l=this;return f<0&&(f=this.length+f,f<0&&(f=0)),s<0&&(s=this.length+s,s<0&&(s=0)),s<f&&(s=f),new Uint8Array(l.buffer,l.byteOffset+f,s-f)})),i.install=gu,i.registerFileSystem=yu,i.BFSRequire=Cl,i.initialize=jl,i.configure=bu,i.getFileSystem=Fo,i.EmscriptenFS=Ve,i.FileSystem=ms,i.Errors=T,i.setImmediate=Eo}).call(i,n(1),function(){return this}(),n(5)(r),n(6))},function(r,i,n){r.exports=n(2).Buffer},function(r,i,n){(function(h){"use strict";var p=n(3),d=n(4);i.Buffer=h,i.SlowBuffer=W,i.INSPECT_MAX_BYTES=50;var y=2147483647;i.kMaxLength=y,h.TYPED_ARRAY_SUPPORT=b(),!h.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function b(){try{var L=new Uint8Array(1);return L.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},L.foo()===42}catch{return!1}}function v(L){if(L>y)throw new RangeError("Invalid typed array length");var O=new Uint8Array(L);return O.__proto__=h.prototype,O}function h(L,O,A){if(typeof L=="number"){if(typeof O=="string")throw new Error("If encoding is specified then the first argument must be a string");return C(L)}return w(L,O,A)}typeof Symbol<"u"&&Symbol.species&&h[Symbol.species]===h&&Object.defineProperty(h,Symbol.species,{value:null,configurable:!0,enumerable:!1,writable:!1}),h.poolSize=8192;function w(L,O,A){if(typeof L=="number")throw new TypeError('"value" argument must not be a number');return xt(L)?U(L,O,A):typeof L=="string"?I(L,O):H(L)}h.from=function(L,O,A){return w(L,O,A)},h.prototype.__proto__=Uint8Array.prototype,h.__proto__=Uint8Array;function _(L){if(typeof L!="number")throw new TypeError('"size" argument must be a number');if(L<0)throw new RangeError('"size" argument must not be negative')}function T(L,O,A){return _(L),L<=0?v(L):O!==void 0?typeof A=="string"?v(L).fill(O,A):v(L).fill(O):v(L)}h.alloc=function(L,O,A){return T(L,O,A)};function C(L){return _(L),v(L<0?0:Q(L)|0)}h.allocUnsafe=function(L){return C(L)},h.allocUnsafeSlow=function(L){return C(L)};function I(L,O){if((typeof O!="string"||O==="")&&(O="utf8"),!h.isEncoding(O))throw new TypeError('"encoding" must be a valid string encoding');var A=Be(L,O)|0,D=v(A),X=D.write(L,O);return X!==A&&(D=D.slice(0,X)),D}function P(L){for(var O=L.length<0?0:Q(L.length)|0,A=v(O),D=0;D<O;D+=1)A[D]=L[D]&255;return A}function U(L,O,A){if(O<0||L.byteLength<O)throw new RangeError("'offset' is out of bounds");if(L.byteLength<O+(A||0))throw new RangeError("'length' is out of bounds");var D;return O===void 0&&A===void 0?D=new Uint8Array(L):A===void 0?D=new Uint8Array(L,O):D=new Uint8Array(L,O,A),D.__proto__=h.prototype,D}function H(L){if(h.isBuffer(L)){var O=Q(L.length)|0,A=v(O);return A.length===0||L.copy(A,0,0,O),A}if(L){if(Et(L)||"length"in L)return typeof L.length!="number"||rt(L.length)?v(0):P(L);if(L.type==="Buffer"&&Array.isArray(L.data))return P(L.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}function Q(L){if(L>=y)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+y.toString(16)+" bytes");return L|0}function W(L){return+L!=L&&(L=0),h.alloc(+L)}h.isBuffer=function(O){return O!=null&&O._isBuffer===!0},h.compare=function(O,A){if(!h.isBuffer(O)||!h.isBuffer(A))throw new TypeError("Arguments must be Buffers");if(O===A)return 0;for(var D=O.length,X=A.length,se=0,ge=Math.min(D,X);se<ge;++se)if(O[se]!==A[se]){D=O[se],X=A[se];break}return D<X?-1:X<D?1:0},h.isEncoding=function(O){switch(String(O).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},h.concat=function(O,A){if(!Array.isArray(O))throw new TypeError('"list" argument must be an Array of Buffers');if(O.length===0)return h.alloc(0);var D;if(A===void 0)for(A=0,D=0;D<O.length;++D)A+=O[D].length;var X=h.allocUnsafe(A),se=0;for(D=0;D<O.length;++D){var ge=O[D];if(!h.isBuffer(ge))throw new TypeError('"list" argument must be an Array of Buffers');ge.copy(X,se),se+=ge.length}return X};function Be(L,O){if(h.isBuffer(L))return L.length;if(Et(L)||xt(L))return L.byteLength;typeof L!="string"&&(L=""+L);var A=L.length;if(A===0)return 0;for(var D=!1;;)switch(O){case"ascii":case"latin1":case"binary":return A;case"utf8":case"utf-8":case void 0:return _e(L).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return A*2;case"hex":return A>>>1;case"base64":return Ye(L).length;default:if(D)return _e(L).length;O=(""+O).toLowerCase(),D=!0}}h.byteLength=Be;function re(L,O,A){var D=!1;if((O===void 0||O<0)&&(O=0),O>this.length||((A===void 0||A>this.length)&&(A=this.length),A<=0)||(A>>>=0,O>>>=0,A<=O))return"";for(L||(L="utf8");;)switch(L){case"hex":return He(this,O,A);case"utf8":case"utf-8":return ht(this,O,A);case"ascii":return ne(this,O,A);case"latin1":case"binary":return Te(this,O,A);case"base64":return ze(this,O,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return qe(this,O,A);default:if(D)throw new TypeError("Unknown encoding: "+L);L=(L+"").toLowerCase(),D=!0}}h.prototype._isBuffer=!0;function me(L,O,A){var D=L[O];L[O]=L[A],L[A]=D}h.prototype.swap16=function(){var O=this.length;if(O%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var A=0;A<O;A+=2)me(this,A,A+1);return this},h.prototype.swap32=function(){var O=this.length;if(O%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var A=0;A<O;A+=4)me(this,A,A+3),me(this,A+1,A+2);return this},h.prototype.swap64=function(){var O=this.length;if(O%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var A=0;A<O;A+=8)me(this,A,A+7),me(this,A+1,A+6),me(this,A+2,A+5),me(this,A+3,A+4);return this},h.prototype.toString=function(){var O=this.length;return O===0?"":arguments.length===0?ht(this,0,O):re.apply(this,arguments)},h.prototype.equals=function(O){if(!h.isBuffer(O))throw new TypeError("Argument must be a Buffer");return this===O?!0:h.compare(this,O)===0},h.prototype.inspect=function(){var O="",A=i.INSPECT_MAX_BYTES;return this.length>0&&(O=this.toString("hex",0,A).match(/.{2}/g).join(" "),this.length>A&&(O+=" ... ")),"<Buffer "+O+">"},h.prototype.compare=function(O,A,D,X,se){if(!h.isBuffer(O))throw new TypeError("Argument must be a Buffer");if(A===void 0&&(A=0),D===void 0&&(D=O?O.length:0),X===void 0&&(X=0),se===void 0&&(se=this.length),A<0||D>O.length||X<0||se>this.length)throw new RangeError("out of range index");if(X>=se&&A>=D)return 0;if(X>=se)return-1;if(A>=D)return 1;if(A>>>=0,D>>>=0,X>>>=0,se>>>=0,this===O)return 0;for(var ge=se-X,nt=D-A,ct=Math.min(ge,nt),mt=this.slice(X,se),Bt=O.slice(A,D),yt=0;yt<ct;++yt)if(mt[yt]!==Bt[yt]){ge=mt[yt],nt=Bt[yt];break}return ge<nt?-1:nt<ge?1:0};function Fe(L,O,A,D,X){if(L.length===0)return-1;if(typeof A=="string"?(D=A,A=0):A>2147483647?A=2147483647:A<-2147483648&&(A=-2147483648),A=+A,rt(A)&&(A=X?0:L.length-1),A<0&&(A=L.length+A),A>=L.length){if(X)return-1;A=L.length-1}else if(A<0)if(X)A=0;else return-1;if(typeof O=="string"&&(O=h.from(O,D)),h.isBuffer(O))return O.length===0?-1:ee(L,O,A,D,X);if(typeof O=="number")return O=O&255,typeof Uint8Array.prototype.indexOf=="function"?X?Uint8Array.prototype.indexOf.call(L,O,A):Uint8Array.prototype.lastIndexOf.call(L,O,A):ee(L,[O],A,D,X);throw new TypeError("val must be string, number or Buffer")}function ee(L,O,A,D,X){var se=1,ge=L.length,nt=O.length;if(D!==void 0&&(D=String(D).toLowerCase(),D==="ucs2"||D==="ucs-2"||D==="utf16le"||D==="utf-16le")){if(L.length<2||O.length<2)return-1;se=2,ge/=2,nt/=2,A/=2}function ct(Wr,jr){return se===1?Wr[jr]:Wr.readUInt16BE(jr*se)}var mt;if(X){var Bt=-1;for(mt=A;mt<ge;mt++)if(ct(L,mt)===ct(O,Bt===-1?0:mt-Bt)){if(Bt===-1&&(Bt=mt),mt-Bt+1===nt)return Bt*se}else Bt!==-1&&(mt-=mt-Bt),Bt=-1}else for(A+nt>ge&&(A=ge-nt),mt=A;mt>=0;mt--){for(var yt=!0,ar=0;ar<nt;ar++)if(ct(L,mt+ar)!==ct(O,ar)){yt=!1;break}if(yt)return mt}return-1}h.prototype.includes=function(O,A,D){return this.indexOf(O,A,D)!==-1},h.prototype.indexOf=function(O,A,D){return Fe(this,O,A,D,!0)},h.prototype.lastIndexOf=function(O,A,D){return Fe(this,O,A,D,!1)};function ye(L,O,A,D){A=Number(A)||0;var X=L.length-A;D?(D=Number(D),D>X&&(D=X)):D=X;var se=O.length;if(se%2!==0)throw new TypeError("Invalid hex string");D>se/2&&(D=se/2);for(var ge=0;ge<D;++ge){var nt=parseInt(O.substr(ge*2,2),16);if(rt(nt))return ge;L[A+ge]=nt}return ge}function fe(L,O,A,D){return We(_e(O,L.length-A),L,A,D)}function Ce(L,O,A,D){return We(Ve(O),L,A,D)}function Re(L,O,A,D){return Ce(L,O,A,D)}function ot(L,O,A,D){return We(Ye(O),L,A,D)}function Z(L,O,A,D){return We(ve(O,L.length-A),L,A,D)}h.prototype.write=function(O,A,D,X){if(A===void 0)X="utf8",D=this.length,A=0;else if(D===void 0&&typeof A=="string")X=A,D=this.length,A=0;else if(isFinite(A))A=A>>>0,isFinite(D)?(D=D>>>0,X===void 0&&(X="utf8")):(X=D,D=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var se=this.length-A;if((D===void 0||D>se)&&(D=se),O.length>0&&(D<0||A<0)||A>this.length)throw new RangeError("Attempt to write outside buffer bounds");X||(X="utf8");for(var ge=!1;;)switch(X){case"hex":return ye(this,O,A,D);case"utf8":case"utf-8":return fe(this,O,A,D);case"ascii":return Ce(this,O,A,D);case"latin1":case"binary":return Re(this,O,A,D);case"base64":return ot(this,O,A,D);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Z(this,O,A,D);default:if(ge)throw new TypeError("Unknown encoding: "+X);X=(""+X).toLowerCase(),ge=!0}},h.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function ze(L,O,A){return O===0&&A===L.length?p.fromByteArray(L):p.fromByteArray(L.slice(O,A))}function ht(L,O,A){A=Math.min(L.length,A);for(var D=[],X=O;X<A;){var se=L[X],ge=null,nt=se>239?4:se>223?3:se>191?2:1;if(X+nt<=A){var ct,mt,Bt,yt;switch(nt){case 1:se<128&&(ge=se);break;case 2:ct=L[X+1],(ct&192)===128&&(yt=(se&31)<<6|ct&63,yt>127&&(ge=yt));break;case 3:ct=L[X+1],mt=L[X+2],(ct&192)===128&&(mt&192)===128&&(yt=(se&15)<<12|(ct&63)<<6|mt&63,yt>2047&&(yt<55296||yt>57343)&&(ge=yt));break;case 4:ct=L[X+1],mt=L[X+2],Bt=L[X+3],(ct&192)===128&&(mt&192)===128&&(Bt&192)===128&&(yt=(se&15)<<18|(ct&63)<<12|(mt&63)<<6|Bt&63,yt>65535&&yt<1114112&&(ge=yt))}}ge===null?(ge=65533,nt=1):ge>65535&&(ge-=65536,D.push(ge>>>10&1023|55296),ge=56320|ge&1023),D.push(ge),X+=nt}return K(D)}var te=4096;function K(L){var O=L.length;if(O<=te)return String.fromCharCode.apply(String,L);for(var A="",D=0;D<O;)A+=String.fromCharCode.apply(String,L.slice(D,D+=te));return A}function ne(L,O,A){var D="";A=Math.min(L.length,A);for(var X=O;X<A;++X)D+=String.fromCharCode(L[X]&127);return D}function Te(L,O,A){var D="";A=Math.min(L.length,A);for(var X=O;X<A;++X)D+=String.fromCharCode(L[X]);return D}function He(L,O,A){var D=L.length;(!O||O<0)&&(O=0),(!A||A<0||A>D)&&(A=D);for(var X="",se=O;se<A;++se)X+=pe(L[se]);return X}function qe(L,O,A){for(var D=L.slice(O,A),X="",se=0;se<D.length;se+=2)X+=String.fromCharCode(D[se]+D[se+1]*256);return X}h.prototype.slice=function(O,A){var D=this.length;O=~~O,A=A===void 0?D:~~A,O<0?(O+=D,O<0&&(O=0)):O>D&&(O=D),A<0?(A+=D,A<0&&(A=0)):A>D&&(A=D),A<O&&(A=O);var X=this.subarray(O,A);return X.__proto__=h.prototype,X};function Me(L,O,A){if(L%1!==0||L<0)throw new RangeError("offset is not uint");if(L+O>A)throw new RangeError("Trying to access beyond buffer length")}h.prototype.readUIntLE=function(O,A,D){O=O>>>0,A=A>>>0,D||Me(O,A,this.length);for(var X=this[O],se=1,ge=0;++ge<A&&(se*=256);)X+=this[O+ge]*se;return X},h.prototype.readUIntBE=function(O,A,D){O=O>>>0,A=A>>>0,D||Me(O,A,this.length);for(var X=this[O+--A],se=1;A>0&&(se*=256);)X+=this[O+--A]*se;return X},h.prototype.readUInt8=function(O,A){return O=O>>>0,A||Me(O,1,this.length),this[O]},h.prototype.readUInt16LE=function(O,A){return O=O>>>0,A||Me(O,2,this.length),this[O]|this[O+1]<<8},h.prototype.readUInt16BE=function(O,A){return O=O>>>0,A||Me(O,2,this.length),this[O]<<8|this[O+1]},h.prototype.readUInt32LE=function(O,A){return O=O>>>0,A||Me(O,4,this.length),(this[O]|this[O+1]<<8|this[O+2]<<16)+this[O+3]*16777216},h.prototype.readUInt32BE=function(O,A){return O=O>>>0,A||Me(O,4,this.length),this[O]*16777216+(this[O+1]<<16|this[O+2]<<8|this[O+3])},h.prototype.readIntLE=function(O,A,D){O=O>>>0,A=A>>>0,D||Me(O,A,this.length);for(var X=this[O],se=1,ge=0;++ge<A&&(se*=256);)X+=this[O+ge]*se;return se*=128,X>=se&&(X-=Math.pow(2,8*A)),X},h.prototype.readIntBE=function(O,A,D){O=O>>>0,A=A>>>0,D||Me(O,A,this.length);for(var X=A,se=1,ge=this[O+--X];X>0&&(se*=256);)ge+=this[O+--X]*se;return se*=128,ge>=se&&(ge-=Math.pow(2,8*A)),ge},h.prototype.readInt8=function(O,A){return O=O>>>0,A||Me(O,1,this.length),this[O]&128?(255-this[O]+1)*-1:this[O]},h.prototype.readInt16LE=function(O,A){O=O>>>0,A||Me(O,2,this.length);var D=this[O]|this[O+1]<<8;return D&32768?D|4294901760:D},h.prototype.readInt16BE=function(O,A){O=O>>>0,A||Me(O,2,this.length);var D=this[O+1]|this[O]<<8;return D&32768?D|4294901760:D},h.prototype.readInt32LE=function(O,A){return O=O>>>0,A||Me(O,4,this.length),this[O]|this[O+1]<<8|this[O+2]<<16|this[O+3]<<24},h.prototype.readInt32BE=function(O,A){return O=O>>>0,A||Me(O,4,this.length),this[O]<<24|this[O+1]<<16|this[O+2]<<8|this[O+3]},h.prototype.readFloatLE=function(O,A){return O=O>>>0,A||Me(O,4,this.length),d.read(this,O,!0,23,4)},h.prototype.readFloatBE=function(O,A){return O=O>>>0,A||Me(O,4,this.length),d.read(this,O,!1,23,4)},h.prototype.readDoubleLE=function(O,A){return O=O>>>0,A||Me(O,8,this.length),d.read(this,O,!0,52,8)},h.prototype.readDoubleBE=function(O,A){return O=O>>>0,A||Me(O,8,this.length),d.read(this,O,!1,52,8)};function Ge(L,O,A,D,X,se){if(!h.isBuffer(L))throw new TypeError('"buffer" argument must be a Buffer instance');if(O>X||O<se)throw new RangeError('"value" argument is out of bounds');if(A+D>L.length)throw new RangeError("Index out of range")}h.prototype.writeUIntLE=function(O,A,D,X){if(O=+O,A=A>>>0,D=D>>>0,!X){var se=Math.pow(2,8*D)-1;Ge(this,O,A,D,se,0)}var ge=1,nt=0;for(this[A]=O&255;++nt<D&&(ge*=256);)this[A+nt]=O/ge&255;return A+D},h.prototype.writeUIntBE=function(O,A,D,X){if(O=+O,A=A>>>0,D=D>>>0,!X){var se=Math.pow(2,8*D)-1;Ge(this,O,A,D,se,0)}var ge=D-1,nt=1;for(this[A+ge]=O&255;--ge>=0&&(nt*=256);)this[A+ge]=O/nt&255;return A+D},h.prototype.writeUInt8=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,1,255,0),this[A]=O&255,A+1},h.prototype.writeUInt16LE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,2,65535,0),this[A]=O&255,this[A+1]=O>>>8,A+2},h.prototype.writeUInt16BE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,2,65535,0),this[A]=O>>>8,this[A+1]=O&255,A+2},h.prototype.writeUInt32LE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,4,4294967295,0),this[A+3]=O>>>24,this[A+2]=O>>>16,this[A+1]=O>>>8,this[A]=O&255,A+4},h.prototype.writeUInt32BE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,4,4294967295,0),this[A]=O>>>24,this[A+1]=O>>>16,this[A+2]=O>>>8,this[A+3]=O&255,A+4},h.prototype.writeIntLE=function(O,A,D,X){if(O=+O,A=A>>>0,!X){var se=Math.pow(2,8*D-1);Ge(this,O,A,D,se-1,-se)}var ge=0,nt=1,ct=0;for(this[A]=O&255;++ge<D&&(nt*=256);)O<0&&ct===0&&this[A+ge-1]!==0&&(ct=1),this[A+ge]=(O/nt>>0)-ct&255;return A+D},h.prototype.writeIntBE=function(O,A,D,X){if(O=+O,A=A>>>0,!X){var se=Math.pow(2,8*D-1);Ge(this,O,A,D,se-1,-se)}var ge=D-1,nt=1,ct=0;for(this[A+ge]=O&255;--ge>=0&&(nt*=256);)O<0&&ct===0&&this[A+ge+1]!==0&&(ct=1),this[A+ge]=(O/nt>>0)-ct&255;return A+D},h.prototype.writeInt8=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,1,127,-128),O<0&&(O=255+O+1),this[A]=O&255,A+1},h.prototype.writeInt16LE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,2,32767,-32768),this[A]=O&255,this[A+1]=O>>>8,A+2},h.prototype.writeInt16BE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,2,32767,-32768),this[A]=O>>>8,this[A+1]=O&255,A+2},h.prototype.writeInt32LE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,4,2147483647,-2147483648),this[A]=O&255,this[A+1]=O>>>8,this[A+2]=O>>>16,this[A+3]=O>>>24,A+4},h.prototype.writeInt32BE=function(O,A,D){return O=+O,A=A>>>0,D||Ge(this,O,A,4,2147483647,-2147483648),O<0&&(O=4294967295+O+1),this[A]=O>>>24,this[A+1]=O>>>16,this[A+2]=O>>>8,this[A+3]=O&255,A+4};function gt(L,O,A,D,X,se){if(A+D>L.length)throw new RangeError("Index out of range");if(A<0)throw new RangeError("Index out of range")}function Y(L,O,A,D,X){return O=+O,A=A>>>0,X||gt(L,O,A,4,34028234663852886e22,-34028234663852886e22),d.write(L,O,A,D,23,4),A+4}h.prototype.writeFloatLE=function(O,A,D){return Y(this,O,A,!0,D)},h.prototype.writeFloatBE=function(O,A,D){return Y(this,O,A,!1,D)};function Tt(L,O,A,D,X){return O=+O,A=A>>>0,X||gt(L,O,A,8,17976931348623157e292,-17976931348623157e292),d.write(L,O,A,D,52,8),A+8}h.prototype.writeDoubleLE=function(O,A,D){return Tt(this,O,A,!0,D)},h.prototype.writeDoubleBE=function(O,A,D){return Tt(this,O,A,!1,D)},h.prototype.copy=function(O,A,D,X){if(D||(D=0),!X&&X!==0&&(X=this.length),A>=O.length&&(A=O.length),A||(A=0),X>0&&X<D&&(X=D),X===D||O.length===0||this.length===0)return 0;if(A<0)throw new RangeError("targetStart out of bounds");if(D<0||D>=this.length)throw new RangeError("sourceStart out of bounds");if(X<0)throw new RangeError("sourceEnd out of bounds");X>this.length&&(X=this.length),O.length-A<X-D&&(X=O.length-A+D);var se=X-D,ge;if(this===O&&D<A&&A<X)for(ge=se-1;ge>=0;--ge)O[ge+A]=this[ge+D];else if(se<1e3)for(ge=0;ge<se;++ge)O[ge+A]=this[ge+D];else Uint8Array.prototype.set.call(O,this.subarray(D,D+se),A);return se},h.prototype.fill=function(O,A,D,X){if(typeof O=="string"){if(typeof A=="string"?(X=A,A=0,D=this.length):typeof D=="string"&&(X=D,D=this.length),O.length===1){var se=O.charCodeAt(0);se<256&&(O=se)}if(X!==void 0&&typeof X!="string")throw new TypeError("encoding must be a string");if(typeof X=="string"&&!h.isEncoding(X))throw new TypeError("Unknown encoding: "+X)}else typeof O=="number"&&(O=O&255);if(A<0||this.length<A||this.length<D)throw new RangeError("Out of range index");if(D<=A)return this;A=A>>>0,D=D===void 0?this.length:D>>>0,O||(O=0);var ge;if(typeof O=="number")for(ge=A;ge<D;++ge)this[ge]=O;else{var nt=h.isBuffer(O)?O:new h(O,X),ct=nt.length;for(ge=0;ge<D-A;++ge)this[ge+A]=nt[ge%ct]}return this};var R=/[^+/0-9A-Za-z-_]/g;function M(L){if(L=L.trim().replace(R,""),L.length<2)return"";for(;L.length%4!==0;)L=L+"=";return L}function pe(L){return L<16?"0"+L.toString(16):L.toString(16)}function _e(L,O){O=O||1/0;for(var A,D=L.length,X=null,se=[],ge=0;ge<D;++ge){if(A=L.charCodeAt(ge),A>55295&&A<57344){if(!X){if(A>56319){(O-=3)>-1&&se.push(239,191,189);continue}else if(ge+1===D){(O-=3)>-1&&se.push(239,191,189);continue}X=A;continue}if(A<56320){(O-=3)>-1&&se.push(239,191,189),X=A;continue}A=(X-55296<<10|A-56320)+65536}else X&&(O-=3)>-1&&se.push(239,191,189);if(X=null,A<128){if((O-=1)<0)break;se.push(A)}else if(A<2048){if((O-=2)<0)break;se.push(A>>6|192,A&63|128)}else if(A<65536){if((O-=3)<0)break;se.push(A>>12|224,A>>6&63|128,A&63|128)}else if(A<1114112){if((O-=4)<0)break;se.push(A>>18|240,A>>12&63|128,A>>6&63|128,A&63|128)}else throw new Error("Invalid code point")}return se}function Ve(L){for(var O=[],A=0;A<L.length;++A)O.push(L.charCodeAt(A)&255);return O}function ve(L,O){for(var A,D,X,se=[],ge=0;ge<L.length&&!((O-=2)<0);++ge)A=L.charCodeAt(ge),D=A>>8,X=A%256,se.push(X),se.push(D);return se}function Ye(L){return p.toByteArray(M(L))}function We(L,O,A,D){for(var X=0;X<D&&!(X+A>=O.length||X>=L.length);++X)O[X+A]=L[X];return X}function xt(L){return L instanceof ArrayBuffer||L!=null&&L.constructor!=null&&L.constructor.name==="ArrayBuffer"&&typeof L.byteLength=="number"}function Et(L){return typeof ArrayBuffer.isView=="function"&&ArrayBuffer.isView(L)}function rt(L){return L!==L}}).call(i,n(1))},function(r,i){"use strict";i.byteLength=h,i.toByteArray=w,i.fromByteArray=C;for(var n=[],a=[],p=typeof Uint8Array<"u"?Uint8Array:Array,d="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",y=0,b=d.length;y<b;++y)n[y]=d[y],a[d.charCodeAt(y)]=y;a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63;function v(I){var P=I.length;if(P%4>0)throw new Error("Invalid string. Length must be a multiple of 4");return I[P-2]==="="?2:I[P-1]==="="?1:0}function h(I){return I.length*3/4-v(I)}function w(I){var P,U,H,Q,W,Be,re=I.length;W=v(I),Be=new p(re*3/4-W),H=W>0?re-4:re;var me=0;for(P=0,U=0;P<H;P+=4,U+=3)Q=a[I.charCodeAt(P)]<<18|a[I.charCodeAt(P+1)]<<12|a[I.charCodeAt(P+2)]<<6|a[I.charCodeAt(P+3)],Be[me++]=Q>>16&255,Be[me++]=Q>>8&255,Be[me++]=Q&255;return W===2?(Q=a[I.charCodeAt(P)]<<2|a[I.charCodeAt(P+1)]>>4,Be[me++]=Q&255):W===1&&(Q=a[I.charCodeAt(P)]<<10|a[I.charCodeAt(P+1)]<<4|a[I.charCodeAt(P+2)]>>2,Be[me++]=Q>>8&255,Be[me++]=Q&255),Be}function _(I){return n[I>>18&63]+n[I>>12&63]+n[I>>6&63]+n[I&63]}function T(I,P,U){for(var H,Q=[],W=P;W<U;W+=3)H=(I[W]<<16)+(I[W+1]<<8)+I[W+2],Q.push(_(H));return Q.join("")}function C(I){for(var P,U=I.length,H=U%3,Q="",W=[],Be=16383,re=0,me=U-H;re<me;re+=Be)W.push(T(I,re,re+Be>me?me:re+Be));return H===1?(P=I[U-1],Q+=n[P>>2],Q+=n[P<<4&63],Q+="=="):H===2&&(P=(I[U-2]<<8)+I[U-1],Q+=n[P>>10],Q+=n[P>>4&63],Q+=n[P<<2&63],Q+="="),W.push(Q),W.join("")}},function(r,i){i.read=function(n,a,p,d,y){var b,v,h=y*8-d-1,w=(1<<h)-1,_=w>>1,T=-7,C=p?y-1:0,I=p?-1:1,P=n[a+C];for(C+=I,b=P&(1<<-T)-1,P>>=-T,T+=h;T>0;b=b*256+n[a+C],C+=I,T-=8);for(v=b&(1<<-T)-1,b>>=-T,T+=d;T>0;v=v*256+n[a+C],C+=I,T-=8);if(b===0)b=1-_;else{if(b===w)return v?NaN:(P?-1:1)*(1/0);v=v+Math.pow(2,d),b=b-_}return(P?-1:1)*v*Math.pow(2,b-d)},i.write=function(n,a,p,d,y,b){var v,h,w,_=b*8-y-1,T=(1<<_)-1,C=T>>1,I=y===23?Math.pow(2,-24)-Math.pow(2,-77):0,P=d?0:b-1,U=d?1:-1,H=a<0||a===0&&1/a<0?1:0;for(a=Math.abs(a),isNaN(a)||a===1/0?(h=isNaN(a)?1:0,v=T):(v=Math.floor(Math.log(a)/Math.LN2),a*(w=Math.pow(2,-v))<1&&(v--,w*=2),v+C>=1?a+=I/w:a+=I*Math.pow(2,1-C),a*w>=2&&(v++,w/=2),v+C>=T?(h=0,v=T):v+C>=1?(h=(a*w-1)*Math.pow(2,y),v=v+C):(h=a*Math.pow(2,C-1)*Math.pow(2,y),v=0));y>=8;n[p+P]=h&255,P+=U,h/=256,y-=8);for(v=v<<y|h,_+=y;_>0;n[p+P]=v&255,P+=U,v/=256,_-=8);n[p+P-U]|=H*128}},function(r,i){r.exports=function(n){return n.webpackPolyfill||(n.deprecate=function(){},n.paths=[],n.children=[],n.webpackPolyfill=1),n}},function(r,i,n){"use strict";var a=n(7),p=new a,d={};function y(v){d[v]||(typeof p[v]=="function"?d[v]=function(){return p[v].apply(p,arguments)}:d[v]=p[v])}for(var b in p)y(b);d.initializeTTYs=function(){p.stdin===null&&(p.initializeTTYs(),d.stdin=p.stdin,d.stdout=p.stdout,d.stderr=p.stderr)},p.nextTick(function(){d.initializeTTYs()}),r.exports=d},function(r,i,n){(function(a){"use strict";var p=this&&this.__extends||function(w,_){for(var T in _)_.hasOwnProperty(T)&&(w[T]=_[T]);function C(){this.constructor=w}w.prototype=_===null?Object.create(_):(C.prototype=_.prototype,new C)},d=n(8),y=null,b=function(){function w(_,T){this.fun=_,this.array=T}return w.prototype.run=function(){this.fun.apply(null,this.array)},w}(),v=function(){function w(){this._queue=[],this._draining=!1,this._currentQueue=null,this._queueIndex=-1}return w.prototype.push=function(_){var T=this;this._queue.push(_)===1&&!this._draining&&setTimeout(function(){return T._drainQueue()},0)},w.prototype._cleanUpNextTick=function(){this._draining=!1,this._currentQueue&&this._currentQueue.length?this._queue=this._currentQueue.concat(this._queue):this._queueIndex=-1,this._queue.length&&this._drainQueue()},w.prototype._drainQueue=function(){var _=this;if(!this._draining){var T=setTimeout(function(){return _._cleanUpNextTick()});this._draining=!0;for(var C=this._queue.length;C;){for(this._currentQueue=this._queue,this._queue=[];++this._queueIndex<C;)this._currentQueue&&this._currentQueue[this._queueIndex].run();this._queueIndex=-1,C=this._queue.length}this._currentQueue=null,this._draining=!1,clearTimeout(T)}},w}(),h=function(w){p(_,w);function _(){w.apply(this,arguments),this.startTime=Date.now(),this._cwd="/",this.platform="browser",this.argv=[],this.execArgv=[],this.stdout=null,this.stderr=null,this.stdin=null,this.domain=null,this._queue=new v,this.execPath=a,this.env={},this.exitCode=0,this._gid=1,this._uid=1,this.version="v5.0",this.versions={http_parser:"0.0",node:"5.0",v8:"0.0",uv:"0.0",zlib:"0.0",ares:"0.0",icu:"0.0",modules:"0",openssl:"0.0"},this.config={target_defaults:{cflags:[],default_configuration:"Release",defines:[],include_dirs:[],libraries:[]},variables:{clang:0,host_arch:"x32",node_install_npm:!1,node_install_waf:!1,node_prefix:"",node_shared_cares:!1,node_shared_http_parser:!1,node_shared_libuv:!1,node_shared_zlib:!1,node_shared_v8:!1,node_use_dtrace:!1,node_use_etw:!1,node_use_openssl:!1,node_shared_openssl:!1,strict_aliasing:!1,target_arch:"x32",v8_use_snapshot:!1,v8_no_strict_aliasing:0,visibility:""}},this.pid=Math.random()*1e3|0,this.title="node",this.arch="x32",this._mask=18,this.connected=void 0}return _.prototype.chdir=function(T){y===null&&(y=n(9)),this._cwd=y.resolve(T)},_.prototype.cwd=function(){return this._cwd},_.prototype.uptime=function(){return(Date.now()-this.startTime)/1e3|0},_.prototype.nextTick=function(T){for(var C=[],I=1;I<arguments.length;I++)C[I-1]=arguments[I];this._queue.push(new b(T,C))},_.prototype.abort=function(){this.emit("abort")},_.prototype.exit=function(T){this.exitCode=T,this.emit("exit",[T])},_.prototype.getgid=function(){return this._gid},_.prototype.setgid=function(T){typeof T=="number"?this._gid=T:this._gid=1},_.prototype.getuid=function(){return this._uid},_.prototype.setuid=function(T){typeof T=="number"?this._uid=T:this._uid=1},_.prototype.kill=function(T,C){this.emit("kill",[T,C])},_.prototype.memoryUsage=function(){return{rss:0,heapTotal:0,heapUsed:0}},_.prototype.umask=function(T){T===void 0&&(T=this._mask);var C=this._mask;return this._mask=T,this.emit("umask",[T]),C},_.prototype.hrtime=function(){var T;typeof performance<"u"?T=performance.now():Date.now?T=Date.now():T=new Date().getTime();var C=T/1e3|0;return T-=C*1e3,T=T*1e6|0,[C,T]},_.prototype.initializeTTYs=function(){if(this.stdout===null){var T=n(10);this.stdout=new T,this.stderr=new T,this.stdin=new T}},_.prototype.disconnect=function(){},_}(d.EventEmitter);r.exports=h}).call(i,"/")},function(r,i){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}r.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(b){if(!p(b)||b<0||isNaN(b))throw TypeError("n must be a positive number");return this._maxListeners=b,this},n.prototype.emit=function(b){var v,h,w,_,T,C;if(this._events||(this._events={}),b==="error"&&(!this._events.error||d(this._events.error)&&!this._events.error.length)){if(v=arguments[1],v instanceof Error)throw v;var I=new Error('Uncaught, unspecified "error" event. ('+v+")");throw I.context=v,I}if(h=this._events[b],y(h))return!1;if(a(h))switch(arguments.length){case 1:h.call(this);break;case 2:h.call(this,arguments[1]);break;case 3:h.call(this,arguments[1],arguments[2]);break;default:_=Array.prototype.slice.call(arguments,1),h.apply(this,_)}else if(d(h))for(_=Array.prototype.slice.call(arguments,1),C=h.slice(),w=C.length,T=0;T<w;T++)C[T].apply(this,_);return!0},n.prototype.addListener=function(b,v){var h;if(!a(v))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",b,a(v.listener)?v.listener:v),this._events[b]?d(this._events[b])?this._events[b].push(v):this._events[b]=[this._events[b],v]:this._events[b]=v,d(this._events[b])&&!this._events[b].warned&&(y(this._maxListeners)?h=n.defaultMaxListeners:h=this._maxListeners,h&&h>0&&this._events[b].length>h&&(this._events[b].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[b].length),typeof console.trace=="function"&&console.trace())),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(b,v){if(!a(v))throw TypeError("listener must be a function");var h=!1;function w(){this.removeListener(b,w),h||(h=!0,v.apply(this,arguments))}return w.listener=v,this.on(b,w),this},n.prototype.removeListener=function(b,v){var h,w,_,T;if(!a(v))throw TypeError("listener must be a function");if(!this._events||!this._events[b])return this;if(h=this._events[b],_=h.length,w=-1,h===v||a(h.listener)&&h.listener===v)delete this._events[b],this._events.removeListener&&this.emit("removeListener",b,v);else if(d(h)){for(T=_;T-- >0;)if(h[T]===v||h[T].listener&&h[T].listener===v){w=T;break}if(w<0)return this;h.length===1?(h.length=0,delete this._events[b]):h.splice(w,1),this._events.removeListener&&this.emit("removeListener",b,v)}return this},n.prototype.removeAllListeners=function(b){var v,h;if(!this._events)return this;if(!this._events.removeListener)return arguments.length===0?this._events={}:this._events[b]&&delete this._events[b],this;if(arguments.length===0){for(v in this._events)v!=="removeListener"&&this.removeAllListeners(v);return this.removeAllListeners("removeListener"),this._events={},this}if(h=this._events[b],a(h))this.removeListener(b,h);else if(h)for(;h.length;)this.removeListener(b,h[h.length-1]);return delete this._events[b],this},n.prototype.listeners=function(b){var v;return!this._events||!this._events[b]?v=[]:a(this._events[b])?v=[this._events[b]]:v=this._events[b].slice(),v},n.prototype.listenerCount=function(b){if(this._events){var v=this._events[b];if(a(v))return 1;if(v)return v.length}return 0},n.listenerCount=function(b,v){return b.listenerCount(v)};function a(b){return typeof b=="function"}function p(b){return typeof b=="number"}function d(b){return typeof b=="object"&&b!==null}function y(b){return b===void 0}},function(r,i,n){(function(a){"use strict";var p=/^(\/?|)([\s\S]*?)((?:\.{1,2}|[^\/]+?|)(\.[^.\/]*|))(?:[\/]*)$/;function d(v){var h=p.exec(v);return h.shift(),h}var y=function(){function v(){}return v.normalize=function(h){h===""&&(h=".");var w=h.charAt(0)===v.sep;h=v._removeDuplicateSeps(h);for(var _=h.split(v.sep),T=[],C=0;C<_.length;C++){var I=_[C];I!=="."&&(I===".."&&(w||!w&&T.length>0&&T[0]!=="..")?T.pop():T.push(I))}if(!w&&T.length<2)switch(T.length){case 1:T[0]===""&&T.unshift(".");break;default:T.push(".")}return h=T.join(v.sep),w&&h.charAt(0)!==v.sep&&(h=v.sep+h),h},v.join=function(){for(var h=[],w=0;w<arguments.length;w++)h[w-0]=arguments[w];for(var _=[],T=0;T<h.length;T++){var C=h[T];if(typeof C!="string")throw new TypeError("Invalid argument type to path.join: "+typeof C);C!==""&&_.push(C)}return v.normalize(_.join(v.sep))},v.resolve=function(){for(var h=[],w=0;w<arguments.length;w++)h[w-0]=arguments[w];for(var _=[],T=0;T<h.length;T++){var C=h[T];if(typeof C!="string")throw new TypeError("Invalid argument type to path.join: "+typeof C);C!==""&&(C.charAt(0)===v.sep&&(_=[]),_.push(C))}var I=v.normalize(_.join(v.sep));if(I.length>1&&I.charAt(I.length-1)===v.sep)return I.substr(0,I.length-1);if(I.charAt(0)!==v.sep){I.charAt(0)==="."&&(I.length===1||I.charAt(1)===v.sep)&&(I=I.length===1?"":I.substr(2));var P=a.cwd();I!==""?I=this.normalize(P+(P!=="/"?v.sep:"")+I):I=P}return I},v.relative=function(h,w){var _;h=v.resolve(h),w=v.resolve(w);var T=h.split(v.sep),C=w.split(v.sep);C.shift(),T.shift();var I=0,P=[];for(_=0;_<T.length;_++){var U=T[_];if(U!==C[_]){I=T.length-_;break}}P=C.slice(_),T.length===1&&T[0]===""&&(I=0),I>T.length&&(I=T.length);var H="";for(_=0;_<I;_++)H+="../";return H+=P.join(v.sep),H.length>1&&H.charAt(H.length-1)===v.sep&&(H=H.substr(0,H.length-1)),H},v.dirname=function(h){h=v._removeDuplicateSeps(h);var w=h.charAt(0)===v.sep,_=h.split(v.sep);return _.pop()===""&&_.length>0&&_.pop(),_.length>1||_.length===1&&!w?_.join(v.sep):w?v.sep:"."},v.basename=function(h,w){if(w===void 0&&(w=""),h==="")return h;h=v.normalize(h);var _=h.split(v.sep),T=_[_.length-1];if(T===""&&_.length>1)return _[_.length-2];if(w.length>0){var C=T.substr(T.length-w.length);if(C===w)return T.substr(0,T.length-w.length)}return T},v.extname=function(h){h=v.normalize(h);var w=h.split(v.sep);if(h=w.pop(),h===""&&w.length>0&&(h=w.pop()),h==="..")return"";var _=h.lastIndexOf(".");return _===-1||_===0?"":h.substr(_)},v.isAbsolute=function(h){return h.length>0&&h.charAt(0)===v.sep},v._makeLong=function(h){return h},v.parse=function(h){var w=d(h);return{root:w[0],dir:w[0]+w[1].slice(0,-1),base:w[2],ext:w[3],name:w[2].slice(0,w[2].length-w[3].length)}},v.format=function(h){if(h===null||typeof h!="object")throw new TypeError("Parameter 'pathObject' must be an object, not "+typeof h);var w=h.root||"";if(typeof w!="string")throw new TypeError("'pathObject.root' must be a string or undefined, not "+typeof h.root);var _=h.dir?h.dir+v.sep:"",T=h.base||"";return _+T},v._removeDuplicateSeps=function(h){return h=h.replace(this._replaceRegex,this.sep),h},v.sep="/",v._replaceRegex=new RegExp("//+","g"),v.delimiter=":",v.posix=v,v.win32=v,v}(),b=y;r.exports=y}).call(i,n(6))},function(r,i,n){(function(a){"use strict";var p=this&&this.__extends||function(b,v){for(var h in v)v.hasOwnProperty(h)&&(b[h]=v[h]);function w(){this.constructor=b}b.prototype=v===null?Object.create(v):(w.prototype=v.prototype,new w)},d=n(11),y=function(b){p(v,b);function v(){b.call(this),this.isRaw=!1,this.columns=80,this.rows=120,this.isTTY=!0,this._bufferedWrites=[],this._waitingForWrites=!1}return v.prototype.setRawMode=function(h){this.isRaw!==h&&(this.isRaw=h,this.emit("modeChange"))},v.prototype.changeColumns=function(h){h!==this.columns&&(this.columns=h,this.emit("resize"))},v.prototype.changeRows=function(h){h!==this.rows&&(this.rows=h,this.emit("resize"))},v.isatty=function(h){return h&&h instanceof v},v.prototype._write=function(h,w,_){var T;try{var C;typeof h=="string"?C=new a(h,w):C=h,this._bufferedWrites.push(C),this._waitingForWrites&&this._read(1024)}catch(I){T=I}finally{_(T)}},v.prototype._read=function(h){if(this._bufferedWrites.length===0)this._waitingForWrites=!0;else for(;this._bufferedWrites.length>0&&(this._waitingForWrites=this.push(this._bufferedWrites.shift()),!!this._waitingForWrites););},v}(d.Duplex);r.exports=y}).call(i,n(1))},function(r,i,n){r.exports=d;var a=n(8).EventEmitter,p=n(12);p(d,a),d.Readable=n(13),d.Writable=n(27),d.Duplex=n(28),d.Transform=n(29),d.PassThrough=n(30),d.Stream=d;function d(){a.call(this)}d.prototype.pipe=function(y,b){var v=this;function h(U){y.writable&&y.write(U)===!1&&v.pause&&v.pause()}v.on("data",h);function w(){v.readable&&v.resume&&v.resume()}y.on("drain",w),!y._isStdio&&(!b||b.end!==!1)&&(v.on("end",T),v.on("close",C));var _=!1;function T(){_||(_=!0,y.end())}function C(){_||(_=!0,typeof y.destroy=="function"&&y.destroy())}function I(U){if(P(),a.listenerCount(this,"error")===0)throw U}v.on("error",I),y.on("error",I);function P(){v.removeListener("data",h),y.removeListener("drain",w),v.removeListener("end",T),v.removeListener("close",C),v.removeListener("error",I),y.removeListener("error",I),v.removeListener("end",P),v.removeListener("close",P),y.removeListener("close",P)}return v.on("end",P),v.on("close",P),y.on("close",P),y.emit("pipe",v),y}},function(r,i){typeof Object.create=="function"?r.exports=function(a,p){a.super_=p,a.prototype=Object.create(p.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}})}:r.exports=function(a,p){a.super_=p;var d=function(){};d.prototype=p.prototype,a.prototype=new d,a.prototype.constructor=a}},function(r,i,n){(function(a){var p=function(){try{return n(11)}catch{}}();i=r.exports=n(14),i.Stream=p||i,i.Readable=i,i.Writable=n(22),i.Duplex=n(21),i.Transform=n(25),i.PassThrough=n(26),!a.browser&&a.env.READABLE_STREAM==="disable"&&p&&(r.exports=p)}).call(i,n(6))},function(r,i,n){(function(a){"use strict";r.exports=W;var p=n(15),d=n(16),y;W.ReadableState=Q;var b=n(8).EventEmitter,v=function(R,M){return R.listeners(M).length},h;(function(){try{h=n(11)}catch{}finally{h||(h=n(8).EventEmitter)}})();var w=n(2).Buffer,_=n(17),T=n(18);T.inherits=n(12);var C=n(19),I=void 0;C&&C.debuglog?I=C.debuglog("stream"):I=function(){};var P=n(20),U;T.inherits(W,h);function H(R,M,pe){if(typeof R.prependListener=="function")return R.prependListener(M,pe);!R._events||!R._events[M]?R.on(M,pe):d(R._events[M])?R._events[M].unshift(pe):R._events[M]=[pe,R._events[M]]}function Q(R,M){y=y||n(21),R=R||{},this.objectMode=!!R.objectMode,M instanceof y&&(this.objectMode=this.objectMode||!!R.readableObjectMode);var pe=R.highWaterMark,_e=this.objectMode?16:16*1024;this.highWaterMark=pe||pe===0?pe:_e,this.highWaterMark=~~this.highWaterMark,this.buffer=new P,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=R.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,R.encoding&&(U||(U=n(24).StringDecoder),this.decoder=new U(R.encoding),this.encoding=R.encoding)}function W(R){if(y=y||n(21),!(this instanceof W))return new W(R);this._readableState=new Q(R,this),this.readable=!0,R&&typeof R.read=="function"&&(this._read=R.read),h.call(this)}W.prototype.push=function(R,M){var pe=this._readableState;return!pe.objectMode&&typeof R=="string"&&(M=M||pe.defaultEncoding,M!==pe.encoding&&(R=_.from(R,M),M="")),Be(this,pe,R,M,!1)},W.prototype.unshift=function(R){var M=this._readableState;return Be(this,M,R,"",!0)},W.prototype.isPaused=function(){return this._readableState.flowing===!1};function Be(R,M,pe,_e,Ve){var ve=ye(M,pe);if(ve)R.emit("error",ve);else if(pe===null)M.reading=!1,fe(R,M);else if(M.objectMode||pe&&pe.length>0)if(M.ended&&!Ve){var Ye=new Error("stream.push() after EOF");R.emit("error",Ye)}else if(M.endEmitted&&Ve){var We=new Error("stream.unshift() after end event");R.emit("error",We)}else{var xt;M.decoder&&!Ve&&!_e&&(pe=M.decoder.write(pe),xt=!M.objectMode&&pe.length===0),Ve||(M.reading=!1),xt||(M.flowing&&M.length===0&&!M.sync?(R.emit("data",pe),R.read(0)):(M.length+=M.objectMode?1:pe.length,Ve?M.buffer.unshift(pe):M.buffer.push(pe),M.needReadable&&Ce(R))),ot(R,M)}else Ve||(M.reading=!1);return re(M)}function re(R){return!R.ended&&(R.needReadable||R.length<R.highWaterMark||R.length===0)}W.prototype.setEncoding=function(R){return U||(U=n(24).StringDecoder),this._readableState.decoder=new U(R),this._readableState.encoding=R,this};var me=8388608;function Fe(R){return R>=me?R=me:(R--,R|=R>>>1,R|=R>>>2,R|=R>>>4,R|=R>>>8,R|=R>>>16,R++),R}function ee(R,M){return R<=0||M.length===0&&M.ended?0:M.objectMode?1:R!==R?M.flowing&&M.length?M.buffer.head.data.length:M.length:(R>M.highWaterMark&&(M.highWaterMark=Fe(R)),R<=M.length?R:M.ended?M.length:(M.needReadable=!0,0))}W.prototype.read=function(R){I("read",R),R=parseInt(R,10);var M=this._readableState,pe=R;if(R!==0&&(M.emittedReadable=!1),R===0&&M.needReadable&&(M.length>=M.highWaterMark||M.ended))return I("read: emitReadable",M.length,M.ended),M.length===0&&M.ended?Ge(this):Ce(this),null;if(R=ee(R,M),R===0&&M.ended)return M.length===0&&Ge(this),null;var _e=M.needReadable;I("need readable",_e),(M.length===0||M.length-R<M.highWaterMark)&&(_e=!0,I("length less than watermark",_e)),M.ended||M.reading?(_e=!1,I("reading or ended",_e)):_e&&(I("do read"),M.reading=!0,M.sync=!0,M.length===0&&(M.needReadable=!0),this._read(M.highWaterMark),M.sync=!1,M.reading||(R=ee(pe,M)));var Ve;return R>0?Ve=Te(R,M):Ve=null,Ve===null?(M.needReadable=!0,R=0):M.length-=R,M.length===0&&(M.ended||(M.needReadable=!0),pe!==R&&M.ended&&Ge(this)),Ve!==null&&this.emit("data",Ve),Ve};function ye(R,M){var pe=null;return!w.isBuffer(M)&&typeof M!="string"&&M!==null&&M!==void 0&&!R.objectMode&&(pe=new TypeError("Invalid non-string/buffer chunk")),pe}function fe(R,M){if(!M.ended){if(M.decoder){var pe=M.decoder.end();pe&&pe.length&&(M.buffer.push(pe),M.length+=M.objectMode?1:pe.length)}M.ended=!0,Ce(R)}}function Ce(R){var M=R._readableState;M.needReadable=!1,M.emittedReadable||(I("emitReadable",M.flowing),M.emittedReadable=!0,M.sync?p(Re,R):Re(R))}function Re(R){I("emit readable"),R.emit("readable"),ne(R)}function ot(R,M){M.readingMore||(M.readingMore=!0,p(Z,R,M))}function Z(R,M){for(var pe=M.length;!M.reading&&!M.flowing&&!M.ended&&M.length<M.highWaterMark&&(I("maybeReadMore read 0"),R.read(0),pe!==M.length);)pe=M.length;M.readingMore=!1}W.prototype._read=function(R){this.emit("error",new Error("_read() is not implemented"))},W.prototype.pipe=function(R,M){var pe=this,_e=this._readableState;switch(_e.pipesCount){case 0:_e.pipes=R;break;case 1:_e.pipes=[_e.pipes,R];break;default:_e.pipes.push(R);break}_e.pipesCount+=1,I("pipe count=%d opts=%j",_e.pipesCount,M);var Ve=(!M||M.end!==!1)&&R!==a.stdout&&R!==a.stderr,ve=Ve?We:rt;_e.endEmitted?p(ve):pe.once("end",ve),R.on("unpipe",Ye);function Ye(ge){I("onunpipe"),ge===pe&&rt()}function We(){I("onend"),R.end()}var xt=ze(pe);R.on("drain",xt);var Et=!1;function rt(){I("cleanup"),R.removeListener("close",D),R.removeListener("finish",X),R.removeListener("drain",xt),R.removeListener("error",A),R.removeListener("unpipe",Ye),pe.removeListener("end",We),pe.removeListener("end",rt),pe.removeListener("data",O),Et=!0,_e.awaitDrain&&(!R._writableState||R._writableState.needDrain)&&xt()}var L=!1;pe.on("data",O);function O(ge){I("ondata"),L=!1;var nt=R.write(ge);nt===!1&&!L&&((_e.pipesCount===1&&_e.pipes===R||_e.pipesCount>1&&Tt(_e.pipes,R)!==-1)&&!Et&&(I("false write response, pause",pe._readableState.awaitDrain),pe._readableState.awaitDrain++,L=!0),pe.pause())}function A(ge){I("onerror",ge),se(),R.removeListener("error",A),v(R,"error")===0&&R.emit("error",ge)}H(R,"error",A);function D(){R.removeListener("finish",X),se()}R.once("close",D);function X(){I("onfinish"),R.removeListener("close",D),se()}R.once("finish",X);function se(){I("unpipe"),pe.unpipe(R)}return R.emit("pipe",pe),_e.flowing||(I("pipe resume"),pe.resume()),R};function ze(R){return function(){var M=R._readableState;I("pipeOnDrain",M.awaitDrain),M.awaitDrain&&M.awaitDrain--,M.awaitDrain===0&&v(R,"data")&&(M.flowing=!0,ne(R))}}W.prototype.unpipe=function(R){var M=this._readableState;if(M.pipesCount===0)return this;if(M.pipesCount===1)return R&&R!==M.pipes?this:(R||(R=M.pipes),M.pipes=null,M.pipesCount=0,M.flowing=!1,R&&R.emit("unpipe",this),this);if(!R){var pe=M.pipes,_e=M.pipesCount;M.pipes=null,M.pipesCount=0,M.flowing=!1;for(var Ve=0;Ve<_e;Ve++)pe[Ve].emit("unpipe",this);return this}var ve=Tt(M.pipes,R);return ve===-1?this:(M.pipes.splice(ve,1),M.pipesCount-=1,M.pipesCount===1&&(M.pipes=M.pipes[0]),R.emit("unpipe",this),this)},W.prototype.on=function(R,M){var pe=h.prototype.on.call(this,R,M);if(R==="data")this._readableState.flowing!==!1&&this.resume();else if(R==="readable"){var _e=this._readableState;!_e.endEmitted&&!_e.readableListening&&(_e.readableListening=_e.needReadable=!0,_e.emittedReadable=!1,_e.reading?_e.length&&Ce(this,_e):p(ht,this))}return pe},W.prototype.addListener=W.prototype.on;function ht(R){I("readable nexttick read 0"),R.read(0)}W.prototype.resume=function(){var R=this._readableState;return R.flowing||(I("resume"),R.flowing=!0,te(this,R)),this};function te(R,M){M.resumeScheduled||(M.resumeScheduled=!0,p(K,R,M))}function K(R,M){M.reading||(I("resume read 0"),R.read(0)),M.resumeScheduled=!1,M.awaitDrain=0,R.emit("resume"),ne(R),M.flowing&&!M.reading&&R.read(0)}W.prototype.pause=function(){return I("call pause flowing=%j",this._readableState.flowing),this._readableState.flowing!==!1&&(I("pause"),this._readableState.flowing=!1,this.emit("pause")),this};function ne(R){var M=R._readableState;for(I("flow",M.flowing);M.flowing&&R.read()!==null;);}W.prototype.wrap=function(R){var M=this._readableState,pe=!1,_e=this;R.on("end",function(){if(I("wrapped end"),M.decoder&&!M.ended){var Ye=M.decoder.end();Ye&&Ye.length&&_e.push(Ye)}_e.push(null)}),R.on("data",function(Ye){if(I("wrapped data"),M.decoder&&(Ye=M.decoder.write(Ye)),!(M.objectMode&&Ye==null)&&!(!M.objectMode&&(!Ye||!Ye.length))){var We=_e.push(Ye);We||(pe=!0,R.pause())}});for(var Ve in R)this[Ve]===void 0&&typeof R[Ve]=="function"&&(this[Ve]=function(Ye){return function(){return R[Ye].apply(R,arguments)}}(Ve));var ve=["error","close","destroy","pause","resume"];return Y(ve,function(Ye){R.on(Ye,_e.emit.bind(_e,Ye))}),_e._read=function(Ye){I("wrapped _read",Ye),pe&&(pe=!1,R.resume())},_e},W._fromList=Te;function Te(R,M){if(M.length===0)return null;var pe;return M.objectMode?pe=M.buffer.shift():!R||R>=M.length?(M.decoder?pe=M.buffer.join(""):M.buffer.length===1?pe=M.buffer.head.data:pe=M.buffer.concat(M.length),M.buffer.clear()):pe=He(R,M.buffer,M.decoder),pe}function He(R,M,pe){var _e;return R<M.head.data.length?(_e=M.head.data.slice(0,R),M.head.data=M.head.data.slice(R)):R===M.head.data.length?_e=M.shift():_e=pe?qe(R,M):Me(R,M),_e}function qe(R,M){var pe=M.head,_e=1,Ve=pe.data;for(R-=Ve.length;pe=pe.next;){var ve=pe.data,Ye=R>ve.length?ve.length:R;if(Ye===ve.length?Ve+=ve:Ve+=ve.slice(0,R),R-=Ye,R===0){Ye===ve.length?(++_e,pe.next?M.head=pe.next:M.head=M.tail=null):(M.head=pe,pe.data=ve.slice(Ye));break}++_e}return M.length-=_e,Ve}function Me(R,M){var pe=_.allocUnsafe(R),_e=M.head,Ve=1;for(_e.data.copy(pe),R-=_e.data.length;_e=_e.next;){var ve=_e.data,Ye=R>ve.length?ve.length:R;if(ve.copy(pe,pe.length-R,0,Ye),R-=Ye,R===0){Ye===ve.length?(++Ve,_e.next?M.head=_e.next:M.head=M.tail=null):(M.head=_e,_e.data=ve.slice(Ye));break}++Ve}return M.length-=Ve,pe}function Ge(R){var M=R._readableState;if(M.length>0)throw new Error('"endReadable()" called on non-empty stream');M.endEmitted||(M.ended=!0,p(gt,M,R))}function gt(R,M){!R.endEmitted&&R.length===0&&(R.endEmitted=!0,M.readable=!1,M.emit("end"))}function Y(R,M){for(var pe=0,_e=R.length;pe<_e;pe++)M(R[pe],pe)}function Tt(R,M){for(var pe=0,_e=R.length;pe<_e;pe++)if(R[pe]===M)return pe;return-1}}).call(i,n(6))},function(r,i,n){(function(a){"use strict";!a.version||a.version.indexOf("v0.")===0||a.version.indexOf("v1.")===0&&a.version.indexOf("v1.8.")!==0?r.exports=p:r.exports=a.nextTick;function p(d,y,b,v){if(typeof d!="function")throw new TypeError('"callback" argument must be a function');var h=arguments.length,w,_;switch(h){case 0:case 1:return a.nextTick(d);case 2:return a.nextTick(function(){d.call(null,y)});case 3:return a.nextTick(function(){d.call(null,y,b)});case 4:return a.nextTick(function(){d.call(null,y,b,v)});default:for(w=new Array(h-1),_=0;_<w.length;)w[_++]=arguments[_];return a.nextTick(function(){d.apply(null,w)})}}}).call(i,n(6))},function(r,i){var n={}.toString;r.exports=Array.isArray||function(a){return n.call(a)=="[object Array]"}},function(r,i,n){(function(a){"use strict";var p=n(2),d=p.Buffer,y=p.SlowBuffer,b=p.kMaxLength||2147483647;i.alloc=function(h,w,_){if(typeof d.alloc=="function")return d.alloc(h,w,_);if(typeof _=="number")throw new TypeError("encoding must not be number");if(typeof h!="number")throw new TypeError("size must be a number");if(h>b)throw new RangeError("size is too large");var T=_,C=w;C===void 0&&(T=void 0,C=0);var I=new d(h);if(typeof C=="string")for(var P=new d(C,T),U=P.length,H=-1;++H<h;)I[H]=P[H%U];else I.fill(C);return I},i.allocUnsafe=function(h){if(typeof d.allocUnsafe=="function")return d.allocUnsafe(h);if(typeof h!="number")throw new TypeError("size must be a number");if(h>b)throw new RangeError("size is too large");return new d(h)},i.from=function(h,w,_){if(typeof d.from=="function"&&(!a.Uint8Array||Uint8Array.from!==d.from))return d.from(h,w,_);if(typeof h=="number")throw new TypeError('"value" argument must not be a number');if(typeof h=="string")return new d(h,w);if(typeof ArrayBuffer<"u"&&h instanceof ArrayBuffer){var T=w;if(arguments.length===1)return new d(h);typeof T>"u"&&(T=0);var C=_;if(typeof C>"u"&&(C=h.byteLength-T),T>=h.byteLength)throw new RangeError("'offset' is out of bounds");if(C>h.byteLength-T)throw new RangeError("'length' is out of bounds");return new d(h.slice(T,T+C))}if(d.isBuffer(h)){var I=new d(h.length);return h.copy(I,0,0,h.length),I}if(h){if(Array.isArray(h)||typeof ArrayBuffer<"u"&&h.buffer instanceof ArrayBuffer||"length"in h)return new d(h);if(h.type==="Buffer"&&Array.isArray(h.data))return new d(h.data)}throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")},i.allocUnsafeSlow=function(h){if(typeof d.allocUnsafeSlow=="function")return d.allocUnsafeSlow(h);if(typeof h!="number")throw new TypeError("size must be a number");if(h>=b)throw new RangeError("size is too large");return new y(h)}}).call(i,function(){return this}())},function(r,i,n){(function(a){function p(W){return Array.isArray?Array.isArray(W):Q(W)==="[object Array]"}i.isArray=p;function d(W){return typeof W=="boolean"}i.isBoolean=d;function y(W){return W===null}i.isNull=y;function b(W){return W==null}i.isNullOrUndefined=b;function v(W){return typeof W=="number"}i.isNumber=v;function h(W){return typeof W=="string"}i.isString=h;function w(W){return typeof W=="symbol"}i.isSymbol=w;function _(W){return W===void 0}i.isUndefined=_;function T(W){return Q(W)==="[object RegExp]"}i.isRegExp=T;function C(W){return typeof W=="object"&&W!==null}i.isObject=C;function I(W){return Q(W)==="[object Date]"}i.isDate=I;function P(W){return Q(W)==="[object Error]"||W instanceof Error}i.isError=P;function U(W){return typeof W=="function"}i.isFunction=U;function H(W){return W===null||typeof W=="boolean"||typeof W=="number"||typeof W=="string"||typeof W=="symbol"||typeof W>"u"}i.isPrimitive=H,i.isBuffer=a.isBuffer;function Q(W){return Object.prototype.toString.call(W)}}).call(i,n(1))},function(r,i){},function(r,i,n){"use strict";var a=n(2).Buffer,p=n(17);r.exports=d;function d(){this.head=null,this.tail=null,this.length=0}d.prototype.push=function(y){var b={data:y,next:null};this.length>0?this.tail.next=b:this.head=b,this.tail=b,++this.length},d.prototype.unshift=function(y){var b={data:y,next:this.head};this.length===0&&(this.tail=b),this.head=b,++this.length},d.prototype.shift=function(){if(this.length!==0){var y=this.head.data;return this.length===1?this.head=this.tail=null:this.head=this.head.next,--this.length,y}},d.prototype.clear=function(){this.head=this.tail=null,this.length=0},d.prototype.join=function(y){if(this.length===0)return"";for(var b=this.head,v=""+b.data;b=b.next;)v+=y+b.data;return v},d.prototype.concat=function(y){if(this.length===0)return p.alloc(0);if(this.length===1)return this.head.data;for(var b=p.allocUnsafe(y>>>0),v=this.head,h=0;v;)v.data.copy(b,h),h+=v.data.length,v=v.next;return b}},function(r,i,n){"use strict";var a=Object.keys||function(P){var U=[];for(var H in P)U.push(H);return U};r.exports=_;var p=n(15),d=n(18);d.inherits=n(12);var y=n(14),b=n(22);d.inherits(_,y);for(var v=a(b.prototype),h=0;h<v.length;h++){var w=v[h];_.prototype[w]||(_.prototype[w]=b.prototype[w])}function _(P){if(!(this instanceof _))return new _(P);y.call(this,P),b.call(this,P),P&&P.readable===!1&&(this.readable=!1),P&&P.writable===!1&&(this.writable=!1),this.allowHalfOpen=!0,P&&P.allowHalfOpen===!1&&(this.allowHalfOpen=!1),this.once("end",T)}function T(){this.allowHalfOpen||this._writableState.ended||p(C,this)}function C(P){P.end()}function I(P,U){for(var H=0,Q=P.length;H<Q;H++)U(P[H],H)}},function(r,i,n){(function(a){"use strict";r.exports=U;var p=n(15),d=!a.browser&&["v0.10","v0.9."].indexOf(a.version.slice(0,5))>-1?setImmediate:p,y;U.WritableState=I;var b=n(18);b.inherits=n(12);var v={deprecate:n(23)},h;(function(){try{h=n(11)}catch{}finally{h||(h=n(8).EventEmitter)}})();var w=n(2).Buffer,_=n(17);b.inherits(U,h);function T(){}function C(te,K,ne){this.chunk=te,this.encoding=K,this.callback=ne,this.next=null}function I(te,K){y=y||n(21),te=te||{},this.objectMode=!!te.objectMode,K instanceof y&&(this.objectMode=this.objectMode||!!te.writableObjectMode);var ne=te.highWaterMark,Te=this.objectMode?16:16*1024;this.highWaterMark=ne||ne===0?ne:Te,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var He=te.decodeStrings===!1;this.decodeStrings=!He,this.defaultEncoding=te.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(qe){ee(K,qe)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new ht(this)}I.prototype.getBuffer=function(){for(var K=this.bufferedRequest,ne=[];K;)ne.push(K),K=K.next;return ne},function(){try{Object.defineProperty(I.prototype,"buffer",{get:v.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")})}catch{}}();var P;typeof Symbol=="function"&&Symbol.hasInstance&&typeof Function.prototype[Symbol.hasInstance]=="function"?(P=Function.prototype[Symbol.hasInstance],Object.defineProperty(U,Symbol.hasInstance,{value:function(te){return P.call(this,te)?!0:te&&te._writableState instanceof I}})):P=function(te){return te instanceof this};function U(te){if(y=y||n(21),!P.call(U,this)&&!(this instanceof y))return new U(te);this._writableState=new I(te,this),this.writable=!0,te&&(typeof te.write=="function"&&(this._write=te.write),typeof te.writev=="function"&&(this._writev=te.writev)),h.call(this)}U.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))};function H(te,K){var ne=new Error("write after end");te.emit("error",ne),p(K,ne)}function Q(te,K,ne,Te){var He=!0,qe=!1;return ne===null?qe=new TypeError("May not write null values to stream"):typeof ne!="string"&&ne!==void 0&&!K.objectMode&&(qe=new TypeError("Invalid non-string/buffer chunk")),qe&&(te.emit("error",qe),p(Te,qe),He=!1),He}U.prototype.write=function(te,K,ne){var Te=this._writableState,He=!1,qe=w.isBuffer(te);return typeof K=="function"&&(ne=K,K=null),qe?K="buffer":K||(K=Te.defaultEncoding),typeof ne!="function"&&(ne=T),Te.ended?H(this,ne):(qe||Q(this,Te,te,ne))&&(Te.pendingcb++,He=Be(this,Te,qe,te,K,ne)),He},U.prototype.cork=function(){var te=this._writableState;te.corked++},U.prototype.uncork=function(){var te=this._writableState;te.corked&&(te.corked--,!te.writing&&!te.corked&&!te.finished&&!te.bufferProcessing&&te.bufferedRequest&&Ce(this,te))},U.prototype.setDefaultEncoding=function(K){if(typeof K=="string"&&(K=K.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((K+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+K);return this._writableState.defaultEncoding=K,this};function W(te,K,ne){return!te.objectMode&&te.decodeStrings!==!1&&typeof K=="string"&&(K=_.from(K,ne)),K}function Be(te,K,ne,Te,He,qe){ne||(Te=W(K,Te,He),w.isBuffer(Te)&&(He="buffer"));var Me=K.objectMode?1:Te.length;K.length+=Me;var Ge=K.length<K.highWaterMark;if(Ge||(K.needDrain=!0),K.writing||K.corked){var gt=K.lastBufferedRequest;K.lastBufferedRequest=new C(Te,He,qe),gt?gt.next=K.lastBufferedRequest:K.bufferedRequest=K.lastBufferedRequest,K.bufferedRequestCount+=1}else re(te,K,!1,Me,Te,He,qe);return Ge}function re(te,K,ne,Te,He,qe,Me){K.writelen=Te,K.writecb=Me,K.writing=!0,K.sync=!0,ne?te._writev(He,K.onwrite):te._write(He,qe,K.onwrite),K.sync=!1}function me(te,K,ne,Te,He){--K.pendingcb,ne?p(He,Te):He(Te),te._writableState.errorEmitted=!0,te.emit("error",Te)}function Fe(te){te.writing=!1,te.writecb=null,te.length-=te.writelen,te.writelen=0}function ee(te,K){var ne=te._writableState,Te=ne.sync,He=ne.writecb;if(Fe(ne),K)me(te,ne,Te,K,He);else{var qe=Re(ne);!qe&&!ne.corked&&!ne.bufferProcessing&&ne.bufferedRequest&&Ce(te,ne),Te?d(ye,te,ne,qe,He):ye(te,ne,qe,He)}}function ye(te,K,ne,Te){ne||fe(te,K),K.pendingcb--,Te(),Z(te,K)}function fe(te,K){K.length===0&&K.needDrain&&(K.needDrain=!1,te.emit("drain"))}function Ce(te,K){K.bufferProcessing=!0;var ne=K.bufferedRequest;if(te._writev&&ne&&ne.next){var Te=K.bufferedRequestCount,He=new Array(Te),qe=K.corkedRequestsFree;qe.entry=ne;for(var Me=0;ne;)He[Me]=ne,ne=ne.next,Me+=1;re(te,K,!0,K.length,He,"",qe.finish),K.pendingcb++,K.lastBufferedRequest=null,qe.next?(K.corkedRequestsFree=qe.next,qe.next=null):K.corkedRequestsFree=new ht(K)}else{for(;ne;){var Ge=ne.chunk,gt=ne.encoding,Y=ne.callback,Tt=K.objectMode?1:Ge.length;if(re(te,K,!1,Tt,Ge,gt,Y),ne=ne.next,K.writing)break}ne===null&&(K.lastBufferedRequest=null)}K.bufferedRequestCount=0,K.bufferedRequest=ne,K.bufferProcessing=!1}U.prototype._write=function(te,K,ne){ne(new Error("_write() is not implemented"))},U.prototype._writev=null,U.prototype.end=function(te,K,ne){var Te=this._writableState;typeof te=="function"?(ne=te,te=null,K=null):typeof K=="function"&&(ne=K,K=null),te!=null&&this.write(te,K),Te.corked&&(Te.corked=1,this.uncork()),!Te.ending&&!Te.finished&&ze(this,Te,ne)};function Re(te){return te.ending&&te.length===0&&te.bufferedRequest===null&&!te.finished&&!te.writing}function ot(te,K){K.prefinished||(K.prefinished=!0,te.emit("prefinish"))}function Z(te,K){var ne=Re(K);return ne&&(K.pendingcb===0?(ot(te,K),K.finished=!0,te.emit("finish")):ot(te,K)),ne}function ze(te,K,ne){K.ending=!0,Z(te,K),ne&&(K.finished?p(ne):te.once("finish",ne)),K.ended=!0,te.writable=!1}function ht(te){var K=this;this.next=null,this.entry=null,this.finish=function(ne){var Te=K.entry;for(K.entry=null;Te;){var He=Te.callback;te.pendingcb--,He(ne),Te=Te.next}te.corkedRequestsFree?te.corkedRequestsFree.next=K:te.corkedRequestsFree=K}}}).call(i,n(6))},function(r,i){(function(n){r.exports=a;function a(d,y){if(p("noDeprecation"))return d;var b=!1;function v(){if(!b){if(p("throwDeprecation"))throw new Error(y);p("traceDeprecation")?console.trace(y):console.warn(y),b=!0}return d.apply(this,arguments)}return v}function p(d){try{if(!n.localStorage)return!1}catch{return!1}var y=n.localStorage[d];return y==null?!1:String(y).toLowerCase()==="true"}}).call(i,function(){return this}())},function(r,i,n){var a=n(2).Buffer,p=a.isEncoding||function(w){switch(w&&w.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function d(w){if(w&&!p(w))throw new Error("Unknown encoding: "+w)}var y=i.StringDecoder=function(w){switch(this.encoding=(w||"utf8").toLowerCase().replace(/[-_]/,""),d(w),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=v;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=h;break;default:this.write=b;return}this.charBuffer=new a(6),this.charReceived=0,this.charLength=0};y.prototype.write=function(w){for(var _="";this.charLength;){var T=w.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:w.length;if(w.copy(this.charBuffer,this.charReceived,0,T),this.charReceived+=T,this.charReceived<this.charLength)return"";w=w.slice(T,w.length),_=this.charBuffer.slice(0,this.charLength).toString(this.encoding);var I=_.charCodeAt(_.length-1);if(I>=55296&&I<=56319){this.charLength+=this.surrogateSize,_="";continue}if(this.charReceived=this.charLength=0,w.length===0)return _;break}this.detectIncompleteChar(w);var C=w.length;this.charLength&&(w.copy(this.charBuffer,0,w.length-this.charReceived,C),C-=this.charReceived),_+=w.toString(this.encoding,0,C);var C=_.length-1,I=_.charCodeAt(C);if(I>=55296&&I<=56319){var P=this.surrogateSize;return this.charLength+=P,this.charReceived+=P,this.charBuffer.copy(this.charBuffer,P,0,P),w.copy(this.charBuffer,0,0,P),_.substring(0,C)}return _},y.prototype.detectIncompleteChar=function(w){for(var _=w.length>=3?3:w.length;_>0;_--){var T=w[w.length-_];if(_==1&&T>>5==6){this.charLength=2;break}if(_<=2&&T>>4==14){this.charLength=3;break}if(_<=3&&T>>3==30){this.charLength=4;break}}this.charReceived=_},y.prototype.end=function(w){var _="";if(w&&w.length&&(_=this.write(w)),this.charReceived){var T=this.charReceived,C=this.charBuffer,I=this.encoding;_+=C.slice(0,T).toString(I)}return _};function b(w){return w.toString(this.encoding)}function v(w){this.charReceived=w.length%2,this.charLength=this.charReceived?2:0}function h(w){this.charReceived=w.length%3,this.charLength=this.charReceived?3:0}},function(r,i,n){"use strict";r.exports=b;var a=n(21),p=n(18);p.inherits=n(12),p.inherits(b,a);function d(h){this.afterTransform=function(w,_){return y(h,w,_)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function y(h,w,_){var T=h._transformState;T.transforming=!1;var C=T.writecb;if(!C)return h.emit("error",new Error("no writecb in Transform class"));T.writechunk=null,T.writecb=null,_!=null&&h.push(_),C(w);var I=h._readableState;I.reading=!1,(I.needReadable||I.length<I.highWaterMark)&&h._read(I.highWaterMark)}function b(h){if(!(this instanceof b))return new b(h);a.call(this,h),this._transformState=new d(this);var w=this;this._readableState.needReadable=!0,this._readableState.sync=!1,h&&(typeof h.transform=="function"&&(this._transform=h.transform),typeof h.flush=="function"&&(this._flush=h.flush)),this.once("prefinish",function(){typeof this._flush=="function"?this._flush(function(_,T){v(w,_,T)}):v(w)})}b.prototype.push=function(h,w){return this._transformState.needTransform=!1,a.prototype.push.call(this,h,w)},b.prototype._transform=function(h,w,_){throw new Error("_transform() is not implemented")},b.prototype._write=function(h,w,_){var T=this._transformState;if(T.writecb=_,T.writechunk=h,T.writeencoding=w,!T.transforming){var C=this._readableState;(T.needTransform||C.needReadable||C.length<C.highWaterMark)&&this._read(C.highWaterMark)}},b.prototype._read=function(h){var w=this._transformState;w.writechunk!==null&&w.writecb&&!w.transforming?(w.transforming=!0,this._transform(w.writechunk,w.writeencoding,w.afterTransform)):w.needTransform=!0};function v(h,w,_){if(w)return h.emit("error",w);_!=null&&h.push(_);var T=h._writableState,C=h._transformState;if(T.length)throw new Error("Calling transform done when ws.length != 0");if(C.transforming)throw new Error("Calling transform done when still transforming");return h.push(null)}},function(r,i,n){"use strict";r.exports=d;var a=n(25),p=n(18);p.inherits=n(12),p.inherits(d,a);function d(y){if(!(this instanceof d))return new d(y);a.call(this,y)}d.prototype._transform=function(y,b,v){v(null,y)}},function(r,i,n){r.exports=n(22)},function(r,i,n){r.exports=n(21)},function(r,i,n){r.exports=n(25)},function(r,i,n){r.exports=n(26)},function(r,i,n){"use strict";var a=n(32),p=n(33),d=n(38),y=n(39),b=n(40),v=n(41),h=n(42),w=Object.prototype.toString;function _(I){if(!(this instanceof _))return new _(I);this.options=p.assign({chunkSize:16384,windowBits:0,to:""},I||{});var P=this.options;P.raw&&P.windowBits>=0&&P.windowBits<16&&(P.windowBits=-P.windowBits,P.windowBits===0&&(P.windowBits=-15)),P.windowBits>=0&&P.windowBits<16&&!(I&&I.windowBits)&&(P.windowBits+=32),P.windowBits>15&&P.windowBits<48&&(P.windowBits&15||(P.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new v,this.strm.avail_out=0;var U=a.inflateInit2(this.strm,P.windowBits);if(U!==y.Z_OK)throw new Error(b[U]);this.header=new h,a.inflateGetHeader(this.strm,this.header)}_.prototype.push=function(I,P){var U=this.strm,H=this.options.chunkSize,Q=this.options.dictionary,W,Be,re,me,Fe,ee,ye=!1;if(this.ended)return!1;Be=P===~~P?P:P===!0?y.Z_FINISH:y.Z_NO_FLUSH,typeof I=="string"?U.input=d.binstring2buf(I):w.call(I)==="[object ArrayBuffer]"?U.input=new Uint8Array(I):U.input=I,U.next_in=0,U.avail_in=U.input.length;do{if(U.avail_out===0&&(U.output=new p.Buf8(H),U.next_out=0,U.avail_out=H),W=a.inflate(U,y.Z_NO_FLUSH),W===y.Z_NEED_DICT&&Q&&(typeof Q=="string"?ee=d.string2buf(Q):w.call(Q)==="[object ArrayBuffer]"?ee=new Uint8Array(Q):ee=Q,W=a.inflateSetDictionary(this.strm,ee)),W===y.Z_BUF_ERROR&&ye===!0&&(W=y.Z_OK,ye=!1),W!==y.Z_STREAM_END&&W!==y.Z_OK)return this.onEnd(W),this.ended=!0,!1;U.next_out&&(U.avail_out===0||W===y.Z_STREAM_END||U.avail_in===0&&(Be===y.Z_FINISH||Be===y.Z_SYNC_FLUSH))&&(this.options.to==="string"?(re=d.utf8border(U.output,U.next_out),me=U.next_out-re,Fe=d.buf2string(U.output,re),U.next_out=me,U.avail_out=H-me,me&&p.arraySet(U.output,U.output,re,me,0),this.onData(Fe)):this.onData(p.shrinkBuf(U.output,U.next_out))),U.avail_in===0&&U.avail_out===0&&(ye=!0)}while((U.avail_in>0||U.avail_out===0)&&W!==y.Z_STREAM_END);return W===y.Z_STREAM_END&&(Be=y.Z_FINISH),Be===y.Z_FINISH?(W=a.inflateEnd(this.strm),this.onEnd(W),this.ended=!0,W===y.Z_OK):(Be===y.Z_SYNC_FLUSH&&(this.onEnd(y.Z_OK),U.avail_out=0),!0)},_.prototype.onData=function(I){this.chunks.push(I)},_.prototype.onEnd=function(I){I===y.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=p.flattenChunks(this.chunks)),this.chunks=[],this.err=I,this.msg=this.strm.msg};function T(I,P){var U=new _(P);if(U.push(I,!0),U.err)throw U.msg||b[U.err];return U.result}function C(I,P){return P=P||{},P.raw=!0,T(I,P)}i.Inflate=_,i.inflate=T,i.inflateRaw=C,i.ungzip=T},function(r,i,n){"use strict";var a=n(33),p=n(34),d=n(35),y=n(36),b=n(37),v=0,h=1,w=2,_=4,T=5,C=6,I=0,P=1,U=2,H=-2,Q=-3,W=-4,Be=-5,re=8,me=1,Fe=2,ee=3,ye=4,fe=5,Ce=6,Re=7,ot=8,Z=9,ze=10,ht=11,te=12,K=13,ne=14,Te=15,He=16,qe=17,Me=18,Ge=19,gt=20,Y=21,Tt=22,R=23,M=24,pe=25,_e=26,Ve=27,ve=28,Ye=29,We=30,xt=31,Et=32,rt=852,L=592,O=15,A=O;function D(ie){return(ie>>>24&255)+(ie>>>8&65280)+((ie&65280)<<8)+((ie&255)<<24)}function X(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function se(ie){var Ae;return!ie||!ie.state?H:(Ae=ie.state,ie.total_in=ie.total_out=Ae.total=0,ie.msg="",Ae.wrap&&(ie.adler=Ae.wrap&1),Ae.mode=me,Ae.last=0,Ae.havedict=0,Ae.dmax=32768,Ae.head=null,Ae.hold=0,Ae.bits=0,Ae.lencode=Ae.lendyn=new a.Buf32(rt),Ae.distcode=Ae.distdyn=new a.Buf32(L),Ae.sane=1,Ae.back=-1,I)}function ge(ie){var Ae;return!ie||!ie.state?H:(Ae=ie.state,Ae.wsize=0,Ae.whave=0,Ae.wnext=0,se(ie))}function nt(ie,Ae){var j,Le;return!ie||!ie.state||(Le=ie.state,Ae<0?(j=0,Ae=-Ae):(j=(Ae>>4)+1,Ae<48&&(Ae&=15)),Ae&&(Ae<8||Ae>15))?H:(Le.window!==null&&Le.wbits!==Ae&&(Le.window=null),Le.wrap=j,Le.wbits=Ae,ge(ie))}function ct(ie,Ae){var j,Le;return ie?(Le=new X,ie.state=Le,Le.window=null,j=nt(ie,Ae),j!==I&&(ie.state=null),j):H}function mt(ie){return ct(ie,A)}var Bt=!0,yt,ar;function Wr(ie){if(Bt){var Ae;for(yt=new a.Buf32(512),ar=new a.Buf32(32),Ae=0;Ae<144;)ie.lens[Ae++]=8;for(;Ae<256;)ie.lens[Ae++]=9;for(;Ae<280;)ie.lens[Ae++]=7;for(;Ae<288;)ie.lens[Ae++]=8;for(b(h,ie.lens,0,288,yt,0,ie.work,{bits:9}),Ae=0;Ae<32;)ie.lens[Ae++]=5;b(w,ie.lens,0,32,ar,0,ie.work,{bits:5}),Bt=!1}ie.lencode=yt,ie.lenbits=9,ie.distcode=ar,ie.distbits=5}function jr(ie,Ae,j,Le){var _t,Ne=ie.state;return Ne.window===null&&(Ne.wsize=1<<Ne.wbits,Ne.wnext=0,Ne.whave=0,Ne.window=new a.Buf8(Ne.wsize)),Le>=Ne.wsize?(a.arraySet(Ne.window,Ae,j-Ne.wsize,Ne.wsize,0),Ne.wnext=0,Ne.whave=Ne.wsize):(_t=Ne.wsize-Ne.wnext,_t>Le&&(_t=Le),a.arraySet(Ne.window,Ae,j-Le,_t,Ne.wnext),Le-=_t,Le?(a.arraySet(Ne.window,Ae,j-Le,Le,0),Ne.wnext=Le,Ne.whave=Ne.wsize):(Ne.wnext+=_t,Ne.wnext===Ne.wsize&&(Ne.wnext=0),Ne.whave<Ne.wsize&&(Ne.whave+=_t))),0}function $(ie,Ae){var j,Le,_t,Ne,Xt,je,Rt,ue,de,Gr,Ot,Ue,Lr,kr,vt=0,Qe,Ft,Mt,Ct,yr,Dr,wt,jt,it=new a.Buf8(4),tr,sr,Ei=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!ie||!ie.state||!ie.output||!ie.input&&ie.avail_in!==0)return H;j=ie.state,j.mode===te&&(j.mode=K),Xt=ie.next_out,_t=ie.output,Rt=ie.avail_out,Ne=ie.next_in,Le=ie.input,je=ie.avail_in,ue=j.hold,de=j.bits,Gr=je,Ot=Rt,jt=I;e:for(;;)switch(j.mode){case me:if(j.wrap===0){j.mode=K;break}for(;de<16;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(j.wrap&2&&ue===35615){j.check=0,it[0]=ue&255,it[1]=ue>>>8&255,j.check=d(j.check,it,2,0),ue=0,de=0,j.mode=Fe;break}if(j.flags=0,j.head&&(j.head.done=!1),!(j.wrap&1)||(((ue&255)<<8)+(ue>>8))%31){ie.msg="incorrect header check",j.mode=We;break}if((ue&15)!==re){ie.msg="unknown compression method",j.mode=We;break}if(ue>>>=4,de-=4,wt=(ue&15)+8,j.wbits===0)j.wbits=wt;else if(wt>j.wbits){ie.msg="invalid window size",j.mode=We;break}j.dmax=1<<wt,ie.adler=j.check=1,j.mode=ue&512?ze:te,ue=0,de=0;break;case Fe:for(;de<16;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(j.flags=ue,(j.flags&255)!==re){ie.msg="unknown compression method",j.mode=We;break}if(j.flags&57344){ie.msg="unknown header flags set",j.mode=We;break}j.head&&(j.head.text=ue>>8&1),j.flags&512&&(it[0]=ue&255,it[1]=ue>>>8&255,j.check=d(j.check,it,2,0)),ue=0,de=0,j.mode=ee;case ee:for(;de<32;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}j.head&&(j.head.time=ue),j.flags&512&&(it[0]=ue&255,it[1]=ue>>>8&255,it[2]=ue>>>16&255,it[3]=ue>>>24&255,j.check=d(j.check,it,4,0)),ue=0,de=0,j.mode=ye;case ye:for(;de<16;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}j.head&&(j.head.xflags=ue&255,j.head.os=ue>>8),j.flags&512&&(it[0]=ue&255,it[1]=ue>>>8&255,j.check=d(j.check,it,2,0)),ue=0,de=0,j.mode=fe;case fe:if(j.flags&1024){for(;de<16;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}j.length=ue,j.head&&(j.head.extra_len=ue),j.flags&512&&(it[0]=ue&255,it[1]=ue>>>8&255,j.check=d(j.check,it,2,0)),ue=0,de=0}else j.head&&(j.head.extra=null);j.mode=Ce;case Ce:if(j.flags&1024&&(Ue=j.length,Ue>je&&(Ue=je),Ue&&(j.head&&(wt=j.head.extra_len-j.length,j.head.extra||(j.head.extra=new Array(j.head.extra_len)),a.arraySet(j.head.extra,Le,Ne,Ue,wt)),j.flags&512&&(j.check=d(j.check,Le,Ue,Ne)),je-=Ue,Ne+=Ue,j.length-=Ue),j.length))break e;j.length=0,j.mode=Re;case Re:if(j.flags&2048){if(je===0)break e;Ue=0;do wt=Le[Ne+Ue++],j.head&&wt&&j.length<65536&&(j.head.name+=String.fromCharCode(wt));while(wt&&Ue<je);if(j.flags&512&&(j.check=d(j.check,Le,Ue,Ne)),je-=Ue,Ne+=Ue,wt)break e}else j.head&&(j.head.name=null);j.length=0,j.mode=ot;case ot:if(j.flags&4096){if(je===0)break e;Ue=0;do wt=Le[Ne+Ue++],j.head&&wt&&j.length<65536&&(j.head.comment+=String.fromCharCode(wt));while(wt&&Ue<je);if(j.flags&512&&(j.check=d(j.check,Le,Ue,Ne)),je-=Ue,Ne+=Ue,wt)break e}else j.head&&(j.head.comment=null);j.mode=Z;case Z:if(j.flags&512){for(;de<16;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(ue!==(j.check&65535)){ie.msg="header crc mismatch",j.mode=We;break}ue=0,de=0}j.head&&(j.head.hcrc=j.flags>>9&1,j.head.done=!0),ie.adler=j.check=0,j.mode=te;break;case ze:for(;de<32;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}ie.adler=j.check=D(ue),ue=0,de=0,j.mode=ht;case ht:if(j.havedict===0)return ie.next_out=Xt,ie.avail_out=Rt,ie.next_in=Ne,ie.avail_in=je,j.hold=ue,j.bits=de,U;ie.adler=j.check=1,j.mode=te;case te:if(Ae===T||Ae===C)break e;case K:if(j.last){ue>>>=de&7,de-=de&7,j.mode=Ve;break}for(;de<3;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}switch(j.last=ue&1,ue>>>=1,de-=1,ue&3){case 0:j.mode=ne;break;case 1:if(Wr(j),j.mode=gt,Ae===C){ue>>>=2,de-=2;break e}break;case 2:j.mode=qe;break;case 3:ie.msg="invalid block type",j.mode=We}ue>>>=2,de-=2;break;case ne:for(ue>>>=de&7,de-=de&7;de<32;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if((ue&65535)!==(ue>>>16^65535)){ie.msg="invalid stored block lengths",j.mode=We;break}if(j.length=ue&65535,ue=0,de=0,j.mode=Te,Ae===C)break e;case Te:j.mode=He;case He:if(Ue=j.length,Ue){if(Ue>je&&(Ue=je),Ue>Rt&&(Ue=Rt),Ue===0)break e;a.arraySet(_t,Le,Ne,Ue,Xt),je-=Ue,Ne+=Ue,Rt-=Ue,Xt+=Ue,j.length-=Ue;break}j.mode=te;break;case qe:for(;de<14;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(j.nlen=(ue&31)+257,ue>>>=5,de-=5,j.ndist=(ue&31)+1,ue>>>=5,de-=5,j.ncode=(ue&15)+4,ue>>>=4,de-=4,j.nlen>286||j.ndist>30){ie.msg="too many length or distance symbols",j.mode=We;break}j.have=0,j.mode=Me;case Me:for(;j.have<j.ncode;){for(;de<3;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}j.lens[Ei[j.have++]]=ue&7,ue>>>=3,de-=3}for(;j.have<19;)j.lens[Ei[j.have++]]=0;if(j.lencode=j.lendyn,j.lenbits=7,tr={bits:j.lenbits},jt=b(v,j.lens,0,19,j.lencode,0,j.work,tr),j.lenbits=tr.bits,jt){ie.msg="invalid code lengths set",j.mode=We;break}j.have=0,j.mode=Ge;case Ge:for(;j.have<j.nlen+j.ndist;){for(;vt=j.lencode[ue&(1<<j.lenbits)-1],Qe=vt>>>24,Ft=vt>>>16&255,Mt=vt&65535,!(Qe<=de);){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(Mt<16)ue>>>=Qe,de-=Qe,j.lens[j.have++]=Mt;else{if(Mt===16){for(sr=Qe+2;de<sr;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(ue>>>=Qe,de-=Qe,j.have===0){ie.msg="invalid bit length repeat",j.mode=We;break}wt=j.lens[j.have-1],Ue=3+(ue&3),ue>>>=2,de-=2}else if(Mt===17){for(sr=Qe+3;de<sr;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}ue>>>=Qe,de-=Qe,wt=0,Ue=3+(ue&7),ue>>>=3,de-=3}else{for(sr=Qe+7;de<sr;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}ue>>>=Qe,de-=Qe,wt=0,Ue=11+(ue&127),ue>>>=7,de-=7}if(j.have+Ue>j.nlen+j.ndist){ie.msg="invalid bit length repeat",j.mode=We;break}for(;Ue--;)j.lens[j.have++]=wt}}if(j.mode===We)break;if(j.lens[256]===0){ie.msg="invalid code -- missing end-of-block",j.mode=We;break}if(j.lenbits=9,tr={bits:j.lenbits},jt=b(h,j.lens,0,j.nlen,j.lencode,0,j.work,tr),j.lenbits=tr.bits,jt){ie.msg="invalid literal/lengths set",j.mode=We;break}if(j.distbits=6,j.distcode=j.distdyn,tr={bits:j.distbits},jt=b(w,j.lens,j.nlen,j.ndist,j.distcode,0,j.work,tr),j.distbits=tr.bits,jt){ie.msg="invalid distances set",j.mode=We;break}if(j.mode=gt,Ae===C)break e;case gt:j.mode=Y;case Y:if(je>=6&&Rt>=258){ie.next_out=Xt,ie.avail_out=Rt,ie.next_in=Ne,ie.avail_in=je,j.hold=ue,j.bits=de,y(ie,Ot),Xt=ie.next_out,_t=ie.output,Rt=ie.avail_out,Ne=ie.next_in,Le=ie.input,je=ie.avail_in,ue=j.hold,de=j.bits,j.mode===te&&(j.back=-1);break}for(j.back=0;vt=j.lencode[ue&(1<<j.lenbits)-1],Qe=vt>>>24,Ft=vt>>>16&255,Mt=vt&65535,!(Qe<=de);){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(Ft&&!(Ft&240)){for(Ct=Qe,yr=Ft,Dr=Mt;vt=j.lencode[Dr+((ue&(1<<Ct+yr)-1)>>Ct)],Qe=vt>>>24,Ft=vt>>>16&255,Mt=vt&65535,!(Ct+Qe<=de);){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}ue>>>=Ct,de-=Ct,j.back+=Ct}if(ue>>>=Qe,de-=Qe,j.back+=Qe,j.length=Mt,Ft===0){j.mode=_e;break}if(Ft&32){j.back=-1,j.mode=te;break}if(Ft&64){ie.msg="invalid literal/length code",j.mode=We;break}j.extra=Ft&15,j.mode=Tt;case Tt:if(j.extra){for(sr=j.extra;de<sr;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}j.length+=ue&(1<<j.extra)-1,ue>>>=j.extra,de-=j.extra,j.back+=j.extra}j.was=j.length,j.mode=R;case R:for(;vt=j.distcode[ue&(1<<j.distbits)-1],Qe=vt>>>24,Ft=vt>>>16&255,Mt=vt&65535,!(Qe<=de);){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(!(Ft&240)){for(Ct=Qe,yr=Ft,Dr=Mt;vt=j.distcode[Dr+((ue&(1<<Ct+yr)-1)>>Ct)],Qe=vt>>>24,Ft=vt>>>16&255,Mt=vt&65535,!(Ct+Qe<=de);){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}ue>>>=Ct,de-=Ct,j.back+=Ct}if(ue>>>=Qe,de-=Qe,j.back+=Qe,Ft&64){ie.msg="invalid distance code",j.mode=We;break}j.offset=Mt,j.extra=Ft&15,j.mode=M;case M:if(j.extra){for(sr=j.extra;de<sr;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}j.offset+=ue&(1<<j.extra)-1,ue>>>=j.extra,de-=j.extra,j.back+=j.extra}if(j.offset>j.dmax){ie.msg="invalid distance too far back",j.mode=We;break}j.mode=pe;case pe:if(Rt===0)break e;if(Ue=Ot-Rt,j.offset>Ue){if(Ue=j.offset-Ue,Ue>j.whave&&j.sane){ie.msg="invalid distance too far back",j.mode=We;break}Ue>j.wnext?(Ue-=j.wnext,Lr=j.wsize-Ue):Lr=j.wnext-Ue,Ue>j.length&&(Ue=j.length),kr=j.window}else kr=_t,Lr=Xt-j.offset,Ue=j.length;Ue>Rt&&(Ue=Rt),Rt-=Ue,j.length-=Ue;do _t[Xt++]=kr[Lr++];while(--Ue);j.length===0&&(j.mode=Y);break;case _e:if(Rt===0)break e;_t[Xt++]=j.length,Rt--,j.mode=Y;break;case Ve:if(j.wrap){for(;de<32;){if(je===0)break e;je--,ue|=Le[Ne++]<<de,de+=8}if(Ot-=Rt,ie.total_out+=Ot,j.total+=Ot,Ot&&(ie.adler=j.check=j.flags?d(j.check,_t,Ot,Xt-Ot):p(j.check,_t,Ot,Xt-Ot)),Ot=Rt,(j.flags?ue:D(ue))!==j.check){ie.msg="incorrect data check",j.mode=We;break}ue=0,de=0}j.mode=ve;case ve:if(j.wrap&&j.flags){for(;de<32;){if(je===0)break e;je--,ue+=Le[Ne++]<<de,de+=8}if(ue!==(j.total&4294967295)){ie.msg="incorrect length check",j.mode=We;break}ue=0,de=0}j.mode=Ye;case Ye:jt=P;break e;case We:jt=Q;break e;case xt:return W;case Et:default:return H}return ie.next_out=Xt,ie.avail_out=Rt,ie.next_in=Ne,ie.avail_in=je,j.hold=ue,j.bits=de,(j.wsize||Ot!==ie.avail_out&&j.mode<We&&(j.mode<Ve||Ae!==_))&&jr(ie,ie.output,ie.next_out,Ot-ie.avail_out)?(j.mode=xt,W):(Gr-=ie.avail_in,Ot-=ie.avail_out,ie.total_in+=Gr,ie.total_out+=Ot,j.total+=Ot,j.wrap&&Ot&&(ie.adler=j.check=j.flags?d(j.check,_t,Ot,ie.next_out-Ot):p(j.check,_t,Ot,ie.next_out-Ot)),ie.data_type=j.bits+(j.last?64:0)+(j.mode===te?128:0)+(j.mode===gt||j.mode===Te?256:0),(Gr===0&&Ot===0||Ae===_)&&jt===I&&(jt=Be),jt)}function Qi(ie){if(!ie||!ie.state)return H;var Ae=ie.state;return Ae.window&&(Ae.window=null),ie.state=null,I}function en(ie,Ae){var j;return!ie||!ie.state||(j=ie.state,!(j.wrap&2))?H:(j.head=Ae,Ae.done=!1,I)}function tn(ie,Ae){var j=Ae.length,Le,_t,Ne;return!ie||!ie.state||(Le=ie.state,Le.wrap!==0&&Le.mode!==ht)?H:Le.mode===ht&&(_t=1,_t=p(_t,Ae,j,0),_t!==Le.check)?Q:(Ne=jr(ie,Ae,j,j),Ne?(Le.mode=xt,W):(Le.havedict=1,I))}i.inflateReset=ge,i.inflateReset2=nt,i.inflateResetKeep=se,i.inflateInit=mt,i.inflateInit2=ct,i.inflate=$,i.inflateEnd=Qi,i.inflateGetHeader=en,i.inflateSetDictionary=tn,i.inflateInfo="pako inflate (from Nodeca project)"},function(r,i){"use strict";var n=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";i.assign=function(d){for(var y=Array.prototype.slice.call(arguments,1);y.length;){var b=y.shift();if(b){if(typeof b!="object")throw new TypeError(b+"must be non-object");for(var v in b)b.hasOwnProperty(v)&&(d[v]=b[v])}}return d},i.shrinkBuf=function(d,y){return d.length===y?d:d.subarray?d.subarray(0,y):(d.length=y,d)};var a={arraySet:function(d,y,b,v,h){if(y.subarray&&d.subarray){d.set(y.subarray(b,b+v),h);return}for(var w=0;w<v;w++)d[h+w]=y[b+w]},flattenChunks:function(d){var y,b,v,h,w,_;for(v=0,y=0,b=d.length;y<b;y++)v+=d[y].length;for(_=new Uint8Array(v),h=0,y=0,b=d.length;y<b;y++)w=d[y],_.set(w,h),h+=w.length;return _}},p={arraySet:function(d,y,b,v,h){for(var w=0;w<v;w++)d[h+w]=y[b+w]},flattenChunks:function(d){return[].concat.apply([],d)}};i.setTyped=function(d){d?(i.Buf8=Uint8Array,i.Buf16=Uint16Array,i.Buf32=Int32Array,i.assign(i,a)):(i.Buf8=Array,i.Buf16=Array,i.Buf32=Array,i.assign(i,p))},i.setTyped(n)},function(r,i){"use strict";function n(a,p,d,y){for(var b=a&65535|0,v=a>>>16&65535|0,h=0;d!==0;){h=d>2e3?2e3:d,d-=h;do b=b+p[y++]|0,v=v+b|0;while(--h);b%=65521,v%=65521}return b|v<<16|0}r.exports=n},function(r,i){"use strict";function n(){for(var d,y=[],b=0;b<256;b++){d=b;for(var v=0;v<8;v++)d=d&1?3988292384^d>>>1:d>>>1;y[b]=d}return y}var a=n();function p(d,y,b,v){var h=a,w=v+b;d^=-1;for(var _=v;_<w;_++)d=d>>>8^h[(d^y[_])&255];return d^-1}r.exports=p},function(r,i){"use strict";var n=30,a=12;r.exports=function(d,y){var b,v,h,w,_,T,C,I,P,U,H,Q,W,Be,re,me,Fe,ee,ye,fe,Ce,Re,ot,Z,ze;b=d.state,v=d.next_in,Z=d.input,h=v+(d.avail_in-5),w=d.next_out,ze=d.output,_=w-(y-d.avail_out),T=w+(d.avail_out-257),C=b.dmax,I=b.wsize,P=b.whave,U=b.wnext,H=b.window,Q=b.hold,W=b.bits,Be=b.lencode,re=b.distcode,me=(1<<b.lenbits)-1,Fe=(1<<b.distbits)-1;e:do{W<15&&(Q+=Z[v++]<<W,W+=8,Q+=Z[v++]<<W,W+=8),ee=Be[Q&me];t:for(;;){if(ye=ee>>>24,Q>>>=ye,W-=ye,ye=ee>>>16&255,ye===0)ze[w++]=ee&65535;else if(ye&16){fe=ee&65535,ye&=15,ye&&(W<ye&&(Q+=Z[v++]<<W,W+=8),fe+=Q&(1<<ye)-1,Q>>>=ye,W-=ye),W<15&&(Q+=Z[v++]<<W,W+=8,Q+=Z[v++]<<W,W+=8),ee=re[Q&Fe];r:for(;;){if(ye=ee>>>24,Q>>>=ye,W-=ye,ye=ee>>>16&255,ye&16){if(Ce=ee&65535,ye&=15,W<ye&&(Q+=Z[v++]<<W,W+=8,W<ye&&(Q+=Z[v++]<<W,W+=8)),Ce+=Q&(1<<ye)-1,Ce>C){d.msg="invalid distance too far back",b.mode=n;break e}if(Q>>>=ye,W-=ye,ye=w-_,Ce>ye){if(ye=Ce-ye,ye>P&&b.sane){d.msg="invalid distance too far back",b.mode=n;break e}if(Re=0,ot=H,U===0){if(Re+=I-ye,ye<fe){fe-=ye;do ze[w++]=H[Re++];while(--ye);Re=w-Ce,ot=ze}}else if(U<ye){if(Re+=I+U-ye,ye-=U,ye<fe){fe-=ye;do ze[w++]=H[Re++];while(--ye);if(Re=0,U<fe){ye=U,fe-=ye;do ze[w++]=H[Re++];while(--ye);Re=w-Ce,ot=ze}}}else if(Re+=U-ye,ye<fe){fe-=ye;do ze[w++]=H[Re++];while(--ye);Re=w-Ce,ot=ze}for(;fe>2;)ze[w++]=ot[Re++],ze[w++]=ot[Re++],ze[w++]=ot[Re++],fe-=3;fe&&(ze[w++]=ot[Re++],fe>1&&(ze[w++]=ot[Re++]))}else{Re=w-Ce;do ze[w++]=ze[Re++],ze[w++]=ze[Re++],ze[w++]=ze[Re++],fe-=3;while(fe>2);fe&&(ze[w++]=ze[Re++],fe>1&&(ze[w++]=ze[Re++]))}}else if(ye&64){d.msg="invalid distance code",b.mode=n;break e}else{ee=re[(ee&65535)+(Q&(1<<ye)-1)];continue r}break}}else if(ye&64)if(ye&32){b.mode=a;break e}else{d.msg="invalid literal/length code",b.mode=n;break e}else{ee=Be[(ee&65535)+(Q&(1<<ye)-1)];continue t}break}}while(v<h&&w<T);fe=W>>3,v-=fe,W-=fe<<3,Q&=(1<<W)-1,d.next_in=v,d.next_out=w,d.avail_in=v<h?5+(h-v):5-(v-h),d.avail_out=w<T?257+(T-w):257-(w-T),b.hold=Q,b.bits=W}},function(r,i,n){"use strict";var a=n(33),p=15,d=852,y=592,b=0,v=1,h=2,w=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],_=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],T=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],C=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];r.exports=function(P,U,H,Q,W,Be,re,me){var Fe=me.bits,ee=0,ye=0,fe=0,Ce=0,Re=0,ot=0,Z=0,ze=0,ht=0,te=0,K,ne,Te,He,qe,Me=null,Ge=0,gt,Y=new a.Buf16(p+1),Tt=new a.Buf16(p+1),R=null,M=0,pe,_e,Ve;for(ee=0;ee<=p;ee++)Y[ee]=0;for(ye=0;ye<Q;ye++)Y[U[H+ye]]++;for(Re=Fe,Ce=p;Ce>=1&&Y[Ce]===0;Ce--);if(Re>Ce&&(Re=Ce),Ce===0)return W[Be++]=1<<24|64<<16|0,W[Be++]=1<<24|64<<16|0,me.bits=1,0;for(fe=1;fe<Ce&&Y[fe]===0;fe++);for(Re<fe&&(Re=fe),ze=1,ee=1;ee<=p;ee++)if(ze<<=1,ze-=Y[ee],ze<0)return-1;if(ze>0&&(P===b||Ce!==1))return-1;for(Tt[1]=0,ee=1;ee<p;ee++)Tt[ee+1]=Tt[ee]+Y[ee];for(ye=0;ye<Q;ye++)U[H+ye]!==0&&(re[Tt[U[H+ye]]++]=ye);if(P===b?(Me=R=re,gt=19):P===v?(Me=w,Ge-=257,R=_,M-=257,gt=256):(Me=T,R=C,gt=-1),te=0,ye=0,ee=fe,qe=Be,ot=Re,Z=0,Te=-1,ht=1<<Re,He=ht-1,P===v&&ht>d||P===h&&ht>y)return 1;for(;;){pe=ee-Z,re[ye]<gt?(_e=0,Ve=re[ye]):re[ye]>gt?(_e=R[M+re[ye]],Ve=Me[Ge+re[ye]]):(_e=32+64,Ve=0),K=1<<ee-Z,ne=1<<ot,fe=ne;do ne-=K,W[qe+(te>>Z)+ne]=pe<<24|_e<<16|Ve|0;while(ne!==0);for(K=1<<ee-1;te&K;)K>>=1;if(K!==0?(te&=K-1,te+=K):te=0,ye++,--Y[ee]===0){if(ee===Ce)break;ee=U[H+re[ye]]}if(ee>Re&&(te&He)!==Te){for(Z===0&&(Z=Re),qe+=fe,ot=ee-Z,ze=1<<ot;ot+Z<Ce&&(ze-=Y[ot+Z],!(ze<=0));)ot++,ze<<=1;if(ht+=1<<ot,P===v&&ht>d||P===h&&ht>y)return 1;Te=te&He,W[Te]=Re<<24|ot<<16|qe-Be|0}}return te!==0&&(W[qe+te]=ee-Z<<24|64<<16|0),me.bits=Re,0}},function(r,i,n){"use strict";var a=n(33),p=!0,d=!0;try{String.fromCharCode.apply(null,[0])}catch{p=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{d=!1}for(var y=new a.Buf8(256),b=0;b<256;b++)y[b]=b>=252?6:b>=248?5:b>=240?4:b>=224?3:b>=192?2:1;y[254]=y[254]=1,i.string2buf=function(h){var w,_,T,C,I,P=h.length,U=0;for(C=0;C<P;C++)_=h.charCodeAt(C),(_&64512)===55296&&C+1<P&&(T=h.charCodeAt(C+1),(T&64512)===56320&&(_=65536+(_-55296<<10)+(T-56320),C++)),U+=_<128?1:_<2048?2:_<65536?3:4;for(w=new a.Buf8(U),I=0,C=0;I<U;C++)_=h.charCodeAt(C),(_&64512)===55296&&C+1<P&&(T=h.charCodeAt(C+1),(T&64512)===56320&&(_=65536+(_-55296<<10)+(T-56320),C++)),_<128?w[I++]=_:_<2048?(w[I++]=192|_>>>6,w[I++]=128|_&63):_<65536?(w[I++]=224|_>>>12,w[I++]=128|_>>>6&63,w[I++]=128|_&63):(w[I++]=240|_>>>18,w[I++]=128|_>>>12&63,w[I++]=128|_>>>6&63,w[I++]=128|_&63);return w};function v(h,w){if(w<65537&&(h.subarray&&d||!h.subarray&&p))return String.fromCharCode.apply(null,a.shrinkBuf(h,w));for(var _="",T=0;T<w;T++)_+=String.fromCharCode(h[T]);return _}i.buf2binstring=function(h){return v(h,h.length)},i.binstring2buf=function(h){for(var w=new a.Buf8(h.length),_=0,T=w.length;_<T;_++)w[_]=h.charCodeAt(_);return w},i.buf2string=function(h,w){var _,T,C,I,P=w||h.length,U=new Array(P*2);for(T=0,_=0;_<P;){if(C=h[_++],C<128){U[T++]=C;continue}if(I=y[C],I>4){U[T++]=65533,_+=I-1;continue}for(C&=I===2?31:I===3?15:7;I>1&&_<P;)C=C<<6|h[_++]&63,I--;if(I>1){U[T++]=65533;continue}C<65536?U[T++]=C:(C-=65536,U[T++]=55296|C>>10&1023,U[T++]=56320|C&1023)}return v(U,T)},i.utf8border=function(h,w){var _;for(w=w||h.length,w>h.length&&(w=h.length),_=w-1;_>=0&&(h[_]&192)===128;)_--;return _<0||_===0?w:_+y[h[_]]>w?_:w}},function(r,i){"use strict";r.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},function(r,i){"use strict";r.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},function(r,i){"use strict";function n(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}r.exports=n},function(r,i){"use strict";function n(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}r.exports=n}])})}}),zn=class{constructor(e=this.onOpen,t=null,r=null){this.onOpen=e,this.notes=[{idx:0,text:"comment"}],t!==null&&document.getElementById(t).addEventListener("click",this.saveCSV),r!==null&&document.getElementById(r).addEventListener("click",this.openCSV)}processArraysForCSV(e=["1|2|3","3|2|1"],t="|",r="a,b,c",i=!1){let n=r+`
`,a=0;return e.forEach((p,d)=>{e[d]==="string"&&t!==","?n+=p.split(t).join(","):csvData+=p.join(","),i===!0&&this.notes[a].idx===d&&(p+=this.notes[a].text,a++),p.indexOf(`
`)<0&&(n+=`
`)}),n}static saveCSV(e=`a,b,c
1,2,3
3,2,1
`,t=new Date().toISOString()){var r=document.createElement("a");r.href="data:text/csv;charset=utf-8,"+encodeURI(e),r.target="_blank",t!==""?r.download=t:r.download=Date().toISOString(),r.click()}static openCSV(e=",",t=(r,i,n)=>n){return new Promise((r,i)=>{var n=document.createElement("input");n.accept=".csv",n.type="file",n.onchange=a=>{var p=a.target.files[0],d=new FileReader;d.onload=y=>{var b=y.target.result,v=b.split(`
`);let h=[];var w=[];v.pop(),v.forEach((_,T)=>{if(T==0)h=_.split(e);else{var C=_.split(e);w.push(C)}}),t(w,h,n.value),n.value="",r({data:w,header:h,filename:n.value})},d.readAsText(p)},n.click()})}static openCSVRaw(e=(t,r)=>r){return new Promise((t,r)=>{var i=document.createElement("input");i.accept=".csv",i.type="file",i.onchange=n=>{var a=n.target.files[0],p=new FileReader;p.onload=d=>{var y=d.target.result;e(y,i.value),i.value="",t({data:y,filename:i.value})},p.readAsText(a)},i.click()})}onOpen(e=[],t=[]){console.log("CSV Opened!",t,e)}},xp=(e,t,r,i=!0,n=(a,p,d)=>{let y={filename:p},b=d;typeof d=="string"&&(b=d.split(",")),y.header=b;for(let v=0;v<a.length;v++){let h=a[v].split(",");for(let w=0;w<h.length;w++)y[b[w]]||(y[b[w]]=[]),y[b[w]].push(h[w])}return y})=>{let a=e.split(`\r
`);return r||(r=a[0]),a.shift(),i===!1&&a.pop(),n(a,t,r)};function da(e){e=new Date(e);var t=a=>("0"+a).slice(-2),r=a=>("00"+a).slice(-3),i=e.getTimezoneOffset(),n=i<0?"+":"-";return i=Math.abs(i),e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+"."+r(e.getMilliseconds())+"(UTC"+n+t(i/60|0)+":00)"}var Rs=Sp(kp()),nr=!1,ut=Rs.BFSRequire("fs"),cg=Rs.BFSRequire("buffer").Buffer,gr=async(e=["data"],t=(n=[])=>{},r=n=>{},i="IndexedDB")=>nr?!0:(nr=!0,new Promise((n,a)=>{let p=ut.getRootFS();Rs.FileSystem[i].Create({},(d,y)=>{if(d){a(d);return}if(!y){r(d),a(new Error("Error creating BrowserFS"));return}Rs.initialize(y);let b=[];e.forEach(async v=>{b.push(or(ut,v))}),Promise.all(b).then(v=>{t(v),nr=!0,n(!0)})})})),pa=async(e="")=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise(t=>{ut.exists("/"+e,function(r){t(r)})})),Ep=async(e="data")=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise(t=>{ut.readFile("/"+e,function(r,i){t(i)})}));async function Pc(e="data",t=0,r=5120,i=n=>{}){if(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),e!="")return new Promise(async(n,a)=>{ut.open("/"+e,"r",(p,d)=>{if(p){a(p);return}ut.read(d,r,t,"utf-8",(y,b,v)=>{if(y){a(y);return}if(v!==0){let h=b.toString();ut.close(d,()=>{i(h,e),n(h)})}else n(void 0)})})});console.error("Path name is not defined")}var Op=async(e="data",t=r=>{})=>(nr?await or(ut,e):await gr([e]),new Promise((r,i)=>{ut.readdir("/"+e,(n,a)=>{if(n){i(n);return}a?(t(a),r(a)):r(void 0)})})),Ms=async(e,t,r=i=>{})=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise((i,n)=>{ut.writeFile("/"+e,t,a=>{if(a){n(a);return}r(t),i(!0)})})),ha=async(e,t,r=i=>{})=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise((i,n)=>{ut.appendFile("/"+e,t,a=>{if(a){n(a);return}r(t),i(!0)})})),Rc=async(e="data",t=()=>{})=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise(r=>{e!=""?ut.unlink("/"+e,i=>{i&&console.error(i),t(),r(!0)}):(console.error("Path name is not defined"),r(!1))})),Ap=async(e="data",t="end",r=0,i=(n,a)=>{})=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise(async(n,a)=>{let p=await ga(e);(t==="end"||typeof t=="number"&&t>p)&&(t=p),ut.open("/"+e,"r",(d,y)=>{if(d){a(d);return}ut.read(y,t,r,"utf-8",(b,v,h)=>{if(b){a(b);return}if(h!==0){let w=v.toString();ut.close(y,()=>{i(w,e),n(w)})}else n(void 0)})})})),Mc=async(e="data",t=r=>{})=>(nr?await or(ut,e):await gr([e]),new Promise((r,i)=>{ut.readdir("/"+e,(n,a)=>{if(n){i(n);return}a&&t(a),r(a)})})),ga=async(e="data",t=r=>{console.log(r)})=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise((r,i)=>{ut.stat("/"+e,(n,a)=>{if(n){i(n);return}let p=a.size;t(p),r(p)})})),Us=async(e="data",t=(r,i)=>{console.log(r,i)})=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise((r,i)=>{ut.open("/"+e,"r",(n,a)=>{if(n){i(n);return}ut.read(a,65535,0,"utf-8",(p,d,y)=>{if(p){i(p);return}if(y!==0){let h=d.toString().split(`
`)[0];ut.close(a,()=>{t(h,e),r(h)})}else r(void 0)})})})),Uc=async(e="data",t=10)=>(nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]),new Promise((r,i)=>{e!=""?ut.stat("/"+e,(n,a)=>{if(n){i(n);return}let p=a.size;console.log(p),ut.open(e,"r",(d,y)=>{if(d){i(d);return}let b=0,v=t*1024*1024,h=v;if(p<v)h=p,ut.read(y,h,0,"utf-8",(w,_,T)=>{if(w){i(w);return}T!==0&&zn.saveCSV(_.toString(),e),ut.close(y),r(!0)});else{let w=async()=>{if(b<p){b+h>p&&(h=p-b);let _=0;ut.read(y,h,b,"utf-8",(T,C,I)=>{if(T){i(T);return}I!==0&&(zn.saveCSV(C.toString(),e+"_"+_),b+=v,_++,w(),ut.close(y),r(!0))})}}}})}):(console.error("File name is not defined."),r(!1))}));async function Np(e="data",t=0,r="end",i={}){nr?await or(ut,e.split("/")[0]):await gr([e.split("/")[0]]);let n=i.transpose||!1,a=await Us(e);if(a)a=a.split(",");else return;let p=[],d=[],y=n?[]:{};a.forEach(w=>{w?(d.push(w),p.push(1)):p[p.length-1]++});let b=await ga(e);r==="end"?r=b:r>b&&(t=b-(r-t),r=b);let v=(await Pc(e,t,r)).split(`
`).slice(1,-1),h=w=>{if(i.json)try{w=JSON.parse(w)}catch{}return w};return v.forEach((w,_)=>{let T=w.split(",");if(n){let C={};T.forEach((I,P)=>C[d[P]]=h(I)),y.push(C)}else T.forEach((C,I)=>{let P=d[I];y[P]||(y[P]=[]),y[P].push(h(C))})}),y}var Yi={},or=async(e,t)=>new Promise((r,i)=>{Yi[t]==="exists"||Yi[t]==="created"?r():e.exists(`/${t}`,n=>{n?(Yi[t]="exists",console.log(`/${t} exists!`),r()):Yi[t]==="creating"?(console.log(t+" is still being created."),r()):(console.log(`creating /${t}`,e),Yi[t]="creating",e.mkdir(`/${t}`,1,a=>{if(a){i(a);return}Yi[t]="created",setTimeout(r,500)}))})}),ya={initFS:gr,dirExists:or,exists:pa,readFile:Ep,readFileChunk:Pc,getFilenames:Op,writeFile:Ms,appendFile:ha,deleteFile:Rc,readFileAsText:Ap,getFileSize:ga,getCSVHeader:Us,listFiles:Mc},Or={};function Tp(e,t,r){return(1-r)*e+r*t}function ua(e,t,r,i=!0){if(r<=2)return[e,t];let n=1/r,a=new Array(r);a[0]=e;for(let p=1;p<=r;p++)a[p]=Tp(e,t,n*p),i&&(a[p]=Math.floor(a[p]));return a}var Ip=async(e,t,r,i)=>{if(!t){let b=Object.keys(Or);b.length>0?t=b[b.length-1]:t=`csv${new Date().toISOString()}`}let n=Or[t];if(!n){let b=Array.from(Object.keys(e));b.indexOf("timestamp")>-1&&b.splice(b.indexOf("timestamp"),1),Or[t]={header:r||["timestamp","localized",...b],lastX:void 0,buffer:"",buffered:0,bufferSize:0,toFixed:0,xIncrement:void 0},n=Or[t];let v=await Us(t).catch(()=>null);(!v||v!==n.header.join(","))&&(r=n.header)}if(!n.header||n.header?.length===0){let b=Array.from(Object.keys(e));b.indexOf("timestamp")>-1&&b.splice(b.indexOf("timestamp"),1),n.header=r||["timestamp","localized",...b]}else r&&(n.header=r);let a=1;for(let b in e){let v=e[b];n.header.indexOf(b)>-1&&v&&Array.isArray(v)&&v?.length>a&&(a=v?.length)}let p;if(n.xIncrement?n.lastX?e[n.header[2]]?Array.isArray(e[n.header[2]])?p=n.lastX+n.xIncrement*e[n.header[2]].length:p=n.lastX+n.xIncrement:e[n.header[0]]&&Array.isArray(e[n.header[0]])?p=n.lastX+n.xIncrement*e[n.header[0]].length:p=n.lastX+n.xIncrement:typeof e[n.header[0]]<"u"?p=e[n.header[0]]:(n.header[0].toLowerCase().includes("time")||n.header[0].toLowerCase().includes("unix"))&&(p=Date.now()):e[n.header[0]]?p=e[n.header[0]]:p=Date.now(),typeof n.lastX>"u"&&(n.lastX=Array.isArray(p)?p[0]:p),typeof p>"u")if(n.header[0].includes("time")){let b=Date.now();a===1?p=Date.now():(p=ua(n.lastX,b,a),p.shift())}else{let b=n.lastX+1;a>1?(p=new Array(a).fill(""),p[a-1]=b):p=b}else a>1&&p?.length!==a&&(!Array.isArray(p)||p.length===1?(p=ua(n.lastX,p,a),p.shift()):(p=ua(p[0],p[p.length-1],a),p.shift()));let d=[];if(Array.isArray(p)){let b={};for(let v=0;v<p.length;v++){d.push([]);for(let h=0;h<n.header.length;h++){let w=e[n.header[h]];if(h===0){d[v][0]=p[v],n.header[h+1]==="localized"&&(h++,d[v][h]=da(p[v]));continue}w===void 0?d[v][h]="":Array.isArray(w)?w.length===p.length?d[v][h]=w[v]:n.header[h]in b?w.length===1&&v===p.length-1?d[v][h]=w[b[n.header[h]]]:Math.floor(w.length*v/p.length)>b[n.header[h]]?(b[n.header[h]]++,d[v][h]=w[b[n.header[h]]]):d[v][h]="":(b[n.header[h]]=v,w.length!==1&&(d[v][h]=w[v])):v===p.length-1?d[v][h]=w:d[v][h]="",typeof d[v][h]=="number"&&Math.floor(d[v][h])!==d[v][h]&&(d[v][h]=d[v][h].toFixed(Or[t].toFixed))}}}else{d.push([]);for(let b=0;b<n.header.length;b++){if(b===0){d[0][0]=p,n.header[b+1]==="localized"&&(b++,d[0][b]=da(p));continue}n.header[b]in e?d[0][b]=e[n.header[b]]:d[0][b]="",typeof d[0][b]=="number"&&Math.floor(d[0][b])!==d[0][b]&&(d[0][b]=d[0][b].toFixed(Or[t].toFixed))}}let y="";if(r&&(y+=r.join(",")+`
`),d.forEach(b=>{y+=(i?.json?b.map(v=>JSON.stringify(v)):b).join(",")+`
`,n.bufferSize&&n.buffered++}),n.lastX=d[d.length-1][0],n.bufferSize)if(n.buffer+=y,n.buffered>n.bufferSize){let b=new Promise((v,h)=>{pa(t).then(w=>{w?ha(t,n.buffer,_=>{v(_)}):Ms(t,n.buffer,_=>{v(_)})})});return await b,n.buffer="",n.buffered=0,b}else return Promise.resolve(!0);else return new Promise((b,v)=>{pa(t).then(h=>{h?ha(t,y,w=>{b(w)}):Ms(t,y,w=>{b(w)})})})},Fp=(e,t)=>{Or[t]&&(Or[t].header=e)},Bp=(e,t,r=5,i=0,n)=>(t?.indexOf("timestamp")>1&&(t.splice(t.indexOf("timestamp"),1),t.unshift("timestamp")),(t?.[0].toLowerCase().includes("time")||t?.[0].toLowerCase().includes("unix"))&&t[1]!=="localized"&&t.splice(1,0,"localized"),Or[e]={header:t,lastX:t[1]==="localized"?Date.now():0,bufferSize:i,buffer:"",buffered:0,toFixed:r,xIncrement:n},new Promise((a,p)=>{Ms(e,Or[e].header?Or[e].header.join(",")+`
`:"",d=>{a(d)}).catch(p)})),zc=(e,t=document.body)=>new Promise(async(r,i)=>{t.querySelector("#bfs"+e)&&t.querySelector("#bfs"+e)?.remove(),t.insertAdjacentHTML("beforeend",`<div id='bfs${e}' class='bfs${e}'></div>`);let n=t.querySelector("#bfs"+e);await Mc(e).then(a=>{a.length===0?n.innerHTML="No Files!":a.forEach(p=>{n?.insertAdjacentHTML("beforeend",`<div id='${p}' class='bfsfilediv'>
                        <span class='bfsfiletitle'>Data: </span>
                        <span>${p}</span>
                        <button class='bfsdownloadbtn' id='download${p}'>Download CSV</button>
                        ${p.indexOf(".")>-1?`<button class='bfsdeletebtn' id='delete${p}'>Delete</button>`:""}
                    </div>`),document.getElementById(`delete${p}`)&&(document.getElementById(`delete${p}`).onclick=()=>{Rc(e+"/"+p,()=>{zc(e,t)})}),document.getElementById(`download${p}`)&&(document.getElementById(`download${p}`).onclick=()=>{Uc(e+"/"+p,10)})}),r(a)}).catch(i)}),$c={appendCSV:Ip,updateCSVHeader:Fp,createCSV:Bp,visualizeDirectory:zc,openCSV:zn.openCSV,saveCSV:zn.saveCSV,openCSVRaw:zn.openCSVRaw,parseCSVData:xp,getCSVHeader:Us,writeToCSVFromDB:Uc,readCSVChunkFromDB:Np,toISOLocal:da};var Cp=Object.create,ka=Object.defineProperty,jp=Object.getOwnPropertyDescriptor,Jc=Object.getOwnPropertyNames,Lp=Object.getPrototypeOf,Dp=Object.prototype.hasOwnProperty,Pp=(e=>typeof hr<"u"?hr:typeof Proxy<"u"?new Proxy(e,{get:(t,r)=>(typeof hr<"u"?hr:t)[r]}):e)(function(e){if(typeof hr<"u")return hr.apply(this,arguments);throw new Error('Dynamic require of "'+e+'" is not supported')}),Rp=(e,t)=>function(){return t||(0,e[Jc(e)[0]])((t={exports:{}}).exports,t),t.exports},Mp=(e,t)=>{for(var r in t)ka(e,r,{get:t[r],enumerable:!0})},Up=(e,t,r,i)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of Jc(t))!Dp.call(e,n)&&n!==r&&ka(e,n,{get:()=>t[n],enumerable:!(i=jp(t,n))||i.enumerable});return e},zp=(e,t,r)=>(r=e!=null?Cp(Lp(e)):{},Up(t||!e||!e.__esModule?ka(r,"default",{value:e,enumerable:!0}):r,e)),$p=Rp({"struct/datastructures/bson.cjs"(e){"use strict";var t=5,r=2147483647,i=-2147483648,n=Math.pow(2,63)-1,a=-Math.pow(2,63),p=Math.pow(2,53),d=-Math.pow(2,53),y=1,b=2,v=3,h=4,w=5,_=6,T=7,C=8,I=9,P=10,U=11,H=12,Q=13,W=14,Be=15,re=16,me=17,Fe=18,ee=19,ye=255,fe=127,Ce=0,Re=4,ot=Object.freeze({double:1,string:2,object:3,array:4,binData:5,undefined:6,objectId:7,bool:8,date:9,null:10,regex:11,dbPointer:12,javascript:13,symbol:14,javascriptWithScope:15,int:16,timestamp:17,long:18,decimal:19,minKey:-1,maxKey:127}),Z=class extends Error{get bsonError(){return!0}get name(){return"BSONError"}constructor(c){super(c)}static isBSONError(c){return c!=null&&typeof c=="object"&&"bsonError"in c&&c.bsonError===!0&&"name"in c&&"message"in c&&"stack"in c}},ze=class extends Z{get name(){return"BSONVersionError"}constructor(){super(`Unsupported BSON version, bson types must be from bson ${t}.0 or later`)}},ht=class extends Z{get name(){return"BSONRuntimeError"}constructor(c){super(c)}};function te(c){return ne.fromNumberArray(Array.from({length:c},()=>Math.floor(Math.random()*256)))}var K=(()=>{try{return Pp("crypto").randomBytes}catch{return te}})(),ne={toLocalBufferType(c){if(Buffer.isBuffer(c))return c;if(ArrayBuffer.isView(c))return Buffer.from(c.buffer,c.byteOffset,c.byteLength);let S=c?.[Symbol.toStringTag]??Object.prototype.toString.call(c);if(S==="ArrayBuffer"||S==="SharedArrayBuffer"||S==="[object ArrayBuffer]"||S==="[object SharedArrayBuffer]")return Buffer.from(c);throw new Z(`Cannot create Buffer from ${String(c)}`)},allocate(c){return Buffer.alloc(c)},equals(c,S){return ne.toLocalBufferType(c).equals(S)},fromNumberArray(c){return Buffer.from(c)},fromBase64(c){return Buffer.from(c,"base64")},toBase64(c){return ne.toLocalBufferType(c).toString("base64")},fromISO88591(c){return Buffer.from(c,"binary")},toISO88591(c){return ne.toLocalBufferType(c).toString("binary")},fromHex(c){return Buffer.from(c,"hex")},toHex(c){return ne.toLocalBufferType(c).toString("hex")},fromUTF8(c){return Buffer.from(c,"utf8")},toUTF8(c){return ne.toLocalBufferType(c).toString("utf8")},utf8ByteLength(c){return Buffer.byteLength(c,"utf8")},encodeUTF8Into(c,S,B){return ne.toLocalBufferType(c).write(S,B,void 0,"utf8")},randomBytes:K};function Te(){let{navigator:c}=globalThis;return typeof c=="object"&&c.product==="ReactNative"}function He(c){if(c<0)throw new RangeError(`The argument 'byteLength' is invalid. Received ${c}`);return Ge.fromNumberArray(Array.from({length:c},()=>Math.floor(Math.random()*256)))}var qe=(()=>{let{crypto:c}=globalThis;if(c!=null&&typeof c.getRandomValues=="function")return S=>c.getRandomValues(Ge.allocate(S));if(Te()){let{console:S}=globalThis;S?.warn?.("BSON: For React Native please polyfill crypto.getRandomValues, e.g. using: https://www.npmjs.com/package/react-native-get-random-values.")}return He})(),Me=/(\d|[a-f])/i,Ge={toLocalBufferType(c){let S=c?.[Symbol.toStringTag]??Object.prototype.toString.call(c);if(S==="Uint8Array")return c;if(ArrayBuffer.isView(c))return new Uint8Array(c.buffer.slice(c.byteOffset,c.byteOffset+c.byteLength));if(S==="ArrayBuffer"||S==="SharedArrayBuffer"||S==="[object ArrayBuffer]"||S==="[object SharedArrayBuffer]")return new Uint8Array(c);throw new Z(`Cannot make a Uint8Array from ${String(c)}`)},allocate(c){if(typeof c!="number")throw new TypeError(`The "size" argument must be of type number. Received ${String(c)}`);return new Uint8Array(c)},equals(c,S){if(c.byteLength!==S.byteLength)return!1;for(let B=0;B<c.byteLength;B++)if(c[B]!==S[B])return!1;return!0},fromNumberArray(c){return Uint8Array.from(c)},fromBase64(c){return Uint8Array.from(atob(c),S=>S.charCodeAt(0))},toBase64(c){return btoa(Ge.toISO88591(c))},fromISO88591(c){return Uint8Array.from(c,S=>S.charCodeAt(0)&255)},toISO88591(c){return Array.from(Uint16Array.from(c),S=>String.fromCharCode(S)).join("")},fromHex(c){let S=c.length%2===0?c:c.slice(0,c.length-1),B=[];for(let E=0;E<S.length;E+=2){let J=S[E],oe=S[E+1];if(!Me.test(J)||!Me.test(oe))break;let le=Number.parseInt(`${J}${oe}`,16);B.push(le)}return Uint8Array.from(B)},toHex(c){return Array.from(c,S=>S.toString(16).padStart(2,"0")).join("")},fromUTF8(c){return new TextEncoder().encode(c)},toUTF8(c){return new TextDecoder("utf8",{fatal:!1}).decode(c)},utf8ByteLength(c){return Ge.fromUTF8(c).byteLength},encodeUTF8Into(c,S,B){let E=Ge.fromUTF8(S);return c.set(E,B),E.byteLength},randomBytes:qe},gt=typeof Buffer=="function"&&Buffer.prototype?._isBuffer!==!0,Y=gt?ne:Ge,Tt=class extends DataView{static fromUint8Array(c){return new DataView(c.buffer,c.byteOffset,c.byteLength)}},R=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{12}4[0-9a-f]{3}[89ab][0-9a-f]{15})$/i,M=c=>typeof c=="string"&&R.test(c),pe=c=>{if(!M(c))throw new Z('UUID string representations must be a 32 or 36 character hex string (dashes excluded/included). Format: "xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx" or "xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx".');let S=c.replace(/-/g,"");return Y.fromHex(S)};function _e(c,S=!0){return S?[Y.toHex(c.subarray(0,4)),Y.toHex(c.subarray(4,6)),Y.toHex(c.subarray(6,8)),Y.toHex(c.subarray(8,10)),Y.toHex(c.subarray(10,16))].join("-"):Y.toHex(c)}function Ve(c){return["[object ArrayBuffer]","[object SharedArrayBuffer]"].includes(Object.prototype.toString.call(c))}function ve(c){return Object.prototype.toString.call(c)==="[object Uint8Array]"}function Ye(c){return Object.prototype.toString.call(c)==="[object RegExp]"}function We(c){return Object.prototype.toString.call(c)==="[object Map]"}function xt(c){return Object.prototype.toString.call(c)==="[object Date]"}var Et=class{get[Symbol.for("@@mdb.bson.version")](){return t}},rt=class extends Et{get _bsontype(){return"Binary"}constructor(c,S){if(super(),c!=null&&typeof c!="string"&&!ArrayBuffer.isView(c)&&!(c instanceof ArrayBuffer)&&!Array.isArray(c))throw new Z("Binary can only be constructed from string, Buffer, TypedArray, or Array<number>");this.sub_type=S??rt.BSON_BINARY_SUBTYPE_DEFAULT,c==null?(this.buffer=Y.allocate(rt.BUFFER_SIZE),this.position=0):(typeof c=="string"?this.buffer=Y.fromISO88591(c):Array.isArray(c)?this.buffer=Y.fromNumberArray(c):this.buffer=Y.toLocalBufferType(c),this.position=this.buffer.byteLength)}put(c){if(typeof c=="string"&&c.length!==1)throw new Z("only accepts single character String");if(typeof c!="number"&&c.length!==1)throw new Z("only accepts single character Uint8Array or Array");let S;if(typeof c=="string"?S=c.charCodeAt(0):typeof c=="number"?S=c:S=c[0],S<0||S>255)throw new Z("only accepts number in a valid unsigned byte range 0-255");if(this.buffer.byteLength>this.position)this.buffer[this.position++]=S;else{let B=Y.allocate(rt.BUFFER_SIZE+this.buffer.length);B.set(this.buffer,0),this.buffer=B,this.buffer[this.position++]=S}}write(c,S){if(S=typeof S=="number"?S:this.position,this.buffer.byteLength<S+c.length){let B=Y.allocate(this.buffer.byteLength+c.length);B.set(this.buffer,0),this.buffer=B}if(ArrayBuffer.isView(c))this.buffer.set(Y.toLocalBufferType(c),S),this.position=S+c.byteLength>this.position?S+c.length:this.position;else if(typeof c=="string"){let B=Y.fromISO88591(c);this.buffer.set(B,S),this.position=S+c.length>this.position?S+c.length:this.position}}read(c,S){return S=S&&S>0?S:this.position,this.buffer.slice(c,c+S)}value(c){return c=!!c,c&&this.buffer.length===this.position?this.buffer:c?this.buffer.slice(0,this.position):Y.toISO88591(this.buffer.subarray(0,this.position))}length(){return this.position}toJSON(){return Y.toBase64(this.buffer)}toString(c){return c==="hex"?Y.toHex(this.buffer):c==="base64"?Y.toBase64(this.buffer):c==="utf8"||c==="utf-8"?Y.toUTF8(this.buffer):Y.toUTF8(this.buffer)}toExtendedJSON(c){c=c||{};let S=Y.toBase64(this.buffer),B=Number(this.sub_type).toString(16);return c.legacy?{$binary:S,$type:B.length===1?"0"+B:B}:{$binary:{base64:S,subType:B.length===1?"0"+B:B}}}toUUID(){if(this.sub_type===rt.SUBTYPE_UUID)return new O(this.buffer.slice(0,this.position));throw new Z(`Binary sub_type "${this.sub_type}" is not supported for converting to UUID. Only "${rt.SUBTYPE_UUID}" is currently supported.`)}static fromExtendedJSON(c,S){S=S||{};let B,E;if("$binary"in c?S.legacy&&typeof c.$binary=="string"&&"$type"in c?(E=c.$type?parseInt(c.$type,16):0,B=Y.fromBase64(c.$binary)):typeof c.$binary!="string"&&(E=c.$binary.subType?parseInt(c.$binary.subType,16):0,B=Y.fromBase64(c.$binary.base64)):"$uuid"in c&&(E=4,B=pe(c.$uuid)),!B)throw new Z(`Unexpected Binary Extended JSON format ${JSON.stringify(c)}`);return E===Re?new O(B):new rt(B,E)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Binary(Buffer.from("${Y.toHex(this.buffer)}", "hex"), ${this.sub_type})`}};rt.BSON_BINARY_SUBTYPE_DEFAULT=0,rt.BUFFER_SIZE=256,rt.SUBTYPE_DEFAULT=0,rt.SUBTYPE_FUNCTION=1,rt.SUBTYPE_BYTE_ARRAY=2,rt.SUBTYPE_UUID_OLD=3,rt.SUBTYPE_UUID=4,rt.SUBTYPE_MD5=5,rt.SUBTYPE_ENCRYPTED=6,rt.SUBTYPE_COLUMN=7,rt.SUBTYPE_USER_DEFINED=128;var L=16,O=class extends rt{constructor(c){let S,B;if(c==null)S=O.generate();else if(c instanceof O)S=Y.toLocalBufferType(new Uint8Array(c.buffer)),B=c.__id;else if(ArrayBuffer.isView(c)&&c.byteLength===L)S=Y.toLocalBufferType(c);else if(typeof c=="string")S=pe(c);else throw new Z("Argument passed in UUID constructor must be a UUID, a 16 byte Buffer or a 32/36 character hex string (dashes excluded/included, format: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx).");super(S,Re),this.__id=B}get id(){return this.buffer}set id(c){this.buffer=c,O.cacheHexString&&(this.__id=_e(c))}toHexString(c=!0){if(O.cacheHexString&&this.__id)return this.__id;let S=_e(this.id,c);return O.cacheHexString&&(this.__id=S),S}toString(c){return c==="hex"?Y.toHex(this.id):c==="base64"?Y.toBase64(this.id):this.toHexString()}toJSON(){return this.toHexString()}equals(c){if(!c)return!1;if(c instanceof O)return Y.equals(c.id,this.id);try{return Y.equals(new O(c).id,this.id)}catch{return!1}}toBinary(){return new rt(this.id,rt.SUBTYPE_UUID)}static generate(){let c=Y.randomBytes(L);return c[6]=c[6]&15|64,c[8]=c[8]&63|128,c}static isValid(c){return c?c instanceof O?!0:typeof c=="string"?M(c):ve(c)?c.byteLength!==L?!1:(c[6]&240)===64&&(c[8]&128)===128:!1:!1}static createFromHexString(c){let S=pe(c);return new O(S)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new UUID("${this.toHexString()}")`}},A=class extends Et{get _bsontype(){return"Code"}constructor(c,S){super(),this.code=c.toString(),this.scope=S??null}toJSON(){return this.scope!=null?{code:this.code,scope:this.scope}:{code:this.code}}toExtendedJSON(){return this.scope?{$code:this.code,$scope:this.scope}:{$code:this.code}}static fromExtendedJSON(c){return new A(c.$code,c.$scope)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){let c=this.toJSON();return`new Code("${String(c.code)}"${c.scope!=null?`, ${JSON.stringify(c.scope)}`:""})`}};function D(c){return c!=null&&typeof c=="object"&&"$id"in c&&c.$id!=null&&"$ref"in c&&typeof c.$ref=="string"&&(!("$db"in c)||"$db"in c&&typeof c.$db=="string")}var X=class extends Et{get _bsontype(){return"DBRef"}constructor(c,S,B,E){super();let J=c.split(".");J.length===2&&(B=J.shift(),c=J.shift()),this.collection=c,this.oid=S,this.db=B,this.fields=E||{}}get namespace(){return this.collection}set namespace(c){this.collection=c}toJSON(){let c=Object.assign({$ref:this.collection,$id:this.oid},this.fields);return this.db!=null&&(c.$db=this.db),c}toExtendedJSON(c){c=c||{};let S={$ref:this.collection,$id:this.oid};return c.legacy||(this.db&&(S.$db=this.db),S=Object.assign(S,this.fields)),S}static fromExtendedJSON(c){let S=Object.assign({},c);return delete S.$ref,delete S.$id,delete S.$db,new X(c.$ref,c.$id,c.$db,S)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){let c=this.oid===void 0||this.oid.toString===void 0?this.oid:this.oid.toString();return`new DBRef("${this.namespace}", new ObjectId("${String(c)}")${this.db?`, "${this.db}"`:""})`}},se=void 0;try{se=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}var ge=1<<16,nt=1<<24,ct=ge*ge,mt=ct*ct,Bt=mt/2,yt={},ar={},Wr=20,jr=/^(\+?0|(\+|-)?[1-9][0-9]*)$/,$=class extends Et{get _bsontype(){return"Long"}get __isLong__(){return!0}constructor(c=0,S,B){super(),typeof c=="bigint"?Object.assign(this,$.fromBigInt(c,!!S)):typeof c=="string"?Object.assign(this,$.fromString(c,!!S)):(this.low=c|0,this.high=S|0,this.unsigned=!!B)}static fromBits(c,S,B){return new $(c,S,B)}static fromInt(c,S){let B,E,J;return S?(c>>>=0,(J=0<=c&&c<256)&&(E=ar[c],E)?E:(B=$.fromBits(c,(c|0)<0?-1:0,!0),J&&(ar[c]=B),B)):(c|=0,(J=-128<=c&&c<128)&&(E=yt[c],E)?E:(B=$.fromBits(c,c<0?-1:0,!1),J&&(yt[c]=B),B))}static fromNumber(c,S){if(isNaN(c))return S?$.UZERO:$.ZERO;if(S){if(c<0)return $.UZERO;if(c>=mt)return $.MAX_UNSIGNED_VALUE}else{if(c<=-Bt)return $.MIN_VALUE;if(c+1>=Bt)return $.MAX_VALUE}return c<0?$.fromNumber(-c,S).neg():$.fromBits(c%ct|0,c/ct|0,S)}static fromBigInt(c,S){return $.fromString(c.toString(),S)}static fromString(c,S,B){if(c.length===0)throw new Z("empty string");if(c==="NaN"||c==="Infinity"||c==="+Infinity"||c==="-Infinity")return $.ZERO;if(typeof S=="number"?(B=S,S=!1):S=!!S,B=B||10,B<2||36<B)throw new Z("radix");let E;if((E=c.indexOf("-"))>0)throw new Z("interior hyphen");if(E===0)return $.fromString(c.substring(1),S,B).neg();let J=$.fromNumber(Math.pow(B,8)),oe=$.ZERO;for(let le=0;le<c.length;le+=8){let Oe=Math.min(8,c.length-le),V=parseInt(c.substring(le,le+Oe),B);if(Oe<8){let xe=$.fromNumber(Math.pow(B,Oe));oe=oe.mul(xe).add($.fromNumber(V))}else oe=oe.mul(J),oe=oe.add($.fromNumber(V))}return oe.unsigned=S,oe}static fromBytes(c,S,B){return B?$.fromBytesLE(c,S):$.fromBytesBE(c,S)}static fromBytesLE(c,S){return new $(c[0]|c[1]<<8|c[2]<<16|c[3]<<24,c[4]|c[5]<<8|c[6]<<16|c[7]<<24,S)}static fromBytesBE(c,S){return new $(c[4]<<24|c[5]<<16|c[6]<<8|c[7],c[0]<<24|c[1]<<16|c[2]<<8|c[3],S)}static isLong(c){return c!=null&&typeof c=="object"&&"__isLong__"in c&&c.__isLong__===!0}static fromValue(c,S){return typeof c=="number"?$.fromNumber(c,S):typeof c=="string"?$.fromString(c,S):$.fromBits(c.low,c.high,typeof S=="boolean"?S:c.unsigned)}add(c){$.isLong(c)||(c=$.fromValue(c));let S=this.high>>>16,B=this.high&65535,E=this.low>>>16,J=this.low&65535,oe=c.high>>>16,le=c.high&65535,Oe=c.low>>>16,V=c.low&65535,xe=0,he=0,ce=0,be=0;return be+=J+V,ce+=be>>>16,be&=65535,ce+=E+Oe,he+=ce>>>16,ce&=65535,he+=B+le,xe+=he>>>16,he&=65535,xe+=S+oe,xe&=65535,$.fromBits(ce<<16|be,xe<<16|he,this.unsigned)}and(c){return $.isLong(c)||(c=$.fromValue(c)),$.fromBits(this.low&c.low,this.high&c.high,this.unsigned)}compare(c){if($.isLong(c)||(c=$.fromValue(c)),this.eq(c))return 0;let S=this.isNegative(),B=c.isNegative();return S&&!B?-1:!S&&B?1:this.unsigned?c.high>>>0>this.high>>>0||c.high===this.high&&c.low>>>0>this.low>>>0?-1:1:this.sub(c).isNegative()?-1:1}comp(c){return this.compare(c)}divide(c){if($.isLong(c)||(c=$.fromValue(c)),c.isZero())throw new Z("division by zero");if(se){if(!this.unsigned&&this.high===-2147483648&&c.low===-1&&c.high===-1)return this;let J=(this.unsigned?se.div_u:se.div_s)(this.low,this.high,c.low,c.high);return $.fromBits(J,se.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?$.UZERO:$.ZERO;let S,B,E;if(this.unsigned){if(c.unsigned||(c=c.toUnsigned()),c.gt(this))return $.UZERO;if(c.gt(this.shru(1)))return $.UONE;E=$.UZERO}else{if(this.eq($.MIN_VALUE))return c.eq($.ONE)||c.eq($.NEG_ONE)?$.MIN_VALUE:c.eq($.MIN_VALUE)?$.ONE:(S=this.shr(1).div(c).shl(1),S.eq($.ZERO)?c.isNegative()?$.ONE:$.NEG_ONE:(B=this.sub(c.mul(S)),E=S.add(B.div(c)),E));if(c.eq($.MIN_VALUE))return this.unsigned?$.UZERO:$.ZERO;if(this.isNegative())return c.isNegative()?this.neg().div(c.neg()):this.neg().div(c).neg();if(c.isNegative())return this.div(c.neg()).neg();E=$.ZERO}for(B=this;B.gte(c);){S=Math.max(1,Math.floor(B.toNumber()/c.toNumber()));let J=Math.ceil(Math.log(S)/Math.LN2),oe=J<=48?1:Math.pow(2,J-48),le=$.fromNumber(S),Oe=le.mul(c);for(;Oe.isNegative()||Oe.gt(B);)S-=oe,le=$.fromNumber(S,this.unsigned),Oe=le.mul(c);le.isZero()&&(le=$.ONE),E=E.add(le),B=B.sub(Oe)}return E}div(c){return this.divide(c)}equals(c){return $.isLong(c)||(c=$.fromValue(c)),this.unsigned!==c.unsigned&&this.high>>>31===1&&c.high>>>31===1?!1:this.high===c.high&&this.low===c.low}eq(c){return this.equals(c)}getHighBits(){return this.high}getHighBitsUnsigned(){return this.high>>>0}getLowBits(){return this.low}getLowBitsUnsigned(){return this.low>>>0}getNumBitsAbs(){if(this.isNegative())return this.eq($.MIN_VALUE)?64:this.neg().getNumBitsAbs();let c=this.high!==0?this.high:this.low,S;for(S=31;S>0&&!(c&1<<S);S--);return this.high!==0?S+33:S+1}greaterThan(c){return this.comp(c)>0}gt(c){return this.greaterThan(c)}greaterThanOrEqual(c){return this.comp(c)>=0}gte(c){return this.greaterThanOrEqual(c)}ge(c){return this.greaterThanOrEqual(c)}isEven(){return(this.low&1)===0}isNegative(){return!this.unsigned&&this.high<0}isOdd(){return(this.low&1)===1}isPositive(){return this.unsigned||this.high>=0}isZero(){return this.high===0&&this.low===0}lessThan(c){return this.comp(c)<0}lt(c){return this.lessThan(c)}lessThanOrEqual(c){return this.comp(c)<=0}lte(c){return this.lessThanOrEqual(c)}modulo(c){if($.isLong(c)||(c=$.fromValue(c)),se){let S=(this.unsigned?se.rem_u:se.rem_s)(this.low,this.high,c.low,c.high);return $.fromBits(S,se.get_high(),this.unsigned)}return this.sub(this.div(c).mul(c))}mod(c){return this.modulo(c)}rem(c){return this.modulo(c)}multiply(c){if(this.isZero())return $.ZERO;if($.isLong(c)||(c=$.fromValue(c)),se){let Pe=se.mul(this.low,this.high,c.low,c.high);return $.fromBits(Pe,se.get_high(),this.unsigned)}if(c.isZero())return $.ZERO;if(this.eq($.MIN_VALUE))return c.isOdd()?$.MIN_VALUE:$.ZERO;if(c.eq($.MIN_VALUE))return this.isOdd()?$.MIN_VALUE:$.ZERO;if(this.isNegative())return c.isNegative()?this.neg().mul(c.neg()):this.neg().mul(c).neg();if(c.isNegative())return this.mul(c.neg()).neg();if(this.lt($.TWO_PWR_24)&&c.lt($.TWO_PWR_24))return $.fromNumber(this.toNumber()*c.toNumber(),this.unsigned);let S=this.high>>>16,B=this.high&65535,E=this.low>>>16,J=this.low&65535,oe=c.high>>>16,le=c.high&65535,Oe=c.low>>>16,V=c.low&65535,xe=0,he=0,ce=0,be=0;return be+=J*V,ce+=be>>>16,be&=65535,ce+=E*V,he+=ce>>>16,ce&=65535,ce+=J*Oe,he+=ce>>>16,ce&=65535,he+=B*V,xe+=he>>>16,he&=65535,he+=E*Oe,xe+=he>>>16,he&=65535,he+=J*le,xe+=he>>>16,he&=65535,xe+=S*V+B*Oe+E*le+J*oe,xe&=65535,$.fromBits(ce<<16|be,xe<<16|he,this.unsigned)}mul(c){return this.multiply(c)}negate(){return!this.unsigned&&this.eq($.MIN_VALUE)?$.MIN_VALUE:this.not().add($.ONE)}neg(){return this.negate()}not(){return $.fromBits(~this.low,~this.high,this.unsigned)}notEquals(c){return!this.equals(c)}neq(c){return this.notEquals(c)}ne(c){return this.notEquals(c)}or(c){return $.isLong(c)||(c=$.fromValue(c)),$.fromBits(this.low|c.low,this.high|c.high,this.unsigned)}shiftLeft(c){return $.isLong(c)&&(c=c.toInt()),(c&=63)===0?this:c<32?$.fromBits(this.low<<c,this.high<<c|this.low>>>32-c,this.unsigned):$.fromBits(0,this.low<<c-32,this.unsigned)}shl(c){return this.shiftLeft(c)}shiftRight(c){return $.isLong(c)&&(c=c.toInt()),(c&=63)===0?this:c<32?$.fromBits(this.low>>>c|this.high<<32-c,this.high>>c,this.unsigned):$.fromBits(this.high>>c-32,this.high>=0?0:-1,this.unsigned)}shr(c){return this.shiftRight(c)}shiftRightUnsigned(c){if($.isLong(c)&&(c=c.toInt()),c&=63,c===0)return this;{let S=this.high;if(c<32){let B=this.low;return $.fromBits(B>>>c|S<<32-c,S>>>c,this.unsigned)}else return c===32?$.fromBits(S,0,this.unsigned):$.fromBits(S>>>c-32,0,this.unsigned)}}shr_u(c){return this.shiftRightUnsigned(c)}shru(c){return this.shiftRightUnsigned(c)}subtract(c){return $.isLong(c)||(c=$.fromValue(c)),this.add(c.neg())}sub(c){return this.subtract(c)}toInt(){return this.unsigned?this.low>>>0:this.low}toNumber(){return this.unsigned?(this.high>>>0)*ct+(this.low>>>0):this.high*ct+(this.low>>>0)}toBigInt(){return BigInt(this.toString())}toBytes(c){return c?this.toBytesLE():this.toBytesBE()}toBytesLE(){let c=this.high,S=this.low;return[S&255,S>>>8&255,S>>>16&255,S>>>24,c&255,c>>>8&255,c>>>16&255,c>>>24]}toBytesBE(){let c=this.high,S=this.low;return[c>>>24,c>>>16&255,c>>>8&255,c&255,S>>>24,S>>>16&255,S>>>8&255,S&255]}toSigned(){return this.unsigned?$.fromBits(this.low,this.high,!1):this}toString(c){if(c=c||10,c<2||36<c)throw new Z("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq($.MIN_VALUE)){let J=$.fromNumber(c),oe=this.div(J),le=oe.mul(J).sub(this);return oe.toString(c)+le.toInt().toString(c)}else return"-"+this.neg().toString(c);let S=$.fromNumber(Math.pow(c,6),this.unsigned),B=this,E="";for(;;){let J=B.div(S),le=(B.sub(J.mul(S)).toInt()>>>0).toString(c);if(B=J,B.isZero())return le+E;for(;le.length<6;)le="0"+le;E=""+le+E}}toUnsigned(){return this.unsigned?this:$.fromBits(this.low,this.high,!0)}xor(c){return $.isLong(c)||(c=$.fromValue(c)),$.fromBits(this.low^c.low,this.high^c.high,this.unsigned)}eqz(){return this.isZero()}le(c){return this.lessThanOrEqual(c)}toExtendedJSON(c){return c&&c.relaxed?this.toNumber():{$numberLong:this.toString()}}static fromExtendedJSON(c,S){let{useBigInt64:B=!1,relaxed:E=!0}={...S};if(c.$numberLong.length>Wr)throw new Z("$numberLong string is too long");if(!jr.test(c.$numberLong))throw new Z(`$numberLong string "${c.$numberLong}" is in an invalid format`);if(B){let oe=BigInt(c.$numberLong);return BigInt.asIntN(64,oe)}let J=$.fromString(c.$numberLong);return E?J.toNumber():J}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Long("${this.toString()}"${this.unsigned?", true":""})`}};$.TWO_PWR_24=$.fromInt(nt),$.MAX_UNSIGNED_VALUE=$.fromBits(-1,-1,!0),$.ZERO=$.fromInt(0),$.UZERO=$.fromInt(0,!0),$.ONE=$.fromInt(1),$.UONE=$.fromInt(1,!0),$.NEG_ONE=$.fromInt(-1),$.MAX_VALUE=$.fromBits(-1,2147483647,!1),$.MIN_VALUE=$.fromBits(0,-2147483648,!1);var Qi=/^(\+|-)?(\d+|(\d*\.\d*))?(E|e)?([-+])?(\d+)?$/,en=/^(\+|-)?(Infinity|inf)$/i,tn=/^(\+|-)?NaN$/i,ie=6111,Ae=-6176,j=6176,Le=34,_t=Y.fromNumberArray([124,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Ne=Y.fromNumberArray([248,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),Xt=Y.fromNumberArray([120,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0].reverse()),je=/^([-+])?(\d+)?$/,Rt=31,ue=16383,de=30,Gr=31;function Ot(c){return!isNaN(parseInt(c,10))}function Ue(c){let S=$.fromNumber(1e9),B=$.fromNumber(0);if(!c.parts[0]&&!c.parts[1]&&!c.parts[2]&&!c.parts[3])return{quotient:c,rem:B};for(let E=0;E<=3;E++)B=B.shiftLeft(32),B=B.add(new $(c.parts[E],0)),c.parts[E]=B.div(S).low,B=B.modulo(S);return{quotient:c,rem:B}}function Lr(c,S){if(!c&&!S)return{high:$.fromNumber(0),low:$.fromNumber(0)};let B=c.shiftRightUnsigned(32),E=new $(c.getLowBits(),0),J=S.shiftRightUnsigned(32),oe=new $(S.getLowBits(),0),le=B.multiply(J),Oe=B.multiply(oe),V=E.multiply(J),xe=E.multiply(oe);return le=le.add(Oe.shiftRightUnsigned(32)),Oe=new $(Oe.getLowBits(),0).add(V).add(xe.shiftRightUnsigned(32)),le=le.add(Oe.shiftRightUnsigned(32)),xe=Oe.shiftLeft(32).add(new $(xe.getLowBits(),0)),{high:le,low:xe}}function kr(c,S){let B=c.high>>>0,E=S.high>>>0;if(B<E)return!0;if(B===E){let J=c.low>>>0,oe=S.low>>>0;if(J<oe)return!0}return!1}function vt(c,S){throw new Z(`"${c}" is not a valid Decimal128 string - ${S}`)}var Qe=class extends Et{get _bsontype(){return"Decimal128"}constructor(c){if(super(),typeof c=="string")this.bytes=Qe.fromString(c).bytes;else if(ve(c)){if(c.byteLength!==16)throw new Z("Decimal128 must take a Buffer of 16 bytes");this.bytes=c}else throw new Z("Decimal128 must take a Buffer or string")}static fromString(c){let S=!1,B=!1,E=!1,J=0,oe=0,le=0,Oe=0,V=0,xe=[0],he=0,ce=0,be=0,Pe=0,Se=0,Jt=0,Kt=new $(0,0),St=new $(0,0),zt=0,De=0;if(c.length>=7e3)throw new Z(""+c+" not a valid Decimal128 string");let Ht=c.match(Qi),Xr=c.match(en),di=c.match(tn);if(!Ht&&!Xr&&!di||c.length===0)throw new Z(""+c+" not a valid Decimal128 string");if(Ht){let ft=Ht[2],st=Ht[4],Ie=Ht[5],Xe=Ht[6];st&&Xe===void 0&&vt(c,"missing exponent power"),st&&ft===void 0&&vt(c,"missing exponent base"),st===void 0&&(Ie||Xe)&&vt(c,"missing e before exponent")}if((c[De]==="+"||c[De]==="-")&&(S=c[De++]==="-"),!Ot(c[De])&&c[De]!=="."){if(c[De]==="i"||c[De]==="I")return new Qe(S?Ne:Xt);if(c[De]==="N")return new Qe(_t)}for(;Ot(c[De])||c[De]===".";){if(c[De]==="."){B&&vt(c,"contains multiple periods"),B=!0,De=De+1;continue}he<34&&(c[De]!=="0"||E)&&(E||(V=oe),E=!0,xe[ce++]=parseInt(c[De],10),he=he+1),E&&(le=le+1),B&&(Oe=Oe+1),oe=oe+1,De=De+1}if(B&&!oe)throw new Z(""+c+" not a valid Decimal128 string");if(c[De]==="e"||c[De]==="E"){let ft=c.substr(++De).match(je);if(!ft||!ft[2])return new Qe(_t);Se=parseInt(ft[0],10),De=De+ft[0].length}if(c[De])return new Qe(_t);if(be=0,!he)be=0,Pe=0,xe[0]=0,le=1,he=1,J=0;else if(Pe=he-1,J=le,J!==1)for(;xe[V+J-1]===0;)J=J-1;for(Se<=Oe&&Oe-Se>1<<14?Se=Ae:Se=Se-Oe;Se>ie;){if(Pe=Pe+1,Pe-be>Le){if(xe.join("").match(/^0+$/)){Se=ie;break}vt(c,"overflow")}Se=Se-1}for(;Se<Ae||he<le;){if(Pe===0&&J<he){Se=Ae,J=0;break}if(he<le?le=le-1:Pe=Pe-1,Se<ie)Se=Se+1;else{if(xe.join("").match(/^0+$/)){Se=ie;break}vt(c,"overflow")}}if(Pe-be+1<J){let ft=oe;B&&(V=V+1,ft=ft+1),S&&(V=V+1,ft=ft+1);let st=parseInt(c[V+Pe+1],10),Ie=0;if(st>=5&&(Ie=1,st===5)){for(Ie=xe[Pe]%2===1?1:0,Jt=V+Pe+2;Jt<ft;Jt++)if(parseInt(c[Jt],10)){Ie=1;break}}if(Ie){let Xe=Pe;for(;Xe>=0;Xe--)if(++xe[Xe]>9&&(xe[Xe]=0,Xe===0))if(Se<ie)Se=Se+1,xe[Xe]=1;else return new Qe(S?Ne:Xt)}}if(Kt=$.fromNumber(0),St=$.fromNumber(0),J===0)Kt=$.fromNumber(0),St=$.fromNumber(0);else if(Pe-be<17){let ft=be;for(St=$.fromNumber(xe[ft++]),Kt=new $(0,0);ft<=Pe;ft++)St=St.multiply($.fromNumber(10)),St=St.add($.fromNumber(xe[ft]))}else{let ft=be;for(Kt=$.fromNumber(xe[ft++]);ft<=Pe-17;ft++)Kt=Kt.multiply($.fromNumber(10)),Kt=Kt.add($.fromNumber(xe[ft]));for(St=$.fromNumber(xe[ft++]);ft<=Pe;ft++)St=St.multiply($.fromNumber(10)),St=St.add($.fromNumber(xe[ft]))}let Ze=Lr(Kt,$.fromString("100000000000000000"));Ze.low=Ze.low.add(St),kr(Ze.low,St)&&(Ze.high=Ze.high.add($.fromNumber(1))),zt=Se+j;let Ee={low:$.fromNumber(0),high:$.fromNumber(0)};Ze.high.shiftRightUnsigned(49).and($.fromNumber(1)).equals($.fromNumber(1))?(Ee.high=Ee.high.or($.fromNumber(3).shiftLeft(61)),Ee.high=Ee.high.or($.fromNumber(zt).and($.fromNumber(16383).shiftLeft(47))),Ee.high=Ee.high.or(Ze.high.and($.fromNumber(0x7fffffffffff)))):(Ee.high=Ee.high.or($.fromNumber(zt&16383).shiftLeft(49)),Ee.high=Ee.high.or(Ze.high.and($.fromNumber(562949953421311)))),Ee.low=Ze.low,S&&(Ee.high=Ee.high.or($.fromString("9223372036854775808")));let Nt=Y.allocate(16);return De=0,Nt[De++]=Ee.low.low&255,Nt[De++]=Ee.low.low>>8&255,Nt[De++]=Ee.low.low>>16&255,Nt[De++]=Ee.low.low>>24&255,Nt[De++]=Ee.low.high&255,Nt[De++]=Ee.low.high>>8&255,Nt[De++]=Ee.low.high>>16&255,Nt[De++]=Ee.low.high>>24&255,Nt[De++]=Ee.high.low&255,Nt[De++]=Ee.high.low>>8&255,Nt[De++]=Ee.high.low>>16&255,Nt[De++]=Ee.high.low>>24&255,Nt[De++]=Ee.high.high&255,Nt[De++]=Ee.high.high>>8&255,Nt[De++]=Ee.high.high>>16&255,Nt[De++]=Ee.high.high>>24&255,new Qe(Nt)}toString(){let c,S=0,B=new Array(36);for(let De=0;De<B.length;De++)B[De]=0;let E=0,J=!1,oe,le={parts:[0,0,0,0]},Oe,V,xe=[];E=0;let he=this.bytes,ce=he[E++]|he[E++]<<8|he[E++]<<16|he[E++]<<24,be=he[E++]|he[E++]<<8|he[E++]<<16|he[E++]<<24,Pe=he[E++]|he[E++]<<8|he[E++]<<16|he[E++]<<24,Se=he[E++]|he[E++]<<8|he[E++]<<16|he[E++]<<24;E=0,{low:new $(ce,be),high:new $(Pe,Se)}.high.lessThan($.ZERO)&&xe.push("-");let Kt=Se>>26&Rt;if(Kt>>3===3){if(Kt===de)return xe.join("")+"Infinity";if(Kt===Gr)return"NaN";c=Se>>15&ue,oe=8+(Se>>14&1)}else oe=Se>>14&7,c=Se>>17&ue;let St=c-j;if(le.parts[0]=(Se&16383)+((oe&15)<<14),le.parts[1]=Pe,le.parts[2]=be,le.parts[3]=ce,le.parts[0]===0&&le.parts[1]===0&&le.parts[2]===0&&le.parts[3]===0)J=!0;else for(V=3;V>=0;V--){let De=0,Ht=Ue(le);if(le=Ht.quotient,De=Ht.rem.low,!!De)for(Oe=8;Oe>=0;Oe--)B[V*9+Oe]=De%10,De=Math.floor(De/10)}if(J)S=1,B[E]=0;else for(S=36;!B[E];)S=S-1,E=E+1;let zt=S-1+St;if(zt>=34||zt<=-7||St>0){if(S>34)return xe.push("0"),St>0?xe.push(`E+${St}`):St<0&&xe.push(`E${St}`),xe.join("");xe.push(`${B[E++]}`),S=S-1,S&&xe.push(".");for(let De=0;De<S;De++)xe.push(`${B[E++]}`);xe.push("E"),zt>0?xe.push(`+${zt}`):xe.push(`${zt}`)}else if(St>=0)for(let De=0;De<S;De++)xe.push(`${B[E++]}`);else{let De=S+St;if(De>0)for(let Ht=0;Ht<De;Ht++)xe.push(`${B[E++]}`);else xe.push("0");for(xe.push(".");De++<0;)xe.push("0");for(let Ht=0;Ht<S-Math.max(De-1,0);Ht++)xe.push(`${B[E++]}`)}return xe.join("")}toJSON(){return{$numberDecimal:this.toString()}}toExtendedJSON(){return{$numberDecimal:this.toString()}}static fromExtendedJSON(c){return Qe.fromString(c.$numberDecimal)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Decimal128("${this.toString()}")`}},Ft=class extends Et{get _bsontype(){return"Double"}constructor(c){super(),c instanceof Number&&(c=c.valueOf()),this.value=+c}valueOf(){return this.value}toJSON(){return this.value}toString(c){return this.value.toString(c)}toExtendedJSON(c){return c&&(c.legacy||c.relaxed&&isFinite(this.value))?this.value:Object.is(Math.sign(this.value),-0)?{$numberDouble:"-0.0"}:{$numberDouble:Number.isInteger(this.value)?this.value.toFixed(1):this.value.toString()}}static fromExtendedJSON(c,S){let B=parseFloat(c.$numberDouble);return S&&S.relaxed?B:new Ft(B)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Double(${this.toExtendedJSON().$numberDouble})`}},Mt=class extends Et{get _bsontype(){return"Int32"}constructor(c){super(),c instanceof Number&&(c=c.valueOf()),this.value=+c|0}valueOf(){return this.value}toString(c){return this.value.toString(c)}toJSON(){return this.value}toExtendedJSON(c){return c&&(c.relaxed||c.legacy)?this.value:{$numberInt:this.value.toString()}}static fromExtendedJSON(c,S){return S&&S.relaxed?parseInt(c.$numberInt,10):new Mt(c.$numberInt)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Int32(${this.valueOf()})`}},Ct=class extends Et{get _bsontype(){return"MaxKey"}toExtendedJSON(){return{$maxKey:1}}static fromExtendedJSON(){return new Ct}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MaxKey()"}},yr=class extends Et{get _bsontype(){return"MinKey"}toExtendedJSON(){return{$minKey:1}}static fromExtendedJSON(){return new yr}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return"new MinKey()"}},Dr=new RegExp("^[0-9a-fA-F]{24}$"),wt=null,jt=Symbol("id"),it=class extends Et{get _bsontype(){return"ObjectId"}constructor(c){super();let S;if(typeof c=="object"&&c&&"id"in c){if(typeof c.id!="string"&&!ArrayBuffer.isView(c.id))throw new Z("Argument passed in must have an id that is of type string or Buffer");"toHexString"in c&&typeof c.toHexString=="function"?S=Y.fromHex(c.toHexString()):S=c.id}else S=c;if(S==null||typeof S=="number")this[jt]=it.generate(typeof S=="number"?S:void 0);else if(ArrayBuffer.isView(S)&&S.byteLength===12)this[jt]=Y.toLocalBufferType(S);else if(typeof S=="string")if(S.length===12){let B=Y.fromUTF8(S);if(B.byteLength===12)this[jt]=B;else throw new Z("Argument passed in must be a string of 12 bytes")}else if(S.length===24&&Dr.test(S))this[jt]=Y.fromHex(S);else throw new Z("Argument passed in must be a string of 12 bytes or a string of 24 hex characters or an integer");else throw new Z("Argument passed in does not match the accepted types");it.cacheHexString&&(this.__id=Y.toHex(this.id))}get id(){return this[jt]}set id(c){this[jt]=c,it.cacheHexString&&(this.__id=Y.toHex(c))}toHexString(){if(it.cacheHexString&&this.__id)return this.__id;let c=Y.toHex(this.id);return it.cacheHexString&&!this.__id&&(this.__id=c),c}static getInc(){return it.index=(it.index+1)%16777215}static generate(c){typeof c!="number"&&(c=Math.floor(Date.now()/1e3));let S=it.getInc(),B=Y.allocate(12);return Tt.fromUint8Array(B).setUint32(0,c,!1),wt===null&&(wt=Y.randomBytes(5)),B[4]=wt[0],B[5]=wt[1],B[6]=wt[2],B[7]=wt[3],B[8]=wt[4],B[11]=S&255,B[10]=S>>8&255,B[9]=S>>16&255,B}toString(c){return c==="base64"?Y.toBase64(this.id):c==="hex"?this.toHexString():this.toHexString()}toJSON(){return this.toHexString()}equals(c){if(c==null)return!1;if(c instanceof it)return this[jt][11]===c[jt][11]&&Y.equals(this[jt],c[jt]);if(typeof c=="string"&&it.isValid(c)&&c.length===12&&ve(this.id))return Y.equals(this.id,Y.fromISO88591(c));if(typeof c=="string"&&it.isValid(c)&&c.length===24)return c.toLowerCase()===this.toHexString();if(typeof c=="string"&&it.isValid(c)&&c.length===12)return Y.equals(Y.fromUTF8(c),this.id);if(typeof c=="object"&&"toHexString"in c&&typeof c.toHexString=="function"){let S=c.toHexString(),B=this.toHexString().toLowerCase();return typeof S=="string"&&S.toLowerCase()===B}return!1}getTimestamp(){let c=new Date,S=Tt.fromUint8Array(this.id).getUint32(0,!1);return c.setTime(Math.floor(S)*1e3),c}static createPk(){return new it}static createFromTime(c){let S=Y.fromNumberArray([0,0,0,0,0,0,0,0,0,0,0,0]);return Tt.fromUint8Array(S).setUint32(0,c,!1),new it(S)}static createFromHexString(c){if(typeof c>"u"||c!=null&&c.length!==24)throw new Z("Argument passed in must be a single String of 12 bytes or a string of 24 hex characters");return new it(Y.fromHex(c))}static isValid(c){if(c==null)return!1;try{return new it(c),!0}catch{return!1}}toExtendedJSON(){return this.toHexString?{$oid:this.toHexString()}:{$oid:this.toString("hex")}}static fromExtendedJSON(c){return new it(c.$oid)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new ObjectId("${this.toHexString()}")`}};it.index=Math.floor(Math.random()*16777215);function tr(c,S,B){let E=5;if(Array.isArray(c))for(let J=0;J<c.length;J++)E+=sr(J.toString(),c[J],S,!0,B);else{typeof c?.toBSON=="function"&&(c=c.toBSON());for(let J of Object.keys(c))E+=sr(J,c[J],S,!1,B)}return E}function sr(c,S,B=!1,E=!1,J=!1){switch(typeof S?.toBSON=="function"&&(S=S.toBSON()),typeof S){case"string":return 1+Y.utf8ByteLength(c)+1+4+Y.utf8ByteLength(S)+1;case"number":return Math.floor(S)===S&&S>=d&&S<=p&&S>=i&&S<=r?(c!=null?Y.utf8ByteLength(c)+1:0)+(4+1):(c!=null?Y.utf8ByteLength(c)+1:0)+(8+1);case"undefined":return E||!J?(c!=null?Y.utf8ByteLength(c)+1:0)+1:0;case"boolean":return(c!=null?Y.utf8ByteLength(c)+1:0)+(1+1);case"object":if(S!=null&&typeof S._bsontype=="string"&&S[Symbol.for("@@mdb.bson.version")]!==t)throw new ze;if(S==null||S._bsontype==="MinKey"||S._bsontype==="MaxKey")return(c!=null?Y.utf8ByteLength(c)+1:0)+1;if(S._bsontype==="ObjectId")return(c!=null?Y.utf8ByteLength(c)+1:0)+(12+1);if(S instanceof Date||xt(S))return(c!=null?Y.utf8ByteLength(c)+1:0)+(8+1);if(ArrayBuffer.isView(S)||S instanceof ArrayBuffer||Ve(S))return(c!=null?Y.utf8ByteLength(c)+1:0)+(1+4+1)+S.byteLength;if(S._bsontype==="Long"||S._bsontype==="Double"||S._bsontype==="Timestamp")return(c!=null?Y.utf8ByteLength(c)+1:0)+(8+1);if(S._bsontype==="Decimal128")return(c!=null?Y.utf8ByteLength(c)+1:0)+(16+1);if(S._bsontype==="Code")return S.scope!=null&&Object.keys(S.scope).length>0?(c!=null?Y.utf8ByteLength(c)+1:0)+1+4+4+Y.utf8ByteLength(S.code.toString())+1+tr(S.scope,B,J):(c!=null?Y.utf8ByteLength(c)+1:0)+1+4+Y.utf8ByteLength(S.code.toString())+1;if(S._bsontype==="Binary"){let oe=S;return oe.sub_type===rt.SUBTYPE_BYTE_ARRAY?(c!=null?Y.utf8ByteLength(c)+1:0)+(oe.position+1+4+1+4):(c!=null?Y.utf8ByteLength(c)+1:0)+(oe.position+1+4+1)}else{if(S._bsontype==="Symbol")return(c!=null?Y.utf8ByteLength(c)+1:0)+Y.utf8ByteLength(S.value)+4+1+1;if(S._bsontype==="DBRef"){let oe=Object.assign({$ref:S.collection,$id:S.oid},S.fields);return S.db!=null&&(oe.$db=S.db),(c!=null?Y.utf8ByteLength(c)+1:0)+1+tr(oe,B,J)}else return S instanceof RegExp||Ye(S)?(c!=null?Y.utf8ByteLength(c)+1:0)+1+Y.utf8ByteLength(S.source)+1+(S.global?1:0)+(S.ignoreCase?1:0)+(S.multiline?1:0)+1:S._bsontype==="BSONRegExp"?(c!=null?Y.utf8ByteLength(c)+1:0)+1+Y.utf8ByteLength(S.pattern)+1+Y.utf8ByteLength(S.options)+1:(c!=null?Y.utf8ByteLength(c)+1:0)+tr(S,B,J)+1}case"function":if(B)return(c!=null?Y.utf8ByteLength(c)+1:0)+1+4+Y.utf8ByteLength(S.toString())+1}return 0}function Ei(c){return c.split("").sort().join("")}var lr=class extends Et{get _bsontype(){return"BSONRegExp"}constructor(c,S){if(super(),this.pattern=c,this.options=Ei(S??""),this.pattern.indexOf("\0")!==-1)throw new Z(`BSON Regex patterns cannot contain null bytes, found: ${JSON.stringify(this.pattern)}`);if(this.options.indexOf("\0")!==-1)throw new Z(`BSON Regex options cannot contain null bytes, found: ${JSON.stringify(this.options)}`);for(let B=0;B<this.options.length;B++)if(!(this.options[B]==="i"||this.options[B]==="m"||this.options[B]==="x"||this.options[B]==="l"||this.options[B]==="s"||this.options[B]==="u"))throw new Z(`The regular expression option [${this.options[B]}] is not supported`)}static parseOptions(c){return c?c.split("").sort().join(""):""}toExtendedJSON(c){return c=c||{},c.legacy?{$regex:this.pattern,$options:this.options}:{$regularExpression:{pattern:this.pattern,options:this.options}}}static fromExtendedJSON(c){if("$regex"in c)if(typeof c.$regex!="string"){if(c.$regex._bsontype==="BSONRegExp")return c}else return new lr(c.$regex,lr.parseOptions(c.$options));if("$regularExpression"in c)return new lr(c.$regularExpression.pattern,lr.parseOptions(c.$regularExpression.options));throw new Z(`Unexpected BSONRegExp EJSON object form: ${JSON.stringify(c)}`)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new BSONRegExp(${JSON.stringify(this.pattern)}, ${JSON.stringify(this.options)})`}},Pr=class extends Et{get _bsontype(){return"BSONSymbol"}constructor(c){super(),this.value=c}valueOf(){return this.value}toString(){return this.value}inspect(){return`new BSONSymbol("${this.value}")`}toJSON(){return this.value}toExtendedJSON(){return{$symbol:this.value}}static fromExtendedJSON(c){return new Pr(c.$symbol)}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}},Zs=$,cr=class extends Zs{get _bsontype(){return"Timestamp"}constructor(c){if(c==null)super(0,0,!0);else if(typeof c=="bigint")super(c,!0);else if($.isLong(c))super(c.low,c.high,!0);else if(typeof c=="object"&&"t"in c&&"i"in c){if(typeof c.t!="number"&&(typeof c.t!="object"||c.t._bsontype!=="Int32"))throw new Z("Timestamp constructed from { t, i } must provide t as a number");if(typeof c.i!="number"&&(typeof c.i!="object"||c.i._bsontype!=="Int32"))throw new Z("Timestamp constructed from { t, i } must provide i as a number");if(c.t<0)throw new Z("Timestamp constructed from { t, i } must provide a positive t");if(c.i<0)throw new Z("Timestamp constructed from { t, i } must provide a positive i");if(c.t>4294967295)throw new Z("Timestamp constructed from { t, i } must provide t equal or less than uint32 max");if(c.i>4294967295)throw new Z("Timestamp constructed from { t, i } must provide i equal or less than uint32 max");super(c.i.valueOf(),c.t.valueOf(),!0)}else throw new Z("A Timestamp can only be constructed with: bigint, Long, or { t: number; i: number }")}toJSON(){return{$timestamp:this.toString()}}static fromInt(c){return new cr($.fromInt(c,!0))}static fromNumber(c){return new cr($.fromNumber(c,!0))}static fromBits(c,S){return new cr({i:c,t:S})}static fromString(c,S){return new cr($.fromString(c,!0,S))}toExtendedJSON(){return{$timestamp:{t:this.high>>>0,i:this.low>>>0}}}static fromExtendedJSON(c){let S=$.isLong(c.$timestamp.i)?c.$timestamp.i.getLowBitsUnsigned():c.$timestamp.i,B=$.isLong(c.$timestamp.t)?c.$timestamp.t.getLowBitsUnsigned():c.$timestamp.t;return new cr({t:B,i:S})}[Symbol.for("nodejs.util.inspect.custom")](){return this.inspect()}inspect(){return`new Timestamp({ t: ${this.getHighBits()}, i: ${this.getLowBits()} })`}};cr.MAX_VALUE=$.MAX_UNSIGNED_VALUE;var Qs=128,eo=192,to=224,ro=240,io=248,no=192,so=224,oo=240,ao=128;function Vn(c,S,B){let E=0;for(let J=S;J<B;J+=1){let oe=c[J];if(E){if((oe&eo)!==ao)return!1;E-=1}else if(oe&Qs)if((oe&to)===no)E=1;else if((oe&ro)===so)E=2;else if((oe&io)===oo)E=3;else return!1}return!E}var lo=$.fromNumber(p),co=$.fromNumber(d);function Jn(c,S,B){S=S??{};let E=S&&S.index?S.index:0,J=c[E]|c[E+1]<<8|c[E+2]<<16|c[E+3]<<24;if(J<5)throw new Z(`bson size must be >= 5, is ${J}`);if(S.allowObjectSmallerThanBufferSize&&c.length<J)throw new Z(`buffer length ${c.length} must be >= bson size ${J}`);if(!S.allowObjectSmallerThanBufferSize&&c.length!==J)throw new Z(`buffer length ${c.length} must === bson size ${J}`);if(J+E>c.byteLength)throw new Z(`(bson size ${J} + options.index ${E} must be <= buffer length ${c.byteLength})`);if(c[E+J-1]!==0)throw new Z("One object, sized correctly, with a spot for an EOO, but the EOO isn't 0x00");return Oi(c,E,S,B)}var fo=/^\$ref$|^\$id$|^\$db$/;function Oi(c,S,B,E=!1){let J=B.fieldsAsRaw==null?null:B.fieldsAsRaw,oe=B.raw==null?!1:B.raw,le=typeof B.bsonRegExp=="boolean"?B.bsonRegExp:!1,Oe=B.promoteBuffers??!1,V=B.promoteLongs??!0,xe=B.promoteValues??!0,he=B.useBigInt64??!1;if(he&&!xe)throw new Z("Must either request bigint or Long for int64 deserialization");if(he&&!V)throw new Z("Must either request bigint or Long for int64 deserialization");let ce=B.validation==null?{utf8:!0}:B.validation,be=!0,Pe,Se=new Set,Jt=ce.utf8;if(typeof Jt=="boolean")Pe=Jt;else{be=!1;let Ze=Object.keys(Jt).map(function(Ee){return Jt[Ee]});if(Ze.length===0)throw new Z("UTF-8 validation setting cannot be empty");if(typeof Ze[0]!="boolean")throw new Z("Invalid UTF-8 validation option, must specify boolean values");if(Pe=Ze[0],!Ze.every(Ee=>Ee===Pe))throw new Z("Invalid UTF-8 validation option - keys must be all true or all false")}if(!be)for(let Ze of Object.keys(Jt))Se.add(Ze);let Kt=S;if(c.length<5)throw new Z("corrupt bson message < 5 bytes long");let St=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(St<5||St>c.length)throw new Z("corrupt bson message");let zt=E?[]:{},De=0,Ht=!1,Xr=E?!1:null,di=new DataView(c.buffer,c.byteOffset,c.byteLength);for(;!Ht;){let Ze=c[S++];if(Ze===0)break;let Ee=S;for(;c[Ee]!==0&&Ee<c.length;)Ee++;if(Ee>=c.byteLength)throw new Z("Bad BSON Document: illegal CString");let Nt=E?De++:Y.toUTF8(c.subarray(S,Ee)),ft=!0;be||Se.has(Nt)?ft=Pe:ft=!Pe,Xr!==!1&&Nt[0]==="$"&&(Xr=fo.test(Nt));let st;if(S=Ee+1,Ze===b){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(Ie<=0||Ie>c.length-S||c[S+Ie-1]!==0)throw new Z("bad string length in bson");st=Ai(c,S,S+Ie-1,ft),S=S+Ie}else if(Ze===T){let Ie=Y.allocate(12);Ie.set(c.subarray(S,S+12)),st=new it(Ie),S=S+12}else if(Ze===re&&xe===!1)st=new Mt(c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24);else if(Ze===re)st=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;else if(Ze===y&&xe===!1)st=new Ft(di.getFloat64(S,!0)),S=S+8;else if(Ze===y)st=di.getFloat64(S,!0),S=S+8;else if(Ze===I){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24,Xe=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;st=new Date(new $(Ie,Xe).toNumber())}else if(Ze===C){if(c[S]!==0&&c[S]!==1)throw new Z("illegal boolean type value");st=c[S++]===1}else if(Ze===v){let Ie=S,Xe=c[S]|c[S+1]<<8|c[S+2]<<16|c[S+3]<<24;if(Xe<=0||Xe>c.length-S)throw new Z("bad embedded document length in bson");if(oe)st=c.slice(S,S+Xe);else{let kt=B;be||(kt={...B,validation:{utf8:ft}}),st=Oi(c,Ie,kt,!1)}S=S+Xe}else if(Ze===h){let Ie=S,Xe=c[S]|c[S+1]<<8|c[S+2]<<16|c[S+3]<<24,kt=B,Zt=S+Xe;if(J&&J[Nt]&&(kt={...B,raw:!0}),be||(kt={...kt,validation:{utf8:ft}}),st=Oi(c,Ie,kt,!0),S=S+Xe,c[S-1]!==0)throw new Z("invalid array terminator byte");if(S!==Zt)throw new Z("corrupted array bson")}else if(Ze===_)st=void 0;else if(Ze===P)st=null;else if(Ze===Fe){let Ie=Tt.fromUint8Array(c.subarray(S,S+8)),Xe=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24,kt=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24,Zt=new $(Xe,kt);he?st=Ie.getBigInt64(0,!0):V&&xe===!0?st=Zt.lessThanOrEqual(lo)&&Zt.greaterThanOrEqual(co)?Zt.toNumber():Zt:st=Zt}else if(Ze===ee){let Ie=Y.allocate(16);Ie.set(c.subarray(S,S+16),0),S=S+16,st=new Qe(Ie)}else if(Ze===w){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24,Xe=Ie,kt=c[S++];if(Ie<0)throw new Z("Negative binary type element size found");if(Ie>c.byteLength)throw new Z("Binary type size larger than document size");if(c.slice!=null){if(kt===rt.SUBTYPE_BYTE_ARRAY){if(Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24,Ie<0)throw new Z("Negative binary type element size found for subtype 0x02");if(Ie>Xe-4)throw new Z("Binary type with subtype 0x02 contains too long binary size");if(Ie<Xe-4)throw new Z("Binary type with subtype 0x02 contains too short binary size")}Oe&&xe?st=Y.toLocalBufferType(c.slice(S,S+Ie)):(st=new rt(c.slice(S,S+Ie),kt),kt===Re&&(st=st.toUUID()))}else{let Zt=Y.allocate(Ie);if(kt===rt.SUBTYPE_BYTE_ARRAY){if(Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24,Ie<0)throw new Z("Negative binary type element size found for subtype 0x02");if(Ie>Xe-4)throw new Z("Binary type with subtype 0x02 contains too long binary size");if(Ie<Xe-4)throw new Z("Binary type with subtype 0x02 contains too short binary size")}for(Ee=0;Ee<Ie;Ee++)Zt[Ee]=c[S+Ee];Oe&&xe?st=Zt:kt===Re?st=new rt(c.slice(S,S+Ie),kt).toUUID():st=new rt(c.slice(S,S+Ie),kt)}S=S+Ie}else if(Ze===U&&le===!1){for(Ee=S;c[Ee]!==0&&Ee<c.length;)Ee++;if(Ee>=c.length)throw new Z("Bad BSON Document: illegal CString");let Ie=Y.toUTF8(c.subarray(S,Ee));for(S=Ee+1,Ee=S;c[Ee]!==0&&Ee<c.length;)Ee++;if(Ee>=c.length)throw new Z("Bad BSON Document: illegal CString");let Xe=Y.toUTF8(c.subarray(S,Ee));S=Ee+1;let kt=new Array(Xe.length);for(Ee=0;Ee<Xe.length;Ee++)switch(Xe[Ee]){case"m":kt[Ee]="m";break;case"s":kt[Ee]="g";break;case"i":kt[Ee]="i";break}st=new RegExp(Ie,kt.join(""))}else if(Ze===U&&le===!0){for(Ee=S;c[Ee]!==0&&Ee<c.length;)Ee++;if(Ee>=c.length)throw new Z("Bad BSON Document: illegal CString");let Ie=Y.toUTF8(c.subarray(S,Ee));for(S=Ee+1,Ee=S;c[Ee]!==0&&Ee<c.length;)Ee++;if(Ee>=c.length)throw new Z("Bad BSON Document: illegal CString");let Xe=Y.toUTF8(c.subarray(S,Ee));S=Ee+1,st=new lr(Ie,Xe)}else if(Ze===W){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(Ie<=0||Ie>c.length-S||c[S+Ie-1]!==0)throw new Z("bad string length in bson");let Xe=Ai(c,S,S+Ie-1,ft);st=xe?Xe:new Pr(Xe),S=S+Ie}else if(Ze===me){let Ie=c[S++]+c[S++]*256+c[S++]*65536+c[S++]*16777216,Xe=c[S++]+c[S++]*(1<<8)+c[S++]*(1<<16)+c[S++]*(1<<24);st=new cr({i:Ie,t:Xe})}else if(Ze===ye)st=new yr;else if(Ze===fe)st=new Ct;else if(Ze===Q){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(Ie<=0||Ie>c.length-S||c[S+Ie-1]!==0)throw new Z("bad string length in bson");let Xe=Ai(c,S,S+Ie-1,ft);st=new A(Xe),S=S+Ie}else if(Ze===Be){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(Ie<4+4+4+1)throw new Z("code_w_scope total size shorter minimum expected length");let Xe=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(Xe<=0||Xe>c.length-S||c[S+Xe-1]!==0)throw new Z("bad string length in bson");let kt=Ai(c,S,S+Xe-1,ft);S=S+Xe;let Zt=S,ji=c[S]|c[S+1]<<8|c[S+2]<<16|c[S+3]<<24,Li=Oi(c,Zt,B,!1);if(S=S+ji,Ie<4+4+ji+Xe)throw new Z("code_w_scope total size is too short, truncating scope");if(Ie>4+4+ji+Xe)throw new Z("code_w_scope total size is too long, clips outer document");st=new A(kt,Li)}else if(Ze===H){let Ie=c[S++]|c[S++]<<8|c[S++]<<16|c[S++]<<24;if(Ie<=0||Ie>c.length-S||c[S+Ie-1]!==0)throw new Z("bad string length in bson");if(ce!=null&&ce.utf8&&!Vn(c,S,S+Ie-1))throw new Z("Invalid UTF-8 string in BSON document");let Xe=Y.toUTF8(c.subarray(S,S+Ie-1));S=S+Ie;let kt=Y.allocate(12);kt.set(c.subarray(S,S+12),0);let Zt=new it(kt);S=S+12,st=new X(Xe,Zt)}else throw new Z(`Detected unknown BSON type ${Ze.toString(16)} for fieldname "${Nt}"`);Nt==="__proto__"?Object.defineProperty(zt,Nt,{value:st,writable:!0,enumerable:!0,configurable:!0}):zt[Nt]=st}if(St!==S-Kt)throw E?new Z("corrupt array bson"):new Z("corrupt object bson");if(!Xr)return zt;if(D(zt)){let Ze=Object.assign({},zt);return delete Ze.$ref,delete Ze.$id,delete Ze.$db,new X(zt.$ref,zt.$id,zt.$db,Ze)}return zt}function Ai(c,S,B,E){let J=Y.toUTF8(c.subarray(S,B));if(E){for(let oe=0;oe<J.length;oe++)if(J.charCodeAt(oe)===65533){if(!Vn(c,S,B))throw new Z("Invalid UTF-8 string in BSON document");break}}return J}var Ni=/\x00/,Hn=new Set(["$db","$ref","$id","$clusterTime"]);function rn(c,S,B,E){c[E++]=b;let J=Y.encodeUTF8Into(c,S,E);E=E+J+1,c[E-1]=0;let oe=Y.encodeUTF8Into(c,B,E+4);return c[E+3]=oe+1>>24&255,c[E+2]=oe+1>>16&255,c[E+1]=oe+1>>8&255,c[E]=oe+1&255,E=E+4+oe,c[E++]=0,E}var Yr=new DataView(new ArrayBuffer(8),0,8),uo=new Uint8Array(Yr.buffer,0,4),Ti=new Uint8Array(Yr.buffer,0,8);function nn(c,S,B,E){let oe=!Object.is(B,-0)&&Number.isSafeInteger(B)&&B<=r&&B>=i?re:y;oe===re?Yr.setInt32(0,B,!0):Yr.setFloat64(0,B,!0);let le=oe===re?uo:Ti;c[E++]=oe;let Oe=Y.encodeUTF8Into(c,S,E);return E=E+Oe,c[E++]=0,c.set(le,E),E+=le.byteLength,E}function sn(c,S,B,E){c[E++]=Fe;let J=Y.encodeUTF8Into(c,S,E);return E+=J,c[E++]=0,Yr.setBigInt64(0,B,!0),c.set(Ti,E),E+=Ti.byteLength,E}function ci(c,S,B,E){c[E++]=P;let J=Y.encodeUTF8Into(c,S,E);return E=E+J,c[E++]=0,E}function on(c,S,B,E){c[E++]=C;let J=Y.encodeUTF8Into(c,S,E);return E=E+J,c[E++]=0,c[E++]=B?1:0,E}function an(c,S,B,E){c[E++]=I;let J=Y.encodeUTF8Into(c,S,E);E=E+J,c[E++]=0;let oe=$.fromNumber(B.getTime()),le=oe.getLowBits(),Oe=oe.getHighBits();return c[E++]=le&255,c[E++]=le>>8&255,c[E++]=le>>16&255,c[E++]=le>>24&255,c[E++]=Oe&255,c[E++]=Oe>>8&255,c[E++]=Oe>>16&255,c[E++]=Oe>>24&255,E}function ln(c,S,B,E){c[E++]=U;let J=Y.encodeUTF8Into(c,S,E);if(E=E+J,c[E++]=0,B.source&&B.source.match(Ni)!=null)throw new Z("value "+B.source+" must not contain null bytes");return E=E+Y.encodeUTF8Into(c,B.source,E),c[E++]=0,B.ignoreCase&&(c[E++]=105),B.global&&(c[E++]=115),B.multiline&&(c[E++]=109),c[E++]=0,E}function cn(c,S,B,E){c[E++]=U;let J=Y.encodeUTF8Into(c,S,E);if(E=E+J,c[E++]=0,B.pattern.match(Ni)!=null)throw new Z("pattern "+B.pattern+" must not contain null bytes");E=E+Y.encodeUTF8Into(c,B.pattern,E),c[E++]=0;let oe=B.options.split("").sort().join("");return E=E+Y.encodeUTF8Into(c,oe,E),c[E++]=0,E}function At(c,S,B,E){B===null?c[E++]=P:B._bsontype==="MinKey"?c[E++]=ye:c[E++]=fe;let J=Y.encodeUTF8Into(c,S,E);return E=E+J,c[E++]=0,E}function fn(c,S,B,E){c[E++]=T;let J=Y.encodeUTF8Into(c,S,E);if(E=E+J,c[E++]=0,ve(B.id))c.set(B.id.subarray(0,12),E);else throw new Z("object ["+JSON.stringify(B)+"] is not a valid ObjectId");return E+12}function un(c,S,B,E){c[E++]=w;let J=Y.encodeUTF8Into(c,S,E);E=E+J,c[E++]=0;let oe=B.length;return c[E++]=oe&255,c[E++]=oe>>8&255,c[E++]=oe>>16&255,c[E++]=oe>>24&255,c[E++]=Ce,c.set(B,E),E=E+oe,E}function Ii(c,S,B,E,J,oe,le,Oe,V){if(V.has(B))throw new Z("Cannot convert circular structure to BSON");V.add(B),c[E++]=Array.isArray(B)?h:v;let xe=Y.encodeUTF8Into(c,S,E);E=E+xe,c[E++]=0;let he=ui(c,B,J,E,oe+1,le,Oe,V);return V.delete(B),he}function Fi(c,S,B,E){c[E++]=ee;let J=Y.encodeUTF8Into(c,S,E);return E=E+J,c[E++]=0,c.set(B.bytes.subarray(0,16),E),E+16}function dn(c,S,B,E){c[E++]=B._bsontype==="Long"?Fe:me;let J=Y.encodeUTF8Into(c,S,E);E=E+J,c[E++]=0;let oe=B.getLowBits(),le=B.getHighBits();return c[E++]=oe&255,c[E++]=oe>>8&255,c[E++]=oe>>16&255,c[E++]=oe>>24&255,c[E++]=le&255,c[E++]=le>>8&255,c[E++]=le>>16&255,c[E++]=le>>24&255,E}function fi(c,S,B,E){B=B.valueOf(),c[E++]=re;let J=Y.encodeUTF8Into(c,S,E);return E=E+J,c[E++]=0,c[E++]=B&255,c[E++]=B>>8&255,c[E++]=B>>16&255,c[E++]=B>>24&255,E}function Bi(c,S,B,E){c[E++]=y;let J=Y.encodeUTF8Into(c,S,E);return E=E+J,c[E++]=0,Yr.setFloat64(0,B.value,!0),c.set(Ti,E),E=E+8,E}function Ci(c,S,B,E){c[E++]=Q;let J=Y.encodeUTF8Into(c,S,E);E=E+J,c[E++]=0;let oe=B.toString(),le=Y.encodeUTF8Into(c,oe,E+4)+1;return c[E]=le&255,c[E+1]=le>>8&255,c[E+2]=le>>16&255,c[E+3]=le>>24&255,E=E+4+le-1,c[E++]=0,E}function pn(c,S,B,E,J=!1,oe=0,le=!1,Oe=!0,V){if(B.scope&&typeof B.scope=="object"){c[E++]=Be;let xe=Y.encodeUTF8Into(c,S,E);E=E+xe,c[E++]=0;let he=E,ce=B.code;E=E+4;let be=Y.encodeUTF8Into(c,ce,E+4)+1;c[E]=be&255,c[E+1]=be>>8&255,c[E+2]=be>>16&255,c[E+3]=be>>24&255,c[E+4+be-1]=0,E=E+be+4;let Pe=ui(c,B.scope,J,E,oe+1,le,Oe,V);E=Pe-1;let Se=Pe-he;c[he++]=Se&255,c[he++]=Se>>8&255,c[he++]=Se>>16&255,c[he++]=Se>>24&255,c[E++]=0}else{c[E++]=Q;let xe=Y.encodeUTF8Into(c,S,E);E=E+xe,c[E++]=0;let he=B.code.toString(),ce=Y.encodeUTF8Into(c,he,E+4)+1;c[E]=ce&255,c[E+1]=ce>>8&255,c[E+2]=ce>>16&255,c[E+3]=ce>>24&255,E=E+4+ce-1,c[E++]=0}return E}function hn(c,S,B,E){c[E++]=w;let J=Y.encodeUTF8Into(c,S,E);E=E+J,c[E++]=0;let oe=B.buffer,le=B.position;return B.sub_type===rt.SUBTYPE_BYTE_ARRAY&&(le=le+4),c[E++]=le&255,c[E++]=le>>8&255,c[E++]=le>>16&255,c[E++]=le>>24&255,c[E++]=B.sub_type,B.sub_type===rt.SUBTYPE_BYTE_ARRAY&&(le=le-4,c[E++]=le&255,c[E++]=le>>8&255,c[E++]=le>>16&255,c[E++]=le>>24&255),c.set(oe,E),E=E+B.position,E}function gn(c,S,B,E){c[E++]=W;let J=Y.encodeUTF8Into(c,S,E);E=E+J,c[E++]=0;let oe=Y.encodeUTF8Into(c,B.value,E+4)+1;return c[E]=oe&255,c[E+1]=oe>>8&255,c[E+2]=oe>>16&255,c[E+3]=oe>>24&255,E=E+4+oe-1,c[E++]=0,E}function yn(c,S,B,E,J,oe,le){c[E++]=v;let Oe=Y.encodeUTF8Into(c,S,E);E=E+Oe,c[E++]=0;let V=E,xe={$ref:B.collection||B.namespace,$id:B.oid};B.db!=null&&(xe.$db=B.db),xe=Object.assign(xe,B.fields);let he=ui(c,xe,!1,E,J+1,oe,!0,le),ce=he-V;return c[V++]=ce&255,c[V++]=ce>>8&255,c[V++]=ce>>16&255,c[V++]=ce>>24&255,he}function ui(c,S,B,E,J,oe,le,Oe){if(Oe==null){if(S==null)return c[0]=5,c[1]=0,c[2]=0,c[3]=0,c[4]=0,5;if(Array.isArray(S))throw new Z("serialize does not support an array as the root input");if(typeof S!="object")throw new Z("serialize does not support non-object as the root input");if("_bsontype"in S&&typeof S._bsontype=="string")throw new Z("BSON types cannot be serialized as a document");if(xt(S)||Ye(S)||ve(S)||Ve(S))throw new Z("date, regexp, typedarray, and arraybuffer cannot be BSON documents");Oe=new Set}Oe.add(S);let V=E+4;if(Array.isArray(S))for(let he=0;he<S.length;he++){let ce=`${he}`,be=S[he];if(typeof be?.toBSON=="function"&&(be=be.toBSON()),typeof be=="string")V=rn(c,ce,be,V);else if(typeof be=="number")V=nn(c,ce,be,V);else if(typeof be=="bigint")V=sn(c,ce,be,V);else if(typeof be=="boolean")V=on(c,ce,be,V);else if(be instanceof Date||xt(be))V=an(c,ce,be,V);else if(be===void 0)V=ci(c,ce,be,V);else if(be===null)V=ci(c,ce,be,V);else if(ve(be))V=un(c,ce,be,V);else if(be instanceof RegExp||Ye(be))V=ln(c,ce,be,V);else if(typeof be=="object"&&be._bsontype==null)V=Ii(c,ce,be,V,B,J,oe,le,Oe);else{if(typeof be=="object"&&be[Symbol.for("@@mdb.bson.version")]!==t)throw new ze;if(be._bsontype==="ObjectId")V=fn(c,ce,be,V);else if(be._bsontype==="Decimal128")V=Fi(c,ce,be,V);else if(be._bsontype==="Long"||be._bsontype==="Timestamp")V=dn(c,ce,be,V);else if(be._bsontype==="Double")V=Bi(c,ce,be,V);else if(typeof be=="function"&&oe)V=Ci(c,ce,be,V);else if(be._bsontype==="Code")V=pn(c,ce,be,V,B,J,oe,le,Oe);else if(be._bsontype==="Binary")V=hn(c,ce,be,V);else if(be._bsontype==="BSONSymbol")V=gn(c,ce,be,V);else if(be._bsontype==="DBRef")V=yn(c,ce,be,V,J,oe,Oe);else if(be._bsontype==="BSONRegExp")V=cn(c,ce,be,V);else if(be._bsontype==="Int32")V=fi(c,ce,be,V);else if(be._bsontype==="MinKey"||be._bsontype==="MaxKey")V=At(c,ce,be,V);else if(typeof be._bsontype<"u")throw new Z(`Unrecognized or invalid _bsontype: ${String(be._bsontype)}`)}}else if(S instanceof Map||We(S)){let he=S.entries(),ce=!1;for(;!ce;){let be=he.next();if(ce=!!be.done,ce)continue;let Pe=be.value[0],Se=be.value[1];typeof Se?.toBSON=="function"&&(Se=Se.toBSON());let Jt=typeof Se;if(typeof Pe=="string"&&!Hn.has(Pe)){if(Pe.match(Ni)!=null)throw new Z("key "+Pe+" must not contain null bytes");if(B){if(Pe[0]==="$")throw new Z("key "+Pe+" must not start with '$'");if(~Pe.indexOf("."))throw new Z("key "+Pe+" must not contain '.'")}}if(Jt==="string")V=rn(c,Pe,Se,V);else if(Jt==="number")V=nn(c,Pe,Se,V);else if(Jt==="bigint")V=sn(c,Pe,Se,V);else if(Jt==="boolean")V=on(c,Pe,Se,V);else if(Se instanceof Date||xt(Se))V=an(c,Pe,Se,V);else if(Se===null||Se===void 0&&le===!1)V=ci(c,Pe,Se,V);else if(ve(Se))V=un(c,Pe,Se,V);else if(Se instanceof RegExp||Ye(Se))V=ln(c,Pe,Se,V);else if(Jt==="object"&&Se._bsontype==null)V=Ii(c,Pe,Se,V,B,J,oe,le,Oe);else{if(typeof Se=="object"&&Se[Symbol.for("@@mdb.bson.version")]!==t)throw new ze;if(Se._bsontype==="ObjectId")V=fn(c,Pe,Se,V);else if(Jt==="object"&&Se._bsontype==="Decimal128")V=Fi(c,Pe,Se,V);else if(Se._bsontype==="Long"||Se._bsontype==="Timestamp")V=dn(c,Pe,Se,V);else if(Se._bsontype==="Double")V=Bi(c,Pe,Se,V);else if(Se._bsontype==="Code")V=pn(c,Pe,Se,V,B,J,oe,le,Oe);else if(typeof Se=="function"&&oe)V=Ci(c,Pe,Se,V);else if(Se._bsontype==="Binary")V=hn(c,Pe,Se,V);else if(Se._bsontype==="BSONSymbol")V=gn(c,Pe,Se,V);else if(Se._bsontype==="DBRef")V=yn(c,Pe,Se,V,J,oe,Oe);else if(Se._bsontype==="BSONRegExp")V=cn(c,Pe,Se,V);else if(Se._bsontype==="Int32")V=fi(c,Pe,Se,V);else if(Se._bsontype==="MinKey"||Se._bsontype==="MaxKey")V=At(c,Pe,Se,V);else if(typeof Se._bsontype<"u")throw new Z(`Unrecognized or invalid _bsontype: ${String(Se._bsontype)}`)}}}else{if(typeof S?.toBSON=="function"&&(S=S.toBSON(),S!=null&&typeof S!="object"))throw new Z("toBSON function did not return an object");for(let he of Object.keys(S)){let ce=S[he];typeof ce?.toBSON=="function"&&(ce=ce.toBSON());let be=typeof ce;if(typeof he=="string"&&!Hn.has(he)){if(he.match(Ni)!=null)throw new Z("key "+he+" must not contain null bytes");if(B){if(he[0]==="$")throw new Z("key "+he+" must not start with '$'");if(~he.indexOf("."))throw new Z("key "+he+" must not contain '.'")}}if(be==="string")V=rn(c,he,ce,V);else if(be==="number")V=nn(c,he,ce,V);else if(be==="bigint")V=sn(c,he,ce,V);else if(be==="boolean")V=on(c,he,ce,V);else if(ce instanceof Date||xt(ce))V=an(c,he,ce,V);else if(ce===void 0)le===!1&&(V=ci(c,he,ce,V));else if(ce===null)V=ci(c,he,ce,V);else if(ve(ce))V=un(c,he,ce,V);else if(ce instanceof RegExp||Ye(ce))V=ln(c,he,ce,V);else if(be==="object"&&ce._bsontype==null)V=Ii(c,he,ce,V,B,J,oe,le,Oe);else{if(typeof ce=="object"&&ce[Symbol.for("@@mdb.bson.version")]!==t)throw new ze;if(ce._bsontype==="ObjectId")V=fn(c,he,ce,V);else if(be==="object"&&ce._bsontype==="Decimal128")V=Fi(c,he,ce,V);else if(ce._bsontype==="Long"||ce._bsontype==="Timestamp")V=dn(c,he,ce,V);else if(ce._bsontype==="Double")V=Bi(c,he,ce,V);else if(ce._bsontype==="Code")V=pn(c,he,ce,V,B,J,oe,le,Oe);else if(typeof ce=="function"&&oe)V=Ci(c,he,ce,V);else if(ce._bsontype==="Binary")V=hn(c,he,ce,V);else if(ce._bsontype==="BSONSymbol")V=gn(c,he,ce,V);else if(ce._bsontype==="DBRef")V=yn(c,he,ce,V,J,oe,Oe);else if(ce._bsontype==="BSONRegExp")V=cn(c,he,ce,V);else if(ce._bsontype==="Int32")V=fi(c,he,ce,V);else if(ce._bsontype==="MinKey"||ce._bsontype==="MaxKey")V=At(c,he,ce,V);else if(typeof ce._bsontype<"u")throw new Z(`Unrecognized or invalid _bsontype: ${String(ce._bsontype)}`)}}}Oe.delete(S),c[V++]=0;let xe=V-E;return c[E++]=xe&255,c[E++]=xe>>8&255,c[E++]=xe>>16&255,c[E++]=xe>>24&255,V}function po(c){return c!=null&&typeof c=="object"&&"_bsontype"in c&&typeof c._bsontype=="string"}var ho={$oid:it,$binary:rt,$uuid:rt,$symbol:Pr,$numberInt:Mt,$numberDecimal:Qe,$numberDouble:Ft,$numberLong:$,$minKey:yr,$maxKey:Ct,$regex:lr,$regularExpression:lr,$timestamp:cr};function Wn(c,S={}){if(typeof c=="number"){let E=c<=r&&c>=i,J=c<=n&&c>=a;if(S.relaxed||S.legacy)return c;if(Number.isInteger(c)&&!Object.is(c,-0)){if(E)return new Mt(c);if(J)return S.useBigInt64?BigInt(c):$.fromNumber(c)}return new Ft(c)}if(c==null||typeof c!="object")return c;if(c.$undefined)return null;let B=Object.keys(c).filter(E=>E.startsWith("$")&&c[E]!=null);for(let E=0;E<B.length;E++){let J=ho[B[E]];if(J)return J.fromExtendedJSON(c,S)}if(c.$date!=null){let E=c.$date,J=new Date;if(S.legacy)if(typeof E=="number")J.setTime(E);else if(typeof E=="string")J.setTime(Date.parse(E));else if(typeof E=="bigint")J.setTime(Number(E));else throw new ht(`Unrecognized type for EJSON date: ${typeof E}`);else if(typeof E=="string")J.setTime(Date.parse(E));else if($.isLong(E))J.setTime(E.toNumber());else if(typeof E=="number"&&S.relaxed)J.setTime(E);else if(typeof E=="bigint")J.setTime(Number(E));else throw new ht(`Unrecognized type for EJSON date: ${typeof E}`);return J}if(c.$code!=null){let E=Object.assign({},c);return c.$scope&&(E.$scope=Wn(c.$scope)),A.fromExtendedJSON(c)}if(D(c)||c.$dbPointer){let E=c.$ref?c:c.$dbPointer;if(E instanceof X)return E;let J=Object.keys(E).filter(le=>le.startsWith("$")),oe=!0;if(J.forEach(le=>{["$ref","$id","$db"].indexOf(le)===-1&&(oe=!1)}),oe)return X.fromExtendedJSON(E)}return c}function go(c,S){return c.map((B,E)=>{S.seenObjects.push({propertyName:`index ${E}`,obj:null});try{return xr(B,S)}finally{S.seenObjects.pop()}})}function Gn(c){let S=c.toISOString();return c.getUTCMilliseconds()!==0?S:S.slice(0,-5)+"Z"}function xr(c,S){if(c instanceof Map||We(c)){let B=Object.create(null);for(let[E,J]of c){if(typeof E!="string")throw new Z("Can only serialize maps with string keys");B[E]=J}return xr(B,S)}if((typeof c=="object"||typeof c=="function")&&c!==null){let B=S.seenObjects.findIndex(E=>E.obj===c);if(B!==-1){let E=S.seenObjects.map(he=>he.propertyName),J=E.slice(0,B).map(he=>`${he} -> `).join(""),oe=E[B],le=" -> "+E.slice(B+1,E.length-1).map(he=>`${he} -> `).join(""),Oe=E[E.length-1],V=" ".repeat(J.length+oe.length/2),xe="-".repeat(le.length+(oe.length+Oe.length)/2-1);throw new Z(`Converting circular structure to EJSON:
    ${J}${oe}${le}${Oe}
    ${V}\\${xe}/`)}S.seenObjects[S.seenObjects.length-1].obj=c}if(Array.isArray(c))return go(c,S);if(c===void 0)return null;if(c instanceof Date||xt(c)){let B=c.getTime(),E=B>-1&&B<2534023188e5;return S.legacy?S.relaxed&&E?{$date:c.getTime()}:{$date:Gn(c)}:S.relaxed&&E?{$date:Gn(c)}:{$date:{$numberLong:c.getTime().toString()}}}if(typeof c=="number"&&(!S.relaxed||!isFinite(c))){if(Number.isInteger(c)&&!Object.is(c,-0)){if(c>=i&&c<=r)return{$numberInt:c.toString()};if(c>=a&&c<=n)return{$numberLong:c.toString()}}return{$numberDouble:Object.is(c,-0)?"-0.0":c.toString()}}if(typeof c=="bigint")return S.relaxed?Number(BigInt.asIntN(64,c)):{$numberLong:BigInt.asIntN(64,c).toString()};if(c instanceof RegExp||Ye(c)){let B=c.flags;if(B===void 0){let J=c.toString().match(/[gimuy]*$/);J&&(B=J[0])}return new lr(c.source,B).toExtendedJSON(S)}return c!=null&&typeof c=="object"?yo(c,S):c}var Yn={Binary:c=>new rt(c.value(),c.sub_type),Code:c=>new A(c.code,c.scope),DBRef:c=>new X(c.collection||c.namespace,c.oid,c.db,c.fields),Decimal128:c=>new Qe(c.bytes),Double:c=>new Ft(c.value),Int32:c=>new Mt(c.value),Long:c=>$.fromBits(c.low!=null?c.low:c.low_,c.low!=null?c.high:c.high_,c.low!=null?c.unsigned:c.unsigned_),MaxKey:()=>new Ct,MinKey:()=>new yr,ObjectId:c=>new it(c),BSONRegExp:c=>new lr(c.pattern,c.options),BSONSymbol:c=>new Pr(c.value),Timestamp:c=>cr.fromBits(c.low,c.high)};function yo(c,S){if(c==null||typeof c!="object")throw new Z("not an object instance");let B=c._bsontype;if(typeof B>"u"){let E={};for(let J of Object.keys(c)){S.seenObjects.push({propertyName:J,obj:null});try{let oe=xr(c[J],S);J==="__proto__"?Object.defineProperty(E,J,{value:oe,writable:!0,enumerable:!0,configurable:!0}):E[J]=oe}finally{S.seenObjects.pop()}}return E}else{if(c!=null&&typeof c=="object"&&typeof c._bsontype=="string"&&c[Symbol.for("@@mdb.bson.version")]!==t)throw new ze;if(po(c)){let E=c;if(typeof E.toExtendedJSON!="function"){let J=Yn[c._bsontype];if(!J)throw new Z("Unrecognized or invalid _bsontype: "+c._bsontype);E=J(E)}return B==="Code"&&E.scope?E=new A(E.code,xr(E.scope,S)):B==="DBRef"&&E.oid&&(E=new X(xr(E.collection,S),xr(E.oid,S),xr(E.db,S),xr(E.fields,S))),E.toExtendedJSON(S)}else throw new Z("_bsontype must be a string, but was: "+typeof B)}}function Xn(c,S){let B={useBigInt64:S?.useBigInt64??!1,relaxed:S?.relaxed??!0,legacy:S?.legacy??!1};return JSON.parse(c,(E,J)=>{if(E.indexOf("\0")!==-1)throw new Z(`BSON Document field names cannot contain null bytes, found: ${JSON.stringify(E)}`);return Wn(J,B)})}function Kn(c,S,B,E){B!=null&&typeof B=="object"&&(E=B,B=0),S!=null&&typeof S=="object"&&!Array.isArray(S)&&(E=S,S=void 0,B=0);let J=Object.assign({relaxed:!0,legacy:!1},E,{seenObjects:[{propertyName:"(root)",obj:null}]}),oe=xr(c,J);return JSON.stringify(oe,S,B)}function bo(c,S){return S=S||{},JSON.parse(Kn(c,S))}function Zn(c,S){return S=S||{},Xn(JSON.stringify(c),S)}var Nr=Object.create(null);Nr.parse=Xn,Nr.stringify=Kn,Nr.serialize=bo,Nr.deserialize=Zn,Object.freeze(Nr);var bn=1024*1024*17,vr=Y.allocate(bn);function Qn(c){vr.length<c&&(vr=Y.allocate(c))}function es(c,S={}){let B=typeof S.checkKeys=="boolean"?S.checkKeys:!1,E=typeof S.serializeFunctions=="boolean"?S.serializeFunctions:!1,J=typeof S.ignoreUndefined=="boolean"?S.ignoreUndefined:!0,oe=typeof S.minInternalBufferSize=="number"?S.minInternalBufferSize:bn;vr.length<oe&&(vr=Y.allocate(oe));let le=ui(vr,c,B,0,0,E,J,null),Oe=Y.allocate(le);return Oe.set(vr.subarray(0,le),0),Oe}function mn(c,S,B={}){let E=typeof B.checkKeys=="boolean"?B.checkKeys:!1,J=typeof B.serializeFunctions=="boolean"?B.serializeFunctions:!1,oe=typeof B.ignoreUndefined=="boolean"?B.ignoreUndefined:!0,le=typeof B.index=="number"?B.index:0,Oe=ui(vr,c,E,0,0,J,oe,null);return S.set(vr.subarray(0,Oe),le),le+Oe-1}function ts(c,S={}){return Jn(Y.toLocalBufferType(c),S)}function _n(c,S={}){S=S||{};let B=typeof S.serializeFunctions=="boolean"?S.serializeFunctions:!1,E=typeof S.ignoreUndefined=="boolean"?S.ignoreUndefined:!0;return tr(c,B,E)}function rs(c,S,B,E,J,oe){let le=Object.assign({allowObjectSmallerThanBufferSize:!0,index:0},oe),Oe=Y.toLocalBufferType(c),V=S;for(let xe=0;xe<B;xe++){let he=Oe[V]|Oe[V+1]<<8|Oe[V+2]<<16|Oe[V+3]<<24;le.index=V,E[J+xe]=Jn(Oe,le),V=V+he}return V}var mo=Object.freeze({__proto__:null,Code:A,BSONSymbol:Pr,DBRef:X,Binary:rt,ObjectId:it,UUID:O,Long:$,Timestamp:cr,Double:Ft,Int32:Mt,MinKey:yr,MaxKey:Ct,BSONRegExp:lr,Decimal128:Qe,setInternalBufferSize:Qn,serialize:es,serializeWithBufferAndIndex:mn,deserialize:ts,calculateObjectSize:_n,deserializeStream:rs,BSONValue:Et,BSONError:Z,BSONVersionError:ze,BSONRuntimeError:ht,BSONType:ot,EJSON:Nr});e.BSON=mo,e.BSONError=Z,e.BSONRegExp=lr,e.BSONRuntimeError=ht,e.BSONSymbol=Pr,e.BSONType=ot,e.BSONValue=Et,e.BSONVersionError=ze,e.Binary=rt,e.Code=A,e.DBRef=X,e.Decimal128=Qe,e.Double=Ft,e.EJSON=Nr,e.Int32=Mt,e.Long=$,e.MaxKey=Ct,e.MinKey=yr,e.ObjectId=it,e.Timestamp=cr,e.UUID=O,e.calculateObjectSize=_n,e.deserialize=ts,e.deserializeStream=rs,e.serialize=es,e.serializeWithBufferAndIndex=mn,e.setInternalBufferSize=Qn}}),Hc={};Mp(Hc,{AuthorizationStruct:()=>ef,ChatroomStruct:()=>sf,CoherenceMap:()=>Ea,CoherenceStruct:()=>xa,CommentStruct:()=>of,Data:()=>Vp,DataStruct:()=>rf,DateStruct:()=>cf,ECGStruct:()=>Aa,EDAStruct:()=>Yc,EEGCoordinates:()=>qp,EEGStruct:()=>ai,EMGStruct:()=>Zc,EventStruct:()=>nf,EyeTrackerStruct:()=>Gc,FNIRSStruct:()=>Oa,FrequencyBandsStruct:()=>Js,GroupStruct:()=>tf,HRVStruct:()=>Kc,IMUStruct:()=>Wc,NotificationStruct:()=>af,PPGStruct:()=>Xc,ProfileStruct:()=>Qc,ScheduleStruct:()=>lf,Struct:()=>Yt,eegCoordinates:()=>Si,setCoordinate:()=>Vs,structRegistry:()=>Jp});function Yt(e="struct",t={},r={_id:""},i={structType:"struct",_id:""}){function n(p=""){return`${p+Math.floor(Math.random()+Math.random()*Math.random()*1e16)}`}let a={_id:n(e+"defaultId"),structType:e,ownerId:r?._id,timestamp:Date.now(),parent:{structType:i?.structType,_id:i?._id}};return a.ownerId||delete a.ownerId,a?.parent?._id||delete a.parent,Object.keys(t).length>0&&Object.assign(a,t),a}var Si={FP1:[-21.2,66.9,12.1],FPZ:[1.4,65.1,11.3],FP2:[24.3,66.3,12.5],AF7:[-41.7,52.8,11.3],AF3:[-32.7,48.4,32.8],AFZ:[1.8,54.8,37.9],AF4:[35.1,50.1,31.1],AF8:[43.9,52.7,9.3],F5:[-51.4,26.7,24.7],F3:[-39.7,25.3,44.7],F1:[-22.1,26.8,54.9],FZ:[0,26.8,60.6],F2:[23.6,28.2,55.6],F4:[41.9,27.5,43.9],F6:[52.9,28.7,25.2],F7:[-52.1,28.6,3.8],F8:[53.2,28.4,3.1],FC5:[-59.1,3,26.1],FC3:[-45.5,2.4,51.3],FC1:[-24.7,.3,66.4],FCZ:[1,1,72.8],FC2:[26.1,3.2,66],FC4:[47.5,4.6,49.7],FC6:[60.5,4.9,25.5],FT9:[-53.8,-2.1,-29.1],FT7:[-59.2,3.4,-2.1],FT8:[60.2,4.7,-2.8],FT10:[55,-3.6,-31],T7:[-65.8,-17.8,-2.9],T5:[-61.5,-65.3,1.1],T3:[-70.2,-21.3,-10.7],T4:[71.9,-25.2,-8.2],T6:[59.3,-67.6,3.8],T8:[67.4,-18.5,-3.4],C5:[-63.6,-18.9,25.8],C3:[-49.1,-20.7,53.2],C1:[-25.1,-22.5,70.1],CZ:[.8,-21.9,77.4],C2:[26.7,-20.9,69.5],C4:[50.3,-18.8,53],C6:[65.2,-18,26.4],CP5:[-61.8,-46.2,22.5],CP3:[-46.9,-47.7,49.7],CP1:[-24,-49.1,66.1],CPZ:[.7,-47.9,72.6],CP2:[25.8,-47.1,66],CP4:[49.5,-45.5,50.7],CP6:[62.9,-44.6,24.4],TP9:[-73.6,-46.7,-4],TP7:[-63.6,-44.7,-4],TP8:[64.6,-45.4,-3.7],TP10:[74.6,-47.4,-3.7],P9:[-50.8,-51.3,-37.7],P7:[-55.9,-64.8,0],P5:[-52.7,-67.1,19.9],P3:[-41.4,-67.8,42.4],P1:[-21.6,-71.3,52.6],PZ:[.7,-69.3,56.9],P2:[24.4,-69.9,53.5],P4:[44.2,-65.8,42.7],P6:[54.4,-65.3,20.2],P8:[56.4,-64.4,.1],P10:[51,-53.9,-36.5],PO7:[-44,-81.7,1.6],PO3:[-33.3,-84.3,26.5],POZ:[0,-87.9,33.5],PO4:[35.2,-82.6,26.1],PO8:[43.3,-82,.7],O1:[-25.8,-93.3,7.7],OZ:[.3,-97.1,8.7],O2:[25,-95.2,6.2]};function Vs(e,t={}){if(!Si[e.tag]&&e.position&&(Si[e.tag]=[e.position.x,e.position.y,e.position.z]),Si[e.tag]){let r={channel:"",position:{x:Si[e.tag][0],y:Si[e.tag][1],z:Si[e.tag][2]}};return Object.assign(t,r)}else return Object.assign(t,e)}function qp(e=[],t=!0){let r=[];for(let i of e){let n=ai(i);r.push(n)}return t&&r.push(...Ea({channelDicts:e})),r}function Js(e=[],t={}){let r={scp:[],delta:[],theta:[],alpha1:[],alpha2:[],beta:[],lowgamma:[],highgamma:[]};return e.forEach(i=>r[i]=[]),Object.assign(t,r)}function ai(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n=Js(),a={tag:e,position:{x:0,y:0,z:0},count:0,times:[],raw:[],filtered:[],fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(n)),means:JSON.parse(JSON.stringify(n)),startTime:Date.now()},p=Yt("eeg",a,r,i);return e&&Vs(a,p),Object.assign(p,t)}function xa(e={0:ai("FP1"),1:ai("FP2")},t={},r={_id:""},i={structType:"struct",_id:""}){let n=Js(),a={tag:e[0]?.tag+"::"+e[1]?.tag,x0:e[0]?.position?.x,y0:e[0]?.position?.y,z0:e[0]?.position?.z,x1:e[1]?.position?.x,y1:e[1]?.position?.y,z1:e[1]?.position?.z,fftCount:0,fftTimes:[],ffts:[],slices:JSON.parse(JSON.stringify(n)),means:JSON.parse(JSON.stringify(n)),startTime:Date.now()},p=Yt("coherence",a,r,i);return Object.assign(p,t)}function Ea(e={channelDicts:[{ch:0,tag:"FP1",analyze:!1},{ch:1,tag:"FP2",analyze:!1}],taggedOnly:!0},t={},r={_id:""},i={structType:"struct",_id:""}){for(var n=[],a=1,p=0,d=0;d<e.channelDicts.length*(e.channelDicts.length+1)/2-e.channelDicts.length;d++){if(e.taggedOnly===!1||e.taggedOnly===!0&&e.channelDicts[p].tag!==null&&e.channelDicts[p+a].tag!==null&&e.channelDicts[p].tag!=="other"&&e.channelDicts[p+a].tag!=="other"&&e.channelDicts[p].analyze===!0&&e.channelDicts[p+a].analyze===!0){var y=ai(e.channelDicts[p].tag),b=ai(e.channelDicts[p+a].tag);n.push(xa({0:y,1:b},{},r,i))}a++,a+p===e.channelDicts.length&&(p++,a=1)}return n}function Oa(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,position:{x:0,y:0,z:0},count:0,times:[],red:[],ir:[],ir2:[],ambient:[],ratio:[],temp:[],beat_detect:{beats:[],breaths:[],rir:[],rir2:[],drir_dt:[],localmins:[],localmaxs:[],val_dists:[],peak_dists:[],localmins2:[],localmaxs2:[],val_dists2:[],peak_dists2:[]},startTime:Date.now()},a=Yt("fnirs",n,r,i);return e&&Vs(n,a),Object.assign(a,t)}function Wc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,Ax:[],Ay:[],Az:[],Gx:[],Gy:[],Gz:[],startTime:Date.now()},a=Yt("imu",n,r,i);return e&&Vs(n,a),Object.assign(a,t)}function Gc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,count:0,times:[],x:[],y:[],smax:[],smay:[],startTime:Date.now()},a=Yt("eyetracker",n,r,i);return Object.assign(a,t)}function Aa(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,count:0,times:[],raw:[],filtered:[],bpm:[],hrv:[],startTime:Date.now()},a=Yt("ecg",n,r,i);return Object.assign(a,t)}function Yc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){}function Xc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n=Oa(e,r,i,t);return n.structType="ppg",n}function Kc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n=Aa(e,r,i,t);return n.structType="hrv",n}function Zc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n=ai(e,r,i,t);return n.structType="emg",n}function Qc(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let a=Yt("profile",{tag:e,name:"",username:"",firstName:"",lastName:"",email:"",phone:"",sex:"",birthday:"",type:"",pictureUrl:"",userRoles:{},socials:{},data:{},hidden:!1,accessToken:"",refreshToken:""},r,i);return Object.assign(a,t)}function ef(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let a=Yt("authorization",{tag:e,authorizedId:"",authorizedName:"",authorizerId:"",authorizerName:"",authorizations:{},structs:{},excluded:{},groups:{},status:"PENDING",expires:!1,associatedAuthId:""},r,i);return Object.assign(a,t)}function tf(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let a=Yt("group",{tag:e,name:"",details:"",admins:{},peers:{},clients:{},users:{}},r,i);return Object.assign(a,t)}function Vp(e,t){return{type:e,data:t,timestamp:Date.now()}}function rf(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,title:"",author:"",expires:!1,type:"",data:new Array},a=Yt("data",n,r,i);return Object.assign(a,t)}function nf(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,event:"",author:"",startTime:"",endTime:"",grade:0,notes:"",attachments:new Array,users:{}},a=Yt("event",n,r,i);return Object.assign(a,t)}function sf(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,message:"",topic:"",author:"",attachments:new Array,comments:new Array,replies:new Array,users:{},audioChatActive:!1,videoChatActive:!1},a=Yt("chatroom",n,r,i);return Object.assign(a,t)}function of(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,author:"",replyTo:"",message:"",rating:0,replies:new Array,users:{},attachments:new Array},a=Yt("comment",n,r,i);return Object.assign(a,t)}function af(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let a=Yt("notification",{tag:e,note:"",parentUserId:""},r,i);return Object.assign(a,t)}function lf(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,title:"",author:"",attachments:new Array,dates:new Array},a=Yt("schedule",n,r,i);return Object.assign(a,t)}function cf(e="",t={},r={_id:""},i={structType:"struct",_id:""}){let n={tag:e,timeSet:"",notes:"",recurs:"NEVER",attachments:new Array},a=Yt("date",n,r,i);return Object.assign(a,t)}var Jp={Struct:Yt,EEGStruct:ai,FNIRSStruct:Oa,CoherenceStruct:xa,CoherenceMap:Ea,FrequencyBandsStruct:Js,IMUStruct:Wc,EyeTrackerStruct:Gc,ECGStruct:Aa,EDAStruct:Yc,PPGStruct:Xc,HRVStruct:Kc,EMGStruct:Zc,ProfileStruct:Qc,AuthorizationStruct:ef,GroupStruct:tf,DataStruct:rf,EventStruct:nf,ChatroomStruct:sf,CommentStruct:of,NotificationStruct:af,ScheduleStruct:lf,DateStruct:cf};var Hp=class{constructor(e){this.pushToState={},this.data={},this.triggers={},this.ctr=0,this.setState=t=>{Object.assign(this.data,t);let r=Object.getOwnPropertyNames(t);for(let i of r)this.triggerEvent(i,this.data[i]);if(this.triggers[zs]){let i=n=>{n(t)};this.triggers[zs].forEach(n=>{i(n.onchange)})}return this.data},this.setValue=(t,r)=>{this.data[t]=r,this.triggerEvent(t,r)},this.triggerEvent=(t,r)=>{if(this.triggers[t]){let i=n=>n.onchange(r,this.triggers[t]);this.triggers[t].forEach(i)}},this.subscribeState=t=>this.subscribeEvent(zs,t),this.unsubscribeState=t=>this.unsubscribeEvent(zs,t),this.subscribeEvent=(t,r,i,n)=>{if(t){i&&n&&!this.triggers[t]&&Object.defineProperty(this.data,t,{get:()=>i[n],set:p=>{i[n]=p},enumerable:!0,configurable:!0}),this.triggers[t]||(this.triggers[t]=[]);let a=this.ctr;return this.ctr++,this.triggers[t].push({sub:a,onchange:r}),a}else return},this.unsubscribeEvent=(t,r)=>{let i=this.triggers[t];if(i)if(r===void 0)delete this.triggers[t],delete this.data[t];else{let n,a=i.find((p,d)=>{if(p.sub===r)return n=d,!0});return a&&i.splice(n,1),Object.keys(i).length===0&&(delete this.triggers[t],delete this.data[t]),this.onRemoved&&this.onRemoved(a),!0}},this.subscribeEventOnce=(t,r)=>{let i,n=a=>{r(a),this.unsubscribeEvent(t,i)};return i=this.subscribeEvent(t,n),i},this.getEvent=(t,r)=>{for(let i in this.triggers[t])if(this.triggers[t][i].sub===r)return this.triggers[t][i]},this.getSnapshot=()=>{let t={};for(let r in this.data)t[r]=this.data[r]},typeof e=="object"&&(this.data=e)}},zs="*s",dg=new Hp;var pg=zp($p());var ba=Hc.ProfileStruct();for(let e in ba)e==="username"||e==="lastName"||e==="firstName"||e==="name"||e==="_id"||e==="pictureUrl"?ba[e]=1:delete ba[e];var tt={collision:{setupEntities:function(e){for(let t in e){let r=e[t];r.components&&!r.components[this.__node.tag]||this.setupEntity(r)}return e},setupEntity:function(e){return"collisionEnabled"in e||(e.collisionEnabled=!0),e.collisionType||(e.collisionType="sphere"),e.collisionRadius||(e.collisionRadius=1),e.collisionBoundsScale||(e.collisionBoundsScale={x:1,y:1,z:1}),e.colliding||(e.colliding={}),e.position||(e.position={x:0,y:0,z:0}),e},__node:{tag:"collision"},__operator:function(e){let t=this.entityKeys;for(let r=0;r<t.length;r++){let i=e[t[r]];if(!(i.components&&(!i.components[this.__node.tag]||!i.collisionEnabled))&&i.collisionEnabled)for(let n=0;n<t.length;n++){if(r===n)continue;let a=e[t[n]];if(a.components&&!a.components[this.__node.tag]||!a.collisionEnabled)continue;let p=tt.collision.collisionCheck(i,a);p!==!1&&(i.colliding||(i.colliding={}),a.colliding||(a.colliding={}),i.colliding[a.__node.tag]=p,a.colliding[i.__node.tag]=p)}}return e},collisionCheck:(e,t)=>{if(e.collisionEnabled===!1||t.collisionEnabled===!1)return!1;let r=tt.collision.distance(e.position,t.position);if(r<Math.max(...Object.values(e.collisionBoundsScale))*e.collisionRadius+Math.max(...Object.values(t.collisionBoundsScale))*t.collisionRadius){let i=!1;if(e.collisionType==="sphere"?t.collisionType==="sphere"?i=tt.collision.sphereCollisionCheck(e,t,r):t.collisionType==="box"?i=tt.collision.sphereBoxCollisionCheck(e,t,r):t.collisionType==="point"&&(i=tt.collision.isPointInsideSphere(t.position,e,r)):e.collisionType==="box"?t.collisionType==="sphere"?i=tt.collision.sphereBoxCollisionCheck(t,e,r):t.collisionType==="box"?i=tt.collision.boxCollisionCheck(e,t):t.collisionType==="point"&&(i=tt.collision.isPointInsideBox(e.position,e)):e.collisionType==="point"&&(t.collisionType==="sphere"?i=tt.collision.isPointInsideSphere(e.position,t,r):t.collisionType==="box"&&(i=tt.collision.isPointInsideBox(e.position,t))),i)return r}return!1},sphereCollisionCheck:(e,t,r)=>(r===void 0&&(r=tt.collision.distance(e.position,t.position)),r<e.collisionRadius+t.collisionRadius),boxCollisionCheck:(e,t)=>{let r=(e.position.x-e.collisionRadius)*e.collisionBoundsScale.x,i=(e.position.x+e.collisionRadius)*e.collisionBoundsScale.x,n=(e.position.y-e.collisionRadius)*e.collisionBoundsScale.y,a=(e.position.y+e.collisionRadius)*e.collisionBoundsScale.y,p=(e.position.z-e.collisionRadius)*e.collisionBoundsScale.z,d=(e.position.z+e.collisionRadius)*e.collisionBoundsScale.z,y=(t.position.x-t.collisionRadius)*e.collisionBoundsScale.x,b=(t.position.x+t.collisionRadius)*e.collisionBoundsScale.x,v=(t.position.y-t.collisionRadius)*e.collisionBoundsScale.y,h=(t.position.y+t.collisionRadius)*e.collisionBoundsScale.y,w=(t.position.z-t.collisionRadius)*e.collisionBoundsScale.z,_=(t.position.z+t.collisionRadius)*e.collisionBoundsScale.z;return(i<=b&&i>=y||r<=b&&r>=y)&&(a<=h&&a>=v||n<=h&&n>=v)&&(d<=_&&d>=w||p<=_&&p>=w)},sphereBoxCollisionCheck:(e,t,r)=>{let i=(t.position.x-t.collisionRadius)*t.collisionBoundsScale.x,n=(t.position.x+t.collisionRadius)*t.collisionBoundsScale.x,a=(t.position.y-t.collisionRadius)*t.collisionBoundsScale.y,p=(t.position.y+t.collisionRadius)*t.collisionBoundsScale.y,d=(t.position.z-t.collisionRadius)*t.collisionBoundsScale.z,y=(t.position.z+t.collisionRadius)*t.collisionBoundsScale.z,b={x:Math.max(i,Math.min(e.position.x,n)),y:Math.max(a,Math.min(e.position.y,p)),z:Math.max(d,Math.min(e.position.z,y))};return r===void 0&&(r=tt.collision.distance(e.position,b)),r>e.collisionRadius},isPointInsideSphere:(e,t,r)=>(r===void 0&&(r=tt.collision.distance(e,t.position)),r<t.collisionRadius),isPointInsideBox:(e,t)=>{let r=(t.position.x-t.collisionRadius)*t.collisionBoundsScale.x,i=(t.position.x+t.collisionRadius)*t.collisionBoundsScale.x,n=(t.position.y-t.collisionRadius)*t.collisionBoundsScale.x,a=(t.position.y+t.collisionRadius)*t.collisionBoundsScale.x,p=(t.position.z-t.collisionRadius)*t.collisionBoundsScale.x,d=(t.position.z+t.collisionRadius)*t.collisionBoundsScale.x;return e.x>=r&&e.x<=i&&e.y>=n&&e.y<=a&&e.z>=p&&e.z<=d},closestPointOnLine:(e,t,r)=>{let i={x:r.x-t.x,y:r.y-t.y,z:r.z-t.z},n={x:t.x-e.x,y:t.y-e.y,z:t.z-e.z},a={x:r.x-e.x,y:r.y-e.y,z:r.z-e.z},p=tt.collision.dot(n,i);if(p<=0)return t;let d=tt.collision.dot(a,i);if(d<=0)return r;let y=1/(p+d);return{x:t.x+(r.x-t.x)*p*y,y:t.y+(r.y-t.y)*p*y,z:t.z+(r.z-t.z)*p*y}},closestPointOnPolygon:(e,t,r,i)=>{let n=tt.collision.calcNormal(t,r,i),a=tt.collision.dot(e,n)-tt.collision.dot(t,n),p=tt.collision.vecadd(e,tt.collision.vecscale(n,-a)),d=i[0]-t[0],y=i[1]-t[1],b=i[2]-t[2],v=r[0]-t[0],h=r[1]-t[1],w=r[2]-t[2],_=p[0]-t[0],T=p[1]-t[1],C=p[2]-t[2],I=d*d+y*y+b*b,P=d*v+y*h+b*w,U=d*_+y*T+b*C,H=v*v+h*h+w*w,Q=v*_+h*T+w*C,W=I*H-P*P;if(Math.abs(W)<1e-30)return;let Be=1/W,re=(H*U-P*Q)*Be,me=(I*Q-P*U)*Be;if(re>=0&&me>=0&&re+me<1)return p},calcNormal:(e,t,r,i=!0)=>{var n=tt.collision.makeVec(e,t),a=tt.collision.makeVec(e,r);return i===!0?tt.collision.normalize(tt.collision.cross3D(n,a)):tt.collision.normalize(tt.collision.cross3D(a,n))},dot:(e,t)=>{let r=0;for(let i in e)r+=e[i]*t[i];return r},makeVec(e,t){return{x:t.x-e.x,y:t.y-e.y,z:t.z-e.z}},vecadd:(e,t)=>{let r=Object.assign({},e);for(let i in r)r[i]+=t[i];return r},vecsub:(e,t)=>{let r=Object.assign({},e);for(let i in r)r[i]-=t[i];return r},vecmul:(e,t)=>{let r=Object.assign({},e);for(let i in r)r[i]*=t[i];return r},vecdiv:(e,t)=>{let r=Object.assign({},e);for(let i in r)r[i]/=t[i];return r},vecscale:(e,t)=>{let r=Object.assign({},e);for(let i in r)r[i]*=t;return r},distance:(e,t)=>{let r=0;for(let i in e)r+=Math.pow(e[i]-t[i],2);return Math.sqrt(r)},magnitude:e=>{let t=0;for(let r in e)t+=e[r]*e[r];return Math.sqrt(t)},normalize:e=>{let t=tt.collision.magnitude(e),r=t?1/t:0,i={};for(let n in e)i[n]=e[n]*r;return i},distance3D(e,t){return Math.sqrt((e.x-t.x)*(e.x-t.x)+(e.y-t.y)*(e.y-t.y)+(e.z-t.z)*(e.z-t.z))},cross3D(e,t){return{x:e.y*t.z-e.z*t.y,y:e.z*t.x-e.x*t.z,z:e.x*t.y-e.y*t.x}},nearestNeighborSearch(e,t=1e15){var r={};for(let p in e){let d={tag:p,position:void 0,neighbors:[]};d.position=e[p].position,r[p]=d}for(let p in r){for(let d in r){var i=tt.collision.distance3D(r[p].position,r[d].position);if(i<t){var n={tag:d,position:e[d].position,dist:i};r[p].neighbors.push(n);var a={tag:d,position:e[p].position,dist:i};r[d].neighbors.push(a)}}r[p].neighbors.sort(function(d,y){return d.dist-y.dist})}return r},generateBoundingVolumeTree(e,t="octree",r=1e15,i=3){let n={proto:{parent:void 0,children:{},entities:{},collisionType:"box",collisionRadius:1,collisionBoundsScale:{x:1,y:1,z:1},position:{x:0,y:0,z:0}},tree:{}},a,p,d,y=0,b=0,v=0,h={},w=r;for(let I in e){let P=e[I],U=P.position.x+P.collisionRadius*P.collisionBoundsScale.x,H=P.position.y+P.collisionRadius*P.collisionBoundsScale.y,Q=P.position.z+P.collisionRadius*P.collisionBoundsScale.z;a<U&&(a=U),y>U&&(y=U),p<H&&(p=H),b>H&&(b=H),d<Q&&(d=Q),v>Q&&(v=Q),w>P.collisionRadius&&(w=P.collisionRadius),h[I]=P.position}let _=JSON.parse(JSON.stringify(n.proto)),T={x:(a+y)*.5,y:(p+b)*.5,z:(d+v)*.5},C={x:a-T.x,y:p-T.y,z:d-T.z};if(_.position=T,_.collisionBoundsScale=C,_.entities=e,n.tree=_,w*=2,t==="octree"){let I=function(U,H){let Q={x:U.x+H.x,y:U.y+H.y,z:U.z+H.z},W={x:U.x-H.x,y:U.y+H.y,z:U.z+H.z},Be={x:U.x+H.x,y:U.y-H.y,z:U.z+H.z},re={x:U.x+H.x,y:U.y+H.y,z:U.z-H.z},me={x:U.x-H.x,y:U.y-H.y,z:U.z+H.z},Fe={x:U.x-H.x,y:U.y+H.y,z:U.z-H.z},ee={x:U.x+H.x,y:U.y-H.y,z:U.z-H.z},ye={x:U.x-H.x,y:U.y-H.y,z:U.z-H.z};return[Q,W,Be,re,me,Fe,ee,ye]},P=function(U){let H={x:U.collisionBoundsScale.x*.5,y:U.collisionBoundsScale.y*.5,z:U.collisionBoundsScale.z*.5},Q=I(U.position,H),W=Object.assign({},U.bodies);for(let Be=0;Be<8;Be++){let re=Object.assign(JSON.parse(JSON.stringify(n.proto)),{position:Q[Be],collisionBoundsScale:H});re.parent=U;for(let me in W)tt.collision.collisionCheck(W[me],re)&&(re.entities[me]=W[me],delete W[me]);Object.keys(re.entities).length>i-1&&(U.children[Be]=re,re.parent=U,Object.keys(re.entities).length>i&&re.collisionRadius*.5>w&&P(re))}};return P(_),_}else{let I=tt.collision.nearestNeighborSearch(h,r),P=Object.keys(I),U=P[Math.floor(Math.random()*P.length)],H=!0,Q=0,W=(re,me)=>{let Fe={},ee={},ye=Object.keys(re);for(;H&&Q<ye.length;){let fe=re[U],Ce=0,Re=0,ot=h[fe.tag].x-me[fe.tag].collisionBoundsScale.x,Z=h[fe.tag].y-me[fe.tag].collisionBoundsScale.y,ze=h[fe.tag].z-me[fe.tag].collisionBoundsScale.z,ht=h[fe.tag].x+me[fe.tag].collisionBoundsScale.x,te=h[fe.tag].y+me[fe.tag].collisionBoundsScale.y,K=h[fe.tag].z+me[fe.tag].collisionBoundsScale.z,ne=JSON.parse(JSON.stringify(n.proto));ne.tag=`bound${Math.floor(Math.random()*1e15)}`,ne.children[fe.tag]=me[fe.tag],ne.bodies[fe.tag]=e[fe.tag],me[fe.tag].parent=ne,ee[fe.tag]=!0,Ce++,Re++;let Te=Object.keys(fe.neighbors);for(;Ce<Te.length&&Re<3;){if(ee[fe.neighbors[Ce].tag]){Ce++;continue}let Me=h[fe.neighbors[Ce].tag].x-me[fe.neighbors[Ce].tag].collisionBoundsScale.x,Ge=h[fe.neighbors[Ce].tag].y-me[fe.neighbors[Ce].tag].collisionBoundsScale.y,gt=h[fe.neighbors[Ce].tag].z-me[fe.neighbors[Ce].tag].collisionBoundsScale.z,Y=h[fe.neighbors[Ce].tag].x+me[fe.neighbors[Ce].tag].collisionBoundsScale.x,Tt=h[fe.neighbors[Ce].tag].y+me[fe.neighbors[Ce].tag].collisionBoundsScale.y,R=h[fe.neighbors[Ce].tag].z+me[fe.neighbors[Ce].tag].collisionBoundsScale.z;ot>Me&&(ot=Me),ht<Y&&(ht=Y),Z>Ge&&(Z=Ge),te<Tt&&(te=Tt),ze>gt&&(ze=gt),K<R&&(K=R),ne.children[fe.neighbors[Ce].tag]=me[fe.neighbors[Ce].tag],ne.entities[fe.neighbors[Ce].tag]=e[fe.neighbors[Ce].tag],me[fe.neighbors[Ce].tag].parent=ne,ee[fe.neighbors[Ce].tag]=!0,Ce++,Re++}let He={x:(ht+ot)*.5,y:(te+Z)*.5,z:(K+ze)*.5},qe={x:ht-He.x,y:te-He.y,z:K-He.z};for(ne.position=He,ne.collisionBoundsScale=qe,ne.bodies.length===1&&(ne=fe),Fe[ne.tag]=ne;Ce<fe.neighbors.length&&ee[fe.neighbors[Ce].tag];)Ce++;Ce<fe.neighbors.length?U=fe.neighbors[Ce].tag:Object.keys(ee).length<Object.keys(re).length?U=P[0]:H=!1,Q++}return Fe},Be=W(I,e);for(;Object.keys(Be).length>2;){let re=tt.collision.nearestNeighborSearch(Be,r);Be=W(re,Be)}return _.children=Be,_.children.forEach(re=>{re.parent=_}),_}}},collider:{lastTime:performance.now(),setupEntities:function(e){for(let t in e){let r=e[t];r.components&&!r.components[this.__node.tag]||this.setupEntity(r)}return e},setupEntity:function(e){return"collisionEnabled"in e||tt.collision.setupEntity(e),"boundingBox"in e||(e.boundingBox={bot:0,top:100,left:0,right:100,front:0,back:100}),"position"in e||tt.movement.setupEntity(e),"restitution"in e||(e.restitution=1),"useBoundingBox"in e||(e.useBoundingBox=!0),!e.position.x&&!e.position.y&&!e.position.z&&(e.position.x=Math.random()*e.boundingBox.right,e.position.y=Math.random()*e.boundingBox.back,e.position.z=Math.random()*e.boundingBox.top),e},__operator:function(e){let t=this.entityKeys;for(let r=0;r<t.length;r++){let i=e[t[r]];if(!(i.components&&(!i.components[this.__node.tag]||!i.collisionEnabled))&&(i.useBoundingBox&&this.checkBoundingBox(i),!!i.collisionEnabled&&i.colliding)){for(let n in i.colliding){let a=e[n];if(i.colliding[n]===!1){delete i.colliding[n],delete a.colliding[i.__node.tag];continue}a.collisionEnabled&&(a.collisionType==="box"?this.resolveBoxCollision(i,a,i.colliding[n]):i.collisionType==="box"?(i.fixed=!0,this.resolveSphereCollisions(i,a,i.colliding[n]),i.fixed=!1):(this.resolveSphereCollisions(i,a,i.colliding[n]),delete a.colliding[i.__node.tag]),delete i.colliding[a.__node.tag])}delete i.colliding}}return e},__node:{tag:"collider"},checkBoundingBox:e=>{let t=e.collisionRadius*e.collisionBoundsScale.x,r=e.collisionRadius*e.collisionBoundsScale.y,i=e.collisionRadius*e.collisionBoundsScale.z;e.position.y-r<=e.boundingBox.front&&(e.velocity.y*=-e.restitution,e.position.y=e.boundingBox.front+r),e.position.y+r>=e.boundingBox.back&&(e.velocity.y*=-e.restitution,e.position.y=e.boundingBox.back-r),e.position.x-t<=e.boundingBox.left&&(e.velocity.x*=-e.restitution,e.position.x=e.boundingBox.left+t),e.position.x+t>=e.boundingBox.right&&(e.velocity.x*=-e.restitution,e.position.x=e.boundingBox.right-t),e.position.z-i<=e.boundingBox.bot&&(e.velocity.z*=-e.restitution,e.position.z=e.boundingBox.bot+i),e.position.z+i>=e.boundingBox.top&&(e.velocity.z*=-e.restitution,e.position.z=e.boundingBox.top-i)},resolveBoxCollision:(e,t,r)=>{let i=tt.collision.makeVec(e.position,t.position);var n=Object.values(i);let a,p=1/0,d=-1;n[y]<0&&(d=1),r&&(d=-d);for(let w in e.position){let _=Math.abs(t.position[w]-e.position[w]);_<p&&Math.abs(t.position[w]-e.position[w]+e.velocity[w]*1e-17)<_&&(a=w,p=_)}var y=n.indexOf(a);y===0&&(y="x"),y===1&&(y="y"),y===2&&(y="z"),y===3&&(y="w");let b=t.position[y]+t.collisionRadius*t.collisionBoundsScale[y]*d;if(r){let w=b-e.collisionRadius*e.collisionBoundsScale[y]*d;e.position[y]=w}else{let w=b+e.collisionRadius*e.collisionBoundsScale[y]*d;e.position[y]=w}e.velocity[y]=-e.velocity[y]*e.restitution,r&&(e.force[y]=-e.velocity[y]);var v=tt.collision.magnitude(t.acceleration),h=tt.collision.normalize(t.acceleration);e.force[y]=-h[y]*v*t.mass,r&&(e.force[y]=-e.force[y])},resolveSphereCollisions:(e,t,r)=>{r===void 0&&(r=tt.collision.distance(e.position,t.position));let i=tt.collision.normalize(tt.collision.makeVec(e.position,t.position)),n=e.mass+t.mass,a=e.mass/n,p=1-a;e.fixed===!1?(e.position.x+=i.x*p*1.01,e.position.y+=i.y*p*1.01,e.position.z+=i.z*p*1.001):(t.position.x-=i.x*1.01,t.position.y-=i.y*1.01,t.position.z-=i.z*1.01),t.fixed===!1?(t.position.x+=i.x*a*1.01,t.position.y+=i.y*a*1.01,t.position.z+=i.z*a*1.01):(e.position.x+=i.x*1.01,e.position.y+=i.y*1.01,e.position.z+=i.z*1.01),r=tt.collision.distance(e.position,t.position);let d={x:e.velocity.x-t.velocity.x,y:e.velocity.y-t.velocity.y,z:e.velocity.z-t.velocity.z},y=d.x*i.x+d.y*i.y+d.z*i.z;if(y>0){let b=2*y/n;e.fixed===!1&&(e.velocity.x-=b*i.x*t.mass*e.restitution,e.velocity.y-=b*i.y*t.mass*e.restitution,e.velocity.z-=b*i.z*t.mass*e.restitution),t.fixed===!1&&(t.velocity.x+=b*i.x*t.mass*t.restitution/t.mass,t.velocity.y+=b*i.y*t.mass*t.restitution/t.mass,t.velocity.z+=b*i.z*t.mass*t.restitution/t.mass)}}},nbody:{lastTime:performance.now(),G:6674e-14,setupEntities:function(e){for(let t in e){let r=e[t];r.components&&!r.components[this.__node.tag]||this.setupEntity(r)}return e},setupEntity:function(e){return"collisionEnabled"in e||tt.collider.setupEntity(e),e.isAttractor=!0,"attractorGroup"in e||(e.attractorGroup=0),"attractorFrameSearchMax"in e||(e.attractorFrameSearchMax=10),"attractorGroupRules"in e||(e.attractorGroupRules={0:{G:this.G,maxDist:void 0}}),e},__operator:function(e){let t=this.entityKeys;for(let r=0;r<t.length;r++){let i=e[t[r]];if(i.components&&!i.components[this.__node.tag]||!i.mass)continue;let n=0;e:for(let a=0;a<t.length;a++){let p=t[Math.floor(Math.random()*t.length)];n++;let d=e[p];if(d.components&&!d.components[this.__node.tag]||!d.mass||!d.isAttractor)continue e;if(this.attract(i,d,void 0,this.G),n>i.attractorFrameSearchMax)break e}}return e},__node:{tag:"nbody"},attract:function(e,t,r,i=this.G,n){r===void 0&&(r=tt.collision.distance3D(e.position,t.position)),n===void 0&&(n=tt.collision.normalize(tt.collision.makeVec(e.position,t.position)));let a=0;r<.01&&(r=.01),e.attractorGroupRules[t.attractorGroup]?typeof e.attractorGroupRules[t.attractorGroup]=="object"?e.attractorGroupRules[t.attractorGroup].maxDist&&e.attractorGroupRules[t.attractorGroup].maxDist<r||(a=e.attractorGroupRules[t.attractorGroup].G*e.mass*t.mass/(r*r)):a=e.attractorGroupRules[t.attractorGroup]*e.mass*t.mass/(r*r):a=i*e.mass*t.mass/(r*r),e.force.x+=n.x*a,e.force.y+=n.y*a,e.force.z+=n.z*a,t.force.x-=n.x*a,t.force.y-=n.y*a,t.force.z-=n.z*a}},boid:{lastTime:performance.now(),defaultAnchor:{x:Math.random(),y:Math.random(),z:Math.random(),mul:.006},setupEntities:function(e){for(let t in e){let r=e[t];this.setupEntity(r)}return e},setupEntity:function(e){e.position||tt.collider.setupEntity(e);let t=Object.assign({},this.defaultAnchor);t.x*=e.boundingBox.right,t.y*=e.boundingBox.back,t.z*=e.boundingBox.top;let r={cohesion:1e-5,separation:1e-4,alignment:.006,swirl:t,attractor:Object.assign(t,{mul:.002}),useCohesion:!0,useSeparation:!0,useAlignment:!0,useSwirl:!0,useAttractor:!0,useAttraction:!1,groupRadius:200,groupSize:5,searchLimit:5};return e.boid?e.boid=Object.assign(r,e.boid):e.boid=r,this.entityKeys.length>1e3&&(e.boid.groupSize=1,e.boid.searchLimit=1),e},__operator:function(e){let t=performance.now(),r=t-this.lastTime;this.lastTime=t;let i=this.entityKeys,n=i.length,a=1/r,p=-1;e:for(let d=0;d<i.length;d++){p++;let y=e[i[d]],b=[],v=[],h=[y.position.x,y.position.y,y.position.z,0,0,0,y.velocity.x,y.velocity.y,y.velocity.z,0,0,0,0,0,0,0,0,0],w=1,_=-1;t:for(let P=0;P<i.length;P++){if(_++,v.length>y.boid.groupSize||_>y.boid.searchLimit)break t;let U=i[Math.floor(Math.random()*n)];if(_===p||U===i[d]||b.indexOf(U)>-1)continue t;{let H=e[U],Q=Math.sqrt((y.position.x-H.position.x)*(y.position.x-H.position.x)+(y.position.y-H.position.y)*(y.position.y-H.position.y)+(y.position.z-H.position.z)*(y.position.z-H.position.z));if(Q>y.boid.groupRadius)continue t;{v.push(Q),b.push(U);let W;if((y.boid.useSeparation||y.boid.useAlignment)&&(W=y.boid.groupRadius/(Q*Q),W>y.maxSpeed?W=y.maxSpeed:W<-y.maxSpeed&&(W=-y.maxSpeed)),y.boid.useCohesion&&(h[0]+=(H.position.x-y.position.x)*.5*Q*a,h[1]+=(H.position.y-y.position.y)*.5*Q*a,h[2]+=(H.position.z-y.position.z)*.5*Q*a),isNaN(Q)||isNaN(h[0])||isNaN(H.position.x)){console.log(Q,d,U,y.position,H.position,h),y.position.x=NaN;return}y.boid.useSeparation&&(h[3]=h[3]+(y.position.x-H.position.x)*W,h[4]=h[4]+(y.position.y-H.position.y)*W,h[5]=h[5]+(y.position.z-H.position.z)*W),y.boid.useAttraction&&H.boid.useAttraction&&tt.nbody.attract(y,H,Q),y.boid.useAlignment&&(h[6]=h[6]+H.velocity.x*W,h[7]=h[7]+H.velocity.y*W,h[8]=h[8]+H.velocity.z*W),w++}}}let T=1/w;y.boid.useCohesion?(h[0]=y.boid.cohesion*(h[0]*T),h[1]=y.boid.cohesion*(h[1]*T),h[2]=y.boid.cohesion*(h[2]*T)):(h[0]=0,h[1]=0,h[2]=0),y.boid.useSeparation?(h[3]=y.boid.separation*h[3],h[4]=y.boid.separation*h[4],h[5]=y.boid.separation*h[5]):(h[3]=0,h[4]=0,h[5]=0),y.boid.useAlignment?(h[6]=-(y.boid.alignment*h[6]*T),h[7]=y.boid.alignment*h[7]*T,h[8]=y.boid.alignment*h[8]*T):(h[6]=0,h[7]=0,h[8]=0);let C=[0,0,0];y.boid.useSwirl==!0&&(h[9]=-(y.position.y-y.boid.swirl.y)*y.boid.swirl.mul,h[10]=(y.position.z-y.boid.swirl.z)*y.boid.swirl.mul,h[11]=(y.position.x-y.boid.swirl.x)*y.boid.swirl.mul);let I=[0,0,0];y.boid.useAttractor==!0&&(h[12]=(y.boid.attractor.x-y.position.x)*y.boid.attractor.mul,(y.position.x>y.boundingBox.left||y.position.x<y.boundingBox.right)&&(h[12]*=3),h[13]=(y.boid.attractor.y-y.position.y)*y.boid.attractor.mul,(y.position.y>y.boundingBox.top||y.position.y<y.boundingBox.bottom)&&(h[13]*=3),h[14]=(y.boid.attractor.z-y.position.z)*y.boid.attractor.mul,(y.position.z>y.boundingBox.front||y.position.z<y.boundingBox.back)&&(h[14]*=3)),y.velocity.x=y.velocity.x+h[0]+h[3]+h[6]+h[9]+h[12]+h[15],y.velocity.y=y.velocity.y+h[1]+h[4]+h[7]+h[10]+h[13]+h[16],y.velocity.z=y.velocity.z+h[2]+h[5]+h[8]+h[11]+h[14]+h[17],isNaN(y.velocity.x)&&console.error(y,d,w,y.position,y.velocity,C,I)}return e},__node:{tag:"boid"}},movement:{__node:{tag:"movement"},lastTime:performance.now(),setupEntities:function(e){for(let t in e){let r=e[t];r.components&&!r.components[this.__node.tag]||this.setupEntity(r)}},setupEntity:function(e){return"mass"in e||(e.mass=1),"fixed"in e||(e.fixed=!1),e.force||(e.force={x:0,y:0,z:0}),"mass"in e||(e.mass=1),"gravity"in e||(e.gravity=-9.81),e.acceleration||(e.acceleration={x:0,y:0,z:0}),e.velocity||(e.velocity={x:0,y:0,z:0}),"maxSpeed"in e||(e.maxSpeed=10),e.position||(e.position={x:0,y:0,z:0}),e},__operator:function(e){let t=performance.now(),r=(t-this.lastTime)*.001;this.lastTime=t;let i=this.entityKeys;for(let n=0;n<i.length;n++){let a=e[i[n]];if(!(a.components&&!a.components[this.__node.tag])&&!a.fixed){if(a.mass&&(a.force.x&&(a.acceleration.x+=a.force.x/a.mass,a.force.x=0),a.force.y&&(a.acceleration.y+=a.force.y/a.mass,a.force.y=0),a.force.z&&(a.acceleration.z+=a.force.z/a.mass+a.gravity,a.force.z=0)),a.drag&&(a.acceleration.x&&(a.acceleration.x-=a.acceleration.x*a.drag*r),a.acceleration.y&&(a.acceleration.y-=a.acceleration.y*a.drag*r),a.acceleration.z&&(a.acceleration.z-=a.acceleration.z*a.drag*r)),a.acceleration.x&&(a.velocity.x+=a.acceleration.x*r),a.acceleration.y&&(a.velocity.y+=a.acceleration.y*r),a.acceleration.z&&(a.velocity.z+=a.acceleration.z*r),a.maxSpeed>0){let p=tt.collision.magnitude(a.velocity);if(p>a.maxSpeed){let d=a.maxSpeed/p;a.velocity.x*=d,a.velocity.y*=d,a.velocity.z*=d}}a.velocity.x&&(a.position.x+=a.velocity.x*r),a.velocity.y&&(a.position.y+=a.velocity.y*r),a.velocity.z&&(a.position.z+=a.velocity.z*r)}}return e}}},ki=class{constructor(e,t,r,i){this.r=e,this.g=t,this.b=r,this.a=i}},ff=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=!1,this._vbuffer=0,this._coord=0,this.visible=!0,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new ki(0,0,0,1),this.webglNumPoints=0}},$s=class extends ff{constructor(e,t){super(),this.currentIndex=0,this.webglNumPoints=t,this.numPoints=t,this.color=e,this.xy=new Float32Array(2*this.webglNumPoints)}setX(e,t){this.xy[e*2]=t}setY(e,t){this.xy[e*2+1]=t}getX(e){return this.xy[e*2]}getY(e){return this.xy[e*2+1]}lineSpaceX(e,t){for(let r=0;r<this.numPoints;r++)this.setX(r,e+t*r)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(e){for(let t=0;t<this.numPoints;t++)this.setY(t,e)}shiftAdd(e){let t=e.length;for(let r=0;r<this.numPoints-t;r++)this.setY(r,this.getY(r+t));for(let r=0;r<t;r++)this.setY(r+this.numPoints-t,e[r])}addArrayY(e){if(this.currentIndex+e.length<=this.numPoints)for(let t=0;t<e.length;t++)this.setY(this.currentIndex,e[t]),this.currentIndex++}replaceArrayY(e){if(e.length==this.numPoints)for(let t=0;t<this.numPoints;t++)this.setY(t,e[t])}},qc=(e,t,r)=>{let i={x:0,y:0};return i.x=e.x+t.x*r,i.y=e.y+t.y*r,i},ma=e=>Na(-e.y,e.x),qs=(e,t)=>{let r=Yp(e,t);return r=uf(r),r},Wp=(e,t)=>{let r={x:0,y:0};return r.x=e.x+t.x,r.y=e.y+t.y,r},Gp=(e,t)=>e.x*t.x+e.y*t.y,uf=e=>{let t={x:0,y:0},r=e.x*e.x+e.y*e.y;return r>0&&(r=1/Math.sqrt(r),t.x=e.x*r,t.y=e.y*r),t},Na=(e,t)=>{let r={x:0,y:0};return r.x=e,r.y=t,r},Yp=(e,t)=>{let r={x:0,y:0};return r.x=e.x-t.x,r.y=e.y-t.y,r},Xp=e=>{let t,r={x:0,y:0},i={x:0,y:0},n=[],a=(y,b)=>{n.push({vec2:y,miterLength:b})},p=y=>({x:e[y*2],y:e[y*2+1]});r=qs(p(1),p(0)),t=ma(r),a(t,1);let d=e.length/2;for(let y=1;y<d-1;y++){let b=p(y-1),v=p(y),h=p(y+1);r=qs(v,b),t=ma(r),i=qs(h,v);let w=Kp(r,i),_=Zp(r,w,1);a(w,_)}return r=qs(p(d-1),p(d-2)),t=ma(r),a(t,1),n},Kp=(e,t)=>{let r=Wp(e,t);return r=uf(r),Na(-r.y,r.x)},Zp=(e,t,r)=>{let i=Na(-e.y,e.x);return r/Gp(t,i)},_a=class extends ff{constructor(e,t,r){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=t*2,this.numPoints=t,this.color=e,this._thicknessRequested=r,this._linePoints=new Float32Array(t*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let e=this._actualThickness/2,t=Xp(this._linePoints);for(let r=0;r<this.numPoints;r++){let i=this._linePoints[2*r],n=this._linePoints[2*r+1],a={x:i,y:n},p=qc(a,t[r].vec2,t[r].miterLength*e),d=qc(a,t[r].vec2,-t[r].miterLength*e);this.xy[r*4]=p.x,this.xy[r*4+1]=p.y,this.xy[r*4+2]=d.x,this.xy[r*4+3]=d.y}}setX(e,t){this._linePoints[e*2]=t}setY(e,t){this._linePoints[e*2+1]=t}lineSpaceX(e,t){for(let r=0;r<this.numPoints;r++)this.setX(r,e+t*r)}setThickness(e){this._thicknessRequested=e}getThickness(){return this._thicknessRequested}setActualThickness(e){this._actualThickness=e}},Qp=class{constructor(e,t){this.debug=!1,this.addLine=this.addDataLine,t==null?this.webgl=e.getContext("webgl",{antialias:!0,transparent:!1}):(this.webgl=e.getContext("webgl",{antialias:t.antialias,transparent:t.transparent,desynchronized:t.deSync,powerPerformance:t.powerPerformance,preserveDrawing:t.preserveDrawing}),this.debug=t.debug==null?!1:t.debug),this.log("canvas type is: "+e.constructor.name),this.log(`[webgl-plot]:width=${e.width}, height=${e.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=!1,this.gLog10Y=!1,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,e.width,e.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(e){let t=this.webgl;e.forEach(r=>{if(r.visible){t.useProgram(this._progLine);let i=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(i,!1,new Float32Array([r.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,r.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let n=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(n,new Float32Array([r.offsetX+this.gOffsetX,r.offsetY+this.gOffsetY]));let a=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let p=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(p,[r.color.r,r.color.g,r.color.b,r.color.a]),t.bufferData(t.ARRAY_BUFFER,r.xy,t.STREAM_DRAW),t.drawArrays(r.loop?t.LINE_LOOP:t.LINE_STRIP,0,r.webglNumPoints)}})}_drawSurfaces(e){let t=this.webgl;e.forEach(r=>{if(r.visible){t.useProgram(this._progLine);let i=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(i,!1,new Float32Array([r.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,r.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let n=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(n,new Float32Array([r.offsetX+this.gOffsetX,r.offsetY+this.gOffsetY]));let a=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let p=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(p,[r.color.r,r.color.g,r.color.b,r.color.a]),t.bufferData(t.ARRAY_BUFFER,r.xy,t.STREAM_DRAW),t.drawArrays(t.TRIANGLE_STRIP,0,r.webglNumPoints)}})}_drawTriangles(e){let t=this.webgl;t.bufferData(t.ARRAY_BUFFER,e.xy,t.STREAM_DRAW),t.useProgram(this._progLine);let r=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(r,!1,new Float32Array([e.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,e.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let i=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(i,new Float32Array([e.offsetX+this.gOffsetX,e.offsetY+this.gOffsetY]));let n=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(n,new Int32Array([0,0]));let a=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(a,[e.color.r,e.color.g,e.color.b,e.color.a]),t.drawArrays(t.TRIANGLE_STRIP,0,e.xy.length/2)}_drawThickLines(){this._thickLines.forEach(e=>{if(e.visible){let t=Math.min(this.gScaleX,this.gScaleY);e.setActualThickness(e.getThickness()/t),e.convertToTriPoints(),this._drawTriangles(e)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(e){e._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,e._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,e.xy,this.webgl.STREAM_DRAW),e._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(e._coord,2,this.webgl.FLOAT,!1,0,0),this.webgl.enableVertexAttribArray(e._coord)}addDataLine(e){this._addLine(e),this.linesData.push(e)}addAuxLine(e){this._addLine(e),this.linesAux.push(e)}addThickLine(e){this._addLine(e),this._thickLines.push(e)}addSurface(e){this._addLine(e),this.surfaces.push(e)}initThinLineProgram(){let e=`
      attribute vec2 coordinates;
      uniform mat2 uscale;
      uniform vec2 uoffset;
      uniform ivec2 is_log;

      void main(void) {
         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;
         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;
         vec2 line = vec2(x, y);
         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);
      }`,t=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(t,e),this.webgl.compileShader(t);let r=`
         precision mediump float;
         uniform highp vec4 uColor;
         void main(void) {
            gl_FragColor =  uColor;
         }`,i=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(i,r),this.webgl.compileShader(i),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,t),this.webgl.attachShader(this._progLine,i),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(e,t,r,i){this.webgl.viewport(e,t,r,i)}log(e){this.debug&&console.log("[webgl-plot]:"+e)}},Vt=class{constructor(){this.plots={}}initPlot(e,t){if(t||(t=new Qp(e.canvas,e.webglOptions)),!e._id)e._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[e._id]){let y=this.plots[e._id].initial;if(e.lines){for(let b in e.lines)if(y.lines[b]&&Array.isArray(e.lines[b])){let v=e.lines[b];e.lines[b]=y.lines[b]}}e=Object.assign(y,e)}e.overlay&&(typeof e.overlay!="object"&&(e.overlay=document.createElement("canvas"),e.overlay.style.position="absolute",e.overlay.width=e.canvas.width,e.overlay.height=e.canvas.height,e.canvas.appendChild(e.overlay)),e.overlayCtx||(e.overlayCtx=e.overlay.getContext("2d"))),e.width&&(e.canvas.width=e.width,e.canvas.style&&(e.canvas.style.width=e.width+"px"),typeof e.overlay=="object"&&(e.overlay.width=e.width,e.overlay.style&&(e.overlay.style.width=e.width+"px"))),e.height&&(e.canvas.height=e.height,e.canvas.style&&(e.canvas.style.height=e.height+"px"),typeof e.overlay=="object"&&(e.overlay.height=e.height,e.overlay.style&&(e.overlay.style.height=e.height+"px"))),e.lines?.timestamp&&delete e.lines.timestamp,e.lines||(e.lines={});let r={};for(let y in e.lines)r[y]=Object.assign({},r[y]),"viewing"in e.lines[y]||(e.lines[y].viewing=!0),r[y].viewing=e.lines[y].viewing,r[y].sps=e.lines[y].sps,r[y].nSec=e.lines[y].nSec,r[y].nPoints=e.lines[y].nPoints,r[y].ymin=e.lines[y].ymin,r[y].ymax=e.lines[y].ymax,r[y].units=e.lines[y].units;let i={plot:t,settings:e,initial:Object.assign(Object.assign({},e),{lines:r}),anim:()=>{t.update()}};this.plots[e._id]=i;let n=0,a=0;Object.keys(e.lines).forEach(y=>{e.lines[y]?.viewing!==!1&&a++}),e.nLines=a;let p,d;typeof e.overlay=="object"&&(p=e.overlay,d=e.overlayCtx,d.clearRect(0,0,e.overlay.width,e.overlay.height),d.font=e.overlayFont?e.overlayFont:"1em Courier",d.fillStyle=e.overlayColor?e.overlayColor:"white");for(let y in e.lines){let b=e.lines[y];if(Array.isArray(b)&&(b={values:b},e.lines[y]=b),"viewing"in b||(b.viewing=!0),b.color)Array.isArray(b.color)&&(b.color=new ki(...b.color));else{let C=Vt.HSLToRGB(360*(n/a)%360,100,50,1);i.initial.lines[y].color=[...C,1],b.color=new ki(...C,1)}let v;if(b.nSec&&b.sps?v=Math.ceil(b.nSec*b.sps):b.nPoints?v=b.nPoints:b.points?v=b.points:e.linePoints?v=e.linePoints:b.values?v=b.values.length:v=1e3,b.points=v,e.lines[y].viewing===!1)continue;if((b.width||e.lineWidth)&&b.width!==0){let C=e.lineWidth;C||(C=b.width),b.width?b.line=new _a(b.color,v,b.width):e.lineWidth&&(b.line=new _a(b.color,v,e.lineWidth)),b.line.lineSpaceX(-1,2/b.line.numPoints)}else b.line=new $s(b.color,v),b.line.arrangeX();b.values?.length===b.points?b.values.length!==v&&(b.interpolate?b.values.length>v?b.values=Vt.downsample(b.values,v):b.values.length<v&&(b.values=Vt.upsample(b.values,v)):b.values.length>b.points?b.values=b.values.slice(b.values.length-b.points):b.values=[...new Array(b.points-b.values.length).fill(0),...b.values]):Array.isArray(b.values)?b.values.length>v?b.values=b.values.slice(b.values.length-v):b.values.length<v&&(b.values=[...new Array(v-b.values.length).fill(0),...b.values]):b.values=new Array(b.points).fill(0);let h=b.ymin,w=b.ymax,_=b.values.length<=1e5;if(h===w?(w=_?Math.max(...b.values):1,h=_?Math.min(...b.values):0):isNaN(w)&&(w=_?Math.max(...b.values):1),isNaN(h)&&(h=_?Math.min(...b.values):0),h>w){let C=h;w=h,h=C}let T=Math.abs(h);if(b.absmax=T>w?T:w,"autoscale"in b||(b.autoscale=!0),b.position||(b.position=e.nLines-n-1),b.autoscale?b.autoscale===2?("clamp"in b||(b.clamp=!0),b.scaled=Vt.autoscale(b.values,b.position,a,b.centerZero,h,w,b.clamp)):(b.scaled=b.values,b.line.scaleY=Vt.getYScalar(b.values,a,b.centerZero,h,w),b.line.offsetY=Vt.getYOffset(b.position,a,h,b.line.scaleY)):b.scaled=b.values,b.scaled.forEach((C,I)=>b.line.setY(I,C)),b.line instanceof _a?t.addThickLine(b.line):b.line instanceof $s&&t.addDataLine(b.line),"xAxis"in b||(b.xAxis=!0),b.xAxis){b.xColor?Array.isArray(b.xColor)&&(b.xColor=new ki(...b.xColor)):b.xColor=new ki(1,1,1,.3);let C=new $s(b.xColor,2),I=b.autoscale?(n+1)*2/a-1-1/a:0;C.constY(I),C.arrangeX(),C.xy[2]=1,b.x=C,t.addAuxLine(C)}if(a>1&&b.autoscale&&n!==a-1){e.dividerColor?Array.isArray(e.dividerColor)&&(e.dividerColor=new ki(...e.dividerColor)):e.dividerColor=new ki(1,1,1,1);let C=new $s(e.dividerColor,2);C.constY(b.autoscale?(n+1)*2/a-1:1),C.arrangeX(),C.xy[2]=1,b.divider=C,t.addAuxLine(C)}if(typeof e.overlay=="object"&&(b.useOverlay||!("useOverlay"in b))){let C=e.nLines-b.position-1;d.fillText(y,20,p.height*(C+.2)/e.nLines),d.fillText(`${Math.floor(w)===w?w:w?.toFixed(5)} ${b.units?b.units:""}`,p.width-100,p.height*(C+.2)/e.nLines),d.fillText(`${Math.floor(h)===h?h:h?.toFixed(5)} ${b.units?b.units:""}`,p.width-100,p.height*(C+.9)/e.nLines)}n++}return requestAnimationFrame(i.anim),this.plots[e._id]}deinitPlot(e){return typeof e=="string"&&(e=this.plots[e]),e.plot.clear(),e.plot.removeAllLines(),!0}reinitPlot(e,t){if(typeof e=="string"){let r=e;e=this.plots[e],t._id||(t._id=r)}if(e.plot)return e.plot.clear(),e.plot.removeAllLines(),e.settings.overlayCtx&&e.settings.overlayCtx.clearRect(0,0,e.settings.overlay?.width,e.settings.overlay?.height),this.initPlot(t,e.plot)}getChartSettings(e,t){let r=this.plots[e];if(r){let i=Object.assign({},r.initial);for(let n in r.initial.lines)typeof r.initial.lines[n]?.ymax!="number"&&(i.lines[n].ymax=r.settings.lines[n]?.ymax),typeof r.initial.lines[n]?.ymin!="number"&&(i.lines[n].ymin=r.settings.lines[n]?.ymin),t&&(i.lines[n].values=r.settings.lines[n].values);return delete i.canvas,delete i.overlay,delete i.overlayCtx,i}}update(e,t,r=!0){if(typeof e=="string"&&(e=this.plots[e]),!e)return!1;if(t){let i=!1,n,a;typeof e.settings.overlay=="object"&&(n=e.settings.overlay,a=e.settings.overlayCtx,a.font=e.settings.overlayFont?e.settings.overlayFont:"1em Courier",a.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white");for(let p in t)if(e.settings.lines[p]&&e.settings.lines[p].line){if(e.settings.lines[p]?.viewing===!1)continue;let d=e.settings.lines[p];if(d.values){if(e.settings.mode&&e.settings.mode==="sweep"){"ct"in d||(d.ct=0);let w=_=>{d.ct>d.values.length&&(d.ct=0),d.values[d.ct]=_,d.ct++};Array.isArray(t[p])?t[p].forEach(w):typeof t[p]=="number"?w(t[p]):t[p].values&&t[p].values.forEach(w)}else Array.isArray(t[p])&&d.values?.length<1e5?(d.values.length===0&&(d.values.length=d.points?d.points:1e3),t[p].length===d.values.length?d.values=t[p]:Vt.circularBuffer(d.values,t[p])):typeof t[p]=="number"?(d.values.push(t[p]),d.values.shift()):t[p]?.values&&(d.values.length===0&&(d.values.length=d.points?d.points:1e3),t[p].values.length===d.values.length?d.values=t[p].values:Vt.circularBuffer(d.values,t[p].values));d.values.length!==d.points&&(d.interpolate?d.values.length>d.points?d.values=Vt.downsample(d.values,d.points):d.scaled.length<d.points&&(d.values=Vt.upsample(d.values,d.points)):d.values.length>d.points?d.values.splice(0,d.values.length-d.points):d.values=new Array(d.points).fill(0).splice(d.points-d.values.length,0,d.values));let y=d.ymin,b=d.ymax,v=d.values.length<=1e5;if(y===b?(b=v?Math.max(...d.values):1,y=v?Math.min(...d.values):0):isNaN(b)&&(b=v?Math.max(...d.values):1),isNaN(y)&&(y=v?Math.min(...d.values):0),y>b){let w=y;b=y,y=w}let h=Math.abs(y);if(d.absmax=h>b?h:b,d.autoscale?d.autoscale===2?d.scaled=Vt.autoscale(d.values,d.position,e.settings.nLines,d.centerZero,y,b,d.clamp):(d.scaled=d.values,d.line.scaleY=Vt.getYScalar(d.values,e.settings.nLines,d.centerZero,y,b),d.line.offsetY=Vt.getYOffset(d.position,e.settings.nLines,y,d.line.scaleY)):d.scaled=d.values,d.scaled.forEach((w,_)=>{!d.autoscale&&d.absmax>1?d.line.setY(_,w/d.absmax):d.line.setY(_,w)}),typeof e.settings.overlay=="object"&&(d.useOverlay||!("useOverlay"in d))){let w=e.settings.nLines-d.position-1,_=n.height*w/e.settings.nLines,T=n.height/e.settings.nLines;if(a.clearRect(0,_,n.width,T),e.settings.mode&&e.settings.mode==="sweep"){a.fillStyle=e.settings.sweepColor?e.settings.sweepColor:"rgba(0,255,0,0.25)",a.beginPath();let C=n.width*d.ct/d.values.length;a.moveTo(C,_),a.lineTo(C,T),a.stroke()}a.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white",a.fillText(p,20,n.height*(w+.2)/e.settings.nLines),a.fillText(`${Math.floor(b)===b?b:b?.toFixed(5)} ${d.units?d.units:""}`,n.width-100,n.height*(w+.2)/e.settings.nLines),a.fillText(`${Math.floor(y)===y?y:y?.toFixed(5)} ${d.units?d.units:""}`,n.width-100,n.height*(w+.9)/e.settings.nLines)}}}else e.settings.generateNewLines&&!p.includes("timestamp")&&(Array.isArray(t[p])&&(t[p]={values:t[p]}),!t[p].nSec&&!t[p].nPoints&&!e.settings.linePoints&&(t[p].nPoints=1e3),i=!0);if(i)return e.settings.cleanGeneration||Object.keys(e.initial.lines).forEach(p=>{t[p]?t[p]=Object.assign(e.initial.lines[p],t[p]):t[p]=e.initial.lines[p]}),this.reinitPlot(e,{_id:e.settings._id,lines:t}),!0}return r&&requestAnimationFrame(e.anim),!0}updateLine(e,t,r,i,n,a,p){return e.numPoints!==t.length&&(r?e.numPoints>t.length?t=Vt.downsample(t,e.numPoints):e.numPoints<t.length&&(t=Vt.upsample(t,e.numPoints)):t.length>e.numPoints?t=t.slice(t.length-e.numPoints):t=[...new Array(t.length).fill(0),...t]),i&&(t=Vt.autoscale(t,n,a,p)),t.forEach((d,y)=>e.setY(y,d)),!0}static autoscale(e,t=0,r=1,i=!1,n,a,p){if(e?.length===0)return e;let d=typeof a=="number"?a:e.length<=1e5?Math.max(...e):1,y=typeof n=="number"?n:e.length<=1e5?Math.min(...e):0,b=1/r,v=1;if(i){let h=Math.max(Math.abs(y),Math.abs(d));return h!==0&&(v=b/h),e.map(w=>(p&&(w<y&&(w=y),w>d&&(w=d)),w*v+(b*(t+1)*2-1-b)))}else return d===y?d!==0?v=b/d:y!==0&&(v=b/Math.abs(y)):v=b/(d-y),e.map(h=>(p&&(h<y&&(h=y),h>d&&(h=d)),2*((h-y)*v-1/(2*r))+(b*(t+1)*2-1-b)))}static getYScalar(e,t=1,r=!1,i,n){if(e?.length===0)return e;let a=typeof n=="number"?n:e.length<=1e5?Math.max(...e):1,p=typeof i=="number"?i:e.length<=1e5?Math.min(...e):0,d=1/t,y=1;if(r){let b=Math.max(Math.abs(p),Math.abs(a));return b!==0&&(y=d/b),2*y}else return a===p?a!==0?y=d/a:p!==0&&(y=d/Math.abs(p)):y=d/(a-p),2*y}static getYOffset(e=0,t=1,r=0,i=1){let n=1/t,a=n*(e+1)*2-1-n;return r!==0?a-=r*i+1/t:a-=i+1/t,a}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,r=1){if(e.length>t){let i=new Array(t),n=e.length/t,a=e.length-1,p=0,d=0;for(let y=n;y<e.length;y+=n){let b=Math.round(y);b>a&&(b=a);for(let v=p;v<b;v++)i[d]+=e[v];i[d]/=(b-p)*r,d++,p=b}return i}else return e}static upsample(e,t,r=1){var i=function(h,w,_){return(h+(w-h)*_)*r},n=new Array(t),a=(e.length-1)/(t-1);n[0]=e[0];for(var p=1;p<t-1;p++){var d=p*a,y=Math.floor(d),b=Math.ceil(d),v=d-y;n[p]=i(e[y],e[b],v)}return n[t-1]=e[e.length-1],n}static interpolate(e,t,r=1){return e.length>t?Vt.downsample(e,t,r):e.length<t?Vt.upsample(e,t,r):e}static HSLToRGB(e,t,r,i=255){t/=100,r/=100;let n=(1-Math.abs(2*r-1))*t,a=n*(1-Math.abs(e/60%2-1)),p=r-n/2,d=0,y=0,b=0;return 0<=e&&e<60?(d=n,y=a,b=0):60<=e&&e<120?(d=a,y=n,b=0):120<=e&&e<180?(d=0,y=n,b=a):180<=e&&e<240?(d=0,y=a,b=n):240<=e&&e<300?(d=a,y=0,b=n):300<=e&&e<360&&(d=n,y=0,b=a),d=(d+p)*i,y=(y+p)*i,b=(b+p)*i,[d,y,b]}static circularBuffer(e,t){if(t.length<e.length){let r=e.slice(t.length),i=e.length;e.splice(0,i,...r,...t)}else if(t.length>e.length){let r=e.length;e.splice(0,r,...t.slice(t.length-r))}else e.splice(0,e.length,...t);return e}static formatDataForCharts(e,t){if(Array.isArray(e)){if(Array.isArray(e[0])){let r={};if(e.forEach((i,n)=>{r[n]=i}),e=r,isNaN(e[0][0]))return}else if(t){if(e={[t]:e},isNaN(e[t][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let r in e)if(typeof e[r]=="number"?e[r]=[e[r]]:e[r]?.values&&typeof e[r].values=="number"&&(e[r].values=[e[r].values]),isNaN(e[r][0]))return}else if(typeof e=="string"){let r;if(e.includes(`\r
`)){let i=e.split(`\r
`);e={},i.forEach((n,a)=>{n.includes("	")?r=n.split("	"):n.includes(",")?r=n.split(","):n.includes("|")&&(r=n.split("|")),r&&r.forEach((p,d)=>{if(p.includes(":")){let[y,b]=p.split(":"),v=parseFloat(b);isNaN(v)||(e[y]=[v])}else{let y=parseFloat(p);isNaN(y)||(e[d]=[y])}})})}else e.includes("	")?r=e.split("	"):e.includes(",")?r=e.split(","):e.includes("|")&&(r=e.split("|"));e={},r&&r.forEach((i,n)=>{if(i.includes(":")){let[a,p]=i.split(":"),d=parseFloat(p);isNaN(d)||(e[a]=[d])}else{let a=parseFloat(i);isNaN(a)||(e[n]=[a])}})}else typeof e=="number"&&(t?e={[t]:[e]}:e={0:[e]});return e}static padTime(e,t,r,i){let n=(e[0]-t)/r/i;return[...new Array(i-e.length).map((a,p)=>t+n*(p+1)),...e]}static interpolateForTime(e,t,r){return Vt.interpolate(e,Math.ceil(r*t))}};var eh=Object.defineProperty,th=(e,t,r)=>t in e?eh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,pt=(e,t,r)=>(th(e,typeof t!="symbol"?t+"":t,r),r),Ar=class{constructor(){}static genSineWave(e=20,t=1,r=1,i=512,n=0,a=1){for(var p=[],d=[],y=1/i,b=0;b<r;b+=y){var v=Math.sin(2*Math.PI*e*b)*t;v+=Math.sin(2*Math.PI*n*b)*a,p.push(v),d.push(b)}return[d,p]}static getSineAmplitude(e=20,t=1,r=0,i=0){return Math.sin(this.TWO_PI*e*r+i)*t}static mean(e){var t=e.reduce((r,i)=>i+=r);return t/e.length}static mode(e){return e.sort((t,r)=>e.filter(i=>i===t).length-e.filter(i=>i===r).length).pop()}static std(e,t=void 0){let r=t;t||(r=this.mean(e));let i=0;for(let n=0;n<e.length;n++){let a=e[n]-r;i+=a*a}return Math.sqrt(i/e.length)}static relError(e=[],t=[],r=!0){if(e.length!==t.length)throw new Error("Input arrays of same length!");let i=e.length,n=new Array(e.length);for(let a=0;a<i;a++){let p=(e[a]-t[a])/e[a];r&&(p=Math.abs(p)),n[a]=p}return n}static informationEntropy(e=[]){let t=e.length,r=new Array(t);for(let i=0;i<t;i++){let n=e[i]*Math.log(e[i]);isNaN(n)&&(n=0),r[i]=n}return r}static zscore(e){let t=this.mean(e),r=this.std(e,t),i=new Array().length(e.length);for(let n=0;n<e.length;n++)i[n]=(e[n]-t)/r;return i}static variance(e){var t=this.mean(e);return e.reduce((r,i)=>r+(i-t)**2,0)/e.length}static dot(e,t){for(var r=0,i=0;i<e.length;i++)r+=e[i]*t[i];return r}static cross3D(e,t){return[e[1]*t[2]-e[2]*t[1],e[2]*t[0]-e[0]*t[2],e[0]*t[1]-e[1]*t[0]]}static magnitude(e){var t=0;return e.forEach(r=>{t+=r*r}),Math.sqrt(t)}static distance(e,t){var r=0;return e.forEach((i,n)=>{r+=(t[n]-i)*(t[n]-i)}),Math.sqrt(r)}static midpoint(e=[1,2,3],t=[3,4,5]){return e.map((r,i)=>(r+t[i])*.5)}static normalize(e){var t=0;t=this.magnitude(e);var r=new Array(e.length);return e.forEach((i,n)=>{r[n]=i*t}),r}static normalizeSeries(e=[],t=!0){let r=Math.max(...e),i=Math.min(...e);return t==!1&&(r=Math.max(r,Math.abs(i)),i=0),r-i===0&&(i=0,r===0&&(r=1e-13)),e.map(n=>(n-i)/(r-i))}static quadraticFormula(e,t,r){let i=Math.sqrt(t*t-4*e*r);if(!isNaN(i))return["complex","complex"];let n=1/(2*e);if(i===0)return[t*n];let a=-t;return[(a+i)*n,(a-i)*n]}static newtonsMethod(e=a=>Math.pow(a,5)+a*a-a-.2,t=0,r=1,i=.01,n=10){let a=[];for(let p=0;p<n;p++){let d=Math.random()*(r-t),y=e(d),b=e(d+i),v=(b-y)/i,h=d+i;for(;Math.abs(v)>i;){let T=-y/I,C=h+T;y=b,b=e(C);let I=(b-y)/(C-h)}let w,_=a.find((T,C)=>{if(Math.abs(xn1-T)<i)return w=C,!0});_?a[w]=(xn1+_)*.5:a.push(xn1)}return a}static makeVec(e,t){var r=[];return e.forEach((i,n)=>{r.push(t[n]-i)}),r}static getBufferedValueByCoordinates(e=new Array(300).fill(1),t=[10,10,2],r=[1,2,1],i=void 0){let n=(p=0,d=0)=>{if(d===t.length)return p;if(d==0)p+=r[d];else if(t[d]==0)dimsAt0++;else{let y=(b=r[d],v=d-1)=>(b*=t[v],v--,v==0?b:y(b,v));p+=y(r[d]+1,d-1)}return d++,n(p,d)},a=n();if(i){if(r[r.length-1]===0){let p=0,d=0;for(;d!==r.length-1;)r[d]!==0&&(p=d),d++;return e[a-p+i]}return e[a-t.length+i]}else{if(r[r.length-1]===0){let p=0,d=0;for(;d!==r.length-1;)r[d]!==0&&(p=d),d++;return e.slice(a-p,a+1)}return e.slice(a-t.length,a+1)}}static forBufferedMat(e=new Array(100).fill(1),t=[10,10],r=(i,n,a,p)=>i+a+p){let i=[],n=0,a=(d=0,y=d+1)=>{let b=new Array(e.length);for(let v=0;v<t[d];v++)i[d]=v,t[y]?a(y):(b[n]=r(e[n],n,...i),n++);return b},p=(d,y=d+1)=>{let b=new Array(e.length);for(let v=0;v<t[d];v++)if(i[d]=v,t[y])a(y);else for(let h=0;h<t.length;h++)b[n]=r[h](e[n],n,...i),n++;return b};if(typeof r=="function")return a();if(Array.isArray(r))return p()}static mapBufferedMat(e=new Array(100).fill(1),t=[10,10],r=(i,n,a,p)=>(console.log(`value:${i}, idx:${n}, x:${a},y:${p}`),i+a+p)){let i=new Array(t.length).fill(0),n=(d,y=0)=>{if(d[y]>=t[y]){if(d[y]=0,y++,y===t.length)return;n(d,y)}else d[y]++},a=new Array(e.length),p=0;if(typeof r=="function")for(;p<e.length;)a[p]=r(e[p],p,...i),p+=t.length,n(i);else if(Array.isArray(r))for(;p<e.length;)r.forEach(d=>{a[p]=d(e[p],p,...i),p++,n(i)});return a}static combinations(e=["a","b","c"],t=3){var r=[];return t<=0?r.push([]):Ar.combinations(e,t-1).forEach(function(i){e.forEach(function(n){r.push([n].concat(i))})}),r}static generateCoordinateSpace(e=[10,10,10],t=[-10,-10,-10],r=[1,1,1],i=void 0){for(let d=0;d<e.length;d++)if(t[d]>e[d]){let y=e[d];e[d]=t[d],t[d]=y}let n=[],a=[...e],p=a.length-1;for(n.push([...a]);a[0]>=t[0];){let d=b=>{if(a[b]<=t[b]){if(b===0||(a[b]=e[b],b--,b<0))return;typeof r[b]=="function"?a[b]-=r[b](a[b]):a[b]-=r[b],d(b)}},y=p;typeof r[y]=="function"?a[y]-=r[y](a[y]):a[y]-=r[y],n.push([...a]),d(y),i&&(n[n.length-1]=i(n[n.length-1]))}return n}static calcVectorField(e=[[0,0],[0,1],[1,0],[1,1]],t=(r,i)=>[r*10,i*10]){return e.map(r=>t(...r))}static transpose(e){return e[0].map((t,r)=>e.map(i=>i[r]))}static matmul(e,t){for(var r=e.length,i=e[0].length,n=t.length,a=t[0].length,p=new Array(r),d=0;d<r;++d){p[d]=new Array(a);for(var y=0;y<a;++y){p[d][y]=0;for(var b=0;b<i;++b)p[d][y]+=e[d][b]*t[b][y]}}return p}static matscale(e,t){let r=[];for(var i=0;i<e.length;i++){r[i]=[];for(let n=0;n<e[0].length;n++)r[i][n]=e[i][n]*t}return r}static matadd(e,t){let r=[];for(let n=0;n<e.length;n++){r[n]=[];for(var i=0;i<e[0].length;i++)r[n][i]=e[n][i]+t[n][i]}return r}static matsub(e,t){let r=[];for(let n=0;n<e.length;n++){r[n]=[];for(var i=0;i<e[0].length;i++)r[n][i]=e[n][i]-t[n][i]}return r}static histogram(e=[],t=1,r=void 0){let i=[...e];i.sort(function(y,b){return y-b});let n=Math.min(...i);if(typeof r=="number"){let y=Math.max(...i);t=Math.abs((y-n)/(r-1))}let a=n,p=[],d=[];for(let y=0;y<i.length;y++){let b=t*a;if(i[y]>n+b){a++,b+=t;let h=n+b+b*.5;p.push(h),d.push(0)}d[d.length-1]++}return[p,d]}static normalDistribution(e=[],t=!0,r=1e-4){let i=this.mean(e),n=this.variance(e),a=e.length,p=[],d=1/(this.TWO_PI*n),y=1/n,b=0;for(let v=0;v<a;v++){let h=Math.exp(-.5*Math.pow((e[v]-i)*y,2))*d;h<r&&(h=0),p.push(h),b+=h}if(t){let v=1/b;p=p.map(h=>h*v)}return p}static expectedValue(e=[],t=this.normalDistribution(e)){return e.reduce((r,i,n)=>r+i*t[n])}static originMoment(e=[],t=this.normalDistribution(e),r=1){return e.reduce((i,n,a)=>i+Math.pow(n,r)*t[a])}static centralMoment(e=[],t=this.normalDistribution(e),r=1){let i=this.mean(e);return e.reduce((n,a,p)=>n+Math.pow(a-i,r)*t[p]/e.length)}static linearDiscriminantAnalysis(e=[],t=[]){let r=this.mean(e),i=this.mean(t),n=this.cov1d(e,t),a=this.normalDistribution(e),p=[];for(let d=0;d<e.length;d++)p.push(x[d]*n*i-.5*r*n*i+Math.log10(a[d]));return p}static conv1D(e=[],t=[1/3,1/3,1/3],r=Math.floor(t.length*.5)){let i=[],n=1/t.length;if(r>0){let d=new Array(r).fill(0);e=[...d,...e,...d]}let a=Math.floor(t.length*.5),p=e.length-t.length+a;for(let d=a;d<p;d++){let y=0;for(let b=0;b<t.length;b++)y+=e[d-a]*t[b];i.push(y*n)}return i}static conv2D(e=[[],[],[]],t=[[],[],[]],r=0){let i=new Array(e.length-Math.ceil(t.length*.5)).fill([]),n,a=Ar.transpose(a);if(r>0){let C=new Array(r).fill(0);n=Ar.transpose(e);for(let I=0;I<n.length;I++)n[I]=[...C,...n[I],...C];e=Ar.transpose(n);for(let I=0;I<e.length;I++)e[I]=[...C,...e[I],...C]}let p=Math.floor(t[0].length*.5),d=Math.floor(a[0].length*.5),y=e[0].length-t[0].length+p,b=n[0].length-a[0].length+d,v=1/(t[0].length*a[0].length),h=y*b,w=p,_,T=d;for(;w<h;){let C=0;_=w%e[0].length,_===0&&T++;for(let I=0;I<t[0].length;I++){for(let P=0;P<a[0].length;I++)C+=e[T-d+P][_-p+I]*t[P][I];i[T].push(C*v)}w++}return i}static cov2d(e){var t=this.transpose(e),r=[],i=[],n=[];e.forEach((T,C)=>{i.push(this.mean(T))}),t.forEach((T,C)=>{n.push(this.mean(T))}),e.forEach((T,C)=>{r.push([]);for(var I=0;I<T.length;I++)r[C].push((e[C][I]-i[C])*(e[C][I]-n[I])/(T.length-1))});for(var a=this.transpose(r),p=r.length,d=r[0].length,y=a.length,b=a[0].length,v=new Array(p),h=0;h<p;++h){v[h]=new Array(b);for(var w=0;w<b;++w){v[h][w]=0;for(var _=0;_<d;++_)v[h][w]+=r[h][_]*a[_][w]/(e[0].length-1)}}return v}static cov1d(e=[],t=[]){return this.cov2d([e,t])}static cov3d(e=[],t=[],r=[]){return[[this.cov1d(e,e),this.cov1d(e,t),this.cov1d(e,r)],[this.cov1d(t,e),this.cov1d(t,t),this.cov1d(t,r)],[this.cov1d(r,e),this.cov1d(r,t),this.cov1d(r,r)]]}static covNd(e=[]){let t=[];e.forEach((r,i)=>{t.push([]),e.forEach((n,a)=>{t[i].push(this.cov1d(r,n))})})}static eigens2x2(e=[[1,2],[3,4]]){let t=e[0][0]*e[1][1]-e[0][1]*e[1][0],r=(e[0][0]+e[1][1])*.5,i=Math.sqrt(r*r-t),n=r+i,a=r-i;return[n,a]}static eigenvectors2x2(e=[[1,2],[3,4]],t=[1,2]){let r=[-e[0][1],e[0][0]-t[0]];r[0]===0&&r[1]===0&&(r[0]=e[1][1]-t[0],r[1]=-e[1][0]);let i=[-e[0][1],e[0][0]-t[1]];return i[0]===0&&i[1]===0&&(i[0]=e[1][1]-t[1],i[1]=-e[1][0]),[r,i]}static fastpca2d(e,t){let r=this.cov1d(e,t),i=this.eigens2x2(r);i[1]>i[0]&&i.reverse();let n=this.eigenvectors2x2(r,i);return console.log(i,n),[i,n]}static crosscorrelation(e,t){var r=[...t,...Array(t.length).fill(0)],i=this.mean(e),n=this.mean(t),a=e.reduce((w,_)=>w+=Math.pow(_-i,2));a=Math.sqrt(Math.abs(a));var p=t.reduce((w,_)=>w+=Math.pow(_-i,2));p=Math.sqrt(Math.abs(p));let d=a*p;d===0&&(d=1e-26);for(var y=1/d,b=new Array(e.length).fill(0),v=0;v<e.length;v++){var h=e.reduce((w,_,T)=>w+=(_-i)*(r[v+T]-n));b[v]=h*y}return b}static autocorrelation(e){var t=[...e,...Array(e.length).fill(0)],r=this.mean(e),i=e.reduce((b,v)=>b+=Math.pow(v-r,2));i=Math.sqrt(Math.abs(i));let n=i*arr2Est;n===0&&(n=1e-26);for(var a=1/n,p=new Array(e.length).fill(0),d=0;d<e.length;d++){var y=e.reduce((b,v,h)=>b+=(v-r)*(t[d+h]-r));p[d]=y*a}return p}static autocorrelation2dNormalized(e){let t=[];for(let r=0;r<e.length;r++){t.push([]);for(let i=0;i<e[r].length;i++){let n=0,a=0;for(let p=0;p<e.length;p++)for(let d=0;d<e[p].length;d++)n+=e[r][i]*e[e.length-1-p][e[r].length-1-d],a+=e[r][i]*e[e.length-1][e[r].length-1];t[r][i]=n/a-1}}return t}static crosscorrelation2d(e,t){let r=[];for(let i=0;i<e.length;i++){r.push([]);for(let n=0;n<e[i].length;n++){let a=0;for(let p=0;p<t.length;p++)for(let d=0;d<t[p].length;d++)a+=e[i][n]*t[t.length-1-p][t[i].length-1-d];r[i][n]=a}}return r}static crosscorrelation2dNormalized(e,t){let r=[];for(let i=0;i<e.length;i++){r.push([]);for(let n=0;n<e[i].length;n++){let a=0,p=0;for(let d=0;d<t.length;d++)for(let y=0;y<t[d].length;y++)a+=e[i][n]*t[mat2d.length-1-d][t[i].length-1-y],p+=e[i][n]*t[t.length-1][t[i].length-1];r[i][n]=a/p-1}}return r}static correlograms(e=[[],[]]){var t=[];return e.forEach((r,i)=>{e.forEach((n,a)=>{a>=i&&t.push(Ar.crosscorrelation(r,n))})}),t}static dft(e=[]){for(var t=6.283185307179586,r=[],i=[],n=[],a=0;a<e.length;a++){r.push(0),i.push(0);for(var p=0;p<e.length;p++){var d=t*a*p/e.length;r[a]=r[a]+e[p]*Math.cos(d),i[a]=i[a]-e[p]*Math.sin(d)}n.push(Math.sqrt(r[a]*r[a]+i[a]*i[a]))}function y(h){return[...h.slice(Math.ceil(h.length*.5),h.length),...h.slice(0,Math.ceil(h.length*.5))]}n=y(n);let b=n.length*.5,v=n.map((h,w)=>w-b);return{real:r,imag:i,freqs:v,mags:n}}static sma(e=[],t){for(var r=[],i=0;i<e.length;i++)if(i==0)r.push(e[0]);else if(i<t){var n=e.slice(0,i+1);r.push(n.reduce((a,p)=>p+=a)/(i+1))}else{var n=e.slice(i-t,i);r.push(n.reduce((p,d)=>d+=p)/t)}return r}static sum(e=[]){if(e.length>0){var t=e.reduce((r,i)=>i+=r);return t}else return 0}static reduceArrByFactor(e,t=2){return e.filter((i,n)=>n%t===0)}static makeArr(e,t,r){for(var i=[],n=(t-e)/(r-1),a=0;a<r;a++)i.push(e+n*a);return i}static autoscale(e,t=1,r=0,i=!1){if(e?.length===0)return e;let n=Math.max(...e),a=Math.min(...e),p=1/t,d;if(i){let y=Math.max(Math.abs(a),Math.abs(n));return d=p/y,e.map(b=>b*d+(p*(r+1)*2-1-p))}else return d=p/(n-a),e.map(y=>2*((y-a)*d-1/(2*t))+(p*(r+1)*2-1-p))}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,r=1){if(e.length>t){let i=new Array(t),n=e.length/t,a=e.length-1,p=0,d=0;for(let y=n;y<e.length;y+=n){let b=Math.round(y);b>a&&(b=a);for(let v=p;v<b;v++)i[d]+=e[v];i[d]/=(b-p)*r,d++,p=b}return i}else return e}static interpolateArray(e,t,r=1){var i=function(h,w,_){return(h+(w-h)*_)*r},n=new Array,a=(e.length-1)/(t-1);n[0]=e[0];for(var p=1;p<t-1;p++){var d=p*a,y=Math.floor(d),b=Math.ceil(d),v=d-y;n[p]=i(e[y],e[b],v)}return n[t-1]=e[e.length-1],n}static isExtrema(e,t="peak"){let r=[...e];if(r.length%2===0&&r.pop(),e.length>1){let i=!0;for(let n=0;n<r.length;n++){let a=r[n];if(t==="peak"){if(n<Math.floor(r.length*.5)&&a>=r[Math.floor(r.length*.5)]){i=!1;break}else if(n>Math.floor(r.length*.5)&&a>=r[Math.floor(r.length*.5)]){i=!1;break}}else if(t==="valley"){if(n<Math.floor(r.length*.5)&&a<=r[Math.floor(r.length*.5)]){i=!1;break}else if(n>Math.floor(r.length*.5)&&a<=r[Math.floor(r.length*.5)]){i=!1;break}}else if(n<Math.floor(r.length*.5)&&a<=r[Math.floor(r.length*.5)]){i=!1;break}else if(n>Math.floor(r.length*.5)&&a<=r[Math.floor(r.length*.5)]){i=!1;break}}if(t!=="peak"&&t!=="valley"&&i===!1){i=!0;for(let n=0;n<r.length;n++){let a=r[n];if(n<Math.floor(r.length*.5)&&a>=r[Math.floor(r.length*.5)]){i=!1;break}else if(n>Math.floor(r.length*.5)&&a>=r[Math.floor(r.length*.5)]){i=!1;break}}}return i}else return}static isCriticalPoint(e,t="peak"){let r=[...e];if(r.length%2===0&&r.pop(),e.length>1){let i=!0;for(let n=0;n<r.length;n++){let a=r[n];if(t==="peak"){if(n<r.length*.5&&a<=0){i=!1;break}else if(n>r.length*.5&&a>0){i=!1;break}}else if(t==="valley"){if(n<r.length*.5&&a>=0){i=!1;break}else if(n>r.length*.5&&a<0){i=!1;break}}else if(n<r.length*.5&&a>=0){i=!1;break}else if(n>r.length*.5&&a<0){i=!1;break}}if(t!=="peak"&&t!=="valley"&&i===!1){i=!0;for(let n=0;n<r.length;n++){let a=r[n];if(n<r.length*.5&&a<=0){i=!1;break}else if(n>r.length*.5&&a>0){i=!1;break}}}return i}else return}static getPeakThreshold(e,t,r){let i,n=e.filter((a,p)=>{if(t.indexOf(p)>-1)return!0});return r===0?i=this.mean(n):i=(r+this.mean(n))*.5,i}static column(e,t){let r=new Array(e.length).fill(0).map(()=>new Array(1).fill(0));for(let i=0;i<e.length;i++)r[i][0]=e[i][t];return r}static flatten_vector(e){let t=[];for(let r=0;r<e.length;r++)t[r]=e[r][0];return t}static squared_difference(e,t){let r=0;for(let i=0;i<e.length;i++)r=r+Math.pow(e[i]-t[i],2);return r}static shift_deflate(e,t,r){let i=Math.sqrt(this.matmul(this.transpose(r),r)),n=this.matscale(r,1/i),a=this.matscale(this.matmul(n,this.transpose(n)),t);return this.matsub(e,a)}static eigenvalue_of_vector(e,t){return ev=this.matmul(this.matmul(this.transpose(t),e),t),ev}static power_iteration(e,t=1e-5,r=1e3){let i=e.length,n=new Array(i).fill(0).map(()=>new Array(1).fill(Math.sqrt(i))),a=this.eigenvalue_of_vector(e,n),p=1,d=0;for(;p>t&&d<r;){let y=JSON.parse(JSON.stringify(a)),b=this.matmul(e,n);n=this.normalize(b),a=this.eigenvalue_of_vector(e,n),p=Math.abs(a-y),d++}return[a,n]}static eigens(e,t=1e-4,r=1e3){let i=[],n=[];for(let a=0;a<e.length;a++){let p=this.power_iteration(e,t,r),d=p[0],y=p[1];i[a]=d,n[a]=this.flatten_vector(y),e=this.shift_deflate(e,d,y)}return[i,n]}static pca(e,t=1e-5){let r=e.length,i=new Array(r),n=new Array(r),a=this.transpose(e);i[0]=this.column(e,0);let p=1,d=0;for(;espilon>t;){d++,n[0]=this.matmul(a,i[0]);let b=this.matmul(this.transpose(i[0]),i[0]);n[0]=this.matscale(n[0],1/b);let v=Math.sqrt(this.matmul(this.transpose(n[0]),n[0]));n[0]=this.matscale(n[0],1/v);let h=this.matmul(e,n[0]),w=this.matmul(this.transpose(n[0]),n[0]);h=this.matscale(h,1/w),p=this.squared_difference(i[0],h),i[0]=JSON.parse(JSON.stringify(h))}return this.matmul(this.transpose(i[0]),i[0])}static circularBuffer(e,t){if(Array.isArray(t))if(t.length<e.length){let r=e.slice(t.length),i=e.length;e.splice(0,i,...r,...t)}else if(t.length>e.length){let r=e.length;e.splice(0,r,t.slice(r-t.length))}else e.splice(0,e.length,...t);else e.push(t),e.shift();return e}static HSLToRGB(e,t,r,i=255){t/=100,r/=100;let n=(1-Math.abs(2*r-1))*t,a=n*(1-Math.abs(e/60%2-1)),p=r-n/2,d=0,y=0,b=0;return 0<=e&&e<60?(d=n,y=a,b=0):60<=e&&e<120?(d=a,y=n,b=0):120<=e&&e<180?(d=0,y=n,b=a):180<=e&&e<240?(d=0,y=a,b=n):240<=e&&e<300?(d=a,y=0,b=n):300<=e&&e<360&&(d=n,y=0,b=a),d=(d+p)*i,y=(y+p)*i,b=(b+p)*i,[d,y,b]}static p300(e=[],t=[],r=[],i=256){let n=Math.floor(i/10),a=this.sma(t,n),p=this.peakDetect(a,"peak",n),d=this.mean(a),y=this.std(a,d),b=0,v=[];return p.length>0&&e.forEach((h,w)=>{for(;r[p[b]]<h+200&&(b++,!!p[b]););let _=0,T=[];for(;r[p[b+_]]<h+600&&(T.push(b+_),_++,!!p[b+_]););if(T.length>1){let C=[];T.forEach(U=>{C.push(a[p[U]])});let I=Math.max(...C),P=T[C.indexOf(I)];v.push({event_timestamp:h,event_index:w,peak_timestamp:r[[p[P]]],signal_index:[p[P]],signal_amplitude:t[[p[P]]],zscore:(a[p[P]]-d)/y})}else T.length===1&&v.push({event_timestamp:h,event_index:w,peak_timestamp:r[p[T[0]]],signal_index:p[T[0]],signal_amplitude:t[[p[T[0]]]],zscore:(a[p[T[0]]]-d)/y})}),v}},lt=Ar;pt(lt,"TWO_PI",Math.PI*2);pt(lt,"C",299792458);pt(lt,"G",66743e-15);pt(lt,"h",662607015e-42);pt(lt,"R",8314.32);pt(lt,"Ra",287);pt(lt,"H",69.3);pt(lt,"kbar",1054571817e-43);pt(lt,"kB",1380649e-29);pt(lt,"ke",89875517923e-1);pt(lt,"me",91093837015e-41);pt(lt,"mp",167262192369e-38);pt(lt,"mn",167492749804e-38);pt(lt,"P0",101325);pt(lt,"T0",288.15);pt(lt,"p0",1.225);pt(lt,"Na",60220978e16);pt(lt,"y",1.405);pt(lt,"M0",28.96643);pt(lt,"g0",9.80665);pt(lt,"Re",6378100);pt(lt,"B",1458e-9);pt(lt,"S",110.4);pt(lt,"Sigma",365e-12);pt(lt,"imgkernels",{edgeDetection:[[-1,-1,-1],[-1,8,-1],[-1,-1,-1]],boxBlur:[[1/9,1/9,1/9],[1/9,1/9,1/9],[1/9,1/9,1/9]],sobelLeft:[[1,0,-1],[2,0,-2],[1,0,-1]],sobelRight:[[-1,0,1],[-2,0,2],[-1,0,1]],sobelTop:[[1,2,1],[0,0,0],[-1,-2,-1]],sobelBottom:[[-1,2,1],[0,0,0],[1,2,1]],identity:[[0,0,0],[0,1,0],[0,0,0]],gaussian3x3:[[1,2,1],[2,4,2],[1,2,1]],guassian7x7:[[0,0,0,5,0,0,0],[0,5,18,32,18,5,0],[0,18,64,100,64,18,0],[5,32,100,100,100,32,5],[0,18,64,100,64,18,0],[0,5,18,32,18,5,0],[0,0,0,5,0,0,0]],emboss:[[-2,-1,0],[-1,1,1],[0,1,2]],sharpen:[[0,-1,0],[-1,5,-1],[0,-1,0]]});pt(lt,"integral",(e=i=>i,t=[],r=.01)=>{let i=0;for(let n=t[0];n<t[1];n+=r){let a=e(n);i+=a*r}return i});pt(lt,"dintegral",(e=(n,a)=>n+a,t=[[],[]],r=.01,i=r)=>{let n=0;for(let a=t[0][0]+r;a<t[0][1];a+=r)for(let p=t[1][0]+i;p<t[1][1];p+=i){let d=e(a,p);n+=d*r*i}return n});pt(lt,"tintegral",(e=(a,p,d)=>a+p+d,t=[[],[],[]],r=.01,i=r,n=r)=>{let a=0;for(let p=t[0][0]+r;p<t[0][1];p+=r)for(let d=t[1][0]+i;d<t[1][1];d+=i)for(let y=t[2][0]+n;y<t[2][1];y+=n){let b=e(p,d,y);a+=b*r*i*n}return a});pt(lt,"pintegral",(e=i=>i,t=[],r=.01)=>{let i=0,n,a;for(let p=t[0];p<t[1];p+=r)n=a,a=e(p),n&&(i+=Ar.distance([0,n],[r,a]));return i});pt(lt,"meshgrid",Ar.generateCoordinateSpace);pt(lt,"autocorrelation2d",e=>{let t=[];for(let r=0;r<e.length;r++){t.push([]);for(let i=0;i<e[r].length;i++){let n=0;for(let a=0;a<e.length;a++)for(let p=0;p<e[a].length;p++)n+=e[r][i]*e[e.length-1-a][e[r].length-1-p];t[r][i]=n}}return t});pt(lt,"lerp",Ar.makeArr);pt(lt,"upsample",Ar.interpolateArray);pt(lt,"lerp",(e,t,r,i=!0)=>{function n(p,d,y){return(1-y)*p+y*d}function a(p,d,y,b=!0){if(y<=2)return[p,d];let v=1/y,h=new Array(y);h[0]=p;for(let w=1;w<=y;w++)h[w]=n(p,d,v*w),b&&(h[w]=Math.floor(h[w]));return h}});pt(lt,"peakDetect",(e,t="peak",r=49)=>{let i=Math.floor(r*.5),n=[];for(let a=0;a<e.length-r;a++)Ar.isExtrema(e.slice(a,a+r),t)&&n.push(a+i-1);return n});Object.assign(Math,lt);var rh={accelConstant:1/8192,gyroConstant:1/65.5,gyroXAngle:0,gyroYAngle:0,gyroZAngle:0,px:0,py:0,pz:0,sps:100,lastAccelTime:Date.now(),lastGyroTime:Date.now(),__operator:function(e){if(!("ax"in e)&&!("gx"in e))return;if(!e.timestamp)if(e.ax&&Array.isArray(e.ax)||e.gx&&Array.isArray(e.gx)){let r=e.ax?e.ax.length:e.gx.length,i=Date.now(),n=[i-r*this.sps*1e3,i];e.timestamp=lt.upsample(n,r)}else e.timestamp=Date.now();let t;if(e.ax){let r=(i,n,a,p)=>{n=n*this.accelConstant,a=a*this.accelConstant,p=p*this.accelConstant;let d=Math.atan(a/Math.sqrt(n*n)+p*p*180/Math.PI)+this.accelXError,y=Math.atan(-n/Math.sqrt(a*a)+p*p*180/Math.PI)+this.accelYError;return{ax:n,ay:a,az:p,roll:d,pitch:y}};Array.isArray(e.timestamp)?t=e.timestamp.map((i,n)=>r(i,e.ax[n],e.ay[n],e.az[n])):t=r(e.timestamp,e.ax,e.ay,e.az)}if(e.gx){let r=(n,a,p,d)=>{let y=n-this.lastGyroTime;return this.lastGyroTime=n,a=a*this.gyroConstant+this.gyroXError,p=p*this.gyroConstant+this.gyroYError,d=d*this.gyroConstant+this.gyroZError,this.gyroXAngle+=a*y,this.gyroYAngle+=p*y,this.gyroZAngle+=d*y,{gx:a,gy:p,gz:d,roll:this.gyroXAngle,pitch:this.gyroYAngle,yaw:this.gyroZAngle}},i;Array.isArray(e.timestamp)?(i=e.timestamp.map((n,a)=>{if(t){let p=r(n,e.gx[a],e.gy[a],e.gz[a]);t.roll=t.roll*.04+p.roll*.96,t.pitch=t.pitch*.04+p.pitch*.96,t.yaw=i.yaw}else return r(n,e.gx[a],e.gy[a],e.gz[a])}),t||(t=i)):(i=r(e.timestamp,e.gx,e.gy,e.gz),t?(t.roll=t.roll*.04+i.roll*.96,t.pitch=t.pitch*.04+i.pitch*.96,t.yaw=i.yaw):t=i)}else(this.gyroXAngle||this.gyroYAngle||this.gyroZAngle)&&(t.roll=t.roll*.04+this.gyroXAngle*.96,t.pitch=t.pitch*.04+this.gyroYAngle*.96,t.yaw=this.gyroXAngle);if(t.ax){let r=(i,n)=>{let a=i-this.lastAccelTime;return this.lastAccelTime=i,this.px+=n.ax*a*a*Math.cos(this.pitch*Math.PI*.005555555555),this.py+=n.ay*a*a*Math.cos(this.roll*Math.PI*.005555555555),this.pz+=n.az*a*a*Math.sin(this.pitch*Math.PI*.005555555555),n.px=this.px,n.py=this.py,n.pz=this.pz,n};Array.isArray(e.timestamp)?e.timestamp.map((i,n)=>{r(i,t)}):r(e.timestamp,t)}return t}},df=class{constructor(e,t,r,i=1/Math.sqrt(2),n=0){if(this.a0=0,this.a1=0,this.a2=0,this.b0=0,this.b1=0,this.b2=0,this.x1=0,this.x2=0,this.y1=0,this.y2=0,["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"].indexOf(e)<0){console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'");return}this.type=e,this.freq=t,this.sps=r,this.Q=i,this.dbGain=n;let p=Math.pow(10,n/40),d=2*Math.PI*t/r,y=Math.sin(d),b=Math.cos(d),v=y/(2*i),h=Math.sqrt(p+p);this[e](p,y,b,v,h),this.b0/=this.a0,this.b1/=this.a0,this.b2/=this.a0,this.a1/=this.a0,this.a2/=this.a0}lowpass(e,t,r,i,n){this.b0=(1-r)*.5,this.b1=1-r,this.b2=(1-r)*.5,this.a0=1+i,this.a1=-2*r,this.a2=1-i}highpass(e,t,r,i,n){this.b0=(1+r)*.5,this.b1=-(1+r),this.b2=(1+r)*.5,this.a0=1+i,this.a1=-2*r,this.a2=1-i}bandpass(e,t,r,i,n){this.b0=i,this.b1=0,this.b2=-i,this.a0=1+i,this.a1=-2*r,this.a2=1-i}notch(e,t,r,i,n){this.b0=1,this.b1=-2*r,this.b2=1,this.a0=1+i,this.a1=-2*r,this.a2=1-i}peak(e,t,r,i,n){this.b0=1+i*e,this.b1=-2*r,this.b2=1-i*e,this.a0=1+i/e,this.a1=-2*r,this.a2=1-i/e}lowshelf(e,t,r,i,n){this.b0=e*(e+1-(e-1)*r+n*t),this.b1=2*e*(e-1-(e+1)*r),this.b2=e*(e+1-(e-1)*r-n*t),this.a0=e+1+(e+1)*r+n*t,this.a1=2*(e-1+(e+1)*r),this.a2=e+1+(e-1)*r-n*t}highshelf(e,t,r,i,n){this.b0=e*(e+1+(e-1)*r+n*t),this.b1=2*e*(e-1+(e+1)*r),this.b2=e*(e+1-(e-1)*r-n*t),this.a0=e+1-(e+1)*r-n*t,this.a1=2*(e-1-(e+1)*r),this.a2=e+1-(e-1)*r-n*t}applyFilter(e){let t=this.b0*e+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;return this.x2=this.x1,this.x1=e,this.y2=this.y1,this.y1=t,t}zResult(e){try{let t=Math.pow(Math.sin(Math.PI*e*2/(2*this.sps)),2);return(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*t+16*this.b0*this.b2*t*t)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*t+16*this.a2*t*t)}catch{return-200}}static calcCenterFrequency(e,t){return(e+t)/2}static calcBandwidth(e,t){return t-this.calcCenterFrequency(e,t)}static calcBandpassQ(e,t,r=Math.pow(10,Math.floor(Math.log10(e)))){return r*Math.sqrt((e-t)*(e+t))/(2*t)}static calcNotchQ(e,t,r=Math.pow(10,Math.floor(Math.log10(e)))){return r*e*t/Math.sqrt((e-t)*(e+t))}},va={refdata:[],lowpass:void 0,smoothed:[],timestamp:[],peaks:[],valleys:[],peak_distances:[],valley_distances:[],beats:[],lastPeak:0,lastValley:0,sps:100,maxFreq:4,limit:10,__onconnected:function(){if(!this.lowpass){let e=this.maxFreq;e||(e=1),e>1&&(e*=.5),this.lowpass=new df("lowpass",this.maxFreq,this.sps),this.peakFinderWindow=Math.floor(this.sps/this.maxFreq),this.peakFinderWindow%2===0&&(this.peakFinderWindow+=1),this.peakFinderWindow<5&&(this.peakFinderWindow=5),this.midpoint=Math.round(this.peakFinderWindow*.5)}},__operator:function(e){if(!("red"in e)&&!("heg"in e)&&!("raw"in e))return;let t=e.red?e.red:e.heg?e.heg:e.raw;if(!("timestamp"in e))if(Array.isArray(t)){let i=Date.now(),n;t&&(n=t.length);let a=[i-t.length*this.sps*1e3,i];e.timestamp=lt.upsample(a,t.length)}else e.timestamp=Date.now();let r=(i,n)=>{i&&this.refdata.push(i),this.timestamp.push(n);let a;if(this.refdata.length>this.peakFinderWindow&&(this.refdata.shift(),this.timestamp.shift()),this.smoothed.push(this.lowpass.applyFilter(this.refdata[this.refdata.length-1])),this.smoothed.length>this.peakFinderWindow&&this.smoothed.shift(),this.smoothed.length===this.peakFinderWindow&&(lt.isExtrema(this.smoothed,"valley")?this.valleys.push({value:this.smoothed[this.smoothed.length-this.midpoint?this.midpoint:1],timestamp:this.timestamp[this.timestamp.length-this.midpoint?this.midpoint:1]}):lt.isExtrema(this.smoothed,"peak")&&this.peaks.push({value:this.smoothed[this.smoothed.length-this.midpoint?this.midpoint:1],timestamp:this.timestamp[this.timestamp.length-this.midpoint?this.midpoint:1]}),this.valleys.length>2&&this.peaks.length>2)){if(this.valleys[this.valleys.length-1].timestamp<this.peaks[this.peaks.length-2].timestamp&&this.peaks.splice(this.peaks.length-1),this.peaks[this.peaks.length-1].timestamp<this.valleys[this.valleys.length-2].timestamp&&this.valleys.splice(this.valleys.length-1),this.valley_distances.push({distance:this.valleys[this.valleys.length-1].timestamp-this.valleys[this.valleys.length-2].timestamp,timestamp:this.valleys[this.valleys.length-1].timestamp,peak0:this.valleys[this.valleys.length-1].value,peak1:this.valleys[this.valleys.length-2].value}),this.peak_distances.push({distance:this.peaks[this.peaks.length-1].timestamp-this.peaks[this.peaks.length-2].timestamp,timestamp:this.peaks[this.peaks.length-1].timestamp,peak0:this.peaks[this.peaks.length-1].value,peak1:this.peaks[this.peaks.length-2].value}),this.peak_distances.length>1&&this.valley_distances.length>1&&this.lastPeak<this.peaks[this.peaks.length-1].timestamp&&this.lastValley<this.peaks[this.peaks.length-1].timestamp)if(this.valley_distances[this.valley_distances.length-1].timestamp>this.peak_distances[this.peak_distances.length-1].timestamp){let p,d=0;this.beats.length<1?p=60/(5e-4*(this.peak_distances[this.peak_distances.length-1].distance+this.valley_distances[this.valley_distances.length-1].distance)):this.beats[this.beats.length-1].timestamp!==this.peak_distances[this.peak_distances.length-1].timestamp&&(p=60/(5e-4*(this.peak_distances[this.peak_distances.length-1].dt+this.valley_distances[this.valley_distances.length-1].dt)),d=Math.abs(p-this.beats[this.beats.length-1].bpm)),a={timestamp:this.peak_distances[this.peak_distances.length-1].timestamp,change:d,bpm:p,height0:this.peak_distances[this.peak_distances.length-1].peak0-this.valley_distances[this.valley_distances.length-1].peak0,height1:this.peak_distances[this.peak_distances.length-1].peak1-this.valley_distances[this.valley_distances.length-1].peak1},this.beats.push(a),this.lastPeak=this.peaks[this.peaks.length-1].timestamp,this.lastValley=this.peaks[this.peaks.length-1].timestamp}else{let p,d=0;this.beats.length<2?p=60/(5e-4*(this.peak_distances[this.peak_distances.length-2].distance+this.valley_distances[this.valley_distances.length-2].distance)):this.beats[this.beats.length-1].timestamp!==this.peak_distances[this.peak_distances.length-2].timestamp&&(p=60/(5e-4*(this.peak_distances[this.peak_distances.length-2].distance+this.valley_distances[this.valley_distances.length-2].distance)),d=Math.abs(p-this.beats[this.beats.length-2].bpm)),a={timestamp:this.peak_distances[this.peak_distances.length-2].timestamp,change:d,bpm:p,height0:this.peak_distances[this.peak_distances.length-2].peak0-this.valley_distances[this.valley_distances.length-2].peak0,height1:this.peak_distances[this.peak_distances.length-2].peak1-this.valley_distances[this.valley_distances.length-2].peak1},this.beats.push(a),this.lastPeak=this.peaks[this.peaks.length-1].timestamp,this.lastValley=this.peaks[this.peaks.length-1].timestamp}this.peaks.length>this.limit&&this.peaks.shift(),this.valleys.length>this.limit&&this.valleys.shift(),this.peak_distances.length>this.limit&&this.peak_distances.shift(),this.valley_distances.length>this.limit&&this.valley_distances.shift(),this.beats.length>this.limit&&this.beats.shift()}return a};if(e.red){if("ir"in e&&!Array.isArray(e.red))return r(e.red+e.ir,e.timestamp);let i;return e.ir?i=e.red.map((n,a)=>r(n+e.ir[a],e.timestamp[a])):i=e.red.map((n,a)=>r(n,e.timestamp[a])),i}else{if(e.raw)return Array.isArray(e.raw)?e.raw.map((n,a)=>r(n,e.timestamp[a])):r(e.raw,e.timestamp);if(Array.isArray(e.heg))return Array.isArray(e.heg)?e.heg.map((n,a)=>r(n,e.timestamp[a])):r(e.heg,e.timestamp)}}},ih={sps:250,intervals:{},watch:["0"],tolerance:.2,__onconnected:e=>{e.watch.forEach(t=>e.intervals[t]={lowpass:new df("lowpass",20,e.sps),filtered:[],averaged:[]})},__operator:function(e){let t=5,r=50,i={},n=!1,a=(p,d)=>{let y=this.intervals[p].lowpass.applyFilter(d);if(this.intervals[p].filtered.push(y),this.intervals[p].averaged.push(y),this.intervals[p].filtered.length>t)if(this.intervals[p].averaged.length>r){this.intervals[p].averaged.splice(0,t);let b=lt.mean(this.intervals[p].averaged);Math.abs(Math.min(...this.intervals[p].filtered))>Math.abs(b)+this.tolerance&&(this.intervals[p].filtered.length=0,n=!0,i[p]=!0)}else this.intervals[p].filtered.shift()};for(let p in this.intervals)e[p]&&(Array.isArray(e[p])?e[p].forEach(d=>{a(p,d)}):typeof e[p]=="number"&&a(p,e[p]));if(n)return i}},$n=class{constructor(){this.recursivelyAssign=(e,t)=>{for(let r in t)typeof t[r]=="object"?typeof e[r]=="object"?this.recursivelyAssign(e[r],t[r]):e[r]=this.recursivelyAssign({},t[r]):e[r]=t[r];return e}}static autoscale(e,t=0,r=1,i=!1,n,a,p){if(e?.length===0)return e;let d=a||Math.max(...e),y=n||Math.min(...e),b=1/r,v=1;if(i){let h=Math.max(Math.abs(y),Math.abs(d));return h!==0&&(v=b/h),e.map(w=>(p&&(w<y&&(w=y),w>d&&(w=d)),w*v+(b*(t+1)*2-1-b)))}else return d===y?d!==0?v=b/d:y!==0&&(v=b/Math.abs(y)):v=b/(d-y),e.map(h=>(p&&(h<y&&(h=y),h>d&&(h=d)),2*((h-y)*v-1/(2*r))+(b*(t+1)*2-1-b)))}static genTimestamps(e,t){let r=Date.now(),i=[r-e*1e3/t,r];return $n.upsample(i,e)}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,r=1){if(e.length>t){let i=new Array(t),n=e.length/t,a=e.length-1,p=0,d=0;for(let y=n;y<e.length;y+=n){let b=Math.round(y);b>a&&(b=a);for(let v=p;v<b;v++)i[d]+=e[v];i[d]/=(b-p)*r,d++,p=b}return i}else return e}static upsample(e,t,r=1){var i=function(h,w,_){return(h+(w-h)*_)*r},n=new Array(t),a=(e.length-1)/(t-1);n[0]=e[0];for(var p=1;p<t-1;p++){var d=p*a,y=Math.floor(d),b=Math.ceil(d),v=d-y;n[p]=i(e[y],e[b],v)}return n[t-1]=e[e.length-1],n}static interpolate(e,t,r=1){return e.length>t?$n.downsample(e,t,r):e.length<t?$n.upsample(e,t,r):e}static HSLToRGB(e,t,r,i=255){t/=100,r/=100;let n=(1-Math.abs(2*r-1))*t,a=n*(1-Math.abs(e/60%2-1)),p=r-n/2,d=0,y=0,b=0;return 0<=e&&e<60?(d=n,y=a,b=0):60<=e&&e<120?(d=a,y=n,b=0):120<=e&&e<180?(d=0,y=n,b=a):180<=e&&e<240?(d=0,y=a,b=n):240<=e&&e<300?(d=a,y=0,b=n):300<=e&&e<360&&(d=n,y=0,b=a),d=(d+p)*i,y=(y+p)*i,b=(b+p)*i,[d,y,b]}static circularBuffer(e,t){if(t.length<e.length){let r=e.slice(t.length),i=e.length;e.splice(0,i,...r,...t)}else if(t.length>e.length){let r=e.length;e.splice(0,r,...t.slice(t.length-r))}else e.splice(0,e.length,...t);return e}static reformatData(e,t){if(Array.isArray(e)){if(Array.isArray(e[0])){let r={};if(e.forEach((i,n)=>{r[n]=i}),e=r,isNaN(e[0][0]))return}else if(t){if(e={[t]:e},isNaN(e[t][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let r in e)if(typeof e[r]=="number"?e[r]=[e[r]]:e[r]?.values&&typeof e[r].values=="number"&&(e[r].values=[e[r].values]),isNaN(e[r][0]))return}else if(typeof e=="string"){let r;if(e.includes(`\r
`)){let i=e.split(`\r
`);e={},i.forEach((n,a)=>{n.includes("	")?r=n.split("	"):n.includes(",")?r=n.split(","):n.includes("|")&&(r=n.split("|")),Array.isArray(r)&&r.forEach((p,d)=>{if(p.includes(":")){let[y,b]=p.split(":"),v=parseFloat(b);if(v)e[y]=[v];else return}else{let y=parseFloat(p);if(y)e[d]=[y];else return}})})}else e.includes("	")?r=e.split("	"):e.includes(",")?r=e.split(","):e.includes("|")&&(r=e.split("|"));e={},Array.isArray(r)&&r.forEach((i,n)=>{if(i.includes(":")){let[a,p]=i.split(":"),d=parseFloat(p);if(d)e[a]=[d];else return}else{let a=parseFloat(i);if(a)e[n]=[a];else return}})}else typeof e=="number"&&(t?e={[t]:[e]}:e={0:[e]});return e}static padTime(e,t,r,i){let n=(e[0]-t)/r/i;return[...new Array(i-e.length).map((p,d)=>t+n*(d+1)),...e]}static interpolateForTime(e,t,r){return $n.interpolate(e,Math.ceil(r*t))}isTypedArray(e){return ArrayBuffer.isView(e)&&Object.prototype.toString.call(e)!=="[object DataView]"}spliceTypedArray(e,t,r){let i=e.subarray(0,t),n;r&&(n=e.subarray(r+1));let a;return(i.length>0||n?.length>0)&&(a=new e.constructor(i.length+n.length)),i.length>0&&a.set(i),n&&n.length>0&&a.set(n,i.length),a}},pf=$n;pf.bufferValues=(e,t,r,i)=>{if(!Array.isArray(r)&&typeof r=="object"&&(r=Object.keys(r)),!i){let a=Object.keys(e);r?i=new Float32Array(a.length*r.length):typeof e[a[0]][t]=="object"?(r=Object.keys(e[a[0]][t]),i=new Float32Array(a.length*r.length)):i=new Float32Array(a.length)}let n=0;for(let a in e)if(e[a][t])if(r)for(let p=0;p<r.length;p++)i[n]=e[a][t][r[p]],n++;else i[n]=e[a][t],n++;return i};var nh=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/,sh=/([1-9]\d*)?([xcbB?hHiIfdsp])/g,wa=(e,t,r)=>String.fromCharCode(...new Uint8Array(e.buffer,e.byteOffset+t,r)),Sa=(e,t,r,i)=>new Uint8Array(e.buffer,e.byteOffset+t,r).set(i.split("").map(n=>n.charCodeAt(0))),oh=(e,t,r)=>wa(e,t+1,Math.min(e.getUint8(t),r-1)),ah=(e,t,r,i)=>{e.setUint8(t,i.length),Sa(e,t+1,r-1,i)},lh=e=>({x:t=>[1,t,0],c:t=>[t,1,r=>({u:i=>wa(i,r,1),p:(i,n)=>Sa(i,r,1,n)})],"?":t=>[t,1,r=>({u:i=>!!i.getUint8(r),p:(i,n)=>i.setUint8(r,n)})],b:t=>[t,1,r=>({u:i=>i.getInt8(r),p:(i,n)=>i.setInt8(r,n)})],B:t=>[t,1,r=>({u:i=>i.getUint8(r),p:(i,n)=>i.setUint8(r,n)})],h:t=>[t,2,r=>({u:i=>i.getInt16(r,e),p:(i,n)=>i.setInt16(r,n,e)})],H:t=>[t,2,r=>({u:i=>i.getUint16(r,e),p:(i,n)=>i.setUint16(r,n,e)})],i:t=>[t,4,r=>({u:i=>i.getInt32(r,e),p:(i,n)=>i.setInt32(r,n,e)})],I:t=>[t,4,r=>({u:i=>i.getUint32(r,e),p:(i,n)=>i.setUint32(r,n,e)})],f:t=>[t,4,r=>({u:i=>i.getFloat32(r,e),p:(i,n)=>i.setFloat32(r,n,e)})],d:t=>[t,8,r=>({u:i=>i.getFloat64(r,e),p:(i,n)=>i.setFloat64(r,n,e)})],s:t=>[1,t,r=>({u:i=>wa(i,r,t),p:(i,n)=>Sa(i,r,t,n.slice(0,t))})],p:t=>[1,t,r=>({u:i=>oh(i,r,t),p:(i,n)=>ah(i,r,t,n.slice(0,t-1))})]}),Vc=new RangeError("Structure larger than remaining buffer"),ch=new RangeError("Not enough values for structure"),Xi=class extends pf{static toDataView(e){if(!(e instanceof DataView))if(typeof e=="string"&&parseInt(e)&&(e=parseInt(e)),typeof e=="string"){let t=new TextEncoder,r={};for(let n in Xi.codes)for(;e.indexOf(n)>-1;){let a=e.indexOf(n);e=e.replace(n,""),r[a]=n}let i=Array.from(t.encode(e));for(let n in r)i.splice(parseInt(n),0,Xi.codes[r[n]]);e=new DataView(new Uint8Array(i).buffer)}else if(typeof e=="number"){let t=e;e<256?(e=new DataView(new ArrayBuffer(1)),e.setUint8(0,t)):e<65536?(e=new DataView(new ArrayBuffer(2)),e.setInt16(0,t)):(e=new DataView(new ArrayBuffer(4)),e.setUint32(0,t))}else e instanceof ArrayBuffer||typeof SharedArrayBuffer<"u"&&e instanceof SharedArrayBuffer?e=new DataView(e):Array.isArray(e)?e=new DataView(Uint8Array.from(e).buffer):typeof e=="object"&&(e=new TextEncoder().encode(JSON.stringify(e)));return e}static searchBuffer(e,t,r){for(var i=t,n=e,a=Xi.boyerMoore(i),p=a.byteLength,d=[],y=a(n);y!==-1&&(d.push(y),!(r&&d.length>=r));y=a(n,y+p));return d}static bytesToInt16(e,t){let r=(255&e)<<8|255&t;return(r&32768)>0?r|=4294901760:r&=65535,r}static bytesToUInt16(e,t){return e*256+t}static Uint16ToBytes(e){return[e&255,e>>8&255]}static bytesToInt24(e,t,r){let i=(255&e)<<16|(255&t)<<8|255&r;return(i&8388608)>0?i|=4278190080:i&=16777215,i}static bytesToUInt24(e,t,r){return e*65536+t*256+r}static Uint24ToBytes(e){return[e&255,e>>8&255,e>>16&255]}static bytesToInt32(e,t,r,i){let n=(255&e)<<24|(255&t)<<16|(255&r)<<8|255&i;return(n&2147483648)>0?n|=0:n&=4294967295,n}static bytesToUInt32(e,t,r,i){return e*16777216+t*65536+r*256+i}static Uint32ToBytes(e){return[e&255,e>>8&255,e>>16&255,e>>24&255]}static get2sCompliment(e,t){return e>4294967296?null:e<<32-t>>32-t}static getSignedInt(...e){let t=0;function r(i){for(var n=0,a=!0;i--;)if(a){let p=e[t++];n+=p&127,p&128&&(n-=128),a=!1}else n*=256,n+=e[t++];return n}return r(e.length)}static asUint8Array(e){if(e instanceof Uint8Array)return e;if(typeof e=="string"){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++){var i=e.charCodeAt(r);if(i>127)throw new TypeError("Only ASCII patterns are supported");t[r]=i}return t}else return new Uint8Array(e)}static boyerMoore(e){var t=Xi.asUint8Array(e),r=t.length;if(r===0)throw new TypeError("patternBuffer must be at least 1 byte long");for(var i=256,n=new Int32Array(i),a=0;a<i;a++)n[a]=-1;for(var p=0;p<r;p++)n[t[p]]=p;var d=(y,b,v)=>{var h=Xi.asUint8Array(y);b===void 0&&(b=0),v===void 0&&(v=h.length);for(var w=t,_=n,T=v-w.length,C=w.length-1,I,P=b;P<=T;P+=I){I=0;for(var U=C;U>=0;U--){var H=h[P+U];if(w[U]!==H){I=Math.max(1,U-_[H]);break}}if(I===0)return P}return-1};return d.byteLength=t.byteLength,d}static struct(e){let t=[],r=0,i=nh.exec(e);if(!i)throw new RangeError("Invalid format string");let n=lh(i[1]==="<"),a=(h,w)=>n[w](h?parseInt(h,10):1);for(;i=sh.exec(e);)((h,w,_)=>{for(let T=0;T<h;++T,r+=w)_&&t.push(_(r))})(...a(...i.slice(1)));let p=(h,w)=>{if(h.byteLength<(w|0)+r)throw Vc;let _=new DataView(h,w|0);return t.map(T=>T.u(_))},d=(h,w,..._)=>{if(_.length<t.length)throw ch;if(h.byteLength<w+r)throw Vc;let T=new DataView(h,w);new Uint8Array(h,w,r).fill(0),t.forEach((C,I)=>C.p(T,_[I]))},y=(...h)=>{let w=new ArrayBuffer(r);return d(w,0,...h),w},b=h=>p(h,0);function*v(h){for(let w=0;w+r<=h.byteLength;w+=r)yield p(h,w)}return Object.freeze({unpack:b,pack:y,unpack_from:p,pack_into:d,iter_unpack:v,format:e,size:r})}},Ta=Xi;Ta.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92};var fh={sps:250,nSec:1,watch:["0","1","2","3"],data:{},rms:{},__operator:function(e){return this.watch.forEach(t=>{e[t]&&(this.data[t]||(Array.isArray(e[t])?this.data[t]=new Array(Math.floor(this.sps*this.nSec)).fill(e[t][0]):this.data[t]=new Array(Math.floor(this.sps*this.nSec)).fill(e[t])),Ta.circularBuffer(this.data[t],e[t]))}),e.timestamp?Array.isArray(e.timestamp)?this.rms.timestamp=e.timestamp[e.timestamp.length-1]:this.rms.timestamp=e.timestamp:this.rms.timestamp=Date.now(),new Promise(async t=>{await Promise.all(this.watch.map(async r=>{this.data[r]?this.rms[r]=Math.sqrt(Math.abs(this.data[r].reduce((i,n,a)=>i+n*n)/this.data[r].length)):delete this.rms[r]})),t(this.rms)})}},uh={bufferSize:250,watch:["0","1","2","3"],data:{},blocking:!1,__onconnected:function(e){for(let t in e.watch)e.data[t]=new Array(e.bufferSize).fill(0)},__operator:function(e){let t=[];return this.watch.forEach(r=>{e[r]&&(Ta.circularBuffer(this.data[r],e[r]),t.push(this.data[r]))}),t}},dh={beat_detect:va,accel_gyro:rh,heartrate:va,breath:Object.assign({},va),blink_detect:ih,rms:fh,circularBuffer2d:uh};dh.breath.maxFreq=.2;var ph='(()=>{var mouseEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var wheelEventHandlerImpl=makeSendPropertiesHandler(["deltaX","deltaY"]);var keydownEventHandler=makeSendPropertiesHandler(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function focusEventHandler(event,sendFn){const data={type:event.type};data.isTrusted=event.isTrusted;data.bubbles=event.bubbles;data.cancelBubble=event.cancelBubble;data.cancelable=event.cancelable;data.composed=event.composed;data.defaultPrevent=event.defaultPrevented;data.eventPhase=event.eventPhase;data.returnValue=event.returnValue;data.currentTarget=event.currentTarget.id?event.currentTarget.id:event.currentTarget.constructor.name;data.target=data.currentTarget;data.srcElement=data.currentTarget;sendFn(data)}function wheelEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();wheelEventHandlerImpl(event,sendFn)}function preventDefaultHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault()}function copyProperties(src,properties,dst){for(const name of properties){dst[name]=src[name]}}function makeSendPropertiesHandler(properties){return function sendProperties(event,sendFn){const data={type:event.type};copyProperties(event,properties,data);sendFn(data)}}function touchEventHandler(event,sendFn,preventDefault){if(preventDefault&&event.preventDefault)event.preventDefault();const touches=[];const data={type:event.type,touches};for(let i2=0;i2<event.touches.length;++i2){const touch=event.touches[i2];touches.push({pageX:touch.pageX,pageY:touch.pageY})}sendFn(data)}var i=1;var keys={};while(i<222){keys[i]=true;i++}function filteredKeydownEventHandler(event,sendFn,preventDefault){let{keyCode}=event;if(keys[keyCode]){if(preventDefault&&event.preventDefault&&(keyCode<110||keyCode>123))event.preventDefault();keydownEventHandler(event,sendFn)}}var eventHandlers={contextmenu:preventDefaultHandler,mousedown:mouseEventHandler,mousemove:mouseEventHandler,mouseup:mouseEventHandler,pointerdown:mouseEventHandler,pointermove:mouseEventHandler,pointerup:mouseEventHandler,pointerlockchange:mouseEventHandler,webkitpointerlockchange:mouseEventHandler,focus:focusEventHandler,blur:focusEventHandler,pointerout:mouseEventHandler,touchstart:touchEventHandler,touchmove:touchEventHandler,touchend:touchEventHandler,wheel:wheelEventHandler,keydown:filteredKeydownEventHandler,keyup:filteredKeydownEventHandler};function initProxyElement(element,worker,id,preventDefault){if(!id)id="proxy"+Math.floor(Math.random()*1e15);const sendEvent=data=>{if(!worker){handleProxyEvent(data,id)}else worker.postMessage({route:"handleProxyEvent",args:[data,id]})};let entries=Object.entries(eventHandlers);for(const[eventName,handler]of entries){element.addEventListener(eventName,function(event){handler(event,sendEvent,preventDefault)})}if(eventHandlers.keydown){globalThis.addEventListener("keydown",function(ev){eventHandlers.keydown(ev,sendEvent,preventDefault)})}if(eventHandlers.keyup){globalThis.addEventListener("keyup",function(ev){eventHandlers.keyup(ev,sendEvent,preventDefault)})}const sendSize=()=>{const rect=element.getBoundingClientRect();sendEvent({type:"resize",left:rect.left,top:rect.top,width:element.clientWidth,height:element.clientHeight})};sendSize();globalThis.addEventListener("resize",sendSize);return id}var EventDispatcher=class{addEventListener(type,listener){if(this.__listeners===void 0)this.__listeners={};const listeners=this.__listeners;if(listeners[type]===void 0){listeners[type]=[]}if(listeners[type].indexOf(listener)===-1){listeners[type].push(listener)}}hasEventListener(type,listener){if(this.__listeners===void 0)return false;const listeners=this.__listeners;return listeners[type]!==void 0&&listeners[type].indexOf(listener)!==-1}removeEventListener(type,listener){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[type];if(listenerArray!==void 0){const index=listenerArray.indexOf(listener);if(index!==-1){listenerArray.splice(index,1)}}}dispatchEvent(event,target){if(this.__listeners===void 0)return;const listeners=this.__listeners;const listenerArray=listeners[event.type];if(listenerArray!==void 0){if(!target)event.target=this;else event.target=target;const array=listenerArray.slice(0);for(let i2=0,l=array.length;i2<l;i2++){array[i2].call(this,event)}}}};function noop(){}var ElementProxyReceiver=class extends EventDispatcher{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>{return{left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height}};this.handleEvent=data=>{if(data.type==="resize"){this.left=data.left;this.top=data.top;this.width=data.width;this.height=data.height;if(typeof this.proxied==="object"){this.proxied.style.width=this.width+"px";this.proxied.style.height=this.height+"px";this.proxied.clientWidth=this.width;this.proxied.clientHeight=this.height}}data.preventDefault=noop;data.stopPropagation=noop;this.dispatchEvent(data,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}};var ProxyManager=class{constructor(){this.targets={};this.makeProxy=(id,addTo=void 0)=>{if(!id)id=`proxyReceiver${Math.floor(Math.random()*1e15)}`;let proxy;if(this.targets[id])proxy=this.targets[id];else{proxy=new ElementProxyReceiver;this.targets[id]=proxy}if(typeof addTo==="object"){addTo.proxy=proxy;proxy.proxied=addTo;if(typeof WorkerGlobalScope!=="undefined")addTo.style=proxy.style;if(proxy.width){addTo.style.width=proxy.width+"px";addTo.clientWidth=proxy.width}if(proxy.height){addTo.style.height=proxy.height+"px";addTo.clientHeight=proxy.height}addTo.setPointerCapture=proxy.setPointerCapture.bind(proxy);addTo.releasePointerCapture=proxy.releasePointerCapture.bind(proxy);addTo.getBoundingClientRect=proxy.getBoundingClientRect.bind(proxy);addTo.addEventListener=proxy.addEventListener.bind(proxy);addTo.removeEventListener=proxy.removeEventListener.bind(proxy);addTo.handleEvent=proxy.handleEvent.bind(proxy);addTo.dispatchEvent=proxy.dispatchEvent.bind(proxy);addTo.focus=proxy.focus.bind(proxy);addTo.blur=proxy.blur.bind(proxy)}};this.getProxy=id=>{return this.targets[id]};this.handleEvent=(data,id)=>{if(!this.targets[id])this.makeProxy(id);if(this.targets[id]){this.targets[id].handleEvent(data);return true}return void 0};if(!globalThis.document)globalThis.document={elementFromPoint:(...args)=>{return this.targets[Object.keys(this.targets)[0]].proxied}}}};function makeProxy(id,elm){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;this.__node.graph.ProxyManager.makeProxy(id,elm)}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;globalThis.ProxyManager.makeProxy(id,elm)}return id}function handleProxyEvent(data,id){if(this?.__node?.graph){if(!this.__node.graph.ProxyManager)this.__node.graph.ProxyManager=new ProxyManager;if(this.__node.graph.ProxyManager.handleEvent(data,id))return data}else{if(!globalThis.ProxyManager)globalThis.ProxyManager=new ProxyManager;if(globalThis.ProxyManager.handleEvent(data,id))return data}}var proxyElementWorkerRoutes={initProxyElement,makeProxy,handleProxyEvent};function Renderer(options){if(options.worker){let worker=options.worker;let route=options.route;if(worker instanceof Blob||typeof worker==="string"){worker=new Worker(worker)}delete options.worker;delete options.route;return transferCanvas(worker,options,route)}else{initProxyElement(options.canvas,void 0,options._id,options.preventDefault);return setupCanvas(options)}}function transferCanvas(worker,options,route){console.log(options);if(!options)return void 0;if(!options._id)options._id=`canvas${Math.floor(Math.random()*1e15)}`;let offscreen=options.canvas.transferControlToOffscreen();if(!options.width)options.width=options.canvas.clientWidth;if(!options.height)options.height=options.canvas.clientHeight;let message={route:route?route:"setupCanvas",args:{...options,canvas:offscreen}};if(this?.__node?.graph)this.__node.graph.run("initProxyElement",options.canvas,worker,options._id,options.preventDefault);else initProxyElement(options.canvas,worker,options._id,options.preventDefault);if(options.draw){if(typeof options.draw==="function")message.args.draw=options.draw.toString();else message.args.draw=options.draw}if(options.update){if(typeof options.update==="function")message.args.update=options.update.toString();else message.args.update=options.update}if(options.init){if(typeof options.init==="function")message.args.init=options.init.toString();else message.args.init=options.init}if(options.clear){if(typeof options.clear==="function")message.args.clear=options.clear.toString();else message.args.clear=options.clear}let tr=[offscreen];if(options.transfer){tr.push(...options.transfer);delete options.transfer}worker.postMessage(message,tr);const canvascontrols={_id:options._id,width:options.width,height:options.height,worker,draw:(props,transfer)=>{worker.postMessage({route:"drawFrame",args:[props,options._id]},transfer)},update:(props,transfer)=>{worker.postMessage({route:"updateCanvas",args:[props,options._id]},transfer)},clear:()=>{worker.postMessage({route:"clearCanvas",args:options._id})},init:()=>{worker.postMessage({route:"initCanvas",args:options._id})},stop:()=>{worker.postMessage({route:"stopAnim",args:options._id})},start:()=>{worker.postMessage({route:"startAnim",args:options._id})},set:(newDrawProps,transfer)=>{worker.postMessage({route:"setDraw",args:[newDrawProps,options._id]},transfer)},terminate:()=>{worker.terminate()}};return canvascontrols}function setDraw(settings,_id){let canvasopts;if(this?.__node?.graph){if(_id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else if(settings._id)canvasopts=this.__node.graph.CANVASES?.[settings._id];else canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]}else{if(_id)canvasopts=globalThis.CANVASES?.[settings._id];else if(settings._id)canvasopts=globalThis.CANVASES?.[settings._id];else canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]]}if(canvasopts){if(settings.canvas){canvasopts.canvas=settings.canvas;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasopts._id,canvasopts.canvas);else proxyElementWorkerRoutes.makeProxy(canvasopts._id,canvasopts.canvas)}if(typeof settings.context==="string")canvasopts.context=canvasopts.canvas.getContext(settings.context);else if(settings.context)canvasopts.context=settings.context;if(settings.width)canvasopts.canvas.width=settings.width;if(settings.height)canvasopts.canvas.height=settings.height;if(typeof settings.draw==="string")settings.draw=parseFunctionFromText(settings.draw);if(typeof settings.draw==="function"){canvasopts.draw=settings.draw.bind(settings)}if(typeof settings.update==="string")settings.update=parseFunctionFromText(settings.update);if(typeof settings.update==="function"){canvasopts.update=settings.update.bind(settings)}if(typeof settings.init==="string")settings.init=parseFunctionFromText(settings.init);if(typeof settings.init==="function"){canvasopts.init=settings.init.bind(settings)}if(typeof settings.clear==="string")settings.clear=parseFunctionFromText(settings.clear);if(typeof settings.clear==="function"){canvasopts.clear=settings.clear.bind(settings)}return settings._id}return void 0}function setupCanvas(options){if(this?.__node?.graph){if(!this.__node.graph.CANVASES)this.__node.graph.CANVASES={}}else if(!globalThis.CANVASES)globalThis.CANVASES={};let canvasOptions=options;options._id?canvasOptions._id=options._id:canvasOptions._id=`canvas${Math.floor(Math.random()*1e15)}`;typeof options.context==="string"?canvasOptions.context=options.canvas.getContext(options.context):canvasOptions.context=options.context;"animating"in options?canvasOptions.animating=options.animating:canvasOptions.animating=true;if(this?.__node?.graph?.CANVASES[canvasOptions._id]){this.__node.graph.run("setDraw",canvasOptions)}else if(globalThis.CANVASES?.[canvasOptions._id]){setDraw(canvasOptions)}else{if(this?.__node?.graph){canvasOptions.graph=this.__node.graph;if(!canvasOptions.__node){canvasOptions.__node={}}if(!canvasOptions.__node.tag)canvasOptions.__node.tag=canvasOptions._id;canvasOptions=this.__node.graph.add(canvasOptions);canvasOptions.__addOndisconnected=()=>{canvasOptions.stop();delete this.__node.graph.CANVASES[canvasOptions._id]}}if(this?.__node?.graph)this.__node.graph.CANVASES[canvasOptions._id]=canvasOptions;else globalThis.CANVASES[canvasOptions._id]=canvasOptions;if(this?.__node?.graph)this.__node.graph.run("makeProxy",canvasOptions._id,canvasOptions.canvas);else proxyElementWorkerRoutes.makeProxy(canvasOptions._id,canvasOptions.canvas);if(options.width)canvasOptions.canvas.width=options.width;if(options.height)canvasOptions.canvas.height=options.height;if(typeof canvasOptions.draw==="string"){canvasOptions.draw=parseFunctionFromText(canvasOptions.draw)}else if(typeof canvasOptions.draw==="function"){canvasOptions.draw=canvasOptions.draw.bind(canvasOptions)}if(typeof canvasOptions.update==="string"){canvasOptions.update=parseFunctionFromText(canvasOptions.update)}else if(typeof canvasOptions.update==="function"){canvasOptions.update=canvasOptions.update.bind(canvasOptions)}if(typeof canvasOptions.init==="string"){canvasOptions.init=parseFunctionFromText(canvasOptions.init)}else if(typeof canvasOptions.init==="function"){canvasOptions.init=canvasOptions.init.bind(canvasOptions)}if(typeof canvasOptions.clear==="string"){canvasOptions.clear=parseFunctionFromText(canvasOptions.clear)}else if(typeof canvasOptions.clear==="function"){canvasOptions.clear=canvasOptions.clear.bind(canvasOptions)}if(typeof canvasOptions.init==="function")canvasOptions.init(canvasOptions,canvasOptions.canvas,canvasOptions.context);canvasOptions.stop=()=>{stopAnim(canvasOptions._id)};canvasOptions.start=draw=>{startAnim(canvasOptions._id,draw)};canvasOptions.set=settings=>{setDraw(settings,canvasOptions._id)};if(typeof canvasOptions.draw==="function"&&canvasOptions.animating){let draw=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw(s,canvas,context)})}};draw(canvasOptions,canvasOptions.canvas,canvasOptions.context)}}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)return canvasOptions._id;else{const canvascontrols={_id:options._id,width:options.width,height:options.height,draw:props=>{drawFrame(props,options._id)},update:props=>{updateCanvas(props,options._id)},clear:()=>{clearCanvas(options._id)},init:()=>{initCanvas(options._id)},stop:()=>{stopAnim(options._id)},start:()=>{startAnim(options._id)},set:newDrawProps=>{setDraw(newDrawProps,options._id)},terminate:()=>{if(this.__node?.graph)this.__node.graph.remove(options._id);else{stopAnim(options._id);if(this?.__node?.graph)delete this.__node.graph.CANVASES[canvasOptions._id];else delete globalThis.CANVASES[canvasOptions._id]}}};return canvascontrols}}function drawFrame(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){if(props)Object.assign(canvasopts,props);if(canvasopts.draw){canvasopts.draw(canvasopts,canvasopts.canvas,canvasopts.context);return _id}}return void 0}function clearCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.clear){canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function initCanvas(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.init){canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function updateCanvas(input,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts?.update){canvasopts.update(canvasopts,canvasopts.canvas,canvasopts.context,input);return _id}return void 0}function setProps(props,_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){Object.assign(canvasopts,props);if(props.width)canvasopts.canvas.width=props.width;if(props.height)canvasopts.canvas.height=props.height;return _id}return void 0}function startAnim(_id,draw){let canvasopts=getCanvas.call(this,_id);canvasopts.animating=true;if(canvasopts&&draw){if(typeof draw==="string")draw=parseFunctionFromText(draw);if(typeof draw==="function"){canvasopts.draw=draw}return _id}if(typeof canvasopts?.draw==="function"){let draw2=(s,canvas,context)=>{if(s.animating){s.draw(s,canvas,context);requestAnimationFrame(()=>{draw2(s,canvas,context)})}};if(typeof canvasopts.clear==="function")canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context);if(typeof canvasopts.init==="function")canvasopts.init(canvasopts,canvasopts.canvas,canvasopts.context);draw2(canvasopts,canvasopts.canvas,canvasopts.context);return _id}return void 0}function stopAnim(_id){let canvasopts=getCanvas.call(this,_id);if(canvasopts){canvasopts.animating=false;if(typeof canvasopts.clear==="function")requestAnimationFrame(canvasopts.clear(canvasopts,canvasopts.canvas,canvasopts.context));return _id}return void 0}function getCanvas(_id){let canvasopts;if(this?.__node?.graph){if(!_id)canvasopts=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]];else canvasopts=this.__node.graph.CANVASES?.[_id]}else{if(!_id)canvasopts=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]];else canvasopts=globalThis.CANVASES?.[_id]}return canvasopts}var workerCanvasRoutes={...proxyElementWorkerRoutes,Renderer,transferCanvas,setupCanvas,setDraw,drawFrame,clearCanvas,initCanvas,updateCanvas,setProps,startAnim,stopAnim,getCanvas};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.split("(")[1].split(")")[0];newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(newFuncHead+newFuncBody+"}")}catch{}}}return newFunc}var v=class{constructor(e,t,s,h){this.r=e,this.g=t,this.b=s,this.a=h}};var A=class{constructor(){this.scaleX=1,this.scaleY=1,this.offsetX=0,this.offsetY=0,this.loop=false,this._vbuffer=0,this._coord=0,this.visible=true,this.intensity=1,this.xy=new Float32Array([]),this.numPoints=0,this.color=new v(0,0,0,1),this.webglNumPoints=0}};var d=class extends A{constructor(e,t){super(),this.currentIndex=0,this.webglNumPoints=t,this.numPoints=t,this.color=e,this.xy=new Float32Array(2*this.webglNumPoints)}setX(e,t){this.xy[e*2]=t}setY(e,t){this.xy[e*2+1]=t}getX(e){return this.xy[e*2]}getY(e){return this.xy[e*2+1]}lineSpaceX(e,t){for(let s=0;s<this.numPoints;s++)this.setX(s,e+t*s)}arrangeX(){this.lineSpaceX(-1,2/this.numPoints)}constY(e){for(let t=0;t<this.numPoints;t++)this.setY(t,e)}shiftAdd(e){let t=e.length;for(let s=0;s<this.numPoints-t;s++)this.setY(s,this.getY(s+t));for(let s=0;s<t;s++)this.setY(s+this.numPoints-t,e[s])}addArrayY(e){if(this.currentIndex+e.length<=this.numPoints)for(let t=0;t<e.length;t++)this.setY(this.currentIndex,e[t]),this.currentIndex++}replaceArrayY(e){if(e.length==this.numPoints)for(let t=0;t<this.numPoints;t++)this.setY(t,e[t])}};var M=(c,e,t)=>{let s={x:0,y:0};return s.x=c.x+e.x*t,s.y=c.y+e.y*t,s};var P=c=>Y(-c.y,c.x);var x=(c,e)=>{let t=T(c,e);return t=S(t),t};var C=(c,e)=>{let t={x:0,y:0};return t.x=c.x+e.x,t.y=c.y+e.y,t};var R=(c,e)=>c.x*e.x+c.y*e.y;var S=c=>{let e={x:0,y:0},t=c.x*c.x+c.y*c.y;return t>0&&(t=1/Math.sqrt(t),e.x=c.x*t,e.y=c.y*t),e};var Y=(c,e)=>{let t={x:0,y:0};return t.x=c,t.y=e,t};var T=(c,e)=>{let t={x:0,y:0};return t.x=c.x-e.x,t.y=c.y-e.y,t};var F=c=>{let e,t={x:0,y:0},s={x:0,y:0},h=[],o=(n,l)=>{h.push({vec2:n,miterLength:l})},a=n=>({x:c[n*2],y:c[n*2+1]});t=x(a(1),a(0)),e=P(t),o(e,1);let r=c.length/2;for(let n=1;n<r-1;n++){let l=a(n-1),i2=a(n),u=a(n+1);t=x(i2,l),e=P(t),s=x(u,i2);let g=N(t,s),f=X(t,g,1);o(g,f)}return t=x(a(r-1),a(r-2)),e=P(t),o(e,1),h};var N=(c,e)=>{let t=C(c,e);return t=S(t),Y(-t.y,t.x)};var X=(c,e,t)=>{let s=Y(-c.y,c.x);return t/R(e,s)};var p=class extends A{constructor(e,t,s){super(),this.currentIndex=0,this._thicknessRequested=0,this._actualThickness=0,this.webglNumPoints=t*2,this.numPoints=t,this.color=e,this._thicknessRequested=s,this._linePoints=new Float32Array(t*2),this.xy=new Float32Array(2*this.webglNumPoints)}convertToTriPoints(){let e=this._actualThickness/2,t=F(this._linePoints);for(let s=0;s<this.numPoints;s++){let h=this._linePoints[2*s],o=this._linePoints[2*s+1],a={x:h,y:o},r=M(a,t[s].vec2,t[s].miterLength*e),n=M(a,t[s].vec2,-t[s].miterLength*e);this.xy[s*4]=r.x,this.xy[s*4+1]=r.y,this.xy[s*4+2]=n.x,this.xy[s*4+3]=n.y}}setX(e,t){this._linePoints[e*2]=t}setY(e,t){this._linePoints[e*2+1]=t}lineSpaceX(e,t){for(let s=0;s<this.numPoints;s++)this.setX(s,e+t*s)}setThickness(e){this._thicknessRequested=e}getThickness(){return this._thicknessRequested}setActualThickness(e){this._actualThickness=e}};var L=class{constructor(e,t){this.debug=false,this.addLine=this.addDataLine,t==null?this.webgl=e.getContext("webgl",{antialias:true,transparent:false}):(this.webgl=e.getContext("webgl",{antialias:t.antialias,transparent:t.transparent,desynchronized:t.deSync,powerPerformance:t.powerPerformance,preserveDrawing:t.preserveDrawing}),this.debug=t.debug==null?false:t.debug),this.log("canvas type is: "+e.constructor.name),this.log(`[webgl-plot]:width=${e.width}, height=${e.height}`),this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[],this.gScaleX=1,this.gScaleY=1,this.gXYratio=1,this.gOffsetX=0,this.gOffsetY=0,this.gLog10X=false,this.gLog10Y=false,this.webgl.clear(this.webgl.COLOR_BUFFER_BIT),this.webgl.viewport(0,0,e.width,e.height),this._progLine=this.webgl.createProgram(),this.initThinLineProgram(),this.webgl.enable(this.webgl.BLEND),this.webgl.blendFunc(this.webgl.SRC_ALPHA,this.webgl.ONE_MINUS_SRC_ALPHA)}get linesData(){return this._linesData}get linesAux(){return this._linesAux}get thickLines(){return this._thickLines}get surfaces(){return this._surfaces}_drawLines(e){let t=this.webgl;e.forEach(s=>{if(s.visible){t.useProgram(this._progLine);let h=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(h,false,new Float32Array([s.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,s.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let o=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(o,new Float32Array([s.offsetX+this.gOffsetX,s.offsetY+this.gOffsetY]));let a=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let r=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(r,[s.color.r,s.color.g,s.color.b,s.color.a]),t.bufferData(t.ARRAY_BUFFER,s.xy,t.STREAM_DRAW),t.drawArrays(s.loop?t.LINE_LOOP:t.LINE_STRIP,0,s.webglNumPoints)}})}_drawSurfaces(e){let t=this.webgl;e.forEach(s=>{if(s.visible){t.useProgram(this._progLine);let h=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(h,false,new Float32Array([s.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,s.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let o=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(o,new Float32Array([s.offsetX+this.gOffsetX,s.offsetY+this.gOffsetY]));let a=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(a,new Int32Array([this.gLog10X?1:0,this.gLog10Y?1:0]));let r=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(r,[s.color.r,s.color.g,s.color.b,s.color.a]),t.bufferData(t.ARRAY_BUFFER,s.xy,t.STREAM_DRAW),t.drawArrays(t.TRIANGLE_STRIP,0,s.webglNumPoints)}})}_drawTriangles(e){let t=this.webgl;t.bufferData(t.ARRAY_BUFFER,e.xy,t.STREAM_DRAW),t.useProgram(this._progLine);let s=t.getUniformLocation(this._progLine,"uscale");t.uniformMatrix2fv(s,false,new Float32Array([e.scaleX*this.gScaleX*(this.gLog10X?1/Math.log(10):1),0,0,e.scaleY*this.gScaleY*this.gXYratio*(this.gLog10Y?1/Math.log(10):1)]));let h=t.getUniformLocation(this._progLine,"uoffset");t.uniform2fv(h,new Float32Array([e.offsetX+this.gOffsetX,e.offsetY+this.gOffsetY]));let o=t.getUniformLocation(this._progLine,"is_log");t.uniform2iv(o,new Int32Array([0,0]));let a=t.getUniformLocation(this._progLine,"uColor");t.uniform4fv(a,[e.color.r,e.color.g,e.color.b,e.color.a]),t.drawArrays(t.TRIANGLE_STRIP,0,e.xy.length/2)}_drawThickLines(){this._thickLines.forEach(e=>{if(e.visible){let t=Math.min(this.gScaleX,this.gScaleY);e.setActualThickness(e.getThickness()/t),e.convertToTriPoints(),this._drawTriangles(e)}})}update(){this.clear(),this.draw()}draw(){this._drawLines(this.linesData),this._drawLines(this.linesAux),this._drawThickLines(),this._drawSurfaces(this.surfaces)}clear(){this.webgl.clear(this.webgl.COLOR_BUFFER_BIT)}_addLine(e){e._vbuffer=this.webgl.createBuffer(),this.webgl.bindBuffer(this.webgl.ARRAY_BUFFER,e._vbuffer),this.webgl.bufferData(this.webgl.ARRAY_BUFFER,e.xy,this.webgl.STREAM_DRAW),e._coord=this.webgl.getAttribLocation(this._progLine,"coordinates"),this.webgl.vertexAttribPointer(e._coord,2,this.webgl.FLOAT,false,0,0),this.webgl.enableVertexAttribArray(e._coord)}addDataLine(e){this._addLine(e),this.linesData.push(e)}addAuxLine(e){this._addLine(e),this.linesAux.push(e)}addThickLine(e){this._addLine(e),this._thickLines.push(e)}addSurface(e){this._addLine(e),this.surfaces.push(e)}initThinLineProgram(){let e=`\n      attribute vec2 coordinates;\n      uniform mat2 uscale;\n      uniform vec2 uoffset;\n      uniform ivec2 is_log;\n\n      void main(void) {\n         float x = (is_log[0]==1) ? log(coordinates.x) : coordinates.x;\n         float y = (is_log[1]==1) ? log(coordinates.y) : coordinates.y;\n         vec2 line = vec2(x, y);\n         gl_Position = vec4(uscale*line + uoffset, 0.0, 1.0);\n      }`,t=this.webgl.createShader(this.webgl.VERTEX_SHADER);this.webgl.shaderSource(t,e),this.webgl.compileShader(t);let s=`\n         precision mediump float;\n         uniform highp vec4 uColor;\n         void main(void) {\n            gl_FragColor =  uColor;\n         }`,h=this.webgl.createShader(this.webgl.FRAGMENT_SHADER);this.webgl.shaderSource(h,s),this.webgl.compileShader(h),this._progLine=this.webgl.createProgram(),this.webgl.attachShader(this._progLine,t),this.webgl.attachShader(this._progLine,h),this.webgl.linkProgram(this._progLine)}popDataLine(){this.linesData.pop()}removeAllLines(){this._linesData=[],this._linesAux=[],this._thickLines=[],this._surfaces=[]}removeDataLines(){this._linesData=[]}removeAuxLines(){this._linesAux=[]}viewport(e,t,s,h){this.webgl.viewport(e,t,s,h)}log(e){this.debug&&console.log("[webgl-plot]:"+e)}};var y=class{constructor(){this.plots={}}initPlot(e,t){if(t||(t=new L(e.canvas,e.webglOptions)),!e._id)e._id=`plot${Math.floor(Math.random()*1e15)}`;else if(this.plots[e._id]){let l=this.plots[e._id].initial;if(e.lines){for(let i2 in e.lines)if(l.lines[i2]&&Array.isArray(e.lines[i2])){let u=e.lines[i2];e.lines[i2]=l.lines[i2]}}e=Object.assign(l,e)}e.overlay&&(typeof e.overlay!="object"&&(e.overlay=document.createElement("canvas"),e.overlay.style.position="absolute",e.overlay.width=e.canvas.width,e.overlay.height=e.canvas.height,e.canvas.appendChild(e.overlay)),e.overlayCtx||(e.overlayCtx=e.overlay.getContext("2d"))),e.width&&(e.canvas.width=e.width,e.canvas.style&&(e.canvas.style.width=e.width+"px"),typeof e.overlay=="object"&&(e.overlay.width=e.width,e.overlay.style&&(e.overlay.style.width=e.width+"px"))),e.height&&(e.canvas.height=e.height,e.canvas.style&&(e.canvas.style.height=e.height+"px"),typeof e.overlay=="object"&&(e.overlay.height=e.height,e.overlay.style&&(e.overlay.style.height=e.height+"px"))),e.lines?.timestamp&&delete e.lines.timestamp,e.lines||(e.lines={});let s={};for(let l in e.lines)s[l]=Object.assign({},s[l]),"viewing"in e.lines[l]||(e.lines[l].viewing=true),s[l].viewing=e.lines[l].viewing,s[l].sps=e.lines[l].sps,s[l].nSec=e.lines[l].nSec,s[l].nPoints=e.lines[l].nPoints,s[l].ymin=e.lines[l].ymin,s[l].ymax=e.lines[l].ymax,s[l].units=e.lines[l].units;let h={plot:t,settings:e,initial:Object.assign(Object.assign({},e),{lines:s}),anim:()=>{t.update()}};this.plots[e._id]=h;let o=0,a=0;Object.keys(e.lines).forEach(l=>{e.lines[l]?.viewing!==false&&a++}),e.nLines=a;let r,n;typeof e.overlay=="object"&&(r=e.overlay,n=e.overlayCtx,n.clearRect(0,0,e.overlay.width,e.overlay.height),n.font=e.overlayFont?e.overlayFont:"1em Courier",n.fillStyle=e.overlayColor?e.overlayColor:"white");for(let l in e.lines){let i2=e.lines[l];if(Array.isArray(i2)&&(i2={values:i2},e.lines[l]=i2),"viewing"in i2||(i2.viewing=true),i2.color)Array.isArray(i2.color)&&(i2.color=new v(...i2.color));else{let m=y.HSLToRGB(360*(o/a)%360,100,50,1);h.initial.lines[l].color=[...m,1],i2.color=new v(...m,1)}let u;if(i2.nSec&&i2.sps?u=Math.ceil(i2.nSec*i2.sps):i2.nPoints?u=i2.nPoints:i2.points?u=i2.points:e.linePoints?u=e.linePoints:i2.values?u=i2.values.length:u=1e3,i2.points=u,e.lines[l].viewing===false)continue;if((i2.width||e.lineWidth)&&i2.width!==0){let m=e.lineWidth;m||(m=i2.width),i2.width?i2.line=new p(i2.color,u,i2.width):e.lineWidth&&(i2.line=new p(i2.color,u,e.lineWidth)),i2.line.lineSpaceX(-1,2/i2.line.numPoints)}else i2.line=new d(i2.color,u),i2.line.arrangeX();i2.values?.length===i2.points?i2.values.length!==u&&(i2.interpolate?i2.values.length>u?i2.values=y.downsample(i2.values,u):i2.values.length<u&&(i2.values=y.upsample(i2.values,u)):i2.values.length>i2.points?i2.values=i2.values.slice(i2.values.length-i2.points):i2.values=[...new Array(i2.points-i2.values.length).fill(0),...i2.values]):Array.isArray(i2.values)?i2.values.length>u?i2.values=i2.values.slice(i2.values.length-u):i2.values.length<u&&(i2.values=[...new Array(u-i2.values.length).fill(0),...i2.values]):i2.values=new Array(i2.points).fill(0);let g=i2.ymin,f=i2.ymax,b=i2.values.length<=1e5;if(g===f?(f=b?Math.max(...i2.values):1,g=b?Math.min(...i2.values):0):isNaN(f)&&(f=b?Math.max(...i2.values):1),isNaN(g)&&(g=b?Math.min(...i2.values):0),g>f){let m=g;f=g,g=m}let w=Math.abs(g);if(i2.absmax=w>f?w:f,"autoscale"in i2||(i2.autoscale=true),i2.position||(i2.position=e.nLines-o-1),i2.autoscale?i2.autoscale===2?("clamp"in i2||(i2.clamp=true),i2.scaled=y.autoscale(i2.values,i2.position,a,i2.centerZero,g,f,i2.clamp)):(i2.scaled=i2.values,i2.line.scaleY=y.getYScalar(i2.values,a,i2.centerZero,g,f),i2.line.offsetY=y.getYOffset(i2.position,a,g,i2.line.scaleY)):i2.scaled=i2.values,i2.scaled.forEach((m,_)=>i2.line.setY(_,m)),i2.line instanceof p?t.addThickLine(i2.line):i2.line instanceof d&&t.addDataLine(i2.line),"xAxis"in i2||(i2.xAxis=true),i2.xAxis){i2.xColor?Array.isArray(i2.xColor)&&(i2.xColor=new v(...i2.xColor)):i2.xColor=new v(1,1,1,.3);let m=new d(i2.xColor,2),_=i2.autoscale?(o+1)*2/a-1-1/a:0;m.constY(_),m.arrangeX(),m.xy[2]=1,i2.x=m,t.addAuxLine(m)}if(a>1&&i2.autoscale&&o!==a-1){e.dividerColor?Array.isArray(e.dividerColor)&&(e.dividerColor=new v(...e.dividerColor)):e.dividerColor=new v(1,1,1,1);let m=new d(e.dividerColor,2);m.constY(i2.autoscale?(o+1)*2/a-1:1),m.arrangeX(),m.xy[2]=1,i2.divider=m,t.addAuxLine(m)}if(typeof e.overlay=="object"&&(i2.useOverlay||!("useOverlay"in i2))){let m=e.nLines-i2.position-1;n.fillText(l,20,r.height*(m+.2)/e.nLines),n.fillText(`${Math.floor(f)===f?f:f?.toFixed(5)} ${i2.units?i2.units:""}`,r.width-100,r.height*(m+.2)/e.nLines),n.fillText(`${Math.floor(g)===g?g:g?.toFixed(5)} ${i2.units?i2.units:""}`,r.width-100,r.height*(m+.9)/e.nLines)}o++}return requestAnimationFrame(h.anim),this.plots[e._id]}deinitPlot(e){return typeof e=="string"&&(e=this.plots[e]),e.plot.clear(),e.plot.removeAllLines(),true}reinitPlot(e,t){if(typeof e=="string"){let s=e;e=this.plots[e],t._id||(t._id=s)}if(e.plot)return e.plot.clear(),e.plot.removeAllLines(),e.settings.overlayCtx&&e.settings.overlayCtx.clearRect(0,0,e.settings.overlay?.width,e.settings.overlay?.height),this.initPlot(t,e.plot)}getChartSettings(e,t){let s=this.plots[e];if(s){let h=Object.assign({},s.initial);for(let o in s.initial.lines)typeof s.initial.lines[o]?.ymax!="number"&&(h.lines[o].ymax=s.settings.lines[o]?.ymax),typeof s.initial.lines[o]?.ymin!="number"&&(h.lines[o].ymin=s.settings.lines[o]?.ymin),t&&(h.lines[o].values=s.settings.lines[o].values);return delete h.canvas,delete h.overlay,delete h.overlayCtx,h}}update(e,t,s=true){if(typeof e=="string"&&(e=this.plots[e]),!e)return false;if(t){let h=false,o,a;typeof e.settings.overlay=="object"&&(o=e.settings.overlay,a=e.settings.overlayCtx,a.font=e.settings.overlayFont?e.settings.overlayFont:"1em Courier",a.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white");for(let r in t)if(e.settings.lines[r]&&e.settings.lines[r].line){if(e.settings.lines[r]?.viewing===false)continue;let n=e.settings.lines[r];if(n.values){if(e.settings.mode&&e.settings.mode==="sweep"){"ct"in n||(n.ct=0);let f=b=>{n.ct>n.values.length&&(n.ct=0),n.values[n.ct]=b,n.ct++};Array.isArray(t[r])?t[r].forEach(f):typeof t[r]=="number"?f(t[r]):t[r].values&&t[r].values.forEach(f)}else Array.isArray(t[r])&&n.values?.length<1e5?(n.values.length===0&&(n.values.length=n.points?n.points:1e3),t[r].length===n.values.length?n.values=t[r]:y.circularBuffer(n.values,t[r])):typeof t[r]=="number"?(n.values.push(t[r]),n.values.shift()):t[r]?.values&&(n.values.length===0&&(n.values.length=n.points?n.points:1e3),t[r].values.length===n.values.length?n.values=t[r].values:y.circularBuffer(n.values,t[r].values));n.values.length!==n.points&&(n.interpolate?n.values.length>n.points?n.values=y.downsample(n.values,n.points):n.scaled.length<n.points&&(n.values=y.upsample(n.values,n.points)):n.values.length>n.points?n.values.splice(0,n.values.length-n.points):n.values=new Array(n.points).fill(0).splice(n.points-n.values.length,0,n.values));let l=n.ymin,i2=n.ymax,u=n.values.length<=1e5;if(l===i2?(i2=u?Math.max(...n.values):1,l=u?Math.min(...n.values):0):isNaN(i2)&&(i2=u?Math.max(...n.values):1),isNaN(l)&&(l=u?Math.min(...n.values):0),l>i2){let f=l;i2=l,l=f}let g=Math.abs(l);if(n.absmax=g>i2?g:i2,n.autoscale?n.autoscale===2?n.scaled=y.autoscale(n.values,n.position,e.settings.nLines,n.centerZero,l,i2,n.clamp):(n.scaled=n.values,n.line.scaleY=y.getYScalar(n.values,e.settings.nLines,n.centerZero,l,i2),n.line.offsetY=y.getYOffset(n.position,e.settings.nLines,l,n.line.scaleY)):n.scaled=n.values,n.scaled.forEach((f,b)=>{!n.autoscale&&n.absmax>1?n.line.setY(b,f/n.absmax):n.line.setY(b,f)}),typeof e.settings.overlay=="object"&&(n.useOverlay||!("useOverlay"in n))){let f=e.settings.nLines-n.position-1,b=o.height*f/e.settings.nLines,w=o.height/e.settings.nLines;if(a.clearRect(0,b,o.width,w),e.settings.mode&&e.settings.mode==="sweep"){a.fillStyle=e.settings.sweepColor?e.settings.sweepColor:"rgba(0,255,0,0.25)",a.beginPath();let m=o.width*n.ct/n.values.length;a.moveTo(m,b),a.lineTo(m,w),a.stroke()}a.fillStyle=e.settings.overlayColor?e.settings.overlayColor:"white",a.fillText(r,20,o.height*(f+.2)/e.settings.nLines),a.fillText(`${Math.floor(i2)===i2?i2:i2?.toFixed(5)} ${n.units?n.units:""}`,o.width-100,o.height*(f+.2)/e.settings.nLines),a.fillText(`${Math.floor(l)===l?l:l?.toFixed(5)} ${n.units?n.units:""}`,o.width-100,o.height*(f+.9)/e.settings.nLines)}}}else e.settings.generateNewLines&&!r.includes("timestamp")&&(Array.isArray(t[r])&&(t[r]={values:t[r]}),!t[r].nSec&&!t[r].nPoints&&!e.settings.linePoints&&(t[r].nPoints=1e3),h=true);if(h)return e.settings.cleanGeneration||Object.keys(e.initial.lines).forEach(r=>{t[r]?t[r]=Object.assign(e.initial.lines[r],t[r]):t[r]=e.initial.lines[r]}),this.reinitPlot(e,{_id:e.settings._id,lines:t}),true}return s&&requestAnimationFrame(e.anim),true}updateLine(e,t,s,h,o,a,r){return e.numPoints!==t.length&&(s?e.numPoints>t.length?t=y.downsample(t,e.numPoints):e.numPoints<t.length&&(t=y.upsample(t,e.numPoints)):t.length>e.numPoints?t=t.slice(t.length-e.numPoints):t=[...new Array(t.length).fill(0),...t]),h&&(t=y.autoscale(t,o,a,r)),t.forEach((n,l)=>e.setY(l,n)),true}static autoscale(e,t=0,s=1,h=false,o,a,r){if(e?.length===0)return e;let n=typeof a=="number"?a:e.length<=1e5?Math.max(...e):1,l=typeof o=="number"?o:e.length<=1e5?Math.min(...e):0,i2=1/s,u=1;if(h){let g=Math.max(Math.abs(l),Math.abs(n));return g!==0&&(u=i2/g),e.map(f=>(r&&(f<l&&(f=l),f>n&&(f=n)),f*u+(i2*(t+1)*2-1-i2)))}else return n===l?n!==0?u=i2/n:l!==0&&(u=i2/Math.abs(l)):u=i2/(n-l),e.map(g=>(r&&(g<l&&(g=l),g>n&&(g=n)),2*((g-l)*u-1/(2*s))+(i2*(t+1)*2-1-i2)))}static getYScalar(e,t=1,s=false,h,o){if(e?.length===0)return e;let a=typeof o=="number"?o:e.length<=1e5?Math.max(...e):1,r=typeof h=="number"?h:e.length<=1e5?Math.min(...e):0,n=1/t,l=1;if(s){let i2=Math.max(Math.abs(r),Math.abs(a));return i2!==0&&(l=n/i2),2*l}else return a===r?a!==0?l=n/a:r!==0&&(l=n/Math.abs(r)):l=n/(a-r),2*l}static getYOffset(e=0,t=1,s=0,h=1){let o=1/t,a=o*(e+1)*2-1-o;return s!==0?a-=s*h+1/t:a-=h+1/t,a}static absmax(e){return Math.max(Math.abs(Math.min(...e)),Math.max(...e))}static downsample(e,t,s=1){if(e.length>t){let h=new Array(t),o=e.length/t,a=e.length-1,r=0,n=0;for(let l=o;l<e.length;l+=o){let i2=Math.round(l);i2>a&&(i2=a);for(let u=r;u<i2;u++)h[n]+=e[u];h[n]/=(i2-r)*s,n++,r=i2}return h}else return e}static upsample(e,t,s=1){var h=function(g,f,b){return(g+(f-g)*b)*s},o=new Array(t),a=(e.length-1)/(t-1);o[0]=e[0];for(var r=1;r<t-1;r++){var n=r*a,l=Math.floor(n),i2=Math.ceil(n),u=n-l;o[r]=h(e[l],e[i2],u)}return o[t-1]=e[e.length-1],o}static interpolate(e,t,s=1){return e.length>t?y.downsample(e,t,s):e.length<t?y.upsample(e,t,s):e}static HSLToRGB(e,t,s,h=255){t/=100,s/=100;let o=(1-Math.abs(2*s-1))*t,a=o*(1-Math.abs(e/60%2-1)),r=s-o/2,n=0,l=0,i2=0;return 0<=e&&e<60?(n=o,l=a,i2=0):60<=e&&e<120?(n=a,l=o,i2=0):120<=e&&e<180?(n=0,l=o,i2=a):180<=e&&e<240?(n=0,l=a,i2=o):240<=e&&e<300?(n=a,l=0,i2=o):300<=e&&e<360&&(n=o,l=0,i2=a),n=(n+r)*h,l=(l+r)*h,i2=(i2+r)*h,[n,l,i2]}static circularBuffer(e,t){if(t.length<e.length){let s=e.slice(t.length),h=e.length;e.splice(0,h,...s,...t)}else if(t.length>e.length){let s=e.length;e.splice(0,s,...t.slice(t.length-s))}else e.splice(0,e.length,...t);return e}static formatDataForCharts(e,t){if(Array.isArray(e)){if(Array.isArray(e[0])){let s={};if(e.forEach((h,o)=>{s[o]=h}),e=s,isNaN(e[0][0]))return}else if(t){if(e={[t]:e},isNaN(e[t][0]))return}else if(e={0:e},isNaN(e[0][0]))return}else if(typeof e=="object"){for(let s in e)if(typeof e[s]=="number"?e[s]=[e[s]]:e[s]?.values&&typeof e[s].values=="number"&&(e[s].values=[e[s].values]),isNaN(e[s][0]))return}else if(typeof e=="string"){let s;if(e.includes(`\\r\n`)){let h=e.split(`\\r\n`);e={},h.forEach((o,a)=>{o.includes("	")?s=o.split("	"):o.includes(",")?s=o.split(","):o.includes("|")&&(s=o.split("|")),s&&s.forEach((r,n)=>{if(r.includes(":")){let[l,i2]=r.split(":"),u=parseFloat(i2);isNaN(u)||(e[l]=[u])}else{let l=parseFloat(r);isNaN(l)||(e[n]=[l])}})})}else e.includes("	")?s=e.split("	"):e.includes(",")?s=e.split(","):e.includes("|")&&(s=e.split("|"));e={},s&&s.forEach((h,o)=>{if(h.includes(":")){let[a,r]=h.split(":"),n=parseFloat(r);isNaN(n)||(e[a]=[n])}else{let a=parseFloat(h);isNaN(a)||(e[o]=[a])}})}else typeof e=="number"&&(t?e={[t]:[e]}:e={0:[e]});return e}static padTime(e,t,s,h){let o=(e[0]-t)/s/h;return[...new Array(h-e.length).map((r,n)=>t+o*(n+1)),...e]}static interpolateForTime(e,t,s){return y.interpolate(e,Math.ceil(s*t))}};if(typeof WorkerGlobalScope!=="undefined"){globalThis.plotter=new y;const routes={...workerCanvasRoutes};self.onmessage=ev=>{if(ev.data.route){if(Array.isArray(ev.data.args)){routes[ev.data.route](...ev.data.args)}else routes[ev.data.route](ev.data.args)}}}var canvas_worker_default=self;})();\n',hh=URL.createObjectURL(new globalThis.Blob([ph],{type:"text/javascript"})),Hs=hh;var Jr=ja(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]),gh=ja(["deltaX","deltaY"]),yh=ja(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);function hf(e,t){let r={type:e.type};r.isTrusted=e.isTrusted,r.bubbles=e.bubbles,r.cancelBubble=e.cancelBubble,r.cancelable=e.cancelable,r.composed=e.composed,r.defaultPrevent=e.defaultPrevented,r.eventPhase=e.eventPhase,r.returnValue=e.returnValue,r.currentTarget=e.currentTarget.id?e.currentTarget.id:e.currentTarget.constructor.name,r.target=r.currentTarget,r.srcElement=r.currentTarget,t(r)}function bh(e,t,r){r&&e.preventDefault&&e.preventDefault(),gh(e,t)}function mh(e,t,r){r&&e.preventDefault&&e.preventDefault()}function _h(e,t,r){for(let i of t)r[i]=e[i]}function ja(e){return function(r,i){let n={type:r.type};_h(r,e,n),i(n)}}function Ia(e,t,r){r&&e.preventDefault&&e.preventDefault();let i=[],n={type:e.type,touches:i};for(let a=0;a<e.touches.length;++a){let p=e.touches[a];i.push({pageX:p.pageX,pageY:p.pageY})}t(n)}var Fa=1,bf={};for(;Fa<222;)bf[Fa]=!0,Fa++;function gf(e,t,r){let{keyCode:i}=e;bf[i]&&(r&&e.preventDefault&&(i<110||i>123)&&e.preventDefault(),yh(e,t))}var qn={contextmenu:mh,mousedown:Jr,mousemove:Jr,mouseup:Jr,pointerdown:Jr,pointermove:Jr,pointerup:Jr,pointerlockchange:Jr,webkitpointerlockchange:Jr,focus:hf,blur:hf,pointerout:Jr,touchstart:Ia,touchmove:Ia,touchend:Ia,wheel:bh,keydown:gf,keyup:gf};function Ws(e,t,r,i){r||(r="proxy"+Math.floor(Math.random()*1e15));let n=d=>{t?t.postMessage({route:"handleProxyEvent",args:[d,r]}):mf(d,r)},a=Object.entries(qn);for(let[d,y]of a)e.addEventListener(d,function(b){y(b,n,i)});qn.keydown&&globalThis.addEventListener("keydown",function(d){qn.keydown(d,n,i)}),qn.keyup&&globalThis.addEventListener("keyup",function(d){qn.keyup(d,n,i)});let p=()=>{let d=e.getBoundingClientRect();n({type:"resize",left:d.left,top:d.top,width:e.clientWidth,height:e.clientHeight})};return p(),globalThis.addEventListener("resize",p),r}var Ba=class{addEventListener(t,r){this.__listeners===void 0&&(this.__listeners={});let i=this.__listeners;i[t]===void 0&&(i[t]=[]),i[t].indexOf(r)===-1&&i[t].push(r)}hasEventListener(t,r){if(this.__listeners===void 0)return!1;let i=this.__listeners;return i[t]!==void 0&&i[t].indexOf(r)!==-1}removeEventListener(t,r){if(this.__listeners===void 0)return;let n=this.__listeners[t];if(n!==void 0){let a=n.indexOf(r);a!==-1&&n.splice(a,1)}}dispatchEvent(t,r){if(this.__listeners===void 0)return;let n=this.__listeners[t.type];if(n!==void 0){r?t.target=r:t.target=this;let a=n.slice(0);for(let p=0,d=a.length;p<d;p++)a[p].call(this,t)}}};function yf(){}var Ca=class extends Ba{constructor(){super();this.__listeners={};this.style={};this.setPointerCapture=()=>{};this.releasePointerCapture=()=>{};this.getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height});this.handleEvent=r=>{r.type==="resize"&&(this.left=r.left,this.top=r.top,this.width=r.width,this.height=r.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),r.preventDefault=yf,r.stopPropagation=yf,this.dispatchEvent(r,this.proxied)};this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}focus(){}blur(){}},Ki=class{constructor(){this.targets={};this.makeProxy=(t,r=void 0)=>{t||(t=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let i;this.targets[t]?i=this.targets[t]:(i=new Ca,this.targets[t]=i),typeof r=="object"&&(r.proxy=i,i.proxied=r,typeof WorkerGlobalScope<"u"&&(r.style=i.style),i.width&&(r.style.width=i.width+"px",r.clientWidth=i.width),i.height&&(r.style.height=i.height+"px",r.clientHeight=i.height),r.setPointerCapture=i.setPointerCapture.bind(i),r.releasePointerCapture=i.releasePointerCapture.bind(i),r.getBoundingClientRect=i.getBoundingClientRect.bind(i),r.addEventListener=i.addEventListener.bind(i),r.removeEventListener=i.removeEventListener.bind(i),r.handleEvent=i.handleEvent.bind(i),r.dispatchEvent=i.dispatchEvent.bind(i),r.focus=i.focus.bind(i),r.blur=i.blur.bind(i))};this.getProxy=t=>this.targets[t];this.handleEvent=(t,r)=>{if(this.targets[r]||this.makeProxy(r),this.targets[r])return this.targets[r].handleEvent(t),!0};globalThis.document||(globalThis.document={elementFromPoint:(...t)=>this.targets[Object.keys(this.targets)[0]].proxied})}};function vh(e,t){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new Ki),this.__node.graph.ProxyManager.makeProxy(e,t)):(globalThis.ProxyManager||(globalThis.ProxyManager=new Ki),globalThis.ProxyManager.makeProxy(e,t)),e}function mf(e,t){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new Ki),this.__node.graph.ProxyManager.handleEvent(e,t))return e}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new Ki),globalThis.ProxyManager.handleEvent(e,t))return e}var Gs={initProxyElement:Ws,makeProxy:vh,handleProxyEvent:mf};function wh(e){if(e.worker){let t=e.worker,r=e.route;return(t instanceof Blob||typeof t=="string")&&(t=new Worker(t)),delete e.worker,delete e.route,_f(t,e,r)}else return Ws(e.canvas,void 0,e._id,e.preventDefault),vf(e)}function _f(e,t,r){if(console.log(t),!t)return;t._id||(t._id=`canvas${Math.floor(Math.random()*1e15)}`);let i=t.canvas.transferControlToOffscreen();t.width||(t.width=t.canvas.clientWidth),t.height||(t.height=t.canvas.clientHeight);let n={route:r||"setupCanvas",args:{...t,canvas:i}};this?.__node?.graph?this.__node.graph.run("initProxyElement",t.canvas,e,t._id,t.preventDefault):Ws(t.canvas,e,t._id,t.preventDefault),t.draw&&(typeof t.draw=="function"?n.args.draw=t.draw.toString():n.args.draw=t.draw),t.update&&(typeof t.update=="function"?n.args.update=t.update.toString():n.args.update=t.update),t.init&&(typeof t.init=="function"?n.args.init=t.init.toString():n.args.init=t.init),t.clear&&(typeof t.clear=="function"?n.args.clear=t.clear.toString():n.args.clear=t.clear);let a=[i];return t.transfer&&(a.push(...t.transfer),delete t.transfer),e.postMessage(n,a),{_id:t._id,width:t.width,height:t.height,worker:e,draw:(d,y)=>{e.postMessage({route:"drawFrame",args:[d,t._id]},y)},update:(d,y)=>{e.postMessage({route:"updateCanvas",args:[d,t._id]},y)},clear:()=>{e.postMessage({route:"clearCanvas",args:t._id})},init:()=>{e.postMessage({route:"initCanvas",args:t._id})},stop:()=>{e.postMessage({route:"stopAnim",args:t._id})},start:()=>{e.postMessage({route:"startAnim",args:t._id})},set:(d,y)=>{e.postMessage({route:"setDraw",args:[d,t._id]},y)},terminate:()=>{e.terminate()}}}function Ys(e,t){let r;if(this?.__node?.graph?t?r=this.__node.graph.CANVASES?.[e._id]:e._id?r=this.__node.graph.CANVASES?.[e._id]:r=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:t||e._id?r=globalThis.CANVASES?.[e._id]:r=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],r)return e.canvas&&(r.canvas=e.canvas,this?.__node?.graph?this.__node.graph.run("makeProxy",r._id,r.canvas):Gs.makeProxy(r._id,r.canvas)),typeof e.context=="string"?r.context=r.canvas.getContext(e.context):e.context&&(r.context=e.context),e.width&&(r.canvas.width=e.width),e.height&&(r.canvas.height=e.height),typeof e.draw=="string"&&(e.draw=Hr(e.draw)),typeof e.draw=="function"&&(r.draw=e.draw.bind(e)),typeof e.update=="string"&&(e.update=Hr(e.update)),typeof e.update=="function"&&(r.update=e.update.bind(e)),typeof e.init=="string"&&(e.init=Hr(e.init)),typeof e.init=="function"&&(r.init=e.init.bind(e)),typeof e.clear=="string"&&(e.clear=Hr(e.clear)),typeof e.clear=="function"&&(r.clear=e.clear.bind(e)),e._id}function vf(e){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let t=e;if(e._id?t._id=e._id:t._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof e.context=="string"?t.context=e.canvas.getContext(e.context):t.context=e.context,"animating"in e?t.animating=e.animating:t.animating=!0,this?.__node?.graph?.CANVASES[t._id])this.__node.graph.run("setDraw",t);else if(globalThis.CANVASES?.[t._id])Ys(t);else if(this?.__node?.graph&&(t.graph=this.__node.graph,t.__node||(t.__node={}),t.__node.tag||(t.__node.tag=t._id),t=this.__node.graph.add(t),t.__addOndisconnected=()=>{t.stop(),delete this.__node.graph.CANVASES[t._id]}),this?.__node?.graph?this.__node.graph.CANVASES[t._id]=t:globalThis.CANVASES[t._id]=t,this?.__node?.graph?this.__node.graph.run("makeProxy",t._id,t.canvas):Gs.makeProxy(t._id,t.canvas),e.width&&(t.canvas.width=e.width),e.height&&(t.canvas.height=e.height),typeof t.draw=="string"?t.draw=Hr(t.draw):typeof t.draw=="function"&&(t.draw=t.draw.bind(t)),typeof t.update=="string"?t.update=Hr(t.update):typeof t.update=="function"&&(t.update=t.update.bind(t)),typeof t.init=="string"?t.init=Hr(t.init):typeof t.init=="function"&&(t.init=t.init.bind(t)),typeof t.clear=="string"?t.clear=Hr(t.clear):typeof t.clear=="function"&&(t.clear=t.clear.bind(t)),typeof t.init=="function"&&t.init(t,t.canvas,t.context),t.stop=()=>{Xs(t._id)},t.start=r=>{La(t._id,r)},t.set=r=>{Ys(r,t._id)},typeof t.draw=="function"&&t.animating){let r=(i,n,a)=>{i.animating&&(i.draw(i,n,a),requestAnimationFrame(()=>{r(i,n,a)}))};r(t,t.canvas,t.context)}return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?t._id:{_id:e._id,width:e.width,height:e.height,draw:i=>{wf(i,e._id)},update:i=>{xf(i,e._id)},clear:()=>{Sf(e._id)},init:()=>{kf(e._id)},stop:()=>{Xs(e._id)},start:()=>{La(e._id)},set:i=>{Ys(i,e._id)},terminate:()=>{this.__node?.graph?this.__node.graph.remove(e._id):(Xs(e._id),this?.__node?.graph?delete this.__node.graph.CANVASES[t._id]:delete globalThis.CANVASES[t._id])}}}function wf(e,t){let r=li.call(this,t);if(r&&(e&&Object.assign(r,e),r.draw))return r.draw(r,r.canvas,r.context),t}function Sf(e){let t=li.call(this,e);if(t?.clear)return t.clear(t,t.canvas,t.context),e}function kf(e){let t=li.call(this,e);if(t?.init)return t.init(t,t.canvas,t.context),e}function xf(e,t){let r=li.call(this,t);if(r?.update)return r.update(r,r.canvas,r.context,e),t}function Sh(e,t){let r=li.call(this,t);if(r)return Object.assign(r,e),e.width&&(r.canvas.width=e.width),e.height&&(r.canvas.height=e.height),t}function La(e,t){let r=li.call(this,e);if(r.animating=!0,r&&t)return typeof t=="string"&&(t=Hr(t)),typeof t=="function"&&(r.draw=t),e;if(typeof r?.draw=="function"){let i=(n,a,p)=>{n.animating&&(n.draw(n,a,p),requestAnimationFrame(()=>{i(n,a,p)}))};return typeof r.clear=="function"&&r.clear(r,r.canvas,r.context),typeof r.init=="function"&&r.init(r,r.canvas,r.context),i(r,r.canvas,r.context),e}}function Xs(e){let t=li.call(this,e);if(t)return t.animating=!1,typeof t.clear=="function"&&requestAnimationFrame(t.clear(t,t.canvas,t.context)),e}function li(e){let t;return this?.__node?.graph?e?t=this.__node.graph.CANVASES?.[e]:t=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e?t=globalThis.CANVASES?.[e]:t=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],t}var Ef={...Gs,Renderer:wh,transferCanvas:_f,setupCanvas:vf,setDraw:Ys,drawFrame:wf,clearCanvas:Sf,initCanvas:kf,updateCanvas:xf,setProps:Sh,startAnim:La,stopAnim:Xs,getCanvas:li};function Hr(e=""){let t=p=>p.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),i=(p=>{let d=p.indexOf("=>")+1;return d<=0&&(d=p.indexOf("){")),d<=0&&(d=p.indexOf(") {")),p.slice(0,p.indexOf("{",d)+1)})(e),n=t(e),a;if(i.includes("function")){let p=i.split("(")[1].split(")")[0];a=new Function(p,n)}else if(i.substring(0,6)===n.substring(0,6)){let p=i.split("(")[1].split(")")[0];a=new Function(p,n.substring(n.indexOf("{")+1,n.length-1))}else try{a=(0,eval)(i+n+"}")}catch{}return a}var Ks=class{constructor(t){this.plotter=new Vt;this.create=(t=this.options)=>{let r=(a,p,d)=>{this.plotter.initPlot(a);let y=b=>{p.clientHeight&&(p.width=p.clientWidth,p.height=p.clientHeight,a.overlay.width=p.clientWidth,a.overlay.height=p.clientHeight,this.plotter.plots[a._id].plot.webgl.viewport(0,0,p.clientWidth,p.clientHeight),this.plotter.plots[a._id].plot.update())};typeof window<"u"?window.addEventListener("resize",y):p.addEventListener("resize",y),setTimeout(()=>{y(p)},10)},i=(a,p,d,y)=>{this.plotter.update(a._id,y)},n=(a,p,d)=>{this.plotter.deinitPlot(a._id)};if(t.init=r,t.update=i,t.clear=n,t.worker&&(t.worker===!0?t.worker=new Worker(Hs):(typeof t.worker=="string"||t.worker instanceof Blob)&&(t.worker=new Worker(t.worker)),t.overlay)){let a=t.overlay.transferControlToOffscreen();t.overlay=a,t.transfer=[t.overlay]}return this.plot=Ef.Renderer(t),this.plot};this.__operator=t=>{this.plot||this.create(this.options),this.plot.update(t)};t&&(this.options=t,this.create(t))}};var Of=ca.addWorker({url:fa}),Pa=document.createElement("button"),Af=0,kh=[25,22,255],Nf=["timestamp"];kh.forEach(e=>{Nf.push(e+"_"+Af)});Pa.onclick=()=>{let e=!1;jc(la.BLE.nrf5x,{workerUrl:fa,ondecoded:{"0002cafe-b0ba-8bad-f00d-deadbeef0000":t=>{if(t.leds){let r={timestamp:t.timestamp};if(t.leds.forEach((i,n)=>{for(let a=0;a<8;a++)a===Af&&(r[i+"_"+a]||(r[i+"_"+a]=[]),r[i+"_"+a].push(t[a][n]))}),!e){let i="data/"+new Date().toISOString()+"_FNIRS.csv";Of.run("createCSV",[i,Nf,5,250]).then(async()=>{Ra()}),e=!0}xh.__operator(r),Of.run("appendCSV",r)}}}})};Pa.innerHTML="Connect Device";document.body.appendChild(Pa);var Da=document.createElement("div");document.body.appendChild(Da);Ra();var Zi=document.createElement("canvas"),xi=document.createElement("canvas");Zi.style.width="1200px";Zi.style.height="800px";Zi.height=800;Zi.width=1200;xi.style.width="1200px";xi.style.height="800px";xi.height=800;xi.width=1200;xi.style.transform="translate(0,-800px)";document.body.appendChild(Zi);document.body.appendChild(xi);var xh=new Ks({canvas:Zi,overlay:xi,lines:{},generateNewLines:!0,cleanGeneration:!1,worker:Hs});async function Ra(){let e=await ya.listFiles("data");Da.innerHTML="",e.forEach(t=>{let r=async()=>{$c.writeToCSVFromDB("data/"+t,10)},i=()=>{ya.deleteFile("data/"+t).then(()=>{Ra()})};Da.insertAdjacentHTML("afterbegin",`
            <div id="${t}">
                <span>${t}
                <button id="dl">Download</button>
                <button id="del">Delete</button>
                </span>
            </div>
        `);let n=document.getElementById(t);console.log(n),(n?.querySelector("#dl")).onclick=r,(n?.querySelector("#del")).onclick=i})}})();
/*! Bundled license information:

device-decoder/dist/device.frontend.esm.js:
  (*! Bundled license information:
  
  @capacitor/core/dist/index.js:
    (*! Capacitor: https://capacitorjs.com/ - MIT License *)
  *)

graphscript-services.storage/dist/index.storage.services.esm.js:
  (*! Bundled license information:
  
  browserfs/dist/browserfs.js:
    (*!
    * The buffer module from node.js, for the browser.
    *
    * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
    * @license  MIT
    *)
  *)
*/
