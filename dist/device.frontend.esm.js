var __defProp=Object.defineProperty;var __getOwnPropNames=Object.getOwnPropertyNames;var __require=(x3=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b3)=>(typeof require!=="undefined"?require:a)[b3]}):x3)(function(x3){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error('Dynamic require of "'+x3+'" is not supported')});var __esm=(fn,res)=>function __init(){return fn&&(res=(0,fn[__getOwnPropNames(fn)[0]])(fn=0)),res};var __export=(target,all)=>{for(var name2 in all)__defProp(target,name2,{get:all[name2],enumerable:true})};var createCapacitorPlatforms,initPlatforms,CapacitorPlatforms,addPlatform,setPlatform,ExceptionCode,CapacitorException,getPlatformId,createCapacitor,initCapacitorGlobal,Capacitor,registerPlugin,Plugins,WebPlugin,encode,decode,CapacitorCookiesPluginWeb,CapacitorCookies,readBlobAsBase64,normalizeHttpHeaders,buildUrlParams,buildRequestInit,CapacitorHttpPluginWeb,CapacitorHttp;var init_dist=__esm({"src/ble/node_modules/@capacitor/core/dist/index.js"(){createCapacitorPlatforms=win=>{const defaultPlatformMap=new Map;defaultPlatformMap.set("web",{name:"web"});const capPlatforms=win.CapacitorPlatforms||{currentPlatform:{name:"web"},platforms:defaultPlatformMap};const addPlatform2=(name2,platform)=>{capPlatforms.platforms.set(name2,platform)};const setPlatform2=name2=>{if(capPlatforms.platforms.has(name2)){capPlatforms.currentPlatform=capPlatforms.platforms.get(name2)}};capPlatforms.addPlatform=addPlatform2;capPlatforms.setPlatform=setPlatform2;return capPlatforms};initPlatforms=win=>win.CapacitorPlatforms=createCapacitorPlatforms(win);CapacitorPlatforms=initPlatforms(typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{});addPlatform=CapacitorPlatforms.addPlatform;setPlatform=CapacitorPlatforms.setPlatform;(function(ExceptionCode2){ExceptionCode2["Unimplemented"]="UNIMPLEMENTED";ExceptionCode2["Unavailable"]="UNAVAILABLE"})(ExceptionCode||(ExceptionCode={}));CapacitorException=class extends Error{constructor(message,code,data){super(message);this.message=message;this.code=code;this.data=data}};getPlatformId=win=>{var _a,_b;if(win===null||win===void 0?void 0:win.androidBridge){return"android"}else if((_b=(_a=win===null||win===void 0?void 0:win.webkit)===null||_a===void 0?void 0:_a.messageHandlers)===null||_b===void 0?void 0:_b.bridge){return"ios"}else{return"web"}};createCapacitor=win=>{var _a,_b,_c,_d,_e;const capCustomPlatform=win.CapacitorCustomPlatform||null;const cap=win.Capacitor||{};const Plugins2=cap.Plugins=cap.Plugins||{};const capPlatforms=win.CapacitorPlatforms;const defaultGetPlatform=()=>{return capCustomPlatform!==null?capCustomPlatform.name:getPlatformId(win)};const getPlatform=((_a=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_a===void 0?void 0:_a.getPlatform)||defaultGetPlatform;const defaultIsNativePlatform=()=>getPlatform()!=="web";const isNativePlatform=((_b=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_b===void 0?void 0:_b.isNativePlatform)||defaultIsNativePlatform;const defaultIsPluginAvailable=pluginName=>{const plugin=registeredPlugins.get(pluginName);if(plugin===null||plugin===void 0?void 0:plugin.platforms.has(getPlatform())){return true}if(getPluginHeader(pluginName)){return true}return false};const isPluginAvailable=((_c=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_c===void 0?void 0:_c.isPluginAvailable)||defaultIsPluginAvailable;const defaultGetPluginHeader=pluginName=>{var _a2;return(_a2=cap.PluginHeaders)===null||_a2===void 0?void 0:_a2.find(h2=>h2.name===pluginName)};const getPluginHeader=((_d=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_d===void 0?void 0:_d.getPluginHeader)||defaultGetPluginHeader;const handleError=err=>win.console.error(err);const pluginMethodNoop=(_target,prop,pluginName)=>{return Promise.reject(`${pluginName} does not have an implementation of "${prop}".`)};const registeredPlugins=new Map;const defaultRegisterPlugin=(pluginName,jsImplementations={})=>{const registeredPlugin=registeredPlugins.get(pluginName);if(registeredPlugin){console.warn(`Capacitor plugin "${pluginName}" already registered. Cannot register plugins twice.`);return registeredPlugin.proxy}const platform=getPlatform();const pluginHeader=getPluginHeader(pluginName);let jsImplementation;const loadPluginImplementation=async()=>{if(!jsImplementation&&platform in jsImplementations){jsImplementation=typeof jsImplementations[platform]==="function"?jsImplementation=await jsImplementations[platform]():jsImplementation=jsImplementations[platform]}else if(capCustomPlatform!==null&&!jsImplementation&&"web"in jsImplementations){jsImplementation=typeof jsImplementations["web"]==="function"?jsImplementation=await jsImplementations["web"]():jsImplementation=jsImplementations["web"]}return jsImplementation};const createPluginMethod=(impl,prop)=>{var _a2,_b2;if(pluginHeader){const methodHeader=pluginHeader===null||pluginHeader===void 0?void 0:pluginHeader.methods.find(m2=>prop===m2.name);if(methodHeader){if(methodHeader.rtype==="promise"){return options=>cap.nativePromise(pluginName,prop.toString(),options)}else{return(options,callback)=>cap.nativeCallback(pluginName,prop.toString(),options,callback)}}else if(impl){return(_a2=impl[prop])===null||_a2===void 0?void 0:_a2.bind(impl)}}else if(impl){return(_b2=impl[prop])===null||_b2===void 0?void 0:_b2.bind(impl)}else{throw new CapacitorException(`"${pluginName}" plugin is not implemented on ${platform}`,ExceptionCode.Unimplemented)}};const createPluginMethodWrapper=prop=>{let remove;const wrapper=(...args)=>{const p2=loadPluginImplementation().then(impl=>{const fn=createPluginMethod(impl,prop);if(fn){const p3=fn(...args);remove=p3===null||p3===void 0?void 0:p3.remove;return p3}else{throw new CapacitorException(`"${pluginName}.${prop}()" is not implemented on ${platform}`,ExceptionCode.Unimplemented)}});if(prop==="addListener"){p2.remove=async()=>remove()}return p2};wrapper.toString=()=>`${prop.toString()}() { [capacitor code] }`;Object.defineProperty(wrapper,"name",{value:prop,writable:false,configurable:false});return wrapper};const addListener=createPluginMethodWrapper("addListener");const removeListener=createPluginMethodWrapper("removeListener");const addListenerNative=(eventName,callback)=>{const call=addListener({eventName},callback);const remove=async()=>{const callbackId=await call;removeListener({eventName,callbackId},callback)};const p2=new Promise(resolve=>call.then(()=>resolve({remove})));p2.remove=async()=>{console.warn(`Using addListener() without 'await' is deprecated.`);await remove()};return p2};const proxy=new Proxy({},{get(_2,prop){switch(prop){case"$$typeof":return void 0;case"toJSON":return()=>({});case"addListener":return pluginHeader?addListenerNative:addListener;case"removeListener":return removeListener;default:return createPluginMethodWrapper(prop)}}});Plugins2[pluginName]=proxy;registeredPlugins.set(pluginName,{name:pluginName,proxy,platforms:new Set([...Object.keys(jsImplementations),...pluginHeader?[platform]:[]])});return proxy};const registerPlugin2=((_e=capPlatforms===null||capPlatforms===void 0?void 0:capPlatforms.currentPlatform)===null||_e===void 0?void 0:_e.registerPlugin)||defaultRegisterPlugin;if(!cap.convertFileSrc){cap.convertFileSrc=filePath=>filePath}cap.getPlatform=getPlatform;cap.handleError=handleError;cap.isNativePlatform=isNativePlatform;cap.isPluginAvailable=isPluginAvailable;cap.pluginMethodNoop=pluginMethodNoop;cap.registerPlugin=registerPlugin2;cap.Exception=CapacitorException;cap.DEBUG=!!cap.DEBUG;cap.isLoggingEnabled=!!cap.isLoggingEnabled;cap.platform=cap.getPlatform();cap.isNative=cap.isNativePlatform();return cap};initCapacitorGlobal=win=>win.Capacitor=createCapacitor(win);Capacitor=initCapacitorGlobal(typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:typeof window!=="undefined"?window:typeof global!=="undefined"?global:{});registerPlugin=Capacitor.registerPlugin;Plugins=Capacitor.Plugins;WebPlugin=class{constructor(config){this.listeners={};this.retainedEventArguments={};this.windowListeners={};if(config){console.warn(`Capacitor WebPlugin "${config.name}" config object was deprecated in v3 and will be removed in v4.`);this.config=config}}addListener(eventName,listenerFunc){let firstListener=false;const listeners=this.listeners[eventName];if(!listeners){this.listeners[eventName]=[];firstListener=true}this.listeners[eventName].push(listenerFunc);const windowListener=this.windowListeners[eventName];if(windowListener&&!windowListener.registered){this.addWindowListener(windowListener)}if(firstListener){this.sendRetainedArgumentsForEvent(eventName)}const remove=async()=>this.removeListener(eventName,listenerFunc);const p2=Promise.resolve({remove});return p2}async removeAllListeners(){this.listeners={};for(const listener in this.windowListeners){this.removeWindowListener(this.windowListeners[listener])}this.windowListeners={}}notifyListeners(eventName,data,retainUntilConsumed){const listeners=this.listeners[eventName];if(!listeners){if(retainUntilConsumed){let args=this.retainedEventArguments[eventName];if(!args){args=[]}args.push(data);this.retainedEventArguments[eventName]=args}return}listeners.forEach(listener=>listener(data))}hasListeners(eventName){return!!this.listeners[eventName].length}registerWindowListener(windowEventName,pluginEventName){this.windowListeners[pluginEventName]={registered:false,windowEventName,pluginEventName,handler:event=>{this.notifyListeners(pluginEventName,event)}}}unimplemented(msg="not implemented"){return new Capacitor.Exception(msg,ExceptionCode.Unimplemented)}unavailable(msg="not available"){return new Capacitor.Exception(msg,ExceptionCode.Unavailable)}async removeListener(eventName,listenerFunc){const listeners=this.listeners[eventName];if(!listeners){return}const index=listeners.indexOf(listenerFunc);this.listeners[eventName].splice(index,1);if(!this.listeners[eventName].length){this.removeWindowListener(this.windowListeners[eventName])}}addWindowListener(handle){window.addEventListener(handle.windowEventName,handle.handler);handle.registered=true}removeWindowListener(handle){if(!handle){return}window.removeEventListener(handle.windowEventName,handle.handler);handle.registered=false}sendRetainedArgumentsForEvent(eventName){const args=this.retainedEventArguments[eventName];if(!args){return}delete this.retainedEventArguments[eventName];args.forEach(arg=>{this.notifyListeners(eventName,arg)})}};encode=str3=>encodeURIComponent(str3).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape);decode=str3=>str3.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);CapacitorCookiesPluginWeb=class extends WebPlugin{async getCookies(){const cookies=document.cookie;const cookieMap={};cookies.split(";").forEach(cookie=>{if(cookie.length<=0)return;let[key,value]=cookie.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");key=decode(key).trim();value=decode(value).trim();cookieMap[key]=value});return cookieMap}async setCookie(options){try{const encodedKey=encode(options.key);const encodedValue=encode(options.value);const expires=`; expires=${(options.expires||"").replace("expires=","")}`;const path=(options.path||"/").replace("path=","");const domain=options.url!=null&&options.url.length>0?`domain=${options.url}`:"";document.cookie=`${encodedKey}=${encodedValue||""}${expires}; path=${path}; ${domain};`}catch(error){return Promise.reject(error)}}async deleteCookie(options){try{document.cookie=`${options.key}=; Max-Age=0`}catch(error){return Promise.reject(error)}}async clearCookies(){try{const cookies=document.cookie.split(";")||[];for(const cookie of cookies){document.cookie=cookie.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}}catch(error){return Promise.reject(error)}}async clearAllCookies(){try{await this.clearCookies()}catch(error){return Promise.reject(error)}}};CapacitorCookies=registerPlugin("CapacitorCookies",{web:()=>new CapacitorCookiesPluginWeb});readBlobAsBase64=async blob=>new Promise((resolve,reject)=>{const reader=new FileReader;reader.onload=()=>{const base64String=reader.result;resolve(base64String.indexOf(",")>=0?base64String.split(",")[1]:base64String)};reader.onerror=error=>reject(error);reader.readAsDataURL(blob)});normalizeHttpHeaders=(headers={})=>{const originalKeys=Object.keys(headers);const loweredKeys=Object.keys(headers).map(k3=>k3.toLocaleLowerCase());const normalized=loweredKeys.reduce((acc,key,index)=>{acc[key]=headers[originalKeys[index]];return acc},{});return normalized};buildUrlParams=(params,shouldEncode=true)=>{if(!params)return null;const output=Object.entries(params).reduce((accumulator,entry)=>{const[key,value]=entry;let encodedValue;let item;if(Array.isArray(value)){item="";value.forEach(str3=>{encodedValue=shouldEncode?encodeURIComponent(str3):str3;item+=`${key}=${encodedValue}&`});item.slice(0,-1)}else{encodedValue=shouldEncode?encodeURIComponent(value):value;item=`${key}=${encodedValue}`}return`${accumulator}&${item}`},"");return output.substr(1)};buildRequestInit=(options,extra={})=>{const output=Object.assign({method:options.method||"GET",headers:options.headers},extra);const headers=normalizeHttpHeaders(options.headers);const type=headers["content-type"]||"";if(typeof options.data==="string"){output.body=options.data}else if(type.includes("application/x-www-form-urlencoded")){const params=new URLSearchParams;for(const[key,value]of Object.entries(options.data||{})){params.set(key,value)}output.body=params.toString()}else if(type.includes("multipart/form-data")||options.data instanceof FormData){const form=new FormData;if(options.data instanceof FormData){options.data.forEach((value,key)=>{form.append(key,value)})}else{for(const key of Object.keys(options.data)){form.append(key,options.data[key])}}output.body=form;const headers2=new Headers(output.headers);headers2.delete("content-type");output.headers=headers2}else if(type.includes("application/json")||typeof options.data==="object"){output.body=JSON.stringify(options.data)}return output};CapacitorHttpPluginWeb=class extends WebPlugin{async request(options){const requestInit=buildRequestInit(options,options.webFetchExtra);const urlParams=buildUrlParams(options.params,options.shouldEncodeUrlParams);const url2=urlParams?`${options.url}?${urlParams}`:options.url;const response=await fetch(url2,requestInit);const contentType=response.headers.get("content-type")||"";let{responseType="text"}=response.ok?options:{};if(contentType.includes("application/json")){responseType="json"}let data;let blob;switch(responseType){case"arraybuffer":case"blob":blob=await response.blob();data=await readBlobAsBase64(blob);break;case"json":data=await response.json();break;case"document":case"text":default:data=await response.text()}const headers={};response.headers.forEach((value,key)=>{headers[key]=value});return{data,headers,status:response.status,url:response.url}}async get(options){return this.request(Object.assign(Object.assign({},options),{method:"GET"}))}async post(options){return this.request(Object.assign(Object.assign({},options),{method:"POST"}))}async put(options){return this.request(Object.assign(Object.assign({},options),{method:"PUT"}))}async patch(options){return this.request(Object.assign(Object.assign({},options),{method:"PATCH"}))}async delete(options){return this.request(Object.assign(Object.assign({},options),{method:"DELETE"}))}};CapacitorHttp=registerPlugin("CapacitorHttp",{web:()=>new CapacitorHttpPluginWeb})}});function numbersToDataView(value){return new DataView(Uint8Array.from(value).buffer)}function dataViewToNumbers(value){return Array.from(new Uint8Array(value.buffer,value.byteOffset,value.byteLength))}function numberToUUID(value){return`0000${value.toString(16).padStart(4,"0")}-0000-1000-8000-00805f9b34fb`}function hexStringToDataView(value){const numbers=value.trim().split(" ").filter(e=>e!=="").map(s=>parseInt(s,16));return numbersToDataView(numbers)}function dataViewToHexString(value){return dataViewToNumbers(value).map(n=>{let s=n.toString(16);if(s.length==1){s="0"+s}return s}).join(" ")}function webUUIDToString(uuid){if(typeof uuid==="string"){return uuid}else if(typeof uuid==="number"){return numberToUUID(uuid)}else{throw new Error("Invalid UUID")}}function mapToObject(map){const obj={};if(!map){return void 0}map.forEach((value,key)=>{obj[key.toString()]=value});return obj}var init_conversion=__esm({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/conversion.js"(){}});async function runWithTimeout(promise,time,exception){let timer;return Promise.race([promise,new Promise((_2,reject)=>{timer=setTimeout(()=>reject(exception),time)})]).finally(()=>clearTimeout(timer))}var init_timeout=__esm({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/timeout.js"(){}});var web_exports={};__export(web_exports,{BluetoothLeWeb:()=>BluetoothLeWeb});var BluetoothLeWeb;var init_web=__esm({"src/ble/node_modules/@capacitor-community/bluetooth-le/dist/esm/web.js"(){init_dist();init_conversion();init_timeout();BluetoothLeWeb=class extends WebPlugin{constructor(){super(...arguments);this.deviceMap=new Map;this.discoveredDevices=new Map;this.scan=null;this.DEFAULT_CONNECTION_TIMEOUT=1e4;this.onAdvertisementReceivedCallback=this.onAdvertisementReceived.bind(this);this.onDisconnectedCallback=this.onDisconnected.bind(this);this.onCharacteristicValueChangedCallback=this.onCharacteristicValueChanged.bind(this)}async initialize(){if(typeof navigator==="undefined"||!navigator.bluetooth){throw this.unavailable("Web Bluetooth API not available in this browser.")}const isAvailable=await navigator.bluetooth.getAvailability();if(!isAvailable){throw this.unavailable("No Bluetooth radio available.")}}async isEnabled(){return{value:true}}async requestEnable(){throw this.unavailable("requestEnable is not available on web.")}async enable(){throw this.unavailable("enable is not available on web.")}async disable(){throw this.unavailable("disable is not available on web.")}async startEnabledNotifications(){}async stopEnabledNotifications(){}async isLocationEnabled(){throw this.unavailable("isLocationEnabled is not available on web.")}async openLocationSettings(){throw this.unavailable("openLocationSettings is not available on web.")}async openBluetoothSettings(){throw this.unavailable("openBluetoothSettings is not available on web.")}async openAppSettings(){throw this.unavailable("openAppSettings is not available on web.")}async setDisplayStrings(){}async requestDevice(options){const filters=this.getFilters(options);const device=await navigator.bluetooth.requestDevice({filters:filters.length?filters:void 0,optionalServices:options===null||options===void 0?void 0:options.optionalServices,acceptAllDevices:filters.length===0});this.deviceMap.set(device.id,device);const bleDevice=this.getBleDevice(device);return bleDevice}async requestLEScan(options){this.requestBleDeviceOptions=options;const filters=this.getFilters(options);await this.stopLEScan();this.discoveredDevices=new Map;navigator.bluetooth.removeEventListener("advertisementreceived",this.onAdvertisementReceivedCallback);navigator.bluetooth.addEventListener("advertisementreceived",this.onAdvertisementReceivedCallback);this.scan=await navigator.bluetooth.requestLEScan({filters:filters.length?filters:void 0,acceptAllAdvertisements:filters.length===0,keepRepeatedDevices:options===null||options===void 0?void 0:options.allowDuplicates})}onAdvertisementReceived(event){var _a,_b;const deviceId=event.device.id;this.deviceMap.set(deviceId,event.device);const isNew=!this.discoveredDevices.has(deviceId);if(isNew||((_a=this.requestBleDeviceOptions)===null||_a===void 0?void 0:_a.allowDuplicates)){this.discoveredDevices.set(deviceId,true);const device=this.getBleDevice(event.device);const result={device,localName:device.name,rssi:event.rssi,txPower:event.txPower,manufacturerData:mapToObject(event.manufacturerData),serviceData:mapToObject(event.serviceData),uuids:(_b=event.uuids)===null||_b===void 0?void 0:_b.map(webUUIDToString)};this.notifyListeners("onScanResult",result)}}async stopLEScan(){var _a;if((_a=this.scan)===null||_a===void 0?void 0:_a.active){this.scan.stop()}this.scan=null}async getDevices(options){const devices=await navigator.bluetooth.getDevices();const bleDevices=devices.filter(device=>options.deviceIds.includes(device.id)).map(device=>{this.deviceMap.set(device.id,device);const bleDevice=this.getBleDevice(device);return bleDevice});return{devices:bleDevices}}async getConnectedDevices(_options){const devices=await navigator.bluetooth.getDevices();const bleDevices=devices.filter(device=>{var _a;return(_a=device.gatt)===null||_a===void 0?void 0:_a.connected}).map(device=>{this.deviceMap.set(device.id,device);const bleDevice=this.getBleDevice(device);return bleDevice});return{devices:bleDevices}}async connect(options){var _a,_b;const device=this.getDeviceFromMap(options.deviceId);device.removeEventListener("gattserverdisconnected",this.onDisconnectedCallback);device.addEventListener("gattserverdisconnected",this.onDisconnectedCallback);const timeoutError=Symbol();if(device.gatt===void 0){throw new Error("No gatt server available.")}try{const timeout=(_a=options.timeout)!==null&&_a!==void 0?_a:this.DEFAULT_CONNECTION_TIMEOUT;await runWithTimeout(device.gatt.connect(),timeout,timeoutError)}catch(error){await((_b=device.gatt)===null||_b===void 0?void 0:_b.disconnect());if(error===timeoutError){throw new Error("Connection timeout")}else{throw error}}}onDisconnected(event){const deviceId=event.target.id;const key=`disconnected|${deviceId}`;this.notifyListeners(key,null)}async createBond(_options){throw this.unavailable("createBond is not available on web.")}async isBonded(_options){throw this.unavailable("isBonded is not available on web.")}async disconnect(options){var _a;(_a=this.getDeviceFromMap(options.deviceId).gatt)===null||_a===void 0?void 0:_a.disconnect()}async getServices(options){var _a,_b;const services=(_b=await((_a=this.getDeviceFromMap(options.deviceId).gatt)===null||_a===void 0?void 0:_a.getPrimaryServices()))!==null&&_b!==void 0?_b:[];const bleServices=[];for(const service of services){const characteristics=await service.getCharacteristics();const bleCharacteristics=[];for(const characteristic of characteristics){bleCharacteristics.push({uuid:characteristic.uuid,properties:this.getProperties(characteristic),descriptors:await this.getDescriptors(characteristic)})}bleServices.push({uuid:service.uuid,characteristics:bleCharacteristics})}return{services:bleServices}}async getDescriptors(characteristic){try{const descriptors=await characteristic.getDescriptors();return descriptors.map(descriptor=>({uuid:descriptor.uuid}))}catch(_a){return[]}}getProperties(characteristic){return{broadcast:characteristic.properties.broadcast,read:characteristic.properties.read,writeWithoutResponse:characteristic.properties.writeWithoutResponse,write:characteristic.properties.write,notify:characteristic.properties.notify,indicate:characteristic.properties.indicate,authenticatedSignedWrites:characteristic.properties.authenticatedSignedWrites,reliableWrite:characteristic.properties.reliableWrite,writableAuxiliaries:characteristic.properties.writableAuxiliaries}}async getCharacteristic(options){var _a;const service=await((_a=this.getDeviceFromMap(options.deviceId).gatt)===null||_a===void 0?void 0:_a.getPrimaryService(options===null||options===void 0?void 0:options.service));return service===null||service===void 0?void 0:service.getCharacteristic(options===null||options===void 0?void 0:options.characteristic)}async getDescriptor(options){const characteristic=await this.getCharacteristic(options);return characteristic===null||characteristic===void 0?void 0:characteristic.getDescriptor(options===null||options===void 0?void 0:options.descriptor)}async discoverServices(_options){throw this.unavailable("discoverServices is not available on web.")}async getMtu(_options){throw this.unavailable("getMtu is not available on web.")}async requestConnectionPriority(_options){throw this.unavailable("requestConnectionPriority is not available on web.")}async readRssi(_options){throw this.unavailable("readRssi is not available on web.")}async read(options){const characteristic=await this.getCharacteristic(options);const value=await(characteristic===null||characteristic===void 0?void 0:characteristic.readValue());return{value}}async write(options){const characteristic=await this.getCharacteristic(options);let dataView;if(typeof options.value==="string"){dataView=hexStringToDataView(options.value)}else{dataView=options.value}await(characteristic===null||characteristic===void 0?void 0:characteristic.writeValueWithResponse(dataView))}async writeWithoutResponse(options){const characteristic=await this.getCharacteristic(options);let dataView;if(typeof options.value==="string"){dataView=hexStringToDataView(options.value)}else{dataView=options.value}await(characteristic===null||characteristic===void 0?void 0:characteristic.writeValueWithoutResponse(dataView))}async readDescriptor(options){const descriptor=await this.getDescriptor(options);const value=await(descriptor===null||descriptor===void 0?void 0:descriptor.readValue());return{value}}async writeDescriptor(options){const descriptor=await this.getDescriptor(options);let dataView;if(typeof options.value==="string"){dataView=hexStringToDataView(options.value)}else{dataView=options.value}await(descriptor===null||descriptor===void 0?void 0:descriptor.writeValue(dataView))}async startNotifications(options){const characteristic=await this.getCharacteristic(options);characteristic===null||characteristic===void 0?void 0:characteristic.removeEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback);characteristic===null||characteristic===void 0?void 0:characteristic.addEventListener("characteristicvaluechanged",this.onCharacteristicValueChangedCallback);await(characteristic===null||characteristic===void 0?void 0:characteristic.startNotifications())}onCharacteristicValueChanged(event){var _a,_b;const characteristic=event.target;const key=`notification|${(_a=characteristic.service)===null||_a===void 0?void 0:_a.device.id}|${(_b=characteristic.service)===null||_b===void 0?void 0:_b.uuid}|${characteristic.uuid}`;this.notifyListeners(key,{value:characteristic.value})}async stopNotifications(options){const characteristic=await this.getCharacteristic(options);await(characteristic===null||characteristic===void 0?void 0:characteristic.stopNotifications())}getFilters(options){var _a;const filters=[];for(const service of(_a=options===null||options===void 0?void 0:options.services)!==null&&_a!==void 0?_a:[]){filters.push({services:[service],name:options===null||options===void 0?void 0:options.name,namePrefix:options===null||options===void 0?void 0:options.namePrefix})}if(((options===null||options===void 0?void 0:options.name)||(options===null||options===void 0?void 0:options.namePrefix))&&filters.length===0){filters.push({name:options.name,namePrefix:options.namePrefix})}return filters}getDeviceFromMap(deviceId){const device=this.deviceMap.get(deviceId);if(device===void 0){throw new Error('Device not found. Call "requestDevice", "requestLEScan" or "getDevices" first.')}return device}getBleDevice(device){var _a;const bleDevice={deviceId:device.id,name:(_a=device.name)!==null&&_a!==void 0?_a:void 0};return bleDevice}}}});var __require2=(x3=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b3)=>(typeof __require!=="undefined"?__require:a)[b3]}):x3)(function(x3){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw Error('Dynamic require of "'+x3+'" is not supported')});var x=class{data={};triggers={};ctr=0;constructor(e){typeof e=="object"&&(this.data=e)}setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let n of t)this.triggerEvent(n,this.data[n]);if(this.triggers[G]){let n=r=>{r(e)},s=this.triggers[G].length;for(let r=s-1;r>=0;r--)n(this.triggers[G][r].onchange)}return this.data};setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};triggerEvent=(e,t)=>{if(this.triggers[e]){let n=r=>{r.onchange(t)},s=this.triggers[e].length;for(let r=s-1;r>=0;r--)n(this.triggers[e][r])}};subscribeState=e=>this.subscribeEvent(G,e);unsubscribeState=e=>this.unsubscribeEvent(G,e);subscribeEvent=(e,t,n,s)=>{if(e){n&&s&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>n[s],set:_2=>{n[s]=_2},enumerable:true,configurable:true}),this.triggers[e]||(this.triggers[e]=[]);let r=this.ctr;return this.ctr++,this.triggers[e].push({sub:r,onchange:t}),r}else return};unsubscribeEvent=(e,t)=>{let n=this.triggers[e];if(n)if(t===void 0)delete this.triggers[e],delete this.data[e];else{let s,r=n.find((_2,o)=>{if(_2.sub===t)return s=o,true});return r&&n.splice(s,1),Object.keys(n).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(r),true}};subscribeEventOnce=(e,t)=>{let n,s=r=>{t(r),this.unsubscribeEvent(e,n)};return n=this.subscribeEvent(e,s),n};getEvent=(e,t)=>{if(typeof t!="number")return this.triggers[e];for(let n in this.triggers[e])if(this.triggers[e][n].sub===t)return this.triggers[e][n]};getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};onRemoved};var G="*s";var q=new x;var w=class extends Function{__bound;__call;constructor(){return super("return this.__bound.__call.apply(this.__bound, arguments)"),this.__bound=this.bind(this),this.__bound}};var y=class i{__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:q};__children;__parent;__operator;__listeners;__props;__args;constructor(e,t,n){if(this.__setProperties(e,t,n),typeof e=="function"||e?.__callable){let s=new w;s.__call=(..._2)=>this.__operator(..._2);let r=new Proxy(s,{get:(_2,o,a)=>Reflect.has(this,o)?Reflect.get(this,o,a):Reflect.get(_2,o,a),set:(_2,o,a,f2)=>Reflect.has(this,o)?Reflect.set(this,o,a,f2):Reflect.set(_2,o,a,f2)});return Object.setPrototypeOf(r,this),r}}get __graph(){return this.__node?.graph}set __graph(e){this.__node.graph=e}__setProperties=(e,t,n)=>{if((()=>{let r=e;typeof e=="function"?S(e)?e=new e:e={__operator:e,__node:{forward:true,tag:e.name}}:typeof e=="string"&&n?.get(e)&&(e=n.get(e)),"__node"in e||(e.__node={}),e.__node.initial||(e.__node.initial=r)})(),typeof e=="object"){let r=()=>{e.__node?.state?this.__node.state=e.__node.state:n&&(e.__node.state=n.__node.state)},_2=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},o=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},a=()=>{typeof e.__node=="string"?n?.get(e.__node.tag)?e=n.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),n&&(e.__node.graph=n),e instanceof b&&(e.__node.source=e)},f2=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof b||e instanceof b)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof b&&e instanceof b&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(h2=>{t.set(e.__node.tag+"."+h2.__node.tag,h2)});let u=()=>{e.__node.nodes.forEach(h2=>{t.__node.nodes.delete(e.__node.tag+"."+h2.__node.tag)})};this.__addOndisconnected(u)}},l=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&n){let u=n.get(e.__operator);u&&(e.__operator=u.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},c2=()=>{e.__node=Object.assign(this.__node,e.__node);let u=Object.getOwnPropertyNames(e).filter(h2=>{if(!O[h2])return true});for(let h2 of u)h2 in e&&h2!=="name"&&(this[h2]=e[h2])},d2=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(u=>u.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(u=>u.bind(this))))};r(),o(),_2(),a(),f2(),c2(),d2(),l()}};__subscribe=(e,t,n,s,r,_2,o)=>{let a=(l,c2=(u,h2)=>h2||u,d2=e)=>{let u;if(_2){let p2=j(d2,_2,this.__node.graph);d2=p2.__callback,u=p2.__args}let h2=this.__node.state.subscribeEvent(l,d2,this,t),g2=this.__node.state.getEvent(l,h2);return this.__listeners||(this.__listeners={}),this.__listeners[l]=this.__node.state.triggers[l],g2&&(g2.source=this.__node.tag,t&&(g2.key=t),g2.target=c2(e,s),r&&(g2.tkey=r),n&&(g2.subInput=n),_2&&(g2.arguments=u,g2.__args=_2),o&&(g2.__callback=o),g2.node=this,g2.graph=this.__node.graph),h2},f2=l=>{let c2=this.__node.graph.get(l);if(!c2&&l.includes(".")){s=l.substring(0,l.lastIndexOf("."));let d2=this.__node.graph.get(l.substring(0,s));r=l.lastIndexOf(".")+1,d2&&typeof d2[t]=="function"&&(l=(...u)=>d2[r](...u))}else c2.__operator&&(l=c2.__operator,r="__operator");return l};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(o=this.__node.tag+"."+e,r=e,s){if(this.__node.graph?.get(s)){let d2=this.__node.graph?.get(s);if(typeof d2[e]=="function"){let u=d2[e];e=(...h2)=>{u(...h2)}}else{let u=e;e=g2=>{d2[u]=g2}}}}else if(typeof this[e]=="function"){let d2=this[e];e=(...u)=>{d2(...u)}}else this.__node.graph?.get(e)&&(e=f2(e));if(typeof e!="function")return}let l,c2=n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"&&!e?.__node?l=a(c2,(d2,u)=>u||d2,e):e?.__node&&(l=a(c2,(d2,u)=>u||d2.__node.unique,(...d2)=>{e.__operator&&e.__operator(...d2)})),l}else{if(typeof e=="string"&&(o=e,s||(s=e),this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),r="__operator",typeof e!="object"))return;let l,c2=n?this.__node.unique+"input":this.__node.unique;return typeof e=="function"&&!e?.__node?l=a(c2,(d2,u)=>u||d2,e):e?.__node&&(l=a(c2,(d2,u)=>u||d2.__node.unique,(...d2)=>{e.__operator&&e.__operator(...d2)})),l}};__unsubscribe=(e,t,n)=>t?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,e);__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=j(e,this.__args,this.__node.graph).__callback);let t=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,n);let s=e(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof s?.then=="function"?s.then(r=>{r!==void 0&&this.__node.state.setValue(this.__node.unique,r)}).catch(console.error):s!==void 0&&this.__node.state.setValue(this.__node.unique,s)),s},this.__parent instanceof i&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),s=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(s),this.__subscribedToParent=true}return this.__operator};__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let n=this.__node.localState,s=(r,_2)=>{let o=this.__node.unique+"."+_2,a=`${o}input`,f2,l,c2,d2;if(typeof r[_2]=="function"&&_2!=="__operator")this.__props?.[_2]?c2=this.__props:c2=n,f2=()=>c2[_2],l=u=>{this.__props?.[_2]||(u=u.bind(this)),c2[_2]=(...h2)=>{this.__node.state.triggers[a]&&this.__node.state.setValue(a,h2);let g2=u(...h2);return this.__node.state.triggers[o]&&(typeof g2?.then=="function"?g2.then(p2=>{this.__node.state.triggerEvent(o,p2)}).catch(console.error):this.__node.state.triggerEvent(o,g2)),g2}},n[_2]=r[_2].bind(this),d2={get:f2,set:l,enumerable:true,configurable:true};else if(_2!=="__graph"){let u,h2,g2;this.__props?.[_2]?g2=this.__props:g2=n,u=()=>g2[_2],h2=p2=>{g2[_2]=p2,this.__node.state.triggers[o]&&this.__node.state.triggerEvent(o,p2)},n[_2]=r[_2],d2={get:u,set:h2,enumerable:true,configurable:true}}if(Object.defineProperty(r,_2,d2),typeof this.__node.initial=="object"){let u=Object.getOwnPropertyDescriptor(this.__node.initial,_2);(u===void 0||u?.configurable)&&Object.defineProperty(this.__node.initial,_2,d2)}};if(t)s(e,t);else for(let r in e)s(e,r)};__proxyObject=e=>{let t=I(e);for(let n of t){let s={get:()=>e[n],set:r=>{e[n]=r},enumerable:true,configurable:true};if(Object.defineProperty(this,n,s),typeof this.__node.initial=="object"){let r=Object.getOwnPropertyDescriptor(this.__node.initial,n);(r===void 0||r?.configurable)&&Object.defineProperty(this.__node.initial,n,s)}}};__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=n=>{n(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=n=>{n(this)};this.__ondisconnected.forEach(t)}}};var b=class i2{__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:q,roots:{}};constructor(e){this.init(e)}init=e=>{if(e){let t=Object.assign({},e);delete t.roots,N(this.__node,t),e.roots&&this.load(e.roots)}};load=(e,t=false)=>{function n(_2,o,a=true,f2=true){if(f2){_2||(_2={});for(let l in o)!l.startsWith("__")&&o[l]&&typeof o[l]=="object"?(_2[l]=o[l],o[l]?.__children&&n({},o[l].__children,false,false)):typeof o[l]=="function"&&(_2[l]=o[l]);n(_2,o,true,false)}else if(o?.__children&&!a)o.__children?.constructor.name==="Object"?_2.__children?.constructor.name==="Object"?_2.__children=n(_2.__children,o.__children,true,false):_2.__children=n({},o.__children,true,false):_2.__children=o.__children;else if(a)for(let l in o)!l.startsWith("__")&&o[l]&&typeof o[l]=="object"?(_2[l]=Object.assign({},o[l]),o[l]?.__children&&(_2[l].__children=n({},o[l].__children,false,false))):typeof o[l]=="function"&&(_2[l]=o[l]);return _2}this.__node.roots=n(this.__node.roots?this.__node.roots:{},e);let s=Object.assign({},e);s.__node&&delete s.__node;let r=this.recursiveSet(s,this,void 0,e,t);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let _2=new y(e,this,this);this.set(_2.__node.tag,_2),this.runLoaders(_2,this,e,e.__node.tag),_2.__listeners&&(r[_2.__node.tag]=_2.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(r),s};setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);runLoaders=(e,t,n,s)=>{for(let r in this.__node.loaders)typeof this.__node.loaders[r]=="object"?(this.__node.loaders[r].init&&this.__node.loaders[r](e,t,this,this.__node.roots,n,s),this.__node.loaders[r].connected&&e.__addOnconnected(this.__node.loaders[r].connect),this.__node.loaders[r].disconnected&&e.__addOndisconnected(this.__node.loaders[r].disconnect)):typeof this.__node.loaders[r]=="function"&&this.__node.loaders[r](e,t,this,this.__node.roots,n,s)};add=(e,t,n=true)=>{let s={};typeof t=="string"&&(t=this.get(t));let r;if(typeof e=="function"?S(e)?e.prototype instanceof y?(e=e.prototype.constructor(e,t,this),r=true):e=new e:e={__operator:e,__callable:true}:typeof e=="string"&&(e=this.__node.roots[e]),!e)return;if(!r){let a=Object.getOwnPropertyNames(e),f2=Object.getOwnPropertyNames(Object.getPrototypeOf(e));a.push(...f2),a=a.filter(c2=>!O.includes(c2));let l={};for(let c2 of a)l[c2]=e[c2];e=l}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&this.get(e.__node.tag))if(n)this.remove(e.__node.tag,true);else return;else if(e.__node.tag&&this.get(e.__node.tag))return this.get(e.__node.tag);let _2,o=N({},e,2);if(r?_2=e:_2=new y(e,t,this),this.set(_2.__node.tag,_2),this.runLoaders(_2,t,e,_2.__node.tag),this.__node.roots[_2.__node.tag]=o,_2.__children&&(_2.__children=Object.assign({},_2.__children),this.recursiveSet(_2.__children,_2,s,_2.__children)),_2.__listeners){s[_2.__node.tag]=Object.assign({},_2.__listeners);for(let a in _2.__listeners){let f2=_2.__listeners[a];_2[a]&&(delete s[_2.__node.tag][a],s[_2.__node.tag][_2.__node.tag+"."+a]=f2),typeof f2=="string"&&(_2.__children?.[f2]?s[_2.__node.tag][a]=_2.__node.tag+"."+f2:t instanceof y&&(t.__node.tag===f2||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===f2)&&(s[_2.__node.tag][a]=t.__node.tag))}}return this.setListeners(s),_2.__callConnected(),_2};recursiveSet=(e,t,n={},s,r=false)=>{let _2=Object.getOwnPropertyNames(s).filter(a=>!O.includes(a)),o=Object.getOwnPropertyNames(Object.getPrototypeOf(s)).filter(a=>!O.includes(a));_2.push(...o);for(let a of _2){if(a.includes("__"))continue;let f2=s[a];if(Array.isArray(f2))continue;let l;if(typeof f2=="function"?S(f2)?(f2=new f2,f2 instanceof y&&(f2=f2.prototype.constructor(f2,t,this),l=true)):f2={__operator:f2,__callable:true}:typeof f2=="string"?this.__node.nodes.get(f2)?f2=this.__node.nodes.get(f2):f2=this.__node.roots[f2]:typeof f2=="boolean"&&(this.__node.nodes.get(a)?f2=this.__node.nodes.get(a):f2=this.__node.roots[a]),f2&&typeof f2=="object"){if(!l&&!(f2 instanceof y)){let h2=Object.getOwnPropertyNames(f2).filter(m2=>!O.includes(m2)),g2=Object.getOwnPropertyNames(Object.getPrototypeOf(f2)).filter(m2=>!O.includes(m2));g2.splice(g2.indexOf("constructor"),1),h2.push(...g2);let p2={};for(let m2 of h2)p2[m2]=f2[m2];f2=p2}if(f2.__node||(f2.__node={}),f2.__node.tag||(f2.__node.tag=a),f2.__node.initial||(f2.__node.initial=e[a]),r&&this.get(f2.__node.tag))this.remove(f2.__node.tag,true);else if(this.get(f2.__node.tag)&&!(!(t instanceof i2)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+f2.__node.tag))continue;let c2,d2=false,u=N({},f2,2);if(l||f2 instanceof y?c2=f2:(c2=new y(f2,t,this),d2=true),!d2&&f2 instanceof y&&!l&&t instanceof y){let h2=this.subscribe(t.__node.tag,c2.__node.tag),g2=p2=>{this.unsubscribe(t.__node.tag,h2)};c2.__addOndisconnected(g2)}else if(c2){if(this.set(c2.__node.tag,c2),this.runLoaders(c2,t,e[a],a),e[a]=c2,this.__node.roots[c2.__node.tag]=u,c2.__children&&(c2.__children=Object.assign({},c2.__children),this.recursiveSet(c2.__children,c2,n,c2.__children)),c2.__listeners){n[c2.__node.tag]=Object.assign({},c2.__listeners);for(let h2 in c2.__listeners){let g2=c2.__listeners[h2],p2=h2;c2[h2]&&(delete n[c2.__node.tag][h2],p2=c2.__node.tag+"."+h2,n[c2.__node.tag][p2]=g2),typeof g2=="string"&&(c2.__children?.[g2]?n[c2.__node.tag][p2]=c2.__node.tag+"."+g2:t instanceof y&&(t.__node.tag===g2||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===g2)&&(n[c2.__node.tag][p2]=t.__node.tag))}}c2.__callConnected()}}}return n};remove=(e,t=true)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof y){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let n=s=>{for(let r in s)this.unsubscribe(s[r]),this.delete(s[r].__node.tag),delete this.__node.roots[s[r].__node.tag],this.delete(r),delete this.__node.roots[r],s[r].__node.tag=s[r].__node.tag.substring(s[r].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(s[r]),s[r].__callDisconnected(),s[r].__children&&n(s[r].__children)};e.__children&&n(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e?.__node.graph&&(e.__node.graph=void 0),e};run=(e,...t)=>{if(typeof e=="string"){let n=this.get(e);if(!n&&e.includes(".")){if(n=this.get(e.substring(0,e.lastIndexOf("."))),typeof n?.[e.substring(e.lastIndexOf(".")+1)]=="function")return n[e.substring(e.lastIndexOf(".")+1)](...t)}else if(n?.__operator)return n.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};setListeners=e=>{for(let t in e){let n=this.get(t);if(typeof e[t]=="object")for(let s in e[t]){let r=this.get(s),_2;if(typeof e[t][s]!="object")e[t][s]={__callback:e[t][s]};else if(!e[t][s].__callback)for(let o in e[t][s]){typeof e[t][s][o]!="object"&&(e[t][s][o]={__callback:e[t][s][o]},n.__operator&&(e[t][s][o].__callback===true||typeof e[t][s][o].__callback>"u")&&(e[t][s][o].__callback=n.__operator));let a=this.get(o);if(a)_2=this.subscribe(a,e[t][s][o].__callback,e[t][s][o].__args,void 0,e[t][s][o].subInput,t);else{let f2=s.substring(0,s.lastIndexOf("."));if(a=this.get(f2),a){let l=s.substring(s.lastIndexOf(".")+1);_2=this.subscribe(a,e[t][s][o].__callback,e[t][s][o].__args,l,e[t][s][o].subInput,t)}}}if("__callback"in e[t][s])if(n&&((e[t][s].__callback===true||typeof e[t][s].__callback>"u")&&(e[t][s].__callback=n.__operator),typeof e[t][s].__callback=="function"&&(e[t][s].__callback=e[t][s].__callback.bind(n))),r)_2=this.subscribe(r,e[t][s].__callback,e[t][s].__args,void 0,e[t][s].subInput,t);else{let o=s.substring(0,s.lastIndexOf("."));r=this.get(o),r&&(_2=this.subscribe(r,e[t][s].__callback,e[t][s].__args,s.substring(s.lastIndexOf(".")+1),e[t][s].subInput,t))}}}};clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let n in e.__listeners){if(t&&n!==t||typeof e.__listeners[n]?.sub!="number")continue;let s=this.get(n);if(s)if(typeof!e.__listeners[n]?.__callback=="number")for(let r in e.__listeners[n])e.__listeners[n][r]?.sub&&(this.unsubscribe(s,e.__listeners[n][r].sub,void 0,e.__listeners[n][r].subInput),e.__listeners[n][r].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n].sub,void 0,e.__listeners[n].subInput),e.__listeners[n].sub=void 0);else if(s=this.get(n.substring(0,n.lastIndexOf("."))),s)if(typeof e.__listeners[n]=="object"&&!e.__listeners[n]?.__callback)for(let r in e.__listeners[n])typeof e.__listeners[n][r]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n][r].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n][r].subInput),e.__listeners[n][r].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n].subInput),e.__listeners[n].sub=void 0)}};get=e=>this.__node.nodes.get(e);getByUnique=e=>Array.from(this.__node.nodes.values()).find(t=>{if(t.__node.unique===e)return true});set=(e,t)=>this.__node.nodes.set(e,t);delete=e=>this.__node.nodes.delete(e);list=()=>Array.from(this.__node.nodes.keys());getListener=(e,t,n)=>{let s=this.get(e);if(s){let r=s.__node.unique;return t&&(r+="."+t),this.__node.state.getEvent(r,n)}};getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof y){let n;if(t)n=Object.assign({},this.__node.roots[e.__node.tag]);else{n=Object.assign({},e);for(let s in n)s.includes("__")&&delete n[s]}}};subscribe=(e,t,n,s,r,_2,o)=>{let a=e;typeof e=="string"&&(a=this.get(e),!a&&e.includes(".")&&(a=this.get(e.substring(0,e.lastIndexOf("."))),s=e.substring(e.lastIndexOf(".")+1))),_2 instanceof y&&(_2=_2.__node.tag);let f2;if(typeof t=="string"){f2=t;let c2=d2=>{if(this.get(d2)?.__operator){let u=this.get(d2);_2=d2,d2=function(...h2){return u.__operator(...h2)}}else if(d2.includes(".")){_2=d2.substring(0,d2.lastIndexOf("."));let u=this.get(_2),h2=d2.substring(d2.lastIndexOf(".")+1);o=h2,typeof u[h2]=="function"?u[h2]instanceof y?d2=u[h2]:d2=function(...g2){return u[h2](...g2)}:d2=function(g2){return u[h2]=g2,u[h2]}}return d2};if(_2){let d2=this.get(_2);typeof d2?.[t]=="function"?(o=t,t=function(...u){return d2[s](...u)}):d2?.[s]?(o=s,d2[s]instanceof y?t=d2[s]:t=function(u){return d2[s]=u,d2[s]}):t=c2(t)}else t=c2(t)}let l;if(a instanceof y){let c2=()=>{l=a.__subscribe(t,s,r,_2,o,n,f2);let d2=()=>{l!==void 0&&a.__unsubscribe(l,s,r),l=void 0};a.__addOndisconnected(()=>{d2(),a.__addOnconnected(()=>{l===void 0&&a.__node.graph.__node.tag===this.__node.tag&&c2()})}),typeof t=="string"&&this.get(t)&&(t=this.get(t)),t instanceof y&&t.__addOndisconnected(()=>{d2()})};c2()}else if(typeof e=="string"){let c2=this.get(e);if(c2){if(t instanceof y&&t.__operator){let d2=()=>{l=c2.__subscribe(t.__operator,s,r,_2,o,n,f2);let u=()=>{l!==void 0&&c2.__unsubscribe(l,s,r)};c2.__addOndisconnected(()=>{u(),c2.__addOnconnected(()=>{l===void 0&&c2.__node.graph.__node.tag===this.__node.tag&&d2()})}),t.__addOndisconnected(u)};d2()}else if(typeof t=="function"||typeof t=="string"){let d2=()=>{l=c2.__subscribe(t,s,r,_2,o,n,f2);let u=()=>{l!==void 0&&c2.__unsubscribe(l,s,r),l=void 0};c2.__addOndisconnected(()=>{u(),c2.__addOnconnected(()=>{l===void 0&&c2.__node.graph.__node.tag===this.__node.tag&&d2()})}),typeof t=="string"&&this.get(t)&&this.get(t).__addOndisconnected(u)};d2()}}else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&!t?.__node&&(l=this.__node.state.subscribeEvent(e,t))}return l};unsubscribe=(e,t,n,s)=>e instanceof y?e.__unsubscribe(t,n,s):this.get(e)?.__unsubscribe(t,n,s);setState=e=>{this.__node.state.setState(e)}};function N(i3,e,t=1/0,n=0){for(let s in e)e[s]?.constructor.name==="Object"&&n<t?(n++,i3[s]?.constructor.name==="Object"?N(i3[s],e[s],t,n):i3[s]=N({},e[s],t,n)):i3[s]=e[s];return i3}function I(i3){var e=[],t=i3;do{var n=Object.getOwnPropertyNames(t);let s=function(r){e.indexOf(r)===-1&&e.push(r)};n.forEach(s)}while(t=Object.getPrototypeOf(t));return e}function S(i3){return R(i3)==="class"}function R(i3){return typeof i3=="function"?i3.prototype?Object.getOwnPropertyDescriptor(i3,"prototype")?.writable?"function":"class":i3.constructor.name==="AsyncFunction"?"async":"arrow":""}var A=(i3,e)=>{if(e.get(i3)?.__operator){let t=e.get(i3);return(...n)=>{t.__operator(...n)}}else if(i3.includes(".")){let t=i3.split("."),n=t.pop(),s=t.join("."),r=e.get(s);return typeof e.get(s)?.[n]=="function"?(..._2)=>r[n](..._2):()=>r[n]}else if(e.get(i3)){let t=e.get(i3);return()=>t}else{let t=i3;return()=>t}};var j=(i3,e,t)=>{let n=[],s=(_2,o)=>{if(_2==="__output"||_2==="__input"||_2==="__callback")n[o]={__callback:a=>a,__args:void 0,idx:o};else if(typeof _2=="string")n[o]={__callback:A(_2,t),__args:void 0,idx:o};else if(typeof _2=="function"){let a=_2;n[o]={__callback:(...f2)=>a(...f2),__args:void 0,idx:o}}else if(typeof _2=="object"&&(_2.__input||_2.__callback)){let a=function(f2){let l=f2.__input?f2.__input:f2.__callback;if(typeof f2.__input=="string"&&(l={__callback:A(f2.__input,t),__args:void 0,idx:o}),f2.__args){let c2=j(l,f2.__args,t);l={__callback:c2.__callback,__args:c2.__args,idx:o}}else l={__callback:l,__args:void 0,idx:o};if(f2.__output){let c2=f2.__output;if(typeof f2.__output=="string"?c2={__callback:A(c2,t),__args:void 0,idx:o}:typeof _2.__output=="object"&&(c2=a(c2)),typeof c2?.__callback=="function"){let d2=l.__callback,u=c2.__callback;l={__callback:(...h2)=>u(d2(...h2)),__args:c2.__args,idx:o}}}return l};n[o]=a(_2)}else{let a=_2;n[o]={__callback:()=>a,__args:void 0,idx:o}}};e.forEach(s),typeof i3=="string"&&(i3={__callback:A(i3,t),__args:void 0});let r=typeof i3=="function"?i3:i3.__callback;return i3=function(..._2){let o=f2=>f2.__callback(..._2);return r(...n.map(o))},{__callback:i3,__args:n}};var O=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var C=(i3,e,t)=>{i3.__node.backward&&e instanceof y&&t.setListeners({[e.__node.tag]:{[i3.__node.tag]:e}})};var T=(i3,e,t)=>{if(i3.__operator){let n=Math.random();if(i3.__node.loops||(i3.__node.loops={}),typeof i3.__node.delay=="number"){let s=i3.__operator;i3.__setOperator((...r)=>new Promise((_2,o)=>{i3.__node.loops[n]=setTimeout(async()=>{_2(await s(...r))},i3.__node.delay)}))}else if(i3.__node.frame===true){let s=i3.__operator;i3.__setOperator((...r)=>new Promise((_2,o)=>{i3.__node.loops[n]=requestAnimationFrame(async()=>{_2(await s(...r))})}))}if(typeof i3.__node.repeat=="number"||typeof i3.__node.recursive=="number"){let s=i3.__operator;i3.__setOperator(async(...r)=>{let _2=i3.__node.repeat?i3.__node.repeat:i3.__node.recursive,o,a=async(f2,...l)=>{for(;f2>0;){if(i3.__node.delay||i3.__node.frame){s(...l).then(async c2=>{i3.__node.recursive?await a(f2,c2):await a(f2,...l)});break}else o=await s(...r);f2--}};return await a(_2,...r),o})}if(i3.__node.loop&&typeof i3.__node.loop=="number"){let s=i3.__operator,r=i3.__node.loop;i3.__setOperator((...o)=>{if("looping"in i3.__node||(i3.__node.looping=true),i3.__node.looping){let a=performance.now();s(...o),i3.__node.loops[n]=setTimeout(()=>{let l=performance.now()-a-i3.__node.loop;l>0?r=i3.__node.loop-l:r=i3.__node.loop,r<=0&&(r=i3.__node.loop),i3.__operator(...o)},r)}}),i3.__node.looping&&i3.__operator();let _2=o=>{o.__node.looping&&(o.__node.looping=false),o.__node.loops[n]&&(clearTimeout(o.__node.loops[n]),cancelAnimationFrame(o.__node.loops[n]))};i3.__addOndisconnected(_2)}}};var $=(i3,e,t)=>{if(i3.__node.animate===true||i3.__animation){let n=i3.__operator;i3.__setOperator((...r)=>{"animating"in i3.__node||(i3.__node.animating=true),i3.__node.animating&&(typeof i3.__animation=="function"?i3.__animation(...r):n(...r),i3.__node.animationFrame=requestAnimationFrame(()=>{i3.__operator(...r)}))}),(i3.__node.animating||(!("animating"in i3.__node)||i3.__node.animating)&&i3.__animation)&&setTimeout(()=>{i3.__node.animationFrame=requestAnimationFrame(i3.__operator)},10);let s=r=>{r.__node.animating&&(r.__node.animating=false),r.__node.animationFrame&&cancelAnimationFrame(r.__node.animationFrame)};i3.__addOndisconnected(s)}};var J=(i3,e,t)=>{if(typeof i3.__branch=="object"&&i3.__operator&&!i3.__branchApplied){let n=i3.__operator;i3.__branchApplied=true,i3.__operator=(...s)=>{let r=n(...s);for(let _2 in i3.__branch){let o=()=>{typeof i3.__branch[_2].then=="function"?i3.__branch[_2].then(r):i3.__branch[_2].then instanceof y&&i3.__branch[_2].then.__operator?i3.__branch[_2].then.__operator(r):r=i3.__branch[_2].then};typeof i3.__branch[_2].if=="function"?i3.__branch[_2].if(r)==true&&o():i3.__branch[_2].if===r&&o()}return r}}if(i3.__listeners){for(let n in i3.__listeners)if(typeof i3.__listeners[n]=="object"&&i3.__listeners[n].branch&&!i3.__listeners[n].branchApplied){let s=i3.__listeners[n].callback;i3.__listeners[n].branchApplied=true,i3.__listeners.callback=r=>{let _2=()=>{typeof i3.__listeners[n].branch.then=="function"?r=i3.__listeners[n].branch.then(r):i3.__listeners[n].branch.then instanceof y&&i3.__listeners[n].branch.then.__operator?r=i3.__listeners[n].branch.then.__operator(r):r=i3.__listeners[n].branch.then};return typeof i3.__listeners[n].branch.if=="function"?i3.__listeners[n].branch.if(r)&&_2():i3.__listeners[n].branch.if===r&&_2(),s(r)}}}};var W=(i3,e,t)=>{if(i3.__listeners)for(let n in i3.__listeners)typeof i3.__listeners[n]=="object"&&i3.__listeners[n].oncreate&&i3.__listeners[n].callback(i3.__listeners[n].oncreate)};var V=(i3,e,t)=>{if(i3.__listeners)for(let n in i3.__listeners)typeof i3.__listeners[n]=="object"&&typeof i3.__listeners[n].binding=="object"&&(i3.__listeners.callback=i3.__listeners.callback.bind(i3.__listeners[n].binding))};var B=(i3,e,t)=>{if(i3.__listeners){for(let n in i3.__listeners)if(typeof i3.__listeners[n]=="object"&&typeof i3.__listeners[n].transform=="function"&&!i3.__listeners[n].transformApplied){let s=i3.__listeners[n].callback;i3.__listeners[n].transformApplied=true,i3.__listeners.callback=r=>(r=i3.__listeners[n].transform(r),s(r))}}};var H=(i3,e,t)=>{i3.post&&!i3.__operator?i3.__setOperator(i3.post):!i3.__operator&&typeof i3.get=="function"&&i3.__setOperator(i3.get),!i3.get&&i3.__operator,i3.aliases&&i3.aliases.forEach(n=>{t.set(n,i3);let s=r=>{t.__node.nodes.delete(n)};i3.__addOndisconnected(s)}),typeof t.__node.roots?.[i3.__node.tag]=="object"&&i3.get&&(t.__node.roots[i3.__node.tag].get=i3.get)};var F={backprop:C,loop:T,animate:$,branching:J,triggerListenerOncreate:W,bindListener:V,transformListenerResult:B,substitute__operator:H};var U=i3=>{let e={};for(let t in i3)typeof i3[t]=="object"?e[t]=U(i3[t]):typeof i3[t]=="function"?e[t]=i3[t].toString():e[t]=i3[t];return e};function se(i3){typeof i3!="string"&&(i3=i3.toString());let e=i3.match(/\(?[^]*?\)?\s*=>/);if(e)return e[0].replace(/[()\s]/gi,"").replace("=>","").split(",");let t=i3.match(/\([^]*?\)/);return t?t[0].replace(/[()\s]/gi,"").split(","):[]}var D=i3=>{let e=i3.indexOf("=>")+1;return e<=0&&(e=i3.indexOf("){")),e<=0&&(e=i3.indexOf(") {")),i3.slice(0,i3.indexOf("{",e)+1)};function P(i3=""){let e=r=>r.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),t=D(i3),n=e(i3),s;if(t.includes("function")){let r=t.substring(t.indexOf("(")+1,t.lastIndexOf(")"));s=new Function(r,n)}else if(t.substring(0,6)===n.substring(0,6)){let r=t.substring(t.indexOf("(")+1,t.lastIndexOf(")"));s=new Function(r,n.substring(n.indexOf("{")+1,n.length-1))}else try{s=(0,eval)(i3)}catch{}return s}var k=function(){let i3=new Map,e=[],t=["this"];function n(){i3.clear(),e.length=0,t.length=1}function s(_2,o){var a=e.length-1,f2=e[a];if(typeof f2=="object")if(f2[_2]===o||a===0)t.push(_2),e.push(o.pushed);else for(;a-->=0;){if(f2=e[a],typeof f2=="object"&&f2[_2]===o){a+=2,e.length=a,t.length=a,--a,e[a]=o,t[a]=_2;break}a--}}function r(_2,o){if(o!=null&&typeof o=="object"){_2&&s(_2,o);let a=i3.get(o);if(a)return"[Circular Reference]"+a;i3.set(o,t.join("."))}return o}return function(o,a){try{return e.push(o),JSON.stringify(o,r,a)}finally{n()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=k);var z=function(){let i3=new Map,e=[],t=["this"];function n(){i3.clear(),e.length=0,t.length=1}function s(_2,o){var a=e.length-1,f2=e[a];if(typeof f2=="object")if(f2[_2]===o||a===0)t.push(_2),e.push(o.pushed);else for(;a-->=0;){if(f2=e[a],typeof f2=="object"&&f2[_2]===o){a+=2,e.length=a,t.length=a,--a,e[a]=o,t[a]=_2;break}a--}}function r(_2,o){if(o!=null&&typeof o=="object"){_2&&s(_2,o);let a=i3.get(o);if(a)return"[Circular Reference]"+a;i3.set(typeof o=="function"?o.toString():o,t.join("."))}return typeof o=="function"?o.toString():o}return function(o,a){try{return e.push(o),JSON.stringify(o,r,a)}finally{n()}}}();JSON.stringifyWithFunctionsAndCircularRefs===void 0&&(JSON.stringifyWithFunctionsAndCircularRefs=z);var Q=function(){let i3=new Map,e=[],t=["this"];function n(){i3.clear(),e.length=0,t.length=1}function s(_2,o){var a=e.length-1;if(e[a]){var f2=e[a];if(typeof f2=="object")if(f2[_2]===o||a===0)t.push(_2),e.push(o.pushed);else for(;a-->=0;){if(f2=e[a],typeof f2=="object"&&f2[_2]===o){a+=2,e.length=a,t.length=a,--a,e[a]=o,t[a]=_2;break}a++}}}function r(_2,o){let a;if(o!=null)if(typeof o=="object"){let f2=o.constructor.name;_2&&f2==="Object"&&s(_2,o);let l=i3.get(o);if(l)return"[Circular Reference]"+l;if(i3.set(o,t.join(".")),f2==="Array")o.length>20?a=o.slice(o.length-20):a=o;else if(f2.includes("Set"))a=Array.from(o);else if(f2!=="Object"&&f2!=="Number"&&f2!=="String"&&f2!=="Boolean")a="instanceof_"+f2;else if(f2==="Object"){let c2={};for(let d2 in o)if(o[d2]==null)c2[d2]=o[d2];else if(Array.isArray(o[d2]))o[d2].length>20?c2[d2]=o[d2].slice(o[d2].length-20):c2[d2]=o[d2];else if(o[d2].constructor.name==="Object"){c2[d2]={};for(let u in o[d2])if(Array.isArray(o[d2][u]))o[d2][u].length>20?c2[d2][u]=o[d2][u].slice(o[d2][u].length-20):c2[d2][u]=o[d2][u];else if(o[d2][u]!=null){let h2=o[d2][u].constructor.name;h2.includes("Set")?c2[d2][u]=Array.from(o[d2][u]):h2!=="Number"&&h2!=="String"&&h2!=="Boolean"?c2[d2][u]="instanceof_"+h2:c2[d2][u]=o[d2][u]}else c2[d2][u]=o[d2][u]}else{let u=o[d2].constructor.name;u.includes("Set")?c2[d2]=Array.from(o[d2]):u!=="Number"&&u!=="String"&&u!=="Boolean"?c2[d2]="instanceof_"+u:c2[d2]=o[d2]}a=c2}else a=o}else a=o;return a}return function(o,a){e.push(o);let f2=JSON.stringify(o,r,a);return n(),f2}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=Q);function ae(i3){if(typeof i3.__methods=="object")for(let e in i3.__methods){let t=i3.__methods[e],n=typeof t=="function"?t:P(t);e==="__operator"?i3.__setOperator(n):i3[e]=n.bind(i3)}}var L=class extends b{name=`service${Math.floor(Math.random()*1e15)}`;restrict;constructor(e){super({...e,loaders:e?.loaders?Object.assign({...F},e.loaders):{...F}}),e?.services&&this.addServices(e.services),e?.restrict&&(this.restrict=e.restrict),this.load(this)}addServices=e=>{for(let t in e)if(typeof e[t]=="function"&&(e[t]=new e[t]),e[t]?.__node?.loaders&&Object.assign(this.__node.loaders,e[t].__node.loaders),e[t]?.__node?.nodes){e[t].__node.nodes.forEach((r,_2)=>{this.get(_2)?this.set(t+"."+_2,r):this.set(_2,r)}),this.__node.nodes.forEach((r,_2)=>{e[t].__node.nodes.get(_2)||e[t].__node.nodes.set(_2,r)});let n=this.set;this.set=(r,_2)=>(e[t].set(r,_2),n(r,_2));let s=this.delete;this.delete=r=>(e[t].delete(r),s(r))}else typeof e[t]=="object"&&this.load(e[t])};handleMethod=(e,t,n)=>{let s=t.toLowerCase(),r=this.__node.nodes.get(e);if(r||(r=this.__node.roots[e]),r?.[s])if(typeof r[s]!="function"){if(n){Array.isArray(n)&&n.length===1?r[s]=n[0]:r[s]=n;return}return r[s]}else return Array.isArray(n)?r[s](...n):r[s](n);else return this.handleServiceMessage({route:e,args:n,method:t})};handleServiceMessage(e){let t;return typeof e=="object"&&(e.route?t=e.route:e.node&&(t=e.node)),t?Array.isArray(e.args)?this.run(t,...e.args):this.run(t,e.args):e}handleGraphNodeCall(e,t){if(!e)return t;if(t?.args)this.handleServiceMessage(t);else return Array.isArray(t)?this.run(e,...t):this.run(e,t)}transmit=(...e)=>{if(typeof e[0]=="object"){let t=e[0];if(t.method)return this.handleMethod(t.route,t.method,t.args);if(t.route)return this.handleServiceMessage(t);if(t.node)return this.handleGraphNodeCall(t.node,t.args);this.__node.keepState&&(t.route&&this.setState({[t.route]:t.args}),t.node&&this.setState({[t.node]:t.args}));return}else return};receive=(...e)=>{if(e[0]){let t=e[0];if(typeof t=="string"){let n=t.substring(0,8);(n.includes("{")||n.includes("["))&&(n.includes("\\")&&(t=t.replace(/\\/g,"")),t[0]==='"'&&(t=t.substring(1,t.length-1)),t=JSON.parse(t))}if(typeof t=="object"){if(t.method)return this.restrict?.[t.route]?void 0:this.handleMethod(t.route,t.method,t.args);if(t.route)return this.restrict?.[t.route]?void 0:this.handleServiceMessage(t);if(t.node)return typeof t.node=="string"&&this.restrict?.[t.node]?void 0:this.handleGraphNodeCall(t.node,t.args);this.__node.keepState&&(t.route&&this.setState({[t.route]:t.args}),t.node&&this.setState({[t.node]:t.args}));return}}};pipe=(e,t,n,s,r)=>{if(e instanceof y)return r?this.subscribe(e,_2=>{let o=r(_2);o!==void 0?this.transmit({route:t,args:o,method:s}):this.transmit({route:t,args:_2,method:s},n)}):this.subscribe(e,_2=>{this.transmit({route:t,args:_2,method:s},n)});if(typeof e=="string")return this.subscribe(e,_2=>{this.transmit({route:t,args:_2,method:s},n)})};pipeOnce=(e,t,n,s,r)=>{if(e instanceof y)return r?e.__node.state.subscribeEventOnce(e.__node.unique,_2=>{let o=r(_2);o!==void 0?this.transmit({route:t,args:o,method:s}):this.transmit({route:t,args:_2,method:s},n)}):this.__node.state.subscribeEventOnce(e.__node.unique,_2=>{this.transmit({route:t,args:_2,method:s},n)});if(typeof e=="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(e).__node.unique,_2=>{this.transmit({route:t,args:_2,method:s},n)})};terminate=(...e)=>{};isTypedArray=X;recursivelyAssign=M;spliceTypedArray=Y;ping=()=>(console.log("pinged!"),"pong");echo=(...e)=>(this.transmit(...e),e);log=(...e)=>(console.log(...e),true);error=(...e)=>(console.error(...e),true)};function X(i3){return ArrayBuffer.isView(i3)&&Object.prototype.toString.call(i3)!=="[object DataView]"}var M=(i3,e)=>{for(let t in e)e[t]?.constructor.name==="Object"&&!Array.isArray(e[t])?i3[t]?.constructor.name==="Object"&&!Array.isArray(i3[t])?M(i3[t],e[t]):i3[t]=M({},e[t]):i3[t]=e[t];return i3};function Y(i3,e,t){let n=i3.subarray(0,e),s;t&&(s=i3.subarray(t+1));let r;return(n.length>0||s?.length>0)&&(r=new i3.constructor(n.length+s.length)),r&&(n.length>0&&r.set(n),s&&s.length>0&&r.set(s,n.length)),r}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str3;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str3=U(properties)}else if(typeof properties==="function")str3=properties.toString();else if(typeof properties==="string")str3=properties;if(str3){if(connection.run)return connection.run("setNode",[str3]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str3},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str3}));return new Promise(r=>r(name2))}}},setNode:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=ae}}}if(typeof properties==="string"){let f2=P(properties);if(typeof f2==="function")properties={__operator:f2,__node:{tag:name2?name2:f2.name}};else{f2=JSON.parse(properties);if(typeof f2==="object")properties=f2}}if(typeof properties==="object"||typeof properties==="function"){let template={};if(typeof properties==="object")Object.assign(template,properties);else template.__operator=properties;let node=this.__node.graph.add(template);if(node){nodeTemplates[node.__node.tag]=template;return node.__node?.tag}else return false}else return false},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str3=U(properties);return str3},getListenerJSON:function(){const triggers=this.__node.state.triggers;let result={};for(const key in triggers){triggers[key].forEach(trigger=>{let t=trigger;if(!result[t.target])result[t.target]={};let l=t.source+(t.key?"."+t.key:"");result[t.target][l]={__callback:t.__callback};if(t.__args)result[t.target][l].__args=t.__args;if(t.subInput)result[t.target][l].subInput=t.subInput})}return result},makeRootTransferrable:function(){let roots={};for(const r in this.__node.graph.__node.roots){let properties=this.__node.graph.__node.roots[r];if(typeof properties==="function"){roots[r]=properties.toString()}else if(typeof properties!=="object"){roots[r]=properties}else{roots[r]={};let keys=Object.getOwnPropertyNames(properties).filter(v2=>!objProps.includes(v2));let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(properties)).filter(v2=>!objProps.includes(v2));keys.push(...nonArrowFunctions);for(const key of keys){if(typeof properties[key]==="function"){roots[r][key]=properties[key].toString()}else if(typeof properties[key]==="object")roots[r][key]=z(properties[key]);else roots[r][key]=properties[key]}}}return roots},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=ae}}}if(typeof properties==="string"){let f2=P(properties);if(typeof f2==="function"){if(!name2)name2=f2.name;properties={__operator:f2,__node:{tag:name2}}}else{f2=JSON.parse(properties);if(typeof f2==="object"){properties=f2;if(!name2&&f2.__node?.tag)name2=f2.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=M({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(nodeTag,fn,methodKey){if(typeof fn==="string"){let f2=P(fn);if(typeof f2==="function")fn=f2}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(nodeTag)){this.__node.graph.get(nodeTag)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key of properties){if(typeof node[key]==="function"){let str3=node[key].toString();let isNative=str3.indexOf("[native code]")>-1;result[key]={type:"function",args:se(node[key]),native:isNative}}else result[key]=typeof node[key]}return result}return void 0},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]?.type==="function"){if(props[key].native||props[key].args){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{proxy[key]=()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})}}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str3=classObj.toString();let message={route:"receiveClass",args:[str3,className]};if(connection.run)return connection.run("receiveClass",[str3,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str3,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str3,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str3=fn.toString();let message={route:"setNode",args:[str3,fnName]};if(connection.run)return connection.run("setNode",[str3,fnName]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:[str3,fnName]},void 0);return new Promise(r=>r(fnName))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:[str3,fnName]}));return new Promise(r=>r(fnName))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=P(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=P(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};var objProps=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var browser_default=Worker;var WorkerService=class extends L{name="worker";workers={};threadRot=0;connections;constructor(options){super();this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}loadWorkerRoute=(node,routeKey)=>{if(node.workerUrl)node.url=node.workerUrl;if(node._id)node.__node.tag=node._id;if(!node.__node.tag)node.__node.tag=routeKey;node._id=node.__node.tag;let worker;if(this.workers[node._id])worker=this.workers[node._id];else if(node.worker)worker=node.worker;if(!worker){worker=this.addWorker(node)}node.worker=worker;if(!node.__ondisconnected){let ondelete=rt=>{rt.worker?.terminate()};node.__addOndisconnected(ondelete)}if(node.transferFunctions){for(const prop in node.transferFunctions){this.transferFunction(worker,node.transferFunctions[prop],prop)}}if(node.transferClasses){for(const prop in node.transferClasses){this.transferClass(worker,node.transferClasses[prop],prop)}}if(worker){if(!node.__operator){node.__operator=(...args)=>{if(node.callback){if(!this.__node.nodes.get(node.__node.tag)?.__children)worker.post(node.callback,args);else return worker.run(node.callback,args)}else{if(!this.__node.nodes.get(node.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(node.init){worker.run(node.init,node.initArgs,void 0,node.initTransfer)}return worker}};workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?._id&&this.workers[rt._id]||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};addWorker=options=>{let worker;if(!options._id)options._id=`worker${Math.floor(Math.random()*1e15)}`;if(options.url)worker=new browser_default(options.url);else if(options.port){worker=options.port}else if(this.workers[options._id]){if(this.workers[options._id].port)worker=this.workers[options._id].port;else worker=this.workers[options._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options._id)};if(!options.onmessage)options.onmessage=ev=>{this.receive(ev.data);this.setState({[options._id]:ev.data})};if(!options.onerror){options.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options.onmessage;worker.onerror=options.onerror;let workersettings={worker,__node:{tag:options._id},send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options};let node=this.add(workersettings);this.workers[options._id]=node;node.__addOndisconnected(function(){terminate()});return this.workers[options._id]};open=this.addWorker;close=()=>{globalThis.close()};getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof browser_default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys=Object.keys(this.workers);this.workers[keys[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys.length)this.threadRot=0}return message};terminate=worker=>{let onclose;let str3;if(typeof worker==="string"){str3=worker;let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof browser_default){worker.terminate();if(onclose)onclose(worker);if(str3&&this.get(str3))this.remove(str3);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);if(str3&&this.get(str3))this.remove(str3);return true}return false};establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof browser_default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof browser_default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};runRequest=(message,worker,callbackId,getTransferable=true)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{let transfer=getTransferable?this.getTransferable(r):void 0;if(worker instanceof browser_default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId},transfer);else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId},transfer)})}else{let transfer=getTransferable?this.getTransferable(res):void 0;if(worker instanceof browser_default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId},transfer);else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId},transfer)}return res};subscribeWorker=(route,worker,args,key,subInput,blocking,getTransferable=true)=>{if(this.restrict?.[route])return void 0;let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{let transfer=getTransferable?this.getTransferable(r):void 0;if(worker?.postMessage)worker.postMessage({args:r,callbackId:route},transfer);else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route},transfer)})}else{let transfer=getTransferable?this.getTransferable(res):void 0;if(worker?.postMessage)worker.postMessage({args:res,callbackId:route},transfer);else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route},transfer)}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking,getTransferable=true)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking,getTransferable])}};triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i3=0;i3<this.__node.state.triggers[workerId].length;i3++){await this.__node.state.triggers[workerId][i3].onchange({args:result,callbackId:route})}return true};pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking,getTransferable)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking,getTransferable])};unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}}};var F2=(t=>typeof __require2<"u"?__require2:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof __require2<"u"?__require2:e)[n]}):t)(function(t){if(typeof __require2<"u")return __require2.apply(this,arguments);throw Error('Dynamic require of "'+t+'" is not supported')});var d=y2(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var j2=y2(["deltaX","deltaY"]);var G2=y2(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);var B2=y2(["alpha","beta","gamma","absolute","webkitCompassHeading","webkitCompassAccuracy"]);var K=(t,e,n)=>{n&&t.preventDefault&&t.preventDefault();let a={type:"devicemotion",acceleration:{x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.y},accelerationIncludingGravity:{x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.y},rotationRate:{alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma},interval:t.interval};e(a)};var z2=(t,e,n)=>{n&&t.preventDefault&&t.preventDefault();let a={type:"orientation",target:{type:t.target.type,angle:t.target.angle}};e(a)};function X2(t,e,n){for(let a of e)n[a]=t[a]}function y2(t){return function(n,a,r){r&&n.preventDefault&&n.preventDefault();let s={type:n.type};X2(n,t,s),a(s)}}function Y2(t,e,n){n&&t.preventDefault&&t.preventDefault()}function P2(t,e){let n={type:t.type};n.isTrusted=t.isTrusted,n.bubbles=t.bubbles,n.cancelBubble=t.cancelBubble,n.cancelable=t.cancelable,n.composed=t.composed,n.defaultPrevent=t.defaultPrevented,n.eventPhase=t.eventPhase,n.returnValue=t.returnValue,n.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,n.target=n.currentTarget,n.srcElement=n.currentTarget,e(n)}function $2(t,e,n){n&&t.preventDefault&&t.preventDefault(),j2(t,e)}function m(t,e,n){n&&t.preventDefault&&t.preventDefault();let a=[],r={type:t.type,touches:a};for(let s=0;s<t.touches.length;++s){let i3=t.touches[s];a.push({pageX:i3.pageX,pageY:i3.pageY})}e(r)}var C2=1;var W2={};for(;C2<222;)W2[C2]=true,C2++;function A2(t,e,n){let{keyCode:a}=t;W2[a]&&(n&&t.preventDefault&&(a<110||a>123)&&t.preventDefault(),G2(t,e))}var c={contextmenu:Y2,mousedown:d,mousemove:d,mouseup:d,pointerdown:d,pointermove:d,pointerup:d,pointerlockchange:d,webkitpointerlockchange:d,focus:P2,blur:P2,pointerout:d,touchstart:m,touchmove:m,touchend:m,wheel:$2,keydown:A2,keyup:A2,deviceorientation:B2,devicemotion:K,orientation:z2};function p(t,e,n,a){n||(n="proxy"+Math.floor(Math.random()*1e15));let r=o=>{e?e.postMessage({route:"handleProxyEvent",args:[o,n]}):M2(o,n)},s=Object.entries(c),i3={};for(let[o,u]of s)i3[o]=function(O2){u(O2,r,a)},t.addEventListener(o,i3[o]);c.keydown&&(i3.keydown=function(o){c.keydown(o,r,a)},globalThis.addEventListener("keydown",i3.keydown)),c.keyup&&(i3.keyup=function(o){c.keyup(o,r,a)},globalThis.addEventListener("keyup",i3.keyup)),c.devicemotion&&(i3.devicemotion=function(o){c.devicemotion(o,r,a)},globalThis.addEventListener("devicemotion",i3.devicemotion)),c.deviceorientation&&(i3.deviceorientation=function(o){c.deviceorientation(o,r,a)},globalThis.addEventListener("deviceorientation",i3.deviceorientation)),c.orientation&&(i3.orientation=o=>{c.orientation(o,r,a)},screen.orientation.addEventListener("change",i3.orientation));let l=()=>{let o=t.getBoundingClientRect();r({type:"resize",left:o.left,top:o.top,width:t.clientWidth,height:t.clientHeight})};return l(),globalThis.addEventListener("resize",l),{functions:i3,terminate:()=>{for(let o in i3)o==="keyup"||o==="keydown"||o==="devicemotion"||o==="deviceorientation"?globalThis.removeEventListener(o,i3[o]):o==="orientation"?screen.orientation.removeEventListener("change",i3[o]):t.removeEventListener(o,i3[o])},id:n}}var w2=class{__listeners;addEventListener(e,n){this.__listeners===void 0&&(this.__listeners={});let a=this.__listeners;a[e]===void 0&&(a[e]=[]),a[e].indexOf(n)===-1&&a[e].push(n)}hasEventListener(e,n){if(this.__listeners===void 0)return false;let a=this.__listeners;return a[e]!==void 0&&a[e].indexOf(n)!==-1}removeEventListener(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e];if(r!==void 0){let s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e.type];if(r!==void 0){n?e.target=n:e.target=this;let s=r.slice(0);for(let i3=0,l=s.length;i3<l;i3++)s[i3].call(this,e)}}};function S2(){}var b2=class extends w2{__listeners={};proxied;style={};width;left;right;top;height;constructor(){super(),this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}setPointerCapture=()=>{};releasePointerCapture=()=>{};getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height});handleEvent=e=>{e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),e.preventDefault=S2,e.stopPropagation=S2,this.dispatchEvent(e,this.proxied)};focus(){}blur(){}};var g=class{targets={};constructor(){globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}makeProxy=(e,n)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let a;this.targets[e]?a=this.targets[e]:(a=new b2,this.targets[e]=a),typeof n=="object"&&(n.proxy=a,a.proxied=n,typeof WorkerGlobalScope<"u"&&(n.style=a.style),a.width&&(n.style.width=a.width+"px",n.clientWidth=a.width),a.height&&(n.style.height=a.height+"px",n.clientHeight=a.height),n.setPointerCapture=a.setPointerCapture.bind(a),n.releasePointerCapture=a.releasePointerCapture.bind(a),n.getBoundingClientRect=a.getBoundingClientRect.bind(a),n.addEventListener=a.addEventListener.bind(a),n.removeEventListener=a.removeEventListener.bind(a),n.handleEvent=a.handleEvent.bind(a),n.dispatchEvent=a.dispatchEvent.bind(a),n.focus=a.focus.bind(a),n.blur=a.blur.bind(a))};getProxy=e=>this.targets[e];handleEvent=(e,n)=>{if(this.targets[n]||this.makeProxy(n),this.targets[n])return this.targets[n].handleEvent(e),true}};function q2(t,e){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new g),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new g),globalThis.ProxyManager.makeProxy(t,e)),t}function M2(t,e){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new g),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new g),globalThis.ProxyManager.handleEvent(t,e))return t}var v={initProxyElement:p,makeProxy:q2,handleProxyEvent:M2};var k2;if(typeof process<"u")try{typeof import.meta<"u"&&(globalThis.__filename=fileURLToPath(import.meta.url),globalThis.__dirname=fileURLToPath(new URL(".",import.meta.url))),k2=F2("path").join(process.cwd(),__dirname,"canvas.worker.js")}catch{}else{let e=globalThis.location.href.split("/");e.pop(),e=e.join("/"),k2=e+"/canvas.worker.js"}var T2=k2;function I2(t){if(t.worker===true&&(t.worker=T2),t.worker){let e=t.worker,n=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,N2(e,t,n)}else return p(t.canvas,void 0,t._id,t.preventDefault),V2(t)}function N2(t,e,n){if(!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let a=e.canvas instanceof OffscreenCanvas?e.canvas:e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let r={route:n||"setupCanvas",args:{...e,canvas:a}},s;this?.__node?.graph?s=this.__node.graph.run("initProxyElement",e.canvas,t,e._id,e.preventDefault):s=p(e.canvas,t,e._id,e.preventDefault),e.draw&&(typeof e.draw=="function"?r.args.draw=e.draw.toString():r.args.draw=e.draw),e.update&&(typeof e.update=="function"?r.args.update=e.update.toString():r.args.update=e.update),e.init&&(typeof e.init=="function"?r.args.init=e.init.toString():r.args.init=e.init),e.clear&&(typeof e.clear=="function"?r.args.clear=e.clear.toString():r.args.clear=e.clear);let i3=[a];return e.transfer&&(i3.push(...e.transfer),delete e.transfer),t.postMessage(r,i3),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(o,u)=>{t.postMessage({route:"drawFrame",args:[o,e._id]},u)},update:(o,u)=>{t.postMessage({route:"updateCanvas",args:[o,e._id]},u)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(o,u)=>{t.postMessage({route:"setDraw",args:[o,e._id]},u)},terminate:()=>{s&&s.terminate(),t.terminate()}}}function _(t,e){let n;if(this?.__node?.graph?e?n=this.__node.graph.CANVASES?.[t._id]:t._id?n=this.__node.graph.CANVASES?.[t._id]:n=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e||t._id?n=globalThis.CANVASES?.[t._id]:n=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],n){if(t.canvas){n.canvas=t.canvas,n.proxy&&n.proxy.terminate();let a;this?.__node?.graph?a=this.__node.graph.run("makeProxy",n._id,n.canvas):a=v.makeProxy(n._id,n.canvas),n.proxy=a}return typeof t.context=="string"?n.context=n.canvas.getContext(t.context):t.context&&(n.context=t.context),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=f(t.draw)),typeof t.draw=="function"&&(n.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=f(t.update)),typeof t.update=="function"&&(n.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=f(t.init)),typeof t.init=="function"&&(n.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=f(t.clear)),typeof t.clear=="function"&&(n.clear=t.clear.bind(t)),t._id}}function V2(t){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=true;let n;if(this?.__node?.graph?.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if(globalThis.CANVASES?.[e._id])_(e);else{this?.__node?.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),this?.__node?.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,this?.__node?.graph?n=this.__node.graph.run("makeProxy",e._id,e.canvas):n=v.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=f(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=f(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=f(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=f(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e));let a=()=>{if(e.stop=()=>{x2(e._id)},e.start=r=>{E(e._id,r)},e.set=r=>{_(r,e._id)},typeof e.draw=="function"&&e.animating){let r=(s,i3,l)=>{if(s.animating){let o=s.draw(s,i3,l);o?.then?o.then(()=>{requestAnimationFrame(()=>{r(s,i3,l)})}):requestAnimationFrame(()=>{r(s,i3,l)})}};r(e,e.canvas,e.context)}if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope)return e._id;{let r={_id:t._id,width:t.width,height:t.height,proxy:n,draw:s=>{L2(s,t._id)},update:s=>{R2(s,t._id)},clear:()=>{D2(t._id)},init:()=>{H2(t._id)},stop:()=>{x2(t._id)},start:()=>{E(t._id)},set:s=>{_(s,t._id)},terminate:()=>{r.proxy&&r.proxy.terminate(),this.__node?.graph?this.__node.graph.remove(t._id):(x2(t._id),this?.__node?.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}};return r}};if(typeof e.init=="function"){let r=e.init(e,e.canvas,e.context);return r?.then?new Promise(s=>{r.then(()=>{s(a())})}):a()}else a()}}function L2(t,e){let n=h.call(this,e);if(n&&(t&&Object.assign(n,t),n.draw))return n.draw(n,n.canvas,n.context),e}function D2(t){let e=h.call(this,t);if(e?.clear)return e.clear(e,e.canvas,e.context),t}function H2(t){let e=h.call(this,t);if(e?.init)return e.init(e,e.canvas,e.context),t}function R2(t,e){let n=h.call(this,e);if(n?.update)return n.update(n,n.canvas,n.context,t),e}function U2(t,e){let n=h.call(this,e);if(n&&t)return Object.assign(n,t),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),e}function E(t,e){let n=h.call(this,t);if(n.animating=true,n&&e)return typeof e=="string"&&(e=f(e)),typeof e=="function"&&(n.draw=e),t;if(typeof n?.draw=="function"){let a=(r,s,i3)=>{r.animating&&(r.draw(r,s,i3),requestAnimationFrame(()=>{a(r,s,i3)}))};return typeof n.clear=="function"&&n.clear(n,n.canvas,n.context),typeof n.init=="function"&&n.init(n,n.canvas,n.context),a(n,n.canvas,n.context),t}}function x2(t){let e=h.call(this,t);if(e)return e.animating=false,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function h(t){let e;return this?.__node?.graph?t?e=this.__node.graph.CANVASES?.[t]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=globalThis.CANVASES?.[t]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e}var ne={...v,Renderer:I2,transferCanvas:N2,setupCanvas:V2,setDraw:_,drawFrame:L2,clearCanvas:D2,initCanvas:H2,updateCanvas:R2,setProps:U2,startAnim:E,stopAnim:x2,getCanvas:h};function f(t=""){let e=i3=>i3.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4"),a=(i3=>{let l=i3.indexOf("=>")+1;return l<=0&&(l=i3.indexOf("){")),l<=0&&(l=i3.indexOf(") {")),i3.slice(0,i3.indexOf("{",l)+1)})(t),r=e(t),s;if(a.includes("function")){let i3=a.split("(")[1].split(")")[0];s=new Function(i3,r)}else if(a.substring(0,6)===r.substring(0,6)){let i3=a.split("(")[1].split(")")[0];s=new Function(i3,r.substring(r.indexOf("{")+1,r.length-1))}else try{s=(0,eval)(a+r+"}")}catch{}return s}var str=String('(()=>{var __require=(x3=>typeof require!=="undefined"?require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b3)=>(typeof require!=="undefined"?require:a)[b3]}):x3)(function(x3){if(typeof require!=="undefined")return require.apply(this,arguments);throw Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var import_meta={};var __require2=(x3=>typeof __require!=="undefined"?__require:typeof Proxy!=="undefined"?new Proxy(x3,{get:(a,b3)=>(typeof __require!=="undefined"?__require:a)[b3]}):x3)(function(x3){if(typeof __require!=="undefined")return __require.apply(this,arguments);throw Error(\'Dynamic require of "\'+x3+\'" is not supported\')});var x=class{data={};triggers={};ctr=0;constructor(e){typeof e=="object"&&(this.data=e)}setState=e=>{Object.assign(this.data,e);let t=Object.getOwnPropertyNames(e);for(let n of t)this.triggerEvent(n,this.data[n]);if(this.triggers[G]){let n=r=>{r(e)},s=this.triggers[G].length;for(let r=s-1;r>=0;r--)n(this.triggers[G][r].onchange)}return this.data};setValue=(e,t)=>{this.data[e]=t,this.triggerEvent(e,t)};triggerEvent=(e,t)=>{if(this.triggers[e]){let n=r=>{r.onchange(t)},s=this.triggers[e].length;for(let r=s-1;r>=0;r--)n(this.triggers[e][r])}};subscribeState=e=>this.subscribeEvent(G,e);unsubscribeState=e=>this.unsubscribeEvent(G,e);subscribeEvent=(e,t,n,s)=>{if(e){n&&s&&!this.triggers[e]&&Object.defineProperty(this.data,e,{get:()=>n[s],set:_2=>{n[s]=_2},enumerable:true,configurable:true}),this.triggers[e]||(this.triggers[e]=[]);let r=this.ctr;return this.ctr++,this.triggers[e].push({sub:r,onchange:t}),r}else return};unsubscribeEvent=(e,t)=>{let n=this.triggers[e];if(n)if(t===void 0)delete this.triggers[e],delete this.data[e];else{let s,r=n.find((_2,o)=>{if(_2.sub===t)return s=o,true});return r&&n.splice(s,1),Object.keys(n).length===0&&(delete this.triggers[e],delete this.data[e]),this.onRemoved&&this.onRemoved(r),true}};subscribeEventOnce=(e,t)=>{let n,s=r=>{t(r),this.unsubscribeEvent(e,n)};return n=this.subscribeEvent(e,s),n};getEvent=(e,t)=>{if(typeof t!="number")return this.triggers[e];for(let n in this.triggers[e])if(this.triggers[e][n].sub===t)return this.triggers[e][n]};getSnapshot=()=>{let e={};for(let t in this.data)e[t]=this.data[t]};onRemoved};var G="*s";var q=new x;var w=class extends Function{__bound;__call;constructor(){return super("return this.__bound.__call.apply(this.__bound, arguments)"),this.__bound=this.bind(this),this.__bound}};var y=class i{__node={tag:`node${Math.floor(Math.random()*1e15)}`,unique:`${Math.floor(Math.random()*1e15)}`,state:q};__children;__parent;__operator;__listeners;__props;__args;constructor(e,t,n){if(this.__setProperties(e,t,n),typeof e=="function"||e?.__callable){let s=new w;s.__call=(..._2)=>this.__operator(..._2);let r=new Proxy(s,{get:(_2,o,a)=>Reflect.has(this,o)?Reflect.get(this,o,a):Reflect.get(_2,o,a),set:(_2,o,a,f2)=>Reflect.has(this,o)?Reflect.set(this,o,a,f2):Reflect.set(_2,o,a,f2)});return Object.setPrototypeOf(r,this),r}}get __graph(){return this.__node?.graph}set __graph(e){this.__node.graph=e}__setProperties=(e,t,n)=>{if((()=>{let r=e;typeof e=="function"?S(e)?e=new e:e={__operator:e,__node:{forward:true,tag:e.name}}:typeof e=="string"&&n?.get(e)&&(e=n.get(e)),"__node"in e||(e.__node={}),e.__node.initial||(e.__node.initial=r)})(),typeof e=="object"){let r=()=>{e.__node?.state?this.__node.state=e.__node.state:n&&(e.__node.state=n.__node.state)},_2=()=>{e.__props&&(typeof e.__props=="function"&&(e.__props=new e.__props),typeof e.__props=="object"&&this.__proxyObject(e.__props))},o=()=>{e.__node.tag||(e.__operator?.name?e.__node.tag=e.__operator.name:e.__node.tag=`node${Math.floor(Math.random()*1e15)}`)},a=()=>{typeof e.__node=="string"?n?.get(e.__node.tag)?e=n.get(e.__node.tag):e.__node={}:e.__node||(e.__node={}),n&&(e.__node.graph=n),e instanceof b&&(e.__node.source=e)},f2=()=>{if(!e.__parent&&t&&(e.__parent=t),t?.__node&&!(t instanceof b||e instanceof b)&&(e.__node.tag=t.__node.tag+"."+e.__node.tag),t instanceof b&&e instanceof b&&(e.__node.loaders&&Object.assign(t.__node.loaders?t.__node.loaders:{},e.__node.loaders),t.__node.mapGraphs)){e.__node.nodes.forEach(h2=>{t.set(e.__node.tag+"."+h2.__node.tag,h2)});let u=()=>{e.__node.nodes.forEach(h2=>{t.__node.nodes.delete(e.__node.tag+"."+h2.__node.tag)})};this.__addOndisconnected(u)}},l=()=>{if(typeof e.default=="function"&&!e.__operator&&(e.__operator=e.default),e.__operator){if(typeof e.__operator=="string"&&n){let u=n.get(e.__operator);u&&(e.__operator=u.__operator),!e.__node.tag&&e.__operator.name&&(e.__node.tag=e.__operator.name)}typeof e.__operator=="function"&&(e.__operator=this.__setOperator(e.__operator)),e.default&&(e.default=e.__operator)}},c2=()=>{e.__node=Object.assign(this.__node,e.__node);let u=Object.getOwnPropertyNames(e).filter(h2=>{if(!O[h2])return true});for(let h2 of u)h2 in e&&h2!=="name"&&(this[h2]=e[h2])},d2=()=>{this.__onconnected&&(typeof this.__onconnected=="function"?this.__onconnected=this.__onconnected.bind(this):Array.isArray(this.__onconnected)&&(this.__onconnected=this.__onconnected.map(u=>u.bind(this))),typeof this.__ondisconnected=="function"?this.__ondisconnected=this.__ondisconnected.bind(this):Array.isArray(this.__ondisconnected)&&(this.__ondisconnected=this.__ondisconnected.map(u=>u.bind(this))))};r(),o(),_2(),a(),f2(),c2(),d2(),l()}};__subscribe=(e,t,n,s,r,_2,o)=>{let a=(l,c2=(u,h2)=>h2||u,d2=e)=>{let u;if(_2){let p2=j(d2,_2,this.__node.graph);d2=p2.__callback,u=p2.__args}let h2=this.__node.state.subscribeEvent(l,d2,this,t),g2=this.__node.state.getEvent(l,h2);return this.__listeners||(this.__listeners={}),this.__listeners[l]=this.__node.state.triggers[l],g2&&(g2.source=this.__node.tag,t&&(g2.key=t),g2.target=c2(e,s),r&&(g2.tkey=r),n&&(g2.subInput=n),_2&&(g2.arguments=u,g2.__args=_2),o&&(g2.__callback=o),g2.node=this,g2.graph=this.__node.graph),h2},f2=l=>{let c2=this.__node.graph.get(l);if(!c2&&l.includes(".")){s=l.substring(0,l.lastIndexOf("."));let d2=this.__node.graph.get(l.substring(0,s));r=l.lastIndexOf(".")+1,d2&&typeof d2[t]=="function"&&(l=(...u)=>d2[r](...u))}else c2.__operator&&(l=c2.__operator,r="__operator");return l};if(t){if((!this.__node.localState||!this.__node.localState[t])&&this.__addLocalState(this,t),typeof e=="string"){if(o=this.__node.tag+"."+e,r=e,s){if(this.__node.graph?.get(s)){let d2=this.__node.graph?.get(s);if(typeof d2[e]=="function"){let u=d2[e];e=(...h2)=>{u(...h2)}}else{let u=e;e=g2=>{d2[u]=g2}}}}else if(typeof this[e]=="function"){let d2=this[e];e=(...u)=>{d2(...u)}}else this.__node.graph?.get(e)&&(e=f2(e));if(typeof e!="function")return}let l,c2=n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t;return typeof e=="function"&&!e?.__node?l=a(c2,(d2,u)=>u||d2,e):e?.__node&&(l=a(c2,(d2,u)=>u||d2.__node.unique,(...d2)=>{e.__operator&&e.__operator(...d2)})),l}else{if(typeof e=="string"&&(o=e,s||(s=e),this.__node.graph.get(e)&&(e=this.__node.graph.get(e)),r="__operator",typeof e!="object"))return;let l,c2=n?this.__node.unique+"input":this.__node.unique;return typeof e=="function"&&!e?.__node?l=a(c2,(d2,u)=>u||d2,e):e?.__node&&(l=a(c2,(d2,u)=>u||d2.__node.unique,(...d2)=>{e.__operator&&e.__operator(...d2)})),l}};__unsubscribe=(e,t,n)=>t?this.__node.state.unsubscribeEvent(n?this.__node.unique+"."+t+"input":this.__node.unique+"."+t,e):this.__node.state.unsubscribeEvent(n?this.__node.unique+"input":this.__node.unique,e);__setOperator=e=>{e=e.bind(this),this.__args&&this.__node.graph&&(e=j(e,this.__args,this.__node.graph).__callback);let t=`${this.__node.unique}input`;if(this.__operator=(...n)=>{this.__node.state.triggers[t]&&this.__node.state.setValue(t,n);let s=e(...n);return this.__node.state.triggers[this.__node.unique]&&(typeof s?.then=="function"?s.then(r=>{r!==void 0&&this.__node.state.setValue(this.__node.unique,r)}).catch(console.error):s!==void 0&&this.__node.state.setValue(this.__node.unique,s)),s},this.__parent instanceof i&&!this.__subscribedToParent&&this.__parent.__operator){let n=this.__parent.__subscribe(this),s=()=>{this.__parent?.__unsubscribe(n),delete this.__subscribedToParent};this.__addOndisconnected(s),this.__subscribedToParent=true}return this.__operator};__addLocalState=(e,t)=>{if(!e)return;this.__node.localState||(this.__node.localState={});let n=this.__node.localState,s=(r,_2)=>{let o=this.__node.unique+"."+_2,a=`${o}input`,f2,l,c2,d2;if(typeof r[_2]=="function"&&_2!=="__operator")this.__props?.[_2]?c2=this.__props:c2=n,f2=()=>c2[_2],l=u=>{this.__props?.[_2]||(u=u.bind(this)),c2[_2]=(...h2)=>{this.__node.state.triggers[a]&&this.__node.state.setValue(a,h2);let g2=u(...h2);return this.__node.state.triggers[o]&&(typeof g2?.then=="function"?g2.then(p2=>{this.__node.state.triggerEvent(o,p2)}).catch(console.error):this.__node.state.triggerEvent(o,g2)),g2}},n[_2]=r[_2].bind(this),d2={get:f2,set:l,enumerable:true,configurable:true};else if(_2!=="__graph"){let u,h2,g2;this.__props?.[_2]?g2=this.__props:g2=n,u=()=>g2[_2],h2=p2=>{g2[_2]=p2,this.__node.state.triggers[o]&&this.__node.state.triggerEvent(o,p2)},n[_2]=r[_2],d2={get:u,set:h2,enumerable:true,configurable:true}}if(Object.defineProperty(r,_2,d2),typeof this.__node.initial=="object"){let u=Object.getOwnPropertyDescriptor(this.__node.initial,_2);(u===void 0||u?.configurable)&&Object.defineProperty(this.__node.initial,_2,d2)}};if(t)s(e,t);else for(let r in e)s(e,r)};__proxyObject=e=>{let t=I(e);for(let n of t){let s={get:()=>e[n],set:r=>{e[n]=r},enumerable:true,configurable:true};if(Object.defineProperty(this,n,s),typeof this.__node.initial=="object"){let r=Object.getOwnPropertyDescriptor(this.__node.initial,n);(r===void 0||r?.configurable)&&Object.defineProperty(this.__node.initial,n,s)}}};__addOnconnected(e){e=e.bind(this),Array.isArray(this.__onconnected)?this.__onconnected.push(e):typeof this.__onconnected=="function"?this.__onconnected=[e,this.__onconnected]:this.__onconnected=e}__addOndisconnected(e){e=e.bind(this),Array.isArray(this.__ondisconnected)?this.__ondisconnected.push(e):typeof this.__ondisconnected=="function"?this.__ondisconnected=[e,this.__ondisconnected]:this.__ondisconnected=e}__callConnected(e=this){if(typeof this.__onconnected=="function")this.__onconnected(this);else if(Array.isArray(this.__onconnected)){let t=n=>{n(this)};this.__onconnected.forEach(t)}}__callDisconnected(e=this){if(typeof this.__ondisconnected=="function")this.__ondisconnected(this);else if(Array.isArray(this.__ondisconnected)){let t=n=>{n(this)};this.__ondisconnected.forEach(t)}}};var b=class i2{__node={tag:`graph${Math.floor(Math.random()*1e15)}`,unique:`${Math.random()}`,nodes:new Map,state:q,roots:{}};constructor(e){this.init(e)}init=e=>{if(e){let t=Object.assign({},e);delete t.roots,N(this.__node,t),e.roots&&this.load(e.roots)}};load=(e,t=false)=>{function n(_2,o,a=true,f2=true){if(f2){_2||(_2={});for(let l in o)!l.startsWith("__")&&o[l]&&typeof o[l]=="object"?(_2[l]=o[l],o[l]?.__children&&n({},o[l].__children,false,false)):typeof o[l]=="function"&&(_2[l]=o[l]);n(_2,o,true,false)}else if(o?.__children&&!a)o.__children?.constructor.name==="Object"?_2.__children?.constructor.name==="Object"?_2.__children=n(_2.__children,o.__children,true,false):_2.__children=n({},o.__children,true,false):_2.__children=o.__children;else if(a)for(let l in o)!l.startsWith("__")&&o[l]&&typeof o[l]=="object"?(_2[l]=Object.assign({},o[l]),o[l]?.__children&&(_2[l].__children=n({},o[l].__children,false,false))):typeof o[l]=="function"&&(_2[l]=o[l]);return _2}this.__node.roots=n(this.__node.roots?this.__node.roots:{},e);let s=Object.assign({},e);s.__node&&delete s.__node;let r=this.recursiveSet(s,this,void 0,e,t);if(e.__node){if(!e.__node.tag)e.__node._tag=`roots${Math.floor(Math.random()*1e15)}`;else if(!this.get(e.__node.tag)){let _2=new y(e,this,this);this.set(_2.__node.tag,_2),this.runLoaders(_2,this,e,e.__node.tag),_2.__listeners&&(r[_2.__node.tag]=_2.__listeners)}}else e.__listeners&&this.setListeners(e.__listeners);return this.setListeners(r),s};setLoaders=(e,t)=>(t?this.__node.loaders=e:Object.assign(this.__node.loaders,e),this.__node.loaders);runLoaders=(e,t,n,s)=>{for(let r in this.__node.loaders)typeof this.__node.loaders[r]=="object"?(this.__node.loaders[r].init&&this.__node.loaders[r](e,t,this,this.__node.roots,n,s),this.__node.loaders[r].connected&&e.__addOnconnected(this.__node.loaders[r].connect),this.__node.loaders[r].disconnected&&e.__addOndisconnected(this.__node.loaders[r].disconnect)):typeof this.__node.loaders[r]=="function"&&this.__node.loaders[r](e,t,this,this.__node.roots,n,s)};add=(e,t,n=true)=>{let s={};typeof t=="string"&&(t=this.get(t));let r;if(typeof e=="function"?S(e)?e.prototype instanceof y?(e=e.prototype.constructor(e,t,this),r=true):e=new e:e={__operator:e,__callable:true}:typeof e=="string"&&(e=this.__node.roots[e]),!e)return;if(!r){let a=Object.getOwnPropertyNames(e),f2=Object.getOwnPropertyNames(Object.getPrototypeOf(e));a.push(...f2),a=a.filter(c2=>!O.includes(c2));let l={};for(let c2 of a)l[c2]=e[c2];e=l}if(e.__node||(e.__node={}),e.__node.initial=e,typeof e=="object"&&this.get(e.__node.tag))if(n)this.remove(e.__node.tag,true);else return;else if(e.__node.tag&&this.get(e.__node.tag))return this.get(e.__node.tag);let _2,o=N({},e,2);if(r?_2=e:_2=new y(e,t,this),this.set(_2.__node.tag,_2),this.runLoaders(_2,t,e,_2.__node.tag),this.__node.roots[_2.__node.tag]=o,_2.__children&&(_2.__children=Object.assign({},_2.__children),this.recursiveSet(_2.__children,_2,s,_2.__children)),_2.__listeners){s[_2.__node.tag]=Object.assign({},_2.__listeners);for(let a in _2.__listeners){let f2=_2.__listeners[a];_2[a]&&(delete s[_2.__node.tag][a],s[_2.__node.tag][_2.__node.tag+"."+a]=f2),typeof f2=="string"&&(_2.__children?.[f2]?s[_2.__node.tag][a]=_2.__node.tag+"."+f2:t instanceof y&&(t.__node.tag===f2||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===f2)&&(s[_2.__node.tag][a]=t.__node.tag))}}return this.setListeners(s),_2.__callConnected(),_2};recursiveSet=(e,t,n={},s,r=false)=>{let _2=Object.getOwnPropertyNames(s).filter(a=>!O.includes(a)),o=Object.getOwnPropertyNames(Object.getPrototypeOf(s)).filter(a=>!O.includes(a));_2.push(...o);for(let a of _2){if(a.includes("__"))continue;let f2=s[a];if(Array.isArray(f2))continue;let l;if(typeof f2=="function"?S(f2)?(f2=new f2,f2 instanceof y&&(f2=f2.prototype.constructor(f2,t,this),l=true)):f2={__operator:f2,__callable:true}:typeof f2=="string"?this.__node.nodes.get(f2)?f2=this.__node.nodes.get(f2):f2=this.__node.roots[f2]:typeof f2=="boolean"&&(this.__node.nodes.get(a)?f2=this.__node.nodes.get(a):f2=this.__node.roots[a]),f2&&typeof f2=="object"){if(!l&&!(f2 instanceof y)){let h2=Object.getOwnPropertyNames(f2).filter(m2=>!O.includes(m2)),g2=Object.getOwnPropertyNames(Object.getPrototypeOf(f2)).filter(m2=>!O.includes(m2));g2.splice(g2.indexOf("constructor"),1),h2.push(...g2);let p2={};for(let m2 of h2)p2[m2]=f2[m2];f2=p2}if(f2.__node||(f2.__node={}),f2.__node.tag||(f2.__node.tag=a),f2.__node.initial||(f2.__node.initial=e[a]),r&&this.get(f2.__node.tag))this.remove(f2.__node.tag,true);else if(this.get(f2.__node.tag)&&!(!(t instanceof i2)&&t?.__node)||t?.__node&&this.get(t.__node.tag+"."+f2.__node.tag))continue;let c2,d2=false,u=N({},f2,2);if(l||f2 instanceof y?c2=f2:(c2=new y(f2,t,this),d2=true),!d2&&f2 instanceof y&&!l&&t instanceof y){let h2=this.subscribe(t.__node.tag,c2.__node.tag),g2=p2=>{this.unsubscribe(t.__node.tag,h2)};c2.__addOndisconnected(g2)}else if(c2){if(this.set(c2.__node.tag,c2),this.runLoaders(c2,t,e[a],a),e[a]=c2,this.__node.roots[c2.__node.tag]=u,c2.__children&&(c2.__children=Object.assign({},c2.__children),this.recursiveSet(c2.__children,c2,n,c2.__children)),c2.__listeners){n[c2.__node.tag]=Object.assign({},c2.__listeners);for(let h2 in c2.__listeners){let g2=c2.__listeners[h2],p2=h2;c2[h2]&&(delete n[c2.__node.tag][h2],p2=c2.__node.tag+"."+h2,n[c2.__node.tag][p2]=g2),typeof g2=="string"&&(c2.__children?.[g2]?n[c2.__node.tag][p2]=c2.__node.tag+"."+g2:t instanceof y&&(t.__node.tag===g2||t.__node.tag.includes(".")&&t.__node.tag.split(".").pop()===g2)&&(n[c2.__node.tag][p2]=t.__node.tag))}}c2.__callConnected()}}}return n};remove=(e,t=true)=>{if(this.unsubscribe(e),typeof e=="string"&&(e=this.get(e)),e instanceof y){this.delete(e.__node.tag),delete this.__node.roots[e.__node.tag],t&&this.clearListeners(e),e.__callDisconnected();let n=s=>{for(let r in s)this.unsubscribe(s[r]),this.delete(s[r].__node.tag),delete this.__node.roots[s[r].__node.tag],this.delete(r),delete this.__node.roots[r],s[r].__node.tag=s[r].__node.tag.substring(s[r].__node.tag.lastIndexOf(".")+1),t&&this.clearListeners(s[r]),s[r].__callDisconnected(),s[r].__children&&n(s[r].__children)};e.__children&&n(e.__children)}return e?.__node.tag&&e?.__parent&&(delete e?.__parent,e.__node.tag=e.__node.tag.substring(e.__node.tag.indexOf(".")+1)),e?.__node.graph&&(e.__node.graph=void 0),e};run=(e,...t)=>{if(typeof e=="string"){let n=this.get(e);if(!n&&e.includes(".")){if(n=this.get(e.substring(0,e.lastIndexOf("."))),typeof n?.[e.substring(e.lastIndexOf(".")+1)]=="function")return n[e.substring(e.lastIndexOf(".")+1)](...t)}else if(n?.__operator)return n.__operator(...t)}if(e?.__operator)return e?.__operator(...t)};setListeners=e=>{for(let t in e){let n=this.get(t);if(typeof e[t]=="object")for(let s in e[t]){let r=this.get(s),_2;if(typeof e[t][s]!="object")e[t][s]={__callback:e[t][s]};else if(!e[t][s].__callback)for(let o in e[t][s]){typeof e[t][s][o]!="object"&&(e[t][s][o]={__callback:e[t][s][o]},n.__operator&&(e[t][s][o].__callback===true||typeof e[t][s][o].__callback>"u")&&(e[t][s][o].__callback=n.__operator));let a=this.get(o);if(a)_2=this.subscribe(a,e[t][s][o].__callback,e[t][s][o].__args,void 0,e[t][s][o].subInput,t);else{let f2=s.substring(0,s.lastIndexOf("."));if(a=this.get(f2),a){let l=s.substring(s.lastIndexOf(".")+1);_2=this.subscribe(a,e[t][s][o].__callback,e[t][s][o].__args,l,e[t][s][o].subInput,t)}}}if("__callback"in e[t][s])if(n&&((e[t][s].__callback===true||typeof e[t][s].__callback>"u")&&(e[t][s].__callback=n.__operator),typeof e[t][s].__callback=="function"&&(e[t][s].__callback=e[t][s].__callback.bind(n))),r)_2=this.subscribe(r,e[t][s].__callback,e[t][s].__args,void 0,e[t][s].subInput,t);else{let o=s.substring(0,s.lastIndexOf("."));r=this.get(o),r&&(_2=this.subscribe(r,e[t][s].__callback,e[t][s].__args,s.substring(s.lastIndexOf(".")+1),e[t][s].subInput,t))}}}};clearListeners=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e?.__listeners)for(let n in e.__listeners){if(t&&n!==t||typeof e.__listeners[n]?.sub!="number")continue;let s=this.get(n);if(s)if(typeof!e.__listeners[n]?.__callback=="number")for(let r in e.__listeners[n])e.__listeners[n][r]?.sub&&(this.unsubscribe(s,e.__listeners[n][r].sub,void 0,e.__listeners[n][r].subInput),e.__listeners[n][r].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n].sub,void 0,e.__listeners[n].subInput),e.__listeners[n].sub=void 0);else if(s=this.get(n.substring(0,n.lastIndexOf("."))),s)if(typeof e.__listeners[n]=="object"&&!e.__listeners[n]?.__callback)for(let r in e.__listeners[n])typeof e.__listeners[n][r]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n][r].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n][r].subInput),e.__listeners[n][r].sub=void 0);else typeof e.__listeners[n]?.sub=="number"&&(this.unsubscribe(s,e.__listeners[n].sub,n.substring(n.lastIndexOf(".")+1),e.__listeners[n].subInput),e.__listeners[n].sub=void 0)}};get=e=>this.__node.nodes.get(e);getByUnique=e=>Array.from(this.__node.nodes.values()).find(t=>{if(t.__node.unique===e)return true});set=(e,t)=>this.__node.nodes.set(e,t);delete=e=>this.__node.nodes.delete(e);list=()=>Array.from(this.__node.nodes.keys());getListener=(e,t,n)=>{let s=this.get(e);if(s){let r=s.__node.unique;return t&&(r+="."+t),this.__node.state.getEvent(r,n)}};getProps=(e,t)=>{if(typeof e=="string"&&(e=this.get(e)),e instanceof y){let n;if(t)n=Object.assign({},this.__node.roots[e.__node.tag]);else{n=Object.assign({},e);for(let s in n)s.includes("__")&&delete n[s]}}};subscribe=(e,t,n,s,r,_2,o)=>{let a=e;typeof e=="string"&&(a=this.get(e),!a&&e.includes(".")&&(a=this.get(e.substring(0,e.lastIndexOf("."))),s=e.substring(e.lastIndexOf(".")+1))),_2 instanceof y&&(_2=_2.__node.tag);let f2;if(typeof t=="string"){f2=t;let c2=d2=>{if(this.get(d2)?.__operator){let u=this.get(d2);_2=d2,d2=function(...h2){return u.__operator(...h2)}}else if(d2.includes(".")){_2=d2.substring(0,d2.lastIndexOf("."));let u=this.get(_2),h2=d2.substring(d2.lastIndexOf(".")+1);o=h2,typeof u[h2]=="function"?u[h2]instanceof y?d2=u[h2]:d2=function(...g2){return u[h2](...g2)}:d2=function(g2){return u[h2]=g2,u[h2]}}return d2};if(_2){let d2=this.get(_2);typeof d2?.[t]=="function"?(o=t,t=function(...u){return d2[s](...u)}):d2?.[s]?(o=s,d2[s]instanceof y?t=d2[s]:t=function(u){return d2[s]=u,d2[s]}):t=c2(t)}else t=c2(t)}let l;if(a instanceof y){let c2=()=>{l=a.__subscribe(t,s,r,_2,o,n,f2);let d2=()=>{l!==void 0&&a.__unsubscribe(l,s,r),l=void 0};a.__addOndisconnected(()=>{d2(),a.__addOnconnected(()=>{l===void 0&&a.__node.graph.__node.tag===this.__node.tag&&c2()})}),typeof t=="string"&&this.get(t)&&(t=this.get(t)),t instanceof y&&t.__addOndisconnected(()=>{d2()})};c2()}else if(typeof e=="string"){let c2=this.get(e);if(c2){if(t instanceof y&&t.__operator){let d2=()=>{l=c2.__subscribe(t.__operator,s,r,_2,o,n,f2);let u=()=>{l!==void 0&&c2.__unsubscribe(l,s,r)};c2.__addOndisconnected(()=>{u(),c2.__addOnconnected(()=>{l===void 0&&c2.__node.graph.__node.tag===this.__node.tag&&d2()})}),t.__addOndisconnected(u)};d2()}else if(typeof t=="function"||typeof t=="string"){let d2=()=>{l=c2.__subscribe(t,s,r,_2,o,n,f2);let u=()=>{l!==void 0&&c2.__unsubscribe(l,s,r),l=void 0};c2.__addOndisconnected(()=>{u(),c2.__addOnconnected(()=>{l===void 0&&c2.__node.graph.__node.tag===this.__node.tag&&d2()})}),typeof t=="string"&&this.get(t)&&this.get(t).__addOndisconnected(u)};d2()}}else typeof t=="string"&&(t=this.__node.nodes.get(t).__operator),typeof t=="function"&&!t?.__node&&(l=this.__node.state.subscribeEvent(e,t))}return l};unsubscribe=(e,t,n,s)=>e instanceof y?e.__unsubscribe(t,n,s):this.get(e)?.__unsubscribe(t,n,s);setState=e=>{this.__node.state.setState(e)}};function N(i3,e,t=1/0,n=0){for(let s in e)e[s]?.constructor.name==="Object"&&n<t?(n++,i3[s]?.constructor.name==="Object"?N(i3[s],e[s],t,n):i3[s]=N({},e[s],t,n)):i3[s]=e[s];return i3}function I(i3){var e=[],t=i3;do{var n=Object.getOwnPropertyNames(t);let s=function(r){e.indexOf(r)===-1&&e.push(r)};n.forEach(s)}while(t=Object.getPrototypeOf(t));return e}function S(i3){return R(i3)==="class"}function R(i3){return typeof i3=="function"?i3.prototype?Object.getOwnPropertyDescriptor(i3,"prototype")?.writable?"function":"class":i3.constructor.name==="AsyncFunction"?"async":"arrow":""}var A=(i3,e)=>{if(e.get(i3)?.__operator){let t=e.get(i3);return(...n)=>{t.__operator(...n)}}else if(i3.includes(".")){let t=i3.split("."),n=t.pop(),s=t.join("."),r=e.get(s);return typeof e.get(s)?.[n]=="function"?(..._2)=>r[n](..._2):()=>r[n]}else if(e.get(i3)){let t=e.get(i3);return()=>t}else{let t=i3;return()=>t}};var j=(i3,e,t)=>{let n=[],s=(_2,o)=>{if(_2==="__output"||_2==="__input"||_2==="__callback")n[o]={__callback:a=>a,__args:void 0,idx:o};else if(typeof _2=="string")n[o]={__callback:A(_2,t),__args:void 0,idx:o};else if(typeof _2=="function"){let a=_2;n[o]={__callback:(...f2)=>a(...f2),__args:void 0,idx:o}}else if(typeof _2=="object"&&(_2.__input||_2.__callback)){let a=function(f2){let l=f2.__input?f2.__input:f2.__callback;if(typeof f2.__input=="string"&&(l={__callback:A(f2.__input,t),__args:void 0,idx:o}),f2.__args){let c2=j(l,f2.__args,t);l={__callback:c2.__callback,__args:c2.__args,idx:o}}else l={__callback:l,__args:void 0,idx:o};if(f2.__output){let c2=f2.__output;if(typeof f2.__output=="string"?c2={__callback:A(c2,t),__args:void 0,idx:o}:typeof _2.__output=="object"&&(c2=a(c2)),typeof c2?.__callback=="function"){let d2=l.__callback,u=c2.__callback;l={__callback:(...h2)=>u(d2(...h2)),__args:c2.__args,idx:o}}}return l};n[o]=a(_2)}else{let a=_2;n[o]={__callback:()=>a,__args:void 0,idx:o}}};e.forEach(s),typeof i3=="string"&&(i3={__callback:A(i3,t),__args:void 0});let r=typeof i3=="function"?i3:i3.__callback;return i3=function(..._2){let o=f2=>f2.__callback(..._2);return r(...n.map(o))},{__callback:i3,__args:n}};var O=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var C=(i3,e,t)=>{i3.__node.backward&&e instanceof y&&t.setListeners({[e.__node.tag]:{[i3.__node.tag]:e}})};var T=(i3,e,t)=>{if(i3.__operator){let n=Math.random();if(i3.__node.loops||(i3.__node.loops={}),typeof i3.__node.delay=="number"){let s=i3.__operator;i3.__setOperator((...r)=>new Promise((_2,o)=>{i3.__node.loops[n]=setTimeout(async()=>{_2(await s(...r))},i3.__node.delay)}))}else if(i3.__node.frame===true){let s=i3.__operator;i3.__setOperator((...r)=>new Promise((_2,o)=>{i3.__node.loops[n]=requestAnimationFrame(async()=>{_2(await s(...r))})}))}if(typeof i3.__node.repeat=="number"||typeof i3.__node.recursive=="number"){let s=i3.__operator;i3.__setOperator(async(...r)=>{let _2=i3.__node.repeat?i3.__node.repeat:i3.__node.recursive,o,a=async(f2,...l)=>{for(;f2>0;){if(i3.__node.delay||i3.__node.frame){s(...l).then(async c2=>{i3.__node.recursive?await a(f2,c2):await a(f2,...l)});break}else o=await s(...r);f2--}};return await a(_2,...r),o})}if(i3.__node.loop&&typeof i3.__node.loop=="number"){let s=i3.__operator,r=i3.__node.loop;i3.__setOperator((...o)=>{if("looping"in i3.__node||(i3.__node.looping=true),i3.__node.looping){let a=performance.now();s(...o),i3.__node.loops[n]=setTimeout(()=>{let l=performance.now()-a-i3.__node.loop;l>0?r=i3.__node.loop-l:r=i3.__node.loop,r<=0&&(r=i3.__node.loop),i3.__operator(...o)},r)}}),i3.__node.looping&&i3.__operator();let _2=o=>{o.__node.looping&&(o.__node.looping=false),o.__node.loops[n]&&(clearTimeout(o.__node.loops[n]),cancelAnimationFrame(o.__node.loops[n]))};i3.__addOndisconnected(_2)}}};var $=(i3,e,t)=>{if(i3.__node.animate===true||i3.__animation){let n=i3.__operator;i3.__setOperator((...r)=>{"animating"in i3.__node||(i3.__node.animating=true),i3.__node.animating&&(typeof i3.__animation=="function"?i3.__animation(...r):n(...r),i3.__node.animationFrame=requestAnimationFrame(()=>{i3.__operator(...r)}))}),(i3.__node.animating||(!("animating"in i3.__node)||i3.__node.animating)&&i3.__animation)&&setTimeout(()=>{i3.__node.animationFrame=requestAnimationFrame(i3.__operator)},10);let s=r=>{r.__node.animating&&(r.__node.animating=false),r.__node.animationFrame&&cancelAnimationFrame(r.__node.animationFrame)};i3.__addOndisconnected(s)}};var J=(i3,e,t)=>{if(typeof i3.__branch=="object"&&i3.__operator&&!i3.__branchApplied){let n=i3.__operator;i3.__branchApplied=true,i3.__operator=(...s)=>{let r=n(...s);for(let _2 in i3.__branch){let o=()=>{typeof i3.__branch[_2].then=="function"?i3.__branch[_2].then(r):i3.__branch[_2].then instanceof y&&i3.__branch[_2].then.__operator?i3.__branch[_2].then.__operator(r):r=i3.__branch[_2].then};typeof i3.__branch[_2].if=="function"?i3.__branch[_2].if(r)==true&&o():i3.__branch[_2].if===r&&o()}return r}}if(i3.__listeners){for(let n in i3.__listeners)if(typeof i3.__listeners[n]=="object"&&i3.__listeners[n].branch&&!i3.__listeners[n].branchApplied){let s=i3.__listeners[n].callback;i3.__listeners[n].branchApplied=true,i3.__listeners.callback=r=>{let _2=()=>{typeof i3.__listeners[n].branch.then=="function"?r=i3.__listeners[n].branch.then(r):i3.__listeners[n].branch.then instanceof y&&i3.__listeners[n].branch.then.__operator?r=i3.__listeners[n].branch.then.__operator(r):r=i3.__listeners[n].branch.then};return typeof i3.__listeners[n].branch.if=="function"?i3.__listeners[n].branch.if(r)&&_2():i3.__listeners[n].branch.if===r&&_2(),s(r)}}}};var W=(i3,e,t)=>{if(i3.__listeners)for(let n in i3.__listeners)typeof i3.__listeners[n]=="object"&&i3.__listeners[n].oncreate&&i3.__listeners[n].callback(i3.__listeners[n].oncreate)};var V=(i3,e,t)=>{if(i3.__listeners)for(let n in i3.__listeners)typeof i3.__listeners[n]=="object"&&typeof i3.__listeners[n].binding=="object"&&(i3.__listeners.callback=i3.__listeners.callback.bind(i3.__listeners[n].binding))};var B=(i3,e,t)=>{if(i3.__listeners){for(let n in i3.__listeners)if(typeof i3.__listeners[n]=="object"&&typeof i3.__listeners[n].transform=="function"&&!i3.__listeners[n].transformApplied){let s=i3.__listeners[n].callback;i3.__listeners[n].transformApplied=true,i3.__listeners.callback=r=>(r=i3.__listeners[n].transform(r),s(r))}}};var H=(i3,e,t)=>{i3.post&&!i3.__operator?i3.__setOperator(i3.post):!i3.__operator&&typeof i3.get=="function"&&i3.__setOperator(i3.get),!i3.get&&i3.__operator,i3.aliases&&i3.aliases.forEach(n=>{t.set(n,i3);let s=r=>{t.__node.nodes.delete(n)};i3.__addOndisconnected(s)}),typeof t.__node.roots?.[i3.__node.tag]=="object"&&i3.get&&(t.__node.roots[i3.__node.tag].get=i3.get)};var F={backprop:C,loop:T,animate:$,branching:J,triggerListenerOncreate:W,bindListener:V,transformListenerResult:B,substitute__operator:H};var U=i3=>{let e={};for(let t in i3)typeof i3[t]=="object"?e[t]=U(i3[t]):typeof i3[t]=="function"?e[t]=i3[t].toString():e[t]=i3[t];return e};function se(i3){typeof i3!="string"&&(i3=i3.toString());let e=i3.match(/\\(?[^]*?\\)?\\s*=>/);if(e)return e[0].replace(/[()\\s]/gi,"").replace("=>","").split(",");let t=i3.match(/\\([^]*?\\)/);return t?t[0].replace(/[()\\s]/gi,"").split(","):[]}var D=i3=>{let e=i3.indexOf("=>")+1;return e<=0&&(e=i3.indexOf("){")),e<=0&&(e=i3.indexOf(") {")),i3.slice(0,i3.indexOf("{",e)+1)};function P(i3=""){let e=r=>r.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4"),t=D(i3),n=e(i3),s;if(t.includes("function")){let r=t.substring(t.indexOf("(")+1,t.lastIndexOf(")"));s=new Function(r,n)}else if(t.substring(0,6)===n.substring(0,6)){let r=t.substring(t.indexOf("(")+1,t.lastIndexOf(")"));s=new Function(r,n.substring(n.indexOf("{")+1,n.length-1))}else try{s=(0,eval)(i3)}catch{}return s}var k=function(){let i3=new Map,e=[],t=["this"];function n(){i3.clear(),e.length=0,t.length=1}function s(_2,o){var a=e.length-1,f2=e[a];if(typeof f2=="object")if(f2[_2]===o||a===0)t.push(_2),e.push(o.pushed);else for(;a-->=0;){if(f2=e[a],typeof f2=="object"&&f2[_2]===o){a+=2,e.length=a,t.length=a,--a,e[a]=o,t[a]=_2;break}a--}}function r(_2,o){if(o!=null&&typeof o=="object"){_2&&s(_2,o);let a=i3.get(o);if(a)return"[Circular Reference]"+a;i3.set(o,t.join("."))}return o}return function(o,a){try{return e.push(o),JSON.stringify(o,r,a)}finally{n()}}}();JSON.stringifyWithCircularRefs===void 0&&(JSON.stringifyWithCircularRefs=k);var z=function(){let i3=new Map,e=[],t=["this"];function n(){i3.clear(),e.length=0,t.length=1}function s(_2,o){var a=e.length-1,f2=e[a];if(typeof f2=="object")if(f2[_2]===o||a===0)t.push(_2),e.push(o.pushed);else for(;a-->=0;){if(f2=e[a],typeof f2=="object"&&f2[_2]===o){a+=2,e.length=a,t.length=a,--a,e[a]=o,t[a]=_2;break}a--}}function r(_2,o){if(o!=null&&typeof o=="object"){_2&&s(_2,o);let a=i3.get(o);if(a)return"[Circular Reference]"+a;i3.set(typeof o=="function"?o.toString():o,t.join("."))}return typeof o=="function"?o.toString():o}return function(o,a){try{return e.push(o),JSON.stringify(o,r,a)}finally{n()}}}();JSON.stringifyWithFunctionsAndCircularRefs===void 0&&(JSON.stringifyWithFunctionsAndCircularRefs=z);var Q=function(){let i3=new Map,e=[],t=["this"];function n(){i3.clear(),e.length=0,t.length=1}function s(_2,o){var a=e.length-1;if(e[a]){var f2=e[a];if(typeof f2=="object")if(f2[_2]===o||a===0)t.push(_2),e.push(o.pushed);else for(;a-->=0;){if(f2=e[a],typeof f2=="object"&&f2[_2]===o){a+=2,e.length=a,t.length=a,--a,e[a]=o,t[a]=_2;break}a++}}}function r(_2,o){let a;if(o!=null)if(typeof o=="object"){let f2=o.constructor.name;_2&&f2==="Object"&&s(_2,o);let l=i3.get(o);if(l)return"[Circular Reference]"+l;if(i3.set(o,t.join(".")),f2==="Array")o.length>20?a=o.slice(o.length-20):a=o;else if(f2.includes("Set"))a=Array.from(o);else if(f2!=="Object"&&f2!=="Number"&&f2!=="String"&&f2!=="Boolean")a="instanceof_"+f2;else if(f2==="Object"){let c2={};for(let d2 in o)if(o[d2]==null)c2[d2]=o[d2];else if(Array.isArray(o[d2]))o[d2].length>20?c2[d2]=o[d2].slice(o[d2].length-20):c2[d2]=o[d2];else if(o[d2].constructor.name==="Object"){c2[d2]={};for(let u in o[d2])if(Array.isArray(o[d2][u]))o[d2][u].length>20?c2[d2][u]=o[d2][u].slice(o[d2][u].length-20):c2[d2][u]=o[d2][u];else if(o[d2][u]!=null){let h2=o[d2][u].constructor.name;h2.includes("Set")?c2[d2][u]=Array.from(o[d2][u]):h2!=="Number"&&h2!=="String"&&h2!=="Boolean"?c2[d2][u]="instanceof_"+h2:c2[d2][u]=o[d2][u]}else c2[d2][u]=o[d2][u]}else{let u=o[d2].constructor.name;u.includes("Set")?c2[d2]=Array.from(o[d2]):u!=="Number"&&u!=="String"&&u!=="Boolean"?c2[d2]="instanceof_"+u:c2[d2]=o[d2]}a=c2}else a=o}else a=o;return a}return function(o,a){e.push(o);let f2=JSON.stringify(o,r,a);return n(),f2}}();JSON.stringifyFast===void 0&&(JSON.stringifyFast=Q);function ae(i3){if(typeof i3.__methods=="object")for(let e in i3.__methods){let t=i3.__methods[e],n=typeof t=="function"?t:P(t);e==="__operator"?i3.__setOperator(n):i3[e]=n.bind(i3)}}var L=class extends b{name=`service${Math.floor(Math.random()*1e15)}`;restrict;constructor(e){super({...e,loaders:e?.loaders?Object.assign({...F},e.loaders):{...F}}),e?.services&&this.addServices(e.services),e?.restrict&&(this.restrict=e.restrict),this.load(this)}addServices=e=>{for(let t in e)if(typeof e[t]=="function"&&(e[t]=new e[t]),e[t]?.__node?.loaders&&Object.assign(this.__node.loaders,e[t].__node.loaders),e[t]?.__node?.nodes){e[t].__node.nodes.forEach((r,_2)=>{this.get(_2)?this.set(t+"."+_2,r):this.set(_2,r)}),this.__node.nodes.forEach((r,_2)=>{e[t].__node.nodes.get(_2)||e[t].__node.nodes.set(_2,r)});let n=this.set;this.set=(r,_2)=>(e[t].set(r,_2),n(r,_2));let s=this.delete;this.delete=r=>(e[t].delete(r),s(r))}else typeof e[t]=="object"&&this.load(e[t])};handleMethod=(e,t,n)=>{let s=t.toLowerCase(),r=this.__node.nodes.get(e);if(r||(r=this.__node.roots[e]),r?.[s])if(typeof r[s]!="function"){if(n){Array.isArray(n)&&n.length===1?r[s]=n[0]:r[s]=n;return}return r[s]}else return Array.isArray(n)?r[s](...n):r[s](n);else return this.handleServiceMessage({route:e,args:n,method:t})};handleServiceMessage(e){let t;return typeof e=="object"&&(e.route?t=e.route:e.node&&(t=e.node)),t?Array.isArray(e.args)?this.run(t,...e.args):this.run(t,e.args):e}handleGraphNodeCall(e,t){if(!e)return t;if(t?.args)this.handleServiceMessage(t);else return Array.isArray(t)?this.run(e,...t):this.run(e,t)}transmit=(...e)=>{if(typeof e[0]=="object"){let t=e[0];if(t.method)return this.handleMethod(t.route,t.method,t.args);if(t.route)return this.handleServiceMessage(t);if(t.node)return this.handleGraphNodeCall(t.node,t.args);this.__node.keepState&&(t.route&&this.setState({[t.route]:t.args}),t.node&&this.setState({[t.node]:t.args}));return}else return};receive=(...e)=>{if(e[0]){let t=e[0];if(typeof t=="string"){let n=t.substring(0,8);(n.includes("{")||n.includes("["))&&(n.includes("\\\\")&&(t=t.replace(/\\\\/g,"")),t[0]===\'"\'&&(t=t.substring(1,t.length-1)),t=JSON.parse(t))}if(typeof t=="object"){if(t.method)return this.restrict?.[t.route]?void 0:this.handleMethod(t.route,t.method,t.args);if(t.route)return this.restrict?.[t.route]?void 0:this.handleServiceMessage(t);if(t.node)return typeof t.node=="string"&&this.restrict?.[t.node]?void 0:this.handleGraphNodeCall(t.node,t.args);this.__node.keepState&&(t.route&&this.setState({[t.route]:t.args}),t.node&&this.setState({[t.node]:t.args}));return}}};pipe=(e,t,n,s,r)=>{if(e instanceof y)return r?this.subscribe(e,_2=>{let o=r(_2);o!==void 0?this.transmit({route:t,args:o,method:s}):this.transmit({route:t,args:_2,method:s},n)}):this.subscribe(e,_2=>{this.transmit({route:t,args:_2,method:s},n)});if(typeof e=="string")return this.subscribe(e,_2=>{this.transmit({route:t,args:_2,method:s},n)})};pipeOnce=(e,t,n,s,r)=>{if(e instanceof y)return r?e.__node.state.subscribeEventOnce(e.__node.unique,_2=>{let o=r(_2);o!==void 0?this.transmit({route:t,args:o,method:s}):this.transmit({route:t,args:_2,method:s},n)}):this.__node.state.subscribeEventOnce(e.__node.unique,_2=>{this.transmit({route:t,args:_2,method:s},n)});if(typeof e=="string")return this.__node.state.subscribeEventOnce(this.__node.nodes.get(e).__node.unique,_2=>{this.transmit({route:t,args:_2,method:s},n)})};terminate=(...e)=>{};isTypedArray=X;recursivelyAssign=M;spliceTypedArray=Y;ping=()=>(console.log("pinged!"),"pong");echo=(...e)=>(this.transmit(...e),e);log=(...e)=>(console.log(...e),true);error=(...e)=>(console.error(...e),true)};function X(i3){return ArrayBuffer.isView(i3)&&Object.prototype.toString.call(i3)!=="[object DataView]"}var M=(i3,e)=>{for(let t in e)e[t]?.constructor.name==="Object"&&!Array.isArray(e[t])?i3[t]?.constructor.name==="Object"&&!Array.isArray(i3[t])?M(i3[t],e[t]):i3[t]=M({},e[t]):i3[t]=e[t];return i3};function Y(i3,e,t){let n=i3.subarray(0,e),s;t&&(s=i3.subarray(t+1));let r;return(n.length>0||s?.length>0)&&(r=new i3.constructor(n.length+s.length)),r&&(n.length>0&&r.set(n),s&&s.length>0&&r.set(s,n.length)),r}var nodeTemplates={};var remoteGraphRoutes={transferNode:(properties,connection,name2)=>{let str2;if(typeof properties==="object"){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}str2=U(properties)}else if(typeof properties==="function")str2=properties.toString();else if(typeof properties==="string")str2=properties;if(str2){if(connection.run)return connection.run("setNode",[str2]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:str2},void 0);return new Promise(r=>r(name2))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:str2}));return new Promise(r=>r(name2))}}},setNode:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=ae}}}if(typeof properties==="string"){let f2=P(properties);if(typeof f2==="function")properties={__operator:f2,__node:{tag:name2?name2:f2.name}};else{f2=JSON.parse(properties);if(typeof f2==="object")properties=f2}}if(typeof properties==="object"||typeof properties==="function"){let template={};if(typeof properties==="object")Object.assign(template,properties);else template.__operator=properties;let node=this.__node.graph.add(template);if(node){nodeTemplates[node.__node.tag]=template;return node.__node?.tag}else return false}else return false},makeNodeTransferrable:function(properties,name2){if(!properties.__node){properties.__node={}}if(name2)properties.__node.tag=name2;for(const key in properties){if(typeof properties[key]==="function"){if(!properties.__methods)properties.__methods={};properties.__methods[key]=properties[key].toString()}}const str2=U(properties);return str2},getListenerJSON:function(){const triggers=this.__node.state.triggers;let result={};for(const key in triggers){triggers[key].forEach(trigger=>{let t=trigger;if(!result[t.target])result[t.target]={};let l=t.source+(t.key?"."+t.key:"");result[t.target][l]={__callback:t.__callback};if(t.__args)result[t.target][l].__args=t.__args;if(t.subInput)result[t.target][l].subInput=t.subInput})}return result},makeRootTransferrable:function(){let roots={};for(const r in this.__node.graph.__node.roots){let properties=this.__node.graph.__node.roots[r];if(typeof properties==="function"){roots[r]=properties.toString()}else if(typeof properties!=="object"){roots[r]=properties}else{roots[r]={};let keys=Object.getOwnPropertyNames(properties).filter(v2=>!objProps.includes(v2));let nonArrowFunctions=Object.getOwnPropertyNames(Object.getPrototypeOf(properties)).filter(v2=>!objProps.includes(v2));keys.push(...nonArrowFunctions);for(const key of keys){if(typeof properties[key]==="function"){roots[r][key]=properties[key].toString()}else if(typeof properties[key]==="object")roots[r][key]=z(properties[key]);else roots[r][key]=properties[key]}}}return roots},setTemplate:function(properties,name2){if(typeof properties==="object"){if(properties.__methods){if(!this.__node.graph.__node.loaders.methodstrings){this.__node.graph.__node.loaders.methodstrings=ae}}}if(typeof properties==="string"){let f2=P(properties);if(typeof f2==="function"){if(!name2)name2=f2.name;properties={__operator:f2,__node:{tag:name2}}}else{f2=JSON.parse(properties);if(typeof f2==="object"){properties=f2;if(!name2&&f2.__node?.tag)name2=f2.__node.tag}}}if(!name2)name2=`node${Math.floor(Math.random()*1e15)}`;if(typeof properties==="object"||typeof properties==="function"){nodeTemplates[name2]=properties;return name2}else return false},loadFromTemplate:function(templateName,name2,properties){if(nodeTemplates[templateName]){let cpy=M({},nodeTemplates[templateName]);if(name2){if(!cpy.__node)cpy.__node={};cpy.__node.tag=name2}if(properties)Object.assign(cpy,properties);let node=this.__node.graph.add(cpy);return node.__node.tag}},setMethod:function(nodeTag,fn,methodKey){if(typeof fn==="string"){let f2=P(fn);if(typeof f2==="function")fn=f2}if(!methodKey&&typeof fn==="function")methodKey=fn.name;if(this.__node.graph.get(nodeTag)){this.__node.graph.get(nodeTag)[methodKey]=fn}else this.__node.graph.add({__node:{tag:methodKey,[methodKey]:fn}});return true},assignNode:function(nodeTag,source){if(this.__node.graph.get(nodeTag)&&typeof source==="object"){Object.assign(this.__node.graph.get(nodeTag),source)}},getNodeProperties:function(nodeTag){let node=this.__node.graph.get(nodeTag);if(node){let properties=Object.getOwnPropertyNames(node);let result={};for(const key of properties){if(typeof node[key]==="function"){let str2=node[key].toString();let isNative=str2.indexOf("[native code]")>-1;result[key]={type:"function",args:se(node[key]),native:isNative}}else result[key]=typeof node[key]}return result}return void 0},proxyRemoteNode:function(name2,connection){return new Promise((res,rej)=>{connection.run("getNodeProperties",name2).then(props=>{let proxy={};if(typeof props==="object"){for(const key in props){if(props[key]?.type==="function"){if(props[key].native||props[key].args){proxy[key]=(...args)=>{return new Promise(r=>{connection.run(name2,args,key).then(r)})}}else{proxy[key]=()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})}}}else{Object.defineProperty(proxy,key,{get:()=>{return new Promise(r=>{connection.run(name2,void 0,key).then(r)})},set:value=>{connection.post(name2,value,key)},configurable:true,enumerable:true})}}}res(proxy)})})},transferClass:(classObj,connection,className)=>{if(typeof classObj==="object"){let str2=classObj.toString();let message={route:"receiveClass",args:[str2,className]};if(connection.run)return connection.run("receiveClass",[str2,className]);else if(connection.postMessage){connection.postMessage({route:"receiveClass",args:[str2,className]},void 0);return new Promise(r=>r(name))}else if(connection.send){connection.send(JSON.stringify({route:"receiveClass",args:[str2,className]}));return new Promise(r=>r(name))}return message}return false},receiveClass:function(stringified,className){if(typeof stringified==="string"){if(stringified.indexOf("class")===0){let cls=(0,eval)("("+stringified+")");let name2=className;if(!name2)name2=cls.name;this.__node.graph[name2]=cls;return true}}return false},transferFunction:(fn,connection,fnName)=>{if(!fnName)fnName=fn.name;let str2=fn.toString();let message={route:"setNode",args:[str2,fnName]};if(connection.run)return connection.run("setNode",[str2,fnName]);else if(connection.postMessage){connection.postMessage({route:"setNode",args:[str2,fnName]},void 0);return new Promise(r=>r(fnName))}else if(connection.send){connection.send(JSON.stringify({route:"setNode",args:[str2,fnName]}));return new Promise(r=>r(fnName))}return message},setGlobal:(key,value)=>{globalThis[key]=value;return true},assignGlobalObject:(target,source)=>{if(!globalThis[target])return false;if(typeof source==="object")Object.assign(globalThis[target],source);return true},setValue:function(key,value){this.__node.graph[key]=value;return true},assignObject:function(target,source){if(!this.__node.graph[target])return false;if(typeof source==="object")Object.assign(this.__node.graph[target],source);return true},setGlobalFunction:(fn,fnName)=>{if(typeof fn==="string")fn=P(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;globalThis[fnName]=fn;return true}return false},setGraphFunction:function(fn,fnName){if(typeof fn==="string")fn=P(fn);if(typeof fn==="function"){if(!fnName)fnName=fn.name;this.__node.graph[fnName]=fn;return true}return false}};var objProps=Object.getOwnPropertyNames(Object.getPrototypeOf({}));var browser_default=Worker;var WorkerService=class extends L{name="worker";workers={};threadRot=0;connections;constructor(options){super();this.connections={workers:this.workers};if(options?.services)this.addServices(options.services);this.load(this);this.setLoaders(this.workerloader);if(options)this.init(options);if(typeof WorkerGlobalScope!=="undefined"&&globalThis instanceof WorkerGlobalScope){this.addDefaultMessageListener()}}loadWorkerRoute=(node,routeKey)=>{if(node.workerUrl)node.url=node.workerUrl;if(node._id)node.__node.tag=node._id;if(!node.__node.tag)node.__node.tag=routeKey;node._id=node.__node.tag;let worker;if(this.workers[node._id])worker=this.workers[node._id];else if(node.worker)worker=node.worker;if(!worker){worker=this.addWorker(node)}node.worker=worker;if(!node.__ondisconnected){let ondelete=rt=>{rt.worker?.terminate()};node.__addOndisconnected(ondelete)}if(node.transferFunctions){for(const prop in node.transferFunctions){this.transferFunction(worker,node.transferFunctions[prop],prop)}}if(node.transferClasses){for(const prop in node.transferClasses){this.transferClass(worker,node.transferClasses[prop],prop)}}if(worker){if(!node.__operator){node.__operator=(...args)=>{if(node.callback){if(!this.__node.nodes.get(node.__node.tag)?.__children)worker.post(node.callback,args);else return worker.run(node.callback,args)}else{if(!this.__node.nodes.get(node.__node.tag)?.__children)worker.send(args);else return worker.request(args)}}}if(node.init){worker.run(node.init,node.initArgs,void 0,node.initTransfer)}return worker}};workerloader={"workers":(node,parent,graph,roots)=>{let rt=node;if(!node.parentRoute&&(parent?.callback&&parent?.worker))node.parentRoute=parent?.callback;if(rt?.worker||rt?._id&&this.workers[rt._id]||rt?.workerUrl){let worker=this.loadWorkerRoute(rt,rt.__node.tag);if(worker){if(!rt.parentRoute&&rt.__parent?.callback)rt.parentRoute=rt.__parent.callback;if(rt.__parent&&!rt.portId){if(typeof rt.__parent==="string"){if(rt.__node.tag!==rt.__parent&&worker._id!==rt.__parent)rt.portId=this.establishMessageChannel(worker,rt.__parent)}else if(rt.__node.tag!==rt.__parent?.__node?.tag&&worker._id!==rt.__parent?.tag){rt.portId=this.establishMessageChannel(worker,rt.__parent.worker)}};if(rt.parentRoute){if(!rt.stopped){if(typeof rt.__parent==="string"&&rt.__parent===worker._id){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else if(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag){worker.run("subscribe",[rt.parentRoute,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.parentRoute,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.parentRoute+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id)&&!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.parentRoute+rt.portId]={sub:null,route:rt.parentRoute,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent){if(typeof rt.__parent==="string"){if(!rt.stopped){if(rt.__parent===worker._id){worker.run("subscribe",[rt.__parent,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent+rt.portId].sub=sub})}if(!(typeof rt.__parent==="string"&&rt.__parent===worker._id))worker.workerSubs[rt.__parent+rt.portId]={sub:null,route:worker._id,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}else if(rt.__parent?.__node?.tag&&rt.__parent?.worker){if(!rt.stopped){if(rt.__node.tag===rt.__parent.__node.tag||worker._id===rt.__parent.__node.tag){worker.run("subscribe",[rt.__parent.__node.tag,void 0,void 0,rt.callback])}else worker.run("subscribeToWorker",[rt.__parent.__node.tag,rt.portId,void 0,rt.callback,void 0,void 0,rt.blocking]).then(sub=>{worker.workerSubs[rt.__parent.__node.tag+rt.portId].sub=sub})}if(!(rt.__node.tag===rt.__parent?.__node?.tag||worker._id===rt.__parent?.__node?.tag))worker.workerSubs[rt.__parent.__node.tag+rt.portId]={sub:null,route:rt.__parent.__node.tag,portId:rt.portId,callback:rt.callback,blocking:rt.blocking}}}}}else if(rt.__parent&&rt.parentRoute){if(typeof rt.__parent==="string"&&roots[rt.__parent]?.worker){roots[rt.__parent].worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}else if(rt.__parent?.worker){rt.__parent.worker.subscribe(rt.parentRoute,rt.__operator,void 0,void 0,void 0,rt.blocking)}}return rt}};addDefaultMessageListener=()=>{globalThis.onmessage=ev=>{let result=this.receive(ev.data);if(this.__node.keepState)this.setState({[this.name]:result})}};postMessage=(message,target,transfer)=>{if(this.workers[target]){this.workers[target].send(message,transfer)}else{globalThis.postMessage(message,target,transfer)}};addWorker=options=>{let worker;if(!options._id)options._id=`worker${Math.floor(Math.random()*1e15)}`;if(options.url)worker=new browser_default(options.url);else if(options.port){worker=options.port}else if(this.workers[options._id]){if(this.workers[options._id].port)worker=this.workers[options._id].port;else worker=this.workers[options._id].worker}if(!worker)return;let send=(message,transfer)=>{return this.transmit(message,worker,transfer)};let post=(route,args,method,transfer)=>{let message={route,args};if(method)message.method=method;return this.transmit(message,worker,transfer)};let run=(route,args,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[{route,args},options._id,callbackId]};if(method)req.args[0].method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let request=(message,method,transfer)=>{return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,options._id,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};let workerSubs={};let subscribe=(route,callback,args,key,subInput,blocking)=>{return this.subscribeToWorker(route,options._id,callback,args,key,subInput,blocking)};let unsubscribe=(route,sub)=>{return run("unsubscribe",[route,sub])};let start=async(route,portId,callback,blocking)=>{if(route)await run("subscribeToWorker",[route,portId,void 0,callback,blocking]).then(sub=>{if(sub)workerSubs[route+portId]={sub,route,portId,callback,blocking}});else for(const key in workerSubs){if(typeof workerSubs[key].sub!=="number")await run("subscribeToWorker",[workerSubs[key].route,workerSubs[key].portId,void 0,workerSubs[key].callback,void 0,workerSubs[key].blocking]).then(sub=>{workerSubs[key].sub=sub});console.log(JSON.stringify(workerSubs))}return true};let stop=async(route,portId)=>{if(route&&portId&&workerSubs[route+portId]){await run("unsubscribe",[route,workerSubs[route+portId].sub]);workerSubs[route+portId].sub=false}else{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){await run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub]).then(console.log)}workerSubs[key].sub=false}}return true};let terminate=()=>{for(const key in workerSubs){if(typeof workerSubs[key].sub==="number"){run("unpipeWorkers",[workerSubs[key].route,workerSubs[key].portId,workerSubs[key].sub])}workerSubs[key].sub=false}return this.terminate(options._id)};if(!options.onmessage)options.onmessage=ev=>{this.receive(ev.data);this.setState({[options._id]:ev.data})};if(!options.onerror){options.onerror=ev=>{console.error(ev.data)}}worker.onmessage=options.onmessage;worker.onerror=options.onerror;let workersettings={worker,__node:{tag:options._id},send,post,run,request,subscribe,unsubscribe,terminate,start,stop,postMessage:worker.postMessage,workerSubs,graph:this,...options};let node=this.add(workersettings);this.workers[options._id]=node;node.__addOndisconnected(function(){terminate()});return this.workers[options._id]};open=this.addWorker;close=()=>{globalThis.close()};getTransferable(message){let transfer;if(typeof message==="object"){if(message.args){if(message.args?.constructor?.name==="Object"){for(const key in message.args){if(ArrayBuffer.isView(message.args[key])){if(!transfer)transfer=[message.args[key].buffer];else transfer.push(message.args[key].buffer)}else if(message.args[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message.args[key]];else transfer.push(message.args[key])}}}else if(Array.isArray(message.args)&&message.args.length<11){message.args.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg?.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message.args)){transfer=[message.args.buffer]}else if(message.args?.constructor?.name==="ArrayBuffer"){transfer=[message]}}else if(message?.constructor?.name==="Object"){for(const key in message){if(ArrayBuffer.isView(message[key])){if(!transfer)transfer=[message[key].buffer];else transfer.push(message[key].buffer)}else if(message[key]?.constructor?.name==="ArrayBuffer"){if(!transfer)transfer=[message[key]];else transfer.push(message[key])}}}else if(Array.isArray(message)&&message.length<11){message.forEach(arg=>{if(ArrayBuffer.isView(arg)){transfer=[arg.buffer]}else if(arg.constructor?.name==="ArrayBuffer")transfer=[arg]})}else if(ArrayBuffer.isView(message)){transfer=[message.buffer]}else if(message.constructor?.name==="ArrayBuffer"){transfer=[message]}}return transfer}transmit=(message,worker,transfer)=>{if(!transfer){transfer=this.getTransferable(message)}if(worker instanceof browser_default||worker instanceof MessagePort){worker.postMessage(message,transfer)}else if(typeof worker==="string"){if(this.workers[worker]){if(this.workers[worker].port)this.workers[worker].port.postMessage(message,transfer);else if(this.workers[worker].worker)this.workers[worker].worker.postMessage(message,transfer)}}else{let keys=Object.keys(this.workers);this.workers[keys[this.threadRot]].worker.postMessage(message,transfer);this.threadRot++;if(this.threadRot===keys.length)this.threadRot=0}return message};terminate=worker=>{let onclose;let str2;if(typeof worker==="string"){str2=worker;let obj=this.workers[worker];if(obj){delete this.workers[worker];worker=obj.worker;if(obj.onclose)onclose=obj.onclose}}else if(typeof worker==="object"){if(worker?._id){worker=worker.worker;delete this.workers[worker?._id]}}if(worker instanceof browser_default){worker.terminate();if(onclose)onclose(worker);if(str2&&this.get(str2))this.remove(str2);return true}if(worker instanceof MessagePort){worker.close();if(onclose)onclose(worker);if(str2&&this.get(str2))this.remove(str2);return true}return false};establishMessageChannel=(worker,worker2)=>{let workerId;if(typeof worker==="string"){workerId=worker;if(this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker2=this.workers[worker].worker}}else if(worker?.worker){worker=worker.worker}if(typeof worker2==="string"){if(this.workers[worker2]){if(this.workers[worker2].port)worker2=this.workers[worker2].port;else worker2=this.workers[worker2].worker}}else if(worker2?.worker){worker2=worker2.worker}if(worker instanceof browser_default||worker instanceof MessagePort){let channel=new MessageChannel;let portId=`port${Math.floor(Math.random()*1e15)}`;worker.postMessage({route:"addWorker",args:{port:channel.port1,_id:portId}},[channel.port1]);if(worker2 instanceof browser_default||worker2 instanceof MessagePort){worker2.postMessage({route:"addWorker",args:{port:channel.port2,_id:portId}},[channel.port2])}else if(workerId&&this.workers[workerId]){channel.port2.onmessage=this.workers[workerId].onmessage;this.workers[workerId].port=channel.port2}return portId}return false};request=(message,workerId,transfer,method)=>{let worker=this.workers[workerId].worker;return new Promise((res,rej)=>{let callbackId=Math.random();let req={route:"runRequest",args:[message,callbackId]};if(method)req.method=method;let onmessage=ev=>{if(typeof ev.data==="object"){if(ev.data.callbackId===callbackId){worker.removeEventListener("message",onmessage);res(ev.data.args)}}};worker.addEventListener("message",onmessage);this.transmit(req,worker,transfer)})};runRequest=(message,worker,callbackId,getTransferable=true)=>{let res=this.receive(message);if(typeof worker==="string"&&this.workers[worker]){if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}if(res instanceof Promise){res.then(r=>{let transfer=getTransferable?this.getTransferable(r):void 0;if(worker instanceof browser_default||worker instanceof MessagePort)worker.postMessage({args:r,callbackId},transfer);else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:r,callbackId},transfer)})}else{let transfer=getTransferable?this.getTransferable(res):void 0;if(worker instanceof browser_default||worker instanceof MessagePort)worker.postMessage({args:res,callbackId},transfer);else if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope)globalThis.postMessage({args:res,callbackId},transfer)}return res};subscribeWorker=(route,worker,args,key,subInput,blocking,getTransferable=true)=>{if(this.restrict?.[route])return void 0;let callback;if(blocking){let blocked=false;callback=res=>{if(!blocked){blocked=true;if(res instanceof Promise){res.then(r=>{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,r]).then(ret=>{blocked=false})})}else{if(worker?.run)worker.run("triggerSubscription",[route,worker._id,res]).then(ret=>{blocked=false})}}}}else{callback=res=>{if(res instanceof Promise){res.then(r=>{let transfer=getTransferable?this.getTransferable(r):void 0;if(worker?.postMessage)worker.postMessage({args:r,callbackId:route},transfer);else if(globalThis.postMessage)globalThis.postMessage({args:r,callbackId:route},transfer)})}else{let transfer=getTransferable?this.getTransferable(res):void 0;if(worker?.postMessage)worker.postMessage({args:res,callbackId:route},transfer);else if(globalThis.postMessage)globalThis.postMessage({args:res,callbackId:route},transfer)}}}if(!blocking&&worker?.port){worker=worker.port}else if(!blocking&&worker?.worker){worker=worker.worker}else if(typeof worker==="string"&&this.workers[worker]){if(blocking)worker=this.workers[worker];else if(this.workers[worker].port)worker=this.workers[worker].port;else worker=this.workers[worker].worker}return this.subscribe(route,callback,args,key,subInput)};subscribeToWorker=(route,workerId,callback,args,key,subInput,blocking,getTransferable=true)=>{if(typeof workerId==="string"&&this.workers[workerId]){this.__node.state.subscribeEvent(workerId,res=>{if(res?.callbackId===route){if(!callback)this.setState({[workerId]:res.args});else if(typeof callback==="string"){this.run(callback,res.args)}else callback(res.args)}});return this.workers[workerId].run("subscribeWorker",[route,workerId,args,key,subInput,blocking,getTransferable])}};triggerSubscription=async(route,workerId,result)=>{if(this.__node.state.triggers[workerId])for(let i3=0;i3<this.__node.state.triggers[workerId].length;i3++){await this.__node.state.triggers[workerId][i3].onchange({args:result,callbackId:route})}return true};pipeWorkers=(sourceWorker,listenerWorker,sourceRoute,listenerRoute,portId,args,key,subInput,blocking,getTransferable)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof listenerWorker==="string")listenerWorker=this.workers[listenerWorker];if(!portId){portId=this.establishMessageChannel(sourceWorker.worker,listenerWorker.worker)}return listenerWorker.run("subscribeToWorker",[sourceRoute,portId,listenerRoute,args,key,subInput,blocking,getTransferable])};unpipeWorkers=(sourceRoute,sourceWorker,sub)=>{if(typeof sourceWorker==="string")sourceWorker=this.workers[sourceWorker];if(typeof sourceWorker==="object"){return sourceWorker.run("unsubscribe",[sourceRoute,sub])}}};var F2=(t=>typeof __require2<"u"?__require2:typeof Proxy<"u"?new Proxy(t,{get:(e,n)=>(typeof __require2<"u"?__require2:e)[n]}):t)(function(t){if(typeof __require2<"u")return __require2.apply(this,arguments);throw Error(\'Dynamic require of "\'+t+\'" is not supported\')});var d=y2(["ctrlKey","metaKey","altKey","shiftKey","button","which","pointerType","clientX","clientY","pageX","pageY","movementX","movementY","x","y","which","timeStamp"]);var j2=y2(["deltaX","deltaY"]);var G2=y2(["ctrlKey","metaKey","shiftKey","altKey","isComposing","keyCode","key","code","repeat","timeStamp"]);var B2=y2(["alpha","beta","gamma","absolute","webkitCompassHeading","webkitCompassAccuracy"]);var K=(t,e,n)=>{n&&t.preventDefault&&t.preventDefault();let a={type:"devicemotion",acceleration:{x:t.acceleration.x,y:t.acceleration.y,z:t.acceleration.y},accelerationIncludingGravity:{x:t.accelerationIncludingGravity.x,y:t.accelerationIncludingGravity.y,z:t.accelerationIncludingGravity.y},rotationRate:{alpha:t.rotationRate.alpha,beta:t.rotationRate.beta,gamma:t.rotationRate.gamma},interval:t.interval};e(a)};var z2=(t,e,n)=>{n&&t.preventDefault&&t.preventDefault();let a={type:"orientation",target:{type:t.target.type,angle:t.target.angle}};e(a)};function X2(t,e,n){for(let a of e)n[a]=t[a]}function y2(t){return function(n,a,r){r&&n.preventDefault&&n.preventDefault();let s={type:n.type};X2(n,t,s),a(s)}}function Y2(t,e,n){n&&t.preventDefault&&t.preventDefault()}function P2(t,e){let n={type:t.type};n.isTrusted=t.isTrusted,n.bubbles=t.bubbles,n.cancelBubble=t.cancelBubble,n.cancelable=t.cancelable,n.composed=t.composed,n.defaultPrevent=t.defaultPrevented,n.eventPhase=t.eventPhase,n.returnValue=t.returnValue,n.currentTarget=t.currentTarget.id?t.currentTarget.id:t.currentTarget.constructor.name,n.target=n.currentTarget,n.srcElement=n.currentTarget,e(n)}function $2(t,e,n){n&&t.preventDefault&&t.preventDefault(),j2(t,e)}function m(t,e,n){n&&t.preventDefault&&t.preventDefault();let a=[],r={type:t.type,touches:a};for(let s=0;s<t.touches.length;++s){let i3=t.touches[s];a.push({pageX:i3.pageX,pageY:i3.pageY})}e(r)}var C2=1;var W2={};for(;C2<222;)W2[C2]=true,C2++;function A2(t,e,n){let{keyCode:a}=t;W2[a]&&(n&&t.preventDefault&&(a<110||a>123)&&t.preventDefault(),G2(t,e))}var c={contextmenu:Y2,mousedown:d,mousemove:d,mouseup:d,pointerdown:d,pointermove:d,pointerup:d,pointerlockchange:d,webkitpointerlockchange:d,focus:P2,blur:P2,pointerout:d,touchstart:m,touchmove:m,touchend:m,wheel:$2,keydown:A2,keyup:A2,deviceorientation:B2,devicemotion:K,orientation:z2};function p(t,e,n,a){n||(n="proxy"+Math.floor(Math.random()*1e15));let r=o=>{e?e.postMessage({route:"handleProxyEvent",args:[o,n]}):M2(o,n)},s=Object.entries(c),i3={};for(let[o,u]of s)i3[o]=function(O2){u(O2,r,a)},t.addEventListener(o,i3[o]);c.keydown&&(i3.keydown=function(o){c.keydown(o,r,a)},globalThis.addEventListener("keydown",i3.keydown)),c.keyup&&(i3.keyup=function(o){c.keyup(o,r,a)},globalThis.addEventListener("keyup",i3.keyup)),c.devicemotion&&(i3.devicemotion=function(o){c.devicemotion(o,r,a)},globalThis.addEventListener("devicemotion",i3.devicemotion)),c.deviceorientation&&(i3.deviceorientation=function(o){c.deviceorientation(o,r,a)},globalThis.addEventListener("deviceorientation",i3.deviceorientation)),c.orientation&&(i3.orientation=o=>{c.orientation(o,r,a)},screen.orientation.addEventListener("change",i3.orientation));let l=()=>{let o=t.getBoundingClientRect();r({type:"resize",left:o.left,top:o.top,width:t.clientWidth,height:t.clientHeight})};return l(),globalThis.addEventListener("resize",l),{functions:i3,terminate:()=>{for(let o in i3)o==="keyup"||o==="keydown"||o==="devicemotion"||o==="deviceorientation"?globalThis.removeEventListener(o,i3[o]):o==="orientation"?screen.orientation.removeEventListener("change",i3[o]):t.removeEventListener(o,i3[o])},id:n}}var w2=class{__listeners;addEventListener(e,n){this.__listeners===void 0&&(this.__listeners={});let a=this.__listeners;a[e]===void 0&&(a[e]=[]),a[e].indexOf(n)===-1&&a[e].push(n)}hasEventListener(e,n){if(this.__listeners===void 0)return false;let a=this.__listeners;return a[e]!==void 0&&a[e].indexOf(n)!==-1}removeEventListener(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e];if(r!==void 0){let s=r.indexOf(n);s!==-1&&r.splice(s,1)}}dispatchEvent(e,n){if(this.__listeners===void 0)return;let r=this.__listeners[e.type];if(r!==void 0){n?e.target=n:e.target=this;let s=r.slice(0);for(let i3=0,l=s.length;i3<l;i3++)s[i3].call(this,e)}}};function S2(){}var b2=class extends w2{__listeners={};proxied;style={};width;left;right;top;height;constructor(){super(),this.style={}}get clientWidth(){return this.width}get clientHeight(){return this.height}setPointerCapture=()=>{};releasePointerCapture=()=>{};getBoundingClientRect=()=>({left:this.left,top:this.top,width:this.width,height:this.height,right:this.left+this.width,bottom:this.top+this.height});handleEvent=e=>{e.type==="resize"&&(this.left=e.left,this.top=e.top,this.width=e.width,this.height=e.height,typeof this.proxied=="object"&&(this.proxied.style.width=this.width+"px",this.proxied.style.height=this.height+"px",this.proxied.clientWidth=this.width,this.proxied.clientHeight=this.height)),e.preventDefault=S2,e.stopPropagation=S2,this.dispatchEvent(e,this.proxied)};focus(){}blur(){}};var g=class{targets={};constructor(){globalThis.document||(globalThis.document={elementFromPoint:(...e)=>this.targets[Object.keys(this.targets)[0]].proxied})}makeProxy=(e,n)=>{e||(e=`proxyReceiver${Math.floor(Math.random()*1e15)}`);let a;this.targets[e]?a=this.targets[e]:(a=new b2,this.targets[e]=a),typeof n=="object"&&(n.proxy=a,a.proxied=n,typeof WorkerGlobalScope<"u"&&(n.style=a.style),a.width&&(n.style.width=a.width+"px",n.clientWidth=a.width),a.height&&(n.style.height=a.height+"px",n.clientHeight=a.height),n.setPointerCapture=a.setPointerCapture.bind(a),n.releasePointerCapture=a.releasePointerCapture.bind(a),n.getBoundingClientRect=a.getBoundingClientRect.bind(a),n.addEventListener=a.addEventListener.bind(a),n.removeEventListener=a.removeEventListener.bind(a),n.handleEvent=a.handleEvent.bind(a),n.dispatchEvent=a.dispatchEvent.bind(a),n.focus=a.focus.bind(a),n.blur=a.blur.bind(a))};getProxy=e=>this.targets[e];handleEvent=(e,n)=>{if(this.targets[n]||this.makeProxy(n),this.targets[n])return this.targets[n].handleEvent(e),true}};function q2(t,e){return this?.__node?.graph?(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new g),this.__node.graph.ProxyManager.makeProxy(t,e)):(globalThis.ProxyManager||(globalThis.ProxyManager=new g),globalThis.ProxyManager.makeProxy(t,e)),t}function M2(t,e){if(this?.__node?.graph){if(this.__node.graph.ProxyManager||(this.__node.graph.ProxyManager=new g),this.__node.graph.ProxyManager.handleEvent(t,e))return t}else if(globalThis.ProxyManager||(globalThis.ProxyManager=new g),globalThis.ProxyManager.handleEvent(t,e))return t}var v={initProxyElement:p,makeProxy:q2,handleProxyEvent:M2};var k2;if(typeof process<"u")try{typeof import_meta<"u"&&(globalThis.__filename=fileURLToPath(import_meta.url),globalThis.__dirname=fileURLToPath(new URL(".",import_meta.url))),k2=F2("path").join(process.cwd(),__dirname,"canvas.worker.js")}catch{}else{let e=globalThis.location.href.split("/");e.pop(),e=e.join("/"),k2=e+"/canvas.worker.js"}var T2=k2;function I2(t){if(t.worker===true&&(t.worker=T2),t.worker){let e=t.worker,n=t.route;return(e instanceof Blob||typeof e=="string")&&(e=new Worker(e)),delete t.worker,delete t.route,N2(e,t,n)}else return p(t.canvas,void 0,t._id,t.preventDefault),V2(t)}function N2(t,e,n){if(!e)return;e._id||(e._id=`canvas${Math.floor(Math.random()*1e15)}`);let a=e.canvas instanceof OffscreenCanvas?e.canvas:e.canvas.transferControlToOffscreen();e.width||(e.width=e.canvas.clientWidth),e.height||(e.height=e.canvas.clientHeight);let r={route:n||"setupCanvas",args:{...e,canvas:a}},s;this?.__node?.graph?s=this.__node.graph.run("initProxyElement",e.canvas,t,e._id,e.preventDefault):s=p(e.canvas,t,e._id,e.preventDefault),e.draw&&(typeof e.draw=="function"?r.args.draw=e.draw.toString():r.args.draw=e.draw),e.update&&(typeof e.update=="function"?r.args.update=e.update.toString():r.args.update=e.update),e.init&&(typeof e.init=="function"?r.args.init=e.init.toString():r.args.init=e.init),e.clear&&(typeof e.clear=="function"?r.args.clear=e.clear.toString():r.args.clear=e.clear);let i3=[a];return e.transfer&&(i3.push(...e.transfer),delete e.transfer),t.postMessage(r,i3),{_id:e._id,width:e.width,height:e.height,worker:t,draw:(o,u)=>{t.postMessage({route:"drawFrame",args:[o,e._id]},u)},update:(o,u)=>{t.postMessage({route:"updateCanvas",args:[o,e._id]},u)},clear:()=>{t.postMessage({route:"clearCanvas",args:e._id})},init:()=>{t.postMessage({route:"initCanvas",args:e._id})},stop:()=>{t.postMessage({route:"stopAnim",args:e._id})},start:()=>{t.postMessage({route:"startAnim",args:e._id})},set:(o,u)=>{t.postMessage({route:"setDraw",args:[o,e._id]},u)},terminate:()=>{s&&s.terminate(),t.terminate()}}}function _(t,e){let n;if(this?.__node?.graph?e?n=this.__node.graph.CANVASES?.[t._id]:t._id?n=this.__node.graph.CANVASES?.[t._id]:n=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:e||t._id?n=globalThis.CANVASES?.[t._id]:n=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],n){if(t.canvas){n.canvas=t.canvas,n.proxy&&n.proxy.terminate();let a;this?.__node?.graph?a=this.__node.graph.run("makeProxy",n._id,n.canvas):a=v.makeProxy(n._id,n.canvas),n.proxy=a}return typeof t.context=="string"?n.context=n.canvas.getContext(t.context):t.context&&(n.context=t.context),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),typeof t.draw=="string"&&(t.draw=f(t.draw)),typeof t.draw=="function"&&(n.draw=t.draw.bind(t)),typeof t.update=="string"&&(t.update=f(t.update)),typeof t.update=="function"&&(n.update=t.update.bind(t)),typeof t.init=="string"&&(t.init=f(t.init)),typeof t.init=="function"&&(n.init=t.init.bind(t)),typeof t.clear=="string"&&(t.clear=f(t.clear)),typeof t.clear=="function"&&(n.clear=t.clear.bind(t)),t._id}}function V2(t){this?.__node?.graph?this.__node.graph.CANVASES||(this.__node.graph.CANVASES={}):globalThis.CANVASES||(globalThis.CANVASES={});let e=t;t._id?e._id=t._id:e._id=`canvas${Math.floor(Math.random()*1e15)}`,typeof t.context=="string"?e.context=t.canvas.getContext(t.context):e.context=t.context,"animating"in t?e.animating=t.animating:e.animating=true;let n;if(this?.__node?.graph?.CANVASES[e._id])this.__node.graph.run("setDraw",e);else if(globalThis.CANVASES?.[e._id])_(e);else{this?.__node?.graph&&(e.graph=this.__node.graph,e.__node||(e.__node={}),e.__node.tag||(e.__node.tag=e._id),e=this.__node.graph.add(e),e.__addOndisconnected=()=>{e.stop(),delete this.__node.graph.CANVASES[e._id]}),this?.__node?.graph?this.__node.graph.CANVASES[e._id]=e:globalThis.CANVASES[e._id]=e,this?.__node?.graph?n=this.__node.graph.run("makeProxy",e._id,e.canvas):n=v.makeProxy(e._id,e.canvas),t.width&&(e.canvas.width=t.width),t.height&&(e.canvas.height=t.height),typeof e.draw=="string"?e.draw=f(e.draw):typeof e.draw=="function"&&(e.draw=e.draw.bind(e)),typeof e.update=="string"?e.update=f(e.update):typeof e.update=="function"&&(e.update=e.update.bind(e)),typeof e.init=="string"?e.init=f(e.init):typeof e.init=="function"&&(e.init=e.init.bind(e)),typeof e.clear=="string"?e.clear=f(e.clear):typeof e.clear=="function"&&(e.clear=e.clear.bind(e));let a=()=>{if(e.stop=()=>{x2(e._id)},e.start=r=>{E(e._id,r)},e.set=r=>{_(r,e._id)},typeof e.draw=="function"&&e.animating){let r=(s,i3,l)=>{if(s.animating){let o=s.draw(s,i3,l);o?.then?o.then(()=>{requestAnimationFrame(()=>{r(s,i3,l)})}):requestAnimationFrame(()=>{r(s,i3,l)})}};r(e,e.canvas,e.context)}if(typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope)return e._id;{let r={_id:t._id,width:t.width,height:t.height,proxy:n,draw:s=>{L2(s,t._id)},update:s=>{R2(s,t._id)},clear:()=>{D2(t._id)},init:()=>{H2(t._id)},stop:()=>{x2(t._id)},start:()=>{E(t._id)},set:s=>{_(s,t._id)},terminate:()=>{r.proxy&&r.proxy.terminate(),this.__node?.graph?this.__node.graph.remove(t._id):(x2(t._id),this?.__node?.graph?delete this.__node.graph.CANVASES[e._id]:delete globalThis.CANVASES[e._id])}};return r}};if(typeof e.init=="function"){let r=e.init(e,e.canvas,e.context);return r?.then?new Promise(s=>{r.then(()=>{s(a())})}):a()}else a()}}function L2(t,e){let n=h.call(this,e);if(n&&(t&&Object.assign(n,t),n.draw))return n.draw(n,n.canvas,n.context),e}function D2(t){let e=h.call(this,t);if(e?.clear)return e.clear(e,e.canvas,e.context),t}function H2(t){let e=h.call(this,t);if(e?.init)return e.init(e,e.canvas,e.context),t}function R2(t,e){let n=h.call(this,e);if(n?.update)return n.update(n,n.canvas,n.context,t),e}function U2(t,e){let n=h.call(this,e);if(n&&t)return Object.assign(n,t),t.width&&(n.canvas.width=t.width),t.height&&(n.canvas.height=t.height),e}function E(t,e){let n=h.call(this,t);if(n.animating=true,n&&e)return typeof e=="string"&&(e=f(e)),typeof e=="function"&&(n.draw=e),t;if(typeof n?.draw=="function"){let a=(r,s,i3)=>{r.animating&&(r.draw(r,s,i3),requestAnimationFrame(()=>{a(r,s,i3)}))};return typeof n.clear=="function"&&n.clear(n,n.canvas,n.context),typeof n.init=="function"&&n.init(n,n.canvas,n.context),a(n,n.canvas,n.context),t}}function x2(t){let e=h.call(this,t);if(e)return e.animating=false,typeof e.clear=="function"&&requestAnimationFrame(e.clear(e,e.canvas,e.context)),t}function h(t){let e;return this?.__node?.graph?t?e=this.__node.graph.CANVASES?.[t]:e=this.__node.graph.CANVASES?.[Object.keys(this.__node.graph.CANVASES)[0]]:t?e=globalThis.CANVASES?.[t]:e=globalThis.CANVASES?.[Object.keys(globalThis.CANVASES)[0]],e}var ne={...v,Renderer:I2,transferCanvas:N2,setupCanvas:V2,setDraw:_,drawFrame:L2,clearCanvas:D2,initCanvas:H2,updateCanvas:R2,setProps:U2,startAnim:E,stopAnim:x2,getCanvas:h};function f(t=""){let e=i3=>i3.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4"),a=(i3=>{let l=i3.indexOf("=>")+1;return l<=0&&(l=i3.indexOf("){")),l<=0&&(l=i3.indexOf(") {")),i3.slice(0,i3.indexOf("{",l)+1)})(t),r=e(t),s;if(a.includes("function")){let i3=a.split("(")[1].split(")")[0];s=new Function(i3,r)}else if(a.substring(0,6)===r.substring(0,6)){let i3=a.split("(")[1].split(")")[0];s=new Function(i3,r.substring(r.indexOf("{")+1,r.length-1))}else try{s=(0,eval)(a+r+"}")}catch{}return s}var ArrayManip=class _ArrayManip{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y3=>{if(clamp){if(y3<min)y3=min;if(y3>max)y3=max}return y3*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y3=>{if(clamp){if(y3<min)y3=min;if(y3>max)y3=max}return 2*((y3-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps10){let now=Date.now();let toInterp=[now-ct*1e3/sps10,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i3=incr;i3<array.length;i3+=incr){let rounded=Math.round(i3);if(rounded>lastIdx)rounded=lastIdx;for(let j3=last;j3<rounded;j3++){output[counter]+=array[j3]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i3=1;i3<fitCount-1;i3++){var tmp=i3*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i3]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h2,s,l,scalar=255){s/=100;l/=100;let c2=(1-Math.abs(2*l-1))*s,x3=c2*(1-Math.abs(h2/60%2-1)),m2=l-c2/2,r=0,g2=0,b3=0;if(0<=h2&&h2<60){r=c2;g2=x3;b3=0}else if(60<=h2&&h2<120){r=x3;g2=c2;b3=0}else if(120<=h2&&h2<180){r=0;g2=c2;b3=x3}else if(180<=h2&&h2<240){r=0;g2=x3;b3=c2}else if(240<=h2&&h2<300){r=x3;g2=0;b3=c2}else if(300<=h2&&h2<360){r=c2;g2=0;b3=x3}r=(r+m2)*scalar;g2=(g2+m2)*scalar;b3=(b3+m2)*scalar;return[r,g2,b3]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d2={};data.forEach((arr,i3)=>{d2[i3]=arr});data=d2;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\\r\\n")){let lines=data.split("\\r\\n");data={};lines.forEach((l,j3)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_2,i3)=>lastValue+slopeIncr*(i3+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}static{this.bufferValues=(objects,property,keys,buffer)=>{if(!Array.isArray(keys)&&typeof keys==="object")keys=Object.keys(keys);if(!buffer){let object_keys=Object.keys(objects);if(keys)buffer=new Float32Array(object_keys.length*keys.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys.length)}else buffer=new Float32Array(object_keys.length)}}let i3=0;for(const key in objects){if(objects[key][property]){if(keys){for(let j3=0;j3<keys.length;j3++){buffer[i3]=objects[key][property][keys[j3]];i3++}}else{buffer[i3]=objects[key][property];i3++}}}return buffer}}isTypedArray(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var rechk=/^([<>])?(([1-9]\\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\\d*)?([xcbB?hHiIfdsp])/g;var str=(v2,o,c2)=>String.fromCharCode(...new Uint8Array(v2.buffer,v2.byteOffset+o,c2));var rts=(v2,o,c2,s)=>new Uint8Array(v2.buffer,v2.byteOffset+o,c2).set(s.split("").map(str2=>str2.charCodeAt(0)));var pst=(v2,o,c2)=>str(v2,o+1,Math.min(v2.getUint8(o),c2-1));var tsp=(v2,o,c2,s)=>{v2.setUint8(o,s.length);rts(v2,o+1,c2-1,s)};var lut=le=>({x:c2=>[1,c2,0],c:c2=>[c2,1,o=>({u:v2=>str(v2,o,1),p:(v2,c3)=>rts(v2,o,1,c3)})],"?":c2=>[c2,1,o=>({u:v2=>Boolean(v2.getUint8(o)),p:(v2,B3)=>v2.setUint8(o,B3)})],b:c2=>[c2,1,o=>({u:v2=>v2.getInt8(o),p:(v2,b3)=>v2.setInt8(o,b3)})],B:c2=>[c2,1,o=>({u:v2=>v2.getUint8(o),p:(v2,B3)=>v2.setUint8(o,B3)})],h:c2=>[c2,2,o=>({u:v2=>v2.getInt16(o,le),p:(v2,h2)=>v2.setInt16(o,h2,le)})],H:c2=>[c2,2,o=>({u:v2=>v2.getUint16(o,le),p:(v2,H3)=>v2.setUint16(o,H3,le)})],i:c2=>[c2,4,o=>({u:v2=>v2.getInt32(o,le),p:(v2,i3)=>v2.setInt32(o,i3,le)})],I:c2=>[c2,4,o=>({u:v2=>v2.getUint32(o,le),p:(v2,I3)=>v2.setUint32(o,I3,le)})],f:c2=>[c2,4,o=>({u:v2=>v2.getFloat32(o,le),p:(v2,f2)=>v2.setFloat32(o,f2,le)})],d:c2=>[c2,8,o=>({u:v2=>v2.getFloat64(o,le),p:(v2,d2)=>v2.setFloat64(o,d2,le)})],s:c2=>[1,c2,o=>({u:v2=>str(v2,o,c2),p:(v2,s)=>rts(v2,o,c2,s.slice(0,c2))})],p:c2=>[1,c2,o=>({u:v2=>pst(v2,o,c2),p:(v2,s)=>tsp(v2,o,c2,s.slice(0,c2-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var ByteParser=class _ByteParser extends ArrayManip{static{this.codes={"\\\\n":10,"\\\\r":13,"\\\\t":9,"\\\\s":32,"\\\\b":8,"\\\\f":12,"\\\\":92}}static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){indices.push(i3);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y3){return[y3&255,y3>>8&255]}static bytesToInt24(x0,x1,x22){let int24=(255&x0)<<16|(255&x1)<<8|255&x22;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x22){return x0*65536+x1*256+x22}static Uint24ToBytes(y3){return[y3&255,y3>>8&255,y3>>16&255]}static bytesToInt32(x0,x1,x22,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x22)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x22,x3){return x0*16777216+x1*65536+x22*256+x3}static Uint32ToBytes(y3){return[y3&255,y3>>8&255,y3>>16&255,y3>>24&255]}static get2sCompliment(val,nbits4){if(val>4294967296)return null;return val<<32-nbits4>>32-nbits4}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i3=0;i3<input.length;i3++){var c2=input.charCodeAt(i3);if(c2>127){throw new TypeError("Only ASCII patterns are supported")}arr[i3]=c2}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){const pattern=new Uint8Array(patternBuffer);const M3=pattern.length;if(M3===0){throw new TypeError("patternBuffer must be at least 1 byte long")}const R3=256;const rightmost_positions=new Int32Array(R3).fill(-1);for(let j3=0;j3<M3;j3++){rightmost_positions[pattern[j3]]=j3}const boyerMooreSearch=(txtBuffer,start=0,end=txtBuffer.byteLength)=>{const txt=txtBuffer instanceof Uint8Array?txtBuffer:new Uint8Array(txtBuffer);const lastIndex=end-M3;const lastPatIndex=M3-1;for(let i3=start;i3<=lastIndex;){let skip=0;for(let j3=lastPatIndex;j3>=0;j3--){if(pattern[j3]!==txt[i3+j3]){skip=Math.max(1,j3-rightmost_positions[txt[i3+j3]]);break}}if(skip===0){return i3}i3+=skip}return-1};boyerMooreSearch.byteLength=M3;return boyerMooreSearch}static struct(format){let fns=[],size=0,m2=rechk.exec(format);if(!m2){throw new RangeError("Invalid format string")}const t=lut("<"===m2[1]),lu=(n,c2)=>t[c2](n?parseInt(n,10):1);while(m2=refmt.exec(format)){((r,s,f2)=>{for(let i3=0;i3<r;++i3,size+=s){if(f2){fns.push(f2(size))}}})(...lu(...m2.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v2=new DataView(arrb,offs|0);return fns.map(f2=>f2.u(v2))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v2=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f2,i3)=>f2.p(v2,values[i3]))};const pack=(...values)=>{let b3=new ArrayBuffer(size);pack_into(b3,0,...values);return b3};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};(function(s){var w3,f2={},l=console,m2=Math,z3="postMessage",x3="HackTimer.js by turuslan: ",v2="Initialisation failed",p2=0,r="hasOwnProperty",y3=[].slice,b3=Worker;function d2(){do{p2=2147483647>p2?p2+1:0}while(f2[r](p2));return p2}if(!/MSIE 10/i.test(navigator.userAgent)){try{s=URL.createObjectURL(new Blob(["var f={},p=postMessage,r=\'hasOwnProperty\';onmessage=function(e){var d=e.data,i=d.i,t=d[r](\'t\')?d.t:0;switch(d.n){case\'a\':f[i]=setInterval(function(){p(i)},t);break;case\'b\':if(f[r](i)){clearInterval(f[i]);delete f[i]}break;case\'c\':f[i]=setTimeout(function(){p(i);if(f[r](i))delete f[i]},t);break;case\'d\':if(f[r](i)){clearTimeout(f[i]);delete f[i]}break}}"]))}catch(e){}}if(typeof b3!=="undefined"){try{w3=new b3(s);setInterval=function(c2,t){var i3=d2();f2[i3]={c:c2,p:y3.call(arguments,2)};w3[z3]({n:"a",i:i3,t});return i3};clearInterval=function(i3){if(f2[r](i3))delete f2[i3],w3[z3]({n:"b",i:i3})};setTimeout=function(c2,t){var i3=d2();f2[i3]={c:c2,p:y3.call(arguments,2),t:true};w3[z3]({n:"c",i:i3,t});return i3};clearTimeout=function(i3){if(f2[r](i3))delete f2[i3],w3[z3]({n:"d",i:i3})};w3.onmessage=function(e){var i3=e.data,c2,n;if(f2[r](i3)){n=f2[i3];c2=n.c;if(n[r]("t"))delete f2[i3]}if(typeof c2=="string")try{c2=new Function(c2)}catch(k3){l.log(x3+"Error parsing callback code string: ",k3)}if(typeof c2=="function")c2.apply(globalThis,n.p)};w3.onerror=function(e){l.log(e)}}catch(e){l.log(x3+v2);l.error(e)}}else l.log(x3+v2+" - HTML5 Web Worker is not supported")})("HackTimerWorker.min.js");var WebSerial=class _WebSerial extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=_WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message,chunkSize){const writer=port.writable.getWriter();if(chunkSize){const view=_WebSerial.toDataView(message);const len=view.buffer.byteLength;for(let i3=0;i3<len;i3+=chunkSize){let endIdx=i3+chunkSize;if(endIdx>len)endIdx=len;const slice=new DataView(view.buffer.slice(i3,endIdx));await writer.write(slice)}}else{await writer.write(_WebSerial.toDataView(message))}writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=_WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i3;else{nextIndex=i3;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}async writeStream(stream,message,chunkSize){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();if(chunkSize){const view=_WebSerial.toDataView(message);const len=view.buffer.byteLength;for(let i3=0;i3<len;i3+=chunkSize){let endIdx=i3+chunkSize;if(endIdx>len)endIdx=len;const slice=new DataView(view.buffer.slice(i3,endIdx));await writer.write(slice)}}else{await writer.write(_WebSerial.toDataView(message))}writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i3=0;i3<ports.length;i3++){if(ports[i3].getInfo().usbVendorId===info.usbVendorId&&ports[i3].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i3],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i3]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t=>{let opt=transforms[t];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str2=stream;transform.forEach(transform2=>{str2=str2.pipeThrough(transform2)});return str2}};var sps=250;var gain=32;var nbits=24;var vref=1.2;var half24bit=Math.pow(2,24)/2;function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i3=0;i3<9;i3++){let j3=i3*25;output[0][i3]=ByteParser.bytesToInt24(arr[j3],arr[j3+1],arr[j3+2]);output[1][i3]=ByteParser.bytesToInt24(arr[j3+3],arr[j3+4],arr[j3+5]);output[2][i3]=ByteParser.bytesToInt24(arr[j3+6],arr[j3+7],arr[j3+8]);output[3][i3]=ByteParser.bytesToInt24(arr[j3+9],arr[j3+10],arr[j3+11]);output[4][i3]=ByteParser.bytesToInt24(arr[j3+12],arr[j3+13],arr[j3+14]);output[5][i3]=ByteParser.bytesToInt24(arr[j3+15],arr[j3+16],arr[j3+17]);output[6][i3]=ByteParser.bytesToInt24(arr[j3+18],arr[j3+19],arr[j3+20]);output[7][i3]=ByteParser.bytesToInt24(arr[j3+21],arr[j3+22],arr[j3+23])}if(arr.length>225){output.leds=arr.slice(225)}return output}function ads131m08codec_singleended(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i3=0;i3<9;i3++){let j3=i3*25;output[0][i3]=ByteParser.bytesToInt24(arr[j3],arr[j3+1],arr[j3+2])+half24bit;output[1][i3]=ByteParser.bytesToInt24(arr[j3+3],arr[j3+4],arr[j3+5])+half24bit;output[2][i3]=ByteParser.bytesToInt24(arr[j3+6],arr[j3+7],arr[j3+8])+half24bit;output[3][i3]=ByteParser.bytesToInt24(arr[j3+9],arr[j3+10],arr[j3+11])+half24bit;output[4][i3]=ByteParser.bytesToInt24(arr[j3+12],arr[j3+13],arr[j3+14])+half24bit;output[5][i3]=ByteParser.bytesToInt24(arr[j3+15],arr[j3+16],arr[j3+17])+half24bit;output[6][i3]=ByteParser.bytesToInt24(arr[j3+18],arr[j3+19],arr[j3+20])+half24bit;output[7][i3]=ByteParser.bytesToInt24(arr[j3+21],arr[j3+22],arr[j3+23])+half24bit}if(arr.length>225){output.leds=arr.slice(225)}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var halfOffset=.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))*(Math.pow(2,nbits)-1)*.5;var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b3)=>a+b3;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<8;i3++){let idx=1+3*i3;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<8;i3++){let idx=1+3*i3;if(arr[0]%2===0)output[i3+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<128;i3++){let idx=i3*3+1;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i3=0;i3<128;i3++){freeeeg128ChartSettings.lines[i3]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i3]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<32;i3++){let idx=i3*3+1;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i3=0;i3<32;i3++){freeeeg32ChartSettings.lines[i3]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i3]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}function freeeeg16codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<16;i3++){let idx=i3*3+1;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=16*3+1;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var BLEBuffer=[];var locked;var lockIdx;function freeeeg16BLEcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;BLEBuffer.push(...data);const needle=new Uint8Array([192,160]);const haystack=BLEBuffer;const search=ByteParser.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=lockIdx??0;let pass=false;for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){if(!locked&&!(typeof lockIdx==="number"))used=lockIdx=i3;else{nextIndex=i3;if(nextIndex>=0){const len=nextIndex-used;if(!lockIdx){const line=BLEBuffer.splice(lockIdx,len);arr=new Uint8Array(line.slice(needle.length));pass=true;locked=true}else if(len>0){const line=BLEBuffer.splice(lockIdx,len);arr=new Uint8Array(line.slice(needle.length));pass=true}used=nextIndex}}}if(pass){let output={};for(let i4=0;i4<16;i4++){let idx=i4*3+1;output[i4]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=16*3+1;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}else return void 0}var sps5=250;var freeeeg16BLESettings={deviceType:"BLE",deviceName:"freeeeg16",services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:void 0},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:freeeeg16BLEcodec,sps:sps5}}}};var freeeeg16SerialSettings={deviceType:"USB",deviceName:"freeeeg16",baudRate:115200,bufferSize:2e3,frequency:3.5,codec:freeeeg16codec,sps:sps5,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting4={nSec:10,sps:sps5};var freeeeg16ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting4)),"ay":JSON.parse(JSON.stringify(defaultChartSetting4)),"az":JSON.parse(JSON.stringify(defaultChartSetting4)),"gx":JSON.parse(JSON.stringify(defaultChartSetting4)),"gy":JSON.parse(JSON.stringify(defaultChartSetting4)),"gz":JSON.parse(JSON.stringify(defaultChartSetting4))}};var freeeeg16FilterSettings={};var gain2=32;var nbits2=24;var vref2=1.2;for(let i3=0;i3<16;i3++){freeeeg16ChartSettings.lines[i3]={sps:sps5,nSec:10,units:"mV"};freeeeg16FilterSettings[i3]={sps:sps5,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};if(value.getInt8)value=new Uint8Array(value.buffer);else if(!value.buffer)value=new Uint8Array(value);let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps6=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\\n",codec:hegduinocodec,sps:sps6};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps6,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps6}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i3=0;while(i3<pktCt){let idx=i3*6;if(i3%2===0){output["ir"][i3]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i3+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i3-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i3]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i3++}return output}function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i3=0;i3<20;i3++){let idx=i3*12;output.ax[i3]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i3]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i3]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i3]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i3]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i3]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i3=0;i3<7;i3++){let j3=i3*26+1;if(!arr[j3+23])break;output[0][i3]=ByteParser.bytesToUInt24(arr[j3],arr[j3+1],arr[j3+2]);output[1][i3]=ByteParser.bytesToUInt24(arr[j3+3],arr[j3+4],arr[j3+5]);output[2][i3]=ByteParser.bytesToUInt24(arr[j3+6],arr[j3+7],arr[j3+8]);output[3][i3]=ByteParser.bytesToUInt24(arr[j3+9],arr[j3+10],arr[j3+11]);output[4][i3]=ByteParser.bytesToUInt24(arr[j3+12],arr[j3+13],arr[j3+14]);output[5][i3]=ByteParser.bytesToUInt24(arr[j3+15],arr[j3+16],arr[j3+17]);output[6][i3]=ByteParser.bytesToUInt24(arr[j3+18],arr[j3+19],arr[j3+20]);output[7][i3]=ByteParser.bytesToUInt24(arr[j3+21],arr[j3+22],arr[j3+23])}return output}var sps7=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps7}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps7};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps7;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting5={nSec:10,sps:sps7,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i3=0;while(i3<data.length){if(PeanutCodes[data[i3]]&&i3+1+PeanutCodes[data[i3]].byteLength<=data.length){let slice=data.slice(i3+1,i3+1+PeanutCodes[data[i3]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i3]].format).unpack(slice);let code=PeanutCodes[data[i3]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i3]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i3]].type]=unpacked;else result[PeanutCodes[data[i3]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i3]].type].push(...unpacked);else result[PeanutCodes[data[i3]].type].push(unpacked)}i3+=PeanutCodes[data[i3]].byteLength+1}else i3++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j3=0;j3<3;j3++){let i3=j3*16+2;let tint=ByteParser.bytesToInt32(arr[3+i3],arr[2+i3],arr[1+i3],arr[0+i3]);let tfrac=ByteParser.bytesToInt32(arr[7+i3],arr[6+i3],arr[5+i3],arr[4+i3]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i3],arr[10+i3],arr[9+i3],arr[8+i3]);let pfrac=ByteParser.bytesToInt32(arr[15+i3],arr[14+i3],arr[13+i3],arr[12+i3]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j3],output.temp[j3]))}}else{output.humidity=[];for(let j3=0;j3<3;j3++){let i3=j3*24+2;let tint=ByteParser.bytesToInt32(arr[3+i3],arr[2+i3],arr[1+i3],arr[0+i3]);let tfrac=ByteParser.bytesToInt32(arr[7+i3],arr[6+i3],arr[5+i3],arr[4+i3]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i3],arr[10+i3],arr[9+i3],arr[8+i3]);let pfrac=ByteParser.bytesToInt32(arr[15+i3],arr[14+i3],arr[13+i3],arr[12+i3]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToInt32(arr[19+i3],arr[18+i3],arr[17+i3],arr[16+i3]);let hfrac=ByteParser.bytesToInt32(arr[23+i3],arr[22+i3],arr[21+i3],arr[20+i3]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j3],output.temp[j3]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=Object.assign(output,ads131m08codec(arr.subarray(2)));Object.keys(result).forEach((key,i3)=>{output[i3+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,Object.assign(output,ads131m08codec(arr.subarray(2))))}return output}function nrf5x_usbcodec_singleended(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec_singleended(arr.subarray(2)))}else if(arr[0]===3){let result=Object.assign(output,ads131m08codec(arr.subarray(2)));Object.keys(result).forEach((key,i3)=>{output[i3+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,Object.assign(output,ads131m08codec_singleended(arr.subarray(2))))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xSerialSettings_singleended={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec_singleended,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var nrf5xBLESettings_singleended={deviceType:"BLE",deviceName:"nrf5x_singleended",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec_singleended,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec_singleended,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"4":JSON.parse(JSON.stringify(defaultChartSetting6)),"5":JSON.parse(JSON.stringify(defaultChartSetting6)),"6":JSON.parse(JSON.stringify(defaultChartSetting6)),"7":JSON.parse(JSON.stringify(defaultChartSetting6))},generateNewLines:true,cleanGeneration:false};var gain3=32;var nbits3=24;var vref3=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref3/(gain3*(Math.pow(2,nbits3)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps8=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps8}}},sps:sps8};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps9=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps9},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps9}}},sps:sps9};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v2,i3)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i3+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop()},loopTime)}};loop();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var NORDIC_SERVICE="6e400001-b5a3-f393-e0a9-e50e24dcca9e";var NORDIC_TX="6e400002-b5a3-f393-e0a9-e50e24dcca9e";var NORDIC_RX="6e400003-b5a3-f393-e0a9-e50e24dcca9e";var defaultChunkSize=128;var espruinocodec=data=>{let decoded=new Uint8Array(data.buffer);if(decoded.length>defaultChunkSize)defaultChunkSize=decoded.length;return{output:decoded}};var decoder2=new TextDecoder;var espruinoBLESettings={deviceType:"BLE",deviceName:"espruino",namePrefix:"Bangle.js",services:{[NORDIC_SERVICE]:{[NORDIC_TX]:{write:void 0},[NORDIC_RX]:{notify:true,codec:espruinocodec}}}};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps10=this.sps;this.notch50=[makeNotchFilter(50,sps10,2),makeNotchFilter(100,sps10,2)];this.notch60=[makeNotchFilter(60,sps10,2),makeNotchFilter(120,sps10,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps10),new Biquad("lowpass",this.lowpassHz,sps10),new Biquad("lowpass",this.lowpassHz,sps10),new Biquad("lowpass",this.lowpassHz,sps10)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps10=this.sps){this.notch50=[makeNotchFilter(50,sps10,2),makeNotchFilter(100,sps10,2)];this.notch60=[makeNotchFilter(60,sps10,2),makeNotchFilter(120,sps10,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps10),new Biquad("lowpass",this.lowpassHz,sps10),new Biquad("lowpass",this.lowpassHz,sps10),new Biquad("lowpass",this.lowpassHz,sps10)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps10,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps10=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps10),makeBandpassFilter(bandpassLower,bandpassUpper,sps10),makeBandpassFilter(bandpassLower,bandpassUpper,sps10),makeBandpassFilter(bandpassLower,bandpassUpper,sps10)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f2,i3)=>{out=f2.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f2,i3)=>{out=f2.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f2,i3)=>{out=f2.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f2,i3)=>{out=f2.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps10,Q2=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: \'lowpass\',\'highpass\',\'bandpass\',\'notch\',\'peak\',\'lowshelf\',\'highshelf\'");return}this.type=type;this.freq=freq;this.sps=sps10;this.Q=Q2;this.dbGain=dbGain;let A3=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps10;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q2);let beta=Math.sqrt(A3+A3);this[type](A3,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A3,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A3,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A3,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A3,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A3,sn,cs,alpha,beta){this.b0=1+alpha*A3;this.b1=-2*cs;this.b2=1-alpha*A3;this.a0=1+alpha/A3;this.a1=-2*cs;this.a2=1-alpha/A3}lowshelf(A3,sn,cs,alpha,beta){this.b0=A3*(A3+1-(A3-1)*cs+beta*sn);this.b1=2*A3*(A3-1-(A3+1)*cs);this.b2=A3*(A3+1-(A3-1)*cs-beta*sn);this.a0=A3+1+(A3+1)*cs+beta*sn;this.a1=2*(A3-1+(A3+1)*cs);this.a2=A3+1+(A3-1)*cs-beta*sn}highshelf(A3,sn,cs,alpha,beta){this.b0=A3*(A3+1+(A3-1)*cs+beta*sn);this.b1=2*A3*(A3-1+(A3+1)*cs);this.b2=A3*(A3+1-(A3-1)*cs-beta*sn);this.a0=A3+1-(A3+1)*cs-beta*sn;this.a1=2*(A3-1-(A3+1)*cs);this.a2=A3+1-(A3-1)*cs-beta*sn}applyFilter(signal_step){let y3=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y3;return y3}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q2=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q2}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q2=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q2}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y3=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y3;return y3}};var makeNotchFilter=(frequency,sps10,bandwidth)=>{return new Biquad("notch",frequency,sps10,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps10,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps10,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting7={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting7)),"1":JSON.parse(JSON.stringify(defaultChartSetting7)),"2":JSON.parse(JSON.stringify(defaultChartSetting7)),"3":JSON.parse(JSON.stringify(defaultChartSetting7)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"nrf5x_singleended":nrf5xBLESettings_singleended,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings,"freeEEG16":freeeeg16BLESettings,"espruino":espruinoBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"nrf5x_singleended":nrf5xSerialSettings_singleended,"freeEEG16":freeeeg16SerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.getInt8)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{if(data?.getInt8)return textdecoder3.decode(new Uint8Array(data.buffer));else return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg16":freeeeg16codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec,"espruino":espruinocodec};var getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\\W*(function[^{]+\\{([\\s\\S]*)\\}|[^=]+=>[^{]*\\{([\\s\\S]*)\\}|[^=]+=>(.+))/i,"$2$3$4")};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.substring(newFuncHead.indexOf("(")+1,newFuncHead.lastIndexOf(")"));newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.substring(newFuncHead.indexOf("(")+1,newFuncHead.lastIndexOf(")"));newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs2(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyWithFunctionsAndCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(typeof value==="function"?value.toString():value,path.join("."))}}}return typeof value==="function"?value.toString():value}return function stringifyWithFunctionsAndCircularRefs2(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithFunctionsAndCircularRefs===void 0){JSON.stringifyWithFunctionsAndCircularRefs=stringifyWithFunctionsAndCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c2=value.constructor.name;if(key&&c2==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c2==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c2.includes("Set")){val=Array.from(value)}else if(c2!=="Object"&&c2!=="Number"&&c2!=="String"&&c2!=="Boolean"){val="instanceof_"+c2}else if(c2==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p2 in value[prop]){if(Array.isArray(value[prop][p2])){if(value[prop][p2].length>20)obj[prop][p2]=value[prop][p2].slice(value[prop][p2].length-20);else obj[prop][p2]=value[prop][p2]}else{if(value[prop][p2]!=null){let con=value[prop][p2].constructor.name;if(con.includes("Set")){obj[prop][p2]=Array.from(value[prop][p2])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p2]="instanceof_"+con}else{obj[prop][p2]=value[prop][p2]}}else{obj[prop][p2]=value[prop][p2]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast2(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.filtering=false;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder3,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder3+")")},"receiveCodec":function receiveDeviceCodec(decoder3,deviceType,device,service,characteristic){let codec=parseFunctionFromText(decoder3);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v2=>filter.apply(v2))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v2=>filter.apply(v2))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v2=>filter.apply(v2))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v2=>filter.apply(v2))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters){globalThis.filters={};if(clearFilters)globalThis.filtering=false}if(filters){for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}globalThis.filtering=true}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(stream.settings.pipeMain){WorkerService2.transmit(value,void 0,[value.buffer])}if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){globalThis.Devices=Devices;const worker=new WorkerService({roots:{...ne,...remoteGraphRoutes,...streamWorkerRoutes}})}var stream_worker_default=self;;if(typeof import_meta !== \'undefined\')import_meta.url=location.origin+"/dist/";})();\n');var url=URL.createObjectURL(new globalThis.Blob([str],{type:"text/javascript"}));var stream_worker_default=url;var ArrayManip=class _ArrayManip{constructor(){this.recursivelyAssign=(target,obj)=>{for(const key in obj){if(typeof obj[key]==="object"){if(typeof target[key]==="object")this.recursivelyAssign(target[key],obj[key]);else target[key]=this.recursivelyAssign({},obj[key])}else target[key]=obj[key]}return target}}static autoscale(array,lineIdx=0,nLines=1,centerZero=false,ymin,ymax,clamp){if(array?.length===0)return array;let max=ymax?ymax:Math.max(...array);let min=ymin?ymin:Math.min(...array);let _lines=1/nLines;let scalar=1;if(centerZero){let absmax=Math.max(Math.abs(min),Math.abs(max));if(absmax!==0)scalar=_lines/absmax;return array.map(y3=>{if(clamp){if(y3<min)y3=min;if(y3>max)y3=max}return y3*scalar+(_lines*(lineIdx+1)*2-1-_lines)})}else{if(max===min){if(max!==0){scalar=_lines/max}else if(min!==0){scalar=_lines/Math.abs(min)}}else scalar=_lines/(max-min);return array.map(y3=>{if(clamp){if(y3<min)y3=min;if(y3>max)y3=max}return 2*((y3-min)*scalar-1/(2*nLines))+(_lines*(lineIdx+1)*2-1-_lines)})}}static genTimestamps(ct,sps11){let now=Date.now();let toInterp=[now-ct*1e3/sps11,now];return _ArrayManip.upsample(toInterp,ct)}static absmax(array){return Math.max(Math.abs(Math.min(...array)),Math.max(...array))}static downsample(array,fitCount,scalar=1){if(array.length>fitCount){let output=new Array(fitCount);let incr=array.length/fitCount;let lastIdx=array.length-1;let last=0;let counter=0;for(let i3=incr;i3<array.length;i3+=incr){let rounded=Math.round(i3);if(rounded>lastIdx)rounded=lastIdx;for(let j3=last;j3<rounded;j3++){output[counter]+=array[j3]}output[counter]/=(rounded-last)*scalar;counter++;last=rounded}return output}else return array}static upsample(array,fitCount,scalar=1){var linearInterpolate=function(before2,after2,atPoint2){return(before2+(after2-before2)*atPoint2)*scalar};var newData=new Array(fitCount);var springFactor=(array.length-1)/(fitCount-1);newData[0]=array[0];for(var i3=1;i3<fitCount-1;i3++){var tmp=i3*springFactor;var before=Math.floor(tmp);var after=Math.ceil(tmp);var atPoint=tmp-before;newData[i3]=linearInterpolate(array[before],array[after],atPoint)}newData[fitCount-1]=array[array.length-1];return newData}static interpolate(array,fitCount,scalar=1){if(array.length>fitCount){return _ArrayManip.downsample(array,fitCount,scalar)}else if(array.length<fitCount){return _ArrayManip.upsample(array,fitCount,scalar)}return array}static HSLToRGB(h2,s,l,scalar=255){s/=100;l/=100;let c2=(1-Math.abs(2*l-1))*s,x3=c2*(1-Math.abs(h2/60%2-1)),m2=l-c2/2,r=0,g2=0,b3=0;if(0<=h2&&h2<60){r=c2;g2=x3;b3=0}else if(60<=h2&&h2<120){r=x3;g2=c2;b3=0}else if(120<=h2&&h2<180){r=0;g2=c2;b3=x3}else if(180<=h2&&h2<240){r=0;g2=x3;b3=c2}else if(240<=h2&&h2<300){r=x3;g2=0;b3=c2}else if(300<=h2&&h2<360){r=c2;g2=0;b3=x3}r=(r+m2)*scalar;g2=(g2+m2)*scalar;b3=(b3+m2)*scalar;return[r,g2,b3]}static circularBuffer(arr,newEntries){if(newEntries.length<arr.length){let slice=arr.slice(newEntries.length);let len=arr.length;arr.splice(0,len,...slice,...newEntries)}else if(newEntries.length>arr.length){let len=arr.length;arr.splice(0,len,newEntries.slice(len-newEntries.length))}else{arr.splice(0,arr.length,...newEntries)}return arr}static reformatData(data,key){if(Array.isArray(data)){if(Array.isArray(data[0])){let d2={};data.forEach((arr,i3)=>{d2[i3]=arr});data=d2;if(isNaN(data[0][0]))return void 0}else if(key){data={[key]:data};if(isNaN(data[key][0]))return void 0}else{data={0:data};if(isNaN(data[0][0]))return void 0}}else if(typeof data==="object"){for(const key2 in data){if(typeof data[key2]==="number")data[key2]=[data[key2]];else if(data[key2]?.values){if(typeof data[key2].values==="number")data[key2].values=[data[key2].values]}if(isNaN(data[key2][0]))return void 0}}else if(typeof data==="string"){let split;if(data.includes("\r\n")){let lines=data.split("\r\n");data={};lines.forEach((l,j3)=>{if(l.includes("	")){split=l.split("	")}else if(l.includes(",")){split=l.split(",")}else if(l.includes("|")){split=l.split("|")}if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}})}else if(data.includes("	")){split=data.split("	")}else if(data.includes(",")){split=data.split(",")}else if(data.includes("|")){split=data.split("|")}data={};if(Array.isArray(split)){split.forEach((val,i3)=>{if(val.includes(":")){let[key2,v2]=val.split(":");let fl=parseFloat(v2);if(fl)data[key2]=[fl];else return void 0}else{let fl=parseFloat(val);if(fl)data[i3]=[fl];else return void 0}})}}else if(typeof data==="number"){if(key)data={[key]:[data]};else data={0:[data]}}return data}static padTime(data,lastValue,time,targetFit){let slopeIncr=(data[0]-lastValue)/time/targetFit;let padded=[...new Array(targetFit-data.length).map((_2,i3)=>lastValue+slopeIncr*(i3+1)),...data];return padded}static interpolateForTime(data,time,targetSPS){return _ArrayManip.interpolate(data,Math.ceil(targetSPS*time))}static{this.bufferValues=(objects,property,keys,buffer)=>{if(!Array.isArray(keys)&&typeof keys==="object")keys=Object.keys(keys);if(!buffer){let object_keys=Object.keys(objects);if(keys)buffer=new Float32Array(object_keys.length*keys.length);else{if(typeof objects[object_keys[0]][property]==="object"){keys=Object.keys(objects[object_keys[0]][property]);buffer=new Float32Array(object_keys.length*keys.length)}else buffer=new Float32Array(object_keys.length)}}let i3=0;for(const key in objects){if(objects[key][property]){if(keys){for(let j3=0;j3<keys.length;j3++){buffer[i3]=objects[key][property][keys[j3]];i3++}}else{buffer[i3]=objects[key][property];i3++}}}return buffer}}isTypedArray(x3){return ArrayBuffer.isView(x3)&&Object.prototype.toString.call(x3)!=="[object DataView]"}spliceTypedArray(arr,start,end){let s=arr.subarray(0,start);let e;if(end){e=arr.subarray(end+1)}let n;if(s.length>0||e?.length>0)n=new arr.constructor(s.length+e.length);if(s.length>0)n.set(s);if(e&&e.length>0)n.set(e,s.length);return n}};var rechk=/^([<>])?(([1-9]\d*)?([xcbB?hHiIfdsp]))*$/;var refmt=/([1-9]\d*)?([xcbB?hHiIfdsp])/g;var str2=(v2,o,c2)=>String.fromCharCode(...new Uint8Array(v2.buffer,v2.byteOffset+o,c2));var rts=(v2,o,c2,s)=>new Uint8Array(v2.buffer,v2.byteOffset+o,c2).set(s.split("").map(str3=>str3.charCodeAt(0)));var pst=(v2,o,c2)=>str2(v2,o+1,Math.min(v2.getUint8(o),c2-1));var tsp=(v2,o,c2,s)=>{v2.setUint8(o,s.length);rts(v2,o+1,c2-1,s)};var lut=le=>({x:c2=>[1,c2,0],c:c2=>[c2,1,o=>({u:v2=>str2(v2,o,1),p:(v2,c3)=>rts(v2,o,1,c3)})],"?":c2=>[c2,1,o=>({u:v2=>Boolean(v2.getUint8(o)),p:(v2,B3)=>v2.setUint8(o,B3)})],b:c2=>[c2,1,o=>({u:v2=>v2.getInt8(o),p:(v2,b3)=>v2.setInt8(o,b3)})],B:c2=>[c2,1,o=>({u:v2=>v2.getUint8(o),p:(v2,B3)=>v2.setUint8(o,B3)})],h:c2=>[c2,2,o=>({u:v2=>v2.getInt16(o,le),p:(v2,h2)=>v2.setInt16(o,h2,le)})],H:c2=>[c2,2,o=>({u:v2=>v2.getUint16(o,le),p:(v2,H3)=>v2.setUint16(o,H3,le)})],i:c2=>[c2,4,o=>({u:v2=>v2.getInt32(o,le),p:(v2,i3)=>v2.setInt32(o,i3,le)})],I:c2=>[c2,4,o=>({u:v2=>v2.getUint32(o,le),p:(v2,I3)=>v2.setUint32(o,I3,le)})],f:c2=>[c2,4,o=>({u:v2=>v2.getFloat32(o,le),p:(v2,f2)=>v2.setFloat32(o,f2,le)})],d:c2=>[c2,8,o=>({u:v2=>v2.getFloat64(o,le),p:(v2,d2)=>v2.setFloat64(o,d2,le)})],s:c2=>[1,c2,o=>({u:v2=>str2(v2,o,c2),p:(v2,s)=>rts(v2,o,c2,s.slice(0,c2))})],p:c2=>[1,c2,o=>({u:v2=>pst(v2,o,c2),p:(v2,s)=>tsp(v2,o,c2,s.slice(0,c2-1))})]});var errbuf=new RangeError("Structure larger than remaining buffer");var errval=new RangeError("Not enough values for structure");var ByteParser=class _ByteParser extends ArrayManip{static{this.codes={"\\n":10,"\\r":13,"\\t":9,"\\s":32,"\\b":8,"\\f":12,"\\":92}}static toDataView(value){if(!(value instanceof DataView)){if(typeof value==="string"&&parseInt(value))value=parseInt(value);if(typeof value==="string"){let enc=new TextEncoder;let hascodes={};for(const code in _ByteParser.codes){while(value.indexOf(code)>-1){let idx=value.indexOf(code);value=value.replace(code,"");hascodes[idx]=code}}let encoded=Array.from(enc.encode(value));for(const key in hascodes){encoded.splice(parseInt(key),0,_ByteParser.codes[hascodes[key]])}value=new DataView(new Uint8Array(encoded).buffer)}else if(typeof value==="number"){let tmp=value;if(value<256){value=new DataView(new ArrayBuffer(1));value.setUint8(0,tmp)}else if(value<65536){value=new DataView(new ArrayBuffer(2));value.setInt16(0,tmp)}else{value=new DataView(new ArrayBuffer(4));value.setUint32(0,tmp)}}else if(value instanceof ArrayBuffer||typeof SharedArrayBuffer!=="undefined"&&value instanceof SharedArrayBuffer){value=new DataView(value)}else if(Array.isArray(value)){value=new DataView(Uint8Array.from(value).buffer)}else if(typeof value==="object"){value=new TextEncoder().encode(JSON.stringify(value))}}return value}static searchBuffer(buffer,searchString,limit){var needle=searchString;var haystack=buffer;var search=_ByteParser.boyerMoore(needle);var skip=search.byteLength;var indices=[];for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){indices.push(i3);if(limit){if(indices.length>=limit)break}}return indices}static bytesToInt16(x0,x1){let int16=(255&x0)<<8|255&x1;if((int16&32768)>0){int16|=4294901760}else{int16&=65535}return int16}static bytesToUInt16(x0,x1){return x0*256+x1}static Uint16ToBytes(y3){return[y3&255,y3>>8&255]}static bytesToInt24(x0,x1,x22){let int24=(255&x0)<<16|(255&x1)<<8|255&x22;if((int24&8388608)>0){int24|=4278190080}else{int24&=16777215}return int24}static bytesToUInt24(x0,x1,x22){return x0*65536+x1*256+x22}static Uint24ToBytes(y3){return[y3&255,y3>>8&255,y3>>16&255]}static bytesToInt32(x0,x1,x22,x3){let int32=(255&x0)<<24|(255&x1)<<16|(255&x22)<<8|255&x3;if((int32&2147483648)>0){int32|=0}else{int32&=4294967295}return int32}static bytesToUInt32(x0,x1,x22,x3){return x0*16777216+x1*65536+x22*256+x3}static Uint32ToBytes(y3){return[y3&255,y3>>8&255,y3>>16&255,y3>>24&255]}static get2sCompliment(val,nbits4){if(val>4294967296)return null;return val<<32-nbits4>>32-nbits4}static getSignedInt(...args){let pos=0;function getInt(size){var value=0;var first=true;while(size--){if(first){let byte=args[pos++];value+=byte&127;if(byte&128){value-=128}first=false}else{value*=256;value+=args[pos++]}}return value}return getInt(args.length)}static asUint8Array(input){if(input instanceof Uint8Array){return input}else if(typeof input==="string"){var arr=new Uint8Array(input.length);for(var i3=0;i3<input.length;i3++){var c2=input.charCodeAt(i3);if(c2>127){throw new TypeError("Only ASCII patterns are supported")}arr[i3]=c2}return arr}else{return new Uint8Array(input)}}static boyerMoore(patternBuffer){const pattern=new Uint8Array(patternBuffer);const M3=pattern.length;if(M3===0){throw new TypeError("patternBuffer must be at least 1 byte long")}const R3=256;const rightmost_positions=new Int32Array(R3).fill(-1);for(let j3=0;j3<M3;j3++){rightmost_positions[pattern[j3]]=j3}const boyerMooreSearch=(txtBuffer,start=0,end=txtBuffer.byteLength)=>{const txt=txtBuffer instanceof Uint8Array?txtBuffer:new Uint8Array(txtBuffer);const lastIndex=end-M3;const lastPatIndex=M3-1;for(let i3=start;i3<=lastIndex;){let skip=0;for(let j3=lastPatIndex;j3>=0;j3--){if(pattern[j3]!==txt[i3+j3]){skip=Math.max(1,j3-rightmost_positions[txt[i3+j3]]);break}}if(skip===0){return i3}i3+=skip}return-1};boyerMooreSearch.byteLength=M3;return boyerMooreSearch}static struct(format){let fns=[],size=0,m2=rechk.exec(format);if(!m2){throw new RangeError("Invalid format string")}const t=lut("<"===m2[1]),lu=(n,c2)=>t[c2](n?parseInt(n,10):1);while(m2=refmt.exec(format)){((r,s,f2)=>{for(let i3=0;i3<r;++i3,size+=s){if(f2){fns.push(f2(size))}}})(...lu(...m2.slice(1)))}const unpack_from=(arrb,offs)=>{if(arrb.byteLength<(offs|0)+size){throw errbuf}let v2=new DataView(arrb,offs|0);return fns.map(f2=>f2.u(v2))};const pack_into=(arrb,offs,...values)=>{if(values.length<fns.length){throw errval}if(arrb.byteLength<offs+size){throw errbuf}const v2=new DataView(arrb,offs);new Uint8Array(arrb,offs,size).fill(0);fns.forEach((f2,i3)=>f2.p(v2,values[i3]))};const pack=(...values)=>{let b3=new ArrayBuffer(size);pack_into(b3,0,...values);return b3};const unpack=arrb=>unpack_from(arrb,0);function*iter_unpack(arrb){for(let offs=0;offs+size<=arrb.byteLength;offs+=size){yield unpack_from(arrb,offs)}}return Object.freeze({unpack,pack,unpack_from,pack_into,iter_unpack,format,size})}};var ScanMode;(function(ScanMode2){ScanMode2[ScanMode2["SCAN_MODE_LOW_POWER"]=0]="SCAN_MODE_LOW_POWER";ScanMode2[ScanMode2["SCAN_MODE_BALANCED"]=1]="SCAN_MODE_BALANCED";ScanMode2[ScanMode2["SCAN_MODE_LOW_LATENCY"]=2]="SCAN_MODE_LOW_LATENCY"})(ScanMode||(ScanMode={}));var ConnectionPriority;(function(ConnectionPriority2){ConnectionPriority2[ConnectionPriority2["CONNECTION_PRIORITY_BALANCED"]=0]="CONNECTION_PRIORITY_BALANCED";ConnectionPriority2[ConnectionPriority2["CONNECTION_PRIORITY_HIGH"]=1]="CONNECTION_PRIORITY_HIGH";ConnectionPriority2[ConnectionPriority2["CONNECTION_PRIORITY_LOW_POWER"]=2]="CONNECTION_PRIORITY_LOW_POWER"})(ConnectionPriority||(ConnectionPriority={}));init_dist();init_conversion();init_dist();var BluetoothLe=registerPlugin("BluetoothLe",{web:()=>Promise.resolve().then(()=>(init_web(),web_exports)).then(m2=>new m2.BluetoothLeWeb)});var makeQueue=()=>{let currentTask=Promise.resolve();return fn=>new Promise((resolve,reject)=>{currentTask=currentTask.then(()=>fn()).then(resolve).catch(reject)})};function getQueue(enabled){if(enabled){return makeQueue()}return fn=>fn()}function parseUUID(uuid){if(typeof uuid!=="string"){throw new Error(`Invalid UUID type ${typeof uuid}. Expected string.`)}uuid=uuid.toLowerCase();const is128BitUuid=uuid.search(/^[0-9a-f]{8}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{4}\b-[0-9a-f]{12}$/)>=0;if(!is128BitUuid){throw new Error(`Invalid UUID format ${uuid}. Expected 128 bit string (e.g. "0000180d-0000-1000-8000-00805f9b34fb").`)}return uuid}var BleClientClass=class{constructor(){this.scanListener=null;this.eventListeners=new Map;this.queue=getQueue(true)}enableQueue(){this.queue=getQueue(true)}disableQueue(){this.queue=getQueue(false)}async initialize(options){await this.queue(async()=>{await BluetoothLe.initialize(options)})}async isEnabled(){const enabled=await this.queue(async()=>{const result=await BluetoothLe.isEnabled();return result.value});return enabled}async requestEnable(){await this.queue(async()=>{await BluetoothLe.requestEnable()})}async enable(){await this.queue(async()=>{await BluetoothLe.enable()})}async disable(){await this.queue(async()=>{await BluetoothLe.disable()})}async startEnabledNotifications(callback){await this.queue(async()=>{var _a;const key=`onEnabledChanged`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());const listener=await BluetoothLe.addListener(key,result=>{callback(result.value)});this.eventListeners.set(key,listener);await BluetoothLe.startEnabledNotifications()})}async stopEnabledNotifications(){await this.queue(async()=>{var _a;const key=`onEnabledChanged`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());this.eventListeners.delete(key);await BluetoothLe.stopEnabledNotifications()})}async isLocationEnabled(){const enabled=await this.queue(async()=>{const result=await BluetoothLe.isLocationEnabled();return result.value});return enabled}async openLocationSettings(){await this.queue(async()=>{await BluetoothLe.openLocationSettings()})}async openBluetoothSettings(){await this.queue(async()=>{await BluetoothLe.openBluetoothSettings()})}async openAppSettings(){await this.queue(async()=>{await BluetoothLe.openAppSettings()})}async setDisplayStrings(displayStrings){await this.queue(async()=>{await BluetoothLe.setDisplayStrings(displayStrings)})}async requestDevice(options){options=options?this.validateRequestBleDeviceOptions(options):void 0;const result=await this.queue(async()=>{const device=await BluetoothLe.requestDevice(options);return device});return result}async requestLEScan(options,callback){options=this.validateRequestBleDeviceOptions(options);await this.queue(async()=>{var _a;await((_a=this.scanListener)===null||_a===void 0?void 0:_a.remove());this.scanListener=await BluetoothLe.addListener("onScanResult",resultInternal=>{const result=Object.assign(Object.assign({},resultInternal),{manufacturerData:this.convertObject(resultInternal.manufacturerData),serviceData:this.convertObject(resultInternal.serviceData),rawAdvertisement:resultInternal.rawAdvertisement?this.convertValue(resultInternal.rawAdvertisement):void 0});callback(result)});await BluetoothLe.requestLEScan(options)})}async stopLEScan(){await this.queue(async()=>{var _a;await((_a=this.scanListener)===null||_a===void 0?void 0:_a.remove());this.scanListener=null;await BluetoothLe.stopLEScan()})}async getDevices(deviceIds){if(!Array.isArray(deviceIds)){throw new Error("deviceIds must be an array")}return this.queue(async()=>{const result=await BluetoothLe.getDevices({deviceIds});return result.devices})}async getConnectedDevices(services){if(!Array.isArray(services)){throw new Error("services must be an array")}services=services.map(parseUUID);return this.queue(async()=>{const result=await BluetoothLe.getConnectedDevices({services});return result.devices})}async connect(deviceId,onDisconnect,options){await this.queue(async()=>{var _a;if(onDisconnect){const key=`disconnected|${deviceId}`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());const listener=await BluetoothLe.addListener(key,()=>{onDisconnect(deviceId)});this.eventListeners.set(key,listener)}await BluetoothLe.connect(Object.assign({deviceId},options))})}async createBond(deviceId,options){await this.queue(async()=>{await BluetoothLe.createBond(Object.assign({deviceId},options))})}async isBonded(deviceId){const isBonded=await this.queue(async()=>{const result=await BluetoothLe.isBonded({deviceId});return result.value});return isBonded}async disconnect(deviceId){await this.queue(async()=>{await BluetoothLe.disconnect({deviceId})})}async getServices(deviceId){const services=await this.queue(async()=>{const result=await BluetoothLe.getServices({deviceId});return result.services});return services}async discoverServices(deviceId){await this.queue(async()=>{await BluetoothLe.discoverServices({deviceId})})}async getMtu(deviceId){const value=await this.queue(async()=>{const result=await BluetoothLe.getMtu({deviceId});return result.value});return value}async requestConnectionPriority(deviceId,connectionPriority){await this.queue(async()=>{await BluetoothLe.requestConnectionPriority({deviceId,connectionPriority})})}async readRssi(deviceId){const value=await this.queue(async()=>{const result=await BluetoothLe.readRssi({deviceId});return parseFloat(result.value)});return value}async read(deviceId,service,characteristic,options){service=parseUUID(service);characteristic=parseUUID(characteristic);const value=await this.queue(async()=>{const result=await BluetoothLe.read(Object.assign({deviceId,service,characteristic},options));return this.convertValue(result.value)});return value}async write(deviceId,service,characteristic,value,options){service=parseUUID(service);characteristic=parseUUID(characteristic);return this.queue(async()=>{if(!(value===null||value===void 0?void 0:value.buffer)){throw new Error("Invalid data.")}let writeValue=value;if(Capacitor.getPlatform()!=="web"){writeValue=dataViewToHexString(value)}await BluetoothLe.write(Object.assign({deviceId,service,characteristic,value:writeValue},options))})}async writeWithoutResponse(deviceId,service,characteristic,value,options){service=parseUUID(service);characteristic=parseUUID(characteristic);await this.queue(async()=>{if(!(value===null||value===void 0?void 0:value.buffer)){throw new Error("Invalid data.")}let writeValue=value;if(Capacitor.getPlatform()!=="web"){writeValue=dataViewToHexString(value)}await BluetoothLe.writeWithoutResponse(Object.assign({deviceId,service,characteristic,value:writeValue},options))})}async readDescriptor(deviceId,service,characteristic,descriptor,options){service=parseUUID(service);characteristic=parseUUID(characteristic);descriptor=parseUUID(descriptor);const value=await this.queue(async()=>{const result=await BluetoothLe.readDescriptor(Object.assign({deviceId,service,characteristic,descriptor},options));return this.convertValue(result.value)});return value}async writeDescriptor(deviceId,service,characteristic,descriptor,value,options){service=parseUUID(service);characteristic=parseUUID(characteristic);descriptor=parseUUID(descriptor);return this.queue(async()=>{if(!(value===null||value===void 0?void 0:value.buffer)){throw new Error("Invalid data.")}let writeValue=value;if(Capacitor.getPlatform()!=="web"){writeValue=dataViewToHexString(value)}await BluetoothLe.writeDescriptor(Object.assign({deviceId,service,characteristic,descriptor,value:writeValue},options))})}async startNotifications(deviceId,service,characteristic,callback){service=parseUUID(service);characteristic=parseUUID(characteristic);await this.queue(async()=>{var _a;const key=`notification|${deviceId}|${service}|${characteristic}`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());const listener=await BluetoothLe.addListener(key,event=>{callback(this.convertValue(event===null||event===void 0?void 0:event.value))});this.eventListeners.set(key,listener);await BluetoothLe.startNotifications({deviceId,service,characteristic})})}async stopNotifications(deviceId,service,characteristic){service=parseUUID(service);characteristic=parseUUID(characteristic);await this.queue(async()=>{var _a;const key=`notification|${deviceId}|${service}|${characteristic}`;await((_a=this.eventListeners.get(key))===null||_a===void 0?void 0:_a.remove());this.eventListeners.delete(key);await BluetoothLe.stopNotifications({deviceId,service,characteristic})})}validateRequestBleDeviceOptions(options){if(options.services){options.services=options.services.map(parseUUID)}if(options.optionalServices){options.optionalServices=options.optionalServices.map(parseUUID)}return options}convertValue(value){if(typeof value==="string"){return hexStringToDataView(value)}else if(value===void 0){return new DataView(new ArrayBuffer(0))}return value}convertObject(obj){if(obj===void 0){return void 0}const result={};for(const key of Object.keys(obj)){result[key]=this.convertValue(obj[key])}return result}};var BleClient=new BleClientClass;init_conversion();var BLEClient=class _BLEClient extends ByteParser{constructor(options,location){super();this.client=BleClient;this.devices={};this.location=false;this.initialized=false;this.setupDevice=(device,options)=>{return new Promise(async(res,rej)=>{this.devices[device.deviceId]={device,deviceId:device.deviceId,...options};await this.client.connect(device.deviceId,deviceId=>{if(this.devices[device.deviceId]?.ondisconnect)this.devices[device.deviceId].ondisconnect(deviceId)},options?.connectOptions).then(async()=>{let services=await this.getServices(device.deviceId);for(let service in options?.services){if(options?.services[service].UUID)service=options?.services[service].UUID;let svc=services.find(o=>{if(o.uuid===service)return true});if(svc)for(let characteristic in options.services[service]){if(options.services[service][characteristic].characteristic)characteristic=options.services[service][characteristic].characteristic;if(!svc.characteristics.find(o=>{if(o.uuid===characteristic)return true}))continue;let opt=options.services[service][characteristic];if(opt.write){await this.write(device,service,characteristic,opt.write,opt.writeCallback,opt.chunkSize,opt.chunkDelay,opt.writeOptions)}if(opt.read){await this.read(device,service,characteristic,opt.readCallback,opt.readOptions)}if(opt.notify&&opt.notifyCallback){await this.subscribe(device,service,characteristic,opt.notifyCallback);opt.notifying=true}}}}).catch(rej);res(this.devices[device.deviceId])})};this.triangulate=(device,duration=1500,sampleRate=60)=>{return new Promise((res,rej)=>{if("Accelerometer"in globalThis){if(typeof globalThis.Accelerometer==="function"){let acl=new globalThis.Accelerometer({frequency:sampleRate});let start=performance.now();let now=start;let result={samples:[],vector:{}};let onread=()=>{if(now-start<duration){this.readRssi(device).then(rssi=>{let x3=acl.x;let y3=acl.y;let z3=acl.z;now=performance.now();result.samples.push({x:x3,y:y3,z:z3,rssi,timestamp:now})})}else{let vector={x:0,y:0,z:0,rssiAvg:0};result.samples.forEach(s=>{});acl.removeEventListener("reading",onread)}};acl.addEventListener("reading",onread)}}else rej(new Error("No Accelerometer API detected"))})};if(location)this.location=location;if(options){this.setup(options)}}setup(options,location=this.location){let services=[];if(options){for(let serviceuuid in options.services){if(options.services[serviceuuid].UUID)serviceuuid=options.services[serviceuuid].UUID;services.push(serviceuuid)}}let opts={};if(!location)opts.androidNeverForLocation=false;return new Promise(async(res,rej)=>{if(!this.initialized){await this.client.initialize(opts);this.initialized=true}if(options?.deviceId){res(await this.reconnect(options.deviceId))}else{if(options){let services2=Array.from(Object.keys(options.services));let deviceRequest={};if(!this.isMobile()){deviceRequest.optionalServices=services2}if(options.name)deviceRequest.name=options.name;if(options.namePrefix)deviceRequest.namePrefix=options.namePrefix;this.client.requestDevice(deviceRequest).then(device=>{res(this.setupDevice(device,options))}).catch(rej)}else{this.client.requestDevice().then(device=>{res(this.setupDevice(device,options))}).catch(rej)}}})}initialize(options){return new Promise((res,rej)=>{this.client.initialize(options).then(()=>{res(true)}).catch(rej)})}requestDevice(request,options){return new Promise((res,rej)=>{this.client.requestDevice(request).then(device=>{this.devices[device.deviceId]={device,deviceId:device.deviceId,...options};res(device)}).catch(rej)})}getServices(deviceId){return this.client.getServices(deviceId)}connect(device,options){return new Promise((res,rej)=>{this.client.connect(device.deviceId,deviceId=>{if(options?.ondisconnect)options.ondisconnect(deviceId)},options?.connectOptions).then(connected=>{res(device)}).catch(rej)})}reconnect(deviceId,options){return new Promise((res,rej)=>{let opts=options;if(this.devices[deviceId])opts=Object.assign(Object.assign({},this.devices[deviceId]),opts);if(opts?.deviceId)delete opts.deviceId;this.client.getDevices([deviceId]).then(devices=>{this.setupDevice(devices[0],opts).then(device=>{res(device)})}).catch(rej)})}disconnect(device){if(typeof device==="object"){if(device?.deviceId){device=device.deviceId};}if(typeof device==="string"){let info=this.devices[device];if(info.beforedisconnect)info.beforedisconnect(this,info);delete this.devices[device];return this.client.disconnect(device)}}write(device,service,characteristic,value,callback,chunkSize,chunkDelay=10,options){if(typeof device==="object")device=device.deviceId;if(chunkSize){const wait=(delay=10)=>{return new Promise(res=>{setTimeout(()=>{res(true)},delay)})};return new Promise(async(res,rej)=>{const view=_BLEClient.toDataView(value);let len=view.buffer.byteLength;for(let i3=0;i3<len;i3+=chunkSize){let endIdx=i3+chunkSize;if(endIdx>len)endIdx=len;const slice=new DataView(view.buffer.slice(i3,endIdx));if(callback){await this.client.write(device,service,characteristic,slice).then(()=>{callback(endIdx/len)})}else await this.client.writeWithoutResponse(device,service,characteristic,slice,options);if(chunkDelay){await wait(chunkDelay)}}res(void 0)})}if(callback){return this.client.write(device,service,characteristic,_BLEClient.toDataView(value)).then(()=>{callback(1)})}else return this.client.writeWithoutResponse(device,service,characteristic,_BLEClient.toDataView(value),options)}read(device,service,characteristic,ondata,options){if(typeof device==="object")device=device.deviceId;if(ondata)return this.client.read(device,service,characteristic,options).then(ondata);else return this.client.read(device,service,characteristic,options)}subscribe(device,service,characteristic,ondata){if(typeof device==="object")device=device.deviceId;return this.client.startNotifications(device,service,characteristic,ondata)}unsubscribe(device,service,characteristic){if(typeof device==="object")device=device.deviceId;return this.client.stopNotifications(device,service,characteristic)}scan(options,callback){return this.client.requestLEScan(options,callback)}stopScanning(){return this.client.stopLEScan()}readDescriptor(device,service,characteristic,descriptor,options){return this.client.readDescriptor(device.deviceId,service,characteristic,descriptor,options)}writeDescriptor(device,service,characteristic,descriptor,value,options){return this.client.writeDescriptor(device.deviceId,service,characteristic,descriptor,_BLEClient.toDataView(value),options)}readRssi(device){return this.client.readRssi(device.deviceId)}isMobile(){let check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check}isAndroid(){const device=navigator.userAgent.toLowerCase();return device.indexOf("android")>-1}async distance(device,txPower,x3,exp,c2){let rssi=await this.readRssi(device);if(rssi==0)return void 0;let ratio=rssi/txPower;if(ratio<1){return Math.pow(ratio,10)}else{return x3*Math.pow(ratio,exp)+c2}}async distanceFromPhone(device,txPower,model){let x3,exp,c2;if(model){if(model==="nexus5"){x3=.42093;exp=6.9476;c2=.54992}else if(model==="motoX"){x3=.9401940951;exp=6.170094565;c2=0}else if(model==="iphone5"){x3=.89976;exp=7.7095;c2=.111}}return await this.distance(device,txPower,x3,exp,c2)}};(function(s){var w3,f2={},l=console,m2=Math,z3="postMessage",x3="HackTimer.js by turuslan: ",v2="Initialisation failed",p2=0,r="hasOwnProperty",y3=[].slice,b3=Worker;function d2(){do{p2=2147483647>p2?p2+1:0}while(f2[r](p2));return p2}if(!/MSIE 10/i.test(navigator.userAgent)){try{s=URL.createObjectURL(new Blob(["var f={},p=postMessage,r='hasOwnProperty';onmessage=function(e){var d=e.data,i=d.i,t=d[r]('t')?d.t:0;switch(d.n){case'a':f[i]=setInterval(function(){p(i)},t);break;case'b':if(f[r](i)){clearInterval(f[i]);delete f[i]}break;case'c':f[i]=setTimeout(function(){p(i);if(f[r](i))delete f[i]},t);break;case'd':if(f[r](i)){clearTimeout(f[i]);delete f[i]}break}}"]))}catch(e){}}if(typeof b3!=="undefined"){try{w3=new b3(s);setInterval=function(c2,t){var i3=d2();f2[i3]={c:c2,p:y3.call(arguments,2)};w3[z3]({n:"a",i:i3,t});return i3};clearInterval=function(i3){if(f2[r](i3))delete f2[i3],w3[z3]({n:"b",i:i3})};setTimeout=function(c2,t){var i3=d2();f2[i3]={c:c2,p:y3.call(arguments,2),t:true};w3[z3]({n:"c",i:i3,t});return i3};clearTimeout=function(i3){if(f2[r](i3))delete f2[i3],w3[z3]({n:"d",i:i3})};w3.onmessage=function(e){var i3=e.data,c2,n;if(f2[r](i3)){n=f2[i3];c2=n.c;if(n[r]("t"))delete f2[i3]}if(typeof c2=="string")try{c2=new Function(c2)}catch(k3){l.log(x3+"Error parsing callback code string: ",k3)}if(typeof c2=="function")c2.apply(globalThis,n.p)};w3.onerror=function(e){l.log(e)}}catch(e){l.log(x3+v2);l.error(e)}}else l.log(x3+v2+" - HTML5 Web Worker is not supported")})("HackTimerWorker.min.js");var WebSerial=class _WebSerial extends ByteParser{constructor(){super(...arguments);this.streams={};this.createStream=options=>{let stream={_id:options._id?options._id:`stream${Math.floor(Math.random()*1e15)}`,info:options.port.getInfo(),running:false,...options};if(options.port?.readable){if(options.transforms){stream.reader=_WebSerial.setStreamTransforms(options.port.readable,options.transforms).getReader()}else{stream.reader=options.port.readable.getReader()}}this.streams[stream._id]=stream;return stream}}getPorts(){return navigator.serial.getPorts()}requestPort(usbVendorId,usbProductId){let options={};if(usbVendorId){options.usbVendorId=usbVendorId}if(usbProductId){options.usbProductId=usbProductId}if(options.usbVendorId)return navigator.serial.requestPort({filters:[options]});else return navigator.serial.requestPort()}openPort(port,options){if(options)options=Object.assign({},options);if(options?.ondisconnect){port.ondisconnect=options.ondisconnect;delete options.ondisconnect}return port.open(options).then(()=>{if(options?.onconnect)options.onconnect(port)})}async readWithTimeout(port,timeout){const reader=port.readable.getReader();const timer=setTimeout(()=>{reader.releaseLock()},timeout);const result=await reader.read();clearTimeout(timer);reader.releaseLock();return result}async writePort(port,message,chunkSize){const writer=port.writable.getWriter();if(chunkSize){const view=_WebSerial.toDataView(message);const len=view.buffer.byteLength;for(let i3=0;i3<len;i3+=chunkSize){let endIdx=i3+chunkSize;if(endIdx>len)endIdx=len;const slice=new DataView(view.buffer.slice(i3,endIdx));await writer.write(slice)}}else{await writer.write(_WebSerial.toDataView(message))}writer.releaseLock();return true}getSignals(port){return port.getSignals()}setSignals(port,signals){return port.setSignals(signals)}readStream(stream){if(stream.reader&&!stream.running){let reader=stream.reader;if(stream.buffering){if(typeof stream.buffering!=="object")stream.buffering={};if(!stream.buffering.buffer){stream.buffering.buffer=[]}if(!stream.buffering.searchBytes)stream.buffering.searchBytes=new Uint8Array([13,10])}let readLoop=()=>{if(stream.port.readable&&stream.running){reader.read().then(result=>{if(result.done)reader.releaseLock();else{if(stream.buffering){stream.buffering.buffer.push(...result.value);const needle=stream.buffering.searchBytes;const haystack=stream.buffering.buffer;const search=_WebSerial.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=stream.buffering.lockIdx??0;for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){if(!stream.buffering.locked&&!("lockIdx"in stream.buffering))used=stream.buffering.lockIdx=i3;else{nextIndex=i3;if(nextIndex>=0){const len=nextIndex-used;if(!stream.buffering.locked){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(data);stream.buffering.locked=true}else if(len>0){const line=stream.buffering.buffer.splice(stream.buffering.lockIdx,len);const data=new Uint8Array(line.slice(stream.buffering.searchBytes.length));stream.ondata(new Uint8Array(data))}used=nextIndex}}}}else stream.ondata(result.value);setTimeout(()=>{readLoop()},stream.frequency)}}).catch(er=>{console.error(stream._id," Read error:",er);if(er.message.includes("overrun")||er.message.includes("framing")){delete stream.reader;this.reconnect(stream)}})}else if(!stream.running&&stream.port.readable){try{reader.releaseLock()}catch(er){console.error(er)}}};stream.running=true;readLoop();return stream}return void 0}async writeStream(stream,message,chunkSize){if(typeof stream==="string")stream=this.streams[stream];if(stream.port.writable){let writer=stream.port.writable.getWriter();if(chunkSize){const view=_WebSerial.toDataView(message);const len=view.buffer.byteLength;for(let i3=0;i3<len;i3+=chunkSize){let endIdx=i3+chunkSize;if(endIdx>len)endIdx=len;const slice=new DataView(view.buffer.slice(i3,endIdx));await writer.write(slice)}}else{await writer.write(_WebSerial.toDataView(message))}writer.releaseLock();return true}return void 0}closeStream(stream,onclose){if(typeof stream==="string")stream=this.streams[stream];stream.running=false;return new Promise((res,rej)=>{if(stream.settings.beforedisconnect){stream.settings.beforedisconnect(this,stream.port)}setTimeout(async()=>{if(stream.port.readable&&stream.reader){try{stream.reader.releaseLock()}catch(er){console.error(er)}if(stream.transforms)try{await stream.reader.cancel()}catch(err){console.error(err)}}try{await stream.port.close().then(()=>{if(onclose)onclose(this.streams[stream._id])});delete this.streams[stream._id];res(true)}catch(er){rej(er)}},300)})}reconnect(stream,options){if(typeof stream==="string")stream=this.streams[stream];return new Promise((res,rej)=>{if(typeof stream!=="object"){rej(void 0);return}let info=stream.port.getInfo();this.closeStream(stream._id).then(closed=>{setTimeout(()=>{this.getPorts().then(ports=>{for(let i3=0;i3<ports.length;i3++){if(ports[i3].getInfo().usbVendorId===info.usbVendorId&&ports[i3].getInfo().usbProductId===info.usbProductId){if(!options)options=stream;else options._id=stream._id;delete options.port;this.openPort(ports[i3],options.settings).then(()=>{const stream2=this.createStream({...options,port:ports[i3]});this.readStream(stream2);res(stream2)}).catch(rej)}}}).catch(rej)},100)})})}static setStreamTransforms(stream,transforms){let transform=[];Object.keys(transforms).forEach(t=>{let opt=transforms[t];if(opt instanceof TransformStream){transform.push(opt)}else{if(!opt.start)opt.start=function start(){};if(!opt.flush)opt.flush=function flush(){};let transformer=new TransformStream({start:opt.start,transform:opt.transform,flush:opt.flush},opt.writableStrategy,opt.readableStrategy);transform.push(transformer)}});let str3=stream;transform.forEach(transform2=>{str3=str3.pipeThrough(transform2)});return str3}};var sps=250;var gain=32;var nbits=24;var vref=1.2;var half24bit=Math.pow(2,24)/2;function ads131m08codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i3=0;i3<9;i3++){let j3=i3*25;output[0][i3]=ByteParser.bytesToInt24(arr[j3],arr[j3+1],arr[j3+2]);output[1][i3]=ByteParser.bytesToInt24(arr[j3+3],arr[j3+4],arr[j3+5]);output[2][i3]=ByteParser.bytesToInt24(arr[j3+6],arr[j3+7],arr[j3+8]);output[3][i3]=ByteParser.bytesToInt24(arr[j3+9],arr[j3+10],arr[j3+11]);output[4][i3]=ByteParser.bytesToInt24(arr[j3+12],arr[j3+13],arr[j3+14]);output[5][i3]=ByteParser.bytesToInt24(arr[j3+15],arr[j3+16],arr[j3+17]);output[6][i3]=ByteParser.bytesToInt24(arr[j3+18],arr[j3+19],arr[j3+20]);output[7][i3]=ByteParser.bytesToInt24(arr[j3+21],arr[j3+22],arr[j3+23])}if(arr.length>225){output.leds=arr.slice(225)}return output}function ads131m08codec_singleended(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array(9),1:new Array(9),2:new Array(9),3:new Array(9),4:new Array(9),5:new Array(9),6:new Array(9),7:new Array(9),timestamp:Date.now()};for(let i3=0;i3<9;i3++){let j3=i3*25;output[0][i3]=ByteParser.bytesToInt24(arr[j3],arr[j3+1],arr[j3+2])+half24bit;output[1][i3]=ByteParser.bytesToInt24(arr[j3+3],arr[j3+4],arr[j3+5])+half24bit;output[2][i3]=ByteParser.bytesToInt24(arr[j3+6],arr[j3+7],arr[j3+8])+half24bit;output[3][i3]=ByteParser.bytesToInt24(arr[j3+9],arr[j3+10],arr[j3+11])+half24bit;output[4][i3]=ByteParser.bytesToInt24(arr[j3+12],arr[j3+13],arr[j3+14])+half24bit;output[5][i3]=ByteParser.bytesToInt24(arr[j3+15],arr[j3+16],arr[j3+17])+half24bit;output[6][i3]=ByteParser.bytesToInt24(arr[j3+18],arr[j3+19],arr[j3+20])+half24bit;output[7][i3]=ByteParser.bytesToInt24(arr[j3+21],arr[j3+22],arr[j3+23])+half24bit}if(arr.length>225){output.leds=arr.slice(225)}return output}var decoder=new TextDecoder;function ads131m08_arduinocodec(data){const parsed=decoder.decode(data);let split;if(parsed.includes("|"))split=parsed.split("|");else if(split.includes(","))split=parsed.split(",");else split=parsed.split("	");return{"0":parseInt(split[0]),"1":parseInt(split[1]),"2":parseInt(split[2]),"3":parseInt(split[3]),"4":parseInt(split[4]),"5":parseInt(split[5]),"6":parseInt(split[6]),"7":parseInt(split[7]),timestamp:Date.now()}}var defaultChartSetting={nSec:10,sps,units:"mV"};var ads131m08ChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting)),"1":JSON.parse(JSON.stringify(defaultChartSetting)),"2":JSON.parse(JSON.stringify(defaultChartSetting)),"3":JSON.parse(JSON.stringify(defaultChartSetting)),"4":JSON.parse(JSON.stringify(defaultChartSetting)),"5":JSON.parse(JSON.stringify(defaultChartSetting)),"6":JSON.parse(JSON.stringify(defaultChartSetting)),"7":JSON.parse(JSON.stringify(defaultChartSetting))}};var defaultsetting={sps,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))};var halfOffset=.96*1e3*vref/(gain*(Math.pow(2,nbits)-1))*(Math.pow(2,nbits)-1)*.5;var ads131m08FilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting)),"1":JSON.parse(JSON.stringify(defaultsetting)),"2":JSON.parse(JSON.stringify(defaultsetting)),"3":JSON.parse(JSON.stringify(defaultsetting)),"4":JSON.parse(JSON.stringify(defaultsetting)),"5":JSON.parse(JSON.stringify(defaultsetting)),"6":JSON.parse(JSON.stringify(defaultsetting)),"7":JSON.parse(JSON.stringify(defaultsetting))};var accScale=.002/Math.pow(2,4);var getAcc=(arr,output,channels=8)=>{const accIdx=channels*3+1;const sum=(a,b3)=>a+b3;const accSum=arr.slice(accIdx).reduce(sum,0);if(accSum!==0){output.ax=accScale*ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output.ay=accScale*ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output.az=accScale*ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5])}};function cytoncodec(data){let arr;if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<8;i3++){let idx=1+3*i3;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);output.timestamp=Date.now();return output}function daisycytoncodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<8;i3++){let idx=1+3*i3;if(arr[0]%2===0)output[i3+7]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2]);else output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}getAcc(arr,output);return output}var sps2=250;var cytonSerialSettings={deviceType:"USB",deviceName:"cyton",baudRate:115200,codec:cytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var daisycytonSerialSettings={deviceType:"USB",deviceName:"cyton_daisy",baudRate:115200,codec:daisycytoncodec,write:"b",beforedisconnect:(client,port)=>{client.writePort(port,"s")},buffering:{searchBytes:new Uint8Array([192,160])},sps:sps2};var defaultChartSetting2={nSec:10,sps:sps2,units:"mV"};var defaultChartSetting22={nSec:10,sps:sps2};var cytonChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting2)),"1":JSON.parse(JSON.stringify(defaultChartSetting2)),"2":JSON.parse(JSON.stringify(defaultChartSetting2)),"3":JSON.parse(JSON.stringify(defaultChartSetting2)),"4":JSON.parse(JSON.stringify(defaultChartSetting2)),"5":JSON.parse(JSON.stringify(defaultChartSetting2)),"6":JSON.parse(JSON.stringify(defaultChartSetting2)),"7":JSON.parse(JSON.stringify(defaultChartSetting2)),"ax":JSON.parse(JSON.stringify(defaultChartSetting22)),"ay":JSON.parse(JSON.stringify(defaultChartSetting22)),"az":JSON.parse(JSON.stringify(defaultChartSetting22))},generateNewLines:true};var defaultsetting2={sps:sps2,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*4.5/(24*(Math.pow(2,23)-1))};var cytonFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting2)),"1":JSON.parse(JSON.stringify(defaultsetting2)),"2":JSON.parse(JSON.stringify(defaultsetting2)),"3":JSON.parse(JSON.stringify(defaultsetting2)),"4":JSON.parse(JSON.stringify(defaultsetting2)),"5":JSON.parse(JSON.stringify(defaultsetting2)),"6":JSON.parse(JSON.stringify(defaultsetting2)),"7":JSON.parse(JSON.stringify(defaultsetting2)),"8":JSON.parse(JSON.stringify(defaultsetting2)),"9":JSON.parse(JSON.stringify(defaultsetting2)),"10":JSON.parse(JSON.stringify(defaultsetting2)),"11":JSON.parse(JSON.stringify(defaultsetting2)),"12":JSON.parse(JSON.stringify(defaultsetting2)),"13":JSON.parse(JSON.stringify(defaultsetting2)),"14":JSON.parse(JSON.stringify(defaultsetting2)),"15":JSON.parse(JSON.stringify(defaultsetting2))};function freeeeg128codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<128;i3++){let idx=i3*3+1;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=385;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps3=250;var freeeeg128SerialSettings={deviceType:"USB",deviceName:"freeeeg128",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg128codec,sps:sps3,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg128ChartSettings={lines:{"ax":{nSec:10,sps:sps3},"ay":{nSec:10,sps:sps3},"az":{nSec:10,sps:sps3},"gx":{nSec:10,sps:sps3},"gy":{nSec:10,sps:sps3},"gz":{nSec:10,sps:sps3}}};var freeeeg128FilterSettings={};for(let i3=0;i3<128;i3++){freeeeg128ChartSettings.lines[i3]={sps:sps3,nSec:10,units:"mV"};freeeeg128FilterSettings[i3]={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,scalar:1e3*2.5/(32*(Math.pow(2,24)-1))}}function freeeeg32codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<32;i3++){let idx=i3*3+1;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=97;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var sps4=512;var freeeeg32SerialSettings={deviceType:"USB",deviceName:"freeeeg32",baudRate:921600,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var freeeeg32_optical_SerialSettings={deviceType:"USB",deviceName:"freeeeg32_optical",baudRate:1e6,bufferSize:2e3,frequency:1.9,codec:freeeeg32codec,sps:sps4,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting3={nSec:10,sps:sps4};var freeeeg32ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting3)),"ay":JSON.parse(JSON.stringify(defaultChartSetting3)),"az":JSON.parse(JSON.stringify(defaultChartSetting3)),"gx":JSON.parse(JSON.stringify(defaultChartSetting3)),"gy":JSON.parse(JSON.stringify(defaultChartSetting3)),"gz":JSON.parse(JSON.stringify(defaultChartSetting3))}};var freeeeg32FilterSettings={};for(let i3=0;i3<32;i3++){freeeeg32ChartSettings.lines[i3]={sps:sps4,nSec:10,units:"mV"};freeeeg32FilterSettings[i3]={sps:sps4,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:1e3*2.5/(8*(Math.pow(2,24)-1))}}function freeeeg16codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={};for(let i3=0;i3<16;i3++){let idx=i3*3+1;output[i3]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=16*3+1;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}var BLEBuffer=[];var locked;var lockIdx;function freeeeg16BLEcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;BLEBuffer.push(...data);const needle=new Uint8Array([192,160]);const haystack=BLEBuffer;const search=ByteParser.boyerMoore(needle);const skip=search.byteLength;let nextIndex=-1;let used=lockIdx??0;let pass=false;for(var i3=search(haystack);i3!==-1;i3=search(haystack,i3+skip)){if(!locked&&!(typeof lockIdx==="number"))used=lockIdx=i3;else{nextIndex=i3;if(nextIndex>=0){const len=nextIndex-used;if(!lockIdx){const line=BLEBuffer.splice(lockIdx,len);arr=new Uint8Array(line.slice(needle.length));pass=true;locked=true}else if(len>0){const line=BLEBuffer.splice(lockIdx,len);arr=new Uint8Array(line.slice(needle.length));pass=true}used=nextIndex}}}if(pass){let output={};for(let i4=0;i4<16;i4++){let idx=i4*3+1;output[i4]=ByteParser.bytesToInt24(arr[idx],arr[idx+1],arr[idx+2])}let accIdx=16*3+1;output["ax"]=ByteParser.bytesToInt16(arr[accIdx],arr[accIdx+1]);output["ay"]=ByteParser.bytesToInt16(arr[accIdx+2],arr[accIdx+3]);output["az"]=ByteParser.bytesToInt16(arr[accIdx+4],arr[accIdx+5]);output["gx"]=ByteParser.bytesToInt16(arr[accIdx+6],arr[accIdx+7]);output["gy"]=ByteParser.bytesToInt16(arr[accIdx+8],arr[accIdx+9]);output["gz"]=ByteParser.bytesToInt16(arr[accIdx+10],arr[accIdx+11]);output.timestamp=Date.now();return output}else return void 0}var sps5=250;var freeeeg16BLESettings={deviceType:"BLE",deviceName:"freeeeg16",services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:void 0},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:freeeeg16BLEcodec,sps:sps5}}}};var freeeeg16SerialSettings={deviceType:"USB",deviceName:"freeeeg16",baudRate:115200,bufferSize:2e3,frequency:3.5,codec:freeeeg16codec,sps:sps5,buffering:{searchBytes:new Uint8Array([192,160])}};var defaultChartSetting4={nSec:10,sps:sps5};var freeeeg16ChartSettings={lines:{"ax":JSON.parse(JSON.stringify(defaultChartSetting4)),"ay":JSON.parse(JSON.stringify(defaultChartSetting4)),"az":JSON.parse(JSON.stringify(defaultChartSetting4)),"gx":JSON.parse(JSON.stringify(defaultChartSetting4)),"gy":JSON.parse(JSON.stringify(defaultChartSetting4)),"gz":JSON.parse(JSON.stringify(defaultChartSetting4))}};var freeeeg16FilterSettings={};var gain2=32;var nbits2=24;var vref2=1.2;for(let i3=0;i3<16;i3++){freeeeg16ChartSettings.lines[i3]={sps:sps5,nSec:10,units:"mV"};freeeeg16FilterSettings[i3]={sps:sps5,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref2/(gain2*(Math.pow(2,nbits2)-1))}}var textdecoder=new TextDecoder;function hegduinocodec(value){let output={timestamp:0,red:0,infrared:0,heg:0,ambient:0,temperature:0};if(value.getInt8)value=new Uint8Array(value.buffer);else if(!value.buffer)value=new Uint8Array(value);let txt=textdecoder.decode(value);let line=txt.split("|");if(line.length===3){output.timestamp=Date.now();output.red=parseInt(line[0]);output.infrared=parseInt(line[1]);output.heg=parseFloat(line[2])}else if(line.length>=2){output.timestamp=Date.now();output.red=parseInt(line[1]);output.infrared=parseInt(line[2]);output.heg=parseFloat(line[3]);if(line[4])output.ambient=parseFloat(line[4]);if(line[5])output.temperature=parseFloat(line[5]);return output}else return txt}var sps6=40;var hegduinoSerialSettings={deviceType:"USB",deviceName:"hegduino",baudRate:115200,write:"t\n",codec:hegduinocodec,sps:sps6};var hegduinoV1SerialSettings=Object.assign({},hegduinoSerialSettings);hegduinoV1SerialSettings.sps=19;var hegduinoBLESettings={deviceType:"BLE",deviceName:"hegduino",sps:sps6,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:hegduinocodec,sps:sps6}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var hegduinoV1BLESettings=Object.assign({},hegduinoSerialSettings);hegduinoV1BLESettings.sps=19;var hegduinoChartSettings={lines:{red:{nSec:60,sps:sps6},infrared:{nSec:60,sps:sps6},heg:{nSec:60,ymin:0,sps:sps6},ambient:{nSec:60,sps:sps6},temperature:{nSec:60,sps:sps6,units:"C"}}};var v1sps=19;var hegduinoV1FilterSettings={red:{sps:v1sps,lowpassHz:2,useLowpass:true},infrared:{sps:v1sps,lowpassHz:2,useLowpass:true},heg:{sps:v1sps,lowpassHz:2,useLowpass:true}};var hegduinoV2FilterSettings={red:{sps:sps6,lowpassHz:4,useLowpass:true},infrared:{sps:sps6,lowpassHz:4,useLowpass:true},heg:{sps:sps6,lowpassHz:4,useLowpass:true}};function max3010xcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let pktCt=32;const output={"red":new Array(pktCt),"ir":new Array(pktCt),"max_dietemp":ByteParser.get2sCompliment(arr[193],8)+.0625*arr[194],"timestamp":Date.now()};let i3=0;while(i3<pktCt){let idx=i3*6;if(i3%2===0){output["ir"][i3]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["ir"][i3+1]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}else{output["red"][i3-1]=(arr[idx+1]<<16|arr[idx+2]<<8|arr[idx+3])&524287;output["red"][i3]=(arr[idx+4]<<16|arr[idx+5]<<8|arr[idx+6])&524287}i3++}return output}var max3010xChartSettings={lines:{"red":{nSec:10,sps:96},"ir":{nSec:10,sps:96},"max_dietemp":{nSec:10,sps:3.33,units:"C"}}};function mpu6050codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={"ax":new Array(20),"ay":new Array(20),"az":new Array(20),"gx":new Array(20),"gy":new Array(20),"gz":new Array(20),"mpu_dietemp":(ByteParser.bytesToInt16(arr[241],arr[242])+521)/340+35,timestamp:Date.now()};for(let i3=0;i3<20;i3++){let idx=i3*12;output.ax[i3]=ByteParser.bytesToInt16(arr[idx+1],arr[idx+2]);output.ay[i3]=ByteParser.bytesToInt16(arr[idx+3],arr[idx+4]);output.az[i3]=ByteParser.bytesToInt16(arr[idx+5],arr[idx+6]);output.gx[i3]=ByteParser.bytesToInt16(arr[idx+7],arr[idx+8]);output.gy[i3]=ByteParser.bytesToInt16(arr[idx+9],arr[idx+10]);output.gz[i3]=ByteParser.bytesToInt16(arr[idx+11],arr[idx+12])}return output}var sps7=100;var mpu6050ChartSettings={lines:{"ax":{nSec:10,sps:sps7},"ay":{nSec:10,sps:sps7},"az":{nSec:10,sps:sps7},"gx":{nSec:10,sps:sps7},"gy":{nSec:10,sps:sps7},"gz":{nSec:10,sps:sps7},"mpu_dietemp":{nSec:10,sps:5,units:"C"}}};function cognixionONE_EEG_codec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={0:new Array,1:new Array,2:new Array,3:new Array,4:new Array,5:new Array,6:new Array,7:new Array,timestamp:Date.now()};for(let i3=0;i3<7;i3++){let j3=i3*26+1;if(!arr[j3+23])break;output[0][i3]=ByteParser.bytesToUInt24(arr[j3],arr[j3+1],arr[j3+2]);output[1][i3]=ByteParser.bytesToUInt24(arr[j3+3],arr[j3+4],arr[j3+5]);output[2][i3]=ByteParser.bytesToUInt24(arr[j3+6],arr[j3+7],arr[j3+8]);output[3][i3]=ByteParser.bytesToUInt24(arr[j3+9],arr[j3+10],arr[j3+11]);output[4][i3]=ByteParser.bytesToUInt24(arr[j3+12],arr[j3+13],arr[j3+14]);output[5][i3]=ByteParser.bytesToUInt24(arr[j3+15],arr[j3+16],arr[j3+17]);output[6][i3]=ByteParser.bytesToUInt24(arr[j3+18],arr[j3+19],arr[j3+20]);output[7][i3]=ByteParser.bytesToUInt24(arr[j3+21],arr[j3+22],arr[j3+23])}return output}var sps8=250;var cognixionONEBLESettings={deviceType:"BLE",deviceName:"cognixionONE",services:{["82046698-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{["8204669A-6313-4BB1-9645-6BA28BF86DF5".toLowerCase()]:{notify:true,notifyCallback:void 0,codec:cognixionONE_EEG_codec,sps:sps8}},["82E12914-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{["82E12915-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{write:void 0},["82E12916-9AFA-4648-BD1B-8E2B3DC6DAAF".toLowerCase()]:{read:true}}},sps:sps8};var cognixionONESerialSettings=Object.assign({},cytonSerialSettings);cognixionONESerialSettings.sps=sps8;cognixionONESerialSettings.deviceName="cognixionONE";var defaultChartSetting5={nSec:10,sps:sps8,units:"mV"};var cognixionONEChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting5)),"1":JSON.parse(JSON.stringify(defaultChartSetting5)),"2":JSON.parse(JSON.stringify(defaultChartSetting5)),"3":JSON.parse(JSON.stringify(defaultChartSetting5)),"4":JSON.parse(JSON.stringify(defaultChartSetting5)),"5":JSON.parse(JSON.stringify(defaultChartSetting5)),"6":JSON.parse(JSON.stringify(defaultChartSetting5)),"7":JSON.parse(JSON.stringify(defaultChartSetting5))}};var cognixionONEFilterSettings={"0":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"1":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"2":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"3":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"4":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"5":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"6":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45},"7":{sps:sps8,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45}};var PeanutCodes={2:{type:"POOR_SIGNAL",format:"<B",byteLength:1},144:{type:"heg",format:"<i",byteLength:4},145:{type:"filteredHEG",format:"<i",byteLength:4},147:{type:"rawdata4",format:"<iiii",byteLength:4*4},148:{type:"rawdata6",format:"<iiiiii",byteLength:4*6},160:{type:"sampleNumber",format:"<i",byteLength:4},176:{type:"debug0",format:"<i",byteLength:4},177:{type:"debug1",format:"<i",byteLength:4},178:{type:"debug2",format:"<i",byteLength:4},179:{type:"debug3",format:"<i",byteLength:4},180:{type:"debug4",format:"<iiiiii",byteLength:4*6},181:{type:"debug4",format:"<iiiiii",byteLength:4*6},182:{type:"rawdata27",format:"<B"+"i".repeat(26),byteLength:1+4*26}};function peanutcodec(data){let result={};let i3=0;while(i3<data.length){if(PeanutCodes[data[i3]]&&i3+1+PeanutCodes[data[i3]].byteLength<=data.length){let slice=data.slice(i3+1,i3+1+PeanutCodes[data[i3]].byteLength).buffer;let unpacked=ByteParser.struct(PeanutCodes[data[i3]].format).unpack(slice);let code=PeanutCodes[data[i3]].type;if(code==="unfilteredHEG"||code==="heg")unpacked=unpacked[0]/256;else if(code==="POOR_SIGNAL"||code==="sampleNumber"||code==="debug0"||code==="debug1"||code==="debug2"||code==="debug3")unpacked=unpacked[0];if(!result[PeanutCodes[data[i3]].type]){if(Array.isArray(unpacked))result[PeanutCodes[data[i3]].type]=unpacked;else result[PeanutCodes[data[i3]].type]=[unpacked]}else{if(Array.isArray(unpacked))result[PeanutCodes[data[i3]].type].push(...unpacked);else result[PeanutCodes[data[i3]].type].push(unpacked)}i3+=PeanutCodes[data[i3]].byteLength+1}else i3++}result.timestamp=Date.now();return result}var peanutSerialSettings={deviceType:"USB",deviceName:"peanut",baudRate:38400,bufferSize:400,write:"protocol 3\n",buffering:{searchBytes:new Uint8Array([170,170])},codec:peanutcodec,sps:10.101};var peanutChartSettings={lines:{filteredHEG:{sps:10.101,nSec:60},heg:{sps:10.101,nSec:60},debug0:{sps:10.101,nSec:60},debug1:{sps:10.101,nSec:60},debug2:{sps:10.101,nSec:60},debug3:{sps:10.101,nSec:60},debug4:{sps:60.101,nSec:60}},generateNewLines:false,cleanGeneration:false};var sealevel_hpa=1013.25;var bme280codec=data=>{let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;let output={timestamp:Date.now(),temp:[],pressure:[],altitude:[]};let mode=0;if(arr[0].length===74)mode=1;if(!mode){for(let j3=0;j3<3;j3++){let i3=j3*16+2;let tint=ByteParser.bytesToInt32(arr[3+i3],arr[2+i3],arr[1+i3],arr[0+i3]);let tfrac=ByteParser.bytesToInt32(arr[7+i3],arr[6+i3],arr[5+i3],arr[4+i3]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i3],arr[10+i3],arr[9+i3],arr[8+i3]);let pfrac=ByteParser.bytesToInt32(arr[15+i3],arr[14+i3],arr[13+i3],arr[12+i3]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));output.altitude.push(altitude(output.pressure[j3],output.temp[j3]))}}else{output.humidity=[];for(let j3=0;j3<3;j3++){let i3=j3*24+2;let tint=ByteParser.bytesToInt32(arr[3+i3],arr[2+i3],arr[1+i3],arr[0+i3]);let tfrac=ByteParser.bytesToInt32(arr[7+i3],arr[6+i3],arr[5+i3],arr[4+i3]);output.temp.push(tint+tfrac/Math.pow(10,Math.ceil(Math.log10(tfrac))));let pint=10*ByteParser.bytesToInt32(arr[11+i3],arr[10+i3],arr[9+i3],arr[8+i3]);let pfrac=ByteParser.bytesToInt32(arr[15+i3],arr[14+i3],arr[13+i3],arr[12+i3]);output.pressure.push(pint+pfrac/Math.pow(10,Math.ceil(Math.log10(pfrac))));let hint=ByteParser.bytesToInt32(arr[19+i3],arr[18+i3],arr[17+i3],arr[16+i3]);let hfrac=ByteParser.bytesToInt32(arr[23+i3],arr[22+i3],arr[21+i3],arr[20+i3]);output.humidity.push(hint+hfrac/Math.pow(10,Math.ceil(Math.log10(hfrac))));output.altitude.push(altitude(output.pressure[j3],output.temp[j3]))}}return output};function altitude(pressure,temperature){return 44330*(1-Math.pow(pressure/sealevel_hpa,.1903))}var bme280ChartSettings={lines:{"temp":{nSec:120,sps:3.33,units:"C"},"pressure":{nSec:120,sps:3.33,units:"hPa"},"humidity":{nSec:120,sps:3.33,units:"%"},"altitude":{nSec:120,sps:3.33,units:"m"}}};function nrf5x_usbcodec(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec(arr.subarray(2)))}else if(arr[0]===3){let result=Object.assign(output,ads131m08codec(arr.subarray(2)));Object.keys(result).forEach((key,i3)=>{output[i3+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,Object.assign(output,ads131m08codec(arr.subarray(2))))}return output}function nrf5x_usbcodec_singleended(data){let arr;if(data.getInt8)arr=new Uint8Array(data.buffer);else if(!data.buffer)arr=new Uint8Array(data);else arr=data;const output={};if(arr[0]===2){Object.assign(output,ads131m08codec_singleended(arr.subarray(2)))}else if(arr[0]===3){let result=Object.assign(output,ads131m08codec(arr.subarray(2)));Object.keys(result).forEach((key,i3)=>{output[i3+8]=result[key]})}else if(arr[0]===4){Object.assign(output,mpu6050codec(arr.subarray(2)))}else if(arr[0]===5){Object.assign(output,max3010xcodec(arr.subarray(2)))}else if(arr[0]===6){Object.assign(output,bme280codec(arr.subarray(2)))}else{Object.assign(output,Object.assign(output,ads131m08codec_singleended(arr.subarray(2))))}return output}var nrf5xSerialSettings={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec,sps:250};var nrf5xSerialSettings_singleended={deviceType:"USB",deviceName:"nrf5x",baudRate:115200,buffering:{searchBytes:new Uint8Array([240,240])},codec:nrf5x_usbcodec_singleended,sps:250};var nrf5xBLESettings={deviceType:"BLE",deviceName:"nrf5x",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var nrf5xBLESettings_singleended={deviceType:"BLE",deviceName:"nrf5x_singleended",sps:250,services:{"0000cafe-b0ba-8bad-f00d-deadbeef0000":{"0001cafe-b0ba-8bad-f00d-deadbeef0000":{write:void 0},"0002cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec_singleended,sps:250},"0003cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:max3010xcodec,sps:100},"0004cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:mpu6050codec,sps:100},"0005cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:ads131m08codec_singleended,sps:250},"0006cafe-b0ba-8bad-f00d-deadbeef0000":{notify:true,notifyCallback:void 0,codec:bme280codec,sps:3.33}}}};var defaultChartSetting6={nSec:10,sps:250,units:"mV"};var nrf5x_usbChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting6)),"1":JSON.parse(JSON.stringify(defaultChartSetting6)),"2":JSON.parse(JSON.stringify(defaultChartSetting6)),"3":JSON.parse(JSON.stringify(defaultChartSetting6)),"4":JSON.parse(JSON.stringify(defaultChartSetting6)),"5":JSON.parse(JSON.stringify(defaultChartSetting6)),"6":JSON.parse(JSON.stringify(defaultChartSetting6)),"7":JSON.parse(JSON.stringify(defaultChartSetting6))},generateNewLines:true,cleanGeneration:false};var gain3=32;var nbits3=24;var vref3=1.2;var defaultsetting3={sps:250,useDCBlock:false,useBandpass:false,bandpassLower:3,bandpassUpper:45,useScaling:true,scalar:.96*1e3*vref3/(gain3*(Math.pow(2,nbits3)-1))};var nrf5x_usbFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting3)),"1":JSON.parse(JSON.stringify(defaultsetting3)),"2":JSON.parse(JSON.stringify(defaultsetting3)),"3":JSON.parse(JSON.stringify(defaultsetting3)),"4":JSON.parse(JSON.stringify(defaultsetting3)),"5":JSON.parse(JSON.stringify(defaultsetting3)),"6":JSON.parse(JSON.stringify(defaultsetting3)),"7":JSON.parse(JSON.stringify(defaultsetting3)),"8":JSON.parse(JSON.stringify(defaultsetting3)),"9":JSON.parse(JSON.stringify(defaultsetting3)),"10":JSON.parse(JSON.stringify(defaultsetting3)),"11":JSON.parse(JSON.stringify(defaultsetting3)),"12":JSON.parse(JSON.stringify(defaultsetting3)),"13":JSON.parse(JSON.stringify(defaultsetting3)),"14":JSON.parse(JSON.stringify(defaultsetting3)),"15":JSON.parse(JSON.stringify(defaultsetting3))};var textdecoder2=new TextDecoder;function statechangercodec(value){let output={timestamp:0,left_red:0,left_infrared:0,left_heg:0,center_red:0,center_infrared:0,center_heg:0,right_red:0,right_infrared:0,right_heg:0};let txt=textdecoder2.decode(value);let line=txt.split("|");if(line.length>=5){output.timestamp=Date.now();output.left_red=parseInt(line[1]);output.left_infrared=parseInt(line[2]);output.left_heg=parseFloat(line[3]);output.center_red=parseInt(line[4]);output.center_infrared=parseInt(line[5]);output.center_heg=parseFloat(line[6]);output.right_red=parseInt(line[7]);output.right_infrared=parseInt(line[8]);output.right_heg=parseFloat(line[9]);return output}else return txt}var statechangerSerialSettings={deviceType:"USB",deviceName:"statechanger",baudRate:115200,codec:statechangercodec,sps:20};var statechangerBLESettings={deviceType:"BLE",deviceName:"statechanger",sps:20,services:{["6E400001-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{"6e400002-b5a3-f393-e0a9-e50e24dcca9e":{write:"t"},"6e400003-b5a3-f393-e0a9-e50e24dcca9e":{notify:true,notifyCallback:void 0,codec:statechangercodec}},["6E400004-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{["6E400005-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true},["6E400006-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{write:void 0,notify:true,notifyCallback:void 0},["6E400007-B5A3-F393-E0A9-E50E24DCCA9E".toLowerCase()]:{read:true}}},androidWebBLE:"o"};var statechangerChartSettings={lines:{left_red:{nSec:60,sps:20},left_infrared:{nSec:60,sps:20},left_heg:{nSec:60,sps:20},center_red:{nSec:60,sps:20},center_infrared:{nSec:60,sps:20},center_heg:{nSec:60,sps:20},right_red:{nSec:60,sps:20},right_infrared:{nSec:60,sps:20},right_heg:{nSec:60,sps:20}}};function blueberrycodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.red/(.5*(output.ir+output.ir2));return output}var sps9=40;var blueberryBLESettings={deviceType:"BLE",deviceName:"blueberry",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"3f3e3d3c-3b3a-3938-3736-353433323130":{notify:true,notifyCallback:void 0,codec:blueberrycodec,sps:sps9}}},sps:sps9};var blueberryChartSettings={lines:{red:{nSec:60,sps:sps9},ir:{nSec:60,sps:sps9},ir2:{nSec:60,sps:sps9},heg:{nSec:60,sps:sps9}}};function blueberryshortcodec(value){let output={sred:value.getInt32(2),sir:value.getInt32(6),sir2:value.getInt32(10),timestamp:Date.now()};output.sheg=output.sred/(.5*(output.sir+output.sir2));return output}function blueberrylongcodec(value){let output={red:value.getInt32(2),ir:value.getInt32(6),ir2:value.getInt32(10),timestamp:Date.now()};output.heg=output.sred/(.5*(output.ir+output.ir2));return output}var sps10=40;var blueberry2BLESettings={deviceType:"BLE",deviceName:"blueberry2",namePrefix:"blueberry",services:{"0f0e0d0c-0b0a-0908-0706-050403020100":{"1f1e1d1c-1b1a-1918-1716-151413121110":{write:void 0},"4f4e4d4c-4b6a-6968-6766-656463426160":{notify:true,notifyCallback:void 0,codec:blueberrylongcodec,sps:sps10},"4f4e4d4c-4b5a-5958-5756-555453425150":{notify:true,notifyCallback:void 0,codec:blueberryshortcodec,sps:sps10}}},sps:sps10};var blueberry2ChartSettings={lines:{red:{nSec:60,sps:sps10},ir:{nSec:60,sps:sps10},ir2:{nSec:60,sps:sps10},heg:{nSec:60,sps:sps10},sred:{nSec:60,sps:sps10},sir:{nSec:60,sps:sps10},sir2:{nSec:60,sps:sps10},sheg:{nSec:60,sps:sps10}}};function hrcodec(data){return{hr:data.getInt8(1),timestamp:Date.now()}}var heartRateBLESettings={deviceType:"BLE",deviceName:"heartrate",services:{"heart_rate":{"heart_rate_measurement":{notify:true,notifyCallback:void 0,codec:hrcodec}}}};var simulatorSettings={sps:250,deviceType:"CUSTOM",deviceName:"simulator",simulate:{"0":{sps:250,freq:1,amplitude:1,offset:0},"1":{sps:250,freq:10,amplitude:1,offset:0},"2":{sps:250,freq:100,amplitude:.5,offset:.5},"3":{sps:250,freq:25,amplitude:1,offset:0}},connect:(settings={})=>{return new Promise(async(res,rej)=>{let _id=`simulated${Math.floor(Math.random()*1e15)}`;let info={_id,settings:Object.assign(Object.assign({},simulatorSettings),settings)};info.settings.looping=true;let loopTime=50;let lastTime=Date.now();let loop=()=>{if(info.settings.looping){let newData={};let now=Date.now();let frame=now-lastTime;for(const key in info.settings.simulate){let newPoints=Math.floor(info.settings.simulate[key].sps*frame/1e3);newData[key]=new Array(newPoints).fill(0);newData[key]=newData[key].map((v2,i3)=>{return Math.sin(2*Math.PI*info.settings.simulate[key].freq*.001*(lastTime+frame*(i3+1)/newPoints))*info.settings.simulate[key].amplitude+info.settings.simulate[key].offset})}lastTime=now;newData.timestamp=lastTime;info.settings.ondata(newData);setTimeout(()=>{loop()},loopTime)}};loop();if(info.settings.onconnect)info.settings.onconnect(info);res(info)})},codec:reading=>{return reading},disconnect:info=>{console.log(info);info.settings.looping=false;info.settings.ondisconnect(info)},onconnect:info=>{console.log("simulator connected!",info)},ondisconnect:info=>{console.log("simulator disconnected!",info)},ondata:data=>{}};var NORDIC_SERVICE="6e400001-b5a3-f393-e0a9-e50e24dcca9e";var NORDIC_TX="6e400002-b5a3-f393-e0a9-e50e24dcca9e";var NORDIC_RX="6e400003-b5a3-f393-e0a9-e50e24dcca9e";var defaultChunkSize=128;var espruinocodec=data=>{let decoded=new Uint8Array(data.buffer);if(decoded.length>defaultChunkSize)defaultChunkSize=decoded.length;return{output:decoded}};var decoder2=new TextDecoder;function ab2str(buf){return decoder2.decode(buf)}function str2ab(str3){var buf=new ArrayBuffer(str3.length);var bufView=new Uint8Array(buf);for(var i3=0,strLen=str3.length;i3<strLen;i3++){bufView[i3]=str3.charCodeAt(i3)}return new DataView(buf)}async function writeEspruinoCommand(device,command,chunkSize=defaultChunkSize,chunkDelay=10,addEndline=true){await device.write({service:NORDIC_SERVICE,characteristic:NORDIC_TX,data:str2ab(`${command}${addEndline?"\n":""}`),chunkSize,chunkDelay})}async function resetBangleJSSettings(device){return writeEspruinoCommand(device,`require('Storage').erase('setting.json');load()
`,void 0,void 0,false)}function toJSONishString(txt){let js='"';for(let i3=0;i3<txt.length;i3++){let ch=txt.charCodeAt(i3);let nextCh=i3+1<txt.length?txt.charCodeAt(i3+1):0;if(ch<8){if(nextCh>="0".charCodeAt(0)&&nextCh<="7".charCodeAt(0))js+="\\x0"+ch;else js+="\\"+ch}else if(ch==8)js+="\\b";else if(ch==9)js+="\\t";else if(ch==10)js+="\\n";else if(ch==11)js+="\\v";else if(ch==12)js+="\\f";else if(ch==34)js+='\\"';else if(ch==92)js+="\\\\";else if(ch<32||ch==127||ch==173||ch>=194&&ch<=244)js+="\\x"+(ch&255|256).toString(16).substring(1);else if(ch>255)js+="\\u"+(ch&65535|65536).toString(16).substring(1);else js+=txt[i3]}js+='"';return js}async function uploadEspruinoCodeFile(device,ESPRUINO_CODE,chunkSize=defaultChunkSize,chunkDelay=50,onProgress,fileName="app.js",progressPingback=false){const NORDIC_SERVICE2="6e400001-b5a3-f393-e0a9-e50e24dcca9e";const NORDIC_TX2="6e400002-b5a3-f393-e0a9-e50e24dcca9e";function str2ab2(str3){const buf=new ArrayBuffer(str3.length);const bufView=new Uint8Array(buf);for(let i3=0,strLen=str3.length;i3<strLen;i3++){bufView[i3]=str3.charCodeAt(i3)}return buf}try{console.log("Writing reset operation");const fName=toJSONishString(fileName);await device.write({service:NORDIC_SERVICE2,characteristic:NORDIC_TX2,data:str2ab2("reset();\n"),chunkSize,chunkDelay});console.log("Waiting for device to reset");await new Promise(res=>setTimeout(res,1500));console.log("Writing new program to device.");const len=ESPRUINO_CODE.length;let currentBytes=0;let i3=0;while(i3<len){const chunk=ESPRUINO_CODE.substr(i3,1024);let command;if(i3===0){command=`require("Storage").erase(${fName});
 require("Storage").write(${fName}, ${toJSONishString(chunk)}, 0, ${len});`}else{command=`require("Storage").write(${fName}, ${toJSONishString(chunk)}, ${i3});`}i3+=chunk.length;if(progressPingback)command+=`
Bluetooth.println("OK");
`;if(i3>=len)command+=`
load(${fName});
`;const cmdBuffer=str2ab2(command);await device.write({service:NORDIC_SERVICE2,characteristic:NORDIC_TX2,data:cmdBuffer,chunkSize,chunkDelay});currentBytes+=cmdBuffer.byteLength;const prog=currentBytes/len;if(onProgress)onProgress(prog>=1?1:prog);if(chunkDelay)await new Promise(res=>setTimeout(res,chunkDelay))}console.log("Program written successfully.")}catch(error){console.error("Error uploading Espruino code:",error);throw error}}async function uploadEspruinoBootCode(device,ESPRUINO_CODE,chunkSize=128,chunkDelay=10,isFlashPersistent=false,onProgress){const NORDIC_SERVICE2="6e400001-b5a3-f393-e0a9-e50e24dcca9e";const NORDIC_TX2="6e400002-b5a3-f393-e0a9-e50e24dcca9e";const NORDIC_RX2="6e400003-b5a3-f393-e0a9-e50e24dcca9e";function str2ab2(str3){const buf=new ArrayBuffer(str3.length);const bufView=new Uint8Array(buf);for(let i3=0,strLen=str3.length;i3<strLen;i3++){bufView[i3]=str3.charCodeAt(i3)}return buf}function asJS(code){return JSON.stringify(code)}function splitCommands(cmd){const cmds=[];for(let i3=0;i3<cmd.length;i3+=chunkSize){cmds.push(cmd.slice(i3,i3+chunkSize))}return cmds}async function uploadCommandList(cmds,currentBytes,maxBytes){for(let cmd of cmds){const cmdBuffer=str2ab2(cmd);await device.write({service:NORDIC_SERVICE2,characteristic:NORDIC_TX2,data:cmdBuffer,chunkSize,chunkDelay});currentBytes+=cmdBuffer.byteLength;if(onProgress)onProgress(currentBytes/maxBytes);await new Promise(res=>setTimeout(res,chunkDelay))}}try{console.log("Writing reset operation");await device.write({service:NORDIC_SERVICE2,characteristic:NORDIC_TX2,data:str2ab2("reset();\n"),chunkSize,chunkDelay});console.log("Waiting for device to reset");await new Promise(res=>setTimeout(res,1500));console.log("Writing program to device.");const bootCode=`E.setBootCode(${asJS(ESPRUINO_CODE)}${isFlashPersistent?",true":""});load()
`;const programCommands=splitCommands(bootCode);const maxBytes=programCommands.reduce((b3,cmd)=>b3+cmd.length,0)||1;let currentBytes=0;await uploadCommandList(programCommands,currentBytes,maxBytes);console.log("Program written.");return}catch(error){console.error("Error uploading Espruino code:",error);throw error}}async function uploadEspruinoCode(device,ESPRUINO_CODE,chunkSize=defaultChunkSize,chunkDelay=10,onProgress){console.log("Writing reset operation");await device.write({service:NORDIC_SERVICE,characteristic:NORDIC_TX,data:str2ab("reset();\n"),chunkSize,chunkDelay});console.log("Writing program to device.");await new Promise(res=>{setTimeout(()=>{res(true)},1500)});await device.write({service:NORDIC_SERVICE,characteristic:NORDIC_TX,data:str2ab(`if(1){"${ESPRUINO_CODE}"}
`),chunkSize,chunkDelay,callback:onProgress});console.log("Program written.");return}var espruinoNames=["Bangle.js","Puck.js","Pixi.js","Jolt.js","MDBT42Q","Espruino"];var espruinoBLESettings={deviceType:"BLE",deviceName:"espruino",namePrefix:"Bangle.js",services:{[NORDIC_SERVICE]:{[NORDIC_TX]:{write:void 0},[NORDIC_RX]:{notify:true,codec:espruinocodec}}}};var BiquadChannelFilterer=class{constructor(options={sps:512,useSMA4:false,useNotch50:true,useNotch60:true,useLowpass:false,lowpassHz:100,useBandpass:false,bandpassLower:3,bandpassUpper:45,useDCBlock:true,DCBresonance:.995,trimOutliers:false,outlierTolerance:.2,useScaling:false,scalar:1}){this.idx=0;this.sps=options.sps;this.bandpassLower=options.bandpassLower?options.bandpassLower:3;this.bandpassUpper=options.bandpassUpper?options.bandpassUpper:45;this.useSMA4=options.useSMA4;this.last4=[];this.useNotch50=options.useNotch50;this.useNotch60=options.useNotch60;this.useLowpass=options.useLowpass;this.lowpassHz=options.lowpassHz?options.lowpassHz:100;this.useBandpass=options.useBandpass;this.useDCBlock=options.useDCBlock;this.DCBresonance=options.DCBresonance?options.DCBresonance:.995;this.useScaling=options.useScaling;this.scalar=options.scalar;this.trimOutliers=options.trimOutliers;this.outlierTolerance=options.outlierTolerance;let sps11=this.sps;this.notch50=[makeNotchFilter(50,sps11,2),makeNotchFilter(100,sps11,2)];this.notch60=[makeNotchFilter(60,sps11,2),makeNotchFilter(120,sps11,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps11),new Biquad("lowpass",this.lowpassHz,sps11),new Biquad("lowpass",this.lowpassHz,sps11),new Biquad("lowpass",this.lowpassHz,sps11)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1)];this.dcb=new DCBlocker(options.DCBresonance?options.DCBresonance:.995)}reset(sps11=this.sps){this.notch50=[makeNotchFilter(50,sps11,2),makeNotchFilter(100,sps11,2)];this.notch60=[makeNotchFilter(60,sps11,2),makeNotchFilter(120,sps11,2)];this.lp1=[new Biquad("lowpass",this.lowpassHz,sps11),new Biquad("lowpass",this.lowpassHz,sps11),new Biquad("lowpass",this.lowpassHz,sps11),new Biquad("lowpass",this.lowpassHz,sps11)];this.bp1=[makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1),makeBandpassFilter(this.bandpassLower,this.bandpassUpper,sps11,1)];this.dcb=new DCBlocker(this.DCBresonance)}setBandpass(bandpassLower=this.bandpassLower,bandpassUpper=this.bandpassUpper,sps11=this.sps){this.bandpassLower=bandpassLower;this.bandpassUpper=bandpassUpper;this.bp1=[makeBandpassFilter(bandpassLower,bandpassUpper,sps11),makeBandpassFilter(bandpassLower,bandpassUpper,sps11),makeBandpassFilter(bandpassLower,bandpassUpper,sps11),makeBandpassFilter(bandpassLower,bandpassUpper,sps11)]}apply(latestData=0){let out=latestData;if(this.useScaling===true){out*=this.scalar}if(this.filtered&&this.trimOutliers&&this.outlierTolerance){if(Math.abs(out-this.filtered)>this.outlierTolerance){out=this.filtered}}if(this.useDCBlock===true){out=this.dcb.applyFilter(out)}if(this.useSMA4===true){if(this.last4.length<4){this.last4.push(out)}else{out=this.last4.reduce((accumulator,currentValue)=>accumulator+currentValue)/this.last4.length;this.last4.shift();this.last4.push(out)}}if(this.useNotch50===true){this.notch50.forEach((f2,i3)=>{out=f2.applyFilter(out)})}if(this.useNotch60===true){this.notch60.forEach((f2,i3)=>{out=f2.applyFilter(out)})}if(this.useLowpass===true){this.lp1.forEach((f2,i3)=>{out=f2.applyFilter(out)})}if(this.useBandpass===true){this.bp1.forEach((f2,i3)=>{out=f2.applyFilter(out)})}this.filtered=out;this.idx++;return out}};var Biquad=class{constructor(type,freq,sps11,Q2=1/Math.sqrt(2),dbGain=0){this.a0=0;this.a1=0;this.a2=0;this.b0=0;this.b1=0;this.b2=0;this.x1=0;this.x2=0;this.y1=0;this.y2=0;let types=["lowpass","highpass","bandpass","notch","peak","lowshelf","highshelf"];if(types.indexOf(type)<0){console.error("Valid types: 'lowpass','highpass','bandpass','notch','peak','lowshelf','highshelf'");return}this.type=type;this.freq=freq;this.sps=sps11;this.Q=Q2;this.dbGain=dbGain;let A3=Math.pow(10,dbGain/40);let omega=2*Math.PI*freq/sps11;let sn=Math.sin(omega);let cs=Math.cos(omega);let alpha=sn/(2*Q2);let beta=Math.sqrt(A3+A3);this[type](A3,sn,cs,alpha,beta);this.b0/=this.a0;this.b1/=this.a0;this.b2/=this.a0;this.a1/=this.a0;this.a2/=this.a0}lowpass(A3,sn,cs,alpha,beta){this.b0=(1-cs)*.5;this.b1=1-cs;this.b2=(1-cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}highpass(A3,sn,cs,alpha,beta){this.b0=(1+cs)*.5;this.b1=-(1+cs);this.b2=(1+cs)*.5;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}bandpass(A3,sn,cs,alpha,beta){this.b0=alpha;this.b1=0;this.b2=-alpha;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}notch(A3,sn,cs,alpha,beta){this.b0=1;this.b1=-2*cs;this.b2=1;this.a0=1+alpha;this.a1=-2*cs;this.a2=1-alpha}peak(A3,sn,cs,alpha,beta){this.b0=1+alpha*A3;this.b1=-2*cs;this.b2=1-alpha*A3;this.a0=1+alpha/A3;this.a1=-2*cs;this.a2=1-alpha/A3}lowshelf(A3,sn,cs,alpha,beta){this.b0=A3*(A3+1-(A3-1)*cs+beta*sn);this.b1=2*A3*(A3-1-(A3+1)*cs);this.b2=A3*(A3+1-(A3-1)*cs-beta*sn);this.a0=A3+1+(A3+1)*cs+beta*sn;this.a1=2*(A3-1+(A3+1)*cs);this.a2=A3+1+(A3-1)*cs-beta*sn}highshelf(A3,sn,cs,alpha,beta){this.b0=A3*(A3+1+(A3-1)*cs+beta*sn);this.b1=2*A3*(A3-1+(A3+1)*cs);this.b2=A3*(A3+1-(A3-1)*cs-beta*sn);this.a0=A3+1-(A3+1)*cs-beta*sn;this.a1=2*(A3-1-(A3+1)*cs);this.a2=A3+1-(A3-1)*cs-beta*sn}applyFilter(signal_step){let y3=this.b0*signal_step+this.b1*this.x1+this.b2*this.x2-this.a1*this.y1-this.a2*this.y2;this.x2=this.x1;this.x1=signal_step;this.y2=this.y1;this.y1=y3;return y3}zResult(freq){try{let phi=Math.pow(Math.sin(Math.PI*freq*2/(2*this.sps)),2);let result=(Math.pow(this.b0+this.b1+this.b2,2)-4*(this.b0*this.b1+4*this.b0*this.b2+this.b1*this.b2)*phi+16*this.b0*this.b2*phi*phi)/(Math.pow(1+this.a1+this.a2,2)-4*(this.a1+4*this.a2+this.a1*this.a2)*phi+16*this.a2*phi*phi);return result}catch(err){return-200}}static calcCenterFrequency(freqStart,freqEnd){return(freqStart+freqEnd)/2}static calcBandwidth(freqStart,freqEnd){return freqEnd-this.calcCenterFrequency(freqStart,freqEnd)}static calcBandpassQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q2=resonance*Math.sqrt((frequency-bandwidth)*(frequency+bandwidth))/(2*bandwidth);return Q2}static calcNotchQ(frequency,bandwidth,resonance=Math.pow(10,Math.floor(Math.log10(frequency)))){let Q2=resonance*frequency*bandwidth/Math.sqrt((frequency-bandwidth)*(frequency+bandwidth));return Q2}};var DCBlocker=class{constructor(r=.995){this.r=r;this.y1=this.y2=this.x1=this.x2=0}applyFilter(signal_step){this.x2=this.x1;this.x1=signal_step;let y3=this.x1-this.x2+this.r*this.y1;this.y2=this.y1;this.y1=y3;return y3}};var makeNotchFilter=(frequency,sps11,bandwidth)=>{return new Biquad("notch",frequency,sps11,Biquad.calcNotchQ(frequency,bandwidth),0)};var makeBandpassFilter=(freqStart,freqEnd,sps11,resonance=Math.pow(10,Math.floor(Math.log10(Biquad.calcCenterFrequency(freqStart,freqEnd)))))=>{return new Biquad("bandpass",Biquad.calcCenterFrequency(freqStart,freqEnd),sps11,Biquad.calcBandpassQ(Biquad.calcCenterFrequency(freqStart,freqEnd),Biquad.calcBandwidth(freqStart,freqEnd),resonance),0)};var defaultsetting1={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var ganglionFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting1)),"1":JSON.parse(JSON.stringify(defaultsetting1)),"2":JSON.parse(JSON.stringify(defaultsetting1)),"3":JSON.parse(JSON.stringify(defaultsetting1))};var defaultChartSetting7={nSec:10,sps:250,units:"mV"};var ganglionChartSettings={lines:{"0":JSON.parse(JSON.stringify(defaultChartSetting7)),"1":JSON.parse(JSON.stringify(defaultChartSetting7)),"2":JSON.parse(JSON.stringify(defaultChartSetting7)),"3":JSON.parse(JSON.stringify(defaultChartSetting7)),"ax":{nSec:10,sps:250,units:"mg"},"ay":{nSec:10,sps:250,units:"mg"},"az":{nSec:10,sps:250,units:"mg"}},generateNewLines:true};var defaultsetting4={sps:250,useDCBlock:true,useBandpass:true,bandpassLower:3,bandpassUpper:45};var museFilterSettings={"0":JSON.parse(JSON.stringify(defaultsetting4)),"1":JSON.parse(JSON.stringify(defaultsetting4)),"2":JSON.parse(JSON.stringify(defaultsetting4)),"3":JSON.parse(JSON.stringify(defaultsetting4)),"4":JSON.parse(JSON.stringify(defaultsetting4))};var museChartSettings={lines:{"0":{nSec:10,sps:250,units:"uV"},"1":{nSec:10,sps:250,units:"uV"},"2":{nSec:10,sps:250,units:"uV"},"3":{nSec:10,sps:250,units:"uV"},"4":{nSec:10,sps:250,units:"uV"},"ax":{nSec:10,sps:100,units:"mg"},"ay":{nSec:10,sps:100,units:"mg"},"az":{nSec:10,sps:100,units:"mg"},"gx":{nSec:10,sps:100,units:"rps"},"gy":{nSec:10,sps:100,units:"rps"},"gz":{nSec:10,sps:100,units:"rps"}},generateNewLines:true};var Devices={BLE:{"nrf5x":nrf5xBLESettings,"nrf5x_singleended":nrf5xBLESettings_singleended,"hegduino":hegduinoBLESettings,"hegduinoV1":hegduinoV1BLESettings,"cognixionONE":cognixionONEBLESettings,"statechanger":statechangerBLESettings,"blueberry":blueberryBLESettings,"blueberry2":blueberry2BLESettings,"heart_rate":heartRateBLESettings,"freeEEG16":freeeeg16BLESettings,"espruino":espruinoBLESettings},USB:{"nrf5x":nrf5xSerialSettings,"nrf5x_singleended":nrf5xSerialSettings_singleended,"freeEEG16":freeeeg16SerialSettings,"freeEEG32":freeeeg32SerialSettings,"freeEEG32_optical":freeeeg32_optical_SerialSettings,"freeEEG128":freeeeg128SerialSettings,"hegduino":hegduinoSerialSettings,"hegduinoV1":hegduinoV1SerialSettings,"cyton":cytonSerialSettings,"cyton_daisy":daisycytonSerialSettings,"peanut":peanutSerialSettings,"statechanger":statechangerSerialSettings,"cognixionONE":cytonSerialSettings},BLE_CUSTOM:{},USB_CUSTOM:{},CUSTOM:{"simulator":simulatorSettings}};var defaultChartSettings={lines:{"0":{nPoints:1e3}},generateNewLines:true,cleanGeneration:true};var filterPresets={"raw":void 0,"utf8":void 0,"console-f12":void 0,"debug":void 0,"ads131m08":ads131m08FilterSettings,"max3010x":void 0,"mpu6050":void 0,"freeeeg16":freeeeg16FilterSettings,"freeeeg32":freeeeg32FilterSettings,"freeeeg128":freeeeg128FilterSettings,"cyton":cytonFilterSettings,"cognixionONE_BLE":cognixionONEFilterSettings,"hegduino":hegduinoV2FilterSettings,"hegduinoV1":hegduinoV1FilterSettings,"nrf5x":nrf5x_usbFilterSettings,"ganglion":ganglionFilterSettings,"muse":museFilterSettings,"arduino_ads131m08":ads131m08FilterSettings};var chartSettings={"raw":defaultChartSettings,"utf8":defaultChartSettings,"console-f12":defaultChartSettings,"debug":defaultChartSettings,"ads131m08":ads131m08ChartSettings,"max3010x":max3010xChartSettings,"mpu6050":mpu6050ChartSettings,"freeeeg16":freeeeg16ChartSettings,"freeeeg32":freeeeg32ChartSettings,"freeeeg128":freeeeg128ChartSettings,"cyton":cytonChartSettings,"cognixionONE_BLE":cognixionONEChartSettings,"hegduino":hegduinoChartSettings,"hegduinoV1":hegduinoChartSettings,"nrf5x":nrf5x_usbChartSettings,"statechanger":statechangerChartSettings,"peanut":peanutChartSettings,"blueberry":blueberryChartSettings,"blueberry2":blueberry2ChartSettings,"ganglion":ganglionChartSettings,"muse":museChartSettings,"arduino_ads131m08":ads131m08ChartSettings,"simulator":defaultChartSettings};var textdecoder3=new TextDecoder;var decoders={"raw":data=>{if(data?.getInt8)return Array.from(new Uint8Array(data));else return data},"utf8":data=>{if(data?.getInt8)return textdecoder3.decode(new Uint8Array(data.buffer));else return textdecoder3.decode(data)},"console-f12":data=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(data);return data},"debug":(data,debugmessage)=>{if(data?.buffer)data=Array.from(new Uint8Array(data));console.log(debugmessage,data);return data},"ads131m08":ads131m08codec,"arduino_ads131m08":ads131m08_arduinocodec,"max3010x":max3010xcodec,"mpu6050":mpu6050codec,"bme280":bme280codec,"freeeeg16":freeeeg16codec,"freeeeg32":freeeeg32codec,"freeeeg128":freeeeg128codec,"cyton":cytoncodec,"cognixionONE_BLE":cognixionONE_EEG_codec,"hegduino":hegduinocodec,"nrf5x":nrf5x_usbcodec,"peanut":peanutcodec,"statechanger":statechangercodec,"blueberry":blueberrycodec,"heart_rate":hrcodec,"espruino":espruinocodec};var getFunctionHead=methodString=>{let startindex=methodString.indexOf("=>")+1;if(startindex<=0){startindex=methodString.indexOf("){")}if(startindex<=0){startindex=methodString.indexOf(") {")}return methodString.slice(0,methodString.indexOf("{",startindex)+1)};function parseFunctionFromText(method=""){let getFunctionBody=methodString=>{return methodString.replace(/^\W*(function[^{]+\{([\s\S]*)\}|[^=]+=>[^{]*\{([\s\S]*)\}|[^=]+=>(.+))/i,"$2$3$4")};let newFuncHead=getFunctionHead(method);let newFuncBody=getFunctionBody(method);let newFunc;if(newFuncHead.includes("function")){let varName=newFuncHead.substring(newFuncHead.indexOf("(")+1,newFuncHead.lastIndexOf(")"));newFunc=new Function(varName,newFuncBody)}else{if(newFuncHead.substring(0,6)===newFuncBody.substring(0,6)){let varName=newFuncHead.substring(newFuncHead.indexOf("(")+1,newFuncHead.lastIndexOf(")"));newFunc=new Function(varName,newFuncBody.substring(newFuncBody.indexOf("{")+1,newFuncBody.length-1))}else{try{newFunc=(0,eval)(method)}catch{}}}return newFunc}var stringifyWithCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}}}return value}return function stringifyWithCircularRefs2(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithCircularRefs===void 0){JSON.stringifyWithCircularRefs=stringifyWithCircularRefs}var stringifyWithFunctionsAndCircularRefs=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx--}}}}function checkCircular(key,value){if(value!=null){if(typeof value==="object"){if(key){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(typeof value==="function"?value.toString():value,path.join("."))}}}return typeof value==="function"?value.toString():value}return function stringifyWithFunctionsAndCircularRefs2(obj,space){try{parents.push(obj);return JSON.stringify(obj,checkCircular,space)}finally{clear()}}}();if(JSON.stringifyWithFunctionsAndCircularRefs===void 0){JSON.stringifyWithFunctionsAndCircularRefs=stringifyWithFunctionsAndCircularRefs}var stringifyFast=function(){const refs=new Map;const parents=[];const path=["this"];function clear(){refs.clear();parents.length=0;path.length=1}function updateParents(key,value){var idx=parents.length-1;if(parents[idx]){var prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value||idx===0){path.push(key);parents.push(value.pushed)}else{while(idx-->=0){prev=parents[idx];if(typeof prev==="object"){if(prev[key]===value){idx+=2;parents.length=idx;path.length=idx;--idx;parents[idx]=value;path[idx]=key;break}}idx++}}}}}function checkValues(key,value){let val;if(value!=null){if(typeof value==="object"){let c2=value.constructor.name;if(key&&c2==="Object"){updateParents(key,value)}let other=refs.get(value);if(other){return"[Circular Reference]"+other}else{refs.set(value,path.join("."))}if(c2==="Array"){if(value.length>20){val=value.slice(value.length-20)}else val=value}else if(c2.includes("Set")){val=Array.from(value)}else if(c2!=="Object"&&c2!=="Number"&&c2!=="String"&&c2!=="Boolean"){val="instanceof_"+c2}else if(c2==="Object"){let obj={};for(const prop in value){if(value[prop]==null){obj[prop]=value[prop]}else if(Array.isArray(value[prop])){if(value[prop].length>20)obj[prop]=value[prop].slice(value[prop].length-20);else obj[prop]=value[prop]}else if(value[prop].constructor.name==="Object"){obj[prop]={};for(const p2 in value[prop]){if(Array.isArray(value[prop][p2])){if(value[prop][p2].length>20)obj[prop][p2]=value[prop][p2].slice(value[prop][p2].length-20);else obj[prop][p2]=value[prop][p2]}else{if(value[prop][p2]!=null){let con=value[prop][p2].constructor.name;if(con.includes("Set")){obj[prop][p2]=Array.from(value[prop][p2])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop][p2]="instanceof_"+con}else{obj[prop][p2]=value[prop][p2]}}else{obj[prop][p2]=value[prop][p2]}}}}else{let con=value[prop].constructor.name;if(con.includes("Set")){obj[prop]=Array.from(value[prop])}else if(con!=="Number"&&con!=="String"&&con!=="Boolean"){obj[prop]="instanceof_"+con}else{obj[prop]=value[prop]}}}val=obj}else{val=value}}else{val=value}}return val}return function stringifyFast2(obj,space){parents.push(obj);let res=JSON.stringify(obj,checkValues,space);clear();return res}}();if(JSON.stringifyFast===void 0){JSON.stringifyFast=stringifyFast}function loadStreamWorkerGlobals(){globalThis.Devices=Devices;globalThis.WebSerial=WebSerial;globalThis.decoders=decoders;globalThis.decoder="raw";globalThis.ByteParser=ByteParser;globalThis.filtering=false;globalThis.filters={};globalThis.BiquadChannelFilterer=BiquadChannelFilterer;globalThis.ArrayManip=ArrayManip}if(typeof WorkerGlobalScope!=="undefined"&&self instanceof WorkerGlobalScope){loadStreamWorkerGlobals()}var streamWorkerRoutes={"transferDevice":function transferDevice(device,worker){let cpy=Object.assign({},device);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}worker.send({route:"receiveDevice",args:cpy})},"receiveDevice":function receiveDevice(device){for(const key in device){if(typeof device[key]==="string"){let fn=parseFunctionFromText(device[key]);if(typeof fn==="function"){device[key]=fn}}}if(!globalThis.Devices[device.deviceType])globalThis.Devices[device.deviceType]={};globalThis.Devices[device.deviceType][device.deviceName]=device},"receiveDecoder":function receiveDecoder(decoder3,decoderName){globalThis.decoders[decoderName]=(0,eval)("("+decoder3+")")},"receiveCodec":function receiveDeviceCodec(decoder3,deviceType,device,service,characteristic){let codec=parseFunctionFromText(decoder3);if(codec){if(deviceType==="BLE"&&service&&characteristic){if(globalThis.Devices[deviceType][device]){if(globalThis.Devices[deviceType][device][service]){if(globalThis.Devices[deviceType][device][characteristic]){globalThis.Devices[deviceType][device][characteristic].codec=codec}else{globalThis.Devices[deviceType][device][characteristic]={codec}}}else{globalThis.Devices[deviceType][device]={[characteristic]:{codec}}}}}else if(globalThis.Devices[deviceType][device]?.codec){if(globalThis.Devices[deviceType][device])globalThis.Devices[deviceType][device].codec=codec;else{globalThis.Devices[deviceType][device]={codec}}}}},"decode":function decode2(data){return globalThis.decoder(data)},"decodeAndParse":function decodeAndParse(data){let decoded=this.__node.graph.run("decode",data);if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v2=>filter.apply(v2))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v2=>filter.apply(v2))}}}}return parsed}}return decoded},"setActiveDecoder":function setActiveDecoder(deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device]?.codec;else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)globalThis.decoder=globalThis.Devices[deviceType][device][service][characteristic].codec;return true},"decodeDevice":function decodeDevice(data,deviceType,device,service,characteristic){if(globalThis.Devices[deviceType][device]?.codec)return globalThis.Devices[deviceType][device].codec(data);else if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][device]?.[service]?.[characteristic]?.codec)return globalThis.Devices[deviceType][device][service][characteristic].codec(data)},"decodeAndParseDevice":function decodeAndParseDevice(data,deviceType,deviceName,service,characteristic){let decoded;if(deviceType==="BLE"&&service&&characteristic&&globalThis.Devices[deviceType][deviceName]?.services[service]?.[characteristic]?.codec)decoded=globalThis.Devices[deviceType][deviceName].services[service][characteristic].codec(data);else if(globalThis.Devices[deviceType][deviceName]?.codec)decoded=globalThis.Devices[deviceType][deviceName].codec(data);else decoded=data;if(decoded){let parsed=globalThis.ArrayManip.reformatData(decoded);if(parsed){if(globalThis.filtering){for(const prop in parsed){if(globalThis.filters[prop]){let filter=globalThis.filters[prop];if(Array.isArray(parsed[prop])){parsed[prop]=parsed[prop].map(v2=>filter.apply(v2))}else if(parsed[prop]?.values){parsed[prop].values=parsed[prop].values.map(v2=>filter.apply(v2))}else if(typeof parsed[prop]==="number"){parsed[prop]=filter.apply(parsed[prop])}}}}return parsed}}return decoded},"toggleAnim":function toggleAnim(){globalThis.runningAnim=!globalThis.runningAnim;return globalThis.runningAnim},"setFilters":function setFilters(filters,clearFilters=false){if(!globalThis.filters||clearFilters){globalThis.filters={};if(clearFilters)globalThis.filtering=false}if(filters){for(const key in filters){globalThis.filters[key]=new BiquadChannelFilterer(filters[key])}globalThis.filtering=true}return true},"getFilterSettings":function getFilterSettings(){if(globalThis.filters){let filters={};for(const key in globalThis.filters){filters[key]={sps:globalThis.filters[key].sps,useScaling:globalThis.filters[key].useScaling,scalar:globalThis.filters[key].scalar,useNotch50:globalThis.filters[key].useNotch50,useNotch60:globalThis.filters[key].useNotch60,useDCBlock:globalThis.filters[key].useDCBlock,useLowpass:globalThis.filters[key].useLowpass,lowpassHz:globalThis.filters[key].lowpassHz,useBandpass:globalThis.filters[key].useBandpass,bandpassLower:globalThis.filters[key].bandpassLower,bandpassUpper:globalThis.filters[key].bandpassUpper}}return filters}return void 0},"setupSerial":function setupSerial(){globalThis.Serial=new globalThis.WebSerial;globalThis.decoder="raw";console.log("worker: Setting up Serial",globalThis.Serial);return true},"openPort":function openPort(settings){const WorkerService2=this.__node.graph;if(!globalThis.Serial)WorkerService2.run("setupSerial");return new Promise((res,rej)=>{globalThis.Serial.getPorts().then(ports=>{const Serial=globalThis.Serial;let port=ports.find(port2=>{return port2.getInfo().usbVendorId===settings.usbVendorId&&port2.getInfo().usbProductId===settings.usbProductId});if(port){let options=Object.assign({},settings);if(typeof settings.pipeTo==="object"&&settings.pipeTo.extraArgs&&globalThis.Devices?.[settings.pipeTo.extraArgs[0]]?.[settings.pipeTo.extraArgs[1]]){options.onconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].onconnect;options.ondisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].ondisconnect;options.beforedisconnect=globalThis.Devices[settings.pipeTo.extraArgs[0]][settings.pipeTo.extraArgs[1]].beforedisconnect}Serial.openPort(port,options).then(()=>{const stream=Serial.createStream({port,settings:options,frequency:settings.frequency?settings.frequency:10,buffering:settings.buffering,ondata:value=>{if(stream.settings.pipeTo){if(stream.settings.pipeMain){WorkerService2.transmit(value,void 0,[value.buffer])}if(typeof stream.settings.pipeTo==="string")WorkerService2.transmit(value,stream.settings.pipeTo,[value.buffer]);else if(stream.settings.pipeTo?.route){let args=value;if(stream.settings.pipeTo.extraArgs)args=[value,...stream.settings.pipeTo.extraArgs];WorkerService2.transmit({route:stream.settings.pipeTo.route,args},stream.settings.pipeTo._id,[value.buffer])}}else{WorkerService2.transmit(value,void 0,[value.buffer])}}});Serial.readStream(stream);port.ondisconnect=()=>{postMessage(`${stream._id} disconnected`)};res({_id:stream._id,settings,info:stream.info})}).catch(()=>{postMessage(`disconnected`)});;}else{rej(false)}})})},"closeStream":function closeStream(streamId){return new Promise((res,rej)=>{const Serial=globalThis.Serial;let ondisconnect;if(Serial.streams[streamId].port?.ondisconnect)ondisconnect=Serial.streams[streamId].port.ondisconnect;Serial.closeStream(Serial.streams[streamId]).then(resolved=>{if(ondisconnect)ondisconnect(void 0);res(resolved)}).catch(rej)})},"writeStream":function writeStream(streamId,message){globalThis.Serial.writeStream(globalThis.Serial.streams[streamId],message);return true},"updateStreamSettings":function updateStreamSettings(streamId,settings){if(globalThis.Serial?.streams[streamId]){for(const key in settings){if(typeof settings[key]==="object"){Object.assign(globalThis.Serial.streams[streamId].settings[key],settings[key])}else globalThis.Serial.streams[streamId][key]=settings[key]}}}};function isMobile(){let check=false;(function(a){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check=true})(navigator.userAgent||navigator.vendor||window.opera);return check}var BLE=new BLEClient;var workers=new WorkerService({roots:{...ne,...remoteGraphRoutes}});function initDevice(settings,options){if(!settings)return void 0;if(!options)options={ondecoded:data=>{console.log(data)}};let deviceType=settings.deviceType;let deviceName=settings.deviceName;if(!options.workerUrl)options.workerUrl=stream_worker_default;if(!options.service)options.service=workers;let streamworker=options.service.addWorker({url:options.workerUrl});if(!options.devices)options.devices=Devices;if(!options.devices[deviceType][deviceName]){let cpy=Object.assign({},settings);for(const key in cpy){if(typeof cpy[key]==="function")cpy[key]=cpy[key].toString()}streamworker.post("receiveDevice",cpy)}if(options.filterSettings){streamworker.post("setFilters",[options.filterSettings])}if(options.roots){for(const key in options.roots){let __parent={callback:"decodeAndParseDevice",worker:streamworker};options.roots[key].__parent=options.roots[key].__parent?Object.assign(options.roots[key].__parent,__parent):__parent}options.service.load(options.roots)}if(deviceType.includes("CUSTOM")){return new Promise(async(res,rej)=>{settings.ondata=data=>{if(options.ondata)options.ondata(data);if(typeof options.ondecoded==="function")streamworker.run("decodeAndParseDevice",[data,deviceType,deviceName]).then(result=>{options.ondecoded(result)})};settings.ondisconnect=()=>{options.service.terminate(streamworker._id);if(options.roots){for(const key in options.roots){options.service.remove(key)}}};let init=await settings.connect(settings);let info={workers:{streamworker},disconnect:()=>{if(options.beforedisconnect)options.beforedisconnect(info);settings.disconnect(init);if(options.ondisconnect)options.ondisconnect(info);if(options.roots){for(const key in options.roots){options.service.remove(key)}}},device:init,options,read:command=>{if(settings.read)return new Promise((res2,rej2)=>{res2(settings.read(settings,command))})},write:command=>{if(settings.write)return new Promise((res2,rej2)=>{res2(settings.write(settings,command))})},setFilters:(filterSettings,clearFilters)=>{return streamworker.run("setFilters",[filterSettings,clearFilters])},roots:options.roots};if(options.onconnect)options.onconnect(info);res(info)}).catch(er=>{console.error(er);options.service.terminate(streamworker._id);if(options.roots){for(const key in options.roots){options.service.remove(key)}}})}else if(deviceType==="BLE"){for(let primaryUUID in settings.services){if(settings.services[primaryUUID].UUID)primaryUUID=settings.services[primaryUUID].UUID;for(let characteristic in settings.services[primaryUUID]){let tag=characteristic;if(settings.services[primaryUUID][characteristic].characteristic)characteristic=settings.services[primaryUUID][characteristic].characteristic;if(typeof options.ondecoded==="function"){if(settings.services?.[primaryUUID]?.[tag]?.notify){if(!settings.services[primaryUUID][tag].notifyCallback)settings.services[primaryUUID][tag].notifyCallback=data=>{if(options.ondata)options.ondata(data);streamworker.run("decodeAndParseDevice",[data,deviceType,deviceName,primaryUUID,tag],void 0,[data.buffer]).then(options.ondecoded)};break}}else if(typeof options.ondecoded==="object"){let ref=options.ondecoded[characteristic]?options.ondecoded[characteristic]:options.ondecoded[tag]?options.ondecoded[tag]:null;if(ref){if(options.ondecoded[characteristic]){if(settings.services?.[primaryUUID]?.[tag]?.notify){if(!settings.services[primaryUUID][tag].notifyCallback)settings.services[primaryUUID][tag].notifyCallback=data=>{if(options.ondata)options.ondata(data);streamworker.run("decodeAndParseDevice",[data,deviceType,deviceName,primaryUUID,tag],void 0,[data.buffer]).then(ref)}}if(settings.services?.[primaryUUID]?.[tag]?.read){if(!settings.services[primaryUUID][tag].readCallback)settings.services[tag].readCallback=data=>{if(options.ondata)options.ondata(data);streamworker.run("decodeAndParseDevice",[data,deviceType,deviceName,primaryUUID,tag],void 0,[data.buffer]).then(ref)}}}}}else if(options.ondata){if(settings.services?.[primaryUUID]?.[tag]?.notify)settings.services[primaryUUID][tag].notifyCallback=options.ondata;if(settings.services?.[primaryUUID]?.[tag]?.read)settings.services[tag].readCallback=options.ondata}}}return new Promise((res,rej)=>{BLE.setup(settings).then(result=>{let info={workers:{streamworker},options,device:result,subscribe:(service,notifyCharacteristic,ondata,bypassWorker)=>{return BLE.subscribe(result.device,service,notifyCharacteristic,data=>{if(bypassWorker){if(ondata)ondata(data);else if(options.ondecoded?.[notifyCharacteristic])options.ondecoded[notifyCharacteristic](data);else if(typeof options.ondecoded==="function")options.ondecoded(data)}else{streamworker.run("decodeAndParseDevice",[data,deviceType,deviceName,service,notifyCharacteristic],void 0,[data.buffer]).then(ondata?ondata:options.ondecoded?.[notifyCharacteristic]?options.ondecoded[notifyCharacteristic]:options.ondecoded)}})},unsubscribe:(service,notifyCharacteristic)=>{return BLE.unsubscribe(result.device,service,notifyCharacteristic)},disconnect:async()=>{await BLE.disconnect(result.deviceId);if(options.ondisconnect)options.ondisconnect(info);streamworker.terminate();if(options.roots){for(const key in options.roots){options.service.remove(key)}}},read:command=>{return BLE.read(result.device,command.service,command.characteristic,command.ondata,command.timeout)},write:command=>{return BLE.write(result.device,command.service,command.characteristic,command.data,command.callback,command.chunkSize,command.chunkDelay,command.timeout)},setFilters:(filterSettings,clearFilters)=>{return streamworker.run("setFilters",[filterSettings,clearFilters])},roots:options.roots};if(options.onconnect)options.onconnect(info);res(info)}).catch(er=>{console.error(er);streamworker.terminate();if(options.roots){for(const key in options.roots){options.service.remove(key)}}rej(er)})})}else if(deviceType==="USB"){let serialworker=options.service.addWorker({url:options.workerUrl});serialworker.worker.addEventListener("message",ev=>{if(typeof ev.data==="string"){if(ev.data.includes("disconnected")){options.service.terminate(serialworker._id);options.service.terminate(streamworker._id);if(options.roots){for(const key in options.roots){options.service.remove(key)}}}}else if(typeof options.ondata==="function")options.ondata(ev.data)});serialworker.post("setupSerial");let portId=options.service.establishMessageChannel(streamworker.worker,serialworker.worker);const WS=new WebSerial;return new Promise((res,rej)=>{let onerror=er=>{console.error(er);options.service.terminate(serialworker._id);options.service.terminate(streamworker._id);if(options.roots){for(const key in options.roots){options.service.remove(key)}}rej(er)};let withPort=port=>{let info;if(port)info=port.getInfo();else info={usbVendorId:settings.usbVendorId,usbProductId:settings.usbProductId};serialworker.run("openPort",{baudRate:settings.baudRate,usbVendorId:info.usbVendorId,usbProductId:info.usbProductId,bufferSize:settings.bufferSize,buffering:settings.buffering?settings.buffering:void 0,frequency:settings.frequency?settings.frequency:void 0,pipeTo:{route:"decodeAndParseDevice",_id:portId,extraArgs:[deviceType,deviceName]},pipeMain:options.ondata!==void 0}).then(result=>{if(settings.write)serialworker.post("writeStream",[result._id,settings.write]);if(typeof options.ondecoded==="function")streamworker.subscribe("decodeAndParseDevice",data=>{if(options.ondecoded)options.ondecoded(data)});let info2={workers:{streamworker,serialworker},device:result,options,subscribeStream:ondata=>{return streamworker.subscribe("decodeAndParseDevice",ondata)},unsubscribeStream:sub=>{return streamworker.unsubscribe("decodeAndParseDevice",sub)},disconnect:()=>{serialworker.post("closeStream",result._id);if(options.ondisconnect)options.ondisconnect(info2)},read:()=>{return new Promise((res2,rej2)=>{let sub;sub=streamworker.subscribe("decodeAndParseDevice",result2=>{serialworker.unsubscribe("decodeAndParseDevice",sub);res2(result2)})})},write:(message,chunkSize)=>{return serialworker.run("writeStream",[result._id,message,chunkSize])},setFilters:(filterSettings,clearFilters)=>{return streamworker.run("setFilters",[filterSettings,clearFilters])},roots:options.roots};if(options.onconnect)options.onconnect(info2);res(info2)}).catch(onerror)};if(options.reconnect){withPort()}else{WS.requestPort(settings.usbVendorId,settings.usbProductId).then(port=>{withPort(port)}).catch(onerror)}})}else return void 0}function createStreamPipeline(dedicatedSerialWorker=false,dedicatedRenderWorker=false,renderer,workerUrl){if(!workerUrl)workerUrl=stream_worker_default;let streamworker=workers.addWorker({url:workerUrl});let renderworker,renderPort;let serialworker,decoderPort;if(dedicatedSerialWorker){serialworker=workers.addWorker({url:workerUrl});decoderPort=workers.establishMessageChannel(serialworker.worker,streamworker.worker);serialworker.post("setupSerial")}if(dedicatedRenderWorker){renderworker=workers.addWorker({url:workerUrl});renderPort=workers.establishMessageChannel(streamworker.worker,renderworker.worker);if(renderer){workers.run("transferCanvas",renderworker.worker,renderer);workers.transferFunction(renderworker,function receiveParsedData(parsed){this.run("runUpdate",void 0,parsed)},"receiveParsedData");renderworker.post("subscribeToWorker",["decodeAndParseDevice",renderPort,"receiveParsedData"])}}let result={streamworker};if(serialworker){result.serialworker=serialworker;result.decoderPort=decoderPort}if(renderworker){result.renderworker=renderworker;result.renderPort=renderPort}return result}export{BLE,Biquad,BiquadChannelFilterer,DCBlocker,Devices,NORDIC_RX,NORDIC_SERVICE,NORDIC_TX,PeanutCodes,ab2str,ads131m08ChartSettings,ads131m08FilterSettings,ads131m08_arduinocodec,ads131m08codec,ads131m08codec_singleended,blueberry2BLESettings,blueberry2ChartSettings,blueberryBLESettings,blueberryChartSettings,blueberrycodec,blueberrylongcodec,blueberryshortcodec,bme280ChartSettings,bme280codec,chartSettings,cognixionONEBLESettings,cognixionONEChartSettings,cognixionONEFilterSettings,cognixionONESerialSettings,cognixionONE_EEG_codec,createStreamPipeline,cytonChartSettings,cytonFilterSettings,cytonSerialSettings,cytoncodec,daisycytonSerialSettings,daisycytoncodec,decoders,defaultChartSettings,espruinoBLESettings,espruinoNames,espruinocodec,filterPresets,freeeeg128ChartSettings,freeeeg128FilterSettings,freeeeg128SerialSettings,freeeeg128codec,freeeeg16BLESettings,freeeeg16BLEcodec,freeeeg16ChartSettings,freeeeg16FilterSettings,freeeeg16SerialSettings,freeeeg16codec,freeeeg32ChartSettings,freeeeg32FilterSettings,freeeeg32SerialSettings,freeeeg32_optical_SerialSettings,freeeeg32codec,stream_worker_default as gsworker,heartRateBLESettings,hegduinoBLESettings,hegduinoChartSettings,hegduinoSerialSettings,hegduinoV1BLESettings,hegduinoV1FilterSettings,hegduinoV1SerialSettings,hegduinoV2FilterSettings,hegduinocodec,hrcodec,initDevice,isMobile,loadStreamWorkerGlobals,makeBandpassFilter,makeNotchFilter,max3010xChartSettings,max3010xcodec,mpu6050ChartSettings,mpu6050codec,nrf5xBLESettings,nrf5xBLESettings_singleended,nrf5xSerialSettings,nrf5xSerialSettings_singleended,nrf5x_usbChartSettings,nrf5x_usbFilterSettings,nrf5x_usbcodec,nrf5x_usbcodec_singleended,peanutChartSettings,peanutSerialSettings,peanutcodec,resetBangleJSSettings,sealevel_hpa,simulatorSettings,statechangerBLESettings,statechangerChartSettings,statechangerSerialSettings,statechangercodec,str2ab,streamWorkerRoutes,uploadEspruinoBootCode,uploadEspruinoCode,uploadEspruinoCodeFile,workers,writeEspruinoCommand};
/*! Bundled license information:

@capacitor/core/dist/index.js:
  (*! Capacitor: https://capacitorjs.com/ - MIT License *)
*/
